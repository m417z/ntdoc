<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="STOR_POFX_DEVICE_V3 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>STOR_POFX_DEVICE_V3 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            STOR_POFX_DEVICE_V3 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// storport.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">typedef struct _STOR_POFX_DEVICE_V3 {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               Version;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               Size;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               ComponentCount;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               Flags;
  union {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UnitMinIdleTimeoutInMS;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AdapterIdleTimeoutInMS;
  };
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               MinimumPowerCyclePeriodInMS;
  <a href="stor_pofx_component" title="typedef struct _STOR_POFX_COMPONENT {&#10;  ULONG                          Version;&#10;  ULONG                          Size;&#10;  ULONG                          FStateCount;&#10;  ULONG                          DeepestWakeableFState;&#10;  GUID                           Id;&#10;  STOR_POFX_COMPONENT_IDLE_STATE FStates[ANYSIZE_ARRAY];&#10;} STOR_POFX_COMPONENT, *PSTOR_POFX_COMPONENT;">STOR_POFX_COMPONENT</a> Components[ANYSIZE_ARRAY];
} STOR_POFX_DEVICE_V3, *PSTOR_POFX_DEVICE_V3;</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/ns-storport-_stor_pofx_device_v3">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/stor_pofx_device_v3.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-storport-_stor_pofx_device_v3)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>STOR_POFX_DEVICE_V3 structure</h1>
<h2>Description</h2>
<p>The <strong>STOR_POFX_DEVICE_V3</strong> structure describes the power attributes of a storage device to the power management framework (PoFx). This structure is similar to <strong><a href="stor_pofx_device" title="typedef struct _STOR_POFX_DEVICE {&#10;  ULONG               Version;&#10;  ULONG               Size;&#10;  ULONG               ComponentCount;&#10;  ULONG               Flags;&#10;  STOR_POFX_COMPONENT Components[ANYSIZE_ARRAY];&#10;} STOR_POFX_DEVICE, *PSTOR_POFX_DEVICE;">STOR_POFX_DEVICE</a></strong> but allows the caller to specify an idle timeout value.</p>
<h2>Members</h2>
<h3><code>Version</code></h3>
<p>The version number of this structure. Set this member to <strong>STOR_POFX_DEVICE_VERSION_V3</strong>.</p>
<h3><code>Size</code></h3>
<p>The size of this structure. Set this value to <strong>STOR_POFX_DEVICE_V3_SIZE</strong>.</p>
<h3><code>ComponentCount</code></h3>
<p>The number of elements in the <strong>Components</strong> array. Set this member to 1. Currently, only a single component is supported for either a storage adapter or logical unit.</p>
<h3><code>Flags</code></h3>
<p>The device power state capabilities flags. The miniport sets one or more of the <em>PoFx</em> device flags to enable or disable power state capabilities. <strong>Flags</strong> is a bitwise OR combination of the following.</p>
<table>
<thead>
<tr>
<th>Flag value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>STOR_POFX_DEVICE_FLAG_NO_D0 (0x01)</td>
<td>Requests that a power up <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> not be sent to the device object for the adapter or unit.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_NO_D3 (0x02)</td>
<td>Requests that a power down <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> not be sent to the device object for the adapter or unit.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_ENABLE_D3_COLD (0x04)</td>
<td>Enables Storport to set the D3 Cold state for the adapter if it supports it. This flag applies to adapters only.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_NO_DUMP_ACTIVE (0x08)</td>
<td>Indicates whether a device is available for dump when it is idle. The miniport is not able to bring the storage device active in dump mode if the device has entered the idle state or the power off when idle state.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_IDLE_TIMEOUT (0x10)</td>
<td>If the <strong>STOR_POFX_DEVICE_V3</strong> represents a unit, this flag indicates that the <strong>UnitMinIdleTimeoutInMS</strong> field should be honored. If the <strong>STOR_POFX_DEVICE_V3</strong> represents an adapter, this indicates the <strong>AdapterIdleTimeoutInMS</strong> field should be honored.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_ADAPTIVE_D3_IDLE_TIMEOUT (0x20)</td>
<td>Indicates that Storport should dynamically adjust the D3 idle timeout such that the device can aggressively enter D3 when necessary. This is valid only when <strong>STOR_POFX_DEVICE_V3</strong> is used.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_NO_UNIT_REGISTRATION (0x40)</td>
<td>Specifies that none of the units exposed by this adapter should be registered for runtime power management. This is valid only for <strong><a href="stor_pofx_device" title="typedef struct _STOR_POFX_DEVICE {&#10;  ULONG               Version;&#10;  ULONG               Size;&#10;  ULONG               ComponentCount;&#10;  ULONG               Flags;&#10;  STOR_POFX_COMPONENT Components[ANYSIZE_ARRAY];&#10;} STOR_POFX_DEVICE, *PSTOR_POFX_DEVICE;">STOR_POFX_DEVICE</a></strong> structures that represent an adapter.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_PERF_STATE_PEP_OPTIONAL (0x80)</td>
<td>Indicates the miniport does not require P-State support from the platform extension plug-in (PEP). When in doubt, set this flag.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_NO_IDLE_DEBOUNCE (0x100)</td>
<td>Checks how capable the dump version of the miniport is at powering on the device when the device is in lower power states.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_DUMP_ALWAYS_POWER_ON (0x200)</td>
<td>The miniport wants the dump stack to attempt to power on the device.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_DISABLE_INTERRUPTS_ON_D3 (0x400)</td>
<td>The miniport would like Storport to disable/ enable interrupts on Dx transitions.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_ADAPTER_D3_WAKE (0x800)</td>
<td>The miniport isopt-in adapter D3 wake support.</td>
</tr>
<tr>
<td>STOR_POFX_DEVICE_FLAG_GET_PERF_STATE_FROM_PEP (0x1000)</td>
<td>The miniport requires P-states from the PEP.</td>
</tr>
</tbody>
</table>
<h3><code>UnitMinIdleTimeoutInMS</code></h3>
<p>The minimum idle time in milliseconds for an unit. This value is only valid when STOR_POFX_DEVICE_FLAG_IDLE_TIMEOUT is set in <strong>Flags</strong>.</p>
<h3><code>AdapterIdleTimeoutInMS</code></h3>
<p>The adapter idle timeout value in milliseconds. This value is only valid when STOR_POFX_DEVICE_FLAG_IDLE_TIMEOUT is set in <strong>Flags</strong>.</p>
<h3><code>MinimumPowerCyclePeriodInMS</code></h3>
<p>Indicates that the device should not be power cycled (D0 -&gt; D3 -&gt; D0) more than once per the given period in milliseconds. This member is only valid when the STOR_POFX_DEVICE_FLAG_ADAPTIVE_D3_IDLE_TIMEOUT flag has been set.</p>
<h3><code>Components</code></h3>
<p>This member is the first element in an array of one or more <strong><a href="stor_pofx_component" title="typedef struct _STOR_POFX_COMPONENT {&#10;  ULONG                          Version;&#10;  ULONG                          Size;&#10;  ULONG                          FStateCount;&#10;  ULONG                          DeepestWakeableFState;&#10;  GUID                           Id;&#10;  STOR_POFX_COMPONENT_IDLE_STATE FStates[ANYSIZE_ARRAY];&#10;} STOR_POFX_COMPONENT, *PSTOR_POFX_COMPONENT;">STOR_POFX_COMPONENT</a></strong> elements. If the array contains more than one element, the additional elements immediately follow the <strong><a href="stor_pofx_device" title="typedef struct _STOR_POFX_DEVICE {&#10;  ULONG               Version;&#10;  ULONG               Size;&#10;  ULONG               ComponentCount;&#10;  ULONG               Flags;&#10;  STOR_POFX_COMPONENT Components[ANYSIZE_ARRAY];&#10;} STOR_POFX_DEVICE, *PSTOR_POFX_DEVICE;">STOR_POFX_DEVICE</a></strong> structure. The array contains one element for each component in the device. Currently, storage devices have only one component so additional component structures are unnecessary.</p>
<h2>Remarks</h2>
<p>To register a storage adapter for Storport PoFx support, the miniport driver calls <strong><a href="storportenablepassiveinitialization" title="BOOLEAN StorPortEnablePassiveInitialization(&#10;  [in] PVOID                          DeviceExtension,&#10;  [in] PHW_PASSIVE_INITIALIZE_ROUTINE HwPassiveInitializeRoutine&#10;);">StorPortEnablePassiveInitialization</a></strong> in its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_initialize"><strong>HwStorInitialize</strong></a> routine and implements a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_passive_initialize_routine"><strong>HwStorPassiveInitializeRoutine</strong></a>. The miniport calls <strong><a href="storportinitializepofxpower" title="ULONG StorPortInitializePoFxPower(&#10;  [in]           PVOID             HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS     Address,&#10;  [in]           PSTOR_POFX_DEVICE Device,&#10;  [in, out]      PBOOLEAN          D3ColdEnabled&#10;);">StorPortInitializePoFxPower</a></strong> within it's <strong>HwStorPassiveInitializeRoutine</strong> to provide information about the adapter component.</p>
<p>To register a storage unit for Storport PoFx support, the miniport driver implements the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_unit_control"><strong>HwStorUnitControl</strong></a> callback routine and provides handling of the <strong>ScsiUnitPoFxPowerInfo</strong> unit control code. When the handling the <strong>ScsiUnitPoFxPowerInfo</strong> control code, the miniport calls <strong><a href="storportinitializepofxpower" title="ULONG StorPortInitializePoFxPower(&#10;  [in]           PVOID             HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS     Address,&#10;  [in]           PSTOR_POFX_DEVICE Device,&#10;  [in, out]      PBOOLEAN          D3ColdEnabled&#10;);">StorPortInitializePoFxPower</a></strong> if idle power management for the unit component is enabled.</p>
<p>The component for the storage device identified by its <strong>Components</strong> array index. Storage devices have only one component so the index of 0 is used. Routines such as <strong><a href="storportpofxactivatecomponent" title="ULONG StorPortPoFxActivateComponent(&#10;  [in]           PVOID               HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS       Address,&#10;  [in, optional] PSCSI_REQUEST_BLOCK Srb,&#10;  [in]           ULONG               Component,&#10;  [in]           ULONG               Flags&#10;);">StorPortPoFxActivateComponent</a></strong> and <strong><a href="storportpofxidlecomponent" title="ULONG StorPortPoFxIdleComponent(&#10;  [in]           PVOID               HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS       Address,&#10;  [in, optional] PSCSI_REQUEST_BLOCK Srb,&#10;  [in]           ULONG               Component,&#10;  [in]           ULONG               Flags&#10;);">StorPortPoFxIdleComponent</a></strong> use the array index of a component to identify the component.</p>
<h2>See also</h2>
<p><strong><a href="stor_pofx_component" title="typedef struct _STOR_POFX_COMPONENT {&#10;  ULONG                          Version;&#10;  ULONG                          Size;&#10;  ULONG                          FStateCount;&#10;  ULONG                          DeepestWakeableFState;&#10;  GUID                           Id;&#10;  STOR_POFX_COMPONENT_IDLE_STATE FStates[ANYSIZE_ARRAY];&#10;} STOR_POFX_COMPONENT, *PSTOR_POFX_COMPONENT;">STOR_POFX_COMPONENT</a></strong></p>
<p><strong><a href="stor_pofx_device" title="typedef struct _STOR_POFX_DEVICE {&#10;  ULONG               Version;&#10;  ULONG               Size;&#10;  ULONG               ComponentCount;&#10;  ULONG               Flags;&#10;  STOR_POFX_COMPONENT Components[ANYSIZE_ARRAY];&#10;} STOR_POFX_DEVICE, *PSTOR_POFX_DEVICE;">STOR_POFX_DEVICE</a></strong></p>
<p><strong><a href="storportinitializepofxpower" title="ULONG StorPortInitializePoFxPower(&#10;  [in]           PVOID             HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS     Address,&#10;  [in]           PSTOR_POFX_DEVICE Device,&#10;  [in, out]      PBOOLEAN          D3ColdEnabled&#10;);">StorPortInitializePoFxPower</a></strong></p>
<p><strong><a href="storportpofxactivatecomponent" title="ULONG StorPortPoFxActivateComponent(&#10;  [in]           PVOID               HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS       Address,&#10;  [in, optional] PSCSI_REQUEST_BLOCK Srb,&#10;  [in]           ULONG               Component,&#10;  [in]           ULONG               Flags&#10;);">StorPortPoFxActivateComponent</a></strong></p>
<p><strong><a href="storportpofxidlecomponent" title="ULONG StorPortPoFxIdleComponent(&#10;  [in]           PVOID               HwDeviceExtension,&#10;  [in, optional] PSTOR_ADDRESS       Address,&#10;  [in, optional] PSCSI_REQUEST_BLOCK Srb,&#10;  [in]           ULONG               Component,&#10;  [in]           ULONG               Flags&#10;);">StorPortPoFxIdleComponent</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/ns-storport-_stor_pofx_device_v3">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/storport/ns-storport-_stor_pofx_device_v3.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
