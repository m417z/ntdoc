<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="LPD3DHAL_VALIDATETEXTURESTAGESTATECB - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>LPD3DHAL_VALIDATETEXTURESTAGESTATECB - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            LPD3DHAL_VALIDATETEXTURESTAGESTATECB - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dhal.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">LPD3DHAL_VALIDATETEXTURESTAGESTATECB Lpd3dhalValidatetexturestagestatecb;

<a href="dword" title="typedef unsigned long DWORD;">DWORD</a> Lpd3dhalValidatetexturestagestatecb(
  LPD3DHAL_VALIDATETEXTURESTAGESTATEDATA unnamedParam1
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_validatetexturestagestatecb">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/lpd3dhal_validatetexturestagestatecb.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dhal-lpd3dhal_validatetexturestagestatecb)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="lpd3dhal_validatetexturestagestatecb-callback-function">LPD3DHAL_VALIDATETEXTURESTAGESTATECB callback function</h1>

<h2 id="description">Description</h2>

<p>The <strong>D3dValidateTextureStageState</strong> function returns the number of passes where the hardware can perform the blending operations specified in the current state.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="unnamedparam1"><code>unnamedParam1</code></h3>

<p><em>pvtssd</em> [in]</p>

<p>Points to a <a href="d3dhal_validatetexturestagestatedata" title="typedef struct _D3DHAL_VALIDATETEXTURESTAGESTATEDATA {&#10;  ULONG_PTR dwhContext;&#10;  DWORD     dwFlags;&#10;  ULONG_PTR dwReserved;&#10;  DWORD     dwNumPasses;&#10;  HRESULT   ddrval;&#10;} D3DHAL_VALIDATETEXTURESTAGESTATEDATA;">D3DHAL_VALIDATETEXTURESTAGESTATEDATA</a> structure that contains the information required for the driver to determine and return the number of passes required to perform the blending operations.</p>

<h2 id="return-value">Return value</h2>

<p><strong>D3dValidateTextureStageState</strong> returns one of the following callback codes:</p>

<h2 id="remarks">Remarks</h2>

<p>Microsoft Direct3D drivers that support texturing must implement <strong>D3dValidateTextureStageState</strong>.</p>

<p>The driver's implementation of this function must evaluate the current texture state for all texture stages associated with the context. If the driver's hardware can perform the specified blending operations, then the driver should return the number of passes on the state data that its hardware requires. If the hardware cannot perform the specified blending operations, then the driver should return one of the following error codes in the <strong>ddrval</strong> member of the <a href="d3dhal_validatetexturestagestatedata" title="typedef struct _D3DHAL_VALIDATETEXTURESTAGESTATEDATA {&#10;  ULONG_PTR dwhContext;&#10;  DWORD     dwFlags;&#10;  ULONG_PTR dwReserved;&#10;  DWORD     dwNumPasses;&#10;  HRESULT   ddrval;&#10;} D3DHAL_VALIDATETEXTURESTAGESTATEDATA;">D3DHAL_VALIDATETEXTURESTAGESTATEDATA</a> structure at <strong>pvtssd</strong>:</p>

<table>
<thead>
<tr>
  <th>Error Code</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>D3DERR_CONFLICTINGTEXTUREFILTER</td>
  <td>The hardware cannot do both trilinear filtering and multitexturing at the same time.</td>
</tr>
<tr>
  <td>D3DERR_TOOMANYOPERATIONS</td>
  <td>The hardware cannot handle the specified number of operations.</td>
</tr>
<tr>
  <td>D3DERR_UNSUPPORTEDALPHAARG</td>
  <td>The hardware does not support a specified alpha argument.</td>
</tr>
<tr>
  <td>D3DERR_UNSUPPORTEDALPHAOPERATION</td>
  <td>The hardware does not support a specified alpha operation.</td>
</tr>
<tr>
  <td>D3DERR_UNSUPPORTEDCOLORARG</td>
  <td>The hardware does not support a specified color argument.</td>
</tr>
<tr>
  <td>D3DERR_UNSUPPORTEDCOLOROPERATION</td>
  <td>The hardware does not support a specified color operation.</td>
</tr>
<tr>
  <td>D3DERR_UNSUPPORTEDFACTORVALUE</td>
  <td>The hardware does not support a D3DTA_TFACTOR greater than 1.0.</td>
</tr>
<tr>
  <td>D3DERR_WRONGTEXTUREFORMAT</td>
  <td>The hardware does not support the current state in the selected texture format.</td>
</tr>
</tbody>
</table>

<p>Direct3D calls <strong>D3dValidateTextureStageState</strong> in response to an application request through a call to <strong>IDirect3DDevice7::ValidateDevice</strong>. The number of passes returned by the driver is propagated back to the application, which can then decide whether it will proceed with rendering using the current state or if it must change the blending operations to render faster or to render at all. There are no limits to the number of passes that a driver can return.</p>

<p>A driver that returns more than one pass is responsible for properly executing the passes on all state and primitive data when rendering.</p>

<p>Requests that are likely to fail <strong>D3dValidateTextureStageState</strong>:</p>

<ul>
<li><p>Using diffuse iterated values as ARGs, or the BLENDDIFFUSE operation is sparsely supported on current hardware. Many parts can introduce only iterated color data at the last texture operation stage.</p></li>
<li><p>Trying to specify the texture for each stage as its arg1 in preference to arg2.</p></li>
<li><p>Attempting to use diffuse or scalar values at arbitrary multitexture blending stages. For many cards, these values can be used only at the final texture blending state; for others, only at the first stage.</p></li>
<li><p>Attempting to do more in the first texture than merely replicate alpha to color channels or invert the input. For many cards, the blending units associated with the first texture are incapable of handling operations more complex than these. The samples below try to use only the second texture's blending unit, if it is possible to do so. The first unit is presumed to be in its default state in the samples.</p></li>
</ul>

<div class="codehilite">
<pre><span></span><code><span class="w">     </span><span class="n">dev</span><span class="p">.</span><span class="n">SetTextureStageState</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">D3DTSS_COLORARG1</span><span class="p">,</span><span class="w"> </span><span class="n">D3DTA_TEXTURE</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="o">*</span>
<span class="w">     </span><span class="n">dev</span><span class="p">.</span><span class="n">SetTextureStageState</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">D3DTSS_COLOROP</span><span class="p">,</span><span class="w"> </span><span class="n">D3DTOP_SELECTARG1</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="o">*</span>
<span class="w">    </span>
</code></pre>
</div>

<ul>
<li><p>Performing operations for the output alpha that are more intricate than, or substantially different from, the operations specified for the color channels is less likely to be supported.</p></li>
<li><p>Attempting to use D3DTA_TFACTOR and D3DTA_DIFFUSE simultaneously. Some hardware does not support this.</p></li>
<li><p>Attempting the simultaneous use of multiple textures and MIP mapped trilinear filtering. Many cards do not support these operations at the same time. If trilinear filtering has been requested for a texture involved in multitexture operations and it fails validation, turn off trilinear and try again. In this case, it may be best to do multipass rendering instead.</p></li>
</ul>

<h2 id="see-also">See also</h2>

<p><a href="d3dhal_validatetexturestagestatedata" title="typedef struct _D3DHAL_VALIDATETEXTURESTAGESTATEDATA {&#10;  ULONG_PTR dwhContext;&#10;  DWORD     dwFlags;&#10;  ULONG_PTR dwReserved;&#10;  DWORD     dwNumPasses;&#10;  HRESULT   ddrval;&#10;} D3DHAL_VALIDATETEXTURESTAGESTATEDATA;">D3DHAL_VALIDATETEXTURESTAGESTATEDATA</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb">D3dDrawPrimitives2</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_validatetexturestagestatecb">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dhal/nc-d3dhal-lpd3dhal_validatetexturestagestatecb.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
