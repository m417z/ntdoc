<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FILE_FS_SECTOR_SIZE_INFORMATION - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FILE_FS_SECTOR_SIZE_INFORMATION - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FILE_FS_SECTOR_SIZE_INFORMATION - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTIOAPI_H

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">typedef struct _FILE_FS_SECTOR_SIZE_INFORMATION
{
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> LogicalBytesPerSector;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PhysicalBytesPerSectorForAtomicity;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PhysicalBytesPerSectorForPerformance;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FileSystemEffectivePhysicalBytesPerSectorForAtomicity;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags; // SSINFO_FLAGS_*
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ByteOffsetForSectorAlignment;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ByteOffsetForPartitionAlignment;
} FILE_FS_SECTOR_SIZE_INFORMATION, *PFILE_FS_SECTOR_SIZE_INFORMATION;
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/5bf185f38fde2fd76daccdbcbaa0ded0f287eecd/phnt/include/ntioapi.h#L1756">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ntddk.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">typedef struct _FILE_FS_SECTOR_SIZE_INFORMATION {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> LogicalBytesPerSector;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PhysicalBytesPerSectorForAtomicity;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PhysicalBytesPerSectorForPerformance;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FileSystemEffectivePhysicalBytesPerSectorForAtomicity;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ByteOffsetForSectorAlignment;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ByteOffsetForPartitionAlignment;
} FILE_FS_SECTOR_SIZE_INFORMATION, *PFILE_FS_SECTOR_SIZE_INFORMATION;</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/ns-ntddk-_file_fs_sector_size_information">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This structure is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntddk/ns-ntddk-_file_fs_sector_size_information">documented in Windows Driver Kit</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/file_fs_sector_size_information.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddk-_file_fs_sector_size_information)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_FILE_FS_SECTOR_SIZE_INFORMATION structure</h1>
<h2>Description</h2>
<p>The <strong>FILE_FS_SECTOR_SIZE_INFORMATION</strong> structure is used to query physical and logical sector size information for a file system volume.</p>
<h2>Members</h2>
<h3><code>LogicalBytesPerSector</code></h3>
<p>Logical bytes per sector reported by physical storage. This is the same value as the block size for used for Logical Block Addressing (LBA).</p>
<h3><code>PhysicalBytesPerSectorForAtomicity</code></h3>
<p>Actual bytes per sector reported by physical storage used for an atomic write.</p>
<h3><code>PhysicalBytesPerSectorForPerformance</code></h3>
<p>Bytes per sector reported by physical storage for best performance.</p>
<h3><code>FileSystemEffectivePhysicalBytesPerSectorForAtomicity</code></h3>
<p>The portion of <strong>PhysicalBytesPerSectorForAtomicity</strong> considered as the physical sector size by the file system.</p>
<h3><code>Flags</code></h3>
<p>Flags for sector alignment and performance capabilities. This value is a bitwise OR combination of the following:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="ssinfo_flags_aligned_device" title="#define SSINFO_FLAGS_ALIGNED_DEVICE 0x00000001">SSINFO_FLAGS_ALIGNED_DEVICE</a></strong></td>
<td>Logical sectors of the storage device are aligned to physical sector boundaries.</td>
</tr>
<tr>
<td><strong><a href="ssinfo_flags_partition_aligned_on_device" title="#define SSINFO_FLAGS_PARTITION_ALIGNED_ON_DEVICE 0x00000002">SSINFO_FLAGS_PARTITION_ALIGNED_ON_DEVICE</a></strong></td>
<td>The partition is aligned to physical sector boundaries on the storage device.</td>
</tr>
<tr>
<td><strong><a href="ssinfo_flags_no_seek_penalty" title="#define SSINFO_FLAGS_NO_SEEK_PENALTY 0x00000004">SSINFO_FLAGS_NO_SEEK_PENALTY</a></strong></td>
<td>The storage device has no seek penalty.</td>
</tr>
<tr>
<td><strong><a href="ssinfo_flags_partition_aligned_on_device" title="#define SSINFO_FLAGS_PARTITION_ALIGNED_ON_DEVICE 0x00000002">SSINFO_FLAGS_PARTITION_ALIGNED_ON_DEVICE</a></strong></td>
<td>The storage device supports the TRIM operation.</td>
</tr>
</tbody>
</table>
<h3><code>ByteOffsetForSectorAlignment</code></h3>
<p>The offset, in bytes, of the beginning of the first logical sector within the first physical sector. This member is set to <strong><a href="ssinfo_offset_unknown" title="#define SSINFO_OFFSET_UNKNOWN 0xffffffff">SSINFO_OFFSET_UNKNOWN</a></strong> if proper device information is not available to calculate the value.</p>
<h3><code>ByteOffsetForPartitionAlignment</code></h3>
<p>The offset value, in bytes, used to align the partition to a physical sector boundary. This member is set to <strong><a href="ssinfo_offset_unknown" title="#define SSINFO_OFFSET_UNKNOWN 0xffffffff">SSINFO_OFFSET_UNKNOWN</a></strong> if proper device information is not available to calculate the value.</p>
<h2>Remarks</h2>
<p>This information can be queried in either of the following ways:</p>
<ul>
<li>Call <a href="fltqueryvolumeinformation" title="NTSTATUS FLTAPI FltQueryVolumeInformation(&#10;  [in]  PFLT_INSTANCE        Instance,&#10;  [out] PIO_STATUS_BLOCK     Iosb,&#10;  [out] PVOID                FsInformation,&#10;  [in]  ULONG                Length,&#10;  [in]  FS_INFORMATION_CLASS FsInformationClass&#10;);">FltQueryVolumeInformation</a> or <a href="ntqueryvolumeinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryVolumeInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _Out_writes_bytes_(Length) PVOID FsInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FSINFOCLASS FsInformationClass&#10;    );">ZwQueryVolumeInformationFile</a>, passing <strong>FileFsSectorSizeInformation</strong> as the value of <em>FileInformationClass</em> and passing a caller-allocated, <strong>FILE_FS_SECTOR_SIZE_INFORMATION</strong>-structured buffer as the value of <em>FileInformation</em>.</li>
<li>Create an <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> with major function code <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-query-volume-information">IRP_MJ_QUERY_VOLUME_INFORMATION</a>.</li>
<li>Call <a href="fsrtlgetsectorsizeinformation" title="NTSTATUS FsRtlGetSectorSizeInformation(&#10;        PDEVICE_OBJECT                   DeviceObject,&#10;  [out] PFILE_FS_SECTOR_SIZE_INFORMATION SectorSizeInfo&#10;);">FsRtlGetSectorSizeInformation</a> with a pointer to a <strong>FILE_FS_SECTOR_SIZE_INFORMATION</strong>-structured buffer. The <strong>FileSystemEffectivePhysicalBytesPerSectorForAtomicity</strong> member will not have a value initialized by the file system when this structure is returned from <strong><a href="fsrtlgetsectorsizeinformation" title="NTSTATUS FsRtlGetSectorSizeInformation(&#10;        PDEVICE_OBJECT                   DeviceObject,&#10;  [out] PFILE_FS_SECTOR_SIZE_INFORMATION SectorSizeInfo&#10;);">FsRtlGetSectorSizeInformation</a></strong>. A file system driver will typically call this function and then set its own value for <strong>FileSystemEffectivePhysicalBytesPerSectorForAtomicity</strong>.</li>
</ul>
<p>No specific access rights are required to query this information. Thus this information is available as long as the volume is accessed through an open handle to the volume itself, or to a file or directory on the volume.</p>
<p>The size of the buffer passed in the <em>FileInformation</em> parameter to <a href="fltqueryvolumeinformation" title="NTSTATUS FLTAPI FltQueryVolumeInformation(&#10;  [in]  PFLT_INSTANCE        Instance,&#10;  [out] PIO_STATUS_BLOCK     Iosb,&#10;  [out] PVOID                FsInformation,&#10;  [in]  ULONG                Length,&#10;  [in]  FS_INFORMATION_CLASS FsInformationClass&#10;);">FltQueryVolumeInformation</a> or <a href="ntqueryvolumeinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryVolumeInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _Out_writes_bytes_(Length) PVOID FsInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FSINFOCLASS FsInformationClass&#10;    );">ZwQueryVolumeInformationFile</a> must be at least <strong>sizeof</strong> (FILE_FS_SECTOR_SIZE_INFORMATION).</p>
<p>The file system uses the value of <strong>LogicalBytesPerSector</strong> to determine the size of an allocation unit. The <strong>LogicalBytesPerSector</strong> member of this structure is equivalent to the <strong>BytesPerSector</strong> member of the <a href="file_fs_size_information" title="typedef struct _FILE_FS_SIZE_INFORMATION&#10;{&#10;    LARGE_INTEGER TotalAllocationUnits;&#10;    LARGE_INTEGER AvailableAllocationUnits;&#10;    ULONG SectorsPerAllocationUnit;&#10;    ULONG BytesPerSector;&#10;} FILE_FS_SIZE_INFORMATION, *PFILE_FS_SIZE_INFORMATION;">FILE_FS_SIZE_INFORMATION</a> and <a href="file_fs_full_size_information" title="typedef struct _FILE_FS_FULL_SIZE_INFORMATION&#10;{&#10;    LARGE_INTEGER TotalAllocationUnits;&#10;    LARGE_INTEGER CallerAvailableAllocationUnits;&#10;    LARGE_INTEGER ActualAvailableAllocationUnits;&#10;    ULONG SectorsPerAllocationUnit;&#10;    ULONG BytesPerSector;&#10;} FILE_FS_FULL_SIZE_INFORMATION, *PFILE_FS_FULL_SIZE_INFORMATION;">FILE_FS_FULL_SIZE_INFORMATION</a> structures.</p>
<p>If the system is unable to determine values for <strong>PhysicalBytesPerSectorForAtomicity</strong> and <strong>PhysicalBytesPerSectorForPerformance</strong> from the storage device, then they are set to the value of <strong>LogicalBytesPerSector.</strong></p>
<h2>See also</h2>
<p><a href="file_fs_full_size_information" title="typedef struct _FILE_FS_FULL_SIZE_INFORMATION&#10;{&#10;    LARGE_INTEGER TotalAllocationUnits;&#10;    LARGE_INTEGER CallerAvailableAllocationUnits;&#10;    LARGE_INTEGER ActualAvailableAllocationUnits;&#10;    ULONG SectorsPerAllocationUnit;&#10;    ULONG BytesPerSector;&#10;} FILE_FS_FULL_SIZE_INFORMATION, *PFILE_FS_FULL_SIZE_INFORMATION;">FILE_FS_FULL_SIZE_INFORMATION</a></p>
<p><a href="file_fs_size_information" title="typedef struct _FILE_FS_SIZE_INFORMATION&#10;{&#10;    LARGE_INTEGER TotalAllocationUnits;&#10;    LARGE_INTEGER AvailableAllocationUnits;&#10;    ULONG SectorsPerAllocationUnit;&#10;    ULONG BytesPerSector;&#10;} FILE_FS_SIZE_INFORMATION, *PFILE_FS_SIZE_INFORMATION;">FILE_FS_SIZE_INFORMATION</a></p>
<p><a href="fltqueryvolumeinformation" title="NTSTATUS FLTAPI FltQueryVolumeInformation(&#10;  [in]  PFLT_INSTANCE        Instance,&#10;  [out] PIO_STATUS_BLOCK     Iosb,&#10;  [out] PVOID                FsInformation,&#10;  [in]  ULONG                Length,&#10;  [in]  FS_INFORMATION_CLASS FsInformationClass&#10;);">FltQueryVolumeInformation</a></p>
<p><a href="fsrtlgetsectorsizeinformation" title="NTSTATUS FsRtlGetSectorSizeInformation(&#10;        PDEVICE_OBJECT                   DeviceObject,&#10;  [out] PFILE_FS_SECTOR_SIZE_INFORMATION SectorSizeInfo&#10;);">FsRtlGetSectorSizeInformation</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-query-volume-information">IRP_MJ_QUERY_VOLUME_INFORMATION</a></p>
<p><a href="ntqueryvolumeinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryVolumeInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _Out_writes_bytes_(Length) PVOID FsInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FSINFOCLASS FsInformationClass&#10;    );">ZwQueryVolumeInformationFile</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/ns-ntddk-_file_fs_sector_size_information">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddk/ns-ntddk-_file_fs_sector_size_information.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
