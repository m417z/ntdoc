<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKCB_LOG_ETW_EVENT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKCB_LOG_ETW_EVENT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKCB_LOG_ETW_EVENT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// dispmprt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKCB_LOG_ETW_EVENT DxgkcbLogEtwEvent;

VOID DxgkcbLogEtwEvent(
  [in] const LPCGUID EventGuid,
  [in] <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> Type,
  [in] <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a> EventBufferSize,
  [in] PVOID EventBuffer
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkcb_log_etw_event">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkcb_log_etw_event.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-dispmprt-dxgkcb_log_etw_event)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgkcb_log_etw_event-callback-function">DXGKCB_LOG_ETW_EVENT callback function</h1>

<h2 id="description">Description</h2>

<p>The <strong>DxgkCbLogEtwEvent</strong> function logs an Event Tracing for Windows (ETW) event.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="eventguid-in"><code>EventGuid</code> [in]</h3>

<p>A GUID that identifies the event to be logged.</p>

<h3 id="type-in"><code>Type</code> [in]</h3>

<p>A constant that specifies the event type. These constants are defined in <em>Evntrace.h</em> and have the form of <strong>EVENT_TRACE_TYPE_XX</strong>. <strong>Type</strong> is ignored when <strong>EventGuid</strong> is GUID_DXGKDDI_AZURE_TRIAGE_EVENT.</p>

<h3 id="eventbuffersize-in"><code>EventBufferSize</code> [in]</h3>

<p>The size, in bytes, of the buffer pointed to by <strong>EventBuffer</strong>. There is a significant performance penalty if the buffer is larger than 256 bytes.</p>

<h3 id="eventbuffer-in"><code>EventBuffer</code> [in]</h3>

<p>A pointer to a buffer that contains the information to be logged. This parameter can be NULL, or a pointer to the following structure type depending on the value of <strong>EventGuid</strong>.</p>

<h2 id="remarks">Remarks</h2>

<p>If event logging is not enabled, <strong>DxgkCbLogEtwEvent</strong> returns immediately without logging the event.</p>

<p>To enable or disable event logging, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_control_etw_logging"><strong>DxgkDdiControlEtwLogging</strong></a> function.</p>

<p>If <strong>EventBufferSize</strong> is less than or equal to 256, <strong>DxgkCbLogEtwEvent</strong> can be called an any IRQL. If <strong>EventBufferSize</strong> is greater than 256, <strong>DxgkCbLogEtwEvent</strong> must be called at IRQL = PASSIVE_LEVEL.</p>

<h3 id="example-logging-an-event-with-the-event-logger">Example: Logging an event with the event logger</h3>

<p>The following code example shows how to log an event with the event logger.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="c1">// {A7BF27A0-7401-4733-9FED-FDB51067FECC}</span>
<span class="n">DEFINE_GUID</span><span class="p">(</span><span class="n">R200_DUMMY_LOGGING</span><span class="p">,</span>
<span class="mh">0xa7bf27a0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7401</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4733</span><span class="p">,</span><span class="w"> </span><span class="mh">0x9f</span><span class="p">,</span><span class="w"> </span><span class="mh">0xed</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfd</span><span class="p">,</span><span class="w"> </span><span class="mh">0xb5</span><span class="p">,</span><span class="w"> </span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0x67</span><span class="p">,</span><span class="w"> </span><span class="mh">0xfe</span><span class="p">,</span><span class="w"> </span><span class="mh">0xcc</span><span class="p">);</span>

<span class="n">VOID</span>
<span class="nf">DummyTrace</span><span class="p">(</span>
<span class="w">    </span><span class="n">HW_DEVICE_EXTENSION</span><span class="o">*</span><span class="w"> </span><span class="n">Adapter</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Adapter</span><span class="o">-&gt;</span><span class="n">ddiCallback</span><span class="p">.</span><span class="n">DxgkCbLogEtwEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">R200_DUMMY_LOGGING</span><span class="p">,</span>
<span class="w">  </span><span class="n">EVENT_TRACE_TYPE_INFO</span><span class="p">,</span>
<span class="w">  </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="logging-azure-driver-events">Logging Azure driver events</h3>

<p>Starting in Windows Server 2022 (WDDM 2.9), a graphics driver's <strong>DxgkCbLogEtwEvent</strong> callback function can expose important events relevant to Azure triage and monitoring. As Azure adds vGPU offerings, it will become more important to have a mechanism to expose important events that the driver sees. Particularly important for monitoring and health is the exposure of function-level resets (VF TDRs) and whole-GPU resets (adapter-wide TDRs). In the future, this framework will allow the OS to expose additional important events that may involve driver-specific behaviors that have triage value when issues arrive.</p>

<p>A driver should use the following GUID to report specific Azure driver events:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">DEFINE_GUID</span><span class="p">(</span><span class="n">GUID_DXGKDDI_AZURE_TRIAGE_EVENT</span><span class="p">,</span>
<span class="mh">0x45125F6F</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6132</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4082</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="mh">0xED</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xDD</span><span class="p">,</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF9</span><span class="p">);</span>
</code></pre>
</div>

<p>These events are used by the graphics kernel components to feed triage information into standard Azure monitoring pipelines used for incident triage. They integrate with other graphics events also being exposed to build machine event histories and expose useful queries to be used in the monitoring of the health of the host and the VMs it supports.</p>

<p>When this GUID is used, <strong>EventBuffer</strong> points to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-dxgkddicb_partitioning_event_notification"><strong>DXGKARG_PARTITIONING_EVENT_NOTIFICATION</strong></a> structure.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-dxgkddicb_partitioning_event_notification"><strong>DXGKARG_PARTITIONING_EVENT_NOTIFICATION</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_control_etw_logging"><strong>DxgkDdiControlEtwLogging</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkcb_log_etw_event">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/dispmprt/nc-dispmprt-dxgkcb_log_etw_event.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
