<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlCreateUserThread - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlCreateUserThread - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlCreateUserThread - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTRTL_H

</span><span class="ntdoc-code-intro">/**
 * The RtlCreateUserThread routine creates a thread in the specified process.
 *
 * \param ProcessHandle Handle to the process in which the thread is to be created.
 * \param ThreadSecurityDescriptor Optional pointer to a security descriptor for the new thread. If NULL, the thread gets a default security descriptor.
 * \param CreateSuspended If TRUE, the thread is created in a suspended state and must be resumed explicitly. If FALSE, the thread starts running immediately.
 * \param ZeroBits Optional number of high-order address bits that must be zero in the stack&#x27;s base address. Usually set to 0.
 * \param MaximumStackSize Optional maximum size, in bytes, of the stack for the new thread. If 0, the default size is used.
 * \param CommittedStackSize Optional initial size, in bytes, of committed stack for the new thread. If 0, the default size is used.
 * \param StartAddress Pointer to the application-defined function to be executed by the thread.
 * \param Parameter Optional pointer to a variable to be passed to the thread function.
 * \param ThreadHandle Optional pointer to a variable that receives the handle of the new thread.
 * \param ClientId Optional pointer to a <a href="client_id" title="typedef struct _CLIENT_ID&#10;{&#10;    HANDLE UniqueProcess;&#10;    HANDLE UniqueThread;&#10;} CLIENT_ID, *PCLIENT_ID;">CLIENT_ID</a> structure that receives the thread and process identifiers.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 */
</span><span class="ntdoc-code-body">NTSYSAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
RtlCreateUserThread(
    _In_ HANDLE ProcessHandle,
    _In_opt_ PSECURITY_DESCRIPTOR ThreadSecurityDescriptor,
    _In_ BOOLEAN CreateSuspended,
    _In_opt_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ZeroBits,
    _In_opt_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> MaximumStackSize,
    _In_opt_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> CommittedStackSize,
    _In_ <a href="puser_thread_start_routine" title="typedef USER_THREAD_START_ROUTINE* PUSER_THREAD_START_ROUTINE;">PUSER_THREAD_START_ROUTINE</a> StartAddress,
    _In_opt_ PVOID Parameter,
    _Out_opt_ PHANDLE ThreadHandle,
    _Out_opt_ <a href="client_id" title="typedef struct _CLIENT_ID&#10;{&#10;    HANDLE UniqueProcess;&#10;    HANDLE UniqueThread;&#10;} CLIENT_ID, *PCLIENT_ID;">PCLIENT_ID</a> ClientId
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/66e9024965df1192a53aee9b345a8df8f08d8beb/phnt/include/ntrtl.h#L4060">View code on GitHub</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<p>Creates a new thread in the specified process.</p>

<h1 id="parameters">Parameters</h1>

<ul>
<li><code>ProcessHandle</code> - a handle to the process where the thread should be created. This can either be the <code><a href="ntcurrentprocess" title="#define NtCurrentProcess() ((HANDLE)(LONG_PTR)-1)">NtCurrentProcess</a></code> pseudo-handle or a handle with <code><a href="process_create_thread" title="#define PROCESS_CREATE_THREAD 0x0002">PROCESS_CREATE_THREAD</a></code> access.</li>
<li><code>ThreadSecurityDescriptor</code> - a security descriptor to protect the new thread with.</li>
<li><code>CreateSuspended</code> - whether the new thread should be created in a suspended state or allowed to run immediately. When specifying <code>TRUE</code>, you can use <code><a href="ntresumethread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtResumeThread(&#10;    _In_ HANDLE ThreadHandle,&#10;    _Out_opt_ PULONG PreviousSuspendCount&#10;    );">NtResumeThread</a></code> to resume the thread later.</li>
<li><code>ZeroBits</code> - the number of high-order address bits that must be zero in the base address of the thread's stack. Note that when the value is larger than 32, it becomes a bit mask.</li>
<li><code>MaximumStackSize</code> - the maximum size of the stack, in bytes. The system rounds this value up to the nearest page. If this parameter is zero, the new thread uses the default size for the executable.</li>
<li><code>CommittedStackSize</code> - the initial size of the stack, in bytes. The system rounds this value up to the nearest page. If this parameter is zero, the new thread uses the default size for the executable.</li>
<li><code>StartAddress</code> - the function to execute on the new thread.</li>
<li><code>Parameter</code> - a user-provided argument to pass to the thread start routine.</li>
<li><code>ThreadHandle</code> - an optional pointer to a variable that receives a handle to the new thread.</li>
<li><code>ClientId</code> - an optional pointer to a variable that receives the client ID of the new thread.</li>
</ul>

<h1 id="remarks">Remarks</h1>

<p>To avoid retaining unused resources, call <code><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">NtClose</a></code> to close the returned handle when it is no longer required.</p>

<h1 id="implementation-details">Implementation details</h1>

<p>This function is a wrapper over <code><a href="ntcreatethreadex" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateThreadEx(&#10;    _Out_ PHANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_ PUSER_THREAD_START_ROUTINE StartRoutine,&#10;    _In_opt_ PVOID Argument,&#10;    _In_ ULONG CreateFlags, // THREAD_CREATE_FLAGS_*&#10;    _In_ SIZE_T ZeroBits,&#10;    _In_ SIZE_T StackSize,&#10;    _In_ SIZE_T MaximumStackSize,&#10;    _In_opt_ PPS_ATTRIBUTE_LIST AttributeList&#10;    );">NtCreateThreadEx</a></code>.</p>

<h1 id="related-win32-api">Related Win32 API</h1>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethreadex"><code>CreateRemoteThreadEx</code></a></li>
</ul>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntcreatethreadex" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateThreadEx(&#10;    _Out_ PHANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_ PUSER_THREAD_START_ROUTINE StartRoutine,&#10;    _In_opt_ PVOID Argument,&#10;    _In_ ULONG CreateFlags, // THREAD_CREATE_FLAGS_*&#10;    _In_ SIZE_T ZeroBits,&#10;    _In_ SIZE_T StackSize,&#10;    _In_ SIZE_T MaximumStackSize,&#10;    _In_opt_ PPS_ATTRIBUTE_LIST AttributeList&#10;    );">NtCreateThreadEx</a></code></li>
<li><code><a href="ntcreatethread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateThread(&#10;    _Out_ PHANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Out_ PCLIENT_ID ClientId,&#10;    _In_ PCONTEXT ThreadContext,&#10;    _In_ PINITIAL_TEB InitialTeb,&#10;    _In_ BOOLEAN CreateSuspended&#10;    );">NtCreateThread</a></code></li>
<li><code><a href="ntresumethread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtResumeThread(&#10;    _In_ HANDLE ThreadHandle,&#10;    _Out_opt_ PULONG PreviousSuspendCount&#10;    );">NtResumeThread</a></code></li>
<li><code><a href="ntopenthread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenThread(&#10;    _Out_ PHANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PCLIENT_ID ClientId&#10;    );">NtOpenThread</a></code></li>
<li><code><a href="ntopenprocess" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenProcess(&#10;    _Out_ PHANDLE ProcessHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PCLIENT_ID ClientId&#10;    );">NtOpenProcess</a></code></li>
<li><code><a href="rtlcreateuserprocess" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlCreateUserProcess(&#10;    _In_ PCUNICODE_STRING NtImagePathName,&#10;    _In_ ULONG ExtendedParameters, // HIWORD(NumaNodeNumber), LOWORD(Reserved)&#10;    _In_ PRTL_USER_PROCESS_PARAMETERS ProcessParameters,&#10;    _In_opt_ PSECURITY_DESCRIPTOR ProcessSecurityDescriptor,&#10;    _In_opt_ PSECURITY_DESCRIPTOR ThreadSecurityDescriptor,&#10;    _In_opt_ HANDLE ParentProcess,&#10;    _In_ BOOLEAN InheritHandles,&#10;    _In_opt_ HANDLE DebugPort,&#10;    _In_opt_ HANDLE TokenHandle, // used to be ExceptionPort&#10;    _Out_ PRTL_USER_PROCESS_INFORMATION ProcessInformation&#10;    );">RtlCreateUserProcess</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlcreateuserthread.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<h3>StackZeroBits</h3>

<p>How many older bits must be clear while allocating thread stack. See <code><a href="initial_teb" title="typedef struct _INITIAL_TEB&#10;{&#10;    struct&#10;    {&#10;        PVOID OldStackBase;     // Pointer to the base address of the previous stack.&#10;        PVOID OldStackLimit;    // Pointer to the limit address of the previous stack.&#10;    } OldInitialTeb;&#10;    PVOID StackBase;            // Pointer to the base address of the new stack.&#10;    PVOID StackLimit;           // Pointer to the limit address of the new stack.&#10;    PVOID StackAllocationBase;  // Pointer to the base address where the stack was allocated.&#10;} INITIAL_TEB, *PINITIAL_TEB;">INITIAL_TEB</a></code>.</p>

<h3>StartAddress</h3>

<p>Thread start routine address.</p>

<h1>Documented by</h1>

<ul>
<li>ReactOS</li>
<li>Tomasz Nowak</li>
</ul>

<h1>See also</h1>

<ul>
<li><code><a href="initial_teb" title="typedef struct _INITIAL_TEB&#10;{&#10;    struct&#10;    {&#10;        PVOID OldStackBase;     // Pointer to the base address of the previous stack.&#10;        PVOID OldStackLimit;    // Pointer to the limit address of the previous stack.&#10;    } OldInitialTeb;&#10;    PVOID StackBase;            // Pointer to the base address of the new stack.&#10;    PVOID StackLimit;           // Pointer to the limit address of the new stack.&#10;    PVOID StackAllocationBase;  // Pointer to the base address where the stack was allocated.&#10;} INITIAL_TEB, *PINITIAL_TEB;">INITIAL_TEB</a></code></li>
<li><code><a href="ntcreatethread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateThread(&#10;    _Out_ PHANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Out_ PCLIENT_ID ClientId,&#10;    _In_ PCONTEXT ThreadContext,&#10;    _In_ PINITIAL_TEB InitialTeb,&#10;    _In_ BOOLEAN CreateSuspended&#10;    );">NtCreateThread</a></code></li>
<li><code><a href="ntterminatethread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtTerminateThread(&#10;    _In_opt_ HANDLE ThreadHandle,&#10;    _In_ NTSTATUS ExitStatus&#10;    );">NtTerminateThread</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/rtlcreateuserthread.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
