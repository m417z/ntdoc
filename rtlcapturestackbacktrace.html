<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlCaptureStackBackTrace - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlCaptureStackBackTrace - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlCaptureStackBackTrace - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTRTL_H

</span><span class="ntdoc-code-intro">/**
 * The RtlCaptureStackBackTrace routine captures a stack trace by walking the stack and recording the information for each frame.
 *
 * \param FramesToSkip Number of frames to skip from the start (current call point) of the back trace.
 * \param FramesToCapture Number of frames to be captured.
 * \param BackTrace Caller-allocated array in which pointers to the return addresses captured from the current stack trace are returned.
 * \param BackTraceHash Optional value that can be used to organize hash tables. This hash value is calculated based on the values of the pointers returned in the BackTrace array. Two identical stack traces will generate identical hash values.
 * \return The number of captured frames.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcapturestackbacktrace
 */
</span><span class="ntdoc-code-body">_Success_(return != 0)
NTSYSAPI
<a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>
NTAPI
RtlCaptureStackBackTrace(
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FramesToSkip,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FramesToCapture,
    _Out_writes_to_(FramesToCapture,return) PVOID* BackTrace,
    _Out_opt_ PULONG BackTraceHash
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/c7a74aeca340d1e3528acaa99b3405f36f41899f/phnt/include/ntrtl.h#L10812">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a> RtlCaptureStackBackTrace(
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  FramesToSkip,
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  FramesToCapture,
  [out]           PVOID  *BackTrace,
  [out, optional] PULONG BackTraceHash
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcapturestackbacktrace">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winnt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="word" title="typedef unsigned short WORD;">WORD</a> RtlCaptureStackBackTrace(
  [in]            <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>  FramesToSkip,
  [in]            <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>  FramesToCapture,
  [out]           PVOID  *BackTrace,
  [out, optional] PDWORD BackTraceHash
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/nf-winnt-rtlcapturestackbacktrace">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlcapturestackbacktrace.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-rtlcapturestackbacktrace)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rtlcapturestackbacktrace-function">RtlCaptureStackBackTrace function</h1>

<h2 id="description">Description</h2>

<p>The <strong>RtlCaptureStackBackTrace</strong> routine captures a stack trace by walking the stack and recording the information for each frame.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="framestoskip-in"><code>FramesToSkip</code> [in]</h3>

<p>Number of frames to skip from the start (current call point) of the back trace.</p>

<h3 id="framestocapture-in"><code>FramesToCapture</code> [in]</h3>

<p>Number of frames to be captured.</p>

<h3 id="backtrace-out"><code>BackTrace</code> [out]</h3>

<p>Caller-allocated array in which pointers to the return addresses captured from the current stack trace are returned.</p>

<h3 id="backtracehash-out-optional"><code>BackTraceHash</code> [out, optional]</h3>

<p>Optional value that can be used to organize hash tables. If this parameter is NULL, <strong>RtlCaptureStackBackTrace</strong> doesn't compute and return a hash value.</p>

<p>This hash value is calculated based on the values of the pointers returned in the <strong>BackTrace</strong> array. Two identical stack traces will generate identical hash values.</p>

<h2 id="return-value">Return value</h2>

<p>The number of captured frames.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>RtlCaptureStackBackTrace</strong> captures a stack trace for the caller by walking the stack (walking back in call time), and recording information for each frame. Specifically, <strong>RtlCaptureStackBackTrace</strong> returns pointers to the return addresses of each call on the stack, where the first pointer in the <strong>BackTrace</strong> array points to the return address of the most recent call, and so on.</p>

<p>Back trace hash values can be used to quickly determine whether two stack traces are identical or different. You can use the hash returned in <strong>BackTraceHash</strong> to compare stack traces. If you don't want to use hashes, or want to compute your own hash values, set <strong>BackTraceHash</strong> to NULL.</p>

<p>Typically, on 64-bit computers, you can't capture the kernel stack in certain contexts when page faults aren't allowed. To enable walking the kernel stack on x64, set the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc757875(v=ws.10)">DisablePagingExecutive</a> Memory Management registry value to 1. The DisablePagingExecutive registry value is located under the following registry key: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management. This should only be done for temporary diagnosis purposes because it increases memory usage of the system.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcapturestackbacktrace">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-rtlcapturestackbacktrace.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (nf-winnt-rtlcapturestackbacktrace)</h1>
</div>
<div class="ntdoc-description">
<h1>RtlCaptureStackBackTrace function</h1>

<h2>Description</h2>

<p>The <strong>RtlCaptureStackBackTrace</strong> routine captures a stack back trace by walking up the stack and recording the information for each frame.</p>

<h2>Parameters</h2>

<h3><code>FramesToSkip</code> [in]</h3>

<p>The number of frames to skip from the start of the back trace.</p>

<h3><code>FramesToCapture</code> [in]</h3>

<p>The number of frames to be captured.</p>

<h3><code>BackTrace</code> [out]</h3>

<p>An array of pointers captured from the current stack trace.</p>

<h3><code>BackTraceHash</code> [out, optional]</h3>

<p>An optional value that can be used to organize hash tables. If this parameter is <strong>NULL</strong>, no hash value is computed.</p>

<p>This value is calculated based on the values of the pointers returned in the <em>BackTrace</em> array. Two identical stack traces will generate identical hash values.</p>

<h2>Return value</h2>

<p>The number of captured frames.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/nf-winnt-rtlcapturestackbacktrace">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winnt/nf-winnt-rtlcapturestackbacktrace.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
