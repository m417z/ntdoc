<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KsPropertyHandlerWithAllocator - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KsPropertyHandlerWithAllocator - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KsPropertyHandlerWithAllocator - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">KSDDKAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> KsPropertyHandlerWithAllocator(
  [in]           PIRP                 Irp,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                PropertySetsCount,
  [in]           const <a href="ksproperty_set" title="typedef struct {&#10;  const GUID                *Set;&#10;  ULONG                     PropertiesCount;&#10;  const KSPROPERTY_ITEM     *PropertyItem;&#10;  ULONG                     FastIoCount;&#10;  const KSFASTPROPERTY_ITEM *FastIoTable;&#10;} KSPROPERTY_SET, *PKSPROPERTY_SET;">KSPROPERTY_SET</a> *PropertySet,
  [in, optional] PFNKSALLOCATOR       Allocator,
  [in, optional] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                PropertyItemSize
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-kspropertyhandlerwithallocator">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/kspropertyhandlerwithallocator.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ks-kspropertyhandlerwithallocator)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>KsPropertyHandlerWithAllocator</strong> performs the same handling as <a rel="noopener" target="_blank" href="kspropertyhandler">KsPropertyHandler</a>, with the same restrictions, but allows an optional allocator callback to be used to provide a buffer for the parameters. If used, the filter may need to free the buffer in some nonconventional manner. <a href="irp_buffered_io" title="#define IRP_BUFFERED_IO 0x00000010">IRP_BUFFERED_IO</a> and <a href="irp_deallocate_buffer" title="#define IRP_DEALLOCATE_BUFFER 0x00000020">IRP_DEALLOCATE_BUFFER</a> flags are not set when using a custom allocator.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="irp-in"><code>Irp</code> [in]</h3>

<p>Specifies the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> with the property request being handled.</p>

<h3 id="propertysetscount-in"><code>PropertySetsCount</code> [in]</h3>

<p>Specifies the number of property sets being passed.</p>

<h3 id="propertyset-in"><code>PropertySet</code> [in]</h3>

<p>Specifies the pointer to an array of property set information.</p>

<h3 id="allocator-in-optional"><code>Allocator</code> [in, optional]</h3>

<p>Optionally points to an allocation function used to allocate memory to store the property parameters.</p>

<h3 id="propertyitemsize-in-optional"><code>PropertyItemSize</code> [in, optional]</h3>

<p>Optionally contains the size of each <a href="ksproperty_item" title="typedef struct {&#10;  ULONG                   PropertyId;&#10;  union {&#10;    PFNKSHANDLER GetPropertyHandler;&#10;    BOOLEAN      GetSupported;&#10;  };&#10;  ULONG                   MinProperty;&#10;  ULONG                   MinData;&#10;  union {&#10;    PFNKSHANDLER SetPropertyHandler;&#10;    BOOLEAN      SetSupported;&#10;  };&#10;  const KSPROPERTY_VALUES *Values;&#10;  ULONG                   RelationsCount;&#10;  const KSPROPERTY        *Relations;&#10;  PFNKSHANDLER            SupportHandler;&#10;  ULONG                   SerializedSize;&#10;} KSPROPERTY_ITEM, *PKSPROPERTY_ITEM;">KSPROPERTY_ITEM</a> structure in the properties. The property item may be extended in order to store private information. If this parameter is zero, the structure size is assumed to be normal. If it is greater than or equal to a property item structure, the KSPROPERTY_ITEM_IRP_STORAGE macro can be used to return a pointer to the property item so the custom data can be retrieved. On 64-bit platforms, this parameter must be a multiple of 8.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong><a href="kspropertyhandler" title="KSDDKAPI NTSTATUS KsPropertyHandler(&#10;  [in] PIRP                 Irp,&#10;  [in] ULONG                PropertySetsCount,&#10;  [in] const KSPROPERTY_SET *PropertySet&#10;);">KsPropertyHandler</a></strong> function returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if successful, or an error specific to the property being handled if unsuccessful. The function sets the Irp->IoStatus.Information member, either through setting it to zero because of an internal error, or through a property handler setting it. The function does not set the lrp->IoStatus.Status member nor does it complete the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>.</p>

<p>On 64-bit platforms, if the <em>PropertyItemSize</em> parameter is not a multiple of 8, STATUS_INVALID_PARAMETER is returned, and the call fails.</p>

<h2 id="remarks">Remarks</h2>

<p><em>KsPropertyHandlerWithAllocator</em> places a pointer to the relevant <a href="ksproperty_item" title="typedef struct {&#10;  ULONG                   PropertyId;&#10;  union {&#10;    PFNKSHANDLER GetPropertyHandler;&#10;    BOOLEAN      GetSupported;&#10;  };&#10;  ULONG                   MinProperty;&#10;  ULONG                   MinData;&#10;  union {&#10;    PFNKSHANDLER SetPropertyHandler;&#10;    BOOLEAN      SetSupported;&#10;  };&#10;  const KSPROPERTY_VALUES *Values;&#10;  ULONG                   RelationsCount;&#10;  const KSPROPERTY        *Relations;&#10;  PFNKSHANDLER            SupportHandler;&#10;  ULONG                   SerializedSize;&#10;} KSPROPERTY_ITEM, *PKSPROPERTY_ITEM;">KSPROPERTY_ITEM</a> structure in the **Irp->Tail.Overlay.DriverContext** parameter in the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>. The minidriver can use the KSPROPERTY_ITEM_IRP_STORAGE macro, defined in <em>ks.h</em>, to access this pointer.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="ksfastpropertyhandler">KsFastPropertyHandler</a></p>

<p><a rel="noopener" target="_blank" href="kspropertyhandler">KsPropertyHandler</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-kspropertyhandlerwithallocator">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/nf-ks-kspropertyhandlerwithallocator.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
