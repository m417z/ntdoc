<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_SERIAL_PURGE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_SERIAL_PURGE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_SERIAL_PURGE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddser.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x001b, 0x013, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_SERIAL_PURGE 0x001B004C</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddser/ni-ntddser-ioctl_serial_purge">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_serial_purge.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ntddser-ioctl_serial_purge)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_serial_purge-ioctl">IOCTL_SERIAL_PURGE IOCTL</h1>

<h2 id="description">Description</h2>

<p>The <strong>IOCTL_SERIAL_PURGE</strong> request cancels the specified requests and deletes data from the specified buffers. The purge request can be used to cancel all read requests and write requests and to delete all data from the receive buffer and the transmit buffer.</p>

<p>The completion of the purge request does not indicate that the requests canceled by the purge request are completed. A client must verify that the purged requests are completed before the client frees or reuses the corresponding IRPs.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>The <strong>AssociatedIrp.SystemBuffer</strong> member points to a client-allocated <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> that is used to input a <em>purge mask</em>. The client sets the purge mask to a bitwise-OR of one or more of the following purge flags:</p>

<p>SERIAL_PURGE_RXABORT</p>

<p>Purges all read (<a href="irp_mj_read" title="#define IRP_MJ_READ 0x03">IRP_MJ_READ</a>) requests.</p>

<p>SERIAL_PURGE_RXCLEAR</p>

<p>Purges the receive buffer, if one exists.</p>

<p>SERIAL_PURGE_TXABORT</p>

<p>Purges all write (<a href="irp_mj_write" title="#define IRP_MJ_WRITE 0x04">IRP_MJ_WRITE</a>) requests.</p>

<p>SERIAL_PURGE_TXCLEAR</p>

<p>Purges the transmit buffer, if one exists.</p>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>The <strong>Parameters.DeviceIoControl.InputBufferLength</strong> member is set to the size, in bytes, of a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>None.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p>None.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p>If the request is successful, the <strong>Information</strong> member is set to the size, in bytes, of a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>. Otherwise, the <strong>Information</strong> member is set to zero.</p>

<p>The <strong>Status</strong> member is set to one of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/serports/serial-device-control-requests2">Generic Status Values for Serial Device Control Requests</a>. A status of STATUS_INVALID_PARAMETER indicates that the purge mask is not valid.</p>

<h2 id="-serial_purge_rxabort">-SERIAL_PURGE_RXABORT</h2>

<p>Purges all read (<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-read">IRP_MJ_READ</a>) requests.</p>

<h2 id="-serial_purge_rxclear">-SERIAL_PURGE_RXCLEAR</h2>

<p>Purges the receive buffer, if one exists.</p>

<h2 id="-serial_purge_txabort">-SERIAL_PURGE_TXABORT</h2>

<p>Purges all write (<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mj-write">IRP_MJ_WRITE</a>) requests.</p>

<h2 id="-serial_purge_txclear">-SERIAL_PURGE_TXCLEAR</h2>

<p>Purges the transmit buffer, if one exists.</p>

<h2 id="remarks">Remarks</h2>

<p>Serial.sys and SerCx allow an <strong>IOCTL_SERIAL_PURGE</strong> request to specify any combination of one or more SERIAL_PURGE_<em>XXX</em> flags. However, SerCx2 is more restrictive.</p>

<p>SerCx2 requires that all read requests be purged if the receive buffer is purged. Thus, if the SERIAL_PURGE_RXCLEAR flag is set in an <strong>IOCTL_SERIAL_PURGE</strong> request, then either the SerCx2 I/O request queue must not contain any read requests, or the SERIAL_PURGE_RXABORT flag must be set. Otherwise, the <strong>IOCTL_SERIAL_PURGE</strong> request fails with a STATUS_INVALID_DEVICE_STATE status code.</p>

<p>Similarly, SerCx2 requires that all write requests be purged if the transmit buffer is purged. Thus, if the SERIAL_PURGE_TXCLEAR flag is set in an <strong>IOCTL_SERIAL_PURGE</strong> request, then either the SerCx2 I/O request queue must not contain any write requests, or the SERIAL_PURGE_TXABORT flag must be set. Otherwise, the <strong>IOCTL_SERIAL_PURGE</strong> request fails with a STATUS_INVALID_DEVICE_STATE status code.</p>

<p>For more information about SerCx2, SerCx, and Serial.sys, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/jj241971(v=vs.85)">Serial Controller Drivers Overview</a>.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddser/ni-ntddser-ioctl_serial_purge">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddser/ni-ntddser-ioctl_serial_purge.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
