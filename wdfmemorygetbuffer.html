<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfMemoryGetBuffer - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfMemoryGetBuffer - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfMemoryGetBuffer - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfmemory.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PVOID WdfMemoryGetBuffer(
  [in]            WDFMEMORY Memory,
  [out, optional] <a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a>    *BufferSize
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfmemory/nf-wdfmemory-wdfmemorygetbuffer">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfmemorygetbuffer.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfmemory-wdfmemorygetbuffer)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="wdfmemorygetbuffer-function">WdfMemoryGetBuffer function</h1>

<h2 id="description">Description</h2>

<p>[Applies to KMDF and UMDF]</p>

<p>The <strong>WdfMemoryGetBuffer</strong> method returns a pointer to the buffer that is associated with a specified memory object.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="memory-in"><code>Memory</code> [in]</h3>

<p>A handle to a framework memory object.</p>

<h3 id="buffersize-out-optional"><code>BufferSize</code> [out, optional]</h3>

<p>A pointer to a location that receives the size, in bytes, of the memory buffer. This parameter is optional and can be <strong>NULL</strong>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>WdfMemoryGetBuffer</strong> returns a pointer to the memory buffer.</p>

<p>A bug check occurs if the driver supplies an invalid object handle.</p>

<h2 id="remarks">Remarks</h2>

<p>For more information about framework memory objects, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-memory-buffers">Using Memory Buffers</a>.</p>

<p><strong>WdfMemoryGetBuffer</strong> can be called at any IRQL.</p>

<h4 id="examples">Examples</h4>

<p>The following code example is based on the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfusb/nc-wdfusb-evt_wdf_usb_reader_completion_routine">EvtUsbTargetPipeReadComplete</a> callback function in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/samples/browse/?redirectedfrom=MSDN-samples">kmdf_fx2</a> sample driver. The example obtains the buffer that is associated with the memory object that the callback function receives. The example copies data from the buffer into device object context space that the driver has defined.</p>

<div class="codehilite">
<pre><span></span><code><span class="n">VOID</span>
<span class="nf">OsrFxEvtUsbInterruptPipeReadComplete</span><span class="p">(</span>
<span class="w">    </span><span class="n">WDFUSBPIPE</span><span class="w">  </span><span class="n">Pipe</span><span class="p">,</span>
<span class="w">    </span><span class="n">WDFMEMORY</span><span class="w">  </span><span class="n">Buffer</span><span class="p">,</span>
<span class="w">    </span><span class="kt"><a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a></span><span class="w">  </span><span class="n">NumBytesTransferred</span><span class="p">,</span>
<span class="w">    </span><span class="n">WDFCONTEXT</span><span class="w">  </span><span class="n">Context</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PUCHAR</span><span class="w">  </span><span class="n">switchState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">WDFDEVICE</span><span class="w">  </span><span class="n">device</span><span class="p">;</span>
<span class="w">    </span><span class="n">PDEVICE_CONTEXT</span><span class="w">  </span><span class="n">pDeviceContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Context</span><span class="p">;</span>

<span class="w">    </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="wdfobjectcontextgetobject" title="WDFOBJECT WdfObjectContextGetObject(&#10;  [in] PVOID ContextPointer&#10;);">WdfObjectContextGetObject</a></span><span class="p">(</span><span class="n">pDeviceContext</span><span class="p">);</span>
<span class="w">    </span><span class="n">switchState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WdfMemoryGetBuffer</span><span class="p">(</span><span class="n">Buffer</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="n">pDeviceContext</span><span class="o">-&gt;</span><span class="n">CurrentSwitchState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">switchState</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a href="wdfmemorycreate" title="NTSTATUS WdfMemoryCreate(&#10;  [in, optional]  PWDF_OBJECT_ATTRIBUTES Attributes,&#10;  [in]            POOL_TYPE              PoolType,&#10;  [in, optional]  ULONG                  PoolTag,&#10;  [in]            size_t                 BufferSize,&#10;  [out]           WDFMEMORY              *Memory,&#10;  [out, optional] PVOID                  *Buffer&#10;);">WdfMemoryCreate</a></p>

<p><a href="wdfmemorycreatepreallocated" title="NTSTATUS WdfMemoryCreatePreallocated(&#10;  [in, optional] PWDF_OBJECT_ATTRIBUTES Attributes,&#10;  [in]           __drv_aliasesMem PVOID Buffer,&#10;  [in]           size_t                 BufferSize,&#10;  [out]          WDFMEMORY              *Memory&#10;);">WdfMemoryCreatePreallocated</a></p>

<p><a href="wdfobjectcontextgetobject" title="WDFOBJECT WdfObjectContextGetObject(&#10;  [in] PVOID ContextPointer&#10;);">WdfObjectContextGetObject</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfmemory/nf-wdfmemory-wdfmemorygetbuffer">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfmemory/nf-wdfmemory-wdfmemorygetbuffer.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
