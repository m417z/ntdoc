<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlUTF8ToUnicodeN - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlUTF8ToUnicodeN - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlUTF8ToUnicodeN - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTRTL_H

</span><span class="ntdoc-code-intro">/**
 * The RtlUTF8ToUnicodeN routine translates the specified source string into a Unicode string, using the 8-bit Unicode Transformation Format (UTF-8) code page.
 *
 * \param UnicodeStringDestination Pointer to a caller-allocated buffer to receive the translated string.
 * \param UnicodeStringMaxByteCount Maximum number of bytes to be written at MultiByteString. If this value causes the translated string to be truncated, <a href="rtlupcaseunicodetomultibyten" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUpcaseUnicodeToMultiByteN(&#10;    _Out_writes_bytes_to_(MaxBytesInMultiByteString, *BytesInMultiByteString) PCHAR MultiByteString,&#10;    _In_ ULONG MaxBytesInMultiByteString,&#10;    _Out_opt_ PULONG BytesInMultiByteString,&#10;    _In_reads_bytes_(BytesInUnicodeString) PCWCH UnicodeString,&#10;    _In_ ULONG BytesInUnicodeString&#10;    );">RtlUpcaseUnicodeToMultiByteN</a> does not return an error status.
 * \param UnicodeStringActualByteCount Pointer to a caller-allocated variable that receives the length, in bytes, of the translated string. This parameter can be NULL.
 * \param UTF8StringSource Pointer to the Unicode source string to be translated.
 * \param UTF8StringByteCount Size, in bytes, of the string at UnicodeString.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows/win32/devnotes/rtlutf8tounicoden
 */
</span><span class="ntdoc-code-body">NTSYSAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
RtlUTF8ToUnicodeN(
    _Out_writes_bytes_to_(UnicodeStringMaxByteCount, *UnicodeStringActualByteCount) PWSTR UnicodeStringDestination,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UnicodeStringMaxByteCount,
    _Out_opt_ PULONG UnicodeStringActualByteCount,
    _In_reads_bytes_(UTF8StringByteCount) PCCH UTF8StringSource,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UTF8StringByteCount
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/78124af1f54187762af94ebc9aab9a9818a53adf/phnt/include/ntrtl.h#L2690">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RtlUTF8ToUnicodeN(
  [out, optional] PWSTR  UnicodeStringDestination,
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UnicodeStringMaxByteCount,
  [out]           PULONG UnicodeStringActualByteCount,
  [in]            PCCH   UTF8StringSource,
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UTF8StringByteCount
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlutf8tounicoden">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RtlUTF8ToUnicodeN(
  [out, optional] PWSTR  UnicodeStringDestination,
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UnicodeStringMaxByteCount,
  [out]           PULONG UnicodeStringActualByteCount,
  [in]            PCCH   UTF8StringSource,
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UTF8StringByteCount
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlutf8tounicoden">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> WINAPI RtlUTF8ToUnicodeN(
  _Out_     PWSTR  UnicodeStringDestination,
  _In_      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UnicodeStringMaxByteCount,
  _Out_opt_ PULONG UnicodeStringActualByteCount,
  _In_      PCCH   UTF8StringSource,
  _In_      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UTF8StringByteCount
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/rtlutf8tounicoden">View the official Win32 development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This function is documented in Windows Driver Kit <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlutf8tounicoden">here</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlutf8tounicoden">here</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlutf8tounicoden.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-rtlutf8tounicoden)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rtlutf8tounicoden-function-ntifsh">RtlUTF8ToUnicodeN function (ntifs.h)</h1>

<h2 id="description">Description</h2>

<p>The <strong>RtlUTF8ToUnicodeN</strong> routine converts a UTF-8 string to a Unicode string.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="unicodestringdestination-out-optional"><code>UnicodeStringDestination</code> [out, optional]</h3>

<p>A pointer to a caller-allocated destination buffer into which the routine writes the Unicode output string. If this parameter is <strong>NULL</strong>, the routine writes the required size of the output buffer to <em>*UnicodeStringActualByteCount</em>.</p>

<h3 id="unicodestringmaxbytecount-in"><code>UnicodeStringMaxByteCount</code> [in]</h3>

<p>Specifies the maximum number of bytes that the routine can write to the buffer that <em>UnicodeStringDestination</em> points to. If <em>UnicodeStringDestination</em> = <strong>NULL</strong>, set <em>UnicodeStringMaxByteCount</em> = 0.</p>

<h3 id="unicodestringactualbytecount-out"><code>UnicodeStringActualByteCount</code> [out]</h3>

<p>A pointer to a location into which the routine writes the actual number of bytes that the routine has written to the buffer that <em>UnicodeStringDestination</em> points to. If <em>UnicodeStringDestination</em> is non-<strong>NULL</strong>, this count never exceeds the value of <em>UnicodeStringMaxByteCount</em>. If <em>UnicodeStringDestination</em> is <strong>NULL</strong>, this count is the number of bytes that are required to contain the entire output string.</p>

<h3 id="utf8stringsource-in"><code>UTF8StringSource</code> [in]</h3>

<p>A pointer to the UTF-8 source string.</p>

<h3 id="utf8stringbytecount-in"><code>UTF8StringByteCount</code> [in]</h3>

<p>Specifies the number of bytes in the UTF-8 source string that the <em>UTF8StringSource</em> parameter points to.</p>

<h2 id="return-value">Return value</h2>

<p><strong>RtlUTF8ToUnicodeN</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful and all UTF-8 character codes in the input string were converted to the corresponding Unicode character codes in the output string. It returns STATUS_SOME_NOT_MAPPED if the call is successful but one or more input characters were invalid and were converted to the Unicode replacement character, U+FFFD. Possible error return values include the following error codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_BUFFER_TOO_SMALL</strong></td>
  <td>The <em>UnicodeStringMaxByteCount</em> parameter specifies a buffer size that is too small to contain the entire output string.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>The <em>UnicodeStringDestination</em> and <em>UnicodeStringActualByteCount</em> parameters are both <strong>NULL</strong>.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER_4</strong></td>
  <td>The <em>UTF8StringSource</em> parameter is <strong>NULL</strong>.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The Unicode output string is null-terminated only if the UTF-8 input string is null-terminated.</p>

<p>The routine returns STATUS_BUFFER_TOO_SMALL if the <em>UnicodeStringMaxByteCount</em> parameter specifies a buffer size that is too small to contain the entire output string. In this case, the routine writes as many Unicode characters as will fit in the buffer, and the <em>*UnicodeStringActualByteCount</em> value specifies the number of valid bytes that the routine has written to the buffer. The partial string that is contained in the output buffer might not include a terminating null character.</p>

<p>You can make an initial call to <strong>RtlUTF8ToUnicodeN</strong> to obtain the required output buffer size, and then call <strong>RtlUTF8ToUnicodeN</strong> again to obtain the Unicode output string. In the initial call, set <em>UnicodeStringDestination</em> = <strong>NULL</strong> and <em>UnicodeStringMaxByteCount</em> = 0, and the routine will write the required buffer size to <strong>UnicodeStringActualByteCount<em>. Next, allocate a buffer of the required size and call *</em>RtlUTF8ToUnicodeN</strong> a second time to obtain the Unicode output string.</p>

<p><strong>RtlUTF8ToUnicodeN</strong> supports Unicode surrogate pairs. However, a surrogate leading word value that is not followed by a trailing word value, or a trailing word value that is not preceded by a leading word value, is not recognized as a valid character and is replaced by the Unicode replacement character, U+FFFD.</p>

<p><strong>RtlUTF8ToUnicodeN</strong> continues to convert the input string to an output string until it reaches the end of the source buffer or the end of the destination buffer, whichever occurs first. The routine converts any null characters in the input string to null characters in the output string. If the input string contains a terminating null character, but the null character is not located at the end of the source buffer, the routine continues past the terminating null character until it reaches the end of the available buffer space.</p>

<p>The <a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a> routine converts a Unicode string to a UTF-8 string.</p>

<p>You can use the <strong>RtlUTF8ToUnicodeN</strong> and <strong><a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a></strong> routines to perform a lossless conversion of valid text strings between the UTF-8 and Unicode formats. However, strings that have arbitrary data values are likely to violate the Unicode rules for encoding surrogate pairs, and any information that is contained in the invalid values in an input string is lost and cannot be recovered from the resulting output string.</p>

<h2 id="see-also">See also</h2>

<p><a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlutf8tounicoden">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-rtlutf8tounicoden.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-rtlutf8tounicoden)</h1>
</div>
<div class="ntdoc-description">
<h1>RtlUTF8ToUnicodeN function (wdm.h)</h1>

<h2>Description</h2>

<p>The <strong>RtlUTF8ToUnicodeN</strong> routine converts a UTF-8 string to a Unicode string.</p>

<h2>Parameters</h2>

<h3><code>UnicodeStringDestination</code> [out, optional]</h3>

<p>A pointer to a caller-allocated destination buffer into which the routine writes the Unicode output string. If this parameter is <strong>NULL</strong>, the routine writes the required size of the output buffer to <em>*UnicodeStringActualByteCount</em>.</p>

<h3><code>UnicodeStringMaxByteCount</code> [in]</h3>

<p>Specifies the maximum number of bytes that the routine can write to the buffer that <em>UnicodeStringDestination</em> points to. If <em>UnicodeStringDestination</em> = <strong>NULL</strong>, set <em>UnicodeStringMaxByteCount</em> = 0.</p>

<h3><code>UnicodeStringActualByteCount</code> [out]</h3>

<p>A pointer to a location into which the routine writes the actual number of bytes that the routine has written to the buffer that <em>UnicodeStringDestination</em> points to. If <em>UnicodeStringDestination</em> is non-<strong>NULL</strong>, this count never exceeds the value of <em>UnicodeStringMaxByteCount</em>. If <em>UnicodeStringDestination</em> is <strong>NULL</strong>, this count is the number of bytes that are required to contain the entire output string.</p>

<h3><code>UTF8StringSource</code> [in]</h3>

<p>A pointer to the UTF-8 source string.</p>

<h3><code>UTF8StringByteCount</code> [in]</h3>

<p>Specifies the number of bytes in the UTF-8 source string that the <em>UTF8StringSource</em> parameter points to.</p>

<h2>Return value</h2>

<p><strong>RtlUTF8ToUnicodeN</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful and all UTF-8 character codes in the input string were converted to the corresponding Unicode character codes in the output string. It returns STATUS_SOME_NOT_MAPPED if the call is successful but one or more input characters were invalid and were converted to the Unicode replacement character, U+FFFD. Possible error return values include the following error codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_BUFFER_TOO_SMALL</strong></td>
  <td>The <em>UnicodeStringMaxByteCount</em> parameter specifies a buffer size that is too small to contain the entire output string.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>The <em>UnicodeStringDestination</em> and <em>UnicodeStringActualByteCount</em> parameters are both <strong>NULL</strong>.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER_4</strong></td>
  <td>The <em>UTF8StringSource</em> parameter is <strong>NULL</strong>.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>The Unicode output string is null-terminated only if the UTF-8 input string is null-terminated.</p>

<p>The routine returns STATUS_BUFFER_TOO_SMALL if the <em>UnicodeStringMaxByteCount</em> parameter specifies a buffer size that is too small to contain the entire output string. In this case, the routine writes as many Unicode characters as will fit in the buffer, and the <em>*UnicodeStringActualByteCount</em> value specifies the number of valid bytes that the routine has written to the buffer. The partial string that is contained in the output buffer might not include a terminating null character.</p>

<p>You can make an initial call to <strong>RtlUTF8ToUnicodeN</strong> to obtain the required output buffer size, and then call <strong>RtlUTF8ToUnicodeN</strong> again to obtain the Unicode output string. In the initial call, set <em>UnicodeStringDestination</em> = <strong>NULL</strong> and <em>UnicodeStringMaxByteCount</em> = 0, and the routine will write the required buffer size to <strong>UnicodeStringActualByteCount<em>. Next, allocate a buffer of the required size and call *</em>RtlUTF8ToUnicodeN</strong> a second time to obtain the Unicode output string.</p>

<p><strong>RtlUTF8ToUnicodeN</strong> supports Unicode surrogate pairs. However, a surrogate leading word value that is not followed by a trailing word value, or a trailing word value that is not preceded by a leading word value, is not recognized as a valid character and is replaced by the Unicode replacement character, U+FFFD.</p>

<p><strong>RtlUTF8ToUnicodeN</strong> continues to convert the input string to an output string until it reaches the end of the source buffer or the end of the destination buffer, whichever occurs first. The routine converts any null characters in the input string to null characters in the output string. If the input string contains a terminating null character, but the null character is not located at the end of the source buffer, the routine continues past the terminating null character until it reaches the end of the available buffer space.</p>

<p>The <a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a> routine converts a Unicode string to a UTF-8 string.</p>

<p>You can use the <strong>RtlUTF8ToUnicode</strong> and <strong><a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a></strong> routines to perform a lossless conversion of valid text strings between the UTF-8 and Unicode formats. However, strings that have arbitrary data values are likely to violate the Unicode rules for encoding surrogate pairs, and any information that is contained in the invalid values in an input string is lost and cannot be recovered from the resulting output string.</p>

<h2>See also</h2>

<p><a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlutf8tounicoden">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-rtlutf8tounicoden.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 development documentation (rtlutf8tounicoden)</h1>
</div>
<div class="ntdoc-description">
<h1>RtlUTF8ToUnicodeN function</h1>

<p>Translates the specified source string into a Unicode string, using the 8-bit Unicode Transformation Format (UTF-8) code page.</p>

<h2>Parameters</h2>

<p><em>UnicodeStringDestination</em> [out]</p>

<p>A pointer to a caller-allocated buffer that receives the translated string.</p>

<p><em>UnicodeStringMaxByteCount</em> [in]</p>

<p>Maximum number of bytes to be written at <em>UnicodeStringDestination</em>. If this value causes the translated string to be truncated, <strong>RtlUTF8ToUnicodeN</strong> returns an error status.</p>

<p><em>UnicodeStringActualByteCount</em> [out, optional]</p>

<p>A pointer to a caller-allocated variable that receives the length, in bytes, of the translated string. This parameter is optional and can be <strong>NULL</strong>. If the string is truncated then the returned number counts the actual truncated string count.</p>

<p><em>UTF8StringSource</em> [in]</p>

<p>A pointer to the string to be translated.</p>

<p><em>UTF8StringByteCount</em> [in]</p>

<p>Size, in bytes, of the string at <em>UTF8StringSource</em>.</p>

<h2>Return value</h2>

<p><strong>RtlUTF8ToUnicodeN</strong> returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The string was converted to Unicode.<br></td>
</tr>
<tr>
  <td><strong>STATUS_SOME_NOT_MAPPED</strong></td>
  <td>An invalid input character was encountered and replaced. This status is considered a success status.<br></td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>Both pointers to <em>UnicodeStringDestination</em> and <em>UnicodeStringActualByteCount</em> were <strong>NULL</strong>.<br></td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER_4</strong></td>
  <td>The <em>UTF8StringSource</em> was <strong>NULL</strong>.<br></td>
</tr>
<tr>
  <td><strong>STATUS_BUFFER_TOO_SMALL</strong></td>
  <td><em>UnicodeStringDestination</em> was truncated.<br></td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>Although <em>UnicodeStringActualByteCount</em> is optional and can be <strong>NULL</strong>, callers should provide storage for it, because the received length can be used to determine whether the conversion was successful.</p>

<p>If the output is truncated and an invalid input character is encountered then the function returns STATUS_BUFFER_TOO_SMALL error.</p>

<p>If the <em>UnicodeStringDestination</em> is set to <strong>NULL</strong> the function will return the required number of bytes to host the translated string without any truncation in <em>UnicodeStringActualByteCount</em>.</p>

<p><strong>RtlUTF8ToUnicodeN</strong> does not modify the source string unless the <em>UnicodeStringDestination</em> and <em>UTF8StringSource</em> pointers are equivalent. The returned Unicode string is not null-terminated.</p>

<p>Callers of <strong>RtlUTF8ToUnicodeN</strong> must be running at IRQL &lt; DISPATCH_LEVEL.</p>

<h2>Requirements</h2>

<table>
<thead>
<tr>
  <th>Requirement</th>
  <th>Value</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Minimum supported client<br></td>
  <td>Windows 7 [desktop apps only]<br></td>
</tr>
<tr>
  <td>Minimum supported server<br></td>
  <td>Windows Server 2008 R2 [desktop apps only]<br></td>
</tr>
<tr>
  <td>Header<br></td>
  <td>Wdm.h</td>
</tr>
<tr>
  <td>DLL<br></td>
  <td>Ntdll.dll</td>
</tr>
</tbody>
</table>

<h2>See also</h2>

<p><strong><a href="rtlunicodetoutf8n" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeToUTF8N(&#10;    _Out_writes_bytes_to_(UTF8StringMaxByteCount, *UTF8StringActualByteCount) PCHAR UTF8StringDestination,&#10;    _In_ ULONG UTF8StringMaxByteCount,&#10;    _Out_opt_ PULONG UTF8StringActualByteCount,&#10;    _In_reads_bytes_(UnicodeStringByteCount) PCWCH UnicodeStringSource,&#10;    _In_ ULONG UnicodeStringByteCount&#10;    );">RtlUnicodeToUTF8N</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/rtlutf8tounicoden">View the official Win32 development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/win32/blob/docs/desktop-src/DevNotes/rtlutf8tounicoden.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
