<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PROTOCOL_NET_PNP_EVENT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PROTOCOL_NET_PNP_EVENT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PROTOCOL_NET_PNP_EVENT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PROTOCOL_NET_PNP_EVENT ProtocolNetPnpEvent;

NDIS_STATUS ProtocolNetPnpEvent(
  [in] NDIS_HANDLE ProtocolBindingContext,
  [in] <a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">PNET_PNP_EVENT_NOTIFICATION</a> NetPnPEventNotification
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/protocol_net_pnp_event.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-protocol_net_pnp_event)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="protocol_net_pnp_event-callback-function">PROTOCOL_NET_PNP_EVENT callback function</h1>

<h2 id="description">Description</h2>

<p>NDIS calls the
<em>ProtocolNetPnPEvent</em> function to indicate a network Plug and Play event, an NDIS
PnP event, or a power management event to a protocol driver.</p>

<p><strong>Note</strong> You must declare the function by using the <strong>PROTOCOL_NET_PNP_EVENT</strong> type. For more
information, see the following Examples section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="protocolbindingcontext-in"><code>ProtocolBindingContext</code> [in]</h3>

<p>The handle to a protocol-driver-allocated context area in which this driver maintains per-binding
run-time state information. The protocol driver supplied this handle when it called the
<a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a> function. A
<strong>NetEvent</strong><em>Xxx</em> event that is indicated with a <strong>NULL</strong><em>ProtocolBindingContext</em> applies to all bindings.
<strong>NetEventBindList</strong> and
<strong>NetEventBindsComplete</strong> are always indicated with a <strong>NULL</strong><em>ProtocolBindingContext</em>.
<strong>NetEventReconfigure</strong> can be indicated with a specified
<em>ProtocolBindingContext</em> or with a <strong>NULL</strong><em>ProtocolBindingContext</em>.</p>

<h3 id="netpnpeventnotification-in"><code>NetPnPEventNotification</code> [in]</h3>

<p>A pointer to a
<a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">NET_PNP_EVENT_NOTIFICATION</a> structure which describes the Plug and Play event or Power Management
event that NDIS is indicating to the protocol driver.</p>

<h2 id="return-value">Return value</h2>

<p><em>ProtocolNetPnPEvent</em> can return any of the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NDIS_STATUS_SUCCESS</strong></td>
  <td>The protocol driver successfully handled the indicated network Plug and Play event, NDIS PnP event, or power management event. The meaning of this status code depends on the <strong>NetEvent</strong> code in the buffered <a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">NET_PNP_EVENT_NOTIFICATION</a> structure at <em>NetPnPEvent</em>:<br><br><strong>NetEventSetPower</strong><br><br>The protocol driver has performed any driver-specific actions that are required to prepare for the device's transition to the requested device power state.<br><br><strong>NetEventQueryPower</strong><br><br>The underlying adapter can transition to the requested device power state.<br><br><strong>NetEventQueryRemoveDevice</strong><br><br>The underlying adapter can be removed.<br><br><strong>NetEventCancelRemoveDevice</strong><br><br>The protocol driver has performed any driver-specific actions that are required to prepare for the canceled removal of the underlying adapter.<br><br><strong>NetEventReconfigure</strong><br><br>The protocol driver has accepted the changed configuration.<br><br><strong>NetEventBindList</strong><br><br>The protocol driver has the new bind list and has performed related processing.<br><br><strong>NetEventBindsComplete</strong><br><br>The protocol driver has acknowledged the indication from NDIS that the protocol driver is bound to all available underlying adapters.<br><br><strong>NetEventPnPCapabilities</strong><br><br>The protocol driver has acknowledged that it has received the current wake-up capabilities of the underlying adapter that is associated with the specified binding.<br><br><strong>NetEventPause</strong><br><br>The specified protocol binding has entered the <em>Pausing</em> state. The binding will enter the <em>Paused</em> state after NDIS has completed all of the outstanding send requests for the binding. For more information about pause operations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/pausing-a-binding">Pausing a Binding</a>.<br><br><strong>NetEventRestart</strong><br><br>The specified protocol binding has entered the <em>Restarting</em> state. After the protocol driver is ready to resume send and receive operations for the binding, the binding enters the <em>Running</em> state.<br><br><strong>NetEventPortActivation</strong><br><br>The protocol driver has acknowledged the activation of a port that is associated with the specified binding. For more information about port activation, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/activating-an-ndis-port">Activating an NDIS Port</a>.<br><br><strong>NetEventPortDeactivation</strong><br><br>The protocol driver has acknowledged the activation of a port that is associated with the specified binding.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_PENDING</strong></td>
  <td>The protocol driver will return its response to the indicated event asynchronously with a call to the <a href="ndiscompletenetpnpevent" title="VOID NdisCompleteNetPnPEvent(&#10;  [in] NDIS_HANDLE                 NdisBindingHandle,&#10;       PNET_PNP_EVENT_NOTIFICATION NetPnPEventNotification,&#10;  [in] NDIS_STATUS                 Status&#10;);">NdisCompleteNetPnPEvent</a> function.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_RESOURCES</strong></td>
  <td>The protocol driver could not obtain the necessary system resources to satisfy the indicated Plug and Play or Power Management event.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_NOT_SUPPORTED</strong></td>
  <td>NDIS 6.0 and later protocol drivers must not return this status. An NDIS 5.<em>x</em> protocol driver that does not support Plug and Play can return this status in response to a <strong>NetEventSetPower</strong> to indicate that NDIS should unbind it from the underlying adapter.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_FAILURE</strong></td>
  <td>The protocol driver failed the indicated event for reasons other than those stated in the preceding list.</td>
</tr>
</tbody>
</table>

<p>A protocol driver can fail the
<strong>NetEventQueryRemoveDevice</strong>
and
<strong>NetEventPortActivation</strong> events.</p>

<p>If a protocol driver fails the
<strong>NetEventPortActivation</strong> event, it should not use any associated ports in
subsequent operations.</p>

<p>A protocol driver should always succeed the
<strong>NetEventRestart</strong>, <strong>NetEventIMReEnableDevice</strong>,
<strong>NetEventCancelRemoveDevice</strong>,
<strong>NetEventReconfigure</strong>,
<strong>NetEventBindList</strong>,
<strong>NetEventBindsComplete</strong>,
<strong>NetEventPause</strong>, <strong>NetEventPortDeactivation</strong>, and
<strong>NetEventPnPCapabilities</strong> events by returning NDIS_STATUS_SUCCESS.</p>

<h2 id="remarks">Remarks</h2>

<p>The
<em>ProtocolNetPnPEvent</em> function is required in protocol drivers to support Plug
and Play and Power Management. NDIS calls
<em>ProtocolNetPnPEvent</em> to notify a protocol driver that a network Plug and Play
event, an NDIS PnP event, or Power Management event has occurred.</p>

<p>The
<a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">NET_PNP_EVENT_NOTIFICATION</a> structure that is passed to
<em>ProtocolNetPnPEvent</em> describes the event.
<em>ProtocolNetPnPEvent</em> interprets two basic pieces of information in the
<a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">NET_PNP_EVENT_NOTIFICATION</a> structure:</p>

<ul>
<li>A code in the
<strong>NetEvent</strong> member that identifies the type of Plug and Play or Power
Management event.</li>
<li>Event-specific information. For example, with a
<strong>NetEventSetPower</strong> event the
<strong>Buffer</strong> member contains the device power state to which the device is
transitioning.</li>
</ul>

<p>The protocol driver should save the
<em>NetPnPEvent</em> pointer. This pointer is a required input parameter to the
<a href="ndiscompletenetpnpevent" title="VOID NdisCompleteNetPnPEvent(&#10;  [in] NDIS_HANDLE                 NdisBindingHandle,&#10;       PNET_PNP_EVENT_NOTIFICATION NetPnPEventNotification,&#10;  [in] NDIS_STATUS                 Status&#10;);">NdisCompleteNetPnPEvent</a> function,
which the protocol driver must subsequently call if
<em>ProtocolNetPnPEvent</em> returns NDIS_STATUS_PENDING.</p>

<p>A protocol driver should always succeed a
<strong>NetEventQueryPower</strong> event. After establishing an active connection, a
protocol driver can call the
<a href="poregistersystemstate" title="PVOID PoRegisterSystemState(&#10;  [in, out] PVOID           StateHandle,&#10;  [in]      EXECUTION_STATE Flags&#10;);">PoRegisterSystemState</a> function to
register a continuously busy state. As long as the state registration is in effect, the power manager
does not attempt to put the system to sleep. After the connection becomes inactive, the protocol driver
cancels the state registration by calling the
<a href="pounregistersystemstate" title="VOID PoUnregisterSystemState(&#10;  [in, out] PVOID StateHandle&#10;);">PoUnregisterSystemState</a> function. A
protocol driver should never try to prevent the system from transitioning to the sleeping state by
failing a
<strong>NetEventQueryPower</strong> event. Note that a
<strong>NetEventQueryPower</strong> event is always followed by a
<strong>NetEventSetPower</strong> event. A
<strong>NetEventSetPower</strong> event that specifies the underlying device's current power
state in effect cancels the
<strong>NetEventQueryPower</strong> event.</p>

<p>If a protocol driver cannot release a device (for example, because the device is in use) it must fail
a
<strong>NetEventQueryRemoveDevice</strong> event by returning NDIS_STATUS_FAILURE.</p>

<p>A protocol driver should always succeed a
<strong>NetEventCancelRemoveDevice</strong>, a
<strong>NetEventReconfigure</strong>,
<strong>NetEventBindList, NetEventBindsComplete</strong>,
<strong>NetEventPnPCapabilities</strong>,
<strong>NetEventPause</strong>, or
<strong>NetEventPortDeactivation</strong> by returning NDIS_STATUS_SUCCESS.</p>

<p>When handling a
<strong>NetEventReconfigure</strong> or a
<strong>NetEventBindList</strong>, a protocol driver should validate the data associated
with the event. For more information about such data, see
<a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">NET_PNP_EVENT_NOTIFICATION</a>.</p>

<p>NDIS calls
<em>ProtocolNetPnPEvent</em> at IRQL = PASSIVE_LEVEL.</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>ProtocolNetPnPEvent</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>ProtocolNetPnPEvent</em> function that is named "MyNetPnPEvent", use the <strong>PROTOCOL_NET_PNP_EVENT</strong> type as shown in this code example:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>PROTOCOL_NET_PNP_EVENT MyNetPnPEvent;
</code></pre>

<p>Then, implement your function as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>_Use_decl_annotations_
NDIS_STATUS
 MyNetPnPEvent(
    NDIS_HANDLE  ProtocolBindingContext,
    <a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">PNET_PNP_EVENT_NOTIFICATION</a>  NetPnPEvent
    )
  {...}
</code></pre>

<p>The <strong>PROTOCOL_NET_PNP_EVENT</strong> function type is defined in the Ndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the _Use_decl_annotations_ annotation to your function definition. The _Use_decl_annotations_ annotation ensures that the annotations that are applied to the <strong>PROTOCOL_NET_PNP_EVENT</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about _Use_decl_annotations_, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="net_pnp_event_notification" title="typedef struct _NET_PNP_EVENT_NOTIFICATION {&#10;  NDIS_OBJECT_HEADER       Header;&#10;  NDIS_PORT_NUMBER         PortNumber;&#10;  NET_PNP_EVENT            NetPnPEvent;&#10;  ULONG                    Flags;&#10;  NDIS_NIC_SWITCH_ID       SwitchId;&#10;  NDIS_NIC_SWITCH_VPORT_ID VPortId;&#10;} NET_PNP_EVENT_NOTIFICATION, *PNET_PNP_EVENT_NOTIFICATION;">NET_PNP_EVENT_NOTIFICATION</a></p>

<p><a href="ndiscompletenetpnpevent" title="VOID NdisCompleteNetPnPEvent(&#10;  [in] NDIS_HANDLE                 NdisBindingHandle,&#10;       PNET_PNP_EVENT_NOTIFICATION NetPnPEventNotification,&#10;  [in] NDIS_STATUS                 Status&#10;);">NdisCompleteNetPnPEvent</a></p>

<p><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></p>

<p><a href="poregistersystemstate" title="PVOID PoRegisterSystemState(&#10;  [in, out] PVOID           StateHandle,&#10;  [in]      EXECUTION_STATE Flags&#10;);">PoRegisterSystemState</a></p>

<p><a href="pounregistersystemstate" title="VOID PoUnregisterSystemState(&#10;  [in, out] PVOID StateHandle&#10;);">PoUnregisterSystemState</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-protocol_net_pnp_event.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
