<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IoCreateDriverProxyExtension - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IoCreateDriverProxyExtension - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IoCreateDriverProxyExtension - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoCreateDriverProxyExtension(
  <a href="driver_object" title="typedef struct _DRIVER_OBJECT {&#10;  CSHORT             Type;&#10;  CSHORT             Size;&#10;  PDEVICE_OBJECT     DeviceObject;&#10;  ULONG              Flags;&#10;  PVOID              DriverStart;&#10;  ULONG              DriverSize;&#10;  PVOID              DriverSection;&#10;  PDRIVER_EXTENSION  DriverExtension;&#10;  UNICODE_STRING     DriverName;&#10;  PUNICODE_STRING    HardwareDatabase;&#10;  PFAST_IO_DISPATCH  FastIoDispatch;&#10;  PDRIVER_INITIALIZE DriverInit;&#10;  PDRIVER_STARTIO    DriverStartIo;&#10;  PDRIVER_UNLOAD     DriverUnload;&#10;  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + 1];&#10;} DRIVER_OBJECT, *PDRIVER_OBJECT;">PDRIVER_OBJECT</a>                        OwningDriverObject,
  <a href="driver_proxy_extension_creation_flags" title="typedef union _DRIVER_PROXY_EXTENSION_CREATION_FLAGS {&#10;  ULONG  AsUlong;&#10;  struct {&#10;    ULONG ReservedZero : 32;&#10;  };&#10;} DRIVER_PROXY_EXTENSION_CREATION_FLAGS, *PDRIVER_PROXY_EXTENSION_CREATION_FLAGS;">DRIVER_PROXY_EXTENSION_CREATION_FLAGS</a> Flags,
  PDRIVER_PROXY_EXTENSION               *DriverProxyExtension
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-iocreatedriverproxyextension">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/iocreatedriverproxyextension.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-iocreatedriverproxyextension)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>IoCreateDriverProxyExtension</strong> function allocates and initializes a DriverProxy extension that enables hot-swappable driver functionality.</p>
<h2>Parameters</h2>
<h3><code>OwningDriverObject</code></h3>
<p>[in, optional] An optional pointer to the <strong><a href="driver_object" title="typedef struct _DRIVER_OBJECT {&#10;  CSHORT             Type;&#10;  CSHORT             Size;&#10;  PDEVICE_OBJECT     DeviceObject;&#10;  ULONG              Flags;&#10;  PVOID              DriverStart;&#10;  ULONG              DriverSize;&#10;  PVOID              DriverSection;&#10;  PDRIVER_EXTENSION  DriverExtension;&#10;  UNICODE_STRING     DriverName;&#10;  PUNICODE_STRING    HardwareDatabase;&#10;  PFAST_IO_DISPATCH  FastIoDispatch;&#10;  PDRIVER_INITIALIZE DriverInit;&#10;  PDRIVER_STARTIO    DriverStartIo;&#10;  PDRIVER_UNLOAD     DriverUnload;&#10;  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + 1];&#10;} DRIVER_OBJECT, *PDRIVER_OBJECT;">DRIVER_OBJECT</a></strong> that will own the DriverProxy extension. If provided, the extension will be associated with this driver object. If NULL, the extension is created without an owning driver.</p>
<h3><code>Flags</code></h3>
<p>[in] A <strong><a href="driver_proxy_extension_creation_flags" title="typedef union _DRIVER_PROXY_EXTENSION_CREATION_FLAGS {&#10;  ULONG  AsUlong;&#10;  struct {&#10;    ULONG ReservedZero : 32;&#10;  };&#10;} DRIVER_PROXY_EXTENSION_CREATION_FLAGS, *PDRIVER_PROXY_EXTENSION_CREATION_FLAGS;">DRIVER_PROXY_EXTENSION_CREATION_FLAGS</a></strong> value that provides additional configuration options for extension creation. Currently, no flags are defined, so this parameter should be set to 0.</p>
<h3><code>DriverProxyExtension</code></h3>
<p>[out] A pointer to a variable that receives a pointer to the newly created DriverProxy extension. This extension can be used with other DriverProxy APIs.</p>
<h2>Return value</h2>
<p><strong>IoCreateDriverProxyExtension</strong> returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
<td>The extension was successfully allocated and initialized.</td>
</tr>
<tr>
<td><strong>STATUS_NOT_SUPPORTED</strong></td>
<td>The current system does not support DriverProxy extensions.</td>
</tr>
<tr>
<td><strong>STATUS_DRIVER_BLOCKED</strong></td>
<td>The specified driver is excluded from DriverProxy operations via registry settings.</td>
</tr>
<tr>
<td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
<td>Insufficient memory was available to allocate the extension.</td>
</tr>
<tr>
<td><strong>STATUS_RESOURCE_IN_USE</strong></td>
<td>The specified driver object already owns a DriverProxy extension.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>A DriverProxy extension is required for any driver that wants to use Driver Hot-Swap functionality. The extension serves as an opaque token that holds all relevant DriverProxy information and enables hot-swappable operations.</p>
<p>Drivers using Driver Hot-Swap should create a DriverProxy extension during <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/writing-a-driverentry-routine"><strong>DriverEntry</strong></a>, preferably early in the function. It is recommended to store the result in a global variable for easy access throughout the driver's lifetime.</p>
<p>Before calling <strong>IoCreateDriverProxyExtension</strong>, drivers should call <strong><a href="iogetdriverproxyfeatures" title="VOID IoGetDriverProxyFeatures(&#10;  PDRIVER_OBJECT              DriverObject,&#10;  PDRIVER_PROXY_FEATURE_FLAGS Flags&#10;);">IoGetDriverProxyFeatures</a></strong> to verify that DriverProxy functionality is available and enabled.</p>
<p>Each driver object can own at most one DriverProxy extension. If a driver object already has an associated extension, the function returns <strong>STATUS_RESOURCE_IN_USE</strong>.</p>
<p>In Driver Hot-Swap V2, once the extension is successfully created, endpoint wrappers are automatically available without requiring explicit registration calls. The compiler and linker automatically generate the endpoint information during the build process.</p>
<p>The system automatically manages the lifecycle of the DriverProxy extension. When the owning driver object is unloaded, the extension is automatically cleaned up.</p>
<h2>See also</h2>
<p><strong><a href="iogetdriverproxyfeatures" title="VOID IoGetDriverProxyFeatures(&#10;  PDRIVER_OBJECT              DriverObject,&#10;  PDRIVER_PROXY_FEATURE_FLAGS Flags&#10;);">IoGetDriverProxyFeatures</a></strong></p>
<p><strong><a href="iogetdriverproxywrapperfromendpoint" title="void IoGetDriverProxyWrapperFromEndpoint(&#10;  DriverProxyExtension,&#10;  Endpoint,&#10;  Wrapper&#10;);">IoGetDriverProxyWrapperFromEndpoint</a></strong></p>
<p><strong><a href="iogetdriverproxyextensionfromdriverobject" title="PDRIVER_PROXY_EXTENSION IoGetDriverProxyExtensionFromDriverObject(&#10;  PDRIVER_OBJECT DriverObject&#10;);">IoGetDriverProxyExtensionFromDriverObject</a></strong></p>
<p><strong><a href="driver_proxy_extension_creation_flags" title="typedef union _DRIVER_PROXY_EXTENSION_CREATION_FLAGS {&#10;  ULONG  AsUlong;&#10;  struct {&#10;    ULONG ReservedZero : 32;&#10;  };&#10;} DRIVER_PROXY_EXTENSION_CREATION_FLAGS, *PDRIVER_PROXY_EXTENSION_CREATION_FLAGS;">DRIVER_PROXY_EXTENSION_CREATION_FLAGS</a></strong></p>
<p><strong><a href="driver_object" title="typedef struct _DRIVER_OBJECT {&#10;  CSHORT             Type;&#10;  CSHORT             Size;&#10;  PDEVICE_OBJECT     DeviceObject;&#10;  ULONG              Flags;&#10;  PVOID              DriverStart;&#10;  ULONG              DriverSize;&#10;  PVOID              DriverSection;&#10;  PDRIVER_EXTENSION  DriverExtension;&#10;  UNICODE_STRING     DriverName;&#10;  PUNICODE_STRING    HardwareDatabase;&#10;  PFAST_IO_DISPATCH  FastIoDispatch;&#10;  PDRIVER_INITIALIZE DriverInit;&#10;  PDRIVER_STARTIO    DriverStartIo;&#10;  PDRIVER_UNLOAD     DriverUnload;&#10;  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + 1];&#10;} DRIVER_OBJECT, *PDRIVER_OBJECT;">DRIVER_OBJECT</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-iocreatedriverproxyextension">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-iocreatedriverproxyextension.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
