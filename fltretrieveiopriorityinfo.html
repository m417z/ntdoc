<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FltRetrieveIoPriorityInfo - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FltRetrieveIoPriorityInfo - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FltRetrieveIoPriorityInfo - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> FLTAPI FltRetrieveIoPriorityInfo(
  [in, optional] <a href="flt_callback_data" title="typedef struct _FLT_CALLBACK_DATA {&#10;  FLT_CALLBACK_DATA_FLAGS     Flags;&#10;  PETHREAD                    Thread;&#10;  PFLT_IO_PARAMETER_BLOCK     Iopb;&#10;  IO_STATUS_BLOCK             IoStatus;&#10;  struct _FLT_TAG_DATA_BUFFER *TagData;&#10;  union {&#10;    struct {&#10;      LIST_ENTRY QueueLinks;&#10;      PVOID      QueueContext[2];&#10;    };&#10;    PVOID FilterContext[4];&#10;  };&#10;  KPROCESSOR_MODE             RequestorMode;&#10;} FLT_CALLBACK_DATA, *PFLT_CALLBACK_DATA;">PFLT_CALLBACK_DATA</a> Data,
  [in, optional] <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a>       FileObject,
  [in, optional] PETHREAD           Thread,
  [in, out]      <a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">PIO_PRIORITY_INFO</a>  PriorityInfo
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltretrieveiopriorityinfo">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fltretrieveiopriorityinfo.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-fltkernel-fltretrieveiopriorityinfo)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fltretrieveiopriorityinfo-function">FltRetrieveIoPriorityInfo function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FltRetrieveIoPriorityInfo</strong> routine is used by a minifilter driver to retrieve priority information from a thread.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="data-in-optional"><code>Data</code> [in, optional]</h3>

<p>An optional pointer to a <strong><a href="flt_callback_data" title="typedef struct _FLT_CALLBACK_DATA {&#10;  FLT_CALLBACK_DATA_FLAGS     Flags;&#10;  PETHREAD                    Thread;&#10;  PFLT_IO_PARAMETER_BLOCK     Iopb;&#10;  IO_STATUS_BLOCK             IoStatus;&#10;  struct _FLT_TAG_DATA_BUFFER *TagData;&#10;  union {&#10;    struct {&#10;      LIST_ENTRY QueueLinks;&#10;      PVOID      QueueContext[2];&#10;    };&#10;    PVOID FilterContext[4];&#10;  };&#10;  KPROCESSOR_MODE             RequestorMode;&#10;} FLT_CALLBACK_DATA, *PFLT_CALLBACK_DATA;">FLT_CALLBACK_DATA</a></strong> structure, which represents an I/O operation. This parameter can be <strong>NULL</strong>.</p>

<h3 id="fileobject-in-optional"><code>FileObject</code> [in, optional]</h3>

<p>An optional pointer to the file object associated with the I/O operation. This parameter can be <strong>NULL</strong>.</p>

<h3 id="thread-in-optional"><code>Thread</code> [in, optional]</h3>

<p>An optional pointer to the thread in which to retrieve priority information from. This parameter can be <strong>NULL</strong>.</p>

<h3 id="priorityinfo-in-out"><code>PriorityInfo</code> [in, out]</h3>

<p>A pointer to an <strong><a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a></strong> structure used to receive the priority information from the given thread. The <a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a> structure must be initialized by an appropriate routine before it can be used by this routine. See the following Remarks section for more information.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong>FltRetrieveIoPriorityInfo</strong> routine returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>FltRetrieveIoPriorityInfo</strong> routine retrieves priority information and saves the information in the structure pointed to by the <strong>PriorityInfo</strong> parameter.</p>

<p>Typically, the <strong>FltRetrieveIoPriorityInfo</strong> routine is used in conjunction with the <strong><a href="fltapplypriorityinfothread" title="NTSTATUS FLTAPI FltApplyPriorityInfoThread(&#10;  [in]            PIO_PRIORITY_INFO InputPriorityInfo,&#10;  [out, optional] PIO_PRIORITY_INFO OutputPriorityInfo,&#10;  [in]            PETHREAD          Thread&#10;);">FltApplyPriorityInfoThread</a></strong> routine to save and then set a thread's I/O priority, paging priority, and thread priority.</p>

<p>If the <strong>Thread</strong> parameter is non-<strong>NULL</strong>, the thread's paging priority and thread priority will be retrieved and placed in the <strong>PagePriority</strong> and <strong>ThreadPriority<em>* members of the <a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a> structure pointed to by the *</em>PriorityInfo</strong> parameter. If the <strong>Thread</strong> parameter is <strong>NULL</strong>, the <strong>ThreadPriority</strong> and <strong>PagePriority</strong> members of the <a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a> structure are marked with sentinel values indicating that the thread's paging and thread priorities should not be changed by the system. Note that these sentinel values stay in effect until explicitly changed.</p>

<p>The following pseudo-code example describes what I/O priority value is retrieved and placed in the <strong>IoPriority</strong> member of the <a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a> structure pointed to by the <strong>PriorityInfo</strong> parameter.</p>

<pre><code>Set the IoPriority member of the structure pointed to by the PriorityInfo parameter to the normal I/O priority value.
IF Data is not NULL and represents an <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>-based operation and has I/O priority information available THEN
    Set the IoPriority member of the structure pointed to by the PriorityInfo parameter to the Data's I/O priority value.
ELSE IF the FileObject parameter is not NULL and has I/O priority information available THEN
    Set the IoPriority member of the structure pointed to by the PriorityInfo parameter to the FileObject's I/O priority value.
ELSE IF the Thread parameter is not NULL THEN
    Set the IoPriority member of the structure pointed to by the PriorityInfo parameter to the Thread's I/O priority value.
</code></pre>

<blockquote>
  <p>[!NOTE]
  If the <a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a> structure pointed to by the <strong>PriorityInfo</strong> parameter has not been initialized, you must do so prior to calling this routine, by calling the <strong><a href="ioinitializepriorityinfo" title="VOID IoInitializePriorityInfo(&#10;  [in] PIO_PRIORITY_INFO PriorityInfo&#10;);">IoInitializePriorityInfo</a></strong> routine.</p>
</blockquote>

<h2 id="see-also">See also</h2>

<p><strong><a href="flt_callback_data" title="typedef struct _FLT_CALLBACK_DATA {&#10;  FLT_CALLBACK_DATA_FLAGS     Flags;&#10;  PETHREAD                    Thread;&#10;  PFLT_IO_PARAMETER_BLOCK     Iopb;&#10;  IO_STATUS_BLOCK             IoStatus;&#10;  struct _FLT_TAG_DATA_BUFFER *TagData;&#10;  union {&#10;    struct {&#10;      LIST_ENTRY QueueLinks;&#10;      PVOID      QueueContext[2];&#10;    };&#10;    PVOID FilterContext[4];&#10;  };&#10;  KPROCESSOR_MODE             RequestorMode;&#10;} FLT_CALLBACK_DATA, *PFLT_CALLBACK_DATA;">FLT_CALLBACK_DATA</a></strong></p>

<p><strong><a href="fltapplypriorityinfothread" title="NTSTATUS FLTAPI FltApplyPriorityInfoThread(&#10;  [in]            PIO_PRIORITY_INFO InputPriorityInfo,&#10;  [out, optional] PIO_PRIORITY_INFO OutputPriorityInfo,&#10;  [in]            PETHREAD          Thread&#10;);">FltApplyPriorityInfoThread</a></strong></p>

<p><strong><a href="fltgetiopriorityhint" title="IO_PRIORITY_HINT FLTAPI FltGetIoPriorityHint(&#10;  [in] PFLT_CALLBACK_DATA Data&#10;);">FltGetIoPriorityHint</a></strong></p>

<p><strong><a href="fltgetiopriorityhintfromcallbackdata" title="IO_PRIORITY_HINT FLTAPI FltGetIoPriorityHintFromCallbackData(&#10;  [in] PFLT_CALLBACK_DATA Data&#10;);">FltGetIoPriorityHintFromCallbackData</a></strong></p>

<p><strong><a href="fltgetiopriorityhintfromfileobject" title="IO_PRIORITY_HINT FLTAPI FltGetIoPriorityHintFromFileObject(&#10;  [in] PFILE_OBJECT FileObject&#10;);">FltGetIoPriorityHintFromFileObject</a></strong></p>

<p><strong><a href="fltgetiopriorityhintfromthread" title="IO_PRIORITY_HINT FLTAPI FltGetIoPriorityHintFromThread(&#10;  [in] PETHREAD Thread&#10;);">FltGetIoPriorityHintFromThread</a></strong></p>

<p><strong>FltRetrieveIoPriorityInfo</strong></p>

<p><strong><a href="fltsetiopriorityhintintocallbackdata" title="NTSTATUS FLTAPI FltSetIoPriorityHintIntoCallbackData(&#10;  [in] PFLT_CALLBACK_DATA Data,&#10;  [in] IO_PRIORITY_HINT   PriorityHint&#10;);">FltSetIoPriorityHintIntoCallbackData</a></strong></p>

<p><strong><a href="fltsetiopriorityhintintofileobject" title="NTSTATUS FLTAPI FltSetIoPriorityHintIntoFileObject(&#10;  [in] PFILE_OBJECT     FileObject,&#10;  [in] IO_PRIORITY_HINT PriorityHint&#10;);">FltSetIoPriorityHintIntoFileObject</a></strong></p>

<p><strong><a href="fltsetiopriorityhintintothread" title="NTSTATUS FLTAPI FltSetIoPriorityHintIntoThread(&#10;  [in] PETHREAD         Thread,&#10;  [in] IO_PRIORITY_HINT PriorityHint&#10;);">FltSetIoPriorityHintIntoThread</a></strong></p>

<p><strong><a href="io_priority_info" title="typedef struct _IO_PRIORITY_INFO {&#10;  ULONG            Size;&#10;  ULONG            ThreadPriority;&#10;  ULONG            PagePriority;&#10;  IO_PRIORITY_HINT IoPriority;&#10;} IO_PRIORITY_INFO, *PIO_PRIORITY_INFO;">IO_PRIORITY_INFO</a></strong></p>

<p><strong><a href="ioinitializepriorityinfo" title="VOID IoInitializePriorityInfo(&#10;  [in] PIO_PRIORITY_INFO PriorityInfo&#10;);">IoInitializePriorityInfo</a></strong></p>

<p><strong><a href="psgetcurrentthread" title="PETHREAD PsGetCurrentThread();">PsGetCurrentThread</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltretrieveiopriorityinfo">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nf-fltkernel-fltretrieveiopriorityinfo.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
