<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RxPurgeRelatedFobxs - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RxPurgeRelatedFobxs - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RxPurgeRelatedFobxs - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// scavengr.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RxPurgeRelatedFobxs(
  PNET_ROOT   NetRoot,
  <a href="rx_context" title="typedef struct _RX_CONTEXT {&#10;  NODE_TYPE_CODE         NodeTypeCode;&#10;  NODE_BYTE_SIZE         NodeByteSize;&#10;  __volatile ULONG       ReferenceCount;&#10;  LIST_ENTRY             ContextListEntry;&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  BOOLEAN                PendingReturned;&#10;  BOOLEAN                PostRequest;&#10;  PDEVICE_OBJECT         RealDevice;&#10;  PIRP                   CurrentIrp;&#10;  PIO_STACK_LOCATION     CurrentIrpSp;&#10;  PMRX_FCB               pFcb;&#10;  PMRX_FOBX              pFobx;&#10;  PMRX_SRV_OPEN          pRelevantSrvOpen;&#10;  PNON_PAGED_FCB         NonPagedFcb;&#10;  PRDBSS_DEVICE_OBJECT   RxDeviceObject;&#10;  PETHREAD               OriginalThread;&#10;  PETHREAD               LastExecutionThread;&#10;  __volatile PVOID       LockManagerContext;&#10;...">PRX_CONTEXT</a> RxContext,
  BOOLEAN     AttemptFinalization,
  PFCB        PurgingFcb
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/scavengr/nf-scavengr-rxpurgerelatedfobxs">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rxpurgerelatedfobxs.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-scavengr-rxpurgerelatedfobxs)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rxpurgerelatedfobxs-function">RxPurgeRelatedFobxs function</h1>

<h2 id="description">Description</h2>

<p><strong>RxPurgeRelatedFobxs</strong> purges all of the FOBX structures associated with a NET_ROOT structure.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="netroot"><code>NetRoot</code></h3>

<p>A pointer to the NET_ROOT structure for which the FOBX structures need to be purged.</p>

<h3 id="rxcontext"><code>RxContext</code></h3>

<p>A pointer to the <a href="rx_context" title="typedef struct _RX_CONTEXT {&#10;  NODE_TYPE_CODE         NodeTypeCode;&#10;  NODE_BYTE_SIZE         NodeByteSize;&#10;  __volatile ULONG       ReferenceCount;&#10;  LIST_ENTRY             ContextListEntry;&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  BOOLEAN                PendingReturned;&#10;  BOOLEAN                PostRequest;&#10;  PDEVICE_OBJECT         RealDevice;&#10;  PIRP                   CurrentIrp;&#10;  PIO_STACK_LOCATION     CurrentIrpSp;&#10;  PMRX_FCB               pFcb;&#10;  PMRX_FOBX              pFobx;&#10;  PMRX_SRV_OPEN          pRelevantSrvOpen;&#10;  PNON_PAGED_FCB         NonPagedFcb;&#10;  PRDBSS_DEVICE_OBJECT   RxDeviceObject;&#10;  PETHREAD               OriginalThread;&#10;  PETHREAD               LastExecutionThread;&#10;  __volatile PVOID       LockManagerContext;&#10;...">RX_CONTEXT</a> structure.</p>

<h3 id="attemptfinalization"><code>AttemptFinalization</code></h3>

<p>A Boolean value that indicates whether an attempt to finalize and release the associated FCB structure should occur.</p>

<h3 id="purgingfcb"><code>PurgingFcb</code></h3>

<p>A pointer to the FCB structure for which purging should occur.</p>

<h2 id="return-value">Return value</h2>

<p><strong>RxPurgeRelatedFobxs</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success or one of the following error values on failure:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_UNSUCCESSFUL</strong></td>
  <td>No related FOBX structures could be purged.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>At cleanup there are no more user handles associated with the file object. In such cases, the time window between close and cleanup is dictated by the additional references maintained by the memory manager and cache manager. On cleanup, the FOBX is put on a close pending list and removed from the corresponding list when a close operation is received. In the interim, if an open operation is failing with ACCESS_DENIED status, then RDBSS can force a purge of the FOBX structure. This is a synchronous operation.</p>

<p>For directory renames, all files under the directory need to be closed. A network mini-redirector might call <strong>RxPurgeRelatedFobxs</strong> and <strong><a href="rxscavengefobxsfornetroot" title="VOID RxScavengeFobxsForNetRoot(&#10;  PNET_ROOT NetRoot,&#10;  PFCB      PurgingFcb,&#10;  BOOLEAN   SynchronizeWithScavenger&#10;);">RxScavengeFobxsForNetRoot</a></strong> in response to an <a href="irp_mj_set_information" title="#define IRP_MJ_SET_INFORMATION 0x06">IRP_MJ_SET_INFORMATION</a> request to rename a directory. By passing in the NET_ROOT structure for the directory and a <strong>NULL</strong> FCB, all of the FOBX structures associated with the directory would be purged and scavenged.</p>

<p>The <strong>RxPurgeRelatedFobxs</strong> routine attempts to purge all of the FOBX structures that had a close operation pending before the purge request was received. The <strong>RxPurgeRelatedFobxs</strong> routine acquires the scavenger mutex, traverses the <strong>ClosePendingFobxsList</strong> member on the scavenger object removing list entries, and then releases the mutex.</p>

<p>If <em>AttemptFinalize</em> is set to <strong>TRUE</strong>, then <strong>RxPurgeRelatedFobxs</strong> will try to finalize and release the associated FCB.</p>

<p>If <em>PFCB</em> is not <strong>NULL</strong>, and this purging FCB structure is not the same as the FCB structure associated with the FOBX on the <strong>ClosePendingFobxsList</strong> member, then <strong>RxPurgeRelatedFobxs</strong> will call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mrx/nc-mrx-pmrx_chkfcb_calldown">MRxAreFilesAliased</a> callback routine provided by the network mini-redirector if this routine is supported. The call to <strong>MRxAreFilesAliased</strong> is to determine if the PFCB is an alias for the FCB associated with the FOBX structure.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mrx/nc-mrx-pmrx_chkfcb_calldown">MRxAreFilesAliased</a></p>

<p><a href="rxpurgeallfobxs" title="VOID RxPurgeAllFobxs(&#10;  PRDBSS_DEVICE_OBJECT RxDeviceObject&#10;);">RxPurgeAllFobxs</a></p>

<p><a href="rxscavengeallfobxs" title="VOID RxScavengeAllFobxs(&#10;  PRDBSS_DEVICE_OBJECT RxDeviceObject&#10;);">RxScavengeAllFobxs</a></p>

<p><a href="rxscavengefobxsfornetroot" title="VOID RxScavengeFobxsForNetRoot(&#10;  PNET_ROOT NetRoot,&#10;  PFCB      PurgingFcb,&#10;  BOOLEAN   SynchronizeWithScavenger&#10;);">RxScavengeFobxsForNetRoot</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/scavengr/nf-scavengr-rxpurgerelatedfobxs">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/scavengr/nf-scavengr-rxpurgerelatedfobxs.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
