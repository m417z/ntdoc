<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FSCTL_SRV_REQUEST_RESUME_KEY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FSCTL_SRV_REQUEST_RESUME_KEY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FSCTL_SRV_REQUEST_RESUME_KEY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header"></span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">#define FSCTL_SRV_REQUEST_RESUME_KEY /* IOCTL code */</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/fsctl-srv-request-resume-key">View the official Win32 development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsctl_srv_request_resume_key.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 development documentation (fsctl-srv-request-resume-key)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fsctl_srv_request_resume_key-control-code">FSCTL_SRV_REQUEST_RESUME_KEY control code</h1>

<p>The <strong>FSCTL_SRV_REQUEST_RESUME_KEY</strong> control code is used to retrieve an opaque file reference for use with the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/ioctl-copychunk"><strong>IOCTL_COPYCHUNK</strong></a> control code.</p>

<p>To perform this operation, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function with the following parameters.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOL</span><span class="w"> </span><span class="n">DeviceIoControl</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="w"> </span><span class="n">hDevice</span><span class="p">,</span><span class="w">             </span><span class="c1">// handle to device</span>
<span class="w">  </span><span class="n">FSCTL_SRV_REQUEST_RESUME_KEY</span><span class="p">,</span><span class="w"> </span><span class="c1">// dwIoControlCode</span>
<span class="w">  </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                         </span><span class="c1">// lpInBuffer</span>
<span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w">                            </span><span class="c1">// nInBufferSize</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPVOID</span><span class="p">)</span><span class="w"> </span><span class="n">lpOutBuffer</span><span class="p">,</span><span class="w">         </span><span class="c1">// output buffer</span>
<span class="w">  </span><span class="p">(</span><span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="p">)</span><span class="w"> </span><span class="n">nOutBufferSize</span><span class="p">,</span><span class="w">       </span><span class="c1">// size of output buffer</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPDWORD</span><span class="p">)</span><span class="w"> </span><span class="n">lpBytesReturned</span><span class="p">,</span><span class="w">    </span><span class="c1">// number of bytes returned</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPOVERLAPPED</span><span class="p">)</span><span class="w"> </span><span class="n">lpOverlapped</span><span class="w">   </span><span class="c1">// OVERLAPPED structure</span>
<span class="p">);</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<p><em>hDevice</em> [in]</p>

<p>A handle to the file for which the source file key is to be requested. To obtain this handle, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fileapi/nf-fileapi-createfilea"><strong>CreateFile</strong></a> function.</p>

<p><em>dwIoControlCode</em> [in]</p>

<p>The control code for the operation. Use <strong>FSCTL_SRV_REQUEST_RESUME_KEY</strong> for this operation.</p>

<p><em>lpInBuffer</em></p>

<p>Not used with this operation; set to <strong>NULL</strong>.</p>

<p><em>nInBufferSize</em> [in]</p>

<p>Not used with this operation; set to zero.</p>

<p><em>lpOutBuffer</em> [out]</p>

<p>A pointer to the output buffer, a <strong>SRV_REQUEST_RESUME_KEY</strong> structure. For more information, see the Remarks section.</p>

<p><em>nOutBufferSize</em> [in]</p>

<p>The size of the output buffer, in bytes.</p>

<p><em>lpBytesReturned</em> [out]</p>

<p>A pointer to a variable that receives the size of the data stored in the output buffer, in bytes.</p>

<p>If the output buffer is too small, the call fails, the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a> function returns <strong>ERROR_INSUFFICIENT_BUFFER</strong>, and <em>lpBytesReturned</em> is zero.</p>

<p>If the <em>lpOverlapped</em> parameter is <strong>NULL</strong>, <em>lpBytesReturned</em> cannot be <strong>NULL</strong>. Even when an operation returns no output data and the <em>lpOutBuffer</em> parameter is <strong>NULL</strong>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> makes use of <em>lpBytesReturned</em>. After such an operation, the value of <em>lpBytesReturned</em> is meaningless.</p>

<p>If <em>lpOverlapped</em> is not <strong>NULL</strong>, <em>lpBytesReturned</em> can be <strong>NULL</strong>. If <em>lpOverlapped</em> is not <strong>NULL</strong> and the operation returns data, <em>lpBytesReturned</em> is meaningless until the overlapped operation has completed. To retrieve the number of bytes returned, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-getoverlappedresult"><strong>GetOverlappedResult</strong></a> function. If the <em>hDevice</em> parameter is associated with an I/O completion port, you can retrieve the number of bytes returned by calling the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus"><strong>GetQueuedCompletionStatus</strong></a> function.</p>

<p><em>lpOverlapped</em> [in]</p>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/minwinbase/ns-minwinbase-overlapped"><strong>OVERLAPPED</strong></a> structure.</p>

<p>If the <em>hDevice</em> parameter was opened without specifying <strong>FILE_FLAG_OVERLAPPED</strong>, <em>lpOverlapped</em> is ignored.</p>

<p>If <em>hDevice</em> was opened with the <strong>FILE_FLAG_OVERLAPPED</strong> flag, the operation is performed as an overlapped (asynchronous) operation. In this case, <em>lpOverlapped</em> must point to a valid <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/minwinbase/ns-minwinbase-overlapped"><strong>OVERLAPPED</strong></a> structure that contains a handle to an event object. Otherwise, the function fails in unpredictable ways.</p>

<p>For overlapped operations, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> returns immediately, and the event object is signaled when the operation has been completed. Otherwise, the function does not return until the operation has been completed or until an error occurs.</p>

<h2 id="return-value">Return value</h2>

<p>If the operation completes successfully, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> returns a nonzero value.</p>

<p>If the operation fails or is pending, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> returns zero. To get extended error information, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a>.</p>

<h2 id="remarks">Remarks</h2>

<p>This control code has no associated header file. You must define the control code and data structures as follows.</p>

<p><!-- CODE_MARKER --></p>

<pre><code>#define FSCTL_SRV_REQUEST_RESUME_KEY <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(FILE_DEVICE_NETWORK_FILE_SYSTEM, 30, METHOD_BUFFERED, FILE_ANY_ACCESS)

typedef struct _SRV_RESUME_KEY {
    <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a> ResumeKey;
    <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a> Timestamp;
    <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a> Pid;
} SRV_RESUME_KEY, *PSRV_RESUME_KEY;

typedef struct _SRV_REQUEST_RESUME_KEY {
    SRV_RESUME_KEY Key;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  ContextLength;
    <a href="byte" title="typedef unsigned char BYTE;">BYTE</a>   Context[1];
} SRV_REQUEST_RESUME_KEY, *PSRV_REQUEST_RESUME_KEY;
</code></pre>

<p>These members can be described as follows.</p>

<table>
<thead>
<tr>
  <th>Member</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ResumeKey</strong><br></td>
  <td>An opaque value that identifies the source file to the server.<br></td>
</tr>
<tr>
  <td><strong>Timestamp</strong><br></td>
  <td>An opaque value that identifies the time when the file was opened.<br></td>
</tr>
<tr>
  <td><strong>Pid</strong><br></td>
  <td>An opaque value that identifies the process that opened the file.<br></td>
</tr>
<tr>
  <td><strong>Key</strong><br></td>
  <td>A <strong>SRV_RESUME_KEY</strong> structure. To perform a server-side copy operation, use this structure with the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/ioctl-copychunk"><strong>IOCTL_COPYCHUNK</strong></a> control code.<br></td>
</tr>
<tr>
  <td><strong>ContextLength</strong><br></td>
  <td>This member is reserved for system use; do not use.<br></td>
</tr>
<tr>
  <td><strong>Context</strong><br></td>
  <td>This member is reserved for system use; do not use.<br></td>
</tr>
</tbody>
</table>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/ioctl-copychunk"><strong>IOCTL_COPYCHUNK</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/fsctl-srv-request-resume-key">View the official Win32 development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/win32/blob/docs/desktop-src/DevNotes/fsctl-srv-request-resume-key.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
