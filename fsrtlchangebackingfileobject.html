<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FsRtlChangeBackingFileObject - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FsRtlChangeBackingFileObject - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FsRtlChangeBackingFileObject - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> FsRtlChangeBackingFileObject(
  <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a>              CurrentFileObject,
  <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a>              NewFileObject,
  <a href="fsrtl_change_backing_type" title="typedef enum _FSRTL_CHANGE_BACKING_TYPE {&#10;  ChangeDataControlArea,&#10;  ChangeImageControlArea,&#10;  ChangeSharedCacheMap&#10;} FSRTL_CHANGE_BACKING_TYPE, *PFSRTL_CHANGE_BACKING_TYPE;">FSRTL_CHANGE_BACKING_TYPE</a> ChangeBackingType,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                     Flags
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-fsrtlchangebackingfileobject">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsrtlchangebackingfileobject.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-fsrtlchangebackingfileobject)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fsrtlchangebackingfileobject-function">FsRtlChangeBackingFileObject function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FsRtlChangeBackingFileObject</strong> routine replaces the current file object with a new file object.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="currentfileobject"><code>CurrentFileObject</code></h3>

<p><strong>[in, optional]</strong> The current file object. If <strong>CurrentFileObject</strong> is <strong>NULL</strong>, the operating system's current file object is set to <strong>NewFileObject</strong>. If it is non-NULL, the backing file object is changed to <strong>NewFileObject</strong> only if the OS's current backing file object is equal to this value. If this file object does not belong to the stream, the operation fails.</p>

<h3 id="newfileobject"><code>NewFileObject</code></h3>

<p><strong>[in]</strong> The new file object that the OS will reference and store internally.</p>

<h3 id="changebackingtype"><code>ChangeBackingType</code></h3>

<p><strong>[in]</strong> An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ne-ntifs-_fsrtl_change_backing_type">FSRTL_CHANGE_BACKING_TYPE</a> enumeration value that indicates which internal structure should be changed to reference <strong>NewFileObject</strong>.</p>

<h3 id="flags"><code>Flags</code></h3>

<p><strong>[in]</strong> Reserved for future use.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong>FsRtlChangeBackingFileObject</strong> routine returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, <strong>FsRtlChangeBackingFileObject</strong> returns the appropriate error code.The following table contains error codes that <strong>FsRtlChangeBackingFileObject</strong> might return.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_INVALID_PARAMETER_2</td>
  <td>The change operation failed because the file object that <strong>NewFileObject</strong> specifies does not represent the same stream as CurrentFileObject.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER_3</td>
  <td>The change operation failed because the caller specified an invalid backing type in <strong>ChangeBackingType</strong>.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER_4</td>
  <td>The change operation failed because the caller specified an invalid value in <strong>Flags</strong>.</td>
</tr>
<tr>
  <td>STATUS_NOT_SUPPORTED</td>
  <td>The change operation failed because the caller obtained the file object in a way that does not allow subsequent swapping of the file object. For example, if the caller obtained the file object with a call to <strong><a href="ccgetfileobjectfromsectionptrs" title="PFILE_OBJECT CcGetFileObjectFromSectionPtrs(&#10;  [in] PSECTION_OBJECT_POINTERS SectionObjectPointer&#10;);">CcGetFileObjectFromSectionPtrs</a></strong>, it is not safe to swap the file object.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The <strong>FsRtlChangeBackingFileObject</strong> routine changes the file object for one of the following:</p>

<ul>
<li><p>One of the memory manager's image control areas for the stream</p></li>
<li><p>The memory manager's data control area for the stream</p></li>
<li><p>The cache manager's shared cache map for the stream</p></li>
</ul>

<p>The <strong>FsRtlChangeBackingFileObject</strong> routine is not synchronous. It processes the request for a change of file object and returns immediately. The cache manager and the memory manager synchronize the change of the file object and will not free the old file object until all incomplete operations that are associated with the old file object have finished. A return status of <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> from <strong>FsRtlChangeBackingFileObject</strong> does not mean that the operating system has already changed the file object.</p>

<p>However, after <strong>FsRtlChangeBackingFileObject</strong> runs successfully, the operating system associates all future operations with the new file object.</p>

<p>To change the file object for more than one backing type, the caller must call <strong>FsRtlChangeBackingFileObject</strong> multiple times, one time for each backing type to change.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ne-ntifs-_fsrtl_change_backing_type">FSRTL_CHANGE_BACKING_TYPE</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-fsrtlchangebackingfileobject">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-fsrtlchangebackingfileobject.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
