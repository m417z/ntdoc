<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="MmLockPagableSectionByHandle - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MmLockPagableSectionByHandle - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            MmLockPagableSectionByHandle - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID MmLockPagableSectionByHandle(
  [in] PVOID ImageSectionHandle
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-mmlockpagablesectionbyhandle">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/mmlockpagablesectionbyhandle.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntddk-mmlockpagablesectionbyhandle)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="mmlockpagablesectionbyhandle-function">MmLockPagableSectionByHandle function</h1>

<h2 id="description">Description</h2>

<p>The <strong>MmLockPagableSectionByHandle</strong> routine locks a pageable code or data section into system memory by incrementing the reference count on the handle to the section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="imagesectionhandle-in"><code>ImageSectionHandle</code> [in]</h3>

<p>The handle to a pageable code or data section. The caller obtained this handle from a previous call to the <a href="mmlockpagablecodesection" title="void MmLockPagableCodeSection(&#10;  [in] Address&#10;);">MmLockPagableCodeSection</a> or <a href="mmlockpagabledatasection" title="PVOID MmLockPagableDataSection(&#10;  [in] PVOID AddressWithinSection&#10;);">MmLockPagableDataSection</a> routine.</p>

<h2 id="remarks">Remarks</h2>

<p>A driver initially calls <strong><a href="mmlockpagablecodesection" title="void MmLockPagableCodeSection(&#10;  [in] Address&#10;);">MmLockPagableCodeSection</a></strong> or <strong><a href="mmlockpagabledatasection" title="PVOID MmLockPagableDataSection(&#10;  [in] PVOID AddressWithinSection&#10;);">MmLockPagableDataSection</a></strong> to obtain a handle to a pageable code or data section. Thereafter, the driver can call <strong>MmLockPagableSectionByHandle</strong> and <a href="mmunlockpagableimagesection" title="VOID MmUnlockPagableImageSection(&#10;  [in] PVOID ImageSectionHandle&#10;);">MmUnlockPagableImageSection</a> to increment and decrement the reference count on the handle.</p>

<p>The <strong><a href="mmlockpagablecodesection" title="void MmLockPagableCodeSection(&#10;  [in] Address&#10;);">MmLockPagableCodeSection</a></strong> or <strong><a href="mmlockpagabledatasection" title="PVOID MmLockPagableDataSection(&#10;  [in] PVOID AddressWithinSection&#10;);">MmLockPagableDataSection</a></strong> call locks the pageable section into system memory, returns a handle to the section, and initializes the reference count on the handle to one. <strong>MmLockPagableSectionByHandle</strong> increments the reference count by one, and <strong><a href="mmunlockpagableimagesection" title="VOID MmUnlockPagableImageSection(&#10;  [in] PVOID ImageSectionHandle&#10;);">MmUnlockPagableImageSection</a></strong> decrements the reference count by one.</p>

<p>If the reference count on the handle is nonzero, the pageable section is locked. If the reference count is zero, the section is unlocked.</p>

<p>The handle to the pageable section remains valid as long as the driver stays loaded in memory. The driver can use the same handle to repeatedly lock and unlock the section. That is, the driver can reuse a handle whose reference count is zero. <strong>MmLockPagableSectionByHandle</strong> checks to see if the referenced section is resident in the caller's address space and, if it is, simply increments the reference count on the section. If the section is not resident, <strong>MmLockPagableSectionByHandle</strong> pages in the section, locks it in system space, and sets the reference count to one.</p>

<p>To avoid leaking system memory, the reference count on the handle must be zero when the driver is unloaded from memory. Otherwise, the pageable section will stay locked into system memory after the driver unloads.</p>

<p>If the driver is preparing to unload, and the reference count on the handle is nonzero, the driver should call <strong><a href="mmunlockpagableimagesection" title="VOID MmUnlockPagableImageSection(&#10;  [in] PVOID ImageSectionHandle&#10;);">MmUnlockPagableImageSection</a></strong> to decrement the count to zero before the unload occurs.</p>

<p>A driver cannot call <strong>MmLockPagableSectionByHandle</strong> to lock down user buffers passed in IRPs. Use <strong><a href="mmprobeandlockpages" title="VOID MmProbeAndLockPages(&#10;  [in, out] PMDL            MemoryDescriptorList,&#10;  [in]      KPROCESSOR_MODE AccessMode,&#10;  [in]      LOCK_OPERATION  Operation&#10;);">MmProbeAndLockPages</a></strong> instead.</p>

<p>For more information about paging code and data, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/making-drivers-pageable">Making Drivers Pageable</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="mmlockpagablecodesection" title="void MmLockPagableCodeSection(&#10;  [in] Address&#10;);">MmLockPagableCodeSection</a></p>

<p><a href="mmlockpagabledatasection" title="PVOID MmLockPagableDataSection(&#10;  [in] PVOID AddressWithinSection&#10;);">MmLockPagableDataSection</a></p>

<p><a href="mmpageentiredriver" title="PVOID MmPageEntireDriver(&#10;  [in] PVOID AddressWithinSection&#10;);">MmPageEntireDriver</a></p>

<p><a href="mmprobeandlockpages" title="VOID MmProbeAndLockPages(&#10;  [in, out] PMDL            MemoryDescriptorList,&#10;  [in]      KPROCESSOR_MODE AccessMode,&#10;  [in]      LOCK_OPERATION  Operation&#10;);">MmProbeAndLockPages</a></p>

<p><a href="mmresetdriverpaging" title="VOID MmResetDriverPaging(&#10;  [in] PVOID AddressWithinSection&#10;);">MmResetDriverPaging</a></p>

<p><a href="mmunlockpagableimagesection" title="VOID MmUnlockPagableImageSection(&#10;  [in] PVOID ImageSectionHandle&#10;);">MmUnlockPagableImageSection</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-mmlockpagablesectionbyhandle">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddk/nf-ntddk-mmlockpagablesectionbyhandle.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
