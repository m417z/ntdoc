<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ExSetFirmwareEnvironmentVariable - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ExSetFirmwareEnvironmentVariable - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ExSetFirmwareEnvironmentVariable - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ExSetFirmwareEnvironmentVariable(
  [in] <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> VariableName,
  [in] LPGUID          VendorGuid,
  [in] PVOID           Value,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           ValueLength,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Attributes
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exsetfirmwareenvironmentvariable">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/exsetfirmwareenvironmentvariable.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-exsetfirmwareenvironmentvariable)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="exsetfirmwareenvironmentvariable-function">ExSetFirmwareEnvironmentVariable function</h1>

<h2 id="description">Description</h2>

<p>The <strong>ExSetFirmwareEnvironmentVariable</strong> routine sets the value of the specified system firmware environment variable.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="variablename-in"><code>VariableName</code> [in]</h3>

<p>A pointer to a <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a> structure that contains the name of the specified environment variable.</p>

<h3 id="vendorguid-in"><code>VendorGuid</code> [in]</h3>

<p>A pointer to a GUID that identifies the vendor associated with the specified environment variable. Environment variables are grouped into namespaces based on their vendor GUIDs. Some hardware platforms might not support vendor GUIDs. On these platforms, all variables are grouped into one, common namespace, and the <em>VendorGuid</em> parameter is ignored.</p>

<h3 id="value-in"><code>Value</code> [in]</h3>

<p>A pointer to a caller-allocated buffer that contains the data value to write to the specified environment variable.</p>

<h3 id="valuelength-in"><code>ValueLength</code> [in]</h3>

<p>The size, in bytes, of the data value contained in the <em>Value</em> buffer.</p>

<h3 id="attributes-in"><code>Attributes</code> [in]</h3>

<p>The attributes to assign to the specified environment variable. The VARIABLE_ATTRIBUTE_NON_VOLATILE attribute bit must be set or this call will fail. For more information about the attribute bits that are defined for this parameter, see Remarks in <a href="exgetfirmwareenvironmentvariable" title="NTSTATUS ExGetFirmwareEnvironmentVariable(&#10;  [in]            PUNICODE_STRING VariableName,&#10;  [in]            LPGUID          VendorGuid,&#10;  [out, optional] PVOID           Value,&#10;  [in, out]       PULONG          ValueLength,&#10;  [out, optional] PULONG          Attributes&#10;);">ExGetFirmwareEnvironmentVariable</a>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ExSetFirmwareEnvironmentVariable</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it is successful. Possible return values include the following error status codes.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>Available system resources are insufficient to complete the requested operation.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>One of the parameters is not valid.</td>
</tr>
<tr>
  <td><strong>STATUS_NOT_IMPLEMENTED</strong></td>
  <td>This routine is not supported on this platform.</td>
</tr>
<tr>
  <td><strong>STATUS_UNSUCCESSFUL</strong></td>
  <td>The firmware returned an unrecognized error.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The caller requires the system environment privilege (<a href="se_system_environment_privilege" title="#define SE_SYSTEM_ENVIRONMENT_PRIVILEGE (22L) // Required to modify UEFI variables of systems that use this type of memory to store configuration information.">SE_SYSTEM_ENVIRONMENT_PRIVILEGE</a>) to use this routine.</p>

<p>System firmware environment variables contain data values that are passed between the boot firmware environment implemented in the hardware platform and the operating-system loaders and other software that runs in the firmware environment. For more information, see Remarks in <a href="exgetfirmwareenvironmentvariable" title="NTSTATUS ExGetFirmwareEnvironmentVariable(&#10;  [in]            PUNICODE_STRING VariableName,&#10;  [in]            LPGUID          VendorGuid,&#10;  [out, optional] PVOID           Value,&#10;  [in, out]       PULONG          ValueLength,&#10;  [out, optional] PULONG          Attributes&#10;);">ExGetFirmwareEnvironmentVariable</a>.</p>

<p>If you create a backup datastore, you can use the <a href="exgetfirmwareenvironmentvariable" title="NTSTATUS ExGetFirmwareEnvironmentVariable(&#10;  [in]            PUNICODE_STRING VariableName,&#10;  [in]            LPGUID          VendorGuid,&#10;  [out, optional] PVOID           Value,&#10;  [in, out]       PULONG          ValueLength,&#10;  [out, optional] PULONG          Attributes&#10;);">ExGetFirmwareEnvironmentVariable</a> routine to save all the boot settings for the platform. Later, you can use <strong>ExSetFirmwareEnvironmentVariable</strong> to restore these settings if needed.</p>

<p><strong>ExSetFirmwareEnvironmentVariable</strong> is the kernel-mode equivalent of the Win32 <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-setfirmwareenvironmentvariablea">SetFirmwareEnvironmentVariable</a> function.</p>

<h2 id="see-also">See also</h2>

<p><a href="exgetfirmwareenvironmentvariable" title="NTSTATUS ExGetFirmwareEnvironmentVariable(&#10;  [in]            PUNICODE_STRING VariableName,&#10;  [in]            LPGUID          VendorGuid,&#10;  [out, optional] PVOID           Value,&#10;  [in, out]       PULONG          ValueLength,&#10;  [out, optional] PULONG          Attributes&#10;);">ExGetFirmwareEnvironmentVariable</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-setfirmwareenvironmentvariablea">SetFirmwareEnvironmentVariable</a></p>

<p><a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exsetfirmwareenvironmentvariable">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-exsetfirmwareenvironmentvariable.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
