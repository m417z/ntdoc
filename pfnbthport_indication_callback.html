<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFNBTHPORT_INDICATION_CALLBACK - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFNBTHPORT_INDICATION_CALLBACK - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFNBTHPORT_INDICATION_CALLBACK - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// bthddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFNBTHPORT_INDICATION_CALLBACK PfnbthportIndicationCallback;

void PfnbthportIndicationCallback(
  [in] PVOID Context,
  [in] <a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a> Indication,
  [in] <a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">PINDICATION_PARAMETERS</a> Parameters
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/nc-bthddi-pfnbthport_indication_callback">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfnbthport_indication_callback.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-bthddi-pfnbthport_indication_callback)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pfnbthport_indication_callback-callback-function">PFNBTHPORT_INDICATION_CALLBACK callback function</h1>

<h2 id="description">Description</h2>

<p>Profile drivers implement a L2CAP callback function to provide the Bluetooth driver stack with a
mechanism to notify the profile driver about incoming L2CAP connection requests from remote devices, and
any changes to the status of a currently open L2CAP connection.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="context-in"><code>Context</code> [in]</h3>

<p>For incoming remote connection request indications, this is the context specified by the profile
driver in the
<strong>IndicationCallbackContext</strong> member of the
<a href="_brb_l2ca_register_server" title="struct _BRB_L2CA_REGISTER_SERVER {&#10;  BRB_HEADER                     Hdr;&#10;  BTH_ADDR                       BtAddress;&#10;  USHORT                         PSM;&#10;  ULONG                          IndicationFlags;&#10;  PFNBTHPORT_INDICATION_CALLBACK IndicationCallback;&#10;  PVOID                          IndicationCallbackContext;&#10;  PVOID                          ReferenceObject;&#10;  OUT L2CAP_SERVER_HANDLE        ServerHandle;&#10;};">_BRB_L2CA_REGISTER_SERVER</a> structure when the profile driver registered the callback function. For
changes to existing L2CAP connections, this is the
<strong>CallbackContext</strong> member specified by the profile driver when it built and sent a
<a href="_brb_l2ca_open_channel" title="struct _BRB_L2CA_OPEN_CHANNEL {&#10;  BRB_HEADER                     Hdr;&#10;  L2CAP_CHANNEL_HANDLE           ChannelHandle;&#10;  union {&#10;    struct {&#10;      USHORT Response;&#10;      USHORT ResponseStatus;&#10;    };&#10;    USHORT Psm;&#10;  };&#10;  ULONG                          ChannelFlags;&#10;  BTH_ADDR                       BtAddress;&#10;  struct {&#10;    ULONG                    Flags;&#10;    L2CAP_CONFIG_VALUE_RANGE Mtu;&#10;    L2CAP_CONFIG_VALUE_RANGE FlushTO;&#10;    L2CAP_FLOWSPEC           Flow;&#10;    USHORT                   LinkTO;&#10;    ULONG                    NumExtraOptions;&#10;    PL2CAP_CONFIG_OPTION     ExtraOptions;&#10;...">_BRB_L2CA_OPEN_CHANNEL</a> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>.</p>

<h3 id="indication-in"><code>Indication</code> [in]</h3>

<p>An
<a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a> value that indicates the type
of L2CAP event.</p>

<h3 id="parameters-in"><code>Parameters</code> [in]</h3>

<p>An
<a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">INDICATION_PARAMETERS</a> structure that
contains event-specific parameters.</p>

<h2 id="remarks">Remarks</h2>

<p>A profile driver registers its L2CAP callback function in the following two scenarios:</p>

<ol>
<li>When a profile driver acts as a server, it registers a L2CAP callback function using the
<strong>IndicationCallback</strong> member of the
<a href="_brb_l2ca_register_server" title="struct _BRB_L2CA_REGISTER_SERVER {&#10;  BRB_HEADER                     Hdr;&#10;  BTH_ADDR                       BtAddress;&#10;  USHORT                         PSM;&#10;  ULONG                          IndicationFlags;&#10;  PFNBTHPORT_INDICATION_CALLBACK IndicationCallback;&#10;  PVOID                          IndicationCallbackContext;&#10;  PVOID                          ReferenceObject;&#10;  OUT L2CAP_SERVER_HANDLE        ServerHandle;&#10;};">_BRB_L2CA_REGISTER_SERVER</a> structure. The Bluetooth driver stack can then notify the profile
driver when a remote device attempts to contact it.</li>
<li>When the profile driver acts as a client and attempts to connect to a remote device using the
<strong>BRB_L2CA_OPEN_CHANNEL</strong> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>, the profile driver registers its L2CAP callback function using the
<strong>Callback</strong> member of the <a href="_brb_l2ca_open_channel" title="struct _BRB_L2CA_OPEN_CHANNEL {&#10;  BRB_HEADER                     Hdr;&#10;  L2CAP_CHANNEL_HANDLE           ChannelHandle;&#10;  union {&#10;    struct {&#10;      USHORT Response;&#10;      USHORT ResponseStatus;&#10;    };&#10;    USHORT Psm;&#10;  };&#10;  ULONG                          ChannelFlags;&#10;  BTH_ADDR                       BtAddress;&#10;  struct {&#10;    ULONG                    Flags;&#10;    L2CAP_CONFIG_VALUE_RANGE Mtu;&#10;    L2CAP_CONFIG_VALUE_RANGE FlushTO;&#10;    L2CAP_FLOWSPEC           Flow;&#10;    USHORT                   LinkTO;&#10;    ULONG                    NumExtraOptions;&#10;    PL2CAP_CONFIG_OPTION     ExtraOptions;&#10;...">_BRB_L2CA_OPEN_CHANNEL</a> structure that is passed when the profile driver
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536657(v=vs.85)">builds and sends</a> a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536615(v=vs.85)">BRB_L2CA_OPEN_CHANNEL</a> or
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)">BRB_L2CA_OPEN_CHANNEL_RESPONSE</a> request.</li>
</ol>

<p>After the profile driver registers its L2CAP callback function, the callback function is only
associated with the channel that the <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> opened. The Bluetooth driver stack can call the L2CAP callback
function to notify the profile driver of actions that occur over the open channel to the remote device.
Profile drivers can register a single callback function to handle channel notifications as a client and
connection notifications as a server.</p>

<p>The
<a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">INDICATION_PARAMETERS</a> structure held in
the
<em>Parameters</em> parameter is interpreted according to the value of the
<a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a> enumeration that the Bluetooth
driver stack passes to the profile driver's L2CAP callback function through the
<em>Indication</em> parameter. For most notifications, there is an <a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">INDICATION_PARAMETERS</a> union member that
corresponds to the event and contains event-specific parameters.</p>

<h2 id="see-also">See also</h2>

<p><a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a></p>

<p><a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">INDICATION_PARAMETERS</a></p>

<p><a href="_brb_l2ca_open_channel" title="struct _BRB_L2CA_OPEN_CHANNEL {&#10;  BRB_HEADER                     Hdr;&#10;  L2CAP_CHANNEL_HANDLE           ChannelHandle;&#10;  union {&#10;    struct {&#10;      USHORT Response;&#10;      USHORT ResponseStatus;&#10;    };&#10;    USHORT Psm;&#10;  };&#10;  ULONG                          ChannelFlags;&#10;  BTH_ADDR                       BtAddress;&#10;  struct {&#10;    ULONG                    Flags;&#10;    L2CAP_CONFIG_VALUE_RANGE Mtu;&#10;    L2CAP_CONFIG_VALUE_RANGE FlushTO;&#10;    L2CAP_FLOWSPEC           Flow;&#10;    USHORT                   LinkTO;&#10;    ULONG                    NumExtraOptions;&#10;    PL2CAP_CONFIG_OPTION     ExtraOptions;&#10;...">_BRB_L2CA_OPEN_CHANNEL</a></p>

<p><a href="_brb_l2ca_register_server" title="struct _BRB_L2CA_REGISTER_SERVER {&#10;  BRB_HEADER                     Hdr;&#10;  BTH_ADDR                       BtAddress;&#10;  USHORT                         PSM;&#10;  ULONG                          IndicationFlags;&#10;  PFNBTHPORT_INDICATION_CALLBACK IndicationCallback;&#10;  PVOID                          IndicationCallbackContext;&#10;  PVOID                          ReferenceObject;&#10;  OUT L2CAP_SERVER_HANDLE        ServerHandle;&#10;};">_BRB_L2CA_REGISTER_SERVER</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/nc-bthddi-pfnbthport_indication_callback">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/bthddi/nc-bthddi-pfnbthport_indication_callback.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
