<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtQueryVirtualMemory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtQueryVirtualMemory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtQueryVirtualMemory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTMMAPI_H
//
// Virtual memory
//
#if (PHNT_MODE != PHNT_MODE_KERNEL)

</span><span class="ntdoc-code-intro">/**
 * The NtQueryVirtualMemory routine queries information about a region of virtual memory in a process.
 *
 * \param ProcessHandle A handle to the process whose memory information is to be queried.
 * \param BaseAddress A pointer to the base address of the region of pages to be queried.
 * \param MemoryInformationClass The type of information to be queried.
 * \param MemoryInformation A pointer to a buffer that receives the memory information.
 * \param MemoryInformationLength The size of the buffer pointed to by the MemoryInformation parameter.
 * \param ReturnLength A pointer to a variable that receives the number of bytes returned in the MemoryInformation buffer.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtQueryVirtualMemory(
    _In_ HANDLE ProcessHandle,
    _In_opt_ PVOID BaseAddress,
    _In_ <a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a> MemoryInformationClass,
    _Out_writes_bytes_(MemoryInformationLength) PVOID MemoryInformation,
    _In_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> MemoryInformationLength,
    _Out_opt_ PSIZE_T ReturnLength
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/c7a74aeca340d1e3528acaa99b3405f36f41899f/phnt/include/ntmmapi.h#L928">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwQueryVirtualMemory(
    _In_ HANDLE ProcessHandle,
    _In_opt_ PVOID BaseAddress,
    _In_ <a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a> MemoryInformationClass,
    _Out_writes_bytes_(MemoryInformationLength) PVOID MemoryInformation,
    _In_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> MemoryInformationLength,
    _Out_opt_ PSIZE_T ReturnLength
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/c7a74aeca340d1e3528acaa99b3405f36f41899f/phnt/include/ntzwapi.h#L3536">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">__kernel_entry NTSYSCALLAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NtQueryVirtualMemory(
  [in]            HANDLE                   ProcessHandle,
  [in, optional]  PVOID                    BaseAddress,
  [in]            <a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a> MemoryInformationClass,
  [out]           PVOID                    MemoryInformation,
  [in]            <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                   MemoryInformationLength,
  [out, optional] PSIZE_T                  ReturnLength
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntqueryvirtualmemory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwQueryVirtualMemory(
  [in]            HANDLE                   ProcessHandle,
  [in, optional]  PVOID                    BaseAddress,
  [in]            <a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a> MemoryInformationClass,
  [out]           PVOID                    MemoryInformation,
  [in]            <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                   MemoryInformationLength,
  [out, optional] PSIZE_T                  ReturnLength
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwqueryvirtualmemory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntqueryvirtualmemory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-ntqueryvirtualmemory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ntqueryvirtualmemory-function">NtQueryVirtualMemory function</h1>

<h2 id="description">Description</h2>

<p>The <strong>NtQueryVirtualMemory</strong> routine determines the state, protection, and type of a region of pages within the virtual address space of the specified process.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="processhandle-in"><code>ProcessHandle</code> [in]</h3>

<p>Handle for the process in whose context the pages to be queried reside. Use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/zwcurrentprocess"><strong>NtCurrentProcess</strong></a> macro to specify the current process.</p>

<h3 id="baseaddress-in-optional"><code>BaseAddress</code> [in, optional]</h3>

<p>The base address of the region of pages to be queried. This value is rounded down to the next host-page-address boundary.</p>

<h3 id="memoryinformationclass-in"><code>MemoryInformationClass</code> [in]</h3>

<p>The memory information class about which to retrieve information. Currently, the only supported <strong><a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a></strong> value is <strong><a href="memorybasicinformation" title="#define MemoryBasicInformation 0x0">MemoryBasicInformation</a></strong>.</p>

<h3 id="memoryinformation-out"><code>MemoryInformation</code> [out]</h3>

<p>Pointer to a buffer that receives the specified information. The format and content of the buffer depend on the information class specified in the <em>MemoryInformationClass</em> parameter. When the value <strong><a href="memorybasicinformation" title="#define MemoryBasicInformation 0x0">MemoryBasicInformation</a></strong> is passed to <em>MemoryInformationClass</em>, the <em>MemoryInformation</em> parameter value is a <strong><a href="memory_basic_information" title="typedef struct _MEMORY_BASIC_INFORMATION {&#10;  PVOID  BaseAddress;&#10;  PVOID  AllocationBase;&#10;  ULONG  AllocationProtect;&#10;  USHORT PartitionId;&#10;  SIZE_T RegionSize;&#10;  ULONG  State;&#10;  ULONG  Protect;&#10;  ULONG  Type;&#10;} MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;">MEMORY_BASIC_INFORMATION</a></strong> structure.</p>

<h3 id="memoryinformationlength-in"><code>MemoryInformationLength</code> [in]</h3>

<p>Specifies the length, in bytes, of the buffer that <em>MemoryInformation</em> points to.</p>

<h3 id="returnlength-out-optional"><code>ReturnLength</code> [out, optional]</h3>

<p>An optional pointer which, if specified, receives the number of bytes placed in the <em>MemoryInformation</em> buffer.</p>

<h2 id="return-value">Return value</h2>

<p>Returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful. If the call fails, possible error codes include the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td>The caller had insufficient access rights to perform the requested action.</td>
</tr>
<tr>
  <td>STATUS_ACCESS_VIOLATION</td>
  <td>The specified base address is an invalid virtual address.</td>
</tr>
<tr>
  <td>STATUS_INFO_LENGTH_MISMATCH</td>
  <td>The <em>MemoryInformation</em> buffer is larger than <em>MemoryInformationLength.</em></td>
</tr>
<tr>
  <td>STATUS_INVALID_INFO_CLASS</td>
  <td>The specified <em>MemoryInformationClass</em> parameter is invalid.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER</td>
  <td>The specified base address is outside the range of accessible addresses.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p><strong>ZwQueryVirtualMemory</strong> determines the state of the first page within the region and then scans subsequent entries in the process address map from the base address upward until either the entire range of pages has been scanned or until a page with a non-matching set of attributes is encountered. The region attributes, the length of the region of pages with matching attributes, and an appropriate status value are returned.</p>

<p>If the entire region of pages does not have a matching set of attributes, then the sub-regions within one address reservation will be returned individually. They will have the same <em>*MemoryInformation.AllocationBase</em> value, their individual sizes will be in <em>*MemoryInformation.RegionSize</em>, and the total size of the address reservation can be obtained by summing all of the <em>*MemoryInformation.RegionSize</em> values associated with a particular <em>*MemoryInformation.AllocationBase</em> value.</p>

<p><strong>NtQueryVirtualMemory</strong> and <strong>ZwQueryVirtualMemory</strong> are two versions of the same Windows Native System Services routine.</p>

<p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="memory_basic_information" title="typedef struct _MEMORY_BASIC_INFORMATION {&#10;  PVOID  BaseAddress;&#10;  PVOID  AllocationBase;&#10;  ULONG  AllocationProtect;&#10;  USHORT PartitionId;&#10;  SIZE_T RegionSize;&#10;  ULONG  State;&#10;  ULONG  Protect;&#10;  ULONG  Type;&#10;} MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;">MEMORY_BASIC_INFORMATION</a></strong></p>

<p><strong><a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a></strong></p>

<p><strong><a href="power_platform_information" title="typedef struct _POWER_PLATFORM_INFORMATION {&#10;  BOOLEAN AoAc;&#10;} POWER_PLATFORM_INFORMATION, *PPOWER_PLATFORM_INFORMATION;">POWER_PLATFORM_INFORMATION</a></strong></p>

<p><strong>ZwQueryVirtualMemory</strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntqueryvirtualmemory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-ntqueryvirtualmemory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-zwqueryvirtualmemory)</h1>
</div>
<div class="ntdoc-description">
<h1>ZwQueryVirtualMemory function</h1>

<h2>Description</h2>

<p>The <strong>ZwQueryVirtualMemory</strong> routine determines the state, protection, and type of a region of pages within the virtual address space of the subject process.</p>

<h2>Parameters</h2>

<h3><code>ProcessHandle</code> [in]</h3>

<p>A handle for the process in whose context the pages to be queried reside. Use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/zwcurrentprocess"><strong>ZwCurrentProcess</strong></a> macro to specify the current process.</p>

<h3><code>BaseAddress</code> [in, optional]</h3>

<p>The base address of the region of pages to be queried. This value is rounded down to the next host-page address boundary.</p>

<h3><code>MemoryInformationClass</code> [in]</h3>

<p>The memory information class about which to retrieve information. Currently, the only supported <strong><a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a></strong> value is <strong><a href="memorybasicinformation" title="#define MemoryBasicInformation 0x0">MemoryBasicInformation</a></strong>.</p>

<h3><code>MemoryInformation</code> [out]</h3>

<p>A pointer to a buffer that receives the specified information. The format and content of the buffer depend on the specified information class specified in the <strong>MemoryInformationClass</strong> parameter. When the value <strong><a href="memorybasicinformation" title="#define MemoryBasicInformation 0x0">MemoryBasicInformation</a></strong> is passed to <strong>MemoryInformationClass</strong>, the <strong>MemoryInformation</strong> parameter value is a <strong><a href="memory_basic_information" title="typedef struct _MEMORY_BASIC_INFORMATION {&#10;  PVOID  BaseAddress;&#10;  PVOID  AllocationBase;&#10;  ULONG  AllocationProtect;&#10;  USHORT PartitionId;&#10;  SIZE_T RegionSize;&#10;  ULONG  State;&#10;  ULONG  Protect;&#10;  ULONG  Type;&#10;} MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;">MEMORY_BASIC_INFORMATION</a></strong> structure.</p>

<h3><code>MemoryInformationLength</code> [in]</h3>

<p>Specifies the length in bytes of the memory information buffer.</p>

<h3><code>ReturnLength</code> [out, optional]</h3>

<p>An optional pointer which, if specified, receives the number of bytes placed in the memory information buffer.</p>

<h2>Return value</h2>

<p>Returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful. If the call fails, possible error codes include the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_INVALID_PARAMETER</td>
  <td>The specified base address is outside the range of accessible addresses.</td>
</tr>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td>The caller had insufficient access rights to perform the requested action.</td>
</tr>
<tr>
  <td>STATUS_INFO_LENGTH_MISMATCH</td>
  <td>The <strong>MemoryInformation</strong> buffer is larger than <strong>MemoryInformationLength.</strong></td>
</tr>
<tr>
  <td>STATUS_INVALID_INFO_CLASS</td>
  <td>A value other than <strong><a href="memorybasicinformation" title="#define MemoryBasicInformation 0x0">MemoryBasicInformation</a></strong> was passed to the <strong>MemoryInformationClass</strong> parameter.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p><strong>ZwQueryVirtualMemory</strong> determines the state of the first page within the region and then scans subsequent entries in the process address map from the base address upward until either the entire range of pages has been scanned or until a page with a non-matching set of attributes is encountered. The region attributes, the length of the region of pages with matching attributes, and an appropriate status value are returned.</p>

<p>If the entire region of pages does not have a matching set of attributes, then the <strong>ReturnLength</strong> parameter value can be used to compute the address and length of the region of pages that was not scanned.</p>

<p><strong>NtQueryVirtualMemory</strong> and <strong>ZwQueryVirtualMemory</strong> are two versions of the same Windows Native System Services routine.</p>

<p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>

<h2>See also</h2>

<p><strong><a href="power_platform_information" title="typedef struct _POWER_PLATFORM_INFORMATION {&#10;  BOOLEAN AoAc;&#10;} POWER_PLATFORM_INFORMATION, *PPOWER_PLATFORM_INFORMATION;">POWER_PLATFORM_INFORMATION</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwqueryvirtualmemory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-zwqueryvirtualmemory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is documented in Windows Driver Kit <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntqueryvirtualmemory">here</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwqueryvirtualmemory">here</a>.</p>

<hr />

<p>Function <code>NtQueryVirtualMemory</code> retrieves parameters of queried memory block.</p>

<h3>ProcessHandle</h3>

<p><code>HANDLE</code> to process containing queried address in process'es address space.</p>

<h3>BaseAddress</h3>

<p>Virtual address to query.</p>

<h3>MemoryInformationClass</h3>

<p>Information class defined in <code><a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a></code> enumeration type. Currently only one class is supported.</p>

<h3>Buffer</h3>

<p>As long as only <code><a href="memorybasicinformation" title="#define MemoryBasicInformation 0x0">MemoryBasicInformation</a></code> is supported, this value points to structure <code><a href="memory_basic_information" title="typedef struct _MEMORY_BASIC_INFORMATION {&#10;  PVOID  BaseAddress;&#10;  PVOID  AllocationBase;&#10;  ULONG  AllocationProtect;&#10;  USHORT PartitionId;&#10;  SIZE_T RegionSize;&#10;  ULONG  State;&#10;  ULONG  Protect;&#10;  ULONG  Type;&#10;} MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;">MEMORY_BASIC_INFORMATION</a></code>, defined in <strong>&lt;WINNT.h&gt;</strong> and described in <em>MS SDK</em>.</p>

<h3>Length</h3>

<p>Length of <code>Buffer</code>, in bytes.</p>

<h3>ResultLength</h3>

<p>Optionally pointer to <code><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></code> value receiving required size of <code>Buffer</code>, in bytes.</p>

<h1>Documented by</h1>

<ul>
<li>Tomasz Nowak</li>
<li>ReactOS</li>
</ul>

<h1>See also</h1>

<ul>
<li><code><a href="memory_basic_information" title="typedef struct _MEMORY_BASIC_INFORMATION {&#10;  PVOID  BaseAddress;&#10;  PVOID  AllocationBase;&#10;  ULONG  AllocationProtect;&#10;  USHORT PartitionId;&#10;  SIZE_T RegionSize;&#10;  ULONG  State;&#10;  ULONG  Protect;&#10;  ULONG  Type;&#10;} MEMORY_BASIC_INFORMATION, *PMEMORY_BASIC_INFORMATION;">MEMORY_BASIC_INFORMATION</a></code></li>
<li><code><a href="memory_information_class" title="typedef enum _MEMORY_INFORMATION_CLASS&#10;{&#10;    MemoryBasicInformation,                     // q: MEMORY_BASIC_INFORMATION&#10;    MemoryWorkingSetInformation,                // q: MEMORY_WORKING_SET_INFORMATION&#10;    MemoryMappedFilenameInformation,            // q: UNICODE_STRING&#10;    MemoryRegionInformation,                    // q: MEMORY_REGION_INFORMATION&#10;    MemoryWorkingSetExInformation,              // q: MEMORY_WORKING_SET_EX_INFORMATION // since VISTA&#10;    MemorySharedCommitInformation,              // q: MEMORY_SHARED_COMMIT_INFORMATION // since WIN8&#10;    MemoryImageInformation,                     // q: MEMORY_IMAGE_INFORMATION&#10;    MemoryRegionInformationEx,                  // q: MEMORY_REGION_INFORMATION&#10;    MemoryPrivilegedBasicInformation,           // q: MEMORY_BASIC_INFORMATION&#10;    MemoryEnclaveImageInformation,              // q: MEMORY_ENCLAVE_IMAGE_INFORMATION // since REDSTONE3&#10;    MemoryBasicInformationCapped,               // q: 10&#10;    MemoryPhysicalContiguityInformation,        // q: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // since 20H1&#10;    MemoryBadInformation,                       // q: since WIN11&#10;    MemoryBadInformationAllProcesses,           // qs: not implemented // since 22H1&#10;    MemoryImageExtensionInformation,            // q: MEMORY_IMAGE_EXTENSION_INFORMATION // since 24H2&#10;    MaxMemoryInfoClass&#10;} MEMORY_INFORMATION_CLASS;">MEMORY_INFORMATION_CLASS</a></code></li>
<li><code><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtAllocateVirtualMemory</a></code></li>
<li><code><a href="ntfreevirtualmemory" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtFreeVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ __drv_freesMem(Mem) PVOID *BaseAddress,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG FreeType&#10;    );">NtFreeVirtualMemory</a></code></li>
<li><code><a href="ntlockvirtualmemory" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtLockVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ PVOID *BaseAddress,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG MapType&#10;    );">NtLockVirtualMemory</a></code></li>
<li><code><a href="ntprotectvirtualmemory" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtProtectVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ PVOID *BaseAddress,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG NewProtection,&#10;    _Out_ PULONG OldProtection&#10;    );">NtProtectVirtualMemory</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntqueryvirtualmemory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
