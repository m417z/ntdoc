<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_SETVIDPNSOURCEADDRESS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_SETVIDPNSOURCEADDRESS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_SETVIDPNSOURCEADDRESS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKDDI_SETVIDPNSOURCEADDRESS DxgkddiSetvidpnsourceaddress;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiSetvidpnsourceaddress(
  IN_CONST_HANDLE hAdapter,
  IN_CONST_PDXGKARG_SETVIDPNSOURCEADDRESS pSetVidPnSourceAddress
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_setvidpnsourceaddress">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_setvidpnsourceaddress.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dkmddi-dxgkddi_setvidpnsourceaddress)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <em>DxgkDdiSetVidPnSourceAddress</em> function sets the address of the primary surface that is associated with a particular video present source.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hadapter"><code>hAdapter</code></h3>

<p>A handle to a context block that is associated with a display adapter. The display miniport driver previously provided this handle to the DirectX graphics kernel subsystem in the <em>MiniportDeviceContext</em> output parameter of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_add_device"><strong>DxgkDdiAddDevice</strong></a> function.</p>

<h3 id="psetvidpnsourceaddress"><code>pSetVidPnSourceAddress</code></h3>

<p>A pointer to a <strong><a href="dxgkarg_setvidpnsourceaddress" title="typedef struct _DXGKARG_SETVIDPNSOURCEADDRESS {&#10;       D3DDDI_VIDEO_PRESENT_SOURCE_ID   VidPnSourceId;&#10;       UINT                             PrimarySegment;&#10;       PHYSICAL_ADDRESS                 PrimaryAddress;&#10;  [in] HANDLE                           hAllocation;&#10;  [in] UINT                             ContextCount;&#10;       HANDLE                           Context[1 + D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] DXGK_SETVIDPNSOURCEADDRESS_FLAGS Flags;&#10;       UINT                             Duration;&#10;       DXGK_PRIMARYDATA                 PrimaryData[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;       UINT                             DriverPrivateDataSize;&#10;       PVOID                            pDriverPrivateData;&#10;} DXGKARG_SETVIDPNSOURCEADDRESS;">DXGKARG_SETVIDPNSOURCEADDRESS</a></strong> structure that contains function arguments.</p>

<h2 id="return-value">Return value</h2>

<p><em>DxgkDdiSetVidPnSourceAddress</em> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it succeeds; otherwise, it returns one of the error codes defined in <em>Ntstatus.h</em>.</p>

<p>Starting with Windows 8, the display miniport driver can fail a call to <em>DxgkDdiSetVidPnSourceAddress</em>, returning STATUS_INVALID_PARAMETER, when the <strong>SharedPrimaryTransition</strong> member is set in <em>pSetVidPnSourceAddress</em>-&gt;<strong>Flags</strong>. However, such a failure is not expected unless there is an error in either the user mode driver's implementation of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_checkdirectflipsupport"><em>CheckDirectFlipSupport</em></a> function or in the DWM. If such a failure occurs, the operating system will not seamlessly fail back to composition mode, and presentation will be incorrect.</p>

<h2 id="remarks">Remarks</h2>

<p><em>DxgkDdiSetVidPnSourceAddress</em> is called only with primaries that fit with the currently committed video present network (VidPN) topology. For example, the D3DDDIFMT_A8R8G8B8 format is determined to fit with a VidPN that is committed to a D3DDDIFMT_X8R8G8B8 format, and vice versa.</p>

<p>The DirectX graphics kernel subsystem calls <em>DxgkDdiSetVidPnSourceAddress</em> to switch the display mode and to perform memory-mapped I/O (MMIO)â€“based flip operations. The bit-field flags in the <strong>Flags</strong> member of the <strong><a href="dxgkarg_setvidpnsourceaddress" title="typedef struct _DXGKARG_SETVIDPNSOURCEADDRESS {&#10;       D3DDDI_VIDEO_PRESENT_SOURCE_ID   VidPnSourceId;&#10;       UINT                             PrimarySegment;&#10;       PHYSICAL_ADDRESS                 PrimaryAddress;&#10;  [in] HANDLE                           hAllocation;&#10;  [in] UINT                             ContextCount;&#10;       HANDLE                           Context[1 + D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] DXGK_SETVIDPNSOURCEADDRESS_FLAGS Flags;&#10;       UINT                             Duration;&#10;       DXGK_PRIMARYDATA                 PrimaryData[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;       UINT                             DriverPrivateDataSize;&#10;       PVOID                            pDriverPrivateData;&#10;} DXGKARG_SETVIDPNSOURCEADDRESS;">DXGKARG_SETVIDPNSOURCEADDRESS</a></strong> structure that is pointed to by the <em>pSetVidPnSourceAddress</em> parameter indicates the type of display operation to perform. To switch the display mode, the graphics kernel subsystem sets the <strong>ContextCount</strong> member of <a href="dxgkarg_setvidpnsourceaddress" title="typedef struct _DXGKARG_SETVIDPNSOURCEADDRESS {&#10;       D3DDDI_VIDEO_PRESENT_SOURCE_ID   VidPnSourceId;&#10;       UINT                             PrimarySegment;&#10;       PHYSICAL_ADDRESS                 PrimaryAddress;&#10;  [in] HANDLE                           hAllocation;&#10;  [in] UINT                             ContextCount;&#10;       HANDLE                           Context[1 + D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] DXGK_SETVIDPNSOURCEADDRESS_FLAGS Flags;&#10;       UINT                             Duration;&#10;       DXGK_PRIMARYDATA                 PrimaryData[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;       UINT                             DriverPrivateDataSize;&#10;       PVOID                            pDriverPrivateData;&#10;} DXGKARG_SETVIDPNSOURCEADDRESS;">DXGKARG_SETVIDPNSOURCEADDRESS</a> to zero. In this situation, the content of the array that the <strong>Context</strong> member of <a href="dxgkarg_setvidpnsourceaddress" title="typedef struct _DXGKARG_SETVIDPNSOURCEADDRESS {&#10;       D3DDDI_VIDEO_PRESENT_SOURCE_ID   VidPnSourceId;&#10;       UINT                             PrimarySegment;&#10;       PHYSICAL_ADDRESS                 PrimaryAddress;&#10;  [in] HANDLE                           hAllocation;&#10;  [in] UINT                             ContextCount;&#10;       HANDLE                           Context[1 + D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] DXGK_SETVIDPNSOURCEADDRESS_FLAGS Flags;&#10;       UINT                             Duration;&#10;       DXGK_PRIMARYDATA                 PrimaryData[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;       UINT                             DriverPrivateDataSize;&#10;       PVOID                            pDriverPrivateData;&#10;} DXGKARG_SETVIDPNSOURCEADDRESS;">DXGKARG_SETVIDPNSOURCEADDRESS</a> specifies is undefined. To perform a flip operation, the graphics kernel subsystem sets <strong>ContextCount</strong> to the number of contexts and <strong>Context</strong> to the array of driver context handles for the contexts that contribute to the flip operation.</p>

<p>If the display miniport driver previously indicated, in a call to its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a> function, that it supports a MMIO-based flip (by setting the <strong>FlipOnVSyncMmIo</strong> bit-field flag in the <strong>FlipCaps</strong> member of the <strong><a href="dxgk_drivercaps" title="typedef struct _DXGK_DRIVERCAPS {&#10;  [out] PHYSICAL_ADDRESS                   HighestAcceptableAddress;&#10;  [out] UINT                               MaxAllocationListSlotId;&#10;  [out] SIZE_T                             ApertureSegmentCommitLimit;&#10;  [out] UINT                               MaxPointerWidth;&#10;  [out] UINT                               MaxPointerHeight;&#10;  [out] DXGK_POINTERFLAGS                  PointerCaps;&#10;  [out] UINT                               InterruptMessageNumber;&#10;  [out] UINT                               NumberOfSwizzlingRanges;&#10;  [out] UINT                               MaxOverlays;&#10;  union {&#10;    [out] DXGK_GAMMARAMPCAPS      GammaRampCaps;&#10;    [out] DXGK_COLORTRANSFORMCAPS ColorTransformCaps;&#10;  };&#10;  [out] DXGK_PRESENTATIONCAPS              PresentationCaps;&#10;  [out] UINT                               MaxQueuedFlipOnVSync;&#10;  [out] DXGK_FLIPCAPS                      FlipCaps;&#10;  [out] DXGK_VIDSCHCAPS                    SchedulingCaps;&#10;  [out] DXGK_VIDMMCAPS                     MemoryManagementCaps;&#10;  [out] DXGK_GPUENGINETOPOLOGY             GpuEngineTopology;&#10;...">DXGK_DRIVERCAPS</a></strong> structure to <strong>TRUE</strong>), the driver's <em>DxgkDdiSetVidPnSourceAddress</em> function is subsequently called at device interrupt request level (DIRQL) for flip purposes. The driver's <em>DxgkDdiSetVidPnSourceAddress</em> function must program the DAC and start scanning out, at the following vertical sync, the primary surface whose address is specified in the <strong>PrimaryAddress</strong> member of <a href="dxgkarg_setvidpnsourceaddress" title="typedef struct _DXGKARG_SETVIDPNSOURCEADDRESS {&#10;       D3DDDI_VIDEO_PRESENT_SOURCE_ID   VidPnSourceId;&#10;       UINT                             PrimarySegment;&#10;       PHYSICAL_ADDRESS                 PrimaryAddress;&#10;  [in] HANDLE                           hAllocation;&#10;  [in] UINT                             ContextCount;&#10;       HANDLE                           Context[1 + D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] DXGK_SETVIDPNSOURCEADDRESS_FLAGS Flags;&#10;       UINT                             Duration;&#10;       DXGK_PRIMARYDATA                 PrimaryData[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;       UINT                             DriverPrivateDataSize;&#10;       PVOID                            pDriverPrivateData;&#10;} DXGKARG_SETVIDPNSOURCEADDRESS;">DXGKARG_SETVIDPNSOURCEADDRESS</a>. The driver also must pass the DXGK_INTERRUPT_CRTC_VSYNC interrupt type in the <em>InterruptType</em> parameter in a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkcb_notify_interrupt"><strong>DxgkCbNotifyInterrupt</strong></a> function to report the effective scan address. The driver must follow the call to <strong>DxgkCbNotifyInterrupt</strong> with a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkcb_notify_dpc"><strong>DxgkCbNotifyDpc</strong></a> function.</p>

<p><em>DxgkDdiSetVidPnSourceAddress</em> must be in nonpageable memory. <em>DxgkDdiSetVidPnSourceAddress</em> must not call any code that is in pageable memory and must not manipulate any data that is in pageable memory.</p>

<h3 id="clone-view-situations">Clone-View Situations</h3>

<p>In clone-view situations, the display miniport driver should handle flip operations appropriately as described in this section.</p>

<p>When the DWM is running, the DirectX graphics kernel subsystem flip-synchronizes when a vertical sync occurs. However, the DirectX graphics kernel subsystem can synchronize only when a vertical sync of a single graphics adapter output signal occurs. The DirectX graphics kernel subsystem must immediately flip any other graphics adapter output signals to avoid tearing.</p>

<p>The GPU scheduler will detect a single vertical sync and will determine that the flipped surface is available as soon as the first monitor flip occurs. As a result, the display miniport driver might be rendering to a surface that the second monitor is still displaying.</p>

<p>Video applications (for example, Windows Media Player) are unaware of clone-view situations and expect to have a predictable vertical-sync interval. If the GPU scheduler detected the vertical syncs of both monitors, the vertical sync interval (and therefore the flip) would be unpredictable and would drift over time, which would cause the DWM and video applications to not operate correctly.</p>

<p>For clone-view situations, the display miniport driver must perform a vertical-sync flip on the primary monitor and an MMIO-based immediate flip on the secondary monitor.</p>

<p>The display miniport driver's <em>DxgkDdiSetVidPnSourceAddress</em> function should record the address that is being flipped to in the graphics adapter object.</p>

<p>To direct the display miniport driver to not wait for the next vertical retrace of the secondary monitor, the DirectX graphics kernel subsystem sets the <strong>FlipImmediate</strong> bit-field flag to <strong>TRUE</strong> in a call to the driver's <em>DxgkDdiSetVidPnSourceAddress</em> function.</p>

<p>See requirements on calling this function with multiplane overlays in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/multiplane-overlay-vidpn-presentation">Multiplane overlay VidPN presentation</a>.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="dxgk_drivercaps" title="typedef struct _DXGK_DRIVERCAPS {&#10;  [out] PHYSICAL_ADDRESS                   HighestAcceptableAddress;&#10;  [out] UINT                               MaxAllocationListSlotId;&#10;  [out] SIZE_T                             ApertureSegmentCommitLimit;&#10;  [out] UINT                               MaxPointerWidth;&#10;  [out] UINT                               MaxPointerHeight;&#10;  [out] DXGK_POINTERFLAGS                  PointerCaps;&#10;  [out] UINT                               InterruptMessageNumber;&#10;  [out] UINT                               NumberOfSwizzlingRanges;&#10;  [out] UINT                               MaxOverlays;&#10;  union {&#10;    [out] DXGK_GAMMARAMPCAPS      GammaRampCaps;&#10;    [out] DXGK_COLORTRANSFORMCAPS ColorTransformCaps;&#10;  };&#10;  [out] DXGK_PRESENTATIONCAPS              PresentationCaps;&#10;  [out] UINT                               MaxQueuedFlipOnVSync;&#10;  [out] DXGK_FLIPCAPS                      FlipCaps;&#10;  [out] DXGK_VIDSCHCAPS                    SchedulingCaps;&#10;  [out] DXGK_VIDMMCAPS                     MemoryManagementCaps;&#10;  [out] DXGK_GPUENGINETOPOLOGY             GpuEngineTopology;&#10;...">DXGK_DRIVERCAPS</a></strong></p>

<p><strong><a href="dxgkarg_setvidpnsourceaddress" title="typedef struct _DXGKARG_SETVIDPNSOURCEADDRESS {&#10;       D3DDDI_VIDEO_PRESENT_SOURCE_ID   VidPnSourceId;&#10;       UINT                             PrimarySegment;&#10;       PHYSICAL_ADDRESS                 PrimaryAddress;&#10;  [in] HANDLE                           hAllocation;&#10;  [in] UINT                             ContextCount;&#10;       HANDLE                           Context[1 + D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] DXGK_SETVIDPNSOURCEADDRESS_FLAGS Flags;&#10;       UINT                             Duration;&#10;       DXGK_PRIMARYDATA                 PrimaryData[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;       UINT                             DriverPrivateDataSize;&#10;       PVOID                            pDriverPrivateData;&#10;} DXGKARG_SETVIDPNSOURCEADDRESS;">DXGKARG_SETVIDPNSOURCEADDRESS</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkcb_notify_dpc"><strong>DxgkCbNotifyDpc</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkcb_notify_interrupt"><strong>DxgkCbNotifyInterrupt</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_add_device"><strong>DxgkDdiAddDevice</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_setvidpnsourcevisibility"><strong>DxgkDdiSetVidPnSourceVisibility</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_setvidpnsourceaddress">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/nc-d3dkmddi-dxgkddi_setvidpnsourceaddress.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
