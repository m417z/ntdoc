<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="_BRB_PSM - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>_BRB_PSM - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            _BRB_PSM - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// bthddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">struct _BRB_PSM {
  <a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a> Hdr;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>     Psm;
};</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/ns-bthddi-_brb_psm">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/_brb_psm.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-bthddi-_brb_psm)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_brb_psm-structure">_BRB_PSM structure</h1>

<h2 id="description">Description</h2>

<p>The _BRB_PSM structure describes a Protocol/Service Multiplexer (PSM) to register or
unregister.</p>

<h2 id="members">Members</h2>

<h3 id="hdr"><code>Hdr</code></h3>

<p>A
<a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a> structure that contains information
about the current <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>.</p>

<h3 id="psm"><code>Psm</code></h3>

<p>When the _BRB_PSM structure is passed as input for a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536621(v=vs.85)">BRB_REGISTER_PSM</a> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> call, this is the PSM
that the profile driver attempts to register. If the profile driver sets this value to zero, the PSM is
dynamically generated. If the profile driver specified zero on <strong>BRB_REGISTER_PSM</strong> input, on output this
member contains the PSM that was registered.</p>

<p>When the _BRB_PSM structure is passed as input for a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536632(v=vs.85)">BRB_UNREGISTER_PSM</a> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> call, this is the
PSM that the profile driver attempts to unregister. This value must be a PSM that is currently
registered. For more information about valid PSM values, see the Remarks section.</p>

<p>Some PSMs are reserved for use by Windows:</p>

<p>SDP: 0x01</p>

<p>RFCOMM: 0x03</p>

<p>HID Control: 0x11</p>

<p>HID Data: 0x13</p>

<p>BNEP: 0x0F</p>

<h2 id="remarks">Remarks</h2>

<p>To register a PSM, profile drivers should
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536657(v=vs.85)">build and send</a> a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536621(v=vs.85)">BRB_REGISTER_PSM</a> request.</p>

<p>After a PSM has been registered, the profile driver can receive connection notifications from remote
devices and can build and send
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)">BRB_L2CA_OPEN_CHANNEL_RESPONSE</a> requests to accept incoming connections.</p>

<p>The profile driver can specify a particular PSM or can request that a PSM be dynamically generated by
specifying PSM_INVALID in the
<strong>Psm</strong> member. If the profile driver specifies PSM_INVALID, on output the PSM assigned will be
returned in the
<strong>Psm</strong> member of the structure.</p>

<p>The Bluetooth driver stack registers PSMs for the following profiles: HCRP, HID, PAN, SDP, and
RFCOMM.</p>

<p>For more information about L2CAP servers and PSMs, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536572(v=vs.85)">Accepting
L2CAP Connections in a Bluetooth Profile Driver</a>.</p>

<p>Profile drivers cannot register a PSM that has already been registered by another driver. If one
attempts to do so, a STATUS_ALREADY_COMMITTED error will be returned. The <strong>BRB_REGISTER_PSM</strong> request has no
effect on SDP records. After registering a PSM, drivers can advertise the PSM over SDP by sending the
<a href="ioctl_bth_sdp_submit_record" title="// CTL_CODE(0x0041, 0x085, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_BTH_SDP_SUBMIT_RECORD 0x00410214">IOCTL_BTH_SDP_SUBMIT_RECORD</a> IOCTL.</p>

<p>To unregister a previously registered PSM, profile drivers should
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536657(v=vs.85)">build and send</a> a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536632(v=vs.85)">BRB_UNREGISTER_PSM</a> request. Profile
drivers must specify a PSM that is currently registered. If a profile driver sends a BRB_REGISTER_PSM
request with a value of zero in the
<strong>Psm</strong> member, the dynamically assigned PSM value should be passed in the BRB_UNREGISTER_PSM
request.</p>

<p>A <strong>BRB_UNREGISTER_PSM</strong> request has no effect on SDP records that attempt to connect to the PSM. Profile
drivers can remove relevant SDP records by sending the
<a href="ioctl_bth_sdp_remove_record" title="// CTL_CODE(0x0041, 0x086, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_BTH_SDP_REMOVE_RECORD 0x00410218">IOCTL_BTH_SDP_REMOVE_RECORD</a> IOCTL.</p>

<h2 id="see-also">See also</h2>

<p><a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)">BRB_L2CA_OPEN_CHANNEL_RESPONSE</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536621(v=vs.85)">BRB_REGISTER_PSM</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536632(v=vs.85)">BRB_UNREGISTER_PSM</a></p>

<p><a href="ioctl_bth_sdp_remove_record" title="// CTL_CODE(0x0041, 0x086, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_BTH_SDP_REMOVE_RECORD 0x00410218">IOCTL_BTH_SDP_REMOVE_RECORD</a></p>

<p><a href="ioctl_bth_sdp_submit_record" title="// CTL_CODE(0x0041, 0x085, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_BTH_SDP_SUBMIT_RECORD 0x00410214">IOCTL_BTH_SDP_SUBMIT_RECORD</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/ns-bthddi-_brb_psm">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/bthddi/ns-bthddi-_brb_psm.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
