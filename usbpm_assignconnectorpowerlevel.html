<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="UsbPm_AssignConnectorPowerLevel - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>UsbPm_AssignConnectorPowerLevel - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            UsbPm_AssignConnectorPowerLevel - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// usbpmapi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> UsbPm_AssignConnectorPowerLevel(
  [In] USBPM_CLIENT                               ClientHandle,
  [In] USBPM_CONNECTOR                            ConnectorHandle,
  [In] <a href="usbpm_assign_connector_power_level_params" title="typedef struct _USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS {&#10;  USBC_POWER_ROLE                        PowerRole;&#10;  USBPM_ASSIGN_POWER_LEVEL_PARAMS_FORMAT Format;&#10;  union {&#10;    struct {&#10;      UINT8                               MaximumPdPowerIn500mW;&#10;      USBC_UCSI_SET_POWER_LEVEL_C_CURRENT MaximumTypeCCurrent;&#10;    } Ucsi;&#10;    struct {&#10;      USBC_PD_REQUEST_DATA_OBJECT Rdo;&#10;    } Rdo;&#10;  };&#10;} USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS, *PUSBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS;">PUSBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS</a> Params
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbpmapi/nf-usbpmapi-usbpm_assignconnectorpowerlevel">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/usbpm_assignconnectorpowerlevel.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-usbpmapi-usbpm_assignconnectorpowerlevel)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>UsbPm_AssignConnectorPowerLevel function</h1>
<h2>Description</h2>
<p>Attempts a PD contract renegotiation with the specified voltage/current/power value.</p>
<h2>Parameters</h2>
<h3><code>ClientHandle</code> [In]</h3>
<p>The handle that the client driver received in a previous call to <strong><a href="usbpm_register" title="NTSTATUS UsbPm_Register(&#10;  [In]  PUSBPM_CLIENT_CONFIG ClientConfig,&#10;  [Out] USBPM_CLIENT         *ClientHandle&#10;);">UsbPm_Register</a></strong>.</p>
<h3><code>ConnectorHandle</code> [In]</h3>
<p>The connector handle provided by Policy Manager when it calls the driver's implementation of <strong><a href="evt_usbpm_event_callback" title="EVT_USBPM_EVENT_CALLBACK EvtUsbpmEventCallback;&#10;&#10;VOID EvtUsbpmEventCallback(&#10;  [In] PUSBPM_EVENT_CALLBACK_PARAMS Params&#10;)&#10;{...}">EVT_USBPM_EVENT_CALLBACK</a></strong>. The handle is set in the <strong>EventData.ConnectorStateChange.ConnectorHandle</strong> member of the <em>Params</em> value.</p>
<h3><code>Params</code> [In]</h3>
<p>A pointer to a driver-provided <strong><a href="usbpm_assign_connector_power_level_params" title="typedef struct _USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS {&#10;  USBC_POWER_ROLE                        PowerRole;&#10;  USBPM_ASSIGN_POWER_LEVEL_PARAMS_FORMAT Format;&#10;  union {&#10;    struct {&#10;      UINT8                               MaximumPdPowerIn500mW;&#10;      USBC_UCSI_SET_POWER_LEVEL_C_CURRENT MaximumTypeCCurrent;&#10;    } Ucsi;&#10;    struct {&#10;      USBC_PD_REQUEST_DATA_OBJECT Rdo;&#10;    } Rdo;&#10;  };&#10;} USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS, *PUSBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS;">USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS</a></strong> structure that contains the voltage/current/power value to negotiate. Initialize the structure by calling <strong><a href="usbpm_assign_connector_power_level_params_init" title="VOID USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS_INIT(&#10;  [Out] PUSBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS Params,&#10;  [In]  USBC_POWER_ROLE                            PowerRole,&#10;  [In]  USBPM_ASSIGN_POWER_LEVEL_PARAMS_FORMAT     Format&#10;);">USBPM_ASSIGN_CONNECTOR_POWER_LEVEL_PARAMS_INIT</a></strong>.</p>
<p>Specifying 0 as the voltage/current/power value for a connector in power sink role causes the connector to stop charging.</p>
<h2>Return value</h2>
<p>Returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, returns an appropriate <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS</a> value.</p>
<h2>Remarks</h2>
<p>The negotiated settings are persistent only as long as the port partner is attached, and is discarded when the port partner is detached. The client driver is required to call this function based on the current connector state, without assuming the previous setting.</p>
<p>If this call succeeds, the request has been accepted but PD contract renegotiation might not be complete. The result of PD contract renegotiation can be either success or failure.</p>
<p>As a result of successful PD contract renegotiation, <strong><a href="evt_usbpm_event_callback" title="EVT_USBPM_EVENT_CALLBACK EvtUsbpmEventCallback;&#10;&#10;VOID EvtUsbpmEventCallback(&#10;  [In] PUSBPM_EVENT_CALLBACK_PARAMS Params&#10;)&#10;{...}">EVT_USBPM_EVENT_CALLBACK</a></strong> is invoked with a connector state change event. If PD contract renegotiation request fails, the callback function is not invoked. For example, the request gets rejected by the partner, or is no longer valid because the connector state has changed.
In Windows 10, version 1809, the driver can only call this function with the power role of UsbCPowerRoleSink and when a partner is attached to the connector.</p>
<h2>See also</h2>
<p><strong><a href="usbpm_register" title="NTSTATUS UsbPm_Register(&#10;  [In]  PUSBPM_CLIENT_CONFIG ClientConfig,&#10;  [Out] USBPM_CLIENT         *ClientHandle&#10;);">UsbPm_Register</a></strong></p>
<p><strong><a href="evt_usbpm_event_callback" title="EVT_USBPM_EVENT_CALLBACK EvtUsbpmEventCallback;&#10;&#10;VOID EvtUsbpmEventCallback(&#10;  [In] PUSBPM_EVENT_CALLBACK_PARAMS Params&#10;)&#10;{...}">EVT_USBPM_EVENT_CALLBACK</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbpmapi/nf-usbpmapi-usbpm_assignconnectorpowerlevel">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/usbpmapi/nf-usbpmapi-usbpm_assignconnectorpowerlevel.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
