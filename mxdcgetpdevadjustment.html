<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="MxdcGetPDEVAdjustment - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MxdcGetPDEVAdjustment - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            MxdcGetPDEVAdjustment - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// mxdc.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">HRESULT MxdcGetPDEVAdjustment(
  [in]           HANDLE                    hPrinter,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                     cbDevMode,
  [in]           const DEVMODE             *pDevMode,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                     cbIn,
  [in, optional] const VOID                *pvIn,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                     cbPrintPropertiesCollection,
                 <a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a> *pPrintPropertiesCollection
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mxdc/nf-mxdc-mxdcgetpdevadjustment">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/mxdcgetpdevadjustment.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-mxdc-mxdcgetpdevadjustment)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>MxdcGetPDEVAdjustment</strong> function is exported by a printer interface DLL and supplies printer configuration data for the Microsoft XPS Document Converter (MXDC).</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hprinter-in"><code>hPrinter</code> [in]</h3>

<p>The handle of the currently instantiated printer.</p>

<h3 id="cbdevmode-in"><code>cbDevMode</code> [in]</h3>

<p>The size of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/wingdi/ns-wingdi-devmodew">DEVMODE</a> structure, in bytes, including the driver's private DEVMODE data.</p>

<h3 id="pdevmode-in"><code>pDevMode</code> [in]</h3>

<p>A copy of the DEVMODE structure that the MXDC received. The printer interface DLL uses information from this structure to return the requested data.</p>

<h3 id="cbin-in"><code>cbIn</code> [in]</h3>

<p>An input parameter that designates the size of the <em>pvIn</em> parameter, in bytes. This parameter is currently not used and its value is zero.</p>

<h3 id="pvin-in-optional"><code>pvIn</code> [in, optional]</h3>

<p>A parameter that consists of data that is sent to the printer interface DLL from the MXDC. This parameter is currently not used and its value is <strong>NULL</strong>.</p>

<h3 id="cbprintpropertiescollection-in"><code>cbPrintPropertiesCollection</code> [in]</h3>

<p>The size of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/print/xps-driver-document-events">PrintPropertiesCollection</a> data structure, in bytes.</p>

<h3 id="pprintpropertiescollection"><code>pPrintPropertiesCollection</code></h3>

<p>The <strong><a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a></strong> data structure from which the printer interface's DLL gets the requested data. This structure is defined in WinSpool.h. The requested fields might be pre-filled with the MXDC's default data. The printer interface DLL must ignore the fields that it does not understand.</p>

<h2 id="return-value">Return value</h2>

<p><strong>MxdcGetPDEVAdjustment</strong> should return one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>S_OK</td>
  <td>The printer interface DLL successfully returned an adjusted imageable area, compression type, or DPI based on the given DEVMODE structure. The MXDC will validate the returned imageable area and then use it to populate the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winddi/ns-winddi-gdiinfo">GDIINFO</a> structure to the respective fields.</td>
</tr>
<tr>
  <td>E_NOTIMPL</td>
  <td>The <strong>MxdcGetPDEVAdjustment</strong> function is not implemented by the printer interface. The printer interface must not modify the fields that it does not support. The MXDC defaults to its current defaults. For the imageable area case, MXDC defaults to using the physical page size. For the compression option, MXDC defaults to medium JPEG compression.</td>
</tr>
<tr>
  <td>E_FAIL</td>
  <td>For this value or any other failure values, the MXDC returns -1 to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winddi/nf-winddi-drvenablepdev">DrvEnablePDEV</a> function, catches the internal exception, and sets a flag to fail and end the print job.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The <strong>MxdcGetPDEVAdjustment</strong> function is implemented by the hardware vendor. The MXDC calls this function to obtain printer configuration data in the form of a property bag that includes the following data:</p>

<p>MXDC enables the printer interface DLL to adjust DPI through the <strong>MxdcGetPDEVAdjustment</strong> function only if the print job's <strong>dmPrintQuality</strong> field has a value that is less than or equal to 0. If the DPI value is not adjusted, MXDC maps negative <strong>dmPrintQuality</strong> values to the following resolutions.</p>

<table>
<thead>
<tr>
  <th>GDI name (Wingdi.h)</th>
  <th>GDI value(Wingdi.h)</th>
  <th>MXDC default interpretation(dots per inch)</th>
</tr>
</thead>
<tbody>
<tr>
  <td>DMRES_HIGH</td>
  <td>-4</td>
  <td>2400</td>
</tr>
<tr>
  <td>DMRES_MEDIUM</td>
  <td>-3</td>
  <td>1200</td>
</tr>
<tr>
  <td>DMRES_LOW</td>
  <td>-2</td>
  <td>600</td>
</tr>
<tr>
  <td>DMRES_DRAFT</td>
  <td>-1</td>
  <td>400</td>
</tr>
</tbody>
</table>

<p>The name of the MXDC property that stores the MXDC default DPI value is L"MxdcDotsPerInch".</p>

<p>The following table lists the MXDC's property types and property-bag fields for the properties:</p>

<table>
<thead>
<tr>
  <th>Property (propertyName)</th>
  <th>Property type (ePropertyValue)</th>
  <th>Property-bag fields</th>
</tr>
</thead>
<tbody>
<tr>
  <td>L"MxdcImageableArea"</td>
  <td>kPropertyTypeBuffer</td>
  <td><a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a>::propertiesCollection[i].propertyValue.value.propertyBlob.cbBuf = sizeof(RECT) <a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a>::propertiesCollection[i].propertyValue.value.propertyBlob.pBuf</td>
</tr>
<tr>
  <td>L"MxdcImageCompressionType"</td>
  <td>kPropertyTypeInt32</td>
  <td><a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a>::propertiesCollection[i].propertyValue.value.propertyInt32</td>
</tr>
<tr>
  <td>L"MxdcDotsPerInch"</td>
  <td>kPropertyTypeInt32</td>
  <td><a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a>::propertiesCollection[i].propertyValue.value.propertyInt32</td>
</tr>
<tr>
  <td>L"MxdcLandscapeRotation"</td>
  <td>kPropertyTypeInt32</td>
  <td><a href="printpropertiescollection" title="typedef struct {&#10;  ULONG              numberOfProperties;&#10;  PrintNamedProperty *propertiesCollection;&#10;} PrintPropertiesCollection;">PrintPropertiesCollection</a>::propertiesCollection[i].propertyValue.value.propertyInt32</td>
</tr>
</tbody>
</table>

<p>The following table lists the MXDC's supported data types and data values for the properties:</p>

<table>
<thead>
<tr>
  <th>Property (propertyName)</th>
  <th>Data types and values</th>
</tr>
</thead>
<tbody>
<tr>
  <td>L"MxdcImageableArea"</td>
  <td>Data Type: RECT<br><br>Values:<br><br>RECT::left (Same as FORM_INFO_1)<br><br>RECT::right (Same as FORM_INFO_1)<br><br>RECT::top (Same as FORM_INFO_1)<br><br>RECT::bottom (Same as FORM_INFO_1)</td>
</tr>
<tr>
  <td>L"MxdcImageCompressionType"</td>
  <td>Data Type: <a href="long" title="typedef long LONG;">LONG</a><br><br>Values:<br><br>1 = JPEG High Compression<br><br>2 = JPEG Medium Compression<br><br>3 = JPEG Low Compression<br><br>4 = PNG Compression</td>
</tr>
<tr>
  <td>L"MxdcDotsPerInch"</td>
  <td>Data Type: <a href="long" title="typedef long LONG;">LONG</a><br><br>Values:<br><br>A positive value for Dots Per Inch</td>
</tr>
<tr>
  <td>L"MxdcLandscapeRotation"</td>
  <td>Data Type: <a href="long" title="typedef long LONG;">LONG</a><br><br>Values:<br><br>90 = MXDC_LANDSCAPE_ROTATE_COUNTERCLOCKWISE_90_DEGREES<br><br>0 = MXDC_LANDSCAPE_ROTATE_NONE<br><br>-90 = MXDC_LANDSCAPE_ROTATE_COUNTERCLOCKWISE_270_DEGREES</td>
</tr>
</tbody>
</table>

<p>The <strong>MxdcGetPDEVAdjustment</strong> function is not a part of the MXDC. The MXDC calls back to this function in the driver's configuration DLL to obtain data for configuring the printer.</p>

<p>The MXDC expects the imageable area to be expressed in unrotated coordinates (portrait orientation). The MXDC rotates both the page size and the imageable area according to the value of the <strong>dmOrientation</strong> member of the DEVMODE structure pointed to by <em>pDevMode</em>. Thus, the hardware vendor's implementation of <strong>MxdcGetPDEVAdjustment</strong> should avoid specifying the imageable area in rotated coordinates (landscape orientation) because this will cause landscape print jobs to print incorrectly.</p>

<p>The default value in the MXDC will be MXDC_LANDSCAPE_ROTATE_COUNTERCLOCKWISE_270_DEGREES, which is its current legacy behavior.</p>

<p>All rotation will be done on the imageable area. If a configuration component (UniDrv/PostScript, XPSDrv Monolithic) does not understand the new property bag values, then it should ignore them as is in the current design.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winddi/nf-winddi-drvenablepdev">DrvEnablePDEV</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winddi/ns-winddi-gdiinfo">GDIINFO</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/prcomoem/nn-prcomoem-iprintoemuimxdc">IPrintOemUIMXDC Interface</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mxdc/nf-mxdc-mxdcgetpdevadjustment">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/mxdc/nf-mxdc-mxdcgetpdevadjustment.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
