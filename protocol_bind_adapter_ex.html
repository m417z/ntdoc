<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PROTOCOL_BIND_ADAPTER_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PROTOCOL_BIND_ADAPTER_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PROTOCOL_BIND_ADAPTER_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ndis.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">PROTOCOL_BIND_ADAPTER_EX ProtocolBindAdapterEx;

NDIS_STATUS ProtocolBindAdapterEx(
  [in] NDIS_HANDLE ProtocolDriverContext,
  [in] NDIS_HANDLE BindContext,
  [in] <a href="ndis_bind_parameters" title="typedef struct _NDIS_BIND_PARAMETERS {&#10;  NDIS_OBJECT_HEADER                Header;&#10;  PNDIS_STRING                      ProtocolSection;&#10;  PNDIS_STRING                      AdapterName;&#10;  PDEVICE_OBJECT                    PhysicalDeviceObject;&#10;  NDIS_MEDIUM                       MediaType;&#10;  ULONG                             MtuSize;&#10;  ULONG64                           MaxXmitLinkSpeed;&#10;  ULONG64                           XmitLinkSpeed;&#10;  ULONG64                           MaxRcvLinkSpeed;&#10;  ULONG64                           RcvLinkSpeed;&#10;  NDIS_MEDIA_CONNECT_STATE          MediaConnectState;&#10;  NDIS_MEDIA_DUPLEX_STATE           MediaDuplexState;&#10;  ULONG                             LookaheadSize;&#10;  PNDIS_PNP_CAPABILITIES            PowerManagementCapabilities;&#10;  ULONG                             SupportedPacketFilters;&#10;  ULONG                             MaxMulticastListSize;&#10;  USHORT                            MacAddressLength;&#10;  UCHAR                             CurrentMacAddress[NDIS_MAX_PHYS_ADDRESS_LENGTH];&#10;  NDIS_PHYSICAL_MEDIUM              PhysicalMediumType;&#10;...">PNDIS_BIND_PARAMETERS</a> BindParameters
)
{...}</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_bind_adapter_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/protocol_bind_adapter_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-protocol_bind_adapter_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>PROTOCOL_BIND_ADAPTER_EX callback function</h1>
<h2>Description</h2>
<p>NDIS calls a protocol driver's
<strong>ProtocolBindAdapterEx</strong> function to request the driver to bind to a miniport
adapter.</p>
<p><strong>Note</strong> You must declare the function by using the <strong>PROTOCOL_BIND_ADAPTER_EX</strong> type. For more
information, see the following Examples section.</p>
<h2>Parameters</h2>
<h3><code>ProtocolDriverContext</code> [in]</h3>
<p>A handle to a driver-allocated context area where the driver maintains state and configuration
information. The protocol driver passed this context area to the
<a href="ndisregisterprotocoldriver" title="NDIS_STATUS NdisRegisterProtocolDriver(&#10;  [in, optional] NDIS_HANDLE                           ProtocolDriverContext,&#10;  [in]           PNDIS_PROTOCOL_DRIVER_CHARACTERISTICS ProtocolCharacteristics,&#10;  [out]          PNDIS_HANDLE                          NdisProtocolHandle&#10;);">NdisRegisterProtocolDriver</a> function.</p>
<h3><code>BindContext</code> [in]</h3>
<p>The handle that identifies the NDIS context area for this bind operation.</p>
<h3><code>BindParameters</code> [in]</h3>
<p>A pointer to an
<a href="ndis_bind_parameters" title="typedef struct _NDIS_BIND_PARAMETERS {&#10;  NDIS_OBJECT_HEADER                Header;&#10;  PNDIS_STRING                      ProtocolSection;&#10;  PNDIS_STRING                      AdapterName;&#10;  PDEVICE_OBJECT                    PhysicalDeviceObject;&#10;  NDIS_MEDIUM                       MediaType;&#10;  ULONG                             MtuSize;&#10;  ULONG64                           MaxXmitLinkSpeed;&#10;  ULONG64                           XmitLinkSpeed;&#10;  ULONG64                           MaxRcvLinkSpeed;&#10;  ULONG64                           RcvLinkSpeed;&#10;  NDIS_MEDIA_CONNECT_STATE          MediaConnectState;&#10;  NDIS_MEDIA_DUPLEX_STATE           MediaDuplexState;&#10;  ULONG                             LookaheadSize;&#10;  PNDIS_PNP_CAPABILITIES            PowerManagementCapabilities;&#10;  ULONG                             SupportedPacketFilters;&#10;  ULONG                             MaxMulticastListSize;&#10;  USHORT                            MacAddressLength;&#10;  UCHAR                             CurrentMacAddress[NDIS_MAX_PHYS_ADDRESS_LENGTH];&#10;  NDIS_PHYSICAL_MEDIUM              PhysicalMediumType;&#10;...">NDIS_BIND_PARAMETERS</a> structure that
NDIS created.</p>
<h2>Return value</h2>
<p><strong>ProtocolBindAdapterEx</strong> returns one of the following status values:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>NDIS_STATUS_SUCCESS</strong></td>
<td><strong>ProtocolBindAdapterEx</strong> successfully completed the binding to the underlying miniport adapter.</td>
</tr>
<tr>
<td><strong>NDIS_STATUS_PENDING</strong></td>
<td><strong>ProtocolBindAdapterEx</strong> did not complete the bind operation and the operation will be completed asynchronously. The protocol driver must call the <a href="ndiscompletebindadapterex" title="VOID NdisCompleteBindAdapterEx(&#10;       NDIS_HANDLE BindAdapterContext,&#10;  [in] NDIS_STATUS Status&#10;);">NdisCompleteBindAdapterEx</a> function when the operation is complete.</td>
</tr>
<tr>
<td><strong>NDIS_STATUS_RESOURCES</strong></td>
<td><strong>ProtocolBindAdapterEx</strong> could not allocate the resources that the driver requires to carry out network I/O operations.</td>
</tr>
<tr>
<td><strong>NDIS_STATUS_XXX or NTSTATUS_XXX</strong></td>
<td>The protocol driver's attempt to set up a binding failed. Usually, such an error status is propagated from an <strong>Ndis__Xxx__</strong> function or a kernel-mode support routine.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p><strong>ProtocolBindAdapterEx</strong> is a required function. NDIS calls
<strong>ProtocolBindAdapterEx</strong> to perform binding operations whenever an underlying
miniport adapter, to which the protocol driver can bind, becomes available.</p>
<p><strong>ProtocolBindAdapterEx</strong> allocates sufficient memory to maintain the binding
context information and calls the
<a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a> function to bind
itself to the underlying miniport adapter.
<strong>ProtocolBindAdapterEx</strong> passes a pointer to the binding context information at
the
<strong>ProtocolBindingContext</strong> parameter of
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong>.
<strong>ProtocolBindAdapterEx</strong> passes the value at the
<strong>AdapterName</strong> member from its
<strong>BindParameters</strong> parameter as the
<strong>AdapterName</strong> member of the
<strong>OpenParameters</strong> parameter of
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong><strong>.</strong></p>
<p>Before the driver calls
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong>, the driver can pass the pointer at
<strong>BindParameters</strong> to the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/ndis-ndisopenconfigurationex">NdisOpenConfigurationEx</a> function
to read the configuration parameters that are associated with a miniport adapter.</p>
<p>After opening the miniport adapter successfully, the driver can pass the handle from
<strong>NdisHandle</strong> parameter of
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> to
<strong><a href="ndisopenconfigurationex" title="NDIS_STATUS NdisOpenConfigurationEx(&#10;  [in]  PNDIS_CONFIGURATION_OBJECT ConfigObject,&#10;  [out] PNDIS_HANDLE               ConfigurationHandle&#10;);">NdisOpenConfigurationEx</a></strong> to obtain a handle to the registry location where the configuration
parameters for a protocol binding are stored.</p>
<p><strong>ProtocolBindAdapterEx</strong> passes
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> a pointer to an array of medium type values that lists the types of media that
the protocol driver can support. This list is a subset of the
<a href="ndis_medium" title="typedef enum _NDIS_MEDIUM {&#10;  NdisMedium802_3,&#10;  NdisMedium802_5,&#10;  NdisMediumFddi,&#10;  NdisMediumWan,&#10;  NdisMediumLocalTalk,&#10;  NdisMediumDix,&#10;  NdisMediumArcnetRaw,&#10;  NdisMediumArcnet878_2,&#10;  NdisMediumAtm,&#10;  NdisMediumWirelessWan,&#10;  NdisMediumIrda,&#10;  NdisMediumBpc,&#10;  NdisMediumCoWan,&#10;  NdisMedium1394,&#10;  NdisMediumInfiniBand,&#10;  NdisMediumTunnel,&#10;  NdisMediumNative802_11,&#10;  NdisMediumLoopback,&#10;  NdisMediumWiMAX,&#10;...">NDIS_MEDIUM</a> types. NDIS indicates the selected
medium type at the
<strong>SelectedMediumIndex</strong> parameter of the structure at
<strong>OpenParameters</strong>.</p>
<p>If
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> returns an error status,
<strong>ProtocolBindAdapterEx</strong> returns that error status, releases any per-binding
resources that the protocol driver allocated, and returns control immediately.</p>
<p>If
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> returns NDIS_STATUS_SUCCESS,
<strong>ProtocolBindAdapterEx</strong> can allocate the remaining resources that the protocol
driver needs to carry out network I/O on the binding. The driver can also configure any binding-specific
context information that the driver uses to track network I/O operations.</p>
<p>If
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> returns NDIS_STATUS_PENDING, NDIS calls the protocol driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_open_adapter_complete_ex">ProtocolOpenAdapterCompleteEx</a> function after the open operation is complete.
<strong>ProtocolOpenAdapterCompleteEx</strong> can complete the binding operations.
<strong>ProtocolBindAdapterEx</strong> can store the
<strong>BindContext</strong> handle in the binding context area. NDIS passes
<strong>ProtocolBindingContext</strong> as an input parameter to the driver's
<strong>ProtocolOpenAdapterCompleteEx</strong> function.</p>
<p>If
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> returns NDIS_STATUS_PENDING, NDIS sets the
<strong>SelectedMediumIndex</strong> member of the structure at the
<strong>OpenParameters</strong> parameter and the value of the
<strong>NdisBindingHandle</strong> parameter after
<strong><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></strong> returns. NDIS sets these values before calling
<strong>ProtocolOpenAdapterCompleteEx</strong>. Therefore, the protocol driver must store the
open parameters structure, and the protocol binding handle in the context area at
<strong>ProtocolBindingContext</strong>(or any location that is valid until NDIS calls
<strong>ProtocolOpenAdapterCompleteEx</strong>).</p>
<p>A protocol driver cannot make OID requests on a binding until the open operation is complete. Because
the binding is in the paused state after the open operation is complete, the protocol driver cannot make
send requests until after NDIS restarts the binding.</p>
<p>After the open operation is complete,
<strong>ProtocolBindAdapterEx</strong> can return NDIS_STATUS_SUCCESS to complete the binding
operation.
<strong>ProtocolBindAdapterEx</strong> can return NDIS_STATUS_PENDING to defer the completion of
the binding operations to a later time. If
<strong>ProtocolBindAdapterEx</strong> returns NDIS_STATUS_PENDING, the driver must call the
<a href="ndiscompletebindadapterex" title="VOID NdisCompleteBindAdapterEx(&#10;       NDIS_HANDLE BindAdapterContext,&#10;  [in] NDIS_STATUS Status&#10;);">NdisCompleteBindAdapterEx</a> function after the binding operation is complete.</p>
<p>Protocol drivers should use the
<a href="ndis_bind_parameters" title="typedef struct _NDIS_BIND_PARAMETERS {&#10;  NDIS_OBJECT_HEADER                Header;&#10;  PNDIS_STRING                      ProtocolSection;&#10;  PNDIS_STRING                      AdapterName;&#10;  PDEVICE_OBJECT                    PhysicalDeviceObject;&#10;  NDIS_MEDIUM                       MediaType;&#10;  ULONG                             MtuSize;&#10;  ULONG64                           MaxXmitLinkSpeed;&#10;  ULONG64                           XmitLinkSpeed;&#10;  ULONG64                           MaxRcvLinkSpeed;&#10;  ULONG64                           RcvLinkSpeed;&#10;  NDIS_MEDIA_CONNECT_STATE          MediaConnectState;&#10;  NDIS_MEDIA_DUPLEX_STATE           MediaDuplexState;&#10;  ULONG                             LookaheadSize;&#10;  PNDIS_PNP_CAPABILITIES            PowerManagementCapabilities;&#10;  ULONG                             SupportedPacketFilters;&#10;  ULONG                             MaxMulticastListSize;&#10;  USHORT                            MacAddressLength;&#10;  UCHAR                             CurrentMacAddress[NDIS_MAX_PHYS_ADDRESS_LENGTH];&#10;  NDIS_PHYSICAL_MEDIUM              PhysicalMediumType;&#10;...">NDIS_BIND_PARAMETERS</a> structure to
determine the underlying miniport adapter's capabilities. After the open operation is complete, depending
on the underlying media, the protocol driver can call the
<a href="ndisoidrequest" title="NDIS_STATUS NdisOidRequest(&#10;  [in] NDIS_HANDLE       NdisBindingHandle,&#10;  [in] PNDIS_OID_REQUEST OidRequest&#10;);">NdisOidRequest</a> function to query the
underlying miniport driver (or NDIS) about additional miniport adapter capabilities. For more information
about OID requests, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/protocol-driver-oid-requests">Protocol Driver OID Requests</a>.</p>
<p>NDIS can call a protocol driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_receive_net_buffer_lists">ProtocolReceiveNetBufferLists</a> function after the driver sets up a packet filter for the binding
with the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-gen-current-packet-filter">OID_GEN_CURRENT_PACKET_FILTER</a> OID. If the underlying miniport adapter does not use a packet filter
for incoming packets, receive indications are enabled after the open operation is complete. Protocol
drivers can receive status indications at the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_status_ex">ProtocolStatusEx</a> function after the
open operation is complete.</p>
<p>Every protocol driver should allocate sufficient
<a href="net_buffer" title="typedef struct _NET_BUFFER {&#10;  union {&#10;    struct {&#10;      NET_BUFFER *Next;&#10;      MDL        *CurrentMdl;&#10;      ULONG      CurrentMdlOffset;&#10;      union {&#10;        ULONG  DataLength;&#10;        SIZE_T stDataLength;&#10;      };&#10;      MDL        *MdlChain;&#10;      ULONG      DataOffset;&#10;    };&#10;    SLIST_HEADER      Link;&#10;    NET_BUFFER_HEADER NetBufferHeader;&#10;  };&#10;  USHORT           ChecksumBias;&#10;  USHORT           Reserved;&#10;  NDIS_HANDLE      NdisPoolHandle;&#10;  PVOID            NdisReserved[2];&#10;...">NET_BUFFER</a> and
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure pools. The driver
allocates network data descriptors from these pools for subsequent send operations.</p>
<p>If
<strong>ProtocolBindAdapterEx</strong> cannot allocate the resources it needs to carry out
subsequent network I/O operations, it should free all resources it has already allocated, and return an
appropriate error value.</p>
<p>NDIS calls a protocol driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_unbind_adapter_ex">ProtocolUnbindAdapterEx</a> function to request the driver to unbind from an underlying miniport
adapter.</p>
<p>If the protocol driver successfully opens the miniport adapter but the bind operation fails (for
example, as a result of a failed OID request), the driver must close the miniport adapter from within the
context of
<strong>ProtocolBindAdapterEx</strong> or
<strong>ProtocolUnbindAdapterEx</strong>. For example, the driver calls
<a href="ndiscloseadapterex" title="NDIS_STATUS NdisCloseAdapterEx(&#10;  [in] NDIS_HANDLE NdisBindingHandle&#10;);">NdisCloseAdapterEx</a> from
<strong>ProtocolBindAdapterEx</strong> and waits for the close operation to complete before the
driver returns from
<strong>ProtocolBindAdapterEx</strong>. As an alternative, if the driver returned
NDIS_STATUS_PENDING from
<strong>ProtocolBindAdapterEx</strong>, the driver can call the
<a href="ndisunbindadapter" title="NDIS_STATUS NdisUnbindAdapter(&#10;  [in] NDIS_HANDLE NdisBindingHandle&#10;);">NdisUnbindAdapter</a> function and call
<strong><a href="ndiscloseadapterex" title="NDIS_STATUS NdisCloseAdapterEx(&#10;  [in] NDIS_HANDLE NdisBindingHandle&#10;);">NdisCloseAdapterEx</a></strong> in the
<strong>ProtocolUnbindAdapterEx</strong> function.</p>
<p>NDIS calls
<strong>ProtocolBindAdapterEx</strong> at IRQL = PASSIVE_LEVEL.</p>
<h3>Examples</h3>
<p>To define a <strong>ProtocolBindAdapterEx</strong> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>
<p>For example, to define a <strong>ProtocolBindAdapterEx</strong> function that is named &quot;MyBindAdapterEx&quot;, use the <strong>PROTOCOL_BIND_ADAPTER_EX</strong> type as shown in this code example:</p>
<pre><code>PROTOCOL_BIND_ADAPTER_EX MyBindAdapterEx;
</code></pre>
<p>Then, implement your function as follows:</p>
<pre><code>_Use_decl_annotations_
NDIS_STATUS
 MyBindAdapterEx(
    NDIS_HANDLE  ProtocolDriverContext,
    NDIS_HANDLE  BindContext,
    <a href="ndis_bind_parameters" title="typedef struct _NDIS_BIND_PARAMETERS {&#10;  NDIS_OBJECT_HEADER                Header;&#10;  PNDIS_STRING                      ProtocolSection;&#10;  PNDIS_STRING                      AdapterName;&#10;  PDEVICE_OBJECT                    PhysicalDeviceObject;&#10;  NDIS_MEDIUM                       MediaType;&#10;  ULONG                             MtuSize;&#10;  ULONG64                           MaxXmitLinkSpeed;&#10;  ULONG64                           XmitLinkSpeed;&#10;  ULONG64                           MaxRcvLinkSpeed;&#10;  ULONG64                           RcvLinkSpeed;&#10;  NDIS_MEDIA_CONNECT_STATE          MediaConnectState;&#10;  NDIS_MEDIA_DUPLEX_STATE           MediaDuplexState;&#10;  ULONG                             LookaheadSize;&#10;  PNDIS_PNP_CAPABILITIES            PowerManagementCapabilities;&#10;  ULONG                             SupportedPacketFilters;&#10;  ULONG                             MaxMulticastListSize;&#10;  USHORT                            MacAddressLength;&#10;  UCHAR                             CurrentMacAddress[NDIS_MAX_PHYS_ADDRESS_LENGTH];&#10;  NDIS_PHYSICAL_MEDIUM              PhysicalMediumType;&#10;...">PNDIS_BIND_PARAMETERS</a>  BindParameters
    )
  {...}
</code></pre>
<p>The <strong>PROTOCOL_BIND_ADAPTER_EX</strong> function type is defined in the Ndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the <em>Use_decl_annotations</em> annotation to your function definition. The <em>Use_decl_annotations</em> annotation ensures that the annotations that are applied to the <strong>PROTOCOL_BIND_ADAPTER_EX</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>
<p>For information about <em>Use_decl_annotations</em>, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>
<h2>See also</h2>
<p><a href="ndis_bind_parameters" title="typedef struct _NDIS_BIND_PARAMETERS {&#10;  NDIS_OBJECT_HEADER                Header;&#10;  PNDIS_STRING                      ProtocolSection;&#10;  PNDIS_STRING                      AdapterName;&#10;  PDEVICE_OBJECT                    PhysicalDeviceObject;&#10;  NDIS_MEDIUM                       MediaType;&#10;  ULONG                             MtuSize;&#10;  ULONG64                           MaxXmitLinkSpeed;&#10;  ULONG64                           XmitLinkSpeed;&#10;  ULONG64                           MaxRcvLinkSpeed;&#10;  ULONG64                           RcvLinkSpeed;&#10;  NDIS_MEDIA_CONNECT_STATE          MediaConnectState;&#10;  NDIS_MEDIA_DUPLEX_STATE           MediaDuplexState;&#10;  ULONG                             LookaheadSize;&#10;  PNDIS_PNP_CAPABILITIES            PowerManagementCapabilities;&#10;  ULONG                             SupportedPacketFilters;&#10;  ULONG                             MaxMulticastListSize;&#10;  USHORT                            MacAddressLength;&#10;  UCHAR                             CurrentMacAddress[NDIS_MAX_PHYS_ADDRESS_LENGTH];&#10;  NDIS_PHYSICAL_MEDIUM              PhysicalMediumType;&#10;...">NDIS_BIND_PARAMETERS</a></p>
<p><a href="ndis_medium" title="typedef enum _NDIS_MEDIUM {&#10;  NdisMedium802_3,&#10;  NdisMedium802_5,&#10;  NdisMediumFddi,&#10;  NdisMediumWan,&#10;  NdisMediumLocalTalk,&#10;  NdisMediumDix,&#10;  NdisMediumArcnetRaw,&#10;  NdisMediumArcnet878_2,&#10;  NdisMediumAtm,&#10;  NdisMediumWirelessWan,&#10;  NdisMediumIrda,&#10;  NdisMediumBpc,&#10;  NdisMediumCoWan,&#10;  NdisMedium1394,&#10;  NdisMediumInfiniBand,&#10;  NdisMediumTunnel,&#10;  NdisMediumNative802_11,&#10;  NdisMediumLoopback,&#10;  NdisMediumWiMAX,&#10;...">NDIS_MEDIUM</a></p>
<p><a href="net_buffer" title="typedef struct _NET_BUFFER {&#10;  union {&#10;    struct {&#10;      NET_BUFFER *Next;&#10;      MDL        *CurrentMdl;&#10;      ULONG      CurrentMdlOffset;&#10;      union {&#10;        ULONG  DataLength;&#10;        SIZE_T stDataLength;&#10;      };&#10;      MDL        *MdlChain;&#10;      ULONG      DataOffset;&#10;    };&#10;    SLIST_HEADER      Link;&#10;    NET_BUFFER_HEADER NetBufferHeader;&#10;  };&#10;  USHORT           ChecksumBias;&#10;  USHORT           Reserved;&#10;  NDIS_HANDLE      NdisPoolHandle;&#10;  PVOID            NdisReserved[2];&#10;...">NET_BUFFER</a></p>
<p><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></p>
<p><a href="ndiscloseadapterex" title="NDIS_STATUS NdisCloseAdapterEx(&#10;  [in] NDIS_HANDLE NdisBindingHandle&#10;);">NdisCloseAdapterEx</a></p>
<p><a href="ndiscompletebindadapterex" title="VOID NdisCompleteBindAdapterEx(&#10;       NDIS_HANDLE BindAdapterContext,&#10;  [in] NDIS_STATUS Status&#10;);">NdisCompleteBindAdapterEx</a></p>
<p><a href="ndisoidrequest" title="NDIS_STATUS NdisOidRequest(&#10;  [in] NDIS_HANDLE       NdisBindingHandle,&#10;  [in] PNDIS_OID_REQUEST OidRequest&#10;);">NdisOidRequest</a></p>
<p><a href="ndisopenadapterex" title="NDIS_STATUS NdisOpenAdapterEx(&#10;  [in]  NDIS_HANDLE           NdisProtocolHandle,&#10;  [in]  NDIS_HANDLE           ProtocolBindingContext,&#10;  [in]  PNDIS_OPEN_PARAMETERS OpenParameters,&#10;  [in]  NDIS_HANDLE           BindContext,&#10;  [out] PNDIS_HANDLE          NdisBindingHandle&#10;);">NdisOpenAdapterEx</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/ndis-ndisopenconfigurationex">NdisOpenConfigurationEx</a></p>
<p><a href="ndisregisterprotocoldriver" title="NDIS_STATUS NdisRegisterProtocolDriver(&#10;  [in, optional] NDIS_HANDLE                           ProtocolDriverContext,&#10;  [in]           PNDIS_PROTOCOL_DRIVER_CHARACTERISTICS ProtocolCharacteristics,&#10;  [out]          PNDIS_HANDLE                          NdisProtocolHandle&#10;);">NdisRegisterProtocolDriver</a></p>
<p><a href="ndisunbindadapter" title="NDIS_STATUS NdisUnbindAdapter(&#10;  [in] NDIS_HANDLE NdisBindingHandle&#10;);">NdisUnbindAdapter</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-gen-current-packet-filter">OID_GEN_CURRENT_PACKET_FILTER</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_open_adapter_complete_ex">ProtocolOpenAdapterCompleteEx</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_receive_net_buffer_lists">ProtocolReceiveNetBufferLists</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_status_ex">ProtocolStatusEx</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_unbind_adapter_ex">ProtocolUnbindAdapterEx</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_bind_adapter_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-protocol_bind_adapter_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
