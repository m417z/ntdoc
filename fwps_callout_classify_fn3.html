<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FWPS_CALLOUT_CLASSIFY_FN3 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FWPS_CALLOUT_CLASSIFY_FN3 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FWPS_CALLOUT_CLASSIFY_FN3 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fwpsk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">FWPS_CALLOUT_CLASSIFY_FN3 FwpsCalloutClassifyFn3;

void FwpsCalloutClassifyFn3(
  const FWPS_INCOMING_VALUES0 *inFixedValues,
  const <a href="fwps_incoming_metadata_values0_" title="typedef struct FWPS_INCOMING_METADATA_VALUES0_ {&#10;  UINT32                          currentMetadataValues;&#10;  UINT32                          flags;&#10;  UINT64                          reserved;&#10;  FWPS_DISCARD_METADATA0          discardMetadata;&#10;  UINT64                          flowHandle;&#10;  UINT32                          ipHeaderSize;&#10;  UINT32                          transportHeaderSize;&#10;  FWP_BYTE_BLOB                   *processPath;&#10;  UINT64                          token;&#10;  UINT64                          processId;&#10;  UINT32                          sourceInterfaceIndex;&#10;  UINT32                          destinationInterfaceIndex;&#10;  ULONG                           compartmentId;&#10;  FWPS_INBOUND_FRAGMENT_METADATA0 fragmentMetadata;&#10;  ULONG                           pathMtu;&#10;  HANDLE                          completionHandle;&#10;  UINT64                          transportEndpointHandle;&#10;  SCOPE_ID                        remoteScopeId;&#10;  WSACMSGHDR                      *controlData;&#10;...">FWPS_INCOMING_METADATA_VALUES0</a> *inMetaValues,
  void *layerData,
  const void *classifyContext,
  const FWPS_FILTER3 *filter,
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a> flowContext,
  FWPS_CLASSIFY_OUT0 *classifyOut
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fwpsk/nc-fwpsk-fwps_callout_classify_fn3">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fwps_callout_classify_fn3.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-fwpsk-fwps_callout_classify_fn3)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>Version 3 of the callback function invoked during classification when a callout filter matches. The difference being that this callback returns an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_filter3">FWPS_FILTER3</a> structure.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="infixedvalues"><code>inFixedValues</code></h3>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_incoming_values0">FWPS_INCOMING_VALUES0</a> structure. This structure contains the values for each of the data fields at the layer being filtered.</p>

<h3 id="inmetavalues"><code>inMetaValues</code></h3>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpsu/ns-fwpsu-fwps_incoming_metadata_values0">FWPS_INCOMING_METADATA_VALUES0</a> structure. This structure contains the values for each of the metadata fields at the layer being filtered.</p>

<h3 id="layerdata"><code>layerData</code></h3>

<p>A pointer to a structure that describes the raw data at the layer being filtered. This parameter might be <strong>NULL</strong>, depending on the layer being filtered and the conditions under which the <strong>classifyFn3</strong> callout function is called. For the stream layer, this parameter points to an <strong><a href="fwps_stream_callout_io_packet0_" title="typedef struct FWPS_STREAM_CALLOUT_IO_PACKET0_ {&#10;  FWPS_STREAM_DATA0       *streamData;&#10;  SIZE_T                  missedBytes;&#10;  UINT32                  countBytesRequired;&#10;  SIZE_T                  countBytesEnforced;&#10;  FWPS_STREAM_ACTION_TYPE streamAction;&#10;} FWPS_STREAM_CALLOUT_IO_PACKET0;">FWPS_STREAM_CALLOUT_IO_PACKET0</a></strong> structure. For all of the other layers, this parameter points to a <strong><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></strong> structure if it is not <strong>NULL</strong>.</p>

<h3 id="classifycontext"><code>classifyContext</code></h3>

<p>A pointer to context data associated with the callout driver by the filter engine.</p>

<h3 id="filter"><code>filter</code></h3>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_filter3">FWPS_FILTER3</a> structure. This structure describes the filter that specifies the callout for the filter's action.</p>

<h3 id="flowcontext"><code>flowContext</code></h3>

<p>A <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>-typed variable that contains the context associated with the data flow. If no context is associated with the data flow, then this parameter is zero. If the callout is added to the filter engine at a filtering layer that does not support data flows, the <strong>classifyFn3</strong> callout function should ignore this parameter.</p>

<h3 id="classifyout"><code>classifyOut</code></h3>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_classify_out0">FWPS_CLASSIFY_OUT0</a> structure that receives any data that the <strong>classifyFn3</strong> callout function returns to the caller.</p>

<h2 id="remarks">Remarks</h2>

<p>A callout driver registers a callout's callout functions with the filter engine by calling the <strong><a href="fwpscalloutregister2" title="NTSTATUS FwpsCalloutRegister2(&#10;  [in, out]       void                *deviceObject,&#10;  [in]            const FWPS_CALLOUT2 *callout,&#10;  [out, optional] UINT32              *calloutId&#10;);">FwpsCalloutRegister2</a></strong> function.</p>

<p>The filter engine calls a callout's <strong>classifyFn3</strong> callout function with data to be processed whenever all of the test conditions are true for a filter in the filter engine that specifies the callout for the filter's action.</p>

<p>A callout's <strong>classifyFn1</strong> callout function should clear the <strong>FWPS_RIGHT_ACTION_WRITE</strong> flag in the <em>rights</em> member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_classify_out0">FWPS_CLASSIFY_OUT0</a> structure in any of the following situations:</p>

<ul>
<li>When the <strong>classifyFn1</strong> callout function sets the actionType member of the <strong>FWPS_CLASSIFY_OUT0</strong> structure to <strong>FWP_ACTION_BLOCK</strong>.</li>
<li>When the <strong>classifyFn1</strong> callout function sets the actionType member of the <strong>FWPS_CLASSIFY_OUT0</strong> structure to <strong>FWP_ACTION_PERMIT</strong> and the <strong>FWPS_FILTER_FLAG_CLEAR_ACTION_RIGHT</strong> flag is set in the flags member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_filter3">FWPS_FILTER3</a> structure.</li>
<li>When a callout has indicated that it intends to modify the clone net buffer list by setting the <em>intendToModify</em> parameter to <strong>TRUE</strong> in a call to the <strong><a href="fwpsreferencenetbufferlist0" title="void FwpsReferenceNetBufferList0(&#10;  [in, out] NET_BUFFER_LIST *netBufferList,&#10;  [in]      BOOLEAN         intendToModify&#10;);">FwpsReferenceNetBufferList0</a></strong> function.</li>
</ul>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_filter3">FWPS_FILTER3</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_incoming_values0">FWPS_INCOMING_VALUES0</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpsu/ns-fwpsu-fwps_incoming_metadata_values0">FWPS_INCOMING_METADATA_VALUES0</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_classify_out0">FWPS_CLASSIFY_OUT0</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fwpsk/nc-fwpsk-fwps_callout_classify_fn3">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fwpsk/nc-fwpsk-fwps_callout_classify_fn3.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
