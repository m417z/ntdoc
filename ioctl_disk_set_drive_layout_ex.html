<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_DISK_SET_DRIVE_LAYOUT_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_DISK_SET_DRIVE_LAYOUT_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_DISK_SET_DRIVE_LAYOUT_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntdddisk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0007, 0x015, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
#define IOCTL_DISK_SET_DRIVE_LAYOUT_EX 0x0007C054</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntdddisk/ni-ntdddisk-ioctl_disk_set_drive_layout_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0007, 0x015, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
#define IOCTL_DISK_SET_DRIVE_LAYOUT_EX 0x0007C054</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-ioctl_disk_set_drive_layout_ex">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_disk_set_drive_layout_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ntdddisk-ioctl_disk_set_drive_layout_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>IOCTL_DISK_SET_DRIVE_LAYOUT_EX IOCTL</h1>
<h2>Description</h2>
<p>Repartitions a disk as specified. (Floppy drivers need not handle this request.)</p>
<h2>Parameters</h2>
<h3>Major code</h3>
<h3>Input buffer</h3>
<p>The buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong> contains the <a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a> values to be set.</p>
<h3>Input buffer length</h3>
<p><strong>Parameters.DeviceIoControl.InputBufferLength</strong> in the I/O stack location of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the size, in bytes, of the buffer, which must be &gt;= <strong>sizeof</strong>(<a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a>).</p>
<h3>Output buffer</h3>
<p>Returns updated <a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a>, possibly with modified partition numbers, to the buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong>.</p>
<h3>Output buffer length</h3>
<p>Length of a <a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a>.</p>
<h3>Input/output buffer</h3>
<h3>Input/output buffer length</h3>
<h3>Status block</h3>
<p>The <strong>Information</strong> field is set to the size, in bytes, of the returned information. The <strong>Status</strong> field can be set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, or possibly to STATUS_INVALID_PARAMETER, STATUS_INFO_LENGTH_MISMATCH, STATUS_INSUFFICIENT_RESOURCES, or STATUS_BUFFER_TOO_SMALL.</p>
<h2>See also</h2>
<p><a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntdddisk/ni-ntdddisk-ioctl_disk_set_drive_layout_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntdddisk/ni-ntdddisk-ioctl_disk_set_drive_layout_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (ni-winioctl-ioctl_disk_set_drive_layout_ex)</h1>
</div>
<div class="ntdoc-description">
<h1>IOCTL_DISK_SET_DRIVE_LAYOUT_EX IOCTL</h1>
<h2>Description</h2>
<p>Partitions a disk according to the specified drive layout and partition information data.</p>
<p>To perform this operation, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function with the following parameters. You must have write access to the drive in order to use this control code.</p>
<pre><code>BOOL DeviceIoControl(
(HANDLE) hDevice,                 // handle to device
IOCTL_DISK_SET_DRIVE_LAYOUT_EX,   // dwIoControlCode
(LPVOID) lpInBuffer,              // input buffer
(<a href="dword" title="typedef unsigned long DWORD;">DWORD</a>) nInBufferSize,            // size of input buffer
NULL,                             // lpOutBuffer
0,                                // nOutBufferSize
(LPDWORD) lpBytesReturned,        // number of bytes returned
(LPOVERLAPPED) lpOverlapped       // OVERLAPPED structure
);
</code></pre>
<h2>Parameters</h2>
<h3><code>hDevice</code> [in]</h3>
<p>A handle to the disk.</p>
<p>To retrieve a device handle, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fileapi/nf-fileapi-createfilew"><strong>CreateFile</strong></a> function.</p>
<h3><code>dwIoControlCode</code> [in]</h3>
<p>The control code for the operation.</p>
<p>Use <strong>IOCTL_DISK_SET_DRIVE_LAYOUT_EX</strong> for this operation.</p>
<h3><code>lpInBuffer</code> [in, optional]</h3>
<p>A pointer to the input buffer that contains the <strong><a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a></strong> data to be set.</p>
<h3><code>nInBufferSize</code> [in]</h3>
<p>The size of the input buffer, in bytes. It must be &gt;= <strong>sizeof</strong>(<a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a>).</p>
<h3><code>lpOutBuffer</code> [out, optional]</h3>
<p>Not used with this operation. Set to <strong>NULL</strong>.</p>
<h3><code>nOutBufferSize</code> [in]</h3>
<p>The size of the input buffer, in bytes. Set to 0 (zero).</p>
<h3><code>lpBytesReturned</code> [out, optional]</h3>
<p>A pointer to a variable that receives the size of the data stored in the output buffer, in bytes.</p>
<h3><code>lpOverlapped</code> [in, out, optional]</h3>
<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/minwinbase/ns-minwinbase-overlapped"><strong>OVERLAPPED</strong></a> structure.</p>
<h2>Return value</h2>
<p>If the operation completes successfully, the return value is nonzero.</p>
<p>If the operation fails or is pending, the return value is zero. To get extended error information, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a>.</p>
<h2>Remarks</h2>
<p>When specifying a <strong>GUID</strong> partition table (GPT) as the <a href="partition_style" title="typedef enum _PARTITION_STYLE {&#10;  PARTITION_STYLE_MBR,&#10;  PARTITION_STYLE_GPT,&#10;  PARTITION_STYLE_RAW&#10;} PARTITION_STYLE;">PARTITION_STYLE</a> of the <a href="create_disk" title="typedef struct _CREATE_DISK {&#10;  PARTITION_STYLE PartitionStyle;&#10;  union {&#10;    CREATE_DISK_MBR Mbr;&#10;    CREATE_DISK_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;} CREATE_DISK, *PCREATE_DISK;">CREATE_DISK</a> structure, an application should wait for the MSR partition arrival before sending the <strong>IOCTL_DISK_SET_DRIVE_LAYOUT_EX</strong> control code. For more information about device notification, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winuser/nf-winuser-registerdevicenotificationa">RegisterDeviceNotification</a>.</p>
<p>When creating and manipulating an Extended Boot Record (EBR), the first entry of the EBR should point to the logical drive that immediately follows the EBR and the next EBR should lie after the end of the current logical drive and before the start of the next logical drive.</p>
<p>If the partition is on a disk formatted as type master boot record (MBR), partition size totals are limited. For more information, see the Remarks section of <a href="ioctl_disk_set_drive_layout" title="// CTL_CODE(0x0007, 0x004, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)&#10;#define IOCTL_DISK_SET_DRIVE_LAYOUT 0x0007C010">IOCTL_DISK_SET_DRIVE_LAYOUT</a>.</p>
<h2>See also</h2>
<ul>
<li>
<a href="drive_layout_information_ex" title="typedef struct _DRIVE_LAYOUT_INFORMATION_EX {&#10;  ULONG                    PartitionStyle;&#10;  ULONG                    PartitionCount;&#10;  union {&#10;    DRIVE_LAYOUT_INFORMATION_MBR Mbr;&#10;    DRIVE_LAYOUT_INFORMATION_GPT Gpt;&#10;  } DUMMYUNIONNAME;&#10;  PARTITION_INFORMATION_EX PartitionEntry[1];&#10;} DRIVE_LAYOUT_INFORMATION_EX, *PDRIVE_LAYOUT_INFORMATION_EX;">DRIVE_LAYOUT_INFORMATION_EX</a>
</li>
<li>
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol">DeviceIoControl</a>
</li>
<li>
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/FileIO/disk-management-control-codes">Disk Management Control Codes</a>
</li>
<li>
<a href="ioctl_disk_get_drive_layout_ex" title="// CTL_CODE(0x0007, 0x014, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_DISK_GET_DRIVE_LAYOUT_EX 0x00070050">IOCTL_DISK_GET_DRIVE_LAYOUT_EX</a>
</li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-ioctl_disk_set_drive_layout_ex">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winioctl/ni-winioctl-ioctl_disk_set_drive_layout_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
