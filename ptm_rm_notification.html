<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PTM_RM_NOTIFICATION - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PTM_RM_NOTIFICATION - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PTM_RM_NOTIFICATION - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PTM_RM_NOTIFICATION PtmRmNotification;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PtmRmNotification(
  [in]      PKENLISTMENT EnlistmentObject,
  [in]      PVOID RMContext,
  [in]      PVOID TransactionContext,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TransactionNotification,
  [in, out] PLARGE_INTEGER TmVirtualClock,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ArgumentLength,
  [in]      PVOID Argument
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-ptm_rm_notification">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ptm_rm_notification.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-ptm_rm_notification)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ptm_rm_notification-callback-function">PTM_RM_NOTIFICATION callback function</h1>

<h2 id="description">Description</h2>

<p>A resource manager's <em>ResourceManagerNotification</em> callback routine receives and handles <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/transaction-notifications">transaction notifications</a>.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="enlistmentobject-in"><code>EnlistmentObject</code> [in]</h3>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/enlistment-objects">enlistment object</a>. The <em>ResourceManagerNotification</em> callback routine is receiving a notification for the enlistment that this object represents.</p>

<h3 id="rmcontext-in"><code>RMContext</code> [in]</h3>

<p>The value that the resource manager previously specified for the <em>RMKey</em> parameter of the <a href="tmenablecallbacks" title="NTSTATUS TmEnableCallbacks(&#10;  [in]           PKRESOURCEMANAGER   ResourceManager,&#10;  [in]           PTM_RM_NOTIFICATION CallbackRoutine,&#10;  [in, optional] PVOID               RMKey&#10;);">TmEnableCallbacks</a> routine.</p>

<h3 id="transactioncontext-in"><code>TransactionContext</code> [in]</h3>

<p>The value that the resource manager previously specified for the <em>EnlistmentKey</em> parameter of the <a href="ntcreateenlistment" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateEnlistment(&#10;    _Out_ PHANDLE EnlistmentHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ HANDLE ResourceManagerHandle,&#10;    _In_ HANDLE TransactionHandle,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ ULONG CreateOptions,&#10;    _In_ NOTIFICATION_MASK NotificationMask,&#10;    _In_opt_ PVOID EnlistmentKey&#10;    );">ZwCreateEnlistment</a> routine.</p>

<h3 id="transactionnotification-in"><code>TransactionNotification</code> [in]</h3>

<p>One of the TRANSACTION_NOTIFY_<em>XXX</em> values that are defined in Ktmtypes.h. This value specifies the type of transaction notification that KTM sent to the caller.</p>

<h3 id="tmvirtualclock-in-out"><code>TmVirtualClock</code> [in, out]</h3>

<p>A pointer to a location that contains the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-virtual-clock-values">virtual clock value</a> at the time that KTM prepared the notification for delivery to the resource manager. If the callback routine increases this value before it returns, KTM updates the virtual clock to the new value. (Typically, resource managers do not modify the virtual clock value.)</p>

<h3 id="argumentlength-in"><code>ArgumentLength</code> [in]</h3>

<p>The length, in bytes, of the buffer that the <em>Argument</em> parameter points to. This parameter is zero if a buffer is not available.</p>

<h3 id="argument-in"><code>Argument</code> [in]</h3>

<p>A pointer to a buffer that contains notification-specific arguments. This parameter is <strong>NULL</strong> if the notification that the <em>TransactionNotification</em> parameter specifies does not require an argument buffer.</p>

<p>For a list of notifications that include an additional argument buffer, see the Remarks section of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff564813(v=vs.85)">TRANSACTION_NOTIFICATION</a>.</p>

<h2 id="return-value">Return value</h2>

<p><em>ResourceManagerNotification</em> callback routine must return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or another status value for which <a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a>(<strong>status</strong>) equals <strong>TRUE</strong> if the operation is successful.</p>

<p>Typically, the resource manager returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it services the notification synchronously and STATUS_PENDING if it services the notification asynchronously, but it can return STATUS_PENDING in either case. However, the resource manager can return STATUS_PENDING only for notifications that it responds to by calling one of the <strong>Tm*Xxx*Complete</strong> or <strong>Zw*Xxx*Complete</strong> routines.</p>

<p>In other words, if the resource manager must respond to a notification by calling one of the <strong>Tm*Xxx*Complete</strong> or <strong>Zw*Xxx*Complete</strong> routines, it can return STATUS_PENDING for the notification and later call the appropriate <strong>Tm*Xxx*Complete</strong> or <strong>Zw*Xxx*Complete</strong> routine.</p>

<p>If an error occurs, the callback routine must return a status value for which <a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a>(status) equals <strong>FALSE</strong>.</p>

<h2 id="remarks">Remarks</h2>

<p>To register a <em>ResourceManagerNotification</em> callback routine, your resource manager must call <a href="tmenablecallbacks" title="NTSTATUS TmEnableCallbacks(&#10;  [in]           PKRESOURCEMANAGER   ResourceManager,&#10;  [in]           PTM_RM_NOTIFICATION CallbackRoutine,&#10;  [in, optional] PVOID               RMKey&#10;);">TmEnableCallbacks</a>.</p>

<p>Note that <em>ResourceManagerNotification</em> callback routines receive a pointer, instead of a handle, to an enlistment object. You can pass the enlistment object pointer to the enlistment object's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-tmxxx-routines">TmXxx routines</a>.</p>

<p>For more information about <em>ResourceManagerNotification</em> callback routines, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/creating-a-resource-manager">Creating a Resource Manager</a>.</p>

<p>The <em>ResourceManagerNotification</em> callback routine is called at IRQL = PASSIVE_LEVEL, and it must return at IRQL = PASSIVE_LEVEL.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff564813(v=vs.85)">TRANSACTION_NOTIFICATION</a></p>

<p><a href="tmenablecallbacks" title="NTSTATUS TmEnableCallbacks(&#10;  [in]           PKRESOURCEMANAGER   ResourceManager,&#10;  [in]           PTM_RM_NOTIFICATION CallbackRoutine,&#10;  [in, optional] PVOID               RMKey&#10;);">TmEnableCallbacks</a></p>

<p><a href="ntcreateenlistment" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateEnlistment(&#10;    _Out_ PHANDLE EnlistmentHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ HANDLE ResourceManagerHandle,&#10;    _In_ HANDLE TransactionHandle,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ ULONG CreateOptions,&#10;    _In_ NOTIFICATION_MASK NotificationMask,&#10;    _In_opt_ PVOID EnlistmentKey&#10;    );">ZwCreateEnlistment</a></p>

<p><a href="ntgetnotificationresourcemanager" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtGetNotificationResourceManager(&#10;    _In_ HANDLE ResourceManagerHandle,&#10;    _Out_ PTRANSACTION_NOTIFICATION TransactionNotification,&#10;    _In_ ULONG NotificationLength,&#10;    _In_opt_ PLARGE_INTEGER Timeout,&#10;    _Out_opt_ PULONG ReturnLength,&#10;    _In_ ULONG Asynchronous,&#10;    _In_opt_ ULONG_PTR AsynchronousContext&#10;    );">ZwGetNotificationResourceManager</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-ptm_rm_notification">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-ptm_rm_notification.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
