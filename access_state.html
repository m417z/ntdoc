<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ACCESS_STATE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ACCESS_STATE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ACCESS_STATE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _ACCESS_STATE {
  <a href="luid" title="typedef struct _LUID {&#10;  DWORD LowPart;&#10;  LONG  HighPart;&#10;} LUID, *PLUID;">LUID</a>                     OperationID;
  BOOLEAN                  SecurityEvaluated;
  BOOLEAN                  GenerateAudit;
  BOOLEAN                  GenerateOnClose;
  BOOLEAN                  PrivilegesAllocated;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                    Flags;
  ACCESS_MASK              RemainingDesiredAccess;
  ACCESS_MASK              PreviouslyGrantedAccess;
  ACCESS_MASK              OriginalDesiredAccess;
  <a href="security_subject_context" title="typedef struct _SECURITY_SUBJECT_CONTEXT {&#10;  PACCESS_TOKEN                ClientToken;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  PACCESS_TOKEN                PrimaryToken;&#10;  PVOID                        ProcessAuditId;&#10;} SECURITY_SUBJECT_CONTEXT, *PSECURITY_SUBJECT_CONTEXT;">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
  PSECURITY_DESCRIPTOR     SecurityDescriptor;
  PVOID                    AuxData;
  union {
    INITIAL_PRIVILEGE_SET InitialPrivilegeSet;
    <a href="privilege_set" title="typedef struct _PRIVILEGE_SET {&#10;  ULONG               PrivilegeCount;&#10;  ULONG               Control;&#10;  LUID_AND_ATTRIBUTES Privilege[ANYSIZE_ARRAY];&#10;} PRIVILEGE_SET, *PPRIVILEGE_SET;">PRIVILEGE_SET</a>         PrivilegeSet;
  } Privileges;
  BOOLEAN                  AuditPrivileges;
  <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a>           ObjectName;
  <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a>           ObjectTypeName;
} ACCESS_STATE, *PACCESS_STATE;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_access_state">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/access_state.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-wdm-_access_state)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_ACCESS_STATE structure</h1>

<h2>Description</h2>

<p>The ACCESS_STATE structure describes the state of an access in progress. It contains an object's subject context, remaining desired access types, granted access types, and, optionally, a privilege set to indicate which privileges were used to permit the access.</p>

<p>Drivers are not to modify the ACCESS_STATE structure directly. To create and manipulate this structure, use the support routines listed in the See Also section.</p>

<h2>Members</h2>

<h3><code>OperationID</code></h3>

<p>The identifier of the operation that this access relates to. This member is replaced by TransactionId in the <strong>AuxData</strong> member and is currently unused by drivers.</p>

<h3><code>SecurityEvaluated</code></h3>

<p>A Boolean value that specifies whether security was evaluated as part of the access check. This member is currently unused by drivers.</p>

<h3><code>GenerateAudit</code></h3>

<p>A Boolean value that specifies whether the access should generate an audit. This member is currently unused by drivers.</p>

<h3><code>GenerateOnClose</code></h3>

<p>A Boolean value that specifies whether an audit should be generated when the handle being created is closed. This member is currently unused by drivers.</p>

<h3><code>PrivilegesAllocated</code></h3>

<p>A Boolean value that specifies whether privileges were allocated as part of the access check. This member is currently unused by drivers.</p>

<h3><code>Flags</code></h3>

<p>A 32-bit value that contains bit-field flags for the access. A driver can check for the traverse access flag (TOKEN_HAS_TRAVERSE_PRIVILEGE). For more information about how to check for traverse access, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/checking-for-traverse-privilege-on-irp-mj-create">Check for Traverse Privilege on IRP_MJ_CREATE</a>. A driver can also check for the TOKEN_IS_RESTRICTED flag. These flags are defined in Ntifs.h.</p>

<h3><code>RemainingDesiredAccess</code></h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> type that describes the access rights that have not yet been granted to the caller. A driver uses this member to determine if the Windows security system can grant access. If access can be granted, the driver updates the <strong>PreviouslyGrantedAccess</strong> and <strong>RemainingDesiredAccess</strong> members accordingly.</p>

<h3><code>PreviouslyGrantedAccess</code></h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> type that specifies the information about access that has already been granted to the caller of one of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff563711(v=vs.85)">Security Reference Monitor Routines</a>. The Windows security system grants certain rights based on the privileges of the caller, such as traverse right (the ability to traverse through a directory as part of opening a subdirectory or file).</p>

<h3><code>OriginalDesiredAccess</code></h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> type that contains the original access rights that were requested by the caller.</p>

<h3><code>SubjectSecurityContext</code></h3>

<p>A <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">SECURITY_SUBJECT_CONTEXT</a> structure that contains information about the subject security context that is used to validate and audit access.</p>

<h3><code>SecurityDescriptor</code></h3>

<p>A pointer to a <a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a> structure that contains security information for the object that this access relates to.</p>

<h3><code>AuxData</code></h3>

<p>A pointer to a memory block that contains auxiliary data for the access.</p>

<h3><code>Privileges</code></h3>

<p>A union that can contain one of the following structures. This union allows three privileges to be embedded in the access state structure. If any more privileges are required during the operation, they will be allocated in the <strong>AuxData</strong> member extension. This member is currently unused by drivers.</p>

<h3><code>Privileges.InitialPrivilegeSet</code></h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff551860(v=vs.85)">INITIAL_PRIVILEGE_SET</a> structure that specifies a set of initial privileges for the access.</p>

<h3><code>Privileges.PrivilegeSet</code></h3>

<p>A <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff551860(v=vs.85)">PRIVILEGE_SET</a> structure that specifies a set of privileges for the access.</p>

<h3><code>AuditPrivileges</code></h3>

<p>A Boolean value that specifies whether a privilege usage should be audited. This member is currently unused by drivers.</p>

<h3><code>ObjectName</code></h3>

<p>A <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a> structure that contains the object name string for the access. This member is used for auditing.</p>

<h3><code>ObjectTypeName</code></h3>

<p>A <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a> structure that contains the object type name string for the access. This member is used for auditing.</p>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-create">IRP_MJ_CREATE</a></p>

<p><a href="luid" title="typedef struct _LUID {&#10;  DWORD LowPart;&#10;  LONG  HighPart;&#10;} LUID, *PLUID;">LUID</a></p>

<p><a href="obopenobjectbypointer" title="NTSTATUS ObOpenObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ULONG           HandleAttributes,&#10;  [in, optional] PACCESS_STATE   PassedAccessState,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode,&#10;  [out]          PHANDLE         Handle&#10;);">ObOpenObjectByPointer</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff551860(v=vs.85)">PRIVILEGE_SET</a></p>

<p><a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">SECURITY_SUBJECT_CONTEXT</a></p>

<p><a href="seappendprivileges" title="NTSTATUS SeAppendPrivileges(&#10;  [in, out] PACCESS_STATE  AccessState,&#10;  [in]      PPRIVILEGE_SET Privileges&#10;);">SeAppendPrivileges</a></p>

<p><a href="secapturesubjectcontext" title="VOID SeCaptureSubjectContext(&#10;  [out] PSECURITY_SUBJECT_CONTEXT SubjectContext&#10;);">SeCaptureSubjectContext</a></p>

<p><a href="seopenobjectauditalarm" title="VOID SeOpenObjectAuditAlarm(&#10;  [in]           PUNICODE_STRING      ObjectTypeName,&#10;  [in, optional] PVOID                Object,&#10;  [in, optional] PUNICODE_STRING      AbsoluteObjectName,&#10;  [in]           PSECURITY_DESCRIPTOR SecurityDescriptor,&#10;  [in]           PACCESS_STATE        AccessState,&#10;  [in]           BOOLEAN              ObjectCreated,&#10;  [in]           BOOLEAN              AccessGranted,&#10;  [in]           KPROCESSOR_MODE      AccessMode,&#10;  [out]          PBOOLEAN             GenerateOnClose&#10;);">SeOpenObjectAuditAlarm</a></p>

<p><a href="seopenobjectfordeleteauditalarm" title="VOID SeOpenObjectForDeleteAuditAlarm(&#10;  [in]           PUNICODE_STRING      ObjectTypeName,&#10;  [in, optional] PVOID                Object,&#10;  [in, optional] PUNICODE_STRING      AbsoluteObjectName,&#10;  [in]           PSECURITY_DESCRIPTOR SecurityDescriptor,&#10;  [in]           PACCESS_STATE        AccessState,&#10;  [in]           BOOLEAN              ObjectCreated,&#10;  [in]           BOOLEAN              AccessGranted,&#10;  [in]           KPROCESSOR_MODE      AccessMode,&#10;  [out]          PBOOLEAN             GenerateOnClose&#10;);">SeOpenObjectForDeleteAuditAlarm</a></p>

<p><a href="sesetaccessstategenericmapping" title="VOID SeSetAccessStateGenericMapping(&#10;  [in, out] PACCESS_STATE    AccessState,&#10;  [in]      PGENERIC_MAPPING GenericMapping&#10;);">SeSetAccessStateGenericMapping</a></p>

<p><a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_access_state">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/ns-wdm-_access_state.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
