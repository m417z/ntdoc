<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlUTF8StringToUnicodeString - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlUTF8StringToUnicodeString - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlUTF8StringToUnicodeString - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTRTL_H
#if (PHNT_VERSION &gt;= PHNT_WINDOWS_10_20H1)

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
RtlUTF8StringToUnicodeString(
    _Inout_ <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> DestinationString,
    _In_ <a href="pcutf8_string" title="typedef const STRING *PCUTF8_STRING;">PCUTF8_STRING</a> SourceString,
    _In_ BOOLEAN AllocateDestinationString
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/443d121781061210978931c1766974f1372e359a/phnt/include/ntrtl.h#L2447">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RtlUTF8StringToUnicodeString(
  <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> DestinationString,
  <a href="putf8_string" title="typedef PSTRING PUTF8_STRING;">PUTF8_STRING</a>    SourceString,
  BOOLEAN         AllocateDestinationString
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlutf8stringtounicodestring">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RtlUTF8StringToUnicodeString(
  <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> DestinationString,
  <a href="putf8_string" title="typedef PSTRING PUTF8_STRING;">PUTF8_STRING</a>    SourceString,
  BOOLEAN         AllocateDestinationString
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlutf8stringtounicodestring">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This function is documented in Windows Driver Kit <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlutf8stringtounicodestring">here</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlutf8stringtounicodestring">here</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlutf8stringtounicodestring.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-rtlutf8stringtounicodestring)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rtlutf8stringtounicodestring-function-ntifsh">RtlUTF8StringToUnicodeString function (ntifs.h)</h1>

<h2 id="description">Description</h2>

<p>The <strong>RtlUTF8StringToUnicodeString</strong> routine converts the specified UTF-8 string to a Unicode string.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="destinationstring"><code>DestinationString</code></h3>

<p>Pointer to the buffer in which the converted output Unicode string is stored. The <em>DestinationString->MaximumLength</em> field is set only if <strong>AllocateDestinationString</strong> is TRUE.</p>

<h3 id="sourcestring"><code>SourceString</code></h3>

<p>Pointer to the UTF-8 source string to be converted to Unicode.</p>

<h3 id="allocatedestinationstring"><code>AllocateDestinationString</code></h3>

<p>Boolean value. When set TRUE, <strong>RtlUTF8StringToUnicodeString</strong> allocates the buffer space for the destination string. Only storage for <em>DestinationString->Buffer</em> is allocated by this API. If <strong>RtlUTF8StringToUnicodeString</strong> does the buffer allocation, then the caller must deallocate the buffer using <strong><a href="rtlfreeunicodestring" title="NTSYSAPI&#10;VOID&#10;NTAPI&#10;RtlFreeUnicodeString(&#10;    _Inout_ _At_(UnicodeString-&gt;Buffer, _Frees_ptr_opt_) PUNICODE_STRING UnicodeString&#10;    );">RtlFreeUnicodeString</a></strong>.</p>

<h2 id="return-value">Return value</h2>

<p>This function returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> when the conversion is successful. Possible error or warning codes include:</p>

<table>
<thead>
<tr>
  <th>Code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_INVALID_PARAMETER<em>X</em></td>
  <td>Error: One of the parameter values is invalid.</td>
</tr>
<tr>
  <td>STATUS_NO_MEMORY</td>
  <td>Error: <strong>RtlUTF8StringToUnicodeString</strong> was unable to allocate buffer space.</td>
</tr>
<tr>
  <td>STATUS_BUFFER_OVERFLOW</td>
  <td>Warning: The converted string in <em>DestinationString->Buffer</em> is truncated due to insufficient space in the destination buffer.</td>
</tr>
<tr>
  <td>STATUS_SOME_NOT_MAPPED</td>
  <td>Warning: The call was successful, but one or more of the input characters were invalid and were converted by the Unicode replacement character, U+FFFD, before being converted to UTF-8.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The Unicode output string is null-terminated only if the UTF-8 input string is null-terminated.</p>

<p><strong>RtlUTF8StringToUnicodeString</strong> supports Unicode surrogate pairs. However, a surrogate leading word value that is not followed by a trailing word value, or a trailing word value that is not preceded by a leading word value, is not recognized as a valid character and is replaced by the Unicode replacement character, U+FFFD.</p>

<p><strong>RtlUTF8StringToUnicodeString</strong> continues to convert the input string to an output string until it reaches the end of the source buffer or the end of the destination buffer, whichever occurs first. The routine converts any null characters in the input string to null characters in the output string. If the input string contains a terminating null character, but the null character is not located at the end of the source buffer, the routine continues past the terminating null character until it reaches the end of the available buffer space.</p>

<p>The <strong><a href="rtlunicodestringtoutf8string" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeStringToUTF8String(&#10;    _Inout_ PUTF8_STRING DestinationString,&#10;    _In_ PCUNICODE_STRING SourceString,&#10;    _In_ BOOLEAN AllocateDestinationString&#10;    );">RtlUnicodeStringToUTF8String</a></strong> routine converts a Unicode string to a UTF-8 string.</p>

<p>You can use the <strong>RtlUTF8StringToUnicodeString</strong> and <strong><a href="rtlunicodestringtoutf8string" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeStringToUTF8String(&#10;    _Inout_ PUTF8_STRING DestinationString,&#10;    _In_ PCUNICODE_STRING SourceString,&#10;    _In_ BOOLEAN AllocateDestinationString&#10;    );">RtlUnicodeStringToUTF8String</a></strong> routines to perform a lossless conversion of valid text strings between the UTF-8 and Unicode formats. However, strings that have arbitrary data values are likely to violate the Unicode rules for encoding surrogate pairs, and any information that is contained in the invalid values in an input string is lost and cannot be recovered from the resulting output string.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="rtlfreeunicodestring" title="NTSYSAPI&#10;VOID&#10;NTAPI&#10;RtlFreeUnicodeString(&#10;    _Inout_ _At_(UnicodeString-&gt;Buffer, _Frees_ptr_opt_) PUNICODE_STRING UnicodeString&#10;    );">RtlFreeUnicodeString</a></strong></p>

<p><strong><a href="rtlunicodestringtoutf8string" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlUnicodeStringToUTF8String(&#10;    _Inout_ PUTF8_STRING DestinationString,&#10;    _In_ PCUNICODE_STRING SourceString,&#10;    _In_ BOOLEAN AllocateDestinationString&#10;    );">RtlUnicodeStringToUTF8String</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlutf8stringtounicodestring">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-rtlutf8stringtounicodestring.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-rtlutf8stringtounicodestring)</h1>
</div>
<div class="ntdoc-description">
<h1>RtlUTF8StringToUnicodeString function (wdm.h)</h1>

<h2>Description</h2>

<p>The <strong>RtlUTF8StringToUnicodeString</strong> function converts the specified UTF8 source string into a Unicode string in accordance with the current system locale information.</p>

<h2>Parameters</h2>

<h3><code>DestinationString</code></h3>

<p>Pointer to a <strong><a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a></strong> structure to hold the converted Unicode string.</p>

<p>If <em>AllocateDestinationString</em> is <strong>TRUE</strong>, the routine allocates a new buffer to hold the string data, updates the <strong>Buffer</strong> member of <em>DestinationString</em> to point to the new buffer, and set the maximum length field. Otherwise, the routine uses the currently-specified buffer to hold the string.</p>

<h3><code>SourceString</code></h3>

<p>Pointer to the UTF8 string to be converted to Unicode.</p>

<h3><code>AllocateDestinationString</code></h3>

<p>Specifies if this routine should allocate the buffer space for the destination string. If it does, the caller must deallocate the buffer by calling <strong><a href="rtlfreeunicodestring" title="NTSYSAPI&#10;VOID&#10;NTAPI&#10;RtlFreeUnicodeString(&#10;    _Inout_ _At_(UnicodeString-&gt;Buffer, _Frees_ptr_opt_) PUNICODE_STRING UnicodeString&#10;    );">RtlFreeUnicodeString</a></strong>.</p>

<h2>Return value</h2>

<p>If the conversion succeeds, <strong>RtlUTF8StringToUnicodeString</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>. On failure, the routine does not allocate memory or perform a conversion.</p>

<h2>See also</h2>

<p><strong><a href="rtlfreeunicodestring" title="NTSYSAPI&#10;VOID&#10;NTAPI&#10;RtlFreeUnicodeString(&#10;    _Inout_ _At_(UnicodeString-&gt;Buffer, _Frees_ptr_opt_) PUNICODE_STRING UnicodeString&#10;    );">RtlFreeUnicodeString</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlutf8stringtounicodestring">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-rtlutf8stringtounicodestring.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
