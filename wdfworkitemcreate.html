<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfWorkItemCreate - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfWorkItemCreate - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfWorkItemCreate - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfworkitem.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> WdfWorkItemCreate(
  [in]  <a href="wdf_workitem_config" title="typedef struct _WDF_WORKITEM_CONFIG {&#10;  ULONG            Size;&#10;  PFN_WDF_WORKITEM EvtWorkItemFunc;&#10;  BOOLEAN          AutomaticSerialization;&#10;} WDF_WORKITEM_CONFIG, *PWDF_WORKITEM_CONFIG;">PWDF_WORKITEM_CONFIG</a>   Config,
  [in]  <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">PWDF_OBJECT_ATTRIBUTES</a> Attributes,
  [out] WDFWORKITEM            *WorkItem
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfworkitem/nf-wdfworkitem-wdfworkitemcreate">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfworkitemcreate.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfworkitem-wdfworkitemcreate)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>WdfWorkItemCreate function</h1>
<h2>Description</h2>
<p>[Applies to KMDF and UMDF]</p>
<p>The <strong>WdfWorkItemCreate</strong> method creates a framework work-item object, which can subsequently be added to the system's work-item queue.</p>
<h2>Parameters</h2>
<h3><code>Config</code> [in]</h3>
<p>A pointer to a caller-allocated <a href="wdf_workitem_config" title="typedef struct _WDF_WORKITEM_CONFIG {&#10;  ULONG            Size;&#10;  PFN_WDF_WORKITEM EvtWorkItemFunc;&#10;  BOOLEAN          AutomaticSerialization;&#10;} WDF_WORKITEM_CONFIG, *PWDF_WORKITEM_CONFIG;">WDF_WORKITEM_CONFIG</a> structure that the driver must have already initialized by calling <a href="wdf_workitem_config_init" title="VOID WDF_WORKITEM_CONFIG_INIT(&#10;  [out] PWDF_WORKITEM_CONFIG Config,&#10;  [in]  PFN_WDF_WORKITEM     EvtWorkItemFunc&#10;);">WDF_WORKITEM_CONFIG_INIT</a>.</p>
<h3><code>Attributes</code> [in]</h3>
<p>A pointer to a caller-allocated <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure that specifies attributes for the work-item object.</p>
<h3><code>WorkItem</code> [out]</h3>
<p>A pointer to a variable that receives a handle to the new work-item object.</p>
<h2>Return value</h2>
<p><strong>WdfWorkItemCreate</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, this method might return one of the following values:</p>
<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>An invalid parameter was supplied.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_DEVICE_REQUEST</strong></td>
  <td>The work-item object's parent is not a device object or the ancestor of a device object.</td>
</tr>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>There were insufficient system resources to create a work-item object.</td>
</tr>
<tr>
  <td><strong>STATUS_WDF_INCOMPATIBLE_EXECUTION_LEVEL</strong></td>
  <td>The <strong>AutomaticSerialization</strong> member in the <a href="wdf_workitem_config" title="typedef struct _WDF_WORKITEM_CONFIG {&#10;  ULONG            Size;&#10;  PFN_WDF_WORKITEM EvtWorkItemFunc;&#10;  BOOLEAN          AutomaticSerialization;&#10;} WDF_WORKITEM_CONFIG, *PWDF_WORKITEM_CONFIG;">WDF_WORKITEM_CONFIG</a> structure that the <em>Config</em> parameter points to is <strong>TRUE</strong>, but the parent object's execution level is not <strong>WdfExecutionLevelPassive</strong>.</td>
</tr>
<tr>
  <td><strong>STATUS_WDF_PARENT_NOT_SPECIFIED</strong></td>
  <td>The <em>Attributes</em> parameter was <strong>NULL</strong>, or the <strong>ParentObject</strong> member of the <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure that <em>Attributes</em> specifies was <strong>NULL</strong>.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>After a driver calls <strong>WdfWorkItemCreate</strong> to create a work item, it typically stores item-specific information in the context memory of the work-item object. The driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfworkitem/nc-wdfworkitem-evt_wdf_workitem">EvtWorkItem</a> callback function, which performs the work item's tasks, can access this information to determine the tasks that it must perform. (For more information about storing information in the context memory, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/framework-object-context-space">Framework Object Context Space</a>.)</p>
<p>After storing work-item information, the driver must call <a href="wdfworkitemenqueue" title="VOID WdfWorkItemEnqueue(&#10;  [in] WDFWORKITEM WorkItem&#10;);">WdfWorkItemEnqueue</a> to add the work item to the system's work-item queue. When a system worker thread becomes available, the thread removes the work item from the queue and calls the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfworkitem/nc-wdfworkitem-evt_wdf_workitem">EvtWorkItem</a> callback function.</p>
<p>When the driver creates a work-item object, it must specify a parent object for the work-item object in the <strong>ParentObject</strong> member of the <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure. The parent object must be a framework device object or any object whose chain of parents leads to a framework device object. The framework will delete the work-item object when it deletes the device object.</p>
<p>To delete the work-item object earlier, the driver can call <a href="wdfobjectdelete" title="VOID WdfObjectDelete(&#10;  [in] WDFOBJECT Object&#10;);">WdfObjectDelete</a>, as described in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-framework-work-items">Using Framework Work Items</a>.</p>
<p>The driver can retrieve a work item's parent object by calling <a href="wdfworkitemgetparentobject" title="WDFOBJECT WdfWorkItemGetParentObject(&#10;  [in] WDFWORKITEM WorkItem&#10;);">WdfWorkItemGetParentObject</a>.</p>
<p>If your driver provides <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfobject/nc-wdfobject-evt_wdf_object_context_cleanup">EvtCleanupCallback</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfobject/nc-wdfobject-evt_wdf_object_context_destroy">EvtDestroyCallback</a> callback functions for the work-item object, note that the framework calls these callback functions at IRQL = PASSIVE_LEVEL.</p>
<p>For more information about work items, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-framework-work-items">Using Framework Work Items</a>.</p>
<h4>Examples</h4>
<p>The following code example initializes a <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure, initializes a <a href="wdf_workitem_config" title="typedef struct _WDF_WORKITEM_CONFIG {&#10;  ULONG            Size;&#10;  PFN_WDF_WORKITEM EvtWorkItemFunc;&#10;  BOOLEAN          AutomaticSerialization;&#10;} WDF_WORKITEM_CONFIG, *PWDF_WORKITEM_CONFIG;">WDF_WORKITEM_CONFIG</a> structure, and calls <strong>WdfWorkItemCreate</strong>.</p>
<pre><code><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>  status = <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>;
PWORKER_ITEM_CONTEXT  context;
<a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a>  attributes;
<a href="wdf_workitem_config" title="typedef struct _WDF_WORKITEM_CONFIG {&#10;  ULONG            Size;&#10;  PFN_WDF_WORKITEM EvtWorkItemFunc;&#10;  BOOLEAN          AutomaticSerialization;&#10;} WDF_WORKITEM_CONFIG, *PWDF_WORKITEM_CONFIG;">WDF_WORKITEM_CONFIG</a>  workitemConfig;
WDFWORKITEM  hWorkItem;
<a href="wdf_object_attributes_init" title="VOID WDF_OBJECT_ATTRIBUTES_INIT(&#10;  [out] PWDF_OBJECT_ATTRIBUTES Attributes&#10;);">WDF_OBJECT_ATTRIBUTES_INIT</a>(&amp;attributes);
<a href="wdf_object_attributes_set_context_type" title="void WDF_OBJECT_ATTRIBUTES_SET_CONTEXT_TYPE(&#10;    _attributes,&#10;    _contexttype&#10;);">WDF_OBJECT_ATTRIBUTES_SET_CONTEXT_TYPE</a>(
                                       &amp;attributes,
                                       WORKER_ITEM_CONTEXT
                                       );
attributes.ParentObject = FdoData-&gt;WdfDevice;
<a href="wdf_workitem_config_init" title="VOID WDF_WORKITEM_CONFIG_INIT(&#10;  [out] PWDF_WORKITEM_CONFIG Config,&#10;  [in]  PFN_WDF_WORKITEM     EvtWorkItemFunc&#10;);">WDF_WORKITEM_CONFIG_INIT</a>(
                         &amp;workitemConfig,
                         CallbackFunction
                         );
status = WdfWorkItemCreate(
                            &amp;workitemConfig,
                            &amp;attributes,
                            &amp;hWorkItem
                            );
if (!<a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a>(status)) {
    return status;
}
</code></pre>
<h2>See also</h2>
<p><a href="wdfworkitemenqueue" title="VOID WdfWorkItemEnqueue(&#10;  [in] WDFWORKITEM WorkItem&#10;);">WdfWorkItemEnqueue</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfworkitem/nf-wdfworkitem-wdfworkitemcreate">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfworkitem/nf-wdfworkitem-wdfworkitemcreate.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
