<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ENABLE_VIRTUALIZATION - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ENABLE_VIRTUALIZATION - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ENABLE_VIRTUALIZATION - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">ENABLE_VIRTUALIZATION EnableVirtualization;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> EnableVirtualization(
  [in, out] PVOID Context,
  [in]      <a href="uint16" title="typedef unsigned short UINT16;">UINT16</a> NumVFs,
  [in]      BOOLEAN EnableVfMigration,
  [in]      BOOLEAN EnableMigrationInterrupt,
  [in]      BOOLEAN EnableVirtualization
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-enable_virtualization">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/enable_virtualization.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-enable_virtualization)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>

<p>The <strong>EnableVirtualization</strong> routine enables or disables virtualization for a PCI Express (PCIe) device that supports the single root I/O virtualization (SR-IOV) interface.</p>

<h2>Parameters</h2>

<h3><code>Context</code> [in, out]</h3>

<p>A pointer to interface-specific context information. The caller passes the value that is passed as the <strong>Context</strong> member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/hh406642(v=vs.85)">PCI_VIRTUALIZATION_INTERFACE</a> structure for the interface.</p>

<h3><code>NumVFs</code> [in]</h3>

<p>The number of PCIe virtual functions (VFs) that are to be enabled for the device. The <strong>EnableVirtualization</strong> routine sets the <strong>NumVFs</strong> member of the PCIe SR-IOV Extended Capability structure to the value of the <em>NumVFs</em> parameter.</p>

<p>If the <em>EnableVirtualization</em> parameter is <strong>FALSE</strong>, the <em>NumVFs</em> parameter must be set to zero.</p>

<h3><code>EnableVfMigration</code> [in]</h3>

<p>A BOOLEAN value that indicates whether the multi-root I/O virtualization (MR-IOV) base function (BF) can dynamically reprovision the PCIe physical function (PF) of the device as a VF at run time.</p>

<p>This parameter is only applicable to devices that support both the SR-IOV and MR-IOV interfaces. The driver must set this parameter to <strong>FALSE</strong> if the device supports only the SR-IOV interface and not the MR-IOV interface.</p>

<h3><code>EnableMigrationInterrupt</code> [in]</h3>

<p>A BOOLEAN value that indicates whether the interrupt associated with the PF should be masked or unmasked during VF migration.</p>

<p>If the <em>EnableVfMigration</em> parameters is <strong>FALSE</strong>, the driver must also set this parameter to <strong>FALSE</strong>.</p>

<h3><code>EnableVirtualization</code> [in]</h3>

<p>A BOOLEAN value that indicates whether virtualization is enabled on the PCIe configuration space of the device. If the <em>EnableVirtualization</em> parameter is <strong>TRUE</strong>, the <strong>EnableVirtualization</strong> routine sets the VF Enable bit of the PCIe SR-IOV Control field. The <em>EnableVirtualization</em> routine clears this bit if the <em>EnableVirtualization</em> parameter is <strong>FALSE</strong>.</p>

<h2>Return value</h2>

<p>The <strong>EnableVirtualization</strong> routine returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The operation completed successfully.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>The <em>NumVFs</em> parameter is either zero or is larger than the value of the <strong>TotalVFs</strong> member of the SR-IOV Extended Capability structure for the device.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_DEVICE_STATE</strong></td>
  <td>Virtualization is already enabled on the device and the <em>EnableVirtualization</em> parameter is <strong>TRUE</strong>, or virtualization is already disabled on the device and the <em>EnableVirtualization</em> parameter is <strong>FALSE</strong>.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>Drivers call the <strong>EnableVirtualization</strong> routine to configure the SR-IOV Extended Capability fields in the PCIe configuration space. This call enables or disables virtualization in the configuration space, and specifies the number of VFs that should be exposed to the PCIe fabric by the device.</p>

<p>The <strong>EnableVirtualization</strong> routine is provided by the <strong>GUID_PCI_VIRTUALIZATION_INTERFACE</strong> interface.</p>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/hh406642(v=vs.85)">PCI_VIRTUALIZATION_INTERFACE</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-enable_virtualization">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-enable_virtualization.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
