<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOMMU_DOMAIN_ATTACH_DEVICE_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOMMU_DOMAIN_ATTACH_DEVICE_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOMMU_DOMAIN_ATTACH_DEVICE_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">IOMMU_DOMAIN_ATTACH_DEVICE_EX IommuDomainAttachDeviceEx;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IommuDomainAttachDeviceEx(
  PIOMMU_DMA_DOMAIN Domain,
  PIOMMU_DMA_DEVICE DmaDevice
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-iommu_domain_attach_device_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/iommu_domain_attach_device_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-iommu_domain_attach_device_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>Attaches an <strong>IOMMU_DMA_DEVICE</strong> to an existing DMA device domain.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="domain"><code>Domain</code></h3>

<p>[*In*] A handle to the domain that the <strong>IOMMU_DMA_DEVICE</strong> will attach to.</p>

<h3 id="dmadevice"><code>DmaDevice</code></h3>

<p>[*In*] A pointer to the <strong>IOMMU_DMA_DEVICE</strong> to be attached.</p>

<h2 id="return-value">Return value</h2>

<p><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> if the operation is successful. Possible error return values include the following status codes.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>The routine failed to allocate required resources.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>The device is already attached to a domain.</td>
</tr>
<tr>
  <td><strong>STATUS_ACCESS_DENIED</strong></td>
  <td>The device is currently not allowed to attach to this domain type.</td>
</tr>
</tbody>
</table>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS Values</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>The caller is responsible for ensuring that the <strong>IOMMU_DMA_DEVICE</strong> is first detached, using <strong><a href="iommu_domain_detach_device_ex" title="IOMMU_DOMAIN_DETACH_DEVICE_EX IommuDomainDetachDeviceEx;&#10;&#10;NTSTATUS IommuDomainDetachDeviceEx(&#10;  [in] PIOMMU_DMA_DEVICE DmaDevice&#10;)&#10;{...}">IOMMU_DOMAIN_DETACH_DEVICE_EX</a></strong>, from any previously attached domain before attempting to attach it to another domain.</p>

<p>It is the driver's responsibility to ensure that this function is not called concurrently with any <strong><a href="iommu_domain_detach_device_ex" title="IOMMU_DOMAIN_DETACH_DEVICE_EX IommuDomainDetachDeviceEx;&#10;&#10;NTSTATUS IommuDomainDetachDeviceEx(&#10;  [in] PIOMMU_DMA_DEVICE DmaDevice&#10;)&#10;{...}">IOMMU_DOMAIN_DETACH_DEVICE_EX</a></strong> or <strong><a href="iommu_set_device_fault_reporting_ex" title="IOMMU_SET_DEVICE_FAULT_REPORTING_EX IommuSetDeviceFaultReportingEx;&#10;&#10;NTSTATUS IommuSetDeviceFaultReportingEx(&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  ULONG InputMappingIdBase,&#10;  BOOLEAN Enable,&#10;  PDEVICE_FAULT_CONFIGURATION FaultConfig&#10;)&#10;{...}">IOMMU_SET_DEVICE_FAULT_REPORTING_EX</a></strong> calls on the same device.</p>

<p>If <code>STATUS_ACCESS_DENIED</code> is returned, then it is likely the domain type is not currently available for the device to attach to. It is recommended to utilize <strong><a href="iommu_device_query_domain_types" title="IOMMU_DEVICE_QUERY_DOMAIN_TYPES IommuDeviceQueryDomainTypes;&#10;&#10;VOID IommuDeviceQueryDomainTypes(&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  PULONG AvailableDomains&#10;)&#10;{...}">IOMMU_DEVICE_QUERY_DOMAIN_TYPES</a></strong> to determine what domain types are available for the specified device. The types available can vary depending on the DMA Guard policy and the device characteristics. To be notified of when domain types are available, consider using <strong><a href="iommu_register_interface_state_change_callback" title="IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK IommuRegisterInterfaceStateChangeCallback;&#10;&#10;NTSTATUS IommuRegisterInterfaceStateChangeCallback(&#10;  PIOMMU_INTERFACE_STATE_CHANGE_CALLBACK StateChangeCallback,&#10;  PVOID Context,&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  PIOMMU_INTERFACE_STATE_CHANGE_FIELDS StateFields&#10;)&#10;{...}">IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK</a></strong> to register a notification callback whenever the available domain types change.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="iommu_domain_detach_device_ex" title="IOMMU_DOMAIN_DETACH_DEVICE_EX IommuDomainDetachDeviceEx;&#10;&#10;NTSTATUS IommuDomainDetachDeviceEx(&#10;  [in] PIOMMU_DMA_DEVICE DmaDevice&#10;)&#10;{...}">IOMMU_DOMAIN_DETACH_DEVICE_EX</a></strong></p>

<p><strong><a href="iommu_set_device_fault_reporting_ex" title="IOMMU_SET_DEVICE_FAULT_REPORTING_EX IommuSetDeviceFaultReportingEx;&#10;&#10;NTSTATUS IommuSetDeviceFaultReportingEx(&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  ULONG InputMappingIdBase,&#10;  BOOLEAN Enable,&#10;  PDEVICE_FAULT_CONFIGURATION FaultConfig&#10;)&#10;{...}">IOMMU_SET_DEVICE_FAULT_REPORTING_EX</a></strong></p>

<p><strong><a href="iommu_device_query_domain_types" title="IOMMU_DEVICE_QUERY_DOMAIN_TYPES IommuDeviceQueryDomainTypes;&#10;&#10;VOID IommuDeviceQueryDomainTypes(&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  PULONG AvailableDomains&#10;)&#10;{...}">IOMMU_DEVICE_QUERY_DOMAIN_TYPES</a></strong></p>

<p><strong><a href="iommu_register_interface_state_change_callback" title="IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK IommuRegisterInterfaceStateChangeCallback;&#10;&#10;NTSTATUS IommuRegisterInterfaceStateChangeCallback(&#10;  PIOMMU_INTERFACE_STATE_CHANGE_CALLBACK StateChangeCallback,&#10;  PVOID Context,&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  PIOMMU_INTERFACE_STATE_CHANGE_FIELDS StateFields&#10;)&#10;{...}">IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK</a></strong></p>

<p><strong><a href="dma_iommu_interface_v2" title="typedef struct _DMA_IOMMU_INTERFACE_V2 {&#10;  PIOMMU_DOMAIN_CREATE_EX                           CreateDomainEx;&#10;  PIOMMU_DOMAIN_DELETE                              DeleteDomain;&#10;  PIOMMU_DOMAIN_ATTACH_DEVICE_EX                    AttachDeviceEx;&#10;  PIOMMU_DOMAIN_DETACH_DEVICE_EX                    DetachDeviceEx;&#10;  PIOMMU_FLUSH_DOMAIN                               FlushDomain;&#10;  PIOMMU_FLUSH_DOMAIN_VA_LIST                       FlushDomainByVaList;&#10;  PIOMMU_QUERY_INPUT_MAPPINGS                       QueryInputMappings;&#10;  PIOMMU_MAP_LOGICAL_RANGE_EX                       MapLogicalRangeEx;&#10;  PIOMMU_UNMAP_LOGICAL_RANGE                        UnmapLogicalRange;&#10;  PIOMMU_MAP_IDENTITY_RANGE_EX                      MapIdentityRangeEx;&#10;  PIOMMU_UNMAP_IDENTITY_RANGE_EX                    UnmapIdentityRangeEx;&#10;  PIOMMU_SET_DEVICE_FAULT_REPORTING_EX              SetDeviceFaultReportingEx;&#10;  PIOMMU_DOMAIN_CONFIGURE                           ConfigureDomain;&#10;  PIOMMU_DEVICE_QUERY_DOMAIN_TYPES                  QueryAvailableDomainTypes;&#10;  PIOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK   RegisterInterfaceStateChangeCallback;&#10;  PIOMMU_UNREGISTER_INTERFACE_STATE_CHANGE_CALLBACK UnregisterInterfaceStateChangeCallback;&#10;  PIOMMU_RESERVE_LOGICAL_ADDRESS_RANGE              ReserveLogicalAddressRange;&#10;  PIOMMU_FREE_RESERVED_LOGICAL_ADDRESS_RANGE        FreeReservedLogicalAddressRange;&#10;  PIOMMU_MAP_RESERVED_LOGICAL_RANGE                 MapReservedLogicalRange;&#10;...">DMA_IOMMU_INTERFACE_V2</a></strong></p>

<p><strong><a href="dma_iommu_interface_ex" title="typedef struct _DMA_IOMMU_INTERFACE_EX {&#10;  SIZE_T Size;&#10;  ULONG  Version;&#10;  union {&#10;    DMA_IOMMU_INTERFACE_V1 V1;&#10;    DMA_IOMMU_INTERFACE_V2 V2;&#10;    DMA_IOMMU_INTERFACE_V3 V3;&#10;  };&#10;} DMA_IOMMU_INTERFACE_EX, *PDMA_IOMMU_INTERFACE_EX;">DMA_IOMMU_INTERFACE_EX</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-iommu_domain_attach_device_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-iommu_domain_attach_device_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
