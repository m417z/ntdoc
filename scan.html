<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="Scan - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Scan - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            Scan - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wiamicro.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">WIAMICRO_API HRESULT Scan(
  [in, out] <a href="scaninfo" title="typedef struct _SCANINFO {&#10;  LONG       ADF;&#10;  LONG       TPA;&#10;  LONG       Endorser;&#10;  LONG       OpticalXResolution;&#10;  LONG       OpticalYResolution;&#10;  LONG       BedWidth;&#10;  LONG       BedHeight;&#10;  RANGEVALUE IntensityRange;&#10;  RANGEVALUE ContrastRange;&#10;  LONG       SupportedCompressionType;&#10;  LONG       SupportedDataTypes;&#10;  LONG       WidthPixels;&#10;  LONG       WidthBytes;&#10;  LONG       Lines;&#10;  LONG       DataType;&#10;  LONG       PixelBits;&#10;  LONG       Intensity;&#10;  LONG       Contrast;&#10;  LONG       Xresolution;&#10;...">PSCANINFO</a> pScanInfo,
            <a href="long" title="typedef long LONG;">LONG</a>      lPhase,
  [out]     PBYTE     pBuffer,
            <a href="long" title="typedef long LONG;">LONG</a>      lLength,
  [out]     <a href="long" title="typedef long LONG;">LONG</a>      *plReceived
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamicro/nf-wiamicro-scan">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/scan.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wiamicro-scan)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>Scan</strong> function reads data from the device and returns the data to the WIA Flatbed driver.</p>
<h2>Parameters</h2>
<h3><code>pScanInfo</code> [in, out]</h3>
<p>Specifies the <a href="scaninfo" title="typedef struct _SCANINFO {&#10;  LONG       ADF;&#10;  LONG       TPA;&#10;  LONG       Endorser;&#10;  LONG       OpticalXResolution;&#10;  LONG       OpticalYResolution;&#10;  LONG       BedWidth;&#10;  LONG       BedHeight;&#10;  RANGEVALUE IntensityRange;&#10;  RANGEVALUE ContrastRange;&#10;  LONG       SupportedCompressionType;&#10;  LONG       SupportedDataTypes;&#10;  LONG       WidthPixels;&#10;  LONG       WidthBytes;&#10;  LONG       Lines;&#10;  LONG       DataType;&#10;  LONG       PixelBits;&#10;  LONG       Intensity;&#10;  LONG       Contrast;&#10;  LONG       Xresolution;&#10;...">SCANINFO</a> structure that represents the microdriver's settings. This is stored by the WIA Flatbed driver to guarantee that the settings between the microdriver and the WIA Flatbed driver are synchronized.</p>
<h3><code>lPhase</code></h3>
<p>Specifies the scan phase requested. This parameter can be set to one of the following values.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>SCAN_FIRST</td>
<td>This signals the first phase of the scan. The microdriver performs three tasks: it initializes the device, it uses the data in the <a href="scaninfo" title="typedef struct _SCANINFO {&#10;  LONG       ADF;&#10;  LONG       TPA;&#10;  LONG       Endorser;&#10;  LONG       OpticalXResolution;&#10;  LONG       OpticalYResolution;&#10;  LONG       BedWidth;&#10;  LONG       BedHeight;&#10;  RANGEVALUE IntensityRange;&#10;  RANGEVALUE ContrastRange;&#10;  LONG       SupportedCompressionType;&#10;  LONG       SupportedDataTypes;&#10;  LONG       WidthPixels;&#10;  LONG       WidthBytes;&#10;  LONG       Lines;&#10;  LONG       DataType;&#10;  LONG       PixelBits;&#10;  LONG       Intensity;&#10;  LONG       Contrast;&#10;  LONG       Xresolution;&#10;...">SCANINFO</a> structure to set up the scan (for example, set the resolution, the start position, the width and the height on the device), and it starts the scan. Data must be returned from this call. Data must be put into the buffer pointed to by <em>pBuffer</em> and the <em>pReceived</em> parameter must be set to the amount of data put in the buffer.</td>
</tr>
<tr>
<td>SCAN_NEXT</td>
<td>This will be repeatedly called during the data transfer. Data should be put into the buffer pointed to by <em>pBuffer</em> and the <em>pReceived</em> parameter must be set to the amount of data put in the buffer.</td>
</tr>
<tr>
<td>SCAN_FINISHED</td>
<td>This will be called at the end of the scan to terminate the scanning process. No data should be transferred. SCAN_FINISHED will always be called even if the user cancels the scan. The microdriver should stop transferring data and the scanner should be reset so that it is ready for the next scan. The data returned from this function should be in raw format without any header. The data can be either packed or planar, aligned or unaligned, and in RGB or BGR order. Set the <strong>RawDataFormat</strong>, <strong>RawPixelOrder</strong>, and <strong>bNeedDataAlignment</strong> members of the <a href="scaninfo" title="typedef struct _SCANINFO {&#10;  LONG       ADF;&#10;  LONG       TPA;&#10;  LONG       Endorser;&#10;  LONG       OpticalXResolution;&#10;  LONG       OpticalYResolution;&#10;  LONG       BedWidth;&#10;  LONG       BedHeight;&#10;  RANGEVALUE IntensityRange;&#10;  RANGEVALUE ContrastRange;&#10;  LONG       SupportedCompressionType;&#10;  LONG       SupportedDataTypes;&#10;  LONG       WidthPixels;&#10;  LONG       WidthBytes;&#10;  LONG       Lines;&#10;  LONG       DataType;&#10;  LONG       PixelBits;&#10;  LONG       Intensity;&#10;  LONG       Contrast;&#10;  LONG       Xresolution;&#10;...">SCANINFO</a> structure appropriately in response to the CMD_INITIALIZE command.</td>
</tr>
</tbody>
</table>
<h3><code>pBuffer</code> [out]</h3>
<p>Specifies the buffer that will be filled with scanned data by the microdriver. This buffer is allocated by the WIA Flatbed Driver and is guaranteed to be at least <em>lLength</em> bytes in length.</p>
<h3><code>lLength</code></h3>
<p>Specifies the requested amount of data that will be scanned. The microdriver must never overfill the buffer pointed to by <em>pBuffer</em>.</p>
<h3><code>plReceived</code> [out]</h3>
<p>Specifies the amount of data actually scanned into <em>pBuffer</em>. This value should never exceed the value of <em>lLength</em>, but can be less.</p>
<h2>Return value</h2>
<p>If the function succeeds, it returns S_OK. If the function fails, it returns a standard COM error code.</p>
<h2>See also</h2>
<p><a href="scaninfo" title="typedef struct _SCANINFO {&#10;  LONG       ADF;&#10;  LONG       TPA;&#10;  LONG       Endorser;&#10;  LONG       OpticalXResolution;&#10;  LONG       OpticalYResolution;&#10;  LONG       BedWidth;&#10;  LONG       BedHeight;&#10;  RANGEVALUE IntensityRange;&#10;  RANGEVALUE ContrastRange;&#10;  LONG       SupportedCompressionType;&#10;  LONG       SupportedDataTypes;&#10;  LONG       WidthPixels;&#10;  LONG       WidthBytes;&#10;  LONG       Lines;&#10;  LONG       DataType;&#10;  LONG       PixelBits;&#10;  LONG       Intensity;&#10;  LONG       Contrast;&#10;  LONG       Xresolution;&#10;...">SCANINFO</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-microdriver-commands">WIA Microdriver Commands</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_image/">WIA Microdriver Structures</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamicro/nf-wiamicro-scan">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wiamicro/nf-wiamicro-scan.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
