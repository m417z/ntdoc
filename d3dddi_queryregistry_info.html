<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DDDI_QUERYREGISTRY_INFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DDDI_QUERYREGISTRY_INFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DDDI_QUERYREGISTRY_INFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dukmdt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _D3DDDI_QUERYREGISTRY_INFO {
  <a href="d3dddi_queryregistry_type" title="typedef enum _D3DDDI_QUERYREGISTRY_TYPE {&#10;  D3DDDI_QUERYREGISTRY_SERVICEKEY,&#10;  D3DDDI_QUERYREGISTRY_ADAPTERKEY,&#10;  D3DDDI_QUERYREGISTRY_DRIVERSTOREPATH,&#10;  D3DDDI_QUERYREGISTRY_DRIVERIMAGEPATH,&#10;  D3DDDI_QUERYREGISTRY_MAX&#10;} D3DDDI_QUERYREGISTRY_TYPE;">D3DDDI_QUERYREGISTRY_TYPE</a>   QueryType;
  <a href="d3dddi_queryregistry_flags" title="typedef struct _D3DDDI_QUERYREGISTRY_FLAGS {&#10;  union {&#10;    struct {&#10;      UINT TranslatePath : 1;&#10;      UINT MutableValue : 1;&#10;      UINT Reserved : 30;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_QUERYREGISTRY_FLAGS;">D3DDDI_QUERYREGISTRY_FLAGS</a>  QueryFlags;
  WCHAR                       ValueName[MAX_PATH];
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                       ValueType;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                       PhysicalAdapterIndex;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                       OutputValueSize;
  <a href="d3dddi_queryregistry_status" title="typedef enum _D3DDDI_QUERYREGISTRY_STATUS {&#10;  D3DDDI_QUERYREGISTRY_STATUS_SUCCESS,&#10;  D3DDDI_QUERYREGISTRY_STATUS_BUFFER_OVERFLOW,&#10;  D3DDDI_QUERYREGISTRY_STATUS_FAIL,&#10;  D3DDDI_QUERYREGISTRY_STATUS_MAX&#10;} D3DDDI_QUERYREGISTRY_STATUS;">D3DDDI_QUERYREGISTRY_STATUS</a> Status;
  union {
    <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>                 OutputDword;
    D3DKMT_ALIGN64 <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a> OutputQword;
    WCHAR                 OutputString[1];
    <a href="byte" title="typedef unsigned char BYTE;">BYTE</a>                  OutputBinary[1];
  };
} D3DDDI_QUERYREGISTRY_INFO;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddi_queryregistry_info">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dddi_queryregistry_info.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dukmdt-_d3dddi_queryregistry_info)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="d3dddi_queryregistry_info-structure">D3DDDI_QUERYREGISTRY_INFO structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>D3DDDI_QUERYREGISTRY_INFO</strong> structure indicates how <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/ns-d3dumddi-_d3dddicb_queryadapterinfo2"><strong>D3DDDICB_QUERYADAPTERINFO2::pDriverPrivateData</strong></a> should be reinterpreted when <strong><a href="d3dddicb_queryadapterinfo2" title="typedef struct _D3DDDICB_QUERYADAPTERINFO2 {&#10;  [in]     D3DDDI_QUERYADAPTERTYPE QueryType;&#10;  [out]    VOID                    *pPrivateDriverData;&#10;  [in/out] UINT                    PrivateDriverDataSize;&#10;} D3DDDICB_QUERYADAPTERINFO2;">D3DDDICB_QUERYADAPTERINFO2</a>::QueryType</strong> is <strong>D3DDDI_QUERYADAPTERTYPE_QUERYREGISTRY</strong>.</p>

<h2 id="members">Members</h2>

<h3 id="querytype"><code>QueryType</code></h3>

<p>[in] A <strong><a href="d3dddi_queryregistry_type" title="typedef enum _D3DDDI_QUERYREGISTRY_TYPE {&#10;  D3DDDI_QUERYREGISTRY_SERVICEKEY,&#10;  D3DDDI_QUERYREGISTRY_ADAPTERKEY,&#10;  D3DDDI_QUERYREGISTRY_DRIVERSTOREPATH,&#10;  D3DDDI_QUERYREGISTRY_DRIVERIMAGEPATH,&#10;  D3DDDI_QUERYREGISTRY_MAX&#10;} D3DDDI_QUERYREGISTRY_TYPE;">D3DDDI_QUERYREGISTRY_TYPE</a></strong> value that indicates which data to retrieve.</p>

<p><strong>D3DDDI_QUERYREGISTRY_INFO::QueryType</strong> is the most significant field of this structure. It indicates whether the registry or file paths are being retrieved, as well as which specific registry hive and file path.</p>

<p>Registry Key Enums:</p>

<ul>
<li><strong>D3DDDI_QUERYREGISTRY_SERVICEKEY</strong></li>
<li><strong>D3DDDI_QUERYREGISTRY_ADAPTERKEY</strong></li>
</ul>

<p>File Path Enums:</p>

<ul>
<li><strong>D3DDDI_QUERYREGISTRY_DRIVERSTOREPATH</strong></li>
<li><strong>D3DDDI_QUERYREGISTRY_DRIVERIMAGEPATH</strong></li>
</ul>

<h3 id="queryflags"><code>QueryFlags</code></h3>

<p>[in] A <strong><a href="d3dddi_queryregistry_flags" title="typedef struct _D3DDDI_QUERYREGISTRY_FLAGS {&#10;  union {&#10;    struct {&#10;      UINT TranslatePath : 1;&#10;      UINT MutableValue : 1;&#10;      UINT Reserved : 30;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_QUERYREGISTRY_FLAGS;">D3DDDI_QUERYREGISTRY_FLAGS</a></strong> structure with flags that control how strings are retrieved. <strong>QueryFlags</strong> can do additional operations, like translate retrieved strings containing file paths to the guest environment.</p>

<h3 id="valuenamemax_path"><code>ValueName[MAX_PATH]</code></h3>

<p>[in] Zero-terminated UNICODE string that can contain a sub-key name, which is separated from the actual value name by backslash. For example, <strong>ValueName</strong> could be <code>SubKey1\ SubKey2\NameOfTheValue</code>. In this case, <code>SubKey1\ SubKey2</code> are the subkeys of the service or software keys.</p>

<p>When retrieving registry information, <strong>ValueName</strong> must specify the registry value name to retrieve. When retrieving file path information, <strong>ValueName</strong> is ignored.</p>

<h3 id="valuetype"><code>ValueType</code></h3>

<p>[in] When retrieving registry information, <strong>ValueType</strong> must specify the expected registry value type that corresponds to the registry value name. It must be REG_SZ, REG_MULTI_SZ, REG_EXPAND_SZ, REG_BINARY, REG_QWORD, or REG_DWORD.</p>

<p>When retrieving file path information, <strong>ValueType</strong> must be 0 to succeed.</p>

<p>See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/sysinfo/registry-value-types">Registry Value Types</a> for more detail.</p>

<h3 id="physicaladapterindex"><code>PhysicalAdapterIndex</code></h3>

<p>[in] The physical adapter index in a LDA chain.</p>

<h3 id="outputvaluesize"><code>OutputValueSize</code></h3>

<p>[out] Size in bytes of the written output if <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_queryadapterinfocb2"><strong>pfnQueryAdapterInfoCb2</strong></a> succeeds (<strong>Status</strong> is D3DDDI_QUERYREGISTRY_STATUS_SUCCESS). When <strong>Status</strong> is D3DDDI_QUERYREGISTRY_STATUS_BUFFER_OVERFLOW, <strong>OutputValueSize</strong> is the number of bytes required to hold the output value.</p>

<h3 id="status"><code>Status</code></h3>

<p>[out] A <strong><a href="d3dddi_queryregistry_status" title="typedef enum _D3DDDI_QUERYREGISTRY_STATUS {&#10;  D3DDDI_QUERYREGISTRY_STATUS_SUCCESS,&#10;  D3DDDI_QUERYREGISTRY_STATUS_BUFFER_OVERFLOW,&#10;  D3DDDI_QUERYREGISTRY_STATUS_FAIL,&#10;  D3DDDI_QUERYREGISTRY_STATUS_MAX&#10;} D3DDDI_QUERYREGISTRY_STATUS;">D3DDDI_QUERYREGISTRY_STATUS</a></strong> value that indicates the status of the query.</p>

<p>When a user-mode display driver calls the runtime's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_queryadapterinfocb2"><strong>pfnQueryAdapterInfoCb2</strong></a> function, a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a> function is initiated.</p>

<p>The status of the query is returned separately from the return value in order to indicate that varying amounts of data have been retrieved. The following three return states are the most important to understand:</p>

<ul>
<li>When <strong>pfnQueryAdapterInfoCb2</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>:
<ul>
<li>If <strong>Status</strong> is <strong>D3DDDI_QUERYREGISTRY_STATUS_SUCCESS</strong>, all fields starting with <strong>Output*Xxx</strong>* are valid.</li>
<li>If <strong>Status</strong> is <strong>D3DDDI_QUERYREGISTRY_STATUS_BUFFER_OVERFLOW</strong>, there isn't enough space in the private data to hold the registry value. Only <strong>OutputValueSize</strong> is valid.</li>
</ul></li>
<li>When <strong>pfnQueryAdapterInfoCb2</strong> doesn't return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, all fields are left unmodified, except <strong>Status</strong> might be changed to <strong>D3DDDI_QUERYREGISTRY_STATUS_FAIL</strong>.</li>
</ul>

<h3 id="outputdword"><code>OutputDword</code></h3>

<p>[out] A part of the union that holds the output value. <strong>OutputDword</strong> is a convenience field for reinterpreting the successfully retrieved data when a registry <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> is being read.</p>

<h3 id="outputqword"><code>OutputQword</code></h3>

<p>[out] A part of the union that holds the output value. <strong>OutputQword</strong> is a convenience field for reinterpreting the successfully retrieved data when a registry QWORD is being read.</p>

<h3 id="outputstring1"><code>OutputString[1]</code></h3>

<p>[out] A part of the union that holds the output value. <strong>OutputString</strong> is a convenience field for reinterpreting the successfully retrieved data when retrieving a registry string or a file path.</p>

<h3 id="outputbinary1"><code>OutputBinary[1]</code></h3>

<p>[out] A part of the union that holds the output value. <strong>OutputBinary</strong> is a convenience field for reinterpreting the successfully retrieved data when a registry binary blob is being read.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>D3DDDI_QUERYREGISTRY_INFO</strong> is used to read the registry for information that is commonly cached during driver installation.</p>

<p>Instead of using raw OS methods, user-mode drivers and other components must ubiquitously use this technique on the OS versions where it is supported. This enables the OS to maximize user-mode compatibility with dependency changes and scenarios like virtualized environments. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/gpu-paravirtualization">GPU paravirtualization</a>.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="d3dddi_queryregistry_type" title="typedef enum _D3DDDI_QUERYREGISTRY_TYPE {&#10;  D3DDDI_QUERYREGISTRY_SERVICEKEY,&#10;  D3DDDI_QUERYREGISTRY_ADAPTERKEY,&#10;  D3DDDI_QUERYREGISTRY_DRIVERSTOREPATH,&#10;  D3DDDI_QUERYREGISTRY_DRIVERIMAGEPATH,&#10;  D3DDDI_QUERYREGISTRY_MAX&#10;} D3DDDI_QUERYREGISTRY_TYPE;">D3DDDI_QUERYREGISTRY_TYPE</a></strong></p>

<p><strong><a href="d3dddi_queryregistry_flags" title="typedef struct _D3DDDI_QUERYREGISTRY_FLAGS {&#10;  union {&#10;    struct {&#10;      UINT TranslatePath : 1;&#10;      UINT MutableValue : 1;&#10;      UINT Reserved : 30;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_QUERYREGISTRY_FLAGS;">D3DDDI_QUERYREGISTRY_FLAGS</a></strong></p>

<p><strong><a href="d3dddi_queryregistry_status" title="typedef enum _D3DDDI_QUERYREGISTRY_STATUS {&#10;  D3DDDI_QUERYREGISTRY_STATUS_SUCCESS,&#10;  D3DDDI_QUERYREGISTRY_STATUS_BUFFER_OVERFLOW,&#10;  D3DDDI_QUERYREGISTRY_STATUS_FAIL,&#10;  D3DDDI_QUERYREGISTRY_STATUS_MAX&#10;} D3DDDI_QUERYREGISTRY_STATUS;">D3DDDI_QUERYREGISTRY_STATUS</a></strong></p>

<p><strong><a href="kmtqueryadapterinfotype" title="typedef enum _KMTQUERYADAPTERINFOTYPE {&#10;  KMTQAITYPE_UMDRIVERPRIVATE,&#10;  KMTQAITYPE_UMDRIVERNAME,&#10;  KMTQAITYPE_UMOPENGLINFO,&#10;  KMTQAITYPE_GETSEGMENTSIZE,&#10;  KMTQAITYPE_ADAPTERGUID,&#10;  KMTQAITYPE_FLIPQUEUEINFO,&#10;  KMTQAITYPE_ADAPTERADDRESS,&#10;  KMTQAITYPE_SETWORKINGSETINFO,&#10;  KMTQAITYPE_ADAPTERREGISTRYINFO,&#10;  KMTQAITYPE_CURRENTDISPLAYMODE,&#10;  KMTQAITYPE_MODELIST,&#10;  KMTQAITYPE_CHECKDRIVERUPDATESTATUS,&#10;  KMTQAITYPE_VIRTUALADDRESSINFO,&#10;  KMTQAITYPE_DRIVERVERSION,&#10;  KMTQAITYPE_ADAPTERTYPE,&#10;  KMTQAITYPE_OUTPUTDUPLCONTEXTSCOUNT,&#10;  KMTQAITYPE_WDDM_1_2_CAPS,&#10;  KMTQAITYPE_UMD_DRIVER_VERSION,&#10;  KMTQAITYPE_DIRECTFLIP_SUPPORT,&#10;...">KMTQUERYADAPTERINFOTYPE</a></strong></p>

<p><strong><a href="d3dkmt_queryadapterinfo" title="typedef struct _D3DKMT_QUERYADAPTERINFO {&#10;  D3DKMT_HANDLE           hAdapter;&#10;  KMTQUERYADAPTERINFOTYPE Type;&#10;  VOID                    *pPrivateDriverData;&#10;  UINT                    PrivateDriverDataSize;&#10;} D3DKMT_QUERYADAPTERINFO;">D3DKMT_QUERYADAPTERINFO</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_queryadapterinfocb2"><strong>pfnQueryAdapterInfoCb2</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddi_queryregistry_info">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dukmdt/ns-d3dukmdt-_d3dddi_queryregistry_info.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
