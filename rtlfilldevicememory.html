<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlFillDeviceMemory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlFillDeviceMemory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlFillDeviceMemory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">volatile void * RtlFillDeviceMemory(
  [out] volatile void *Destination,
  [in]  <a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a>        Length,
  [in]  int           Fill
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlfilldevicememory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlfilldevicememory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-rtlfilldevicememory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>RtlFillDeviceMemory</strong> routine fills a block of device memory with the specified fill value and returns a pointer to the filled memory. This function is safe for use on device memory because it uses appropriate access patterns for device memory regions.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="destination-out"><code>Destination</code> [out]</h3>

<p>A pointer to the starting address of the volatile device memory block to fill.</p>

<h3 id="length-in"><code>Length</code> [in]</h3>

<p>The size of the block of memory to fill, in bytes. This value must be less than or equal to the size of the <strong>Destination</strong> buffer.</p>

<h3 id="fill-in"><code>Fill</code> [in]</h3>

<p>The byte value with which to fill the memory block.</p>

<h2 id="return-value">Return value</h2>

<p><strong>RtlFillDeviceMemory</strong> returns a pointer to the filled volatile device memory block (<strong>Destination</strong>).</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>RtlFillDeviceMemory</strong> routine is designed for safe filling of device memory regions where standard memory filling functions might not be appropriate due to the special characteristics of device memory.</p>

<ul>
<li><p>The function uses volatile memory accesses to ensure proper handling of device memory that may have side effects or special access requirements.</p></li>
<li><p>The function is optimized for performance while maintaining safety for device memory access patterns.</p></li>
<li><p>The function might perform unaligned memory accesses if the platform allows for it.</p></li>
<li><p>The function might use optimized filling patterns for larger memory blocks while ensuring device memory safety.</p></li>
</ul>

<p>This function provides <strong><a href="rtlfillmemory" title="void RtlFillMemory(&#10;   void*  Destination,&#10;   size_t Length&#10;   int    Fill&#10;);">RtlFillMemory</a></strong> behavior specifically designed for device memory regions.</p>

<p>Callers of <strong>RtlFillDeviceMemory</strong> can be running at any IRQL if the destination memory block is in nonpaged system memory. Otherwise, the caller must be running at IRQL &lt;= APC_LEVEL.</p>

<p>This function works on all versions of Windows, not just the latest. You need to consume the latest WDK to get the function declaration from the wdm.h header. You also need the library (volatileaccessk.lib) from the latest WDK. However, the resulting driver will run fine on older versions of Windows.</p>

<h3 id="example">Example</h3>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="k">volatile</span><span class="w"> </span><span class="n"><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></span><span class="o">*</span><span class="w"> </span><span class="n">DeviceBuffer</span><span class="p">;</span>
<span class="n"><a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a></span><span class="w"> </span><span class="n">BufferSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>

<span class="c1">// Allocate or map device memory</span>
<span class="n">DeviceBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MapDeviceMemory</span><span class="p">(</span><span class="n">BufferSize</span><span class="p">);</span>

<span class="c1">// Fill the device memory with a specific pattern</span>
<span class="k">volatile</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RtlFillDeviceMemory</span><span class="p">(</span><span class="n">DeviceBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">BufferSize</span><span class="p">,</span><span class="w"> </span><span class="mh">0xAA</span><span class="p">);</span>

<span class="c1">// Use the filled device memory</span>
<span class="n">ProcessDeviceData</span><span class="p">(</span><span class="n">DeviceBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">BufferSize</span><span class="p">);</span>

<span class="c1">// Clean up</span>
<span class="n">UnmapDeviceMemory</span><span class="p">(</span><span class="n">DeviceBuffer</span><span class="p">);</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><strong><a href="rtlfillmemory" title="void RtlFillMemory(&#10;   void*  Destination,&#10;   size_t Length&#10;   int    Fill&#10;);">RtlFillMemory</a></strong></p>

<p><strong><a href="rtlsetvolatilememory" title="volatile void * RtlSetVolatileMemory(&#10;  [out] volatile void *Destination,&#10;  [in]  int           Fill,&#10;  [in]  size_t        Length&#10;);">RtlSetVolatileMemory</a></strong></p>

<p><strong><a href="rtlcomparedevicememory" title="SIZE_T RtlCompareDeviceMemory(&#10;  [in] const VOID *Source1,&#10;  [in] const VOID *Source2,&#10;  [in] SIZE_T     Length&#10;);">RtlCompareDeviceMemory</a></strong></p>

<p><strong><a href="rtlequaldevicememory" title="BOOL RtlEqualDeviceMemory(&#10;   [in] const void* Source1,&#10;   [in] const void* Source2,&#10;   [in] size_t      Length&#10;);">RtlEqualDeviceMemory</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlfilldevicememory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-rtlfilldevicememory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
