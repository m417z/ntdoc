<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKARG_CREATEHWQUEUE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKARG_CREATEHWQUEUE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKARG_CREATEHWQUEUE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _DXGKARG_CREATEHWQUEUE {
  HANDLE                    hHwQueue;
  <a href="d3dddi_createhwqueueflags" title="typedef struct _D3DDDI_CREATEHWQUEUEFLAGS {&#10;  union {&#10;    struct {&#10;      UINT DisableGpuTimeout : 1;&#10;      UINT NoBroadcastSignal : 1;&#10;      UINT NoBroadcastWait : 1;&#10;      UINT NoKmdAccess : 1;&#10;      UINT UserModeSubmission : 1;&#10;      UINT NativeProgressFence : 1;&#10;      UINT TestQueue : 1;&#10;      UINT Reserved : 25;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_CREATEHWQUEUEFLAGS;">D3DDDI_CREATEHWQUEUEFLAGS</a> Flags;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                      PrivateDriverDataSize;
  VOID                      *pPrivateDriverData;
  D3DKMT_HANDLE             hHwQueueProgressFence;
  VOID                      *HwQueueProgressFenceCPUVirtualAddress;
  D3DGPU_VIRTUAL_ADDRESS    HwQueueProgressFenceGPUVirtualAddress;
} DXGKARG_CREATEHWQUEUE;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-dxgkarg_createhwqueue">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkarg_createhwqueue.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dkmddi-dxgkarg_createhwqueue)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>DXGKARG_CREATEHWQUEUE</strong> structure is used with <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createhwqueue"><strong>DxgkDdiCreateHwQueue</strong></a> to create a hardware queue.</p>
<h2>Members</h2>
<h3><code>hHwQueue</code></h3>
<p>[in/out] On input, <em>Dxgkrnl</em>'s handle to the hardware queue. On output, the driver's handle to the hardware queue.</p>
<h3><code>Flags</code></h3>
<p>[in] A <strong><a href="d3dddi_createhwqueueflags" title="typedef struct _D3DDDI_CREATEHWQUEUEFLAGS {&#10;  union {&#10;    struct {&#10;      UINT DisableGpuTimeout : 1;&#10;      UINT NoBroadcastSignal : 1;&#10;      UINT NoBroadcastWait : 1;&#10;      UINT NoKmdAccess : 1;&#10;      UINT UserModeSubmission : 1;&#10;      UINT NativeProgressFence : 1;&#10;      UINT TestQueue : 1;&#10;      UINT Reserved : 25;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_CREATEHWQUEUEFLAGS;">D3DDDI_CREATEHWQUEUEFLAGS</a></strong> structure containing the queue creation flags.</p>
<h3><code>PrivateDriverDataSize</code></h3>
<p>[in] Size in bytes of the private driver data that <strong>pPrivateDriverData</strong> points to.</p>
<h3><code>pPrivateDriverData</code></h3>
<p>[in/out] Pointer to the private driver data that was passed by the user-mode driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_createhwcontextcb"><strong>pfnCreateHwContextCb</strong></a> function. Since <strong>pPrivateDriverData</strong> is an in-out parameter, KMD can also return private data back to the UMD.</p>
<h3><code>hHwQueueProgressFence</code></h3>
<p>[in] Handle to the GPU synchronization object created by the OS for this hardware queue. The progress fence is used to synchronize DMA buffer completion on this hardware queue. See Remarks.</p>
<h3><code>HwQueueProgressFenceCPUVirtualAddress</code></h3>
<p>[in] Kernel-mode CPU virtual address that can be used to read the currently signaled value of the hardware queue progress fence.</p>
<h3><code>HwQueueProgressFenceGPUVirtualAddress</code></h3>
<p>[in] GPU virtual address that can be used to read or write the value of the hardware queue progress fence. The queue progress fence value must monotonically increase with each new submission to the hardware queue. GPU instructions to update the queue progress fence must be inserted by the user-mode driver at the end of the DMA buffer being tracked.</p>
<h2>Remarks</h2>
<p>For kernel submission HWQueues, the OS will allocate the progress fence as a native fence type on GPUs that support native fences. When the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddi_createhwqueueflags"><strong>NativeProgressFence</strong></a> flag is set, KMD's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createhwqueue"><strong>DxgkDdiCreateHwQueue</strong></a> must read the corresponding <strong>hHwQueueNativeProgressFence</strong> field that specifies the driver handle to the native fence object previously created in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createnativefence"><strong>DxgkDdiCreateNativeFence</strong></a>. If the <strong>NativeProgressFence</strong> flag is FALSE then this HWQueue's progress fence is a regular monitored fence object, and KMD must read the legacy <strong>hHwQueueProgressFence</strong> field like before.</p>
<p>Upon creating a native fence for a HWQueue, the OS will also set <strong><a href="d3dkmt_createhwqueue" title="typedef struct _D3DKMT_CREATEHWQUEUE {&#10;  D3DKMT_HANDLE                         hHwContext;&#10;  D3DDDI_CREATEHWQUEUEFLAGS             Flags;&#10;  UINT                                  PrivateDriverDataSize;&#10;  VOID                                  *pPrivateDriverData;&#10;  D3DKMT_HANDLE                         hHwQueue;&#10;  D3DKMT_HANDLE                         hHwQueueProgressFence;&#10;  VOID                                  *HwQueueProgressFenceCPUVirtualAddress;&#10;  D3DKMT_ALIGN64 D3DGPU_VIRTUAL_ADDRESS HwQueueProgressFenceGPUVirtualAddress;&#10;} D3DKMT_CREATEHWQUEUE;">D3DKMT_CREATEHWQUEUE</a>::Flags.NativeProgressFence</strong> to TRUE, so that the runtime is also aware that the HWQueue's progress fence was allocated as a native fence.</p>
<p>For user submission HWQueues, OS will allocate its progress fence as a native fence in <strong>DxgkDdiCreateHwQueueForUserModeSubmission</strong>() by definition.</p>
<p>Note on driver compatibility: <em>Dxgkrnl</em> will only write to the <strong>hHwQueueNativeProgressFence</strong> field on drivers that support the <strong>NativeGpuFence</strong> cap. This ensures that OS will only reference this field on in-development and future drivers that are compiled with this updated header. KMD will only read this field if <strong>DXGKARG_CREATEHWQUEUE.Flags.NativeProgressFence</strong> is TRUE. This ensures that KMD only references this field on the latest OS builds that support native progress fence and this updated header.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createhwqueue"><strong>DxgkDdiCreateHwQueue</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-dxgkarg_createhwqueue">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/ns-d3dkmddi-dxgkarg_createhwqueue.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
