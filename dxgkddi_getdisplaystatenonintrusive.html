<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_GETDISPLAYSTATENONINTRUSIVE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_GETDISPLAYSTATENONINTRUSIVE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_GETDISPLAYSTATENONINTRUSIVE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// dispmprt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKDDI_GETDISPLAYSTATENONINTRUSIVE DxgkddiGetdisplaystatenonintrusive;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiGetdisplaystatenonintrusive(
  [in]     HANDLE Context,
  [in/out] <a href="dxgkarg_getdisplaystatenonintrusive" title="typedef struct _DXGKARG_GETDISPLAYSTATE_NONINTRUSIVE {&#10;  UINT                           NumOfTargets;&#10;  UINT                           SizeOfDisplayStateNonIntrusiveElement;&#10;  DXGK_DISPLAYSTATE_NONINTRUSIVE **ppDisplayStateNonIntrusive;&#10;} DXGKARG_GETDISPLAYSTATENONINTRUSIVE, *PDXGKARG_GETDISPLAYSTATENONINTRUSIVE;">PDXGKARG_GETDISPLAYSTATENONINTRUSIVE</a> pArgs
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystatenonintrusive">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_getdisplaystatenonintrusive.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-dispmprt-dxgkddi_getdisplaystatenonintrusive)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgkddi_getdisplaystatenonintrusive-callback-function">DXGKDDI_GETDISPLAYSTATENONINTRUSIVE callback function</h1>

<h2 id="description">Description</h2>

<p>The operating system calls a display miniport driver's <strong>DxgkDdiGetDisplayStateNonIntrusive</strong> routine to nonintrusively collect display state information from the driver.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="context-in"><code>Context</code> [in]</h3>

<p>Pointer to a private context returned by <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_query_interface"><strong>DxgkDdiQueryInterface</strong></a>.</p>

<h3 id="pargs-inout"><code>pArgs</code> [in/out]</h3>

<p>Pointer to a <strong><a href="dxgkarg_getdisplaystatenonintrusive" title="typedef struct _DXGKARG_GETDISPLAYSTATE_NONINTRUSIVE {&#10;  UINT                           NumOfTargets;&#10;  UINT                           SizeOfDisplayStateNonIntrusiveElement;&#10;  DXGK_DISPLAYSTATE_NONINTRUSIVE **ppDisplayStateNonIntrusive;&#10;} DXGKARG_GETDISPLAYSTATENONINTRUSIVE, *PDXGKARG_GETDISPLAYSTATENONINTRUSIVE;">DXGKARG_GETDISPLAYSTATENONINTRUSIVE</a></strong> structure.</p>

<h2 id="return-value">Return value</h2>

<p><strong>DxgkDdiGetDisplayStateNonIntrusive</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it succeeds. Otherwise it returns an error code such as one of the following.</p>

<table>
<thead>
<tr>
  <th>Error Code</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_DRIVER_INTERNAL_ERROR</td>
  <td>A generic software error occurred inside the driver.</td>
</tr>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td>The hardware is being currently used by other threads and this DDI can't get access to it.</td>
</tr>
<tr>
  <td>STATUS_DEVICE_HARDWARE_ERROR</td>
  <td>Generic HW error happened.</td>
</tr>
<tr>
  <td>STATUS_DEVICE_POWERED_OFF</td>
  <td>The device is powered off.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The OS calls <strong>DxgkDdiGetDisplayStateNonIntrusive</strong> to collect display state information from the driver. Unlike <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystateintrusive"><strong>DxgkDdiGetDisplayStateIntrusive</strong></a>, the driver's <strong>DxgkDdiGetDisplayStateNonIntrusive</strong> routine should not perform any operations that cause visible side effects to the user, and the collection process should be relatively fast (ideally within a few milliseconds). This routine's calling frequency will be relatively high. Apart from being called for diagnosing bad user state, the OS might also use this routine for recording historical state information from the driver for debugging purposes.</p>

<p>In rare cases where a platform-specific implementation requires the driver to carry out intrusive operations as part of a call to <strong>DxgkDdiGetDisplayStateNonIntrusive</strong>, the driver should carry out the operations but must set <strong>pArgs->ReturnSubStatus</strong> to DXGK_DIAG_GETDISPLAYSTATE_CAUSED_GLITCH or DXGK_DIAG_GETDISPLAYSTATE_CHANGED_DISPLAY_STATE accordingly. Based on the <strong>ReturnSubStatus</strong> value, the operating system (OS) might only call this routine for error scenarios on a given system.</p>

<p>The OS will call <strong>DxgkDdiGetDisplayStateNonIntrusive</strong> frequently (either periodically or on other commonly occurring events) to gather driver state data for debugging purposes and to look at the historical timeline. The OS will also call this routine in particular error scenarios (such as black screens) before gathering more detailed information by calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystateintrusive"><strong>DxgkDdiGetDisplayStateIntrusive</strong></a>. Given the possible frequency of this call, drivers should complete it as quickly as possible. The OS will call this DDI with <strong>NumOfTargets</strong> set to the maximum number of targets supported by the given graphics adapter and <strong>VidPnTargetId</strong> filled in. The miniport driver should only fill the display state information for targets on which there is actually a monitor connected. For a vidpntarget on which there is no monitor connected, the miniport should just fill in <a href="dxgk_diag_display_connectivity" title="typedef enum _DXGK_DIAG_DISPLAY_CONNECTIVITY {&#10;  DXGK_DIAG_DISPLAY_CONNECTIVITY_UNINITIALIZED,&#10;  DXGK_DIAG_DISPLAY_NOT_CONNECTED,&#10;  DXGK_DIAG_DISPLAY_CONNECTED&#10;} DXGK_DIAG_DISPLAY_CONNECTIVITY;">DXGK_DIAG_DISPLAY_CONNECTIVITY</a> and the OS will ignore all other fields for that target.</p>

<blockquote>
  <p>[!NOTE]
  Drivers should only use <strong>ReturnSubStatus</strong> to report error conditions and not use DXGK_DIAG_GETDISPLAYSTATE_MONITOR_NOT_CONNECTED for reporting monitor connectivity state. The main purpose of DXGK_DIAG_GETDISPLAYSTATE_MONITOR_NOT_CONNECTED is for intrusive calls where the OS doesn't ask about monitor connectivity.</p>
  
  <p>If driver hits a failure on a given vidpntarget while collecting information, it should use <strong>ReturnSubStatus</strong> to set the error state and proceed to the next vidpntarget and not fail the overall call unless all the paths hit failures. Drivers should ideally record errors hit during this call in some internal error log so that when the OS calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_collectdiagnosticinfo"><strong>DxgkDdiCollectDiagnosticInfo</strong></a> for collecting black box information, these errors are captured as part of an internal log collection to help IHVs during debug.</p>
</blockquote>

<p>Synchronization level for this DDI is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/threading-and-synchronization-zero-level">zero level synchronization</a>.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="dxgkarg_getdisplaystatenonintrusive" title="typedef struct _DXGKARG_GETDISPLAYSTATE_NONINTRUSIVE {&#10;  UINT                           NumOfTargets;&#10;  UINT                           SizeOfDisplayStateNonIntrusiveElement;&#10;  DXGK_DISPLAYSTATE_NONINTRUSIVE **ppDisplayStateNonIntrusive;&#10;} DXGKARG_GETDISPLAYSTATENONINTRUSIVE, *PDXGKARG_GETDISPLAYSTATENONINTRUSIVE;">DXGKARG_GETDISPLAYSTATENONINTRUSIVE</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_collectdiagnosticinfo"><strong>DxgkDdiCollectDiagnosticInfo</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystateintrusive"><strong>DxgkDdiGetDisplayStateIntrusive</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_query_interface"><strong>DxgkDdiQueryInterface</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystatenonintrusive">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/dispmprt/nc-dispmprt-dxgkddi_getdisplaystatenonintrusive.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
