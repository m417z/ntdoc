<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFN_WSK_ACCEPT_EVENT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFN_WSK_ACCEPT_EVENT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFN_WSK_ACCEPT_EVENT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wsk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFN_WSK_ACCEPT_EVENT PfnWskAcceptEvent;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PfnWskAcceptEvent(
  [in, optional] PVOID SocketContext,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags,
  [in]           PSOCKADDR LocalAddress,
  [in]           PSOCKADDR RemoteAddress,
  [in, optional] <a href="wsk_socket" title="typedef struct _WSK_SOCKET {&#10;  const VOID *Dispatch;&#10;} WSK_SOCKET, *PWSK_SOCKET;">PWSK_SOCKET</a> AcceptSocket,
  [out]          PVOID *AcceptSocketContext,
  [out]          const <a href="wsk_client_connection_dispatch" title="typedef struct _WSK_CLIENT_CONNECTION_DISPATCH {&#10;  PFN_WSK_RECEIVE_EVENT      WskReceiveEvent;&#10;  PFN_WSK_DISCONNECT_EVENT   WskDisconnectEvent;&#10;  PFN_WSK_SEND_BACKLOG_EVENT WskSendBacklogEvent;&#10;} WSK_CLIENT_CONNECTION_DISPATCH, *PWSK_CLIENT_CONNECTION_DISPATCH;">WSK_CLIENT_CONNECTION_DISPATCH</a> **AcceptSocketDispatch
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept_event">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfn_wsk_accept_event.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wsk-pfn_wsk_accept_event)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>PFN_WSK_ACCEPT_EVENT callback function</h1>

<h2>Description</h2>

<p>The
<em>WskAcceptEvent</em> event callback function notifies a WSK application that an incoming connection on a
listening socket has been accepted.</p>

<h2>Parameters</h2>

<h3><code>SocketContext</code> [in, optional]</h3>

<p>A pointer to the socket context for the listening socket on which the incoming connection was
accepted. The WSK application provided this pointer to the WSK subsystem when it called the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_socket">WskSocket</a> function to create the listening
socket.</p>

<h3><code>Flags</code> [in]</h3>

<p>A <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> value that contains the following flag, or zero:</p>

<h4>WSK_FLAG_AT_DISPATCH_LEVEL</h4>

<p>The WSK subsystem called the
<em>WskAcceptEvent</em> event callback function at IRQL = DISPATCH_LEVEL. If this flag is not set, the
WSK subsystem might have called the
<em>WskAcceptEvent</em> event callback function at any IRQL &lt;= DISPATCH_LEVEL.</p>

<h3><code>LocalAddress</code> [in]</h3>

<p>A pointer to a buffer that contains the local transport address on which the incoming connection
arrived. The buffer contains the specific SOCKADDR structure type that corresponds to the address family
that the WSK application specified when it created the listening socket.</p>

<h3><code>RemoteAddress</code> [in]</h3>

<p>A pointer to a buffer that contains the remote transport address from which the incoming
connection originated. The buffer contains the specific SOCKADDR structure type that corresponds to the
address family that the WSK application specified when it created the listening socket.</p>

<h3><code>AcceptSocket</code> [in, optional]</h3>

<p>A pointer to a
<a href="wsk_socket" title="typedef struct _WSK_SOCKET {&#10;  const VOID *Dispatch;&#10;} WSK_SOCKET, *PWSK_SOCKET;">WSK_SOCKET</a> structure that is the socket object
for the accepted socket. If this pointer is <strong>NULL</strong>, the listening socket is no longer functional and the
WSK application must call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_close_socket">WskCloseSocket</a> function to close the
listening socket as soon as possible.</p>

<h3><code>AcceptSocketContext</code> [out]</h3>

<p>A pointer to a variable that receives a pointer to a WSK application-supplied context for the
socket that is being accepted. The WSK subsystem passes this pointer to the accepted socket's event
callback functions. The context information is opaque to the WSK subsystem and must be stored in
non-paged memory. If the WSK application will not be enabling any event callback functions on the
accepted socket, the application should set the variable that is pointed to by the
<em>AcceptSocketContext</em> parameter to <strong>NULL</strong>.</p>

<h3><code>AcceptSocketDispatch</code> [out]</h3>

<p>A pointer to a variable that receives a pointer to a constant
<a href="wsk_client_connection_dispatch" title="typedef struct _WSK_CLIENT_CONNECTION_DISPATCH {&#10;  PFN_WSK_RECEIVE_EVENT      WskReceiveEvent;&#10;  PFN_WSK_DISCONNECT_EVENT   WskDisconnectEvent;&#10;  PFN_WSK_SEND_BACKLOG_EVENT WskSendBacklogEvent;&#10;} WSK_CLIENT_CONNECTION_DISPATCH, *PWSK_CLIENT_CONNECTION_DISPATCH;">WSK_CLIENT_CONNECTION_DISPATCH</a> structure. This structure is a dispatch table that contains
pointers to the event callback functions for the accepted socket. If the WSK application will not be
enabling all of the event callback functions for the accepted socket, the application should set the
pointers in the dispatch table to <strong>NULL</strong> for those event callback functions that it does not enable. If
the WSK application will not be enabling any event callback functions on the accepted socket, it should
set the variable that is pointed to by the
<em>AcceptSocketDispatch</em> parameter to <strong>NULL</strong>.</p>

<h2>Return value</h2>

<p>A WSK application's
<em>WskAcceptEvent</em> event callback function can return one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The WSK application accepted the incoming connection.</td>
</tr>
<tr>
  <td><strong>STATUS_REQUEST_NOT_ACCEPTED</strong></td>
  <td>The WSK application rejected the incoming connection. If this value is returned, the WSK subsystem will close the accepted socket on behalf of the WSK application.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>The WSK subsystem calls a WSK application's
<em>WskAcceptEvent</em> event callback function when an incoming connection is accepted on the listening
socket only if the event callback function was previously enabled with the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/so-wsk-event-callback">SO_WSK_EVENT_CALLBACK</a> socket option.
For more information about enabling a socket's event callback functions, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/enabling-and-disabling-event-callback-functions">Enabling and
Disabling Event Callback Functions</a>.</p>

<p>If a WSK application's
<em>WskAcceptEvent</em> event callback function is enabled on a listening socket and the application has a
pending call to the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept">WskAccept</a> function on the same listening socket,
then, when an incoming connection arrives, the pending call to
<strong>WskAccept</strong> takes precedence over the
<em>WskAcceptEvent</em> event callback function. The WSK subsystem calls the application's
<em>WskAcceptEvent</em> event callback function only if there are no IRPs queued from pending calls to the
<strong>WskAccept</strong> function. However, a WSK application should not assume that the WSK subsystem will not
call the application's
<em>WskAcceptEvent</em> event callback function for a listening socket that has a pending call to the
<strong>WskAccept</strong> function. Race conditions exist where the WSK subsystem could still call the WSK
application's
<em>WskAcceptEvent</em> event callback function for the socket. The only way for a WSK application to ensure
that the WSK subsystem will not call the application's
<em>WskAcceptEvent</em> event callback function for a listening socket is to disable the application's
<em>WskAcceptEvent</em> event callback function on the socket.</p>

<p>When the WSK subsystem calls a WSK application's
<em>WskAcceptEvent</em> event callback function, all of the event callback functions on the accepted socket
are disabled by default. If a WSK application enables any of the connection-oriented socket event
callback functions on a listening socket, those event callback functions will be enabled by default on
all connection-oriented sockets that are accepted on that listening socket. For more information about
enabling any of the accepted socket's event callback functions, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nc-evntprov-penablecallback">Enabling and
Disabling Event Callback Functions</a>.</p>

<p>The
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ws2def/ns-ws2def-sockaddr">SOCKADDR</a> structures that are pointed to by the
<em>LocalAddress</em> and
<em>RemoteAddress</em> parameters are valid only for the duration of the call to the
<em>WskAcceptEvent</em> event callback function. If a WSK application needs these transport addresses at a
later time, it can copy the contents of these structures to its own SOCKADDR structures before returning
from the
<em>WskAcceptEvent</em> event callback function, or it can later call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_get_local_address">WskGetLocalAddress</a> and
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_get_remote_address">WskGetRemoteAddress</a> functions on the
accepted socket.</p>

<p>The WSK subsystem allocates the memory for the socket object structure (
<a href="wsk_socket" title="typedef struct _WSK_SOCKET {&#10;  const VOID *Dispatch;&#10;} WSK_SOCKET, *PWSK_SOCKET;">WSK_SOCKET</a>) for the accepted connection on
behalf of the WSK application. The WSK subsystem deallocates this memory when the socket is closed.</p>

<p>The WSK subsystem calls a WSK application's
<em>WskAcceptEvent</em> event callback function at IRQL &lt;= DISPATCH_LEVEL.</p>

<p>A WSK application's <em>WskAcceptEvent</em> event callback function must not wait for completion of other WSK requests in the context of WSK completion or event callback functions. The callback can initiate other WSK requests (assuming that it doesn't spend too much time at DISPATCH_LEVEL), but it must not wait for their completion even when the callback is called at IRQL = PASSIVE_LEVEL.</p>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ws2def/ns-ws2def-sockaddr">SOCKADDR</a></p>

<p><a href="wsk_client_connection_dispatch" title="typedef struct _WSK_CLIENT_CONNECTION_DISPATCH {&#10;  PFN_WSK_RECEIVE_EVENT      WskReceiveEvent;&#10;  PFN_WSK_DISCONNECT_EVENT   WskDisconnectEvent;&#10;  PFN_WSK_SEND_BACKLOG_EVENT WskSendBacklogEvent;&#10;} WSK_CLIENT_CONNECTION_DISPATCH, *PWSK_CLIENT_CONNECTION_DISPATCH;">WSK_CLIENT_CONNECTION_DISPATCH</a></p>

<p><a href="wsk_client_listen_dispatch" title="typedef struct _WSK_CLIENT_LISTEN_DISPATCH {&#10;  PFN_WSK_ACCEPT_EVENT  WskAcceptEvent;&#10;  PFN_WSK_INSPECT_EVENT WskInspectEvent;&#10;  PFN_WSK_ABORT_EVENT   WskAbortEvent;&#10;} WSK_CLIENT_LISTEN_DISPATCH, *PWSK_CLIENT_LISTEN_DISPATCH;">WSK_CLIENT_LISTEN_DISPATCH</a></p>

<p><a href="wsk_socket" title="typedef struct _WSK_SOCKET {&#10;  const VOID *Dispatch;&#10;} WSK_SOCKET, *PWSK_SOCKET;">WSK_SOCKET</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept">WskAccept</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_close_socket">WskCloseSocket</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_control_socket">WskControlSocket</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_get_local_address">WskGetLocalAddress</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_get_remote_address">WskGetRemoteAddress</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_socket">WskSocket</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept_event">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wsk/nc-wsk-pfn_wsk_accept_event.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
