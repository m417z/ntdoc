<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IoSetPartitionInformation - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IoSetPartitionInformation - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IoSetPartitionInformation - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoSetPartitionInformation(
  [in] <a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a> DeviceObject,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>          SectorSize,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>          PartitionNumber,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>          PartitionType
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-iosetpartitioninformation">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/iosetpartitioninformation.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntddk-iosetpartitioninformation)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>IoSetPartitionInformation function</h1>

<h2>Description</h2>

<p>The <strong>IoSetPartitionInformation</strong> routine is <strong>obsolete</strong> and is provided only to support existing drivers. New drivers must use <a href="iosetpartitioninformationex" title="NTSTATUS IoSetPartitionInformationEx(&#10;  [in] PDEVICE_OBJECT                DeviceObject,&#10;  [in] ULONG                         PartitionNumber,&#10;  [in] _SET_PARTITION_INFORMATION_EX *PartitionInfo&#10;);">IoSetPartitionInformationEx</a>.</p>

<p><strong>IoSetPartitionInformation</strong> sets the partition type and number in a partition table entry for the disk represented by <em>DeviceObject</em>.</p>

<h2>Parameters</h2>

<h3><code>DeviceObject</code> [in]</h3>

<p>Pointer to the device object representing the device on which the partition type is to be set.</p>

<h3><code>SectorSize</code> [in]</h3>

<p>Specifies the size, in bytes, of sectors on the disk.</p>

<h3><code>PartitionNumber</code> [in]</h3>

<p>Specifies the partition number on the device whose partition type is to be set.</p>

<h3><code>PartitionType</code> [in]</h3>

<p>Specifies the type for the partition. For a list of some of the key partition types see <a href="partition_information" title="typedef struct _PARTITION_INFORMATION {&#10;  LARGE_INTEGER StartingOffset;&#10;  LARGE_INTEGER PartitionLength;&#10;  ULONG         HiddenSectors;&#10;  ULONG         PartitionNumber;&#10;  UCHAR         PartitionType;&#10;  BOOLEAN       BootIndicator;&#10;  BOOLEAN       RecognizedPartition;&#10;  BOOLEAN       RewritePartition;&#10;} PARTITION_INFORMATION, *PPARTITION_INFORMATION;">PARTITION_INFORMATION</a>.</p>

<h2>Return value</h2>

<p>If <strong>IoSetPartitionInformation</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, the disk driver updates its notion of the partition type for this partition in its device extension.</p>

<h2>Remarks</h2>

<p><strong>IoSetPartitionInformation</strong> must only be used by disk drivers. Other drivers should use the <a href="ioctl_disk_set_partition_info" title="// CTL_CODE(0x0007, 0x002, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)&#10;#define IOCTL_DISK_SET_PARTITION_INFO 0x0007C008">IOCTL_DISK_SET_PARTITION_INFO</a> disk I/O request instead.</p>

<p>This routine is called when a disk device driver is asked to set the partition type in a partition table entry by an <a href="irp_mj_device_control" title="#define IRP_MJ_DEVICE_CONTROL 0x0e">IRP_MJ_DEVICE_CONTROL</a> request. This request is generally issued by the format utility, which performs I/O control functions on the partition. The driver passes a pointer to the device object representing the physical disk and the number of the partition associated with the device object that the format utility has open. Since the HAL routines that underlie <strong>IoSetPartitionInformation</strong> were developed before support of dynamic partitioning was implemented, they do not distinguish between the <em>partition ordinal</em> (that is the order of a partition on a disk) and the <em>partition number</em> (the partition number assigned to a partition in order to identify it to the system). Drivers must call <strong>IoSetPartitionInformation</strong> using the <em>ordinal</em> number of the partition and not the actual partition number.</p>

<p>This routine is synchronous and must be called by the disk driver's Dispatch routine or by a driver thread. Thus, all user and file system threads must be prepared to enter a wait state when issuing the device control request to set the partition type for the device.</p>

<p>This routine operates under the assumption that the partition number passed in by the disk driver actually exists.</p>

<p>This routine must be called at IRQL = PASSIVE_LEVEL because it uses a kernel event object to synchronize I/O completion on the device. The event cannot be set to the Signaled state without queuing and executing the I/O system's special kernel APC routine for I/O completion.</p>

<h2>See also</h2>

<p><a href="ioreadpartitiontable" title="NTSTATUS IoReadPartitionTable(&#10;  [in]  PDEVICE_OBJECT            DeviceObject,&#10;  [in]  ULONG                     SectorSize,&#10;  [in]  BOOLEAN                   ReturnRecognizedPartitions,&#10;  [out] _DRIVE_LAYOUT_INFORMATION **PartitionBuffer&#10;);">IoReadPartitionTable</a></p>

<p><a href="iosetpartitioninformationex" title="NTSTATUS IoSetPartitionInformationEx(&#10;  [in] PDEVICE_OBJECT                DeviceObject,&#10;  [in] ULONG                         PartitionNumber,&#10;  [in] _SET_PARTITION_INFORMATION_EX *PartitionInfo&#10;);">IoSetPartitionInformationEx</a></p>

<p><a href="iowritepartitiontable" title="NTSTATUS IoWritePartitionTable(&#10;  [in] PDEVICE_OBJECT            DeviceObject,&#10;  [in] ULONG                     SectorSize,&#10;  [in] ULONG                     SectorsPerTrack,&#10;  [in] ULONG                     NumberOfHeads,&#10;  [in] _DRIVE_LAYOUT_INFORMATION *PartitionBuffer&#10;);">IoWritePartitionTable</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-iosetpartitioninformation">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddk/nf-ntddk-iosetpartitioninformation.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
