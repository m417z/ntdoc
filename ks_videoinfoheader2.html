<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KS_VIDEOINFOHEADER2 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KS_VIDEOINFOHEADER2 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KS_VIDEOINFOHEADER2 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ksmedia.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct tagKS_VIDEOINFOHEADER2 {
  RECT                rcSource;
  RECT                rcTarget;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwBitRate;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwBitErrorRate;
  REFERENCE_TIME      AvgTimePerFrame;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwInterlaceFlags;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwCopyProtectFlags;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwPictAspectRatioX;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwPictAspectRatioY;
  union {
    <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> dwControlFlags;
    <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> dwReserved1;
  };
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>               dwReserved2;
  <a href="ks_bitmapinfoheader" title="typedef struct tagKS_BITMAPINFOHEADER {&#10;  DWORD biSize;&#10;  LONG  biWidth;&#10;  LONG  biHeight;&#10;  WORD  biPlanes;&#10;  WORD  biBitCount;&#10;  DWORD biCompression;&#10;  DWORD biSizeImage;&#10;  LONG  biXPelsPerMeter;&#10;  LONG  biYPelsPerMeter;&#10;  DWORD biClrUsed;&#10;  DWORD biClrImportant;&#10;} KS_BITMAPINFOHEADER, *PKS_BITMAPINFOHEADER;">KS_BITMAPINFOHEADER</a> bmiHeader;
} KS_VIDEOINFOHEADER2, *PKS_VIDEOINFOHEADER2;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-tagks_videoinfoheader2">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ks_videoinfoheader2.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ksmedia-tagks_videoinfoheader2)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>tagKS_VIDEOINFOHEADER2 structure</h1>

<h2>Description</h2>

<p>The KS_VIDEOINFOHEADER2 structure describes the details of a video stream, including bob or weave settings, copy protection, and pixel aspect ratio.</p>

<h2>Members</h2>

<h3><code>rcSource</code></h3>

<p>Specifies a clipping rectangle that selects the portion of the active video signal to use.</p>

<h3><code>rcTarget</code></h3>

<p>Specifies a rectangle that indicates what part of the target buffer to use.</p>

<h3><code>dwBitRate</code></h3>

<p>Specifies a value that indicates the video stream's appropriate data rate, in bits per second.</p>

<h3><code>dwBitErrorRate</code></h3>

<p>Specifies a value that indicates the video stream's data error rate, in bit errors per second.</p>

<h3><code>AvgTimePerFrame</code></h3>

<p>Specifies the average time per frame, in 100-nanosecond units.</p>

<h3><code>dwInterlaceFlags</code></h3>

<p>Specifies interlace information. Undefined flags must be set to zero, or the connection may be rejected. This member can be set to one or more (logical OR) values that are defined in <em>ksmedia.h</em>:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>KS_INTERLACE_IsInterlaced</td>
  <td>Indicates an interlace stream. If 0, then the other KS_INTERLACE_Xxx bits are irrelevant.</td>
</tr>
<tr>
  <td>KS_INTERLACE_1FieldPerSample</td>
  <td>Indicates one field per media sample. If zero, indicates two fields per media sample.</td>
</tr>
<tr>
  <td>KS_INTERLACE_Field1First</td>
  <td>Indicates that Field 1 is first. If zero, indicates that Field 2 is first. Top field in PAL is Field 1, top field in NTSC is Field 2.</td>
</tr>
<tr>
  <td>KS_INTERLACE_UNUSED</td>
  <td>Unused</td>
</tr>
<tr>
  <td>KS_INTERLACE_FieldPatternMask</td>
  <td>Indicates the bits used to specify field pattern.</td>
</tr>
<tr>
  <td>KS_INTERLACE_FieldPatField1Only</td>
  <td>Indicates that a stream never contains a Field 2.</td>
</tr>
<tr>
  <td>KS_INTERLACE_FieldPatField2Only</td>
  <td>Indicates that a stream never contains a Field 1.</td>
</tr>
<tr>
  <td>KS_INTERLACE_FieldPatBothRegular</td>
  <td>Indicates that there will be a Field 2 for every Field 1.</td>
</tr>
<tr>
  <td>KS_INTERLACE_FieldPatBothIrregular</td>
  <td>Indicates a random pattern of Field 1s and Field 2s.</td>
</tr>
<tr>
  <td>KS_INTERLACE_DisplayModeMask</td>
  <td>Invalid for video capture.</td>
</tr>
<tr>
  <td>KS_INTERLACE_DisplayModeBobOnly</td>
  <td>Invalid for video capture.</td>
</tr>
<tr>
  <td>KS_INTERLACE_DisplayModeWeaveOnly</td>
  <td>Invalid for video capture.</td>
</tr>
<tr>
  <td>KS_INTERLACE_DisplayModeBobOrWeave</td>
  <td>Invalid for video capture.</td>
</tr>
</tbody>
</table>

<h3><code>dwCopyProtectFlags</code></h3>

<p>Specifies a KSCOPYPROTECTRestrictDuplication value (0x00000001) to indicate if duplication of a stream should be restricted. If undefined, specify zero or the connection will be rejected.</p>

<h3><code>dwPictAspectRatioX</code></h3>

<p>Specifies the <em>x</em> dimension of the picture-aspect ratio (for example, 16 for a 16 × 9 display). The value is expressed in inches-by-inches, not pixels-by-pixels.</p>

<h3><code>dwPictAspectRatioY</code></h3>

<p>Specifies the <em>y</em> dimension of the picture aspect ratio (for example, 9 for 16 × 9 display). The value is expressed in inches-by-inches, not pixels-by-pixels.</p>

<h3><code>dwControlFlags</code></h3>

<p>In operating systems prior to Windows Vista, this member was named <strong>dwReserved1</strong> and was required to be zero. In Windows Vista, <strong>dwReserved1</strong> was combined in a union with a new member named <strong>dwControlFlags</strong>. If used, <strong>dwControlFlags</strong> contains a bitwise OR of the flags in the following table.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>AMCONTROL_USED</td>
  <td>Indicates the <strong>dwControlFlags</strong> flags are used.</td>
</tr>
<tr>
  <td>AMCONTROL_PAD_TO_4x3</td>
  <td>The image should be padded and displayed in a 4 x 3 area.</td>
</tr>
<tr>
  <td>AMCONTROL_PAD_TO_16x9</td>
  <td>The image should be padded and displayed in a 16 x 9 area.</td>
</tr>
<tr>
  <td>AMCONTROL_COLORINFO_PRESENT</td>
  <td>Additional color information is contained in the upper 24 bits of the <strong>dwControlFlags</strong> field.</td>
</tr>
</tbody>
</table>

<p>The AMCONTROL_USED flag provides backward compatibility with older filters. If the AMCONTROL_USED flag is not set, the remaining bits in this field should be ignored. If a filter uses any other flags, it should set the AMCONTROL_USED flag.</p>

<p>The two AMCONTROL_PAD_xxx flags are used by decoders to determine the aspect ratio of the output rectangle.</p>

<p>If the AMCONTROL_COLORINFO_PRESENT flag is set, it means the upper 24 bits of the dwControlFlags field are treated as a <a href="dxva_extendedformat" title="typedef struct _DXVA_ExtendedFormat {&#10;  UINT                       SampleFormat : 8;&#10;  UINT                       VideoChromaSubsampling : 4;&#10;  DXVA_NominalRange          NominalRange : 3;&#10;  DXVA_VideoTransferMatrix   VideoTransferMatrix : 3;&#10;  DXVA_VideoLighting         VideoLighting : 4;&#10;  DXVA_VideoPrimaries        VideoPrimaries : 5;&#10;  DXVA_VideoTransferFunction VideoTransferFunction : 5;&#10;} DXVA_ExtendedFormat;">DXVA_ExtendedFormat</a> structure.</p>

<p>See the Remarks section later in this topic for more information about <strong>dwControlFlags</strong>.</p>

<h3><code>dwReserved1</code></h3>

<p>This member is for backward compatibility. See <strong>dwControlFlags</strong> for more information.</p>

<h3><code>dwReserved2</code></h3>

<p>Reserved for system use. Must be set to zero or the connection will be rejected.</p>

<h3><code>bmiHeader</code></h3>

<p>Indicates a <a href="ks_bitmapinfoheader" title="typedef struct tagKS_BITMAPINFOHEADER {&#10;  DWORD biSize;&#10;  LONG  biWidth;&#10;  LONG  biHeight;&#10;  WORD  biPlanes;&#10;  WORD  biBitCount;&#10;  DWORD biCompression;&#10;  DWORD biSizeImage;&#10;  LONG  biXPelsPerMeter;&#10;  LONG  biYPelsPerMeter;&#10;  DWORD biClrUsed;&#10;  DWORD biClrImportant;&#10;} KS_BITMAPINFOHEADER, *PKS_BITMAPINFOHEADER;">KS_BITMAPINFOHEADER</a> structure that contains color and dimension information for the video image bitmap.</p>

<h2>Remarks</h2>

<p>To describe a video stream without bob or weave settings, use <a href="ks_videoinfoheader" title="typedef struct tagKS_VIDEOINFOHEADER {&#10;  RECT                rcSource;&#10;  RECT                rcTarget;&#10;  DWORD               dwBitRate;&#10;  DWORD               dwBitErrorRate;&#10;  REFERENCE_TIME      AvgTimePerFrame;&#10;  KS_BITMAPINFOHEADER bmiHeader;&#10;} KS_VIDEOINFOHEADER, *PKS_VIDEOINFOHEADER;">KS_VIDEOINFOHEADER</a>.</p>

<p>The KS_VIDEOINFOHEADER2 structure is identical to the DirectShow <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions//ms787914(v=vs.85)">VIDEOINFOHEADER2</a> structure.</p>

<p>Capture minidrivers that produce video fields (instead of frames) must use the <a href="ks_datarange_video2" title="typedef struct tagKS_DATARANGE_VIDEO2 {&#10;  KSDATARANGE                 DataRange;&#10;  BOOL                        bFixedSizeSamples;&#10;  BOOL                        bTemporalCompression;&#10;  DWORD                       StreamDescriptionFlags;&#10;  DWORD                       MemoryAllocationFlags;&#10;  KS_VIDEO_STREAM_CONFIG_CAPS ConfigCaps;&#10;  KS_VIDEOINFOHEADER2         VideoInfoHeader;&#10;} KS_DATARANGE_VIDEO2, *PKS_DATARANGE_VIDEO2;">KS_DATARANGE_VIDEO2</a> structure, which contains the KS_VIDEOINFOHEADER2 structure.</p>

<p>A source filter can request that the sink filter take only a section of the video by providing values that effectively define a clipping rectangle in the <strong>rcSource</strong> member. However, if the sink filter does not check for the clipping rectangle on connection, the sink filter simply renders all of the video, effectively ignoring any clipping information passed from the source filter to the sink filter.</p>

<p>Ideally, a sink filter checks <strong>rcSource</strong> and if the sink filter does not support image extraction, and the rectangle is <em>not</em> empty, then it rejects the connection. A filter should use the Win32 function <strong>SetRectEmpty</strong> to reset a rectangle to all zeros (and set <strong>IsRectEmpty</strong> to later check the rectangle).</p>

<p>The <strong>rcTarget</strong> member specifies the destination rectangle for the video. Most source filters set this member to all zeros. A downstream filter can request that the video be placed in a particular area of the buffers that it supplies. In this case, it calls the Win32 function <strong>QueryAccept</strong> with a nonempty target.</p>

<p>If the AMCONTROL_COLORINFO_PRESENT flag is set in the <strong>dwControlFlags</strong> member, you can cast the <strong>dwControlFlags</strong> value to a <a href="dxva_extendedformat" title="typedef struct _DXVA_ExtendedFormat {&#10;  UINT                       SampleFormat : 8;&#10;  UINT                       VideoChromaSubsampling : 4;&#10;  DXVA_NominalRange          NominalRange : 3;&#10;  DXVA_VideoTransferMatrix   VideoTransferMatrix : 3;&#10;  DXVA_VideoLighting         VideoLighting : 4;&#10;  DXVA_VideoPrimaries        VideoPrimaries : 5;&#10;  DXVA_VideoTransferFunction VideoTransferFunction : 5;&#10;} DXVA_ExtendedFormat;">DXVA_ExtendedFormat</a> structure to access the extended color information. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions//ms787914(v=vs.85)">VIDEOINFOHEADER2</a>.</p>

<h2>See also</h2>

<p><a href="ks_bitmapinfoheader" title="typedef struct tagKS_BITMAPINFOHEADER {&#10;  DWORD biSize;&#10;  LONG  biWidth;&#10;  LONG  biHeight;&#10;  WORD  biPlanes;&#10;  WORD  biBitCount;&#10;  DWORD biCompression;&#10;  DWORD biSizeImage;&#10;  LONG  biXPelsPerMeter;&#10;  LONG  biYPelsPerMeter;&#10;  DWORD biClrUsed;&#10;  DWORD biClrImportant;&#10;} KS_BITMAPINFOHEADER, *PKS_BITMAPINFOHEADER;">KS_BITMAPINFOHEADER</a></p>

<p><a href="ks_datarange_video2" title="typedef struct tagKS_DATARANGE_VIDEO2 {&#10;  KSDATARANGE                 DataRange;&#10;  BOOL                        bFixedSizeSamples;&#10;  BOOL                        bTemporalCompression;&#10;  DWORD                       StreamDescriptionFlags;&#10;  DWORD                       MemoryAllocationFlags;&#10;  KS_VIDEO_STREAM_CONFIG_CAPS ConfigCaps;&#10;  KS_VIDEOINFOHEADER2         VideoInfoHeader;&#10;} KS_DATARANGE_VIDEO2, *PKS_DATARANGE_VIDEO2;">KS_DATARANGE_VIDEO2</a></p>

<p><a href="ks_videoinfoheader" title="typedef struct tagKS_VIDEOINFOHEADER {&#10;  RECT                rcSource;&#10;  RECT                rcTarget;&#10;  DWORD               dwBitRate;&#10;  DWORD               dwBitErrorRate;&#10;  REFERENCE_TIME      AvgTimePerFrame;&#10;  KS_BITMAPINFOHEADER bmiHeader;&#10;} KS_VIDEOINFOHEADER, *PKS_VIDEOINFOHEADER;">KS_VIDEOINFOHEADER</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-tagks_videoinfoheader2">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ksmedia/ns-ksmedia-tagks_videoinfoheader2.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
