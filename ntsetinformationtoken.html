<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtSetInformationToken - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtSetInformationToken - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtSetInformationToken - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTSEAPI_H

</span><span class="ntdoc-code-intro">/**
 * The NtSetInformationToken routine modifies information in a specified token. The calling process must have appropriate access rights to set the information.
 *
 * @param TokenHandle A handle to an existing access token which information is to be modified.
 * @param TokenInformationClass A value from the <a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a> enumerated type identifying the type of information to be modified.
 * @param TokenInformation Pointer to a caller-allocated buffer containing the information to be modified in the token.
 * @param TokenInformationLength Length, in bytes, of the caller-allocated TokenInformation buffer.
 * @return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * @sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntsetinformationtoken
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtSetInformationToken(
    _In_ HANDLE TokenHandle,
    _In_ <a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a> TokenInformationClass,
    _In_reads_bytes_(TokenInformationLength) PVOID TokenInformation,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TokenInformationLength
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/3d935379c6ac1f147cc4e3b25bed778f0d140c69/phnt/include/ntseapi.h#L581">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwSetInformationToken(
    _In_ HANDLE TokenHandle,
    _In_ <a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a> TokenInformationClass,
    _In_reads_bytes_(TokenInformationLength) PVOID TokenInformation,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TokenInformationLength
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/3d935379c6ac1f147cc4e3b25bed778f0d140c69/phnt/include/ntzwapi.h#L4313">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">__kernel_entry NTSYSCALLAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NtSetInformationToken(
  [in] HANDLE                  TokenHandle,
  [in] <a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a> TokenInformationClass,
  [in] PVOID                   TokenInformation,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                   TokenInformationLength
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntsetinformationtoken">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwSetInformationToken(
  [in] HANDLE                  TokenHandle,
  [in] <a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a> TokenInformationClass,
  [in] PVOID                   TokenInformation,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                   TokenInformationLength
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationtoken">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<p>Sets various information about the specified token. This function is partially documented in Windows Driver Kit <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntsetinformationtoken">here</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationtoken">here</a>.</p>

<h1 id="parameters">Parameters</h1>

<ul>
<li><code>TokenHandle</code> - a handle to the token. For most information classes, the handle must grant <code>TOKEN_ADJUST_DEFAULT</code> access.</li>
<li><code>TokenInformationClass</code> - the type of information to set.</li>
<li><code>TokenInformation</code> - a pointer to the buffer with the data specific to the request.</li>
<li><code>TokenInformationLength</code> - the size of the provided buffer in bytes.</li>
</ul>

<h1 id="information-classes">Information classes</h1>

<p>For the list of supported info classes and required token access, see <code><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></code>.</p>

<h1 id="notable-return-values">Notable return values</h1>

<ul>
<li><code>STATUS_TOKEN_ALREADY_IN_USE</code> indicates that the specified type of information cannot be changed for a token that is currently used as a primary token for a process.</li>
</ul>

<h1 id="remarks">Remarks</h1>

<p>Note that as opposed to <code><a href="ntqueryinformationtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryInformationToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ TOKEN_INFORMATION_CLASS TokenInformationClass,&#10;    _Out_writes_bytes_to_opt_(TokenInformationLength, *ReturnLength) PVOID TokenInformation,&#10;    _In_ ULONG TokenInformationLength,&#10;    _Out_ PULONG ReturnLength&#10;    );">NtQueryInformationToken</a></code>, this function does not support token pseudo-handles.</p>

<h1 id="related-win32-api">Related Win32 API</h1>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-settokeninformation"><code>SetTokenInformation</code></a></li>
</ul>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntqueryinformationtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryInformationToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ TOKEN_INFORMATION_CLASS TokenInformationClass,&#10;    _Out_writes_bytes_to_opt_(TokenInformationLength, *ReturnLength) PVOID TokenInformation,&#10;    _In_ ULONG TokenInformationLength,&#10;    _Out_ PULONG ReturnLength&#10;    );">NtQueryInformationToken</a></code></li>
<li><code><a href="ntfiltertoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtFilterToken(&#10;    _In_ HANDLE ExistingTokenHandle,&#10;    _In_ ULONG Flags,&#10;    _In_opt_ PTOKEN_GROUPS SidsToDisable,&#10;    _In_opt_ PTOKEN_PRIVILEGES PrivilegesToDelete,&#10;    _In_opt_ PTOKEN_GROUPS RestrictedSids,&#10;    _Out_ PHANDLE NewTokenHandle&#10;    );">NtFilterToken</a></code></li>
<li><code><a href="ntadjustprivilegestoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAdjustPrivilegesToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ BOOLEAN DisableAllPrivileges,&#10;    _In_opt_ PTOKEN_PRIVILEGES NewState,&#10;    _In_ ULONG BufferLength,&#10;    _Out_writes_bytes_to_opt_(BufferLength, *ReturnLength) PTOKEN_PRIVILEGES PreviousState,&#10;    _Out_opt_ PULONG ReturnLength&#10;    );">NtAdjustPrivilegesToken</a></code></li>
<li><code><a href="ntadjustgroupstoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAdjustGroupsToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ BOOLEAN ResetToDefault,&#10;    _In_opt_ PTOKEN_GROUPS NewState,&#10;    _In_opt_ ULONG BufferLength,&#10;    _Out_writes_bytes_to_opt_(BufferLength, *ReturnLength) PTOKEN_GROUPS PreviousState,&#10;    _Out_opt_ PULONG ReturnLength&#10;    );">NtAdjustGroupsToken</a></code></li>
<li><code><a href="ntopenprocesstoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenProcessToken(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _Out_ PHANDLE TokenHandle&#10;    );">NtOpenProcessToken</a></code></li>
<li><code><a href="ntopenthreadtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenThreadToken(&#10;    _In_ HANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ BOOLEAN OpenAsSelf,&#10;    _Out_ PHANDLE TokenHandle&#10;    );">NtOpenThreadToken</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntsetinformationtoken.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-ntsetinformationtoken)</h1>
</div>
<div class="ntdoc-description">
<h1>NtSetInformationToken function</h1>

<h2>Description</h2>

<p>The <strong>NtSetInformationToken</strong> routine modifies information in a specified token. The calling process must have appropriate access rights to set the information.</p>

<h2>Parameters</h2>

<h3><code>TokenHandle</code> [in]</h3>

<p>Handle for an access token in which information is to be modified.</p>

<h3><code>TokenInformationClass</code> [in]</h3>

<p>A value from the <strong><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></strong> enumerated type identifying the type of information to be modified. The possible values for this parameter are listed in the <strong>TokenInformationClass</strong> Value column of the table shown in the description of the <strong>TokenInformation</strong> parameter.</p>

<h3><code>TokenInformation</code> [in]</h3>

<p>Pointer to a caller-supplied buffer containing the information to be modified in the token. The structure of the information in this buffer depends upon the value of <strong>TokenInformationClass</strong>, as shown in the following table. All structures must be aligned on a 32-bit boundary.</p>

<table>
<thead>
<tr>
  <th>TokenInformationClass value</th>
  <th>Effect on TokenInformation buffer</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="tokendefaultdacl" title="#define TokenDefaultDacl 6 // q; s: TOKEN_DEFAULT_DACL">TokenDefaultDacl</a></strong></td>
  <td>The buffer contains a <strong><a href="token_default_dacl" title="typedef struct _TOKEN_DEFAULT_DACL {&#10;  PACL DefaultDacl;&#10;} TOKEN_DEFAULT_DACL, *PTOKEN_DEFAULT_DACL;">TOKEN_DEFAULT_DACL</a></strong> structure specifying the default <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_acl"><strong>DACL</strong></a> for newly created objects. TOKEN_ADJUST_DEFAULT access is required to set this information. The buffer contents are not validated for structural correctness or consistency.</td>
</tr>
<tr>
  <td><strong>TokenGroups</strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong>TokenOwner</strong></td>
  <td>The buffer contains a <strong><a href="token_owner" title="typedef struct _TOKEN_OWNER {&#10;  PSID Owner;&#10;} TOKEN_OWNER, *PTOKEN_OWNER;">TOKEN_OWNER</a></strong> structure specifying the default owner <strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong> for newly created objects. TOKEN_ADJUST_DEFAULT access is required to set this information. The owner values that may be specified are restricted to the user and group IDs with an attribute indicating they can be assigned as the owner of objects.</td>
</tr>
<tr>
  <td><strong><a href="tokenprimarygroup" title="#define TokenPrimaryGroup 5 // q; s: TOKEN_PRIMARY_GROUP">TokenPrimaryGroup</a></strong></td>
  <td>The buffer contains a <strong><a href="token_primary_group" title="typedef struct _TOKEN_PRIMARY_GROUP {&#10;  PSID PrimaryGroup;&#10;} TOKEN_PRIMARY_GROUP, *PTOKEN_PRIMARY_GROUP;">TOKEN_PRIMARY_GROUP</a></strong> structure specifying the default primary group <strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong> for newly created objects. TOKEN_ADJUST_DEFAULT access is required to set this information. Must be one of the group IDs already in the token.</td>
</tr>
<tr>
  <td><strong>TokenPrivileges</strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong><a href="tokensource" title="#define TokenSource 7 // q: TOKEN_SOURCE">TokenSource</a></strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong><a href="tokenstatistics" title="#define TokenStatistics 10 // q: TOKEN_STATISTICS // 10">TokenStatistics</a></strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong>TokenUser</strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
</tbody>
</table>

<h3><code>TokenInformationLength</code> [in]</h3>

<p>Size, in bytes, of the structure passed in the <strong>TokenInformation</strong> buffer. Must be greater than or equal to the minimum value given in the following table.</p>

<table>
<thead>
<tr>
  <th>TokenInformationClass value</th>
  <th>Minimum TokenInformationLength</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="tokendefaultdacl" title="#define TokenDefaultDacl 6 // q; s: TOKEN_DEFAULT_DACL">TokenDefaultDacl</a></strong></td>
  <td><strong>sizeof</strong>(<strong><a href="token_default_dacl" title="typedef struct _TOKEN_DEFAULT_DACL {&#10;  PACL DefaultDacl;&#10;} TOKEN_DEFAULT_DACL, *PTOKEN_DEFAULT_DACL;">TOKEN_DEFAULT_DACL</a></strong>)</td>
</tr>
<tr>
  <td><strong>TokenOwner</strong></td>
  <td><strong>sizeof</strong>(<strong><a href="token_owner" title="typedef struct _TOKEN_OWNER {&#10;  PSID Owner;&#10;} TOKEN_OWNER, *PTOKEN_OWNER;">TOKEN_OWNER</a></strong>)</td>
</tr>
<tr>
  <td><strong><a href="tokenprimarygroup" title="#define TokenPrimaryGroup 5 // q; s: TOKEN_PRIMARY_GROUP">TokenPrimaryGroup</a></strong></td>
  <td><strong>sizeof</strong>(<strong><a href="token_primary_group" title="typedef struct _TOKEN_PRIMARY_GROUP {&#10;  PSID PrimaryGroup;&#10;} TOKEN_PRIMARY_GROUP, *PTOKEN_PRIMARY_GROUP;">TOKEN_PRIMARY_GROUP</a></strong>)</td>
</tr>
</tbody>
</table>

<h2>Return value</h2>

<p><strong>NtSetInformationToken</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or an appropriate error status. Possible error status codes include the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td><strong>TokenHandle</strong> did not have the required access.</td>
</tr>
<tr>
  <td>STATUS_ALLOTTED_SPACE_EXCEEDED</td>
  <td>The space allotted for storage of the default discretionary access control and the primary group ID is not large enough to accept the new value of one of these fields.</td>
</tr>
<tr>
  <td>STATUS_INFO_LENGTH_MISMATCH</td>
  <td>The value of <strong>TokenInformationLength</strong> was less than the required minimum.</td>
</tr>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td>The specified default owner's security information could not be captured.</td>
</tr>
<tr>
  <td>STATUS_INVALID_HANDLE</td>
  <td><strong>TokenHandle</strong> was not a valid handle.</td>
</tr>
<tr>
  <td>STATUS_INVALID_INFO_CLASS</td>
  <td><strong>TokenInformationClass</strong> was not a valid token information class.</td>
</tr>
<tr>
  <td>STATUS_INVALID_OWNER</td>
  <td>The caller cannot set the specified ID to be an owner (or default owner) of an object.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PRIMARY_GROUP</td>
  <td>The caller cannot set the specified ID to be the primary group of an object.</td>
</tr>
<tr>
  <td>STATUS_INVALID_SID</td>
  <td>The specified default owner's security information was not valid.</td>
</tr>
<tr>
  <td>STATUS_OBJECT_TYPE_MISMATCH</td>
  <td><strong>TokenHandle</strong> was not a token handle.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>For more information about security and access control, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/driversecurity/windows-security-model">Windows security model for driver developers</a> and the documentation on these topics in the Windows SDK.</p>

<blockquote>
  <p>[!NOTE]
  If the call to the <strong>NtSetInformationToken</strong> function occurs in kernel mode, you should use the name "<strong>ZwSetInformationToken</strong>" instead of "<strong>NtSetInformationToken</strong>".</p>
</blockquote>

<p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>

<h2>See also</h2>

<p><strong><a href="ntqueryinformationtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryInformationToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ TOKEN_INFORMATION_CLASS TokenInformationClass,&#10;    _Out_writes_bytes_to_opt_(TokenInformationLength, *ReturnLength) PVOID TokenInformation,&#10;    _In_ ULONG TokenInformationLength,&#10;    _Out_ PULONG ReturnLength&#10;    );">NtQueryInformationToken</a></strong></p>

<p><strong><a href="psdereferenceimpersonationtoken" title="VOID PsDereferenceImpersonationToken(&#10;  [in] PACCESS_TOKEN ImpersonationToken&#10;);">PsDereferenceImpersonationToken</a></strong></p>

<p><strong><a href="psdereferenceprimarytoken" title="VOID PsDereferencePrimaryToken(&#10;  [in] PACCESS_TOKEN PrimaryToken&#10;);">PsDereferencePrimaryToken</a></strong></p>

<p><strong><a href="security_impersonation_level" title="typedef enum _SECURITY_IMPERSONATION_LEVEL {&#10;  SecurityAnonymous,&#10;  SecurityIdentification,&#10;  SecurityImpersonation,&#10;  SecurityDelegation&#10;} SECURITY_IMPERSONATION_LEVEL, *PSECURITY_IMPERSONATION_LEVEL;">SECURITY_IMPERSONATION_LEVEL</a></strong></p>

<p><strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong></p>

<p><strong><a href="sequeryauthenticationidtoken" title="NTSTATUS SeQueryAuthenticationIdToken(&#10;  [in]  PACCESS_TOKEN Token,&#10;  [out] PLUID         AuthenticationId&#10;);">SeQueryAuthenticationIdToken</a></strong></p>

<p><strong><a href="sequerysubjectcontexttoken" title="PACESS_TOKEN&#10;SeQuerySubjectContextToken(SubjectContext);">SeQuerySubjectContextToken</a></strong></p>

<p><strong><a href="setokenisadmin" title="BOOLEAN SeTokenIsAdmin(&#10;  [in] PACCESS_TOKEN Token&#10;);">SeTokenIsAdmin</a></strong></p>

<p><strong><a href="setokenisrestricted" title="BOOLEAN SeTokenIsRestricted(&#10;  [in] PACCESS_TOKEN Token&#10;);">SeTokenIsRestricted</a></strong></p>

<p><strong><a href="token_default_dacl" title="typedef struct _TOKEN_DEFAULT_DACL {&#10;  PACL DefaultDacl;&#10;} TOKEN_DEFAULT_DACL, *PTOKEN_DEFAULT_DACL;">TOKEN_DEFAULT_DACL</a></strong></p>

<p><strong><a href="token_groups" title="typedef struct _TOKEN_GROUPS {&#10;  ULONG              GroupCount;&#10;#if ...&#10;  SID_AND_ATTRIBUTES *Groups[];&#10;#else&#10;  SID_AND_ATTRIBUTES Groups[ANYSIZE_ARRAY];&#10;#endif&#10;} TOKEN_GROUPS, *PTOKEN_GROUPS;">TOKEN_GROUPS</a></strong></p>

<p><strong><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></strong></p>

<p><strong><a href="token_owner" title="typedef struct _TOKEN_OWNER {&#10;  PSID Owner;&#10;} TOKEN_OWNER, *PTOKEN_OWNER;">TOKEN_OWNER</a></strong></p>

<p><strong><a href="token_primary_group" title="typedef struct _TOKEN_PRIMARY_GROUP {&#10;  PSID PrimaryGroup;&#10;} TOKEN_PRIMARY_GROUP, *PTOKEN_PRIMARY_GROUP;">TOKEN_PRIMARY_GROUP</a></strong></p>

<p><strong><a href="token_privileges" title="typedef struct _TOKEN_PRIVILEGES {&#10;  ULONG               PrivilegeCount;&#10;  LUID_AND_ATTRIBUTES Privileges[ANYSIZE_ARRAY];&#10;} TOKEN_PRIVILEGES, *PTOKEN_PRIVILEGES;">TOKEN_PRIVILEGES</a></strong></p>

<p><strong><a href="token_source" title="typedef struct _TOKEN_SOURCE {&#10;  CHAR SourceName[TOKEN_SOURCE_LENGTH];&#10;  LUID SourceIdentifier;&#10;} TOKEN_SOURCE, *PTOKEN_SOURCE;">TOKEN_SOURCE</a></strong></p>

<p><strong><a href="token_statistics" title="typedef struct _TOKEN_STATISTICS {&#10;  LUID                         TokenId;&#10;  LUID                         AuthenticationId;&#10;  LARGE_INTEGER                ExpirationTime;&#10;  TOKEN_TYPE                   TokenType;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  ULONG                        DynamicCharged;&#10;  ULONG                        DynamicAvailable;&#10;  ULONG                        GroupCount;&#10;  ULONG                        PrivilegeCount;&#10;  LUID                         ModifiedId;&#10;} TOKEN_STATISTICS, *PTOKEN_STATISTICS;">TOKEN_STATISTICS</a></strong></p>

<p><strong><a href="token_type" title="typedef enum _TOKEN_TYPE {&#10;  TokenPrimary,&#10;  TokenImpersonation&#10;} TOKEN_TYPE;">TOKEN_TYPE</a></strong></p>

<p><strong><a href="token_user" title="typedef struct _TOKEN_USER {&#10;  SID_AND_ATTRIBUTES User;&#10;} TOKEN_USER, *PTOKEN_USER;">TOKEN_USER</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntsetinformationtoken">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-ntsetinformationtoken.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-zwsetinformationtoken)</h1>
</div>
<div class="ntdoc-description">
<h1>ZwSetInformationToken function</h1>

<h2>Description</h2>

<p>The <strong>ZwSetInformationToken</strong> routine modifies information in a specified token. The calling process must have appropriate access rights to set the information.</p>

<h2>Parameters</h2>

<h3><code>TokenHandle</code> [in]</h3>

<p>Handle for an access token in which information is to be modified.</p>

<h3><code>TokenInformationClass</code> [in]</h3>

<p>A value from the <strong><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></strong> enumerated type identifying the type of information to be modified. The possible values for this parameter are listed in the <strong>TokenInformationClass</strong> Value column of the table shown in the description of the <strong>TokenInformation</strong> parameter.</p>

<h3><code>TokenInformation</code> [in]</h3>

<p>Pointer to a caller-supplied buffer containing the information to be modified in the token. The structure of the information in this buffer depends upon the value of <strong>TokenInformationClass</strong>, as shown in the following table. All structures must be aligned on a 32-bit boundary.</p>

<table>
<thead>
<tr>
  <th>TokenInformationClass value</th>
  <th>Effect on TokenInformation buffer</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="tokendefaultdacl" title="#define TokenDefaultDacl 6 // q; s: TOKEN_DEFAULT_DACL">TokenDefaultDacl</a></strong></td>
  <td>The buffer contains a <strong><a href="token_default_dacl" title="typedef struct _TOKEN_DEFAULT_DACL {&#10;  PACL DefaultDacl;&#10;} TOKEN_DEFAULT_DACL, *PTOKEN_DEFAULT_DACL;">TOKEN_DEFAULT_DACL</a></strong> structure specifying the default <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_acl"><strong>DACL</strong></a> for newly created objects. TOKEN_ADJUST_DEFAULT access is required to set this information. The buffer contents are not validated for structural correctness or consistency.</td>
</tr>
<tr>
  <td><strong>TokenGroups</strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong>TokenOwner</strong></td>
  <td>The buffer contains a <strong><a href="token_owner" title="typedef struct _TOKEN_OWNER {&#10;  PSID Owner;&#10;} TOKEN_OWNER, *PTOKEN_OWNER;">TOKEN_OWNER</a></strong> structure specifying the default owner <strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong> for newly created objects. TOKEN_ADJUST_DEFAULT access is required to set this information. The owner values that may be specified are restricted to the user and group IDs with an attribute indicating they can be assigned as the owner of objects.</td>
</tr>
<tr>
  <td><strong><a href="tokenprimarygroup" title="#define TokenPrimaryGroup 5 // q; s: TOKEN_PRIMARY_GROUP">TokenPrimaryGroup</a></strong></td>
  <td>The buffer contains a <strong><a href="token_primary_group" title="typedef struct _TOKEN_PRIMARY_GROUP {&#10;  PSID PrimaryGroup;&#10;} TOKEN_PRIMARY_GROUP, *PTOKEN_PRIMARY_GROUP;">TOKEN_PRIMARY_GROUP</a></strong> structure specifying the default primary group <strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong> for newly created objects. TOKEN_ADJUST_DEFAULT access is required to set this information. Must be one of the group IDs already in the token.</td>
</tr>
<tr>
  <td><strong>TokenPrivileges</strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong><a href="tokensource" title="#define TokenSource 7 // q: TOKEN_SOURCE">TokenSource</a></strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong><a href="tokenstatistics" title="#define TokenStatistics 10 // q: TOKEN_STATISTICS // 10">TokenStatistics</a></strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
<tr>
  <td><strong>TokenUser</strong></td>
  <td>Not a valid information class. This information is read-only.</td>
</tr>
</tbody>
</table>

<h3><code>TokenInformationLength</code> [in]</h3>

<p>Size, in bytes, of the structure passed in the <strong>TokenInformation</strong> buffer. Must be greater than or equal to the minimum value given in the following table.</p>

<table>
<thead>
<tr>
  <th>TokenInformationClass value</th>
  <th>Minimum TokenInformationLength</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="tokendefaultdacl" title="#define TokenDefaultDacl 6 // q; s: TOKEN_DEFAULT_DACL">TokenDefaultDacl</a></strong></td>
  <td><strong>sizeof</strong>(<strong><a href="token_default_dacl" title="typedef struct _TOKEN_DEFAULT_DACL {&#10;  PACL DefaultDacl;&#10;} TOKEN_DEFAULT_DACL, *PTOKEN_DEFAULT_DACL;">TOKEN_DEFAULT_DACL</a></strong>)</td>
</tr>
<tr>
  <td><strong>TokenOwner</strong></td>
  <td><strong>sizeof</strong>(<strong><a href="token_owner" title="typedef struct _TOKEN_OWNER {&#10;  PSID Owner;&#10;} TOKEN_OWNER, *PTOKEN_OWNER;">TOKEN_OWNER</a></strong>)</td>
</tr>
<tr>
  <td><strong><a href="tokenprimarygroup" title="#define TokenPrimaryGroup 5 // q; s: TOKEN_PRIMARY_GROUP">TokenPrimaryGroup</a></strong></td>
  <td><strong>sizeof</strong>(<strong><a href="token_primary_group" title="typedef struct _TOKEN_PRIMARY_GROUP {&#10;  PSID PrimaryGroup;&#10;} TOKEN_PRIMARY_GROUP, *PTOKEN_PRIMARY_GROUP;">TOKEN_PRIMARY_GROUP</a></strong>)</td>
</tr>
</tbody>
</table>

<h2>Return value</h2>

<p><strong>ZwSetInformationToken</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or an appropriate error status. Possible error status codes include the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td><strong>TokenHandle</strong> did not have the required access.</td>
</tr>
<tr>
  <td>STATUS_ALLOTTED_SPACE_EXCEEDED</td>
  <td>The space allotted for storage of the default discretionary access control and the primary group ID is not large enough to accept the new value of one of these fields.</td>
</tr>
<tr>
  <td>STATUS_INFO_LENGTH_MISMATCH</td>
  <td>The value of <strong>TokenInformationLength</strong> was less than the required minimum.</td>
</tr>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td>The specified default owner's security information could not be captured.</td>
</tr>
<tr>
  <td>STATUS_INVALID_HANDLE</td>
  <td><strong>TokenHandle</strong> was not a valid handle.</td>
</tr>
<tr>
  <td>STATUS_INVALID_INFO_CLASS</td>
  <td><strong>TokenInformationClass</strong> was not a valid token information class.</td>
</tr>
<tr>
  <td>STATUS_INVALID_OWNER</td>
  <td>The caller cannot set the specified ID to be an owner (or default owner) of an object.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PRIMARY_GROUP</td>
  <td>The caller cannot set the specified ID to be the primary group of an object.</td>
</tr>
<tr>
  <td>STATUS_INVALID_SID</td>
  <td>The specified default owner's security information was not valid.</td>
</tr>
<tr>
  <td>STATUS_OBJECT_TYPE_MISMATCH</td>
  <td><strong>TokenHandle</strong> was not a token handle.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>For more information about security and access control, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/driversecurity/windows-security-model">Windows security model for driver developers</a> and the documentation on these topics in the Windows SDK.</p>

<blockquote>
  <p>[!NOTE]
  If the call to the <strong>ZwSetInformationToken</strong> function occurs in user mode, you should use the name <strong>NtSetInformationToken</strong>" instead of "<strong>ZwSetInformationToken</strong>".</p>
  
  <p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>
</blockquote>

<h2>See also</h2>

<p><strong><a href="psdereferenceimpersonationtoken" title="VOID PsDereferenceImpersonationToken(&#10;  [in] PACCESS_TOKEN ImpersonationToken&#10;);">PsDereferenceImpersonationToken</a></strong></p>

<p><strong><a href="psdereferenceprimarytoken" title="VOID PsDereferencePrimaryToken(&#10;  [in] PACCESS_TOKEN PrimaryToken&#10;);">PsDereferencePrimaryToken</a></strong></p>

<p><strong><a href="security_impersonation_level" title="typedef enum _SECURITY_IMPERSONATION_LEVEL {&#10;  SecurityAnonymous,&#10;  SecurityIdentification,&#10;  SecurityImpersonation,&#10;  SecurityDelegation&#10;} SECURITY_IMPERSONATION_LEVEL, *PSECURITY_IMPERSONATION_LEVEL;">SECURITY_IMPERSONATION_LEVEL</a></strong></p>

<p><strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong></p>

<p><strong><a href="sequeryauthenticationidtoken" title="NTSTATUS SeQueryAuthenticationIdToken(&#10;  [in]  PACCESS_TOKEN Token,&#10;  [out] PLUID         AuthenticationId&#10;);">SeQueryAuthenticationIdToken</a></strong></p>

<p><strong><a href="sequerysubjectcontexttoken" title="PACESS_TOKEN&#10;SeQuerySubjectContextToken(SubjectContext);">SeQuerySubjectContextToken</a></strong></p>

<p><strong><a href="setokenisadmin" title="BOOLEAN SeTokenIsAdmin(&#10;  [in] PACCESS_TOKEN Token&#10;);">SeTokenIsAdmin</a></strong></p>

<p><strong><a href="setokenisrestricted" title="BOOLEAN SeTokenIsRestricted(&#10;  [in] PACCESS_TOKEN Token&#10;);">SeTokenIsRestricted</a></strong></p>

<p><strong><a href="token_default_dacl" title="typedef struct _TOKEN_DEFAULT_DACL {&#10;  PACL DefaultDacl;&#10;} TOKEN_DEFAULT_DACL, *PTOKEN_DEFAULT_DACL;">TOKEN_DEFAULT_DACL</a></strong></p>

<p><strong><a href="token_groups" title="typedef struct _TOKEN_GROUPS {&#10;  ULONG              GroupCount;&#10;#if ...&#10;  SID_AND_ATTRIBUTES *Groups[];&#10;#else&#10;  SID_AND_ATTRIBUTES Groups[ANYSIZE_ARRAY];&#10;#endif&#10;} TOKEN_GROUPS, *PTOKEN_GROUPS;">TOKEN_GROUPS</a></strong></p>

<p><strong><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></strong></p>

<p><strong><a href="token_owner" title="typedef struct _TOKEN_OWNER {&#10;  PSID Owner;&#10;} TOKEN_OWNER, *PTOKEN_OWNER;">TOKEN_OWNER</a></strong></p>

<p><strong><a href="token_primary_group" title="typedef struct _TOKEN_PRIMARY_GROUP {&#10;  PSID PrimaryGroup;&#10;} TOKEN_PRIMARY_GROUP, *PTOKEN_PRIMARY_GROUP;">TOKEN_PRIMARY_GROUP</a></strong></p>

<p><strong><a href="token_privileges" title="typedef struct _TOKEN_PRIVILEGES {&#10;  ULONG               PrivilegeCount;&#10;  LUID_AND_ATTRIBUTES Privileges[ANYSIZE_ARRAY];&#10;} TOKEN_PRIVILEGES, *PTOKEN_PRIVILEGES;">TOKEN_PRIVILEGES</a></strong></p>

<p><strong><a href="token_source" title="typedef struct _TOKEN_SOURCE {&#10;  CHAR SourceName[TOKEN_SOURCE_LENGTH];&#10;  LUID SourceIdentifier;&#10;} TOKEN_SOURCE, *PTOKEN_SOURCE;">TOKEN_SOURCE</a></strong></p>

<p><strong><a href="token_statistics" title="typedef struct _TOKEN_STATISTICS {&#10;  LUID                         TokenId;&#10;  LUID                         AuthenticationId;&#10;  LARGE_INTEGER                ExpirationTime;&#10;  TOKEN_TYPE                   TokenType;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  ULONG                        DynamicCharged;&#10;  ULONG                        DynamicAvailable;&#10;  ULONG                        GroupCount;&#10;  ULONG                        PrivilegeCount;&#10;  LUID                         ModifiedId;&#10;} TOKEN_STATISTICS, *PTOKEN_STATISTICS;">TOKEN_STATISTICS</a></strong></p>

<p><strong><a href="token_type" title="typedef enum _TOKEN_TYPE {&#10;  TokenPrimary,&#10;  TokenImpersonation&#10;} TOKEN_TYPE;">TOKEN_TYPE</a></strong></p>

<p><strong><a href="token_user" title="typedef struct _TOKEN_USER {&#10;  SID_AND_ATTRIBUTES User;&#10;} TOKEN_USER, *PTOKEN_USER;">TOKEN_USER</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a></p>

<p><strong><a href="ntqueryinformationtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryInformationToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ TOKEN_INFORMATION_CLASS TokenInformationClass,&#10;    _Out_writes_bytes_to_opt_(TokenInformationLength, *ReturnLength) PVOID TokenInformation,&#10;    _In_ ULONG TokenInformationLength,&#10;    _Out_ PULONG ReturnLength&#10;    );">ZwQueryInformationToken</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationtoken">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-zwsetinformationtoken.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is documented in Windows Driver Kit <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntsetinformationtoken">here</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationtoken">here</a>.</p>

<hr />

<p>Function <code>NtSetInformationToken</code> sets parameters of Token Objects. See also description of <strong>SetTokenInformation</strong><br />
in <em>Win32 API SDK</em>.</p>

<h3>TokenHandle</h3>

<p><code>HANDLE</code> to Token Object opened with <code>TOKEN_ADJUST_DEFAULT</code> access.</p>

<h3>TokenInformationClass</h3>

<p>Information class described in <code><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></code> topic.</p>

<h3>TokenInformation</h3>

<p>User's allocated buffer containing data to set to.</p>

<h3>TokenInformationLength</h3>

<p>Length of <code>TokenInformation</code> buffer, in bytes.</p>

<h1>Documented by</h1>

<ul>
<li>Tomasz Nowak</li>
</ul>

<h1>See also</h1>

<ul>
<li><code><a href="ntcreatetoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateToken(&#10;    _Out_ PHANDLE TokenHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ TOKEN_TYPE Type,&#10;    _In_ PLUID AuthenticationId,&#10;    _In_ PLARGE_INTEGER ExpirationTime,&#10;    _In_ PTOKEN_USER User,&#10;    _In_ PTOKEN_GROUPS Groups,&#10;    _In_ PTOKEN_PRIVILEGES Privileges,&#10;    _In_opt_ PTOKEN_OWNER Owner,&#10;    _In_ PTOKEN_PRIMARY_GROUP PrimaryGroup,&#10;    _In_opt_ PTOKEN_DEFAULT_DACL DefaultDacl,&#10;    _In_ PTOKEN_SOURCE Source&#10;    );">NtCreateToken</a></code></li>
<li><code><a href="ntopenprocesstoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenProcessToken(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _Out_ PHANDLE TokenHandle&#10;    );">NtOpenProcessToken</a></code></li>
<li><code><a href="ntopenthreadtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenThreadToken(&#10;    _In_ HANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ BOOLEAN OpenAsSelf,&#10;    _Out_ PHANDLE TokenHandle&#10;    );">NtOpenThreadToken</a></code></li>
<li><code><a href="ntqueryinformationtoken" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryInformationToken(&#10;    _In_ HANDLE TokenHandle,&#10;    _In_ TOKEN_INFORMATION_CLASS TokenInformationClass,&#10;    _Out_writes_bytes_to_opt_(TokenInformationLength, *ReturnLength) PVOID TokenInformation,&#10;    _In_ ULONG TokenInformationLength,&#10;    _Out_ PULONG ReturnLength&#10;    );">NtQueryInformationToken</a></code></li>
<li><code><a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntsetinformationtoken.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
