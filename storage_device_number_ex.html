<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="STORAGE_DEVICE_NUMBER_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>STORAGE_DEVICE_NUMBER_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            STORAGE_DEVICE_NUMBER_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ntddstor.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">typedef struct _STORAGE_DEVICE_NUMBER_EX {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>       Version;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>       Size;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>       Flags;
  DEVICE_TYPE DeviceType;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>       DeviceNumber;
  GUID        DeviceGuid;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>       PartitionNumber;
} STORAGE_DEVICE_NUMBER_EX, *PSTORAGE_DEVICE_NUMBER_EX;</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddstor/ns-ntddstor-_storage_device_number_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/storage_device_number_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddstor-_storage_device_number_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>STORAGE_DEVICE_NUMBER_EX structure</h1>
<h2>Description</h2>
<p>The STORAGE_DEVICE_NUMBER_EX structure is used in conjunction with the <a href="ioctl_storage_get_device_number_ex" title="// CTL_CODE(0x002d, 0x421, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_STORAGE_GET_DEVICE_NUMBER_EX 0x002D1084">IOCTL_STORAGE_GET_DEVICE_NUMBER_EX</a> request to retrieve the FILE_DEVICE_<em>XXX</em> device type, the device number, device GUID, and, for a device that can be partitioned, the partition number assigned to a device by the driver when the device is started.</p>
<h2>Members</h2>
<h3><code>Version</code></h3>
<p>The version of this structure. Will be set to <strong>sizeof</strong>(STORAGE_DEVICE_NUMBER_EX).</p>
<h3><code>Size</code></h3>
<p>Total size of this structure, including any additional data. Currently, this will always be set to <strong>sizeof</strong>(STORAGE_DEVICE_NUMBER_EX).</p>
<h3><code>Flags</code></h3>
<p>Can be a combination of STORAGE_DEVICE_FLAGS_XXX flags that provide more information about the members of this structure. See <strong>Remarks</strong> for details.</p>
<h3><code>DeviceType</code></h3>
<p>Specifies one of the system-defined FILE_DEVICE_<em>XXX</em> constants indicating the type of device (such as FILE_DEVICE_DISK) or a vendor-defined value for a new type of device. This IOCTL is only supported for disk devices. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/specifying-device-types">Specifying Device Types</a>.</p>
<h3><code>DeviceNumber</code></h3>
<p>Indicates the number of this device. This value is set to 0xFFFFFFFF (-1) for the disks that represent the physical paths of an MPIO disk.</p>
<h3><code>DeviceGuid</code></h3>
<p>A globally-unique identification number for this device. A GUID of {0} indicates that a GUID could not be generated. The GUID is based on hardware information that doesn't change with firmware updates; for instance, the serial number can be used to form the GUID, but not the firmware revision.</p>
<h3><code>PartitionNumber</code></h3>
<p>Indicates the partition number of the device is returned in this member, if the device can be partitioned. Otherwise, -1 is returned.</p>
<h2>Remarks</h2>
<p>The <a href="ioctl_storage_get_device_number_ex" title="// CTL_CODE(0x002d, 0x421, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_STORAGE_GET_DEVICE_NUMBER_EX 0x002D1084">IOCTL_STORAGE_GET_DEVICE_NUMBER_EX</a> request is usually issued by a fault-tolerant disk driver.</p>
<p>In general, if a device exposes a globally unique identifier, the storage driver will use that identifier to form the GUID. Otherwise, the storage driver will combine the device's vendor ID, product ID and serial number to create the GUID.</p>
<p>If a storage driver detects two devices with the same hardware information (which is an indication of a problem with the device), the driver will generate a random GUID for one of the two devices. When handling <a href="ioctl_storage_get_device_number_ex" title="// CTL_CODE(0x002d, 0x421, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_STORAGE_GET_DEVICE_NUMBER_EX 0x002D1084">IOCTL_STORAGE_GET_DEVICE_NUMBER_EX</a> for the device with the random GUID, the driver will add STORAGE_DEVICE_FLAGS_RANDOM_DEVICEGUID_REASON_CONFLICT to the <strong>Flags</strong> member of this structure.</p>
<p>If a storage device does not provide any identifying information, the driver will generate a random GUID and add STORAGE_DEVICE_FLAGS_RANDOM_DEVICEGUID_REASON_NOHWID to the <strong>Flags</strong> member of this structure.</p>
<p>If the STORAGE_DEVICE_FLAGS_PAGE_83_DEVICEGUID flag is set, the deviceguid was created from the SCSI page83 data. If this flag is not set, this implies it was created from the serial number or was randomly generated.</p>
<p>The values in the STORAGE_DEVICE_NUMBER_EX structure are guaranteed to remain unchanged until the system is rebooted. They are not guaranteed to be persistent across boots. A device GUID remains the same across reboots. A random GUID is not persisted and will not be the same after a reboot.</p>
<h2>See also</h2>
<p><a href="ioctl_storage_get_device_number_ex" title="// CTL_CODE(0x002d, 0x421, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_STORAGE_GET_DEVICE_NUMBER_EX 0x002D1084">IOCTL_STORAGE_GET_DEVICE_NUMBER_EX</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddstor/ns-ntddstor-_storage_device_number_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddstor/ns-ntddstor-_storage_device_number_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
