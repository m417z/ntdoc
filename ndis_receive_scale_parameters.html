<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_RECEIVE_SCALE_PARAMETERS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_RECEIVE_SCALE_PARAMETERS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_RECEIVE_SCALE_PARAMETERS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDIS_RECEIVE_SCALE_PARAMETERS {
  <a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a> Header;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>             Flags;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>             BaseCpuNumber;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              HashInformation;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>             IndirectionTableSize;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              IndirectionTableOffset;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>             HashSecretKeySize;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              HashSecretKeyOffset;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              ProcessorMasksOffset;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              NumberOfProcessorMasks;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              ProcessorMasksEntrySize;
  <a href="processor_number" title="typedef struct _PROCESSOR_NUMBER {&#10;  USHORT Group;&#10;  UCHAR  Number;&#10;  UCHAR  Reserved;&#10;} PROCESSOR_NUMBER, *PPROCESSOR_NUMBER;">PROCESSOR_NUMBER</a>   DefaultProcessorNumber;
} NDIS_RECEIVE_SCALE_PARAMETERS, *PNDIS_RECEIVE_SCALE_PARAMETERS;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_receive_scale_parameters">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_receive_scale_parameters.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddndis-_ndis_receive_scale_parameters)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ndis_receive_scale_parameters-structure">_NDIS_RECEIVE_SCALE_PARAMETERS structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong> structure specifies the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/receive-side-scaling-version-2-rssv2-">Receive Side Scaling (RSS)</a> parameters for a miniport adapter.</p>

<h3 id="version-information">Version Information</h3>

<h2 id="members">Members</h2>

<h3 id="header"><code>Header</code></h3>

<p>The <a rel="noopener" target="_blank" href="ndis_object_header">NDIS_OBJECT_HEADER</a> structure for the <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong> structure. Set the <strong>Type</strong> member of the structure that <strong>Header</strong> specifies to <strong>NDIS_OBJECT_TYPE_RSS_PARAMETERS</strong>.</p>

<ul>
<li><p>For NDIS 6.60 and later drivers, set the <strong>Revision</strong> member to <strong>NDIS_RECEIVE_SCALE_PARAMETERS_REVISION_3</strong> and the <strong>Size</strong> member to <strong>NDIS_SIZEOF_RECEIVE_SCALE_PARAMETERS_REVISION_3</strong>.</p></li>
<li><p>For NDIS 6.20 and pre-NDIS 6.60 drivers, set the <strong>Revision</strong> member to <strong>NDIS_RECEIVE_SCALE_PARAMETERS_REVISION_2</strong> and the <strong>Size</strong> member to <strong>NDIS_SIZEOF_RECEIVE_SCALE_PARAMETERS_REVISION_2</strong>.</p></li>
<li><p>For NDIS 6.0 drivers, set the <strong>Revision</strong> member to <strong>NDIS_RECEIVE_SCALE_PARAMETERS_REVISION_1</strong> and the <strong>Size</strong> member to <strong>NDIS_SIZEOF_RECEIVE_SCALE_PARAMETERS_REVISION_1</strong>.</p></li>
</ul>

<h3 id="flags"><code>Flags</code></h3>

<p>A <strong><a href="ushort" title="typedef unsigned short USHORT;">USHORT</a></strong> value that indicates what the miniport driver should do with the receive-scale parameters. The driver can use these flags to quickly determine which parameters have changed and update the RSS settings accordingly.</p>

<blockquote>
  <p>[!NOTE]
  The flags which refer to unchanged RSS parameter information are for optimization purposes. If a flag is set,
  no change has been made to the corresponding parameter. If a flag is clear, the corresponding parameter may or
  may not have changed and miniport drivers must compare the new value of the parameter with the current value in
  order to determine a potential change in the parameter.</p>
</blockquote>

<ul>
<li><p>In a query request, set this member to zero.</p></li>
<li><p>In a set request, the flags are defined as follows:</p></li>
</ul>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>NDIS_RSS_PARAM_FLAG_BASE_CPU_UNCHANGED</td>
  <td>The <strong>BaseCpuNumber</strong> member has not changed.</td>
</tr>
<tr>
  <td>NDIS_RSS_PARAM_FLAG_HASH_INFO_UNCHANGED</td>
  <td>The <strong>HashInformation</strong> member has not changed. The hash information includes the hash types and hash function.</td>
</tr>
<tr>
  <td>NDIS_RSS_PARAM_FLAG_ITABLE_UNCHANGED</td>
  <td>The indirection table and associated data members have not changed.</td>
</tr>
<tr>
  <td>NDIS_RSS_PARAM_FLAG_HASH_KEY_UNCHANGED</td>
  <td>The secret key and associated data members have not changed.</td>
</tr>
<tr>
  <td>NDIS_RSS_PARAM_FLAG_DISABLE_RSS</td>
  <td>If this flag is set, the miniport driver should ignore all of the other flags and settings and disable RSS on the NIC.</td>
</tr>
<tr>
  <td>NDIS_RSS_PARAM_FLAG_DEFAULT_PROCESSOR_UNCHANGED</td>
  <td>If this flag is set, the <strong>DefaultProcessorNumber</strong> has not changed.</td>
</tr>
</tbody>
</table>

<h3 id="basecpunumber"><code>BaseCpuNumber</code></h3>

<p>The lowest number CPU to use for RSS. Because this value is incorporated into the indirection table, set <strong>BaseCpuNumber</strong> to zero.</p>

<h3 id="hashinformation"><code>HashInformation</code></h3>

<p>In a set request, this member is the hash type and hash function that the NIC should use to compute the hash values for the incoming packets. If the hash function that is specified within the <strong>HashInformation</strong> member is zero, RSS is disabled.</p>

<p>In a query request, this member is the hash type and hash function that the NIC is using.</p>

<p>Overlying drivers and NDIS can use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-rss-hash-info-from-type-and-func">NDIS_RSS_HASH_INFO_FROM_TYPE_AND_FUNC</a> macro to combine the hash type and hash function into hash information and set the <strong>HashInformation</strong> member.</p>

<p>Miniport drivers can use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-rss-hash-info-from-type-and-func">NDIS_RSS_HASH_TYPE_FROM_HASH_INFO</a> macro to get the hash type from <strong>HashInformation</strong> and the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-rss-hash-info-from-type-and-func">NDIS_RSS_HASH_FUNC_FROM_HASH_INFO</a> macro to get the hash function.</p>

<h3 id="indirectiontablesize"><code>IndirectionTableSize</code></h3>

<p>The size of the indirection table, in bytes. The upper layer driver that sets the RSS parameters, must ensure that the number of entries in the indirection table is a power of 2.</p>

<h3 id="indirectiontableoffset"><code>IndirectionTableOffset</code></h3>

<p>The offset of the indirection table from the beginning of the <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong> structure. Use this offset to get the indirection table.</p>

<h3 id="hashsecretkeysize"><code>HashSecretKeySize</code></h3>

<p>The size of the secret key array of the hash function, in bytes. The size of the array is 40 bytes for NdisHashFunctionToeplitz.</p>

<h3 id="hashsecretkeyoffset"><code>HashSecretKeyOffset</code></h3>

<p>The offset of the secret key array of the hash function from the beginning of the <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong> structure. Use this offset to get the 320-bit (40 bytes) secret key.</p>

<ul>
<li><p>In a set request, the secret key can contain any data that the overlying driver chooses.</p></li>
<li><p>In a query request, the secret key contains the data that the NIC is using.</p></li>
</ul>

<h3 id="processormasksoffset"><code>ProcessorMasksOffset</code></h3>

<p>The offset of an array of processor masks from the beginning of the <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong>
structure.</p>

<h3 id="numberofprocessormasks"><code>NumberOfProcessorMasks</code></h3>

<p>The number of elements in an array of type <a rel="noopener" target="_blank" href="group_affinity">GROUP_AFFINITY</a> representing the processors used in the indirection table</p>

<h3 id="processormasksentrysize"><code>ProcessorMasksEntrySize</code></h3>

<p>The size, in bytes, of a processor mask array entry.</p>

<h3 id="defaultprocessornumber"><code>DefaultProcessorNumber</code></h3>

<p>When RSS is enabled, specifies the processor that will receive packets where the hash cannot be calculated.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong> structure defines the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-receive-side-scaling2">Receive Side Scaling (RSS)</a> parameters for the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-gen-receive-scale-parameters">OID_GEN_RECEIVE_SCALE_PARAMETERS</a> OID.</p>

<blockquote>
  <p>[!NOTE]
  The indirection table and secret key are appended after the <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong>
  structure members.</p>
</blockquote>

<p>The indirection table has the following version-specific format:</p>

<table>
<thead>
<tr>
  <th>NDIS Version</th>
  <th>Format</th>
</tr>
</thead>
<tbody>
<tr>
  <td>NDIS 6.20 and later versions</td>
  <td><code><a href="processor_number" title="typedef struct _PROCESSOR_NUMBER {&#10;  USHORT Group;&#10;  UCHAR  Number;&#10;  UCHAR  Reserved;&#10;} PROCESSOR_NUMBER, *PPROCESSOR_NUMBER;">PROCESSOR_NUMBER</a> IndirectionTable[IndirectionTableSize/sizeof(<a href="processor_number" title="typedef struct _PROCESSOR_NUMBER {&#10;  USHORT Group;&#10;  UCHAR  Number;&#10;  UCHAR  Reserved;&#10;} PROCESSOR_NUMBER, *PPROCESSOR_NUMBER;">PROCESSOR_NUMBER</a>)];</code></td>
</tr>
<tr>
  <td>Pre-NDIS 6.20</td>
  <td><code><a href="cchar" title="typedef char CCHAR;">CCHAR</a> IndirectionTable[IndirectionTableSize]</code></td>
</tr>
</tbody>
</table>

<p>NDIS automatically translates the indirection table if there are older and newer drivers in a driver stack.</p>

<p>The miniport driver must examine the indirection table to determine the CPU numbers to associate with hardware queues. If the total number of different CPU numbers that appear in the indirection table is more than the number of hardware queues that the NIC supports, the miniport driver must pick a subset of the CPU numbers from the indirection table. The subset is equal in number to the number of hardware queues.</p>

<p>The miniport driver specified the number of receive queues value in response to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-gen-receive-scale-capabilities">OID_GEN_RECEIVE_SCALE_CAPABILITIES</a>.</p>

<p>To clear the RSS parameters and disable RSS, NDIS sets the hash function that is specified within the <strong>HashInformation</strong> member is zero. NDIS can also disable RSS by setting the <strong>NDIS_RSS_PARAM_FLAG_DISABLE_RSS</strong> flag in the <strong>NDIS_RECEIVE_SCALE_PARAMETERS</strong> structure.</p>

<p>If RSS is disabled, the miniport driver should handle receive operations without performing RSS operations.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-receive-side-scaling2">Receive Side Scaling (RSS)</a></p>

<p><a rel="noopener" target="_blank" href="ndis_object_header">NDIS_OBJECT_HEADER</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-rss-hash-info-from-type-and-func">NDIS_RSS_HASH_FUNC_FROM_HASH_INFO</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-rss-hash-info-from-type-and-func">NDIS_RSS_HASH_INFO_FROM_TYPE_AND_FUNC</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-rss-hash-info-from-type-and-func">NDIS_RSS_HASH_TYPE_FROM_HASH_INFO</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-gen-receive-scale-capabilities">OID_GEN_RECEIVE_SCALE_CAPABILITIES</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-gen-receive-scale-parameters">OID_GEN_RECEIVE_SCALE_PARAMETERS</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_receive_scale_parameters">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddndis/ns-ntddndis-_ndis_receive_scale_parameters.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
