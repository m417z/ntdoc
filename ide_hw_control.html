<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IDE_HW_CONTROL - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IDE_HW_CONTROL - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IDE_HW_CONTROL - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// irb.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">IDE_HW_CONTROL IdeHwControl;

BOOLEAN IdeHwControl(
  [in]      PVOID ChannelExtension,
  [in]      <a href="ide_control_action" title="typedef enum {&#10;  IdeStart,&#10;  IdeStop,&#10;  IdePowerUp,&#10;  IdePowerDown,&#10;  IdeVendorDefined&#10;} IDE_CONTROL_ACTION;">IDE_CONTROL_ACTION</a> ControlAction,
  [in, out] PVOID Parameters
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/irb/nc-irb-ide_hw_control">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ide_hw_control.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-irb-ide_hw_control)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ide_hw_control-callback-function">IDE_HW_CONTROL callback function</h1>

<h2 id="description">Description</h2>

<p>The <em>IdeHwControl</em> miniport driver routine notifies the miniport driver about Plug and Play (PnP) and power events.</p>

<p><strong>Note</strong> The ATA port driver and ATA miniport driver models may be altered or unavailable in the future. Instead, we recommend using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-driver">Storport driver</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-miniport-drivers">Storport miniport</a> driver models.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="channelextension-in"><code>ChannelExtension</code> [in]</h3>

<p>A pointer to the channel extension.</p>

<h3 id="controlaction-in"><code>ControlAction</code> [in]</h3>

<p>Contains an enumerator value of type <a href="ide_control_action" title="typedef enum {&#10;  IdeStart,&#10;  IdeStop,&#10;  IdePowerUp,&#10;  IdePowerDown,&#10;  IdeVendorDefined&#10;} IDE_CONTROL_ACTION;">IDE_CONTROL_ACTION</a> that indicates the control action to perform.</p>

<h3 id="parameters-in-out"><code>Parameters</code> [in, out]</h3>

<p>A pointer to a buffer that contains the parameters that are associated with the control action. This parameter can have one of the values in the following table.</p>

<table>
<thead>
<tr>
  <th>Control action</th>
  <th>Parameters</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>IdeStart</strong></td>
  <td>Parameter points to a structure of type <a href="ide_channel_configuration" title="typedef struct _IDE_CHANNEL_CONFIGURATION {&#10;  USHORT                              Version;&#10;  UCHAR                               ChannelNumber;&#10;  SUPPORTED_ADVANCES                  SupportedAdvances;&#10;  IDE_OPERATION_MODE                  ChannelMode;&#10;  PIDE_MINIPORT_RESOURCES             ChannelResources;&#10;  UCHAR                               NumberOfOverlappedRequests;&#10;  UCHAR                               MaxTargetId;&#10;  BOOLEAN                             SyncWithIsr;&#10;  BOOLEAN                             SupportsWmi;&#10;  PIDE_ADVANCED_CHANNEL_CONFIGURATION AdvancedChannelConfiguration;&#10;} IDE_CHANNEL_CONFIGURATION, *PIDE_CHANNEL_CONFIGURATION;">IDE_CHANNEL_CONFIGURATION</a>.</td>
  <td>Indicates that the port driver is starting the channel.</td>
</tr>
<tr>
  <td><strong>IdeVendorDefined</strong></td>
  <td>Parameter points to a structure of type IDE_VENDOR_DEFINED_POWER_INFO.</td>
  <td>Indicates that there is a vendor defined power event coming.</td>
</tr>
</tbody>
</table>

<h2 id="return-value">Return value</h2>

<p><em>IdeHwControl</em> returns <strong>TRUE</strong> if the operation was successful. Otherwise, it returns <strong>FALSE</strong>.</p>

<h2 id="remarks">Remarks</h2>

<p>The port driver makes sure that there is no outstanding I/O on the channel before it invokes this routine. The miniport driver can have its own power policy methods when the system enters a different power state. In order to achieve this, the miniport driver needs to do the following:</p>

<ul>
<li>Add a power policy setting scheme into the miniport driver's INF file. A GUID is needed to present a miniport driver-defined power policy. For more information about the power settings directive, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/install/inf-addpowersetting-directive">INF AddPowerSetting Directive</a>. More information about the GUIDs can be found at <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/customize/power-settings/disk-settings">Disk settings</a>.</li>
<li><p>When the miniport driver routine <em>IdeHwControl</em> is called with control action <strong>IdeStart</strong>:</p>

<p>Check the SupportedAdvances.AdvancedChannelConfigurationSupported field in the ChannelConfiguration structure.</p>

<p>Check the AdvancedChannelConfiguration->Present.VendorDefinedPower field in the ChannelConfiguration structure.</p>

<p>If the values of the two fields listed previously are both <strong>TRUE</strong>, this version of the ATA port driver supports vendor-defined power management.</p>

<p>If vendor-defined power management is supported by the ATA port driver, the miniport driver can register for special power management handling by setting the AdvancedChannelConfiguration->VendorDefinedPower.ValidGuids and AdvancedChannelConfiguration->VendorDefinedPower.Guid[] fields (the latter should be the GUID of the power policy in the miniport driver's INF file).</p></li>
<li>After vendor-defined power management is registered, the miniport driver will be able to receive calls to its <em>IdeHwControl</em> routine with control action <strong>IdeVendorDefined</strong> when the system power scheme changes.</li>
<li><p>While the miniport driver processes the <em>IdeHwControl</em> routine with control action <strong>IdeVendorDefined</strong>, it should do following:</p>

<p>Compare the <strong>SettingGuid</strong> field from the parameter field of structure IDE_VENDOR_DEFINED_POWER_INFO with the GUID that the miniport driver registered to make sure that the call is for this channel. If the GUIDs do not match, the miniport driver should complete the call and take no action.</p>

<p>Get the <strong>Value</strong> field from the parameter field of structure IDE_VENDOR_DEFINED_POWER_INFO and perform the appropriate miniport driver-specific power management action.</p></li>
</ul>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/irb/nf-irb-ataportgetuncachedextension">AtaPortGetUncachedExtension</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/irb/nc-irb-ide_hw_control">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/irb/nc-irb-ide_hw_control.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
