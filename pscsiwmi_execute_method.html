<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PSCSIWMI_EXECUTE_METHOD - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PSCSIWMI_EXECUTE_METHOD - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PSCSIWMI_EXECUTE_METHOD - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// scsiwmi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PSCSIWMI_EXECUTE_METHOD PscsiwmiExecuteMethod;

BOOLEAN PscsiwmiExecuteMethod(
  [in]      PVOID DeviceContext,
  [in]      <a href="scsiwmi_request_context" title="typedef struct {&#10;  PVOID  UserContext;&#10;  ULONG  BufferSize;&#10;  PUCHAR Buffer;&#10;  UCHAR  MinorFunction;&#10;  UCHAR  ReturnStatus;&#10;  ULONG  ReturnSize;&#10;} SCSIWMI_REQUEST_CONTEXT, *PSCSIWMI_REQUEST_CONTEXT;">PSCSIWMI_REQUEST_CONTEXT</a> RequestContext,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> GuidIndex,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> InstanceIndex,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MethodId,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> InBufferSize,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> OutBufferSize,
  [in, out] PUCHAR Buffer
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/scsiwmi/nc-scsiwmi-pscsiwmi_execute_method">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pscsiwmi_execute_method.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-scsiwmi-pscsiwmi_execute_method)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pscsiwmi_execute_method-callback-function">PSCSIWMI_EXECUTE_METHOD callback function</h1>

<h2 id="description">Description</h2>

<p>A miniport driver's <strong>HwScsiWmiExecuteMethod</strong> routine is called to execute a method associated with a data block. This routine is optional.</p>

<p><strong>Note</strong> The SCSI port driver and SCSI miniport driver models may be altered or unavailable in the future. Instead, we recommend using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-driver">Storport driver</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-miniport-drivers">Storport miniport</a> driver models.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="devicecontext-in"><code>DeviceContext</code> [in]</h3>

<p>Points to the miniport driver-defined context value passed to <a href="scsiportwmidispatchfunction" title="BOOLEAN ScsiPortWmiDispatchFunction(&#10;  [in] PSCSI_WMILIB_CONTEXT     WmiLibInfo,&#10;  [in] UCHAR                    MinorFunction,&#10;  [in] PVOID                    DeviceContext,&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] PVOID                    DataPath,&#10;  [in] ULONG                    BufferSize,&#10;  [in] PVOID                    Buffer&#10;);">ScsiPortWmiDispatchFunction</a>.</p>

<h3 id="requestcontext-in"><code>RequestContext</code> [in]</h3>

<p>Points to the <a href="scsiwmi_request_context" title="typedef struct {&#10;  PVOID  UserContext;&#10;  ULONG  BufferSize;&#10;  PUCHAR Buffer;&#10;  UCHAR  MinorFunction;&#10;  UCHAR  ReturnStatus;&#10;  ULONG  ReturnSize;&#10;} SCSIWMI_REQUEST_CONTEXT, *PSCSIWMI_REQUEST_CONTEXT;">SCSIWMI_REQUEST_CONTEXT</a> structure that the miniport driver passed to <a href="scsiportwmidispatchfunction" title="BOOLEAN ScsiPortWmiDispatchFunction(&#10;  [in] PSCSI_WMILIB_CONTEXT     WmiLibInfo,&#10;  [in] UCHAR                    MinorFunction,&#10;  [in] PVOID                    DeviceContext,&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] PVOID                    DataPath,&#10;  [in] ULONG                    BufferSize,&#10;  [in] PVOID                    Buffer&#10;);">ScsiPortWmiDispatchFunction</a>.</p>

<h3 id="guidindex-in"><code>GuidIndex</code> [in]</h3>

<p>Specifies the data block by its index into the list of GUIDs in the <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a> structure that the miniport driver passed to <a href="scsiportwmidispatchfunction" title="BOOLEAN ScsiPortWmiDispatchFunction(&#10;  [in] PSCSI_WMILIB_CONTEXT     WmiLibInfo,&#10;  [in] UCHAR                    MinorFunction,&#10;  [in] PVOID                    DeviceContext,&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] PVOID                    DataPath,&#10;  [in] ULONG                    BufferSize,&#10;  [in] PVOID                    Buffer&#10;);">ScsiPortWmiDispatchFunction</a>.</p>

<h3 id="instanceindex-in"><code>InstanceIndex</code> [in]</h3>

<p>If the block specified by <em>GuidIndex</em> has multiple instances, <em>InstanceIndex</em> specifies the instance.</p>

<h3 id="methodid-in"><code>MethodId</code> [in]</h3>

<p>Specifies the ID of the method to execute. The miniport driver defines the method ID as an item in a data block.</p>

<h3 id="inbuffersize-in"><code>InBufferSize</code> [in]</h3>

<p>Indicates the size in bytes of the input data. If there is no input data, <em>InBufferSize</em> is zero.</p>

<h3 id="outbuffersize-in"><code>OutBufferSize</code> [in]</h3>

<p>Indicates the number of bytes available in the buffer for output data.</p>

<h3 id="buffer-in-out"><code>Buffer</code> [in, out]</h3>

<p>Points to a buffer that holds the input data and receives the output data, if any, from the method. If the buffer is too small to receive all of the output, the miniport driver calls <strong><a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a></strong> with SRB_STATUS_DATA_OVERRUN and the size required.</p>

<h2 id="return-value">Return value</h2>

<p><strong>HwScsiWmiExecuteMethod</strong> returns SRB_STATUS_PENDING if the request is pending, or a nonzero SRB status value if the request was completed. The SRB status value returned by this routine is the same as what was passed in to <a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a>. Although the return value data type is BOOLEAN, the <strong>HwScsiWmiExecuteMethod</strong> routine actually returns an SRB status value.</p>

<h2 id="remarks">Remarks</h2>

<p>When a miniport driver receives an SRB in which the <strong>Function</strong> member is set to SRB_FUNCTION_WMI, it calls <a href="scsiportwmidispatchfunction" title="BOOLEAN ScsiPortWmiDispatchFunction(&#10;  [in] PSCSI_WMILIB_CONTEXT     WmiLibInfo,&#10;  [in] UCHAR                    MinorFunction,&#10;  [in] PVOID                    DeviceContext,&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] PVOID                    DataPath,&#10;  [in] ULONG                    BufferSize,&#10;  [in] PVOID                    Buffer&#10;);">ScsiPortWmiDispatchFunction</a> with a pointer to an initialized <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a> structure and <em>MinorFunction</em> set to <strong>Srb->WmiSubFunction</strong>. The SCSI port driver calls the miniport driver's <strong>HwScsiWmiExecuteMethod</strong> routine if <em>MinorFunction</em> indicates a request to execute a method.</p>

<p>If a miniport driver does not implement a <strong>HwScsiWmiExecuteMethod</strong> routine, it must set <strong>ExecuteWmiMethod</strong> to <strong>NULL</strong> in the <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a> the miniport driver passes to <a href="scsiportwmidispatchfunction" title="BOOLEAN ScsiPortWmiDispatchFunction(&#10;  [in] PSCSI_WMILIB_CONTEXT     WmiLibInfo,&#10;  [in] UCHAR                    MinorFunction,&#10;  [in] PVOID                    DeviceContext,&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] PVOID                    DataPath,&#10;  [in] ULONG                    BufferSize,&#10;  [in] PVOID                    Buffer&#10;);">ScsiPortWmiDispatchFunction</a>. In this case, the port driver returns SRB_STATUS_ERROR to the caller.</p>

<p>If the method generates output, the miniport driver should check the size of the output buffer in <em>OutBufferSize</em> before performing any operation that might have side effects or that should not be performed twice. For example, if a method returns the values of a group of counters and then resets the counters, the miniport driver should check the buffer size before resetting the counters. This ensures that the port driver can safely resend the request with a larger buffer. If the buffer is too small, the miniport driver should call <a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a> with SRB_STATUS_DATA_OVERRUN and the size of the output buffer needed to fulfill the request.</p>

<p>The miniport driver executes the method and writes output, if any, to the buffer. Before returning from <strong>HwScsiWmiExecuteMethod</strong>, the miniport driver calls <a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a> with an appropriate <em>SrbStatus</em> value and the number of bytes used in the output buffer.</p>

<h2 id="see-also">See also</h2>

<p><a href="scsiwmi_request_context" title="typedef struct {&#10;  PVOID  UserContext;&#10;  ULONG  BufferSize;&#10;  PUCHAR Buffer;&#10;  UCHAR  MinorFunction;&#10;  UCHAR  ReturnStatus;&#10;  ULONG  ReturnSize;&#10;} SCSIWMI_REQUEST_CONTEXT, *PSCSIWMI_REQUEST_CONTEXT;">SCSIWMI_REQUEST_CONTEXT</a></p>

<p><a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a></p>

<p><a href="scsiportwmidispatchfunction" title="BOOLEAN ScsiPortWmiDispatchFunction(&#10;  [in] PSCSI_WMILIB_CONTEXT     WmiLibInfo,&#10;  [in] UCHAR                    MinorFunction,&#10;  [in] PVOID                    DeviceContext,&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] PVOID                    DataPath,&#10;  [in] ULONG                    BufferSize,&#10;  [in] PVOID                    Buffer&#10;);">ScsiPortWmiDispatchFunction</a></p>

<p><a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/scsiwmi/nc-scsiwmi-pscsiwmi_execute_method">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/scsiwmi/nc-scsiwmi-pscsiwmi_execute_method.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
