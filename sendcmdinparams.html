<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SENDCMDINPARAMS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SENDCMDINPARAMS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SENDCMDINPARAMS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntdddisk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _SENDCMDINPARAMS {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>   cBufferSize;
  <a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a> irDriveRegs;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>   bDriveNumber;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>   bReserved[3];
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>   dwReserved[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>   bBuffer[1];
} SENDCMDINPARAMS, *PSENDCMDINPARAMS, *LPSENDCMDINPARAMS;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntdddisk/ns-ntdddisk-_sendcmdinparams">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/sendcmdinparams.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntdddisk-_sendcmdinparams)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="sendcmdinparams-structure">SENDCMDINPARAMS structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>SENDCMDINPARAMS</strong> structure contains the input parameters for the <strong>SMART_SEND_DRIVE_COMMAND</strong> and <strong>SMART_RCV_DRIVE_DATA</strong> requests (see Remarks).</p>

<h2 id="members">Members</h2>

<h3 id="cbuffersize"><code>cBufferSize</code></h3>

<p>Contains the buffer size, in bytes.</p>

<h3 id="irdriveregs"><code>irDriveRegs</code></h3>

<p>Contains a <strong><a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a></strong> structure used to report the contents of the IDE controller registers.</p>

<h3 id="bdrivenumber"><code>bDriveNumber</code></h3>

<p>This member is opaque. Do not use it. The operating system ignores this member, because the physical drive that receives the request depends on the handle that the caller uses when making the request.</p>

<h3 id="breserved"><code>bReserved</code></h3>

<p>Reserved.</p>

<h3 id="dwreserved"><code>dwReserved</code></h3>

<p>Reserved.</p>

<h3 id="bbuffer"><code>bBuffer</code></h3>

<p>Pointer to the input buffer.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>SENDCMDINPARAMS</strong> structure is used with the <strong>SMART_SEND_DRIVE_COMMAND</strong> and <strong>SMART_RCV_DRIVE_DATA</strong> I/O control code requests. These IOCTLs must be handled by drivers that support Self-Monitoring Analysis and Reporting Technology (SMART).</p>

<h3 id="smart_send_drive_command">SMART_SEND_DRIVE_COMMAND</h3>

<p>The <strong>SMART_SEND_DRIVE_COMMAND</strong> control code sends one of the following SMART commands to the device:</p>

<ul>
<li>Enable or disable reporting on the device</li>
<li>Enable or disable autosaving of attributes</li>
<li>Save current attributes now</li>
<li>Execute offline diagnostics</li>
<li>Get current SMART status</li>
<li>Write to SMART log</li>
</ul>

<h4 id="input-parameters">Input Parameters</h4>

<p>The buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong> contains a <strong>SENDCMDINPARAMS</strong> structure that describes the command being sent to the device. The <strong>irDriveRegs.bCommandReg</strong> member must specify SMART_CMD. The <strong>irDriveRegs.bFeaturesReg</strong> member must specify a SMART subcommand. For a list of subcommands, see <strong><a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a></strong>.</p>

<p>If the caller specifies a SMART subcommand of SMART_WRITE_LOG in <strong>irDriveRegs.bFeaturesReg</strong>, caller must also indicate the number of sectors to write in <strong>irDriveRegs.bSectorCountReg</strong>. The input buffer size must be &gt;= <code>sizeof(SENDCMDINPARAMS) - 1) + (irDriveRegs.bSectorCountReg * SMART_LOG_SECTOR_SIZE)</code>. Caller must put the data to write in the buffer indicated by the bBuffer member of <strong>SENDCMDINPARAMS</strong>.</p>

<p><strong>Parameters.DeviceIoControl.InputBufferLength</strong> specifies the size in, bytes, of the input buffer, which must be &gt;= <code>(sizeof(SENDCMDINPARAMS) - 1)</code>.</p>

<p><strong>Parameters.DeviceIoControl.OutputBufferLength</strong> specifies the size, in bytes, of the output buffer, which must be &gt;= <code>(sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>) - 1)</code>. If SMART status is being requested, the output buffer must be &gt;= <code>(sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>) - 1 + sizeof(<a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a>))</code>.</p>

<h4 id="output-parameters">Output Parameters</h4>

<p>The driver returns the <strong><a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a></strong> structure to the buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong>. If SMART status was requested and successfully received from the device, the driver includes the <strong><a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a></strong> structure in the output buffer.</p>

<h4 id="io-status-block">I/O Status Block</h4>

<p>When the driver sets the Status field to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, it sets the **Information** field is set to <code>((sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>) - 1) + sizeof(<a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a>))</code> for returning SMART status and to <code>(sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>) - 1)</code> for all other commands. The driver should set the **Status** field to STATUS_INVALID_PARAMETER if an input parameter is incorrect or to STATUS_IO_DEVICE_ERROR if the device aborts a command it does not support. If <strong>Status</strong> is not <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, the driver sets the <strong>Information</strong> field to zero.</p>

<h3 id="smart_rcv_drive_data">SMART_RCV_DRIVE_DATA</h3>

<p>The <strong>SMART_RCV_DRIVE_DATA</strong> control code returns the ATA-2 identify data, the SMART thresholds, or the SMART attributes for the device.</p>

<h4 id="smart_rcv_drive_data-input-parameters">SMART_RCV_DRIVE_DATA Input Parameters</h4>

<p>The buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong> contains a <strong>SENDCMDINPARAMS</strong> structure that describes the request being sent to the device. The <strong>irDriveRegs.bCommandReg</strong> member specifies ID_CMD when identify data is requested and SMART_CMD when SMART data is requested. For a list of values that can be assigned to the features register (irDriveRegs.bFeaturesReg), see <strong><a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a></strong>.</p>

<p><strong>Parameters.DeviceIoControl.InputBufferLength</strong> specifies the size, in bytes, of the input buffer, which must be &gt;= <code>(sizeof(SENDCMDINPARAMS) - 1)</code>.</p>

<p><strong>Parameters.DeviceIoControl.OutputBufferLength</strong> specifies the size, in bytes, of the output buffer, which must be &gt;= <code>(sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>) - 1 + 512)</code>.</p>

<h4 id="smart_rcv_drive_data-output-parameters">SMART_RCV_DRIVE_DATA Output Parameters</h4>

<p>The driver returns the <strong><a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a></strong> structure and a 512-byte buffer of drive data to the buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong>.</p>

<p>If the caller specifies a SMART subcommand of SMART_READ_LOG in <strong>irDriveRegs.bFeaturesReg</strong>, the caller must also indicate the number of sectors to read in <strong>irDriveRegs.bSectorCountReg</strong>. The output buffer size must be &gt;= the maximum of the following values: <code>sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>)</code> or <code>sizeof(SENDCMDINPARAMS)) -1 + (irDriveRegs.bSectorCountReg** * SMART_LOG_SECTOR_SIZE)</code></p>

<p>The data read from the log will be placed in the buffer specified by the <strong>bBuffer</strong> member of <strong><a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a></strong>.</p>

<h4 id="smart_rcv_drive_data-io-status-block">SMART_RCV_DRIVE_DATA I/O Status Block</h4>

<p>The driver sets the <strong>Information</strong> field to <code>(sizeof(<a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a>) - 1 + 512)</code> when it sets the <strong>Status</strong> field to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>. Otherwise, the driver sets the **Information** field to zero and the **Status** field to possibly STATUS_INVALID_PARAMETER or STATUS_INSUFFICIENT_RESOURCES.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="ideregs" title="typedef struct _IDEREGS {&#10;  UCHAR bFeaturesReg;&#10;  UCHAR bSectorCountReg;&#10;  UCHAR bSectorNumberReg;&#10;  UCHAR bCylLowReg;&#10;  UCHAR bCylHighReg;&#10;  UCHAR bDriveHeadReg;&#10;  UCHAR bCommandReg;&#10;  UCHAR bReserved;&#10;} IDEREGS, *PIDEREGS, *LPIDEREGS;">IDEREGS</a></strong></p>

<p><strong><a href="sendcmdoutparams" title="typedef struct _SENDCMDOUTPARAMS {&#10;  ULONG        cBufferSize;&#10;  DRIVERSTATUS DriverStatus;&#10;  UCHAR        bBuffer[1];&#10;} SENDCMDOUTPARAMS, *PSENDCMDOUTPARAMS, *LPSENDCMDOUTPARAMS;">SENDCMDOUTPARAMS</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntdddisk/ns-ntdddisk-_sendcmdinparams">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntdddisk/ns-ntdddisk-_sendcmdinparams.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
