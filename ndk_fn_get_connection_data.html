<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDK_FN_GET_CONNECTION_DATA - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDK_FN_GET_CONNECTION_DATA - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDK_FN_GET_CONNECTION_DATA - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndkpi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDK_FN_GET_CONNECTION_DATA NdkFnGetConnectionData;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NdkFnGetConnectionData(
  [in]            <a href="ndk_connector" title="typedef struct _NDK_CONNECTOR {&#10;  NDK_OBJECT_HEADER            Header;&#10;  const NDK_CONNECTOR_DISPATCH *Dispatch;&#10;} NDK_CONNECTOR;">NDK_CONNECTOR</a> *pNdkConnector,
  [out, optional] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> *pInboundReadLimit,
  [out, optional] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> *pOutboundReadLimit,
                  PVOID pPrivateData,
                  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> *pPrivateDataLength
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndkpi/nc-ndkpi-ndk_fn_get_connection_data">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndk_fn_get_connection_data.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndkpi-ndk_fn_get_connection_data)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>NDK_FN_GET_CONNECTION_DATA callback function</h1>

<h2>Description</h2>

<p>The <em>NdkGetConnectionData</em> (<em>NDK_FN_GET_CONNECTION_DATA</em>) function gets read limit values and the private data sent by the peer.</p>

<h2>Parameters</h2>

<h3><code>pNdkConnector</code> [in]</h3>

<p>A pointer to an NDK connector object (<a href="ndk_connector" title="typedef struct _NDK_CONNECTOR {&#10;  NDK_OBJECT_HEADER            Header;&#10;  const NDK_CONNECTOR_DISPATCH *Dispatch;&#10;} NDK_CONNECTOR;">NDK_CONNECTOR</a>).</p>

<h3><code>pInboundReadLimit</code> [out, optional]</h3>

<p>The maximum number of incoming in-progress read operations to allow on the QP is returned in this location.</p>

<h3><code>pOutboundReadLimit</code> [out, optional]</h3>

<p>The maximum number of outgoing in-progress read operations to allow on the QP is returned in this location.</p>

<h3><code>pPrivateData</code></h3>

<p>A pointer to private data that is returned.</p>

<h3><code>pPrivateDataLength</code></h3>

<p>The length, in bytes, of the private data that is provided in the <em>pPrivateData</em> parameter.</p>

<p><strong>Note</strong> The output value does not indicate the actual length of private data stored in the buffer. NDK consumers must negotiate the format and length of the actual private data. For more information about private data, see the Remarks section.</p>

<h2>Return value</h2>

<p>The <em>NdkGetConnectionData</em> function returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> codes.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The operation completed successfully.</td>
</tr>
<tr>
  <td><strong>STATUS_BUFFER_TOO_SMALL</strong></td>
  <td>The value in the <em>*pPrivateDataLength</em> parameter specified a buffer size that was too small to hold the connection private data. <em>*pPrivateDataLength</em> is updated with the required size.</td>
</tr>
<tr>
  <td><strong>Other status codes</strong></td>
  <td>An error occurred.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>The <em>NdkGetConnectionData</em> function gets the private data sent by the peer with connect, accept, or reject requests and the effective inbound and outbound read limit values. These values are derived from the local and remote peers' requested values and the provider's maximum limits.</p>

<p>To access the private data and the effective inbound read limit (IRD) and outbound read limit (ORD) values from the active side, an NDK consumer can call <em>NdkGetConnectionData</em> for a connector object that was passed to the <a href="ndk_fn_connect_event_callback" title="NDK_FN_CONNECT_EVENT_CALLBACK NdkFnConnectEventCallback;&#10;&#10;VOID NdkFnConnectEventCallback(&#10;  [in, optional] PVOID ConnectEventContext,&#10;  [in]           NDK_CONNECTOR *pNdkConnector&#10;)&#10;{...}">NDK_FN_CONNECT_EVENT_CALLBACK</a> function.</p>

<p>To access the private data and effective IRD and ORD values from the passive side, the consumer can call <em>NdkGetConnectionData</em> for a connector object for which <a href="ndk_fn_connect" title="NDK_FN_CONNECT NdkFnConnect;&#10;&#10;NTSTATUS NdkFnConnect(&#10;  [in]                                      NDK_CONNECTOR *pNdkConnector,&#10;  [in]                                      NDK_QP *pNdkQp,&#10;                                            const PSOCKADDR pSrcAddress,&#10;  [in]                                      ULONG SrcAddressLength,&#10;  [in]                                      const PSOCKADDR pDestAddress,&#10;  [in]                                      ULONG DestAddressLength,&#10;  [in]                                      ULONG InboundReadLimit,&#10;  [in]                                      ULONG OutboundReadLimit,&#10;  [_In_reads_bytes_opt_(PrivateDataLength)] const PVOID pPrivateData,&#10;  [in]                                      ULONG PrivateDataLength,&#10;  [in]                                      NDK_FN_REQUEST_COMPLETION RequestCompletion,&#10;  [in, optional]                            PVOID RequestContext&#10;)&#10;{...}">NDK_FN_CONNECT</a> or <a href="ndk_fn_connect_with_shared_endpoint" title="NDK_FN_CONNECT_WITH_SHARED_ENDPOINT NdkFnConnectWithSharedEndpoint;&#10;&#10;NTSTATUS NdkFnConnectWithSharedEndpoint(&#10;  [in]                                      NDK_CONNECTOR *pNdkConnector,&#10;  [in]                                      NDK_QP *pNdkQp,&#10;  [in]                                      NDK_SHARED_ENDPOINT *pNdkSharedEndpoint,&#10;                                            const PSOCKADDR pDestAddress,&#10;  [in]                                      ULONG DestAddressLength,&#10;  [in]                                      ULONG InboundReadLimit,&#10;  [in]                                      ULONG OutboundReadLimit,&#10;  [_In_reads_bytes_opt_(PrivateDataLength)] const PVOID pPrivateData,&#10;  [in]                                      ULONG PrivateDataLength,&#10;  [in]                                      NDK_FN_REQUEST_COMPLETION RequestCompletion,&#10;  [in, optional]                            PVOID RequestContext&#10;)&#10;{...}">NDK_FN_CONNECT_WITH_SHARED_ENDPOINT</a> completed successfully An NDK consumer will not call this function after it calls the <a href="ndk_fn_accept" title="NDK_FN_ACCEPT NdkFnAccept;&#10;&#10;NTSTATUS NdkFnAccept(&#10;  [in]                                      NDK_CONNECTOR *pNdkConnector,&#10;  [in]                                      NDK_QP *pNdkQp,&#10;  [in]                                      ULONG InboundReadLimit,&#10;  [in]                                      ULONG OutboundReadLimit,&#10;  [_In_reads_bytes_opt_(PrivateDataLength)] const PVOID pPrivateData,&#10;  [in]                                      ULONG PrivateDataLength,&#10;  [in, optional]                            NDK_FN_DISCONNECT_EVENT_CALLBACK DisconnectEvent,&#10;  [in, optional]                            PVOID DisconnectEventContext,&#10;  [in]                                      NDK_FN_REQUEST_COMPLETION RequestCompletion,&#10;  [in, optional]                            PVOID RequestContext&#10;)&#10;{...}">NDK_FN_ACCEPT</a> function on the passive side or the <a href="ndk_fn_complete_connect" title="NDK_FN_COMPLETE_CONNECT NdkFnCompleteConnect;&#10;&#10;NTSTATUS NdkFnCompleteConnect(&#10;  [in]           NDK_CONNECTOR *pNdkConnector,&#10;  [in, optional] NDK_FN_DISCONNECT_EVENT_CALLBACK DisconnectEvent,&#10;  [in, optional] PVOID DisconnectEventContext,&#10;  [in]           NDK_FN_REQUEST_COMPLETION RequestCompletion,&#10;  [in, optional] PVOID RequestContext&#10;)&#10;{...}">NDK_FN_COMPLETE_CONNECT</a> function on the active side.</p>

<p>If the <em>pPrivateData</em> parameter is NULL and <em>*pPrivateDataLength</em> is zero, an NDK provider must return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> and store the required private data buffer size (<em>RDS</em>) in <em>*pPrivateDataLength</em>.</p>

<p><strong>Note</strong> The <em>required private data buffer size</em> (<em>RDS</em>) does not indicate that the peer has sent that much private data. The NDK consumer must, on both ends, have a common scheme to allow the receiving end to determine if there is any private data or not in the private data buffer. The <em>RDS</em> might be different for each connection.</p>

<p>If <em>pPrivateData</em> is NULL and <em>*pPrivateDataLength</em> is greater than zero, this is an invalid request. A consumer must never do this.</p>

<p>If <em>pPrivateData</em> is not NULL, the provider must copy the private data to the buffer at <em>pPrivateData</em> up to the smaller of <em>*pPrivateDataLength</em> or <em>RDS</em> in bytes.</p>

<p>If <em>*pPrivateDataLength</em> is greater than or equal to <em>RDS</em>, the provider must return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>. Otherwise, the provider must return STATUS_BUFFER_TOO_SMALL. In both cases, the provider must store the <em>RDS</em> in <em>*pPrivateDataLength</em> before returning.</p>

<h2>See also</h2>

<p><a href="ndk_connector" title="typedef struct _NDK_CONNECTOR {&#10;  NDK_OBJECT_HEADER            Header;&#10;  const NDK_CONNECTOR_DISPATCH *Dispatch;&#10;} NDK_CONNECTOR;">NDK_CONNECTOR</a></p>

<p><a href="ndk_connector_dispatch" title="typedef struct _NDK_CONNECTOR_DISPATCH {&#10;  NDK_FN_CLOSE_OBJECT                 NdkCloseConnector;&#10;  NDK_FN_QUERY_EXTENSION_INTERFACE    NdkQueryExtension;&#10;  NDK_FN_CONNECT                      NdkConnect;&#10;  NDK_FN_CONNECT_WITH_SHARED_ENDPOINT NdkConnectWithSharedEndpoint;&#10;  NDK_FN_COMPLETE_CONNECT             NdkCompleteConnect;&#10;  NDK_FN_ACCEPT                       NdkAccept;&#10;  NDK_FN_REJECT                       NdkReject;&#10;  NDK_FN_GET_CONNECTION_DATA          NdkGetConnectionData;&#10;  NDK_FN_GET_LOCAL_ADDRESS            NdkGetLocalAddress;&#10;  NDK_FN_GET_PEER_ADDRESS             NdkGetPeerAddress;&#10;  NDK_FN_DISCONNECT                   NdkDisconnect;&#10;  NDK_FN_COMPLETE_CONNECT_EX          NdkCompleteConnectEx;&#10;  NDK_FN_ACCEPT_EX                    NdkAcceptEx;&#10;} NDK_CONNECTOR_DISPATCH;">NDK_CONNECTOR_DISPATCH</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndkpi/nc-ndkpi-ndk_fn_get_connection_data">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndkpi/nc-ndkpi-ndk_fn_get_connection_data.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
