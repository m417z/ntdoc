<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="StorPortNotification - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>StorPortNotification - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            StorPortNotification - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// storport.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">STORPORT_API VOID StorPortNotification(
  SCSI_NOTIFICATION_TYPE NotificationType,
  PVOID                  HwDeviceExtension,
  ...                    
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nf-storport-storportnotification">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/storportnotification.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-storport-storportnotification)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="storportnotification-function">StorPortNotification function</h1>

<h2 id="description">Description</h2>

<p>The miniport driver uses the <strong>StorPortNotification</strong> routine to notify the Storport driver of certain events and conditions.</p>

<p><strong>StorPortNotification</strong> takes a variable number of parameters depending on the notification type specified.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="notificationtype"><code>NotificationType</code></h3>

<p>Specifies the notification type, which can be one of the following values.</p>

<table>
<thead>
<tr>
  <th>Notification type</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>BufferOverrunDetected</td>
  <td>This notification type has no arguments and gives the miniport driver an opportunity to bugcheck the system if it detects a corruption.</td>
</tr>
<tr>
  <td>BusChangeDetected</td>
  <td>Indicates that a target device might have been added or removed from a dynamic bus. To use this notification type, include an optional PathId parameter to indicate the SCSI port or bus where the change was detected.&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _In_opt_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> PathId );</code></td>
</tr>
<tr>
  <td>IoTargetRequestServiceTime</td>
  <td>Indicates to Storport the amount of time that was required to process a specified request.&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _In_ <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a> Duration, _In_ <a href="scsi_request_block" title="typedef struct _SCSI_REQUEST_BLOCK {&#10;  USHORT                     Length;&#10;  UCHAR                      Function;&#10;  UCHAR                      SrbStatus;&#10;  UCHAR                      ScsiStatus;&#10;  UCHAR                      PathId;&#10;  UCHAR                      TargetId;&#10;  UCHAR                      Lun;&#10;  UCHAR                      QueueTag;&#10;  UCHAR                      QueueAction;&#10;  UCHAR                      CdbLength;&#10;  UCHAR                      SenseInfoBufferLength;&#10;  ULONG                      SrbFlags;&#10;  ULONG                      DataTransferLength;&#10;  ULONG                      TimeOutValue;&#10;  PVOID                      DataBuffer;&#10;  PVOID                      SenseInfoBuffer;&#10;  struct _SCSI_REQUEST_BLOCK *NextSrb;&#10;  PVOID                      OriginalRequest;&#10;  PVOID                      SrbExtension;&#10;...">PSCSI_REQUEST_BLOCK</a> Srb );</code>&lt;br&gt;&lt;br&gt;Duration [in]&lt;br&gt;&lt;br&gt; The duration of the service time required for Srb in 100 nanosecond units.&lt;br&gt;&lt;br&gt;Srb [in]&lt;br&gt;&lt;br&gt; The request block to set the service time for.</td>
</tr>
<tr>
  <td>LinkDown</td>
  <td>Indicates that the link is down and will probably be down for some time. StorPort will pause the adapter in response to this notification.</td>
</tr>
<tr>
  <td>LinkUp</td>
  <td>Indicates that the link has been restored. StorPort restarts the adapter so that it can resume operation in response to this notification. Miniport drivers should not send this notification unless the link is down.</td>
</tr>
<tr>
  <td>QueryTickCount</td>
  <td>This notification type returns a LARGE_INTEGER that holds the value from <a href="kequerytickcount" title="VOID&#10;KeQueryTickCount (&#10;    _Out_ PLARGE_INTEGER CurrentCount&#10;    );">KeQueryTickCount</a>. The value returned in TickCount is the count of the interval timer interrupts that have occurred since the system was booted&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _Inout_ PLARGE_INTEGER TickCount );</code></td>
</tr>
<tr>
  <td>RequestComplete</td>
  <td>Indicates that the given SRB has finished. After this notification is sent, the port driver owns the request. The Srb parameter represents a pointer to the completed SCSI request block. The miniport driver must not attempt to access the request in Srb, and it must not pass Srb to another routine.&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _In_ <a href="scsi_request_block" title="typedef struct _SCSI_REQUEST_BLOCK {&#10;  USHORT                     Length;&#10;  UCHAR                      Function;&#10;  UCHAR                      SrbStatus;&#10;  UCHAR                      ScsiStatus;&#10;  UCHAR                      PathId;&#10;  UCHAR                      TargetId;&#10;  UCHAR                      Lun;&#10;  UCHAR                      QueueTag;&#10;  UCHAR                      QueueAction;&#10;  UCHAR                      CdbLength;&#10;  UCHAR                      SenseInfoBufferLength;&#10;  ULONG                      SrbFlags;&#10;  ULONG                      DataTransferLength;&#10;  ULONG                      TimeOutValue;&#10;  PVOID                      DataBuffer;&#10;  PVOID                      SenseInfoBuffer;&#10;  struct _SCSI_REQUEST_BLOCK *NextSrb;&#10;  PVOID                      OriginalRequest;&#10;  PVOID                      SrbExtension;&#10;...">PSCSI_REQUEST_BLOCK</a> Srb );</code></td>
</tr>
<tr>
  <td>RequestTimerCall</td>
  <td>Indicates that the miniport driver requires the port driver to call the miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_timer">HwStorTimer</a> routine in the requested number of microseconds.&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _In_ <a href="phw_timer" title="PHW_TIMER PhwTimer;&#10;&#10;VOID PhwTimer(&#10;  [in] PVOID DeviceExtension&#10;)&#10;{...}">PHW_TIMER</a> HwStorTimer, _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MiniportTimerValue );</code>&lt;br&gt;&lt;br&gt;HwStorTimer [in]&lt;br&gt;&lt;br&gt; A pointer to a timer routine that is called after the interval of time that is specified in MiniportTimerValue.&lt;br&gt;&lt;br&gt;MiniportTimerValue [in]&lt;br&gt;&lt;br&gt; Indicates the interval after which the timer routine pointed to by HwStorTimer is called. This is a positive value specified in microseconds. A value of 0 will cancel the timer. The system timer resolution is approximately 10 milliseconds.</td>
</tr>
<tr>
  <td>ResetDetected</td>
  <td>Indicates that the HBA has detected a reset on the bus. After this notification is sent, the miniport driver is still responsible for completing any active requests. The port driver will manage all required bus-reset delays.</td>
</tr>
<tr>
  <td>WMIEvent</td>
  <td>Indicates that the miniport driver has detected an event for which one or more WMI data consumers are registered. Note that the <strong>WmiEvent</strong> parameter is limited to a maximum of 128 bytes. If <strong>WmiEvent</strong> is larger than 128 bytes, it will be ignored.&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _In_ <a href="wnode_event_item" title="typedef struct tagWNODE_EVENT_ITEM {&#10;  struct _WNODE_HEADER WnodeHeader;&#10;} WNODE_EVENT_ITEM, *PWNODE_EVENT_ITEM;">PWNODE_EVENT_ITEM</a> WMIEvent, _In_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> PathId, _In_opt_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> TargetId, _In_opt_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> Lun );</code>&lt;br&gt;&lt;br&gt;WMIEvent [in]&lt;br&gt;&lt;br&gt; A pointer to event structures that have information about a WMI event that is detected by the miniport driver.&lt;br&gt;&lt;br&gt;PathId [in]&lt;br&gt;&lt;br&gt; Indicates the SCSI port or bus for the request. Set this parameter to 0xff for an adapter device. Otherwise, set to a valid path ID.&lt;br&gt;&lt;br&gt;TargetId [in, optional]&lt;br&gt;&lt;br&gt; Indicates the target controller or device on the bus. This parameter is not used when the event is for an adapter.&lt;br&gt;&lt;br&gt;Lun [in, optional]&lt;br&gt;&lt;br&gt; Indicates the logical unit number of the device. This parameter is not used when the event is for an adapter.</td>
</tr>
<tr>
  <td>WMIReregister</td>
  <td>Indicates that the miniport driver has changed the data items or the number of instances of a given data block that was previously registered by calling <a href="iowmiregistrationcontrol" title="NTSTATUS IoWMIRegistrationControl(&#10;  [in] PDEVICE_OBJECT DeviceObject,&#10;  [in] ULONG          Action&#10;);">IoWMIRegistrationControl</a>.&lt;br&gt;&lt;br&gt;<code>cpp VOID StorPortNotification( _In_ SCSI_NOTIFICATION_TYPE NotificationType, _In_ PVOID HwDeviceExtension, _In_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> PathId, _In_opt_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> TargetId, _In_opt_ <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> Lun );</code>&lt;br&gt;&lt;br&gt;PathId [in]&lt;br&gt;&lt;br&gt; Indicates the SCSI port or bus for the request. Set this parameter to 0xff for an adapter device. Otherwise, set to a valid path ID.&lt;br&gt;&lt;br&gt;TargetId [in, optional]&lt;br&gt;&lt;br&gt; Indicates the target controller or device on the bus. This parameter is not used when registration is for an adapter.&lt;br&gt;&lt;br&gt;Lun [in, optional]&lt;br&gt;&lt;br&gt; Indicates the logical unit number of the device. This parameter is not used when registration is for an adapter.</td>
</tr>
</tbody>
</table>

<h3 id="hwdeviceextension"><code>HwDeviceExtension</code></h3>

<p>A pointer to the hardware device extension. This is a per HBA storage area that the port driver allocates and initializes on behalf of the miniport driver. Miniport drivers usually store HBA-specific information in this extension, such as the state of the HBA and the mapped access ranges for the HBA. This area is available to the miniport driver immediately after the miniport driver calls <a href="storportinitialize" title="STORPORT_API ULONG StorPortInitialize(&#10;  [in]           PVOID                   Argument1,&#10;  [in]           PVOID                   Argument2,&#10;  [in]           _HW_INITIALIZATION_DATA *HwInitializationData,&#10;  [in, optional] PVOID                   HwContext&#10;);">StorPortInitialize</a>. The port driver frees this memory when it removes the device.</p>

<h3 id="-1"><code>...</code></h3>

<p>Additional Parameters.</p>

<h2 id="return-value">Return value</h2>

<p>None.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>StorPortNotification</strong> is a polymorphic function that handles many different types of requests, making it difficult to annotate in a manner that would cover all possible uses.
Because <strong>StorPortNotification</strong> returns VOID, the scanning engine should assume the LockHandle was acquired as asked.</p>

<h2 id="see-also">See also</h2>

<p><a href="storportinitialize" title="STORPORT_API ULONG StorPortInitialize(&#10;  [in]           PVOID                   Argument1,&#10;  [in]           PVOID                   Argument2,&#10;  [in]           _HW_INITIALIZATION_DATA *HwInitializationData,&#10;  [in, optional] PVOID                   HwContext&#10;);">StorPortInitialize</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nf-storport-storportnotification">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/storport/nf-storport-storportnotification.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
