<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_POLL - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_POLL - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_POLL - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// poll.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_POLL NdisPoll;

void() NdisPoll(
  [_In_]    void *Context,
  [_Inout_] <a href="ndis_poll_data" title="typedef struct _NDIS_POLL_DATA {&#10;  NDIS_OBJECT_HEADER      Header;&#10;  NDIS_POLL_TRANSMIT_DATA Transmit;&#10;  NDIS_POLL_RECEIVE_DATA  Receive;&#10;} NDIS_POLL_DATA;">NDIS_POLL_DATA</a> *PollData
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/poll/nc-poll-ndis_poll">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_poll.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-poll-ndis_poll)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>Miniport drivers implement the <em>NdisPoll</em> callback function that NDIS will poll for receive indications and send completions.</p>
<h2>Parameters</h2>
<h3><code>Context</code> [<em>In</em>]</h3>
<p>A pointer to the context information that the driver provided when it created the Poll object.</p>
<h3><code>PollData</code> [<em>Inout</em>]</h3>
<p>A pointer to an <strong><a href="ndis_poll_data" title="typedef struct _NDIS_POLL_DATA {&#10;  NDIS_OBJECT_HEADER      Header;&#10;  NDIS_POLL_TRANSMIT_DATA Transmit;&#10;  NDIS_POLL_RECEIVE_DATA  Receive;&#10;} NDIS_POLL_DATA;">NDIS_POLL_DATA</a></strong> structure that the driver should use to perform receive indications and send completions. It also contains details about how many NBLs need to be indicated.</p>
<h2>Return value</h2>
<h2>Remarks</h2>
<p>Miniport drivers register the <em>NdisPoll</em> callback during miniport adapter initialization. Drivers specify an entry point for the <em>NdisPoll</em> function at the <strong>PollHandler</strong> parameter of the <strong><a href="ndis_poll_characteristics" title="typedef struct _NDIS_POLL_CHARACTERISTICS {&#10;  NDIS_OBJECT_HEADER                 Header;&#10;  NDIS_SET_POLL_NOTIFICATION_HANDLER SetPollNotificationHandler;&#10;  NDIS_POLL_HANDLER                  PollHandler;&#10;} NDIS_POLL_CHARACTERISTICS;">NDIS_POLL_CHARACTERISTICS</a></strong> structure before calling <strong><a href="ndisregisterpoll" title="NDIS_EXPORTED_ROUTINE NDIS_STATUS NdisRegisterPoll(&#10;  [_In_]     NDIS_HANDLE                     NdisHandle,&#10;  [_In_opt_] void                            *Context,&#10;  [_In_]     NDIS_POLL_CHARACTERISTICS const *Characteristics,&#10;  [_Out_]    NDIS_POLL_HANDLE                *PollHandle&#10;);">NdisRegisterPoll</a></strong>.</p>
<p>NDIS will first invoke the <em>NdisPoll</em> callback when the driver calls <strong><a href="ndisrequestpoll" title="void NdisRequestPoll(&#10;  [_In_] NDIS_POLL_HANDLE PollHandle,&#10;         void             *Reserved&#10;);">NdisRequestPoll</a></strong>. NDIS will keep invoking <em>NdisPoll</em> while the driver is making forward progress on receive indications or transmit completions.</p>
<p>The <em>NdisPoll</em> callback may be invoked at both PASSIVE_LEVEL and DISPATCH_LEVEL IRQL. The driver shouldn't make assumptions about which level it will be.</p>
<p>The driver must check the <strong>receive</strong> or <strong>transmit</strong> parameters of the <strong><a href="ndis_poll_data" title="typedef struct _NDIS_POLL_DATA {&#10;  NDIS_OBJECT_HEADER      Header;&#10;  NDIS_POLL_TRANSMIT_DATA Transmit;&#10;  NDIS_POLL_RECEIVE_DATA  Receive;&#10;} NDIS_POLL_DATA;">NDIS_POLL_DATA</a></strong> structure to get the maximum number of NBLs it can indicate or complete.</p>
<p>For receive indications, the driver should:</p>
<ol>
<li>Fetch up to the maximum number of Rx packets it can indicate.</li>
<li>Initialize the NBLs.</li>
<li>Add them to the NBL queue provided by the <strong><a href="ndis_poll_receive_data" title="typedef struct _NDIS_POLL_RECEIVE_DATA {&#10;  ULONG           MaxNblsToIndicate;&#10;  ULONG           Reserved1[3];&#10;  NET_BUFFER_LIST *IndicatedNblChain;&#10;  ULONG           NumberOfIndicatedNbls;&#10;  ULONG           NumberOfRemainingNbls;&#10;  ULONG           Flags;&#10;  ULONG           Reserved2;&#10;  void            *Reserved3[4];&#10;} NDIS_POLL_RECEIVE_DATA;">NDIS_POLL_RECEIVE_DATA</a></strong> structure (located in the <strong><a href="ndis_poll_data" title="typedef struct _NDIS_POLL_DATA {&#10;  NDIS_OBJECT_HEADER      Header;&#10;  NDIS_POLL_TRANSMIT_DATA Transmit;&#10;  NDIS_POLL_RECEIVE_DATA  Receive;&#10;} NDIS_POLL_DATA;">NDIS_POLL_DATA</a></strong> structure of the <em>NdisPoll</em> <strong>PollData</strong> parameter).</li>
<li>Exit the callback.</li>
</ol>
<p>For transmit completions, the driver should:</p>
<ol>
<li>Fetch up to the maximum number of Tx packets it can complete.</li>
<li>Complete the NBLs.</li>
<li>Add them to the NBL queue provided by the <strong><a href="ndis_poll_transmit_data" title="typedef struct _NDIS_POLL_TRANSMIT_DATA {&#10;  ULONG           MaxNblsToComplete;&#10;  ULONG           Reserved1[3];&#10;  NET_BUFFER_LIST *CompletedNblChain;&#10;  ULONG           NumberOfCompletedNbls;&#10;  ULONG           NumberOfRemainingNbls;&#10;  ULONG           SendCompleteFlags;&#10;  ULONG           Reserved2;&#10;  void            *Reserved3[4];&#10;} NDIS_POLL_TRANSMIT_DATA;">NDIS_POLL_TRANSMIT_DATA</a></strong> structure (located in the <strong><a href="ndis_poll_data" title="typedef struct _NDIS_POLL_DATA {&#10;  NDIS_OBJECT_HEADER      Header;&#10;  NDIS_POLL_TRANSMIT_DATA Transmit;&#10;  NDIS_POLL_RECEIVE_DATA  Receive;&#10;} NDIS_POLL_DATA;">NDIS_POLL_DATA</a></strong> structure of the <em>NdisPoll</em> <strong>PollData</strong> parameter).</li>
<li>Exit the callback.</li>
</ol>
<p>The driver should not enable the Poll object's interrupt before exiting the <em>NdisPoll</em> function. NDIS will keep polling the driver until it assesses that no forward progress is being made. At this point NDIS will stop polling and ask the driver to reenable the interrupt by invoking the <a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/poll/nc-poll-ndis_set_poll_notification"><em>NdisSetPollNotification</em></a> callback.</p>
<h2>See also</h2>
<p><a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/poll/nc-poll-ndis_set_poll_notification"><em>NdisSetPollNotification</em></a></p>
<p><strong><a href="ndis_poll_characteristics" title="typedef struct _NDIS_POLL_CHARACTERISTICS {&#10;  NDIS_OBJECT_HEADER                 Header;&#10;  NDIS_SET_POLL_NOTIFICATION_HANDLER SetPollNotificationHandler;&#10;  NDIS_POLL_HANDLER                  PollHandler;&#10;} NDIS_POLL_CHARACTERISTICS;">NDIS_POLL_CHARACTERISTICS</a></strong></p>
<p><strong><a href="ndis_poll_data" title="typedef struct _NDIS_POLL_DATA {&#10;  NDIS_OBJECT_HEADER      Header;&#10;  NDIS_POLL_TRANSMIT_DATA Transmit;&#10;  NDIS_POLL_RECEIVE_DATA  Receive;&#10;} NDIS_POLL_DATA;">NDIS_POLL_DATA</a></strong></p>
<p><strong><a href="ndis_poll_receive_data" title="typedef struct _NDIS_POLL_RECEIVE_DATA {&#10;  ULONG           MaxNblsToIndicate;&#10;  ULONG           Reserved1[3];&#10;  NET_BUFFER_LIST *IndicatedNblChain;&#10;  ULONG           NumberOfIndicatedNbls;&#10;  ULONG           NumberOfRemainingNbls;&#10;  ULONG           Flags;&#10;  ULONG           Reserved2;&#10;  void            *Reserved3[4];&#10;} NDIS_POLL_RECEIVE_DATA;">NDIS_POLL_RECEIVE_DATA</a></strong></p>
<p><strong><a href="ndisregisterpoll" title="NDIS_EXPORTED_ROUTINE NDIS_STATUS NdisRegisterPoll(&#10;  [_In_]     NDIS_HANDLE                     NdisHandle,&#10;  [_In_opt_] void                            *Context,&#10;  [_In_]     NDIS_POLL_CHARACTERISTICS const *Characteristics,&#10;  [_Out_]    NDIS_POLL_HANDLE                *PollHandle&#10;);">NdisRegisterPoll</a></strong></p>
<p><strong><a href="ndisrequestpoll" title="void NdisRequestPoll(&#10;  [_In_] NDIS_POLL_HANDLE PollHandle,&#10;         void             *Reserved&#10;);">NdisRequestPoll</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/poll/nc-poll-ndis_poll">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/poll/nc-poll-ndis_poll.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
