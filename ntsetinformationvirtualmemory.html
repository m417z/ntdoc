<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtSetInformationVirtualMemory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtSetInformationVirtualMemory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtSetInformationVirtualMemory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTMMAPI_H
#if (PHNT_MODE != PHNT_MODE_KERNEL)
#if (PHNT_VERSION &gt;= PHNT_WINDOWS_8)

</span><span class="ntdoc-code-intro">/**
 * The NtSetInformationVirtualMemory routine performs an operation on a specified list of address ranges in the user address space of a process.
 *
 * \param ProcessHandle Specifies an open handle for the process in the context of which the operation is to be performed. This handle cannot be invalid.
 * \param VmInformationClass Specifies the type of operation to perform.
 * \param NumberOfEntries Number of entries in the array pointed to by the VirtualAddresses parameter. This parameter cannot be 0.
 * \param VirtualAddresses Pointer to an array of <a href="memory_range_entry" title="typedef struct _MEMORY_RANGE_ENTRY&#10;{&#10;    PVOID VirtualAddress;&#10;    SIZE_T NumberOfBytes;&#10;} MEMORY_RANGE_ENTRY, *PMEMORY_RANGE_ENTRY;">MEMORY_RANGE_ENTRY</a> structures in which each entry specifies a virtual address range to be processed.
 * The virtual address ranges may cover any part of the process address space accessible by the target process.
 * \param VmInformation A pointer to a buffer that contains memory information.
 * Note: If VmInformationClass is <a href="vmprefetchinformation" title="#define VmPrefetchInformation 0x0">VmPrefetchInformation</a>, this parameter cannot be this parameter cannot be NULL and must point to a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> variable that is set to 0.
 * \param VmInformationLength The size of the buffer pointed to by VmInformation.
 * If VmInformationClass is <a href="vmprefetchinformation" title="#define VmPrefetchInformation 0x0">VmPrefetchInformation</a>, this must be sizeof (<a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>).
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationvirtualmemory
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtSetInformationVirtualMemory(
    _In_ HANDLE ProcessHandle,
    _In_ <a href="virtual_memory_information_class" title="typedef enum _VIRTUAL_MEMORY_INFORMATION_CLASS&#10;{&#10;    VmPrefetchInformation,                      // s: MEMORY_PREFETCH_INFORMATION&#10;    VmPagePriorityInformation,                  // s: MEMORY_PAGE_PRIORITY_INFORMATION&#10;    VmCfgCallTargetInformation,                 // s: CFG_CALL_TARGET_LIST_INFORMATION // REDSTONE2&#10;    VmPageDirtyStateInformation,                // s: MEMORY_PAGE_DIRTY_STATE_INFORMATION // REDSTONE3&#10;    VmImageHotPatchInformation,                 // s: 19H1&#10;    VmPhysicalContiguityInformation,            // s: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // 20H1 // (requires SeLockMemoryPrivilege)&#10;    VmVirtualMachinePrepopulateInformation,&#10;    VmRemoveFromWorkingSetInformation,          // s: MEMORY_REMOVE_WORKING_SET_INFORMATION&#10;    MaxVmInfoClass&#10;} VIRTUAL_MEMORY_INFORMATION_CLASS;">VIRTUAL_MEMORY_INFORMATION_CLASS</a> VmInformationClass,
    _In_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> NumberOfEntries,
    _In_reads_(NumberOfEntries) <a href="memory_range_entry" title="typedef struct _MEMORY_RANGE_ENTRY&#10;{&#10;    PVOID VirtualAddress;&#10;    SIZE_T NumberOfBytes;&#10;} MEMORY_RANGE_ENTRY, *PMEMORY_RANGE_ENTRY;">PMEMORY_RANGE_ENTRY</a> VirtualAddresses,
    _In_reads_bytes_(VmInformationLength) PVOID VmInformation,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> VmInformationLength
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/3c0415a5434b02669e71bf0184033f582498c4d6/phnt/include/ntmmapi.h#L1035">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwSetInformationVirtualMemory(
    _In_ HANDLE ProcessHandle,
    _In_ <a href="virtual_memory_information_class" title="typedef enum _VIRTUAL_MEMORY_INFORMATION_CLASS&#10;{&#10;    VmPrefetchInformation,                      // s: MEMORY_PREFETCH_INFORMATION&#10;    VmPagePriorityInformation,                  // s: MEMORY_PAGE_PRIORITY_INFORMATION&#10;    VmCfgCallTargetInformation,                 // s: CFG_CALL_TARGET_LIST_INFORMATION // REDSTONE2&#10;    VmPageDirtyStateInformation,                // s: MEMORY_PAGE_DIRTY_STATE_INFORMATION // REDSTONE3&#10;    VmImageHotPatchInformation,                 // s: 19H1&#10;    VmPhysicalContiguityInformation,            // s: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // 20H1 // (requires SeLockMemoryPrivilege)&#10;    VmVirtualMachinePrepopulateInformation,&#10;    VmRemoveFromWorkingSetInformation,          // s: MEMORY_REMOVE_WORKING_SET_INFORMATION&#10;    MaxVmInfoClass&#10;} VIRTUAL_MEMORY_INFORMATION_CLASS;">VIRTUAL_MEMORY_INFORMATION_CLASS</a> VmInformationClass,
    _In_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> NumberOfEntries,
    _In_reads_(NumberOfEntries) <a href="memory_range_entry" title="typedef struct _MEMORY_RANGE_ENTRY&#10;{&#10;    PVOID VirtualAddress;&#10;    SIZE_T NumberOfBytes;&#10;} MEMORY_RANGE_ENTRY, *PMEMORY_RANGE_ENTRY;">PMEMORY_RANGE_ENTRY</a> VirtualAddresses,
    _In_reads_bytes_(VmInformationLength) PVOID VmInformation,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> VmInformationLength
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/3c0415a5434b02669e71bf0184033f582498c4d6/phnt/include/ntzwapi.h#L4343">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwSetInformationVirtualMemory(
  [in] HANDLE                           ProcessHandle,
  [in] <a href="virtual_memory_information_class" title="typedef enum _VIRTUAL_MEMORY_INFORMATION_CLASS&#10;{&#10;    VmPrefetchInformation,                      // s: MEMORY_PREFETCH_INFORMATION&#10;    VmPagePriorityInformation,                  // s: MEMORY_PAGE_PRIORITY_INFORMATION&#10;    VmCfgCallTargetInformation,                 // s: CFG_CALL_TARGET_LIST_INFORMATION // REDSTONE2&#10;    VmPageDirtyStateInformation,                // s: MEMORY_PAGE_DIRTY_STATE_INFORMATION // REDSTONE3&#10;    VmImageHotPatchInformation,                 // s: 19H1&#10;    VmPhysicalContiguityInformation,            // s: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // 20H1 // (requires SeLockMemoryPrivilege)&#10;    VmVirtualMachinePrepopulateInformation,&#10;    VmRemoveFromWorkingSetInformation,          // s: MEMORY_REMOVE_WORKING_SET_INFORMATION&#10;    MaxVmInfoClass&#10;} VIRTUAL_MEMORY_INFORMATION_CLASS;">VIRTUAL_MEMORY_INFORMATION_CLASS</a> VmInformationClass,
  [in] <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a>                        NumberOfEntries,
  [in] <a href="memory_range_entry" title="typedef struct _MEMORY_RANGE_ENTRY&#10;{&#10;    PVOID VirtualAddress;&#10;    SIZE_T NumberOfBytes;&#10;} MEMORY_RANGE_ENTRY, *PMEMORY_RANGE_ENTRY;">PMEMORY_RANGE_ENTRY</a>              VirtualAddresses,
  [in] PVOID                            VmInformation,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                            VmInformationLength
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationvirtualmemory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationvirtualmemory">documented in Windows Driver Kit</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntsetinformationvirtualmemory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-zwsetinformationvirtualmemory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="zwsetinformationvirtualmemory-function">ZwSetInformationVirtualMemory function</h1>

<h2 id="description">Description</h2>

<p>The <strong>ZwSetInformationVirtualMemory</strong> routine performs an operation on a specified list of address ranges in the user address space of a process.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="processhandle-in"><code>ProcessHandle</code> [in]</h3>

<p>Specifies an open handle for the process in the context of which the operation is to be performed. This handle cannot be invalid. Use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/zwcurrentprocess">NtCurrentProcess</a> macro, defined in Ntddk.h, to specify the current process.</p>

<h3 id="vminformationclass-in"><code>VmInformationClass</code> [in]</h3>

<p>Specifies the type of operation to perform. Set to <strong><a href="vmprefetchinformation" title="#define VmPrefetchInformation 0x0">VmPrefetchInformation</a></strong> defined in the <strong><a href="virtual_memory_information_class" title="typedef enum _VIRTUAL_MEMORY_INFORMATION_CLASS&#10;{&#10;    VmPrefetchInformation,                      // s: MEMORY_PREFETCH_INFORMATION&#10;    VmPagePriorityInformation,                  // s: MEMORY_PAGE_PRIORITY_INFORMATION&#10;    VmCfgCallTargetInformation,                 // s: CFG_CALL_TARGET_LIST_INFORMATION // REDSTONE2&#10;    VmPageDirtyStateInformation,                // s: MEMORY_PAGE_DIRTY_STATE_INFORMATION // REDSTONE3&#10;    VmImageHotPatchInformation,                 // s: 19H1&#10;    VmPhysicalContiguityInformation,            // s: MEMORY_PHYSICAL_CONTIGUITY_INFORMATION // 20H1 // (requires SeLockMemoryPrivilege)&#10;    VmVirtualMachinePrepopulateInformation,&#10;    VmRemoveFromWorkingSetInformation,          // s: MEMORY_REMOVE_WORKING_SET_INFORMATION&#10;    MaxVmInfoClass&#10;} VIRTUAL_MEMORY_INFORMATION_CLASS;">VIRTUAL_MEMORY_INFORMATION_CLASS</a></strong> enumeration, see ntddk.h.</p>

<h3 id="numberofentries-in"><code>NumberOfEntries</code> [in]</h3>

<p>Number of entries in the array pointed to by the <em>VirtualAddresses</em> parameter. This parameter cannot be 0.</p>

<h3 id="virtualaddresses-in"><code>VirtualAddresses</code> [in]</h3>

<p>Pointer to an array of <a href="memory_range_entry" title="typedef struct _MEMORY_RANGE_ENTRY&#10;{&#10;    PVOID VirtualAddress;&#10;    SIZE_T NumberOfBytes;&#10;} MEMORY_RANGE_ENTRY, *PMEMORY_RANGE_ENTRY;">MEMORY_RANGE_ENTRY</a> structures in which each entry specifies a virtual address range to be processed. The virtual address ranges may cover any part of the process address space accessible by the target process.</p>

<h3 id="vminformation-in"><code>VmInformation</code> [in]</h3>

<p>A pointer to a buffer that contains memory information.
The format and content of the buffer depend on the
specified information class.</p>

<p>If <em>VmInformationClass</em> is <strong><a href="vmprefetchinformation" title="#define VmPrefetchInformation 0x0">VmPrefetchInformation</a></strong>, this parameter cannot be this parameter cannot be NULL and must point to a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> variable that is set to 0.</p>

<h3 id="vminformationlength-in"><code>VmInformationLength</code> [in]</h3>

<p>The size of the buffer pointed to by <em>VmInformation</em>.</p>

<p>If <em>VmInformationClass</em> is <strong><a href="vmprefetchinformation" title="#define VmPrefetchInformation 0x0">VmPrefetchInformation</a></strong>, this must be <code>sizeof (<a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>)</code>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ZwSetInformationVirtualMemory</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success, or the appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> error code on failure.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>ZwSetInformationVirtualMemory</strong> routine is called by drivers that know the set of addresses they will be accessing. If it's likely that these addresses are no longer resident in memory (i.e. they have been paged out to disk), calling this routine on those address ranges before access reduces the overall latency because it efficiently brings in those address ranges from disk using large, concurrent I/O requests where possible.</p>

<p><strong>ZwSetInformationVirtualMemory</strong> allows drivers to make efficient use of disk hardware by issuing large, concurrent I/Os where possible when the driver provides a list of process address ranges that are going to be accessed. Even for a single address range (e.g. a file mapping), the routine can provide performance improvements by issuing a single large I/O rather than the many smaller I/Os that would be issued via page faulting.</p>

<p>Drivers call this routine purely for performance optimization: prefetching is not necessary for accessing the target address ranges. The prefetched memory is not added to the target process' working set; it is cached in physical memory. When the prefetched address ranges are accessed by the target process, they are added to the working set.</p>

<p>Because this call is not necessary for correct operation of the driver, it is treated as a strong hint by the system and is subject to usual physical memory constraints where it can completely or partially fail under low-memory conditions. It can also create memory pressure if called with large address ranges, so applications should only prefetch address ranges they will actually use.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwsetinformationvirtualmemory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-zwsetinformationvirtualmemory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
