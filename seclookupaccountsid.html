<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SecLookupAccountSid - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SecLookupAccountSid - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SecLookupAccountSid - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">KSECDDDECLSPEC <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> SEC_ENTRY SecLookupAccountSid(
  [in]            PSID            Sid,
  [out]           PULONG          NameSize,
  [in, out]       <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> NameBuffer,
  [out]           PULONG          DomainSize,
  [out, optional] <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> DomainBuffer,
  [out]           <a href="sid_name_use" title="typedef enum _SID_NAME_USE {&#10;  SidTypeUser,&#10;  SidTypeGroup,&#10;  SidTypeDomain,&#10;  SidTypeAlias,&#10;  SidTypeWellKnownGroup,&#10;  SidTypeDeletedAccount,&#10;  SidTypeInvalid,&#10;  SidTypeUnknown,&#10;  SidTypeComputer,&#10;  SidTypeLabel,&#10;  SidTypeLogonSession&#10;} SID_NAME_USE, *PSID_NAME_USE;">PSID_NAME_USE</a>   NameUse
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-seclookupaccountsid">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/seclookupaccountsid.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-seclookupaccountsid)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="seclookupaccountsid-function">SecLookupAccountSid function</h1>

<h2 id="description">Description</h2>

<p><strong>SecLookupAccountSid</strong> accepts a security identifier (<a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a>) as input. It retrieves the name of the account for this <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> and the name of the first domain on which this <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> is found.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="sid-in"><code>Sid</code> [in]</h3>

<p>A pointer to the <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> to look up.</p>

<h3 id="namesize-out"><code>NameSize</code> [out]</h3>

<p>A pointer to a variable that specifies the size of the <strong>NameBuffer</strong>. On input, this value specifies the size in bytes of the input <strong>NameBuffer</strong>. If the function fails because the buffer is too small, this variable receives the required buffer size. On success, this variable contains the size of the returned <strong>NameBuffer</strong>.</p>

<h3 id="namebuffer-in-out"><code>NameBuffer</code> [in, out]</h3>

<p>A pointer to a buffer that receives the name of the account associated with the <strong>Sid</strong>. If this parameter is NULL, <strong>NameSize</strong> will be zero.</p>

<h3 id="domainsize-out"><code>DomainSize</code> [out]</h3>

<p>A pointer to a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> that specifies the size of the <strong>DomainBuffer</strong> parameter. If the function fails because the buffer is too small, this variable receives the required buffer size. If the <strong>DomainBuffer</strong> parameter is <strong>NULL</strong>, this parameter will be set to be zero.</p>

<h3 id="domainbuffer-out-optional"><code>DomainBuffer</code> [out, optional]</h3>

<p>A pointer to a buffer that receives the name of the first domain on which this <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> is found.</p>

<h3 id="nameuse-out"><code>NameUse</code> [out]</h3>

<p>A pointer to a <strong><a href="sid_name_use" title="typedef enum _SID_NAME_USE {&#10;  SidTypeUser,&#10;  SidTypeGroup,&#10;  SidTypeDomain,&#10;  SidTypeAlias,&#10;  SidTypeWellKnownGroup,&#10;  SidTypeDeletedAccount,&#10;  SidTypeInvalid,&#10;  SidTypeUnknown,&#10;  SidTypeComputer,&#10;  SidTypeLabel,&#10;  SidTypeLogonSession&#10;} SID_NAME_USE, *PSID_NAME_USE;">SID_NAME_USE</a></strong> enumerated type that receives the type of the account.</p>

<h2 id="return-value">Return value</h2>

<p><strong>SecLookupAccountSid</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success or one of the following error codes on failure.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>SEC_E_INTERNAL_ERROR</td>
  <td>An internal error occurred while trying to connect to the Local System Authority (LSA) or the local procedure call (LPC) to the security provider failed.</td>
</tr>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td>The process ID associated with the currently executing thread does not match the current process ID.</td>
</tr>
<tr>
  <td>STATUS_BUFFER_TOO_SMALL</td>
  <td>The buffer size for the <strong>NameBuffer</strong> or the <strong>ReferencedDomain</strong> parameter was too small.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER</td>
  <td>The length of the <strong>Name</strong> parameter exceeded the length allowed in a message to the Local System Authority (LSA).</td>
</tr>
<tr>
  <td>STATUS_NO_MEMORY</td>
  <td>It was not possible to allocate sufficient memory for a temporary internal buffer used by this function.</td>
</tr>
<tr>
  <td>STATUS_NONE_MAPPED</td>
  <td>The <strong>Sid</strong> parameter could not be found.</td>
</tr>
<tr>
  <td>STATUS_PROCESS_IS_TERMINATING</td>
  <td>This process has terminated so it is not possible to establish a local procedure call (LPC) connection.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p><strong>SecLookupAccountSid</strong> attempts to find a name for the specified <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> by first checking a list of well-known SIDs. If the supplied <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> does not correspond to a well-known <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a>, the function checks built-in and administratively defined local accounts. Next, the function checks the primary domain. Security identifiers not recognized by the primary domain are checked against the trusted domains that correspond to their <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> prefixes.</p>

<p>If the function cannot find an account name for the <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a>, <strong>SecLookupAccountSid</strong> fails. This can occur if a network time-out prevents the function from finding the name. It also occurs for SIDs that have no corresponding account name, such as a logon <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> that identifies a logon session.</p>

<p>In addition to looking up SIDs for local accounts, local domain accounts, and explicitly trusted domain accounts, <strong>SecLookupAccountSid</strong> can look up SIDs for any account in any domain in the forest, including SIDs that appear only in the SIDhistory field of an account in the forest. The SIDhistory field stores former SIDs of an account that has been moved from another domain. To look up a <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a>, <strong>SecLookupAccountSid</strong> queries the global catalog of the forest.</p>

<p><strong>SecLookupAccountSid</strong> is equivalent to the Win32 <strong>LookupAccountSid</strong> function.</p>

<p><strong>SecLookupAccountSid</strong> is exported by the ksecdd driver, which implements this function by using user-mode helper services. Accordingly, the use of this function within file systems must obey the usual rules for communication with user-mode services. <strong>SecLookupAccountSid</strong> cannot be used during paging file I/O.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a></strong></p>

<p><strong><a href="sid_name_use" title="typedef enum _SID_NAME_USE {&#10;  SidTypeUser,&#10;  SidTypeGroup,&#10;  SidTypeDomain,&#10;  SidTypeAlias,&#10;  SidTypeWellKnownGroup,&#10;  SidTypeDeletedAccount,&#10;  SidTypeInvalid,&#10;  SidTypeUnknown,&#10;  SidTypeComputer,&#10;  SidTypeLabel,&#10;  SidTypeLogonSession&#10;} SID_NAME_USE, *PSID_NAME_USE;">SID_NAME_USE</a></strong></p>

<p><strong><a href="seclookupaccountname" title="KSECDDDECLSPEC NTSTATUS SEC_ENTRY SecLookupAccountName(&#10;  [in]               PUNICODE_STRING Name,&#10;  [in, out]          PULONG          SidSize,&#10;  [out]              PSID            Sid,&#10;  [out]              PSID_NAME_USE   NameUse,&#10;  [out]              PULONG          DomainSize,&#10;  [in_out, optional] PUNICODE_STRING ReferencedDomain&#10;);">SecLookupAccountName</a></strong></p>

<p><strong><a href="seclookupwellknownsid" title="KSECDDDECLSPEC NTSTATUS SEC_ENTRY SecLookupWellKnownSid(&#10;  [in]               WELL_KNOWN_SID_TYPE SidType,&#10;  [out]              PSID                Sid,&#10;  [in]               ULONG               SidBufferSize,&#10;  [in_out, optional] PULONG              SidSize&#10;);">SecLookupWellKnownSid</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-seclookupaccountsid">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-seclookupaccountsid.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
