<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_SET_POWER_STATE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_SET_POWER_STATE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_SET_POWER_STATE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// dispmprt.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">DXGKDDI_SET_POWER_STATE DxgkddiSetPowerState;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiSetPowerState(
  [in] IN_CONST_PVOID MiniportDeviceContext,
  [in] IN_ULONG DeviceUid,
  [in] IN_DEVICE_POWER_STATE DevicePowerState,
  [in] IN_POWER_ACTION ActionType
)
{...}</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_set_power_state">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_set_power_state.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-dispmprt-dxgkddi_set_power_state)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>DXGKDDI_SET_POWER_STATE callback function</h1>
<h2>Description</h2>
<p>The <strong>DxgkDdiSetPowerState</strong> function sets the power state of a display adapter or a child device of a display adapter.</p>
<h2>Parameters</h2>
<h3><code>MiniportDeviceContext</code> [in]</h3>
<p>A handle to a context block associated with a display adapter. The display miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_add_device">DxgkDdiAddDevice</a> function previously provided this handle to the DirectX graphics kernel subsystem.</p>
<h3><code>DeviceUid</code> [in]</h3>
<p>A positive integer that identifies the device for which the power state is to be set. If <strong>DeviceUid</strong> is equal to <strong>DISPLAY_ADAPTER_HW_ID</strong> (defined in Video.h), the device is the display adapter itself. Otherwise, <strong>DeviceUid</strong> is the identifier of a child device of the display adapter. Child device identifiers were previously assigned by the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_query_child_relations">DxgkDdiQueryChildRelations</a> function.</p>
<h3><code>DevicePowerState</code> [in]</h3>
<p>A <a href="device_power_state" title="typedef enum _DEVICE_POWER_STATE {&#10;  PowerDeviceUnspecified,&#10;  PowerDeviceD0,&#10;  PowerDeviceD1,&#10;  PowerDeviceD2,&#10;  PowerDeviceD3,&#10;  PowerDeviceMaximum&#10;} DEVICE_POWER_STATE, *PDEVICE_POWER_STATE;">DEVICE_POWER_STATE</a> enumeration value that supplies the power state (<strong>PowerDeviceD0</strong>, <strong>PowerDeviceD1</strong>, <strong>PowerDeviceD2</strong>, <strong>PowerDeviceD3</strong>) to which the device should be set.</p>
<h3><code>ActionType</code> [in]</h3>
<p>A <a href="power_action" title="typedef enum  {&#10;  PowerActionNone           = 0,&#10;  PowerActionReserved       = ( PowerActionNone + 1 ),&#10;  PowerActionSleep          = ( PowerActionReserved + 1 ),&#10;  PowerActionHibernate      = ( PowerActionSleep + 1 ),&#10;  PowerActionShutdown       = ( PowerActionHibernate + 1 ),&#10;  PowerActionShutdownReset  = ( PowerActionShutdown + 1 ),&#10;  PowerActionShutdownOff    = ( PowerActionShutdownReset + 1 ),&#10;  PowerActionWarmEject      = ( PowerActionShutdownOff + 1 )&#10;} POWER_ACTION, *PPOWER_ACTION;">POWER_ACTION</a> enumeration value that supplies the reason (<strong>PowerActionSleep</strong>, <strong>PowerActionHibernate</strong>, <strong>PowerActionShutdown</strong>) for the power state change.</p>
<h2>Return value</h2>
<p><strong>DxgkDdiSetPowerState</strong> returns <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> if it succeeds. <strong>DxgkDdiSetPowerState</strong> should never fail; however, it can return any <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>-typed value that is defined in <strong>Ntstatus.h</strong> and that passes the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NT_SUCCESS(Status)</a> macro.</p>
<h2>Remarks</h2>
<p>If the requested state is equal to <strong>PowerDeviceD1</strong>, <strong>PowerDeviceD2</strong>, or <strong>PowerDeviceD3</strong>, <strong>DxgkDdiSetPowerState</strong> saves any context that will later be required to bring the device back to <strong>PowerDeviceD0</strong> and then places the device in the requested state. If the requested state is <strong>PowerDeviceD0</strong> (fully on), <strong>DxgkDdiSetPowerState</strong> restores the device context and places the device in <strong>PowerDeviceD0</strong>.</p>
<p>If <strong>DxgkDdiSetPowerState</strong> is called with a request to put the VGA-enabled display adapter into hibernation, it should not power down the display adapter. Instead, it should save the context and let the bus driver power down the display adapter. That way, the power manager can display hibernation progress after the display miniport driver has been notified about the power state change.</p>
<p>The operating system might call <strong>DxgkDdiSetPowerState</strong> on a child device of the display adapter that is no longer connected (for example, a monitor that was recently unplugged). This anomaly occurs because an inherent latency exists between the time that the operating system calls the driver's <strong>DxgkDdiSetPowerState</strong> and the time that the operating system processes the disconnection. The driver must handle such situations without failing.</p>
<p>If <strong>DevicePowerState</strong> is equal to <strong>PowerDeviceD0</strong>, do not rely on the value of <strong>ActionType</strong>.</p>
<p>Starting with Windows Display Driver Model (WDDM) 1.2, if the <strong>DevicePowerState</strong> parameter is set to <strong>PowerDeviceD0</strong>, the display miniport driver should call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkcb_acquire_post_display_ownership">DxgkCbAcquirePostDisplayOwnership</a> to query the information about the display mode. This display mode might have been previously set by the firmware and system loader. If <strong>DxgkCbAcquirePostDisplayOwnership</strong> returns with <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong>, the driver should determine whether it has to reinitialize the display based on the display mode information that was returned through the <strong>DisplayInfo</strong> parameter. Otherwise, the driver should not assume that any specific display mode is currently enabled on the device, and it should initialize the display.</p>
<p>The <strong>DxgkDdiSetPowerState</strong> function should be made pageable.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkcb_acquire_post_display_ownership">DxgkCbAcquirePostDisplayOwnership</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_add_device">DxgkDdiAddDevice</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_query_child_relations">DxgkDdiQueryChildRelations</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_set_power_state">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/dispmprt/nc-dispmprt-dxgkddi_set_power_state.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
