<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlVirtualUnwind - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlVirtualUnwind - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlVirtualUnwind - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winnt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI PEXCEPTION_ROUTINE RtlVirtualUnwind(
  [in]                <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>                          HandlerType,
  [in]                <a href="dword64" title="typedef unsigned __int64 DWORD64;">DWORD64</a>                        ImageBase,
  [in]                <a href="dword64" title="typedef unsigned __int64 DWORD64;">DWORD64</a>                        ControlPc,
  [in]                PRUNTIME_FUNCTION              FunctionEntry,
  [in, out]           PCONTEXT                       ContextRecord,
  [out]               PVOID                          *HandlerData,
  [out]               PDWORD64                       EstablisherFrame,
  [in, out, optional] PKNONVOLATILE_CONTEXT_POINTERS ContextPointers
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/nf-winnt-rtlvirtualunwind">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlvirtualunwind.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (nf-winnt-rtlvirtualunwind)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rtlvirtualunwind-function">RtlVirtualUnwind function</h1>

<h2 id="description">Description</h2>

<p>Retrieves the invocation context of the function that precedes the specified function context.</p>

<blockquote>
  <p>[!NOTE]
  This function is not implemented on all processor platforms and the implementation is different on each platform that supports it. The following prototype lists all the potential parameters and their application. Read further for processor-specific function prototypes.</p>
</blockquote>

<h2 id="parameters">Parameters</h2>

<h3 id="handlertype-in"><code>HandlerType</code> [in]</h3>

<p>The handler type. This parameter can be one of the following values.</p>

<p>This parameter is only present on x64.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>UNW_FLAG_NHANDLER</strong><br><br>0x0</td>
  <td>The function has no handler.</td>
</tr>
<tr>
  <td><strong>UNW_FLAG_EHANDLER</strong><br><br>0x1</td>
  <td>The function has an exception handler that should be called.</td>
</tr>
<tr>
  <td><strong>UNW_FLAG_UHANDLER</strong><br><br>0x2</td>
  <td>The function has a termination handler that should be called when unwinding an exception.</td>
</tr>
<tr>
  <td><strong>UNW_FLAG_CHAININFO</strong><br><br>0x4</td>
  <td>The <strong>FunctionEntry</strong> member is the contents of a previous function table entry.</td>
</tr>
</tbody>
</table>

<h3 id="imagebase-in"><code>ImageBase</code> [in]</h3>

<p>The base address of the module to which the function belongs.</p>

<h3 id="controlpc-in"><code>ControlPc</code> [in]</h3>

<p>The virtual address where control left the specified function.</p>

<h3 id="functionentry-in"><code>FunctionEntry</code> [in]</h3>

<p>The address of the function table entry for the specified function. To obtain the function table entry, call the <a href="rtllookupfunctionentry" title="NTSYSAPI PRUNTIME_FUNCTION RtlLookupFunctionEntry(&#10;  [in]  DWORD64               ControlPc,&#10;  [out] PDWORD64              ImageBase,&#10;  [out] PUNWIND_HISTORY_TABLE HistoryTable&#10;);">RtlLookupFunctionEntry</a> function.</p>

<h3 id="contextrecord-in-out"><code>ContextRecord</code> [in, out]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/ns-winnt-arm64_nt_context">CONTEXT</a> structure that represents the context of the previous frame.</p>

<h3 id="handlerdata-out"><code>HandlerData</code> [out]</h3>

<p>The location of the PC. If this parameter is 0, the PC is in the prologue, epilogue, or a null frame region of the function. If this parameter is 1, the PC is in the body of the function.</p>

<p>This parameter is not present on x64.</p>

<h3 id="establisherframe-out"><code>EstablisherFrame</code> [out]</h3>

<p>A pointer to a <strong>FRAME_POINTERS</strong> structure that receives the establisher frame pointer value. The real frame pointer is defined only if <em>InFunction</em> is <code>1</code>.</p>

<p>This parameter is of type <strong>PULONG64</strong> on x64.</p>

<h3 id="contextpointers-in-out-optional"><code>ContextPointers</code> [in, out, optional]</h3>

<p>An optional pointer to a context pointers structure.</p>

<h2 id="return-value">Return value</h2>

<p>This function returns a pointer to an <strong>EXCEPTION_ROUTINE</strong> callback function.</p>

<h2 id="remarks">Remarks</h2>

<p>The complete list of epilogue markers for x64 is as follows:</p>

<ul>
<li>ret</li>
<li>ret <em>n</em></li>
<li>rep ret</li>
<li>jmp <em>imm8</em> | <em>imm32</em> where the target is outside the function being unwound</li>
<li>jmp qword ptr <em>imm32</em></li>
<li>rex.w jmp <em>reg</em></li>
</ul>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/ns-winnt-arm64_nt_context">CONTEXT</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/ns-winnt-exception_record">EXCEPTION_RECORD</a></p>

<p><a href="rtllookupfunctionentry" title="NTSYSAPI PRUNTIME_FUNCTION RtlLookupFunctionEntry(&#10;  [in]  DWORD64               ControlPc,&#10;  [out] PDWORD64              ImageBase,&#10;  [out] PUNWIND_HISTORY_TABLE HistoryTable&#10;);">RtlLookupFunctionEntry</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/trusted-execution/enclaves-available-in-vertdll">Vertdll APIs available in VBS enclaves</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winnt/nf-winnt-rtlvirtualunwind">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winnt/nf-winnt-rtlvirtualunwind.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
