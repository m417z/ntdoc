<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_MOUNTMGR_QUERY_POINTS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_MOUNTMGR_QUERY_POINTS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_MOUNTMGR_QUERY_POINTS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTIOAPI_H

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">#define IOCTL_MOUNTMGR_QUERY_POINTS                 <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(<a href="mountmgrcontroltype" title="#define MOUNTMGRCONTROLTYPE 0x0000006D // &#x27;m&#x27;">MOUNTMGRCONTROLTYPE</a>, 2, METHOD_BUFFERED, FILE_ANY_ACCESS)
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/e59ac0ae752069c5f8a694b237bca78d3ce05e6b/phnt/include/ntioapi.h#L3361">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// mountmgr.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x006d, 0x002, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_MOUNTMGR_QUERY_POINTS 0x006D0008</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mountmgr/ni-mountmgr-ioctl_mountmgr_query_points">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This IOCTL is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/mountmgr/ni-mountmgr-ioctl_mountmgr_query_points">documented in Windows Driver Kit</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_mountmgr_query_points.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-mountmgr-ioctl_mountmgr_query_points)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>This IOCTL returns triples that consist of a persistent symbolic link name for the volume (that is, a mount point), a unique ID for the volume, and a nonpersistent device name (such as &quot;\Device\HarddiskVolume1&quot;) for the volume. The input to this IOCTL is a <strong><a href="mountmgr_mount_point" title="typedef struct _MOUNTMGR_MOUNT_POINT&#10;{&#10;    ULONG SymbolicLinkNameOffset;&#10;    USHORT SymbolicLinkNameLength;&#10;    USHORT Reserved1;&#10;    ULONG UniqueIdOffset;&#10;    USHORT UniqueIdLength;&#10;    USHORT Reserved2;&#10;    ULONG DeviceNameOffset;&#10;    USHORT DeviceNameLength;&#10;    USHORT Reserved3;&#10;} MOUNTMGR_MOUNT_POINT, *PMOUNTMGR_MOUNT_POINT;">MOUNTMGR_MOUNT_POINT</a></strong> structure that contains a single triple.</p>
<p>If the input triple contains a unique ID or a non-persistent device name, the request retrieves all associated mount points (symbolic links), including the volume GUID pathname and the drive letters. However, if the input triple has a symbolic link, but does not specify either the unique ID or the device name, the request only returns a single triple that contains the symbolic link that was provided in the input, together with the unique ID and the device name. The caller must submit another IOCTL with either the unique ID or the device name to retrieve the remaining mount points.</p>
<p>If the input triple is empty, the mount manager returns the entire mounted device list.</p>
<p>The mount manager returns triples that match as much info as is provided by the caller. If the caller submits the unique ID, the mount manager returns all triples with that unique ID. If the caller inputs the volume pathname or a drive letter as the symbolic link name, the mount manager returns only the triple for the symbolic link. There is one entry per symbolic link. If the caller inputs a device pathname, the mount manager returns only the triples for that device pathname. If the caller inputs a unique ID and a symbolic link, again, the mount manager returns only one entry for that symbolic link. A caller would do this to get the device pathname. If the caller inputs no device pathname, unique ID or symbolic link, the mount manager returns all entries/triples.</p>
<h2>Parameters</h2>
<h3>Major code</h3>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mj-device-control">IRP_MJ_DEVICE_CONTROL</a></p>
<h3>Input buffer</h3>
<p>The mount manager client initializes the <strong><a href="mountmgr_mount_point" title="typedef struct _MOUNTMGR_MOUNT_POINT&#10;{&#10;    ULONG SymbolicLinkNameOffset;&#10;    USHORT SymbolicLinkNameLength;&#10;    USHORT Reserved1;&#10;    ULONG UniqueIdOffset;&#10;    USHORT UniqueIdLength;&#10;    USHORT Reserved2;&#10;    ULONG DeviceNameOffset;&#10;    USHORT DeviceNameLength;&#10;    USHORT Reserved3;&#10;} MOUNTMGR_MOUNT_POINT, *PMOUNTMGR_MOUNT_POINT;">MOUNTMGR_MOUNT_POINT</a></strong> structure at the beginning of the buffer at <strong>Irp-&gt;AssociatedIrp.SystemBuffer</strong>. Immediately following this structure, the MM client loads the symbolic link name, the unique ID and the device name, in that order.</p>
<h3>Input buffer length</h3>
<p><strong>Parameters.DeviceIoControl.InputBufferLength</strong> in the I/O stack location of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the size, in bytes, of the input buffer, which must be greater than or equal to <code>sizeof(<a href="mountmgr_mount_point" title="typedef struct _MOUNTMGR_MOUNT_POINT&#10;{&#10;    ULONG SymbolicLinkNameOffset;&#10;    USHORT SymbolicLinkNameLength;&#10;    USHORT Reserved1;&#10;    ULONG UniqueIdOffset;&#10;    USHORT UniqueIdLength;&#10;    USHORT Reserved2;&#10;    ULONG DeviceNameOffset;&#10;    USHORT DeviceNameLength;&#10;    USHORT Reserved3;&#10;} MOUNTMGR_MOUNT_POINT, *PMOUNTMGR_MOUNT_POINT;">MOUNTMGR_MOUNT_POINT</a>)</code>.</p>
<h3>Output buffer</h3>
<p>The mount manager initializes a variable-length structure of type <strong><a href="mountmgr_mount_points" title="_Struct_size_bytes_(Size)&#10;typedef struct _MOUNTMGR_MOUNT_POINTS&#10;{&#10;    ULONG Size;&#10;    ULONG NumberOfMountPoints;&#10;    _Field_size_(NumberOfMountPoints) MOUNTMGR_MOUNT_POINT MountPoints[1];&#10;} MOUNTMGR_MOUNT_POINTS, *PMOUNTMGR_MOUNT_POINTS;">MOUNTMGR_MOUNT_POINTS</a></strong> at the beginning of the buffer at <strong>Irp-&gt;AssociatedIrp.SystemBuffer</strong>. The mount manager inserts the mount points, associated with the indicated volume, at the address pointed to by the <strong>MountPoints[]</strong> member of this structure. Each mount point is represented by a <a href="mountmgr_mount_point" title="typedef struct _MOUNTMGR_MOUNT_POINT&#10;{&#10;    ULONG SymbolicLinkNameOffset;&#10;    USHORT SymbolicLinkNameLength;&#10;    USHORT Reserved1;&#10;    ULONG UniqueIdOffset;&#10;    USHORT UniqueIdLength;&#10;    USHORT Reserved2;&#10;    ULONG DeviceNameOffset;&#10;    USHORT DeviceNameLength;&#10;    USHORT Reserved3;&#10;} MOUNTMGR_MOUNT_POINT, *PMOUNTMGR_MOUNT_POINT;">MOUNTMGR_MOUNT_POINT</a> structure as defined in the <strong>Input</strong> section for this IOCTL.</p>
<h3>Output buffer length</h3>
<p><strong>Parameters.DeviceIoControl.OutputBufferLength</strong> in the I/O stack location of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the size, in bytes, of the output buffer, which must be greater than or equal to <code>sizeof(<a href="mountmgr_mount_points" title="_Struct_size_bytes_(Size)&#10;typedef struct _MOUNTMGR_MOUNT_POINTS&#10;{&#10;    ULONG Size;&#10;    ULONG NumberOfMountPoints;&#10;    _Field_size_(NumberOfMountPoints) MOUNTMGR_MOUNT_POINT MountPoints[1];&#10;} MOUNTMGR_MOUNT_POINTS, *PMOUNTMGR_MOUNT_POINTS;">MOUNTMGR_MOUNT_POINTS</a>)</code>.</p>
<h3>Input/output buffer</h3>
<p>N/A</p>
<h3>Input/output buffer length</h3>
<p>N/A</p>
<h3>Status block</h3>
<p>If the operation is successful, the <strong>Status</strong> field is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>.</p>
<p>If neither the unique ID nor the nonpersistent device name are found in the volumes mounted device list, the <strong>Status</strong> field is set to STATUS_INVALID_PARAMETER.</p>
<p>If <strong>InputBufferLength</strong> is less than <code>sizeof(<a href="mountmgr_mount_point" title="typedef struct _MOUNTMGR_MOUNT_POINT&#10;{&#10;    ULONG SymbolicLinkNameOffset;&#10;    USHORT SymbolicLinkNameLength;&#10;    USHORT Reserved1;&#10;    ULONG UniqueIdOffset;&#10;    USHORT UniqueIdLength;&#10;    USHORT Reserved2;&#10;    ULONG DeviceNameOffset;&#10;    USHORT DeviceNameLength;&#10;    USHORT Reserved3;&#10;} MOUNTMGR_MOUNT_POINT, *PMOUNTMGR_MOUNT_POINT;">MOUNTMGR_MOUNT_POINT</a>)</code>, the <strong>Status</strong> field is set to STATUS_INVALID_PARAMETER.</p>
<p>If <strong>InputBufferLength</strong> is less than the total length of the three input ID strings, the <strong>Status</strong> field is set to STATUS_INVALID_PARAMETER.</p>
<p>If <strong>OutputBufferLength</strong> is less than <code>sizeof(<a href="mountmgr_mount_point" title="typedef struct _MOUNTMGR_MOUNT_POINT&#10;{&#10;    ULONG SymbolicLinkNameOffset;&#10;    USHORT SymbolicLinkNameLength;&#10;    USHORT Reserved1;&#10;    ULONG UniqueIdOffset;&#10;    USHORT UniqueIdLength;&#10;    USHORT Reserved2;&#10;    ULONG DeviceNameOffset;&#10;    USHORT DeviceNameLength;&#10;    USHORT Reserved3;&#10;} MOUNTMGR_MOUNT_POINT, *PMOUNTMGR_MOUNT_POINT;">MOUNTMGR_MOUNT_POINT</a>)</code>, the <strong>Status</strong> field is set to STATUS_INVALID_PARAMETER.</p>
<p>If <strong>OutputBufferLength</strong> is less than <code>sizeof(<a href="mountmgr_mount_points" title="_Struct_size_bytes_(Size)&#10;typedef struct _MOUNTMGR_MOUNT_POINTS&#10;{&#10;    ULONG Size;&#10;    ULONG NumberOfMountPoints;&#10;    _Field_size_(NumberOfMountPoints) MOUNTMGR_MOUNT_POINT MountPoints[1];&#10;} MOUNTMGR_MOUNT_POINTS, *PMOUNTMGR_MOUNT_POINTS;">MOUNTMGR_MOUNT_POINTS</a>)</code> plus the sum of the sizes of the mount point triples, the <strong>Status</strong> field is set to STATUS_BUFFER_OVERFLOW.</p>
<p>If any of the three strings contained within any of the triples is aligned on an odd address (for example, address &amp; 01 != 0), the <strong>Status</strong> field is set to STATUS_INVALID_PARAMETER.</p>
<h2>Remarks</h2>
<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/supporting-mount-manager-requests-in-a-storage-class-driver">Supporting Mount Manager Requests in a Storage Class Driver</a>.</p>
<h2>See also</h2>
<p><strong><a href="mountmgr_mount_points" title="_Struct_size_bytes_(Size)&#10;typedef struct _MOUNTMGR_MOUNT_POINTS&#10;{&#10;    ULONG Size;&#10;    ULONG NumberOfMountPoints;&#10;    _Field_size_(NumberOfMountPoints) MOUNTMGR_MOUNT_POINT MountPoints[1];&#10;} MOUNTMGR_MOUNT_POINTS, *PMOUNTMGR_MOUNT_POINTS;">MOUNTMGR_MOUNT_POINTS</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mountmgr/ni-mountmgr-ioctl_mountmgr_query_points">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/mountmgr/ni-mountmgr-ioctl_mountmgr_query_points.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
