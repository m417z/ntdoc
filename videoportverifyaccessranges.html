<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="VideoPortVerifyAccessRanges - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>VideoPortVerifyAccessRanges - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            VideoPortVerifyAccessRanges - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// video.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortVerifyAccessRanges(
                 PVOID               HwDeviceExtension,
                 <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               NumAccessRanges,
  [in, optional] <a href="video_access_range" title="typedef struct _VIDEO_ACCESS_RANGE {&#10;  PHYSICAL_ADDRESS RangeStart;&#10;  ULONG            RangeLength;&#10;  UCHAR            RangeInIoSpace;&#10;  UCHAR            RangeVisible;&#10;  UCHAR            RangeShareable;&#10;  UCHAR            RangePassive;&#10;} VIDEO_ACCESS_RANGE, *PVIDEO_ACCESS_RANGE;">PVIDEO_ACCESS_RANGE</a> AccessRanges
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nf-video-videoportverifyaccessranges">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/videoportverifyaccessranges.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-video-videoportverifyaccessranges)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="videoportverifyaccessranges-function">VideoPortVerifyAccessRanges function</h1>

<h2 id="description">Description</h2>

<p>The <strong>VideoPortVerifyAccessRanges</strong> function checks the registry for whether another driver has already claimed ownership of the specified bus-relative access ranges and any other hardware resources specified in the <a rel="noopener" target="_blank" href="video_port_config_info">VIDEO_PORT_CONFIG_INFO</a> structure. If not, this function claims the given resources for the caller.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hwdeviceextension"><code>HwDeviceExtension</code></h3>

<p>Pointer to the miniport driver's device extension.</p>

<h3 id="numaccessranges"><code>NumAccessRanges</code></h3>

<p>Specifies the number of elements in the <em>AccessRanges</em> array, or zero.</p>

<h3 id="accessranges-in-optional"><code>AccessRanges</code> [in, optional]</h3>

<p>Pointer to the miniport driver's access ranges array, or <strong>NULL</strong>. Each <a rel="noopener" target="_blank" href="video_access_range">VIDEO_ACCESS_RANGE</a>-type element in this array specifies a bus-relative range of device memory, I/O ports, or register addresses for the adapter.</p>

<h2 id="return-value">Return value</h2>

<p><strong>VideoPortVerifyAccessRanges</strong> returns one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>ERROR_INVALID_PARAMETER</td>
  <td>An error occurred or a conflict was found; that is, another driver has already claimed one or more of the given hardware resources for its device.</td>
</tr>
<tr>
  <td>NO_ERROR</td>
  <td>The given AccessRanges are valid and have been claimed for use by the caller.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Every video miniport driver either must call <strong>VideoPortVerifyAccessRanges</strong>, or use access ranges returned by <a rel="noopener" target="_blank" href="videoportgetaccessranges">VideoPortGetAccessRanges</a> before attempting to access a video adapter during the driver (and system) initialization process.</p>

<p><strong>VideoPortVerifyAccessRanges</strong> can be called only by a miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a> function.</p>

<p>Every video miniport driver must define the bus-relative access ranges for its device, either as statically allocated memory in the driver's header file or code or on the stack. Most miniport drivers set up their video access ranges on the stack, except for those that use PC standard address ranges for video memory, such as VGA-compatible SVGA miniport drivers.</p>

<p>The <em>HwVidFindAdapter</em> function should try to obtain bus-relative access range information by calling <a rel="noopener" target="_blank" href="videoportgetaccessranges">VideoPortGetAccessRanges</a>, or by checking the registry through calls to <a rel="noopener" target="_blank" href="videoportgetdevicedata">VideoPortGetDeviceData</a> or <a rel="noopener" target="_blank" href="videoportgetregistryparameters">VideoPortGetRegistryParameters</a>. If <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a> cannot get this information, the miniport driver should have a set of bus-relative default values for access ranges.</p>

<p>If a miniport driver's access ranges are externally configurable, the installation program sets up access ranges for the adapter in the registry. Such a miniport driver's <em>HwVidFindAdapter</em> function can call <strong><a href="videoportgetregistryparameters" title="VIDEOPORT_API VP_STATUS VideoPortGetRegistryParameters(&#10;       PVOID                          HwDeviceExtension,&#10;  [in] PWSTR                          ParameterName,&#10;       UCHAR                          IsParameterFileName,&#10;       PMINIPORT_GET_REGISTRY_ROUTINE GetRegistryRoutine,&#10;       PVOID                          Context&#10;);">VideoPortGetRegistryParameters</a></strong> with a miniport driver-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_get_registry_routine">HwVidQueryNamedValueCallback</a> function that processes information retrieved from the registry.</p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a> must not pass any access range addresses to <a rel="noopener" target="_blank" href="videoportgetdevicebase">VideoPortGetDeviceBase</a> unless it calls <strong>VideoPortVerifyAccessRanges</strong> or <a rel="noopener" target="_blank" href="videoportgetaccessranges">VideoPortGetAccessRanges</a> first and the respective function returns NO_ERROR.</p>

<p><strong>VideoPortVerifyAccessRanges</strong> can be called again if the initial <em>AccessRanges</em> specification or value in the <a rel="noopener" target="_blank" href="video_port_config_info">VIDEO_PORT_CONFIG_INFO</a>, such as an interrupt vector, causes it to return an ERROR_<em>XXX</em> indicating that another driver has already claimed the resource(s).</p>

<p>If <strong>VideoPortVerifyAccessRanges</strong> returns NO_ERROR, a subsequent call for the same adapter overwrites the miniport driver's claim on resources for that adapter in the registry.</p>

<p>Note that a miniport driver cannot communicate with its video adapter, except by using mapped addresses returned by <a rel="noopener" target="_blank" href="videoportgetdevicebase">VideoPortGetDeviceBase</a> with the <strong>VideoPortRead/Write<em></strong>Xxx</em> functions.</p>

<p>If the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a> function claims bus-relative access ranges and possibly other hardware resources for an adapter but then determines that it does not support the adapter, the miniport driver must relinquish its claims on hardware resources in the registry by calling <strong>VideoPortVerifyAccessRanges</strong> or <a rel="noopener" target="_blank" href="videoportgetaccessranges">VideoPortGetAccessRanges</a> with <em>NumAccessRanges</em> set to zero and <em>AccessRanges</em> set to <strong>NULL</strong>.</p>

<p>To relinquish claims on a subset of claimed access ranges that the miniport driver is no longer using, do the following:</p>

<ol>
<li>Modify the <em>AccessRanges</em> specification for the adapter so that each element describing a range to be released still has <strong>RangeStart</strong> set to the bus-relative base of a claimed range, but <strong>RangeLength</strong> reset to zero.</li>
<li>Call <strong>VideoPortVerifyAccessRanges</strong> with this modified <em>AccessRanges</em> array.</li>
</ol>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_query_device_routine">HwVidQueryDeviceCallback</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_get_registry_routine">HwVidQueryNamedValueCallback</a></p>

<p><a rel="noopener" target="_blank" href="video_access_range">VIDEO_ACCESS_RANGE</a></p>

<p><a rel="noopener" target="_blank" href="video_port_config_info">VIDEO_PORT_CONFIG_INFO</a></p>

<p><a rel="noopener" target="_blank" href="videoportgetaccessranges">VideoPortGetAccessRanges</a></p>

<p><a rel="noopener" target="_blank" href="videoportgetdevicebase">VideoPortGetDeviceBase</a></p>

<p><a rel="noopener" target="_blank" href="videoportgetdevicedata">VideoPortGetDeviceData</a></p>

<p><a rel="noopener" target="_blank" href="videoportgetregistryparameters">VideoPortGetRegistryParameters</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nf-video-videoportverifyaccessranges">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/video/nf-video-videoportverifyaccessranges.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
