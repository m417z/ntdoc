<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ObReferenceObjectByHandle - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ObReferenceObjectByHandle - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ObReferenceObjectByHandle - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ObReferenceObjectByHandle(
  [in]            HANDLE                     Handle,
  [in]            ACCESS_MASK                DesiredAccess,
  [in, optional]  POBJECT_TYPE               ObjectType,
  [in]            KPROCESSOR_MODE            AccessMode,
  [out]           PVOID                      *Object,
  [out, optional] POBJECT_HANDLE_INFORMATION HandleInformation
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obreferenceobjectbyhandle">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/obreferenceobjectbyhandle.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-obreferenceobjectbyhandle)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="obreferenceobjectbyhandle-function">ObReferenceObjectByHandle function</h1>

<h2 id="description">Description</h2>

<p>The <strong>ObReferenceObjectByHandle</strong> routine provides access validation on the object handle, and, if access can be granted, returns the corresponding pointer to the object's body.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="handle-in"><code>Handle</code> [in]</h3>

<p>Specifies an open handle for an object.</p>

<h3 id="desiredaccess-in"><code>DesiredAccess</code> [in]</h3>

<p>Specifies the requested types of access to the object. The interpretation of this field is dependent on the object type. Do not use any generic access rights. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a>.</p>

<h3 id="objecttype-in-optional"><code>ObjectType</code> [in, optional]</h3>

<p>Pointer to the object type. <em>ObjectType</em> can be <strong>*ExEventObjectType</strong>, <strong>*ExSemaphoreObjectType</strong>, <strong>*IoFileObjectType</strong>, <strong>*PsProcessType</strong>, <strong>*PsThreadType</strong>, <strong>*SeTokenObjectType</strong>, <strong>*TmEnlistmentObjectType</strong>, <strong>*TmResourceManagerObjectType</strong>, <strong>*TmTransactionManagerObjectType</strong>, or <strong>*TmTransactionObjectType</strong>.</p>

<p>If <em>ObjectType</em> is not <strong>NULL</strong>, the operating system verifies that the supplied object type matches the object type of the object that <em>Handle</em> specifies.</p>

<h3 id="accessmode-in"><code>AccessMode</code> [in]</h3>

<p>Specifies the access mode to use for the access check. It must be either <strong>UserMode</strong> or <strong>KernelMode</strong>. Drivers should always specify <strong>UserMode</strong> for handles they receive from user address space.</p>

<h3 id="object-out"><code>Object</code> [out]</h3>

<p>Pointer to a variable that receives a pointer to the object's body. The following table contains the pointer types.</p>

<table>
<thead>
<tr>
  <th>ObjectType parameter</th>
  <th>Object pointer type</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>*ExEventObjectType</strong></td>
  <td>PKEVENT</td>
</tr>
<tr>
  <td><strong>*ExSemaphoreObjectType</strong></td>
  <td>PKSEMAPHORE</td>
</tr>
<tr>
  <td><strong>*IoFileObjectType</strong></td>
  <td><a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a></td>
</tr>
<tr>
  <td><strong>*PsProcessType</strong></td>
  <td>PEPROCESS or PKPROCESS</td>
</tr>
<tr>
  <td><strong>*PsThreadType</strong></td>
  <td>PETHREAD or PKTHREAD</td>
</tr>
<tr>
  <td><strong>*SeTokenObjectType</strong></td>
  <td>PACCESS_TOKEN</td>
</tr>
<tr>
  <td><strong>*TmEnlistmentObjectType</strong></td>
  <td>PKENLISTMENT</td>
</tr>
<tr>
  <td><strong>*TmResourceManagerObjectType</strong></td>
  <td>PKRESOURCEMANAGER</td>
</tr>
<tr>
  <td><strong>*TmTransactionManagerObjectType</strong></td>
  <td>PKTM</td>
</tr>
<tr>
  <td><strong>*TmTransactionObjectType</strong></td>
  <td>PKTRANSACTION</td>
</tr>
</tbody>
</table>

<p>The structures that the pointer types reference are opaque, and drivers cannot access the structure members. Because the structures are opaque, PEPROCESS is equivalent to PKPROCESS, and PETHREAD is equivalent to PKTHREAD.</p>

<h3 id="handleinformation-out-optional"><code>HandleInformation</code> [out, optional]</h3>

<p>Drivers set this to <strong>NULL</strong>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ObReferenceObjectByHandle</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful. Possible return values include the following error codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_OBJECT_TYPE_MISMATCH</strong></td>
  <td>The <em>ObjectType</em> parameter specifies the wrong object type for the object that is identified by the <em>Handle</em> parameter.</td>
</tr>
<tr>
  <td><strong>STATUS_ACCESS_DENIED</strong></td>
  <td>The caller cannot be granted the requested access rights to the object.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_HANDLE</strong></td>
  <td>The <em>Handle</em> parameter is not a valid object handle.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A pointer to the object body is retrieved from the object table entry and returned to the caller by means of the <em>Object</em> parameter.</p>

<p>If <em>AccessMode</em> is <strong>UserMode</strong>, the requested access is compared to the granted access for the object. If <em>AccessMode</em> is <strong>KernelMode</strong>, the handle should originate in the kernel address space.</p>

<p>Starting with Windows 7, if <em>AccessMode</em> is <strong>KernelMode</strong> and handle is received from user address space, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/driver-verifier">Driver Verifier</a> issues bugcheck C4, subcode F6.</p>

<p>If the call succeeds, a pointer to the object body is returned to the caller and the pointer reference count is incremented. Incrementing this count prevents the object from being deleted while the pointer is being referenced. The caller must decrement the reference count with <a href="obdereferenceobject" title="void ObDereferenceObject(&#10;  [in] a&#10;);">ObDereferenceObject</a> as soon as it is done with the object.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a></p>

<p><a href="obdereferenceobject" title="void ObDereferenceObject(&#10;  [in] a&#10;);">ObDereferenceObject</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obfreferenceobject">ObReferenceObject</a></p>

<p><a href="obreferenceobjectbypointer" title="NTSTATUS ObReferenceObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode&#10;);">ObReferenceObjectByPointer</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obreferenceobjectbyhandle">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-obreferenceobjectbyhandle.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
