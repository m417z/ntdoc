<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfDmaTransactionSetDeviceAddressOffset - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfDmaTransactionSetDeviceAddressOffset - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfDmaTransactionSetDeviceAddressOffset - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfdmatransaction.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID WdfDmaTransactionSetDeviceAddressOffset(
  [in] WDFDMATRANSACTION DmaTransaction,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>             Offset
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdmatransaction/nf-wdfdmatransaction-wdfdmatransactionsetdeviceaddressoffset">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfdmatransactionsetdeviceaddressoffset.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfdmatransaction-wdfdmatransactionsetdeviceaddressoffset)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="wdfdmatransactionsetdeviceaddressoffset-function">WdfDmaTransactionSetDeviceAddressOffset function</h1>

<h2 id="description">Description</h2>

<p>[Applies to KMDF only]</p>

<p>The
<strong>WdfDmaTransactionSetDeviceAddressOffset</strong> method specifies the offset of the register that the system DMA controller will access when performing the DMA operation.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="dmatransaction-in"><code>DmaTransaction</code> [in]</h3>

<p>A handle to a DMA transaction object that specifies the transaction to modify.</p>

<h3 id="offset-in"><code>Offset</code> [in]</h3>

<p>The offset of the register, from the <strong>DeviceAddress</strong> specified in <a href="wdf_dma_system_profile_config" title="typedef struct _WDF_DMA_SYSTEM_PROFILE_CONFIG {&#10;  ULONG                           Size;&#10;  BOOLEAN                         DemandMode;&#10;  BOOLEAN                         LoopedTransfer;&#10;  DMA_WIDTH                       DmaWidth;&#10;  PHYSICAL_ADDRESS                DeviceAddress;&#10;  PCM_PARTIAL_RESOURCE_DESCRIPTOR DmaDescriptor;&#10;} WDF_DMA_SYSTEM_PROFILE_CONFIG, *PWDF_DMA_SYSTEM_PROFILE_CONFIG;">WDF_DMA_SYSTEM_PROFILE_CONFIG</a>, to or from which DMA should be performed.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>WdfDmaTransactionSetDeviceAddressOffset</strong> must be used with a DMA enabler that specifies a system-mode DMA profile.</p>

<p>Framework-based drivers call <strong>WdfDmaTransactionSetDeviceAddressOffset</strong> after initializing a DMA transaction and before executing it.</p>

<p>A driver can use this method to access multiple registers within a device's register file.</p>

<p>For example, a driver might use DMA to access separate read and write registers in a device's register file.</p>

<p>To do so, the driver specifies the base address of the device's register file when configuring the enabler, and then sets the offset of the read or write register as necessary before executing the transaction.</p>

<p>If your driver calls this method on an operating system earlier than Windows 8, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-kmdf-verifier">the framework's verifier</a> reports an error.</p>

<h4 id="examples">Examples</h4>

<p>The following code example initializes a DMA transaction. It then sets the offset of the register that the system DMA controller will access, provides a transfer completion callback routine, and executes the DMA transaction.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="wdfdmatransactioninitialize" title="NTSTATUS WdfDmaTransactionInitialize(&#10;  [in] WDFDMATRANSACTION   DmaTransaction,&#10;  [in] PFN_WDF_PROGRAM_DMA EvtProgramDmaFunction,&#10;  [in] WDF_DMA_DIRECTION   DmaDirection,&#10;  [in] PMDL                Mdl,&#10;  [in] PVOID               VirtualAddress,&#10;  [in] size_t              Length&#10;);">WdfDmaTransactionInitialize</a></span><span class="p">(</span>
<span class="w">                                     </span><span class="n">RequestContext</span><span class="o">-&gt;</span><span class="n">DmaTransaction</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">EvtProgramDma</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">direction</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">mdl</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">startingVa</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">length</span>
<span class="w">                                     </span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n"><a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a></span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">Complete</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">WdfDmaTransactionSetDeviceAddressOffset</span><span class="p">(</span>
<span class="w">                                        </span><span class="n">RequestContext</span><span class="o">-&gt;</span><span class="n">DmaTransaction</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">READ_DATA_REGISTER_OFFSET</span>
<span class="w">                                        </span><span class="p">);</span>

<span class="n"><a href="wdfdmatransactionsettransfercompletecallback" title="VOID WdfDmaTransactionSetTransferCompleteCallback(&#10;  [in]           WDFDMATRANSACTION                             DmaTransaction,&#10;  [in, optional] PFN_WDF_DMA_TRANSACTION_DMA_TRANSFER_COMPLETE DmaCompletionRoutine,&#10;  [in, optional] PVOID                                         DmaCompletionContext&#10;);">WdfDmaTransactionSetTransferCompleteCallback</a></span><span class="p">(</span>
<span class="w">                                             </span><span class="n">RequestContext</span><span class="o">-&gt;</span><span class="n">DmaTransaction</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">EvtDmaTransactionDmaTransferComplete</span><span class="p">,</span>
<span class="w">                                             </span><span class="n">RequestContext</span>
<span class="w">                                             </span><span class="p">);</span>

<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="wdfdmatransactionexecute" title="NTSTATUS WdfDmaTransactionExecute(&#10;  [in]           WDFDMATRANSACTION DmaTransaction,&#10;  [in, optional] WDFCONTEXT        Context&#10;);">WdfDmaTransactionExecute</a></span><span class="p">(</span>
<span class="w">                                  </span><span class="n">RequestContext</span><span class="o">-&gt;</span><span class="n">DmaTransaction</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">RequestContext</span><span class="w"> </span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n"><a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a></span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">Complete</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="nl">Complete</span><span class="p">:</span>

<span class="n"><a href="wdfdmatransactionrelease" title="NTSTATUS WdfDmaTransactionRelease(&#10;  [in] WDFDMATRANSACTION DmaTransaction&#10;);">WdfDmaTransactionRelease</a></span><span class="p">(</span>
<span class="w">                         </span><span class="n">RequestContext</span><span class="o">-&gt;</span><span class="n">DmaTransaction</span>
<span class="w">                         </span><span class="p">);</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a href="wdf_dma_system_profile_config" title="typedef struct _WDF_DMA_SYSTEM_PROFILE_CONFIG {&#10;  ULONG                           Size;&#10;  BOOLEAN                         DemandMode;&#10;  BOOLEAN                         LoopedTransfer;&#10;  DMA_WIDTH                       DmaWidth;&#10;  PHYSICAL_ADDRESS                DeviceAddress;&#10;  PCM_PARTIAL_RESOURCE_DESCRIPTOR DmaDescriptor;&#10;} WDF_DMA_SYSTEM_PROFILE_CONFIG, *PWDF_DMA_SYSTEM_PROFILE_CONFIG;">WDF_DMA_SYSTEM_PROFILE_CONFIG</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdmatransaction/nf-wdfdmatransaction-wdfdmatransactionsetdeviceaddressoffset">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfdmatransaction/nf-wdfdmatransaction-wdfdmatransactionsetdeviceaddressoffset.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
