<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DDDICB_LOCKFLAGS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DDDICB_LOCKFLAGS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DDDICB_LOCKFLAGS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dukmdt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _D3DDDICB_LOCKFLAGS {
  union {
    struct {
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> ReadOnly : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> WriteOnly : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> DonotWait : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> IgnoreSync : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> LockEntire : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> DonotEvict : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> AcquireAperture : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Discard : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> NoExistingReference : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> UseAlternateVA : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> IgnoreReadSync : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Reserved : 21;
    };
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> Value;
  };
} D3DDDICB_LOCKFLAGS;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddicb_lockflags">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dddicb_lockflags.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dukmdt-_d3dddicb_lockflags)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_d3dddicb_lockflags-structure">_D3DDDICB_LOCKFLAGS structure</h1>

<h2 id="description">Description</h2>

<p>The D3DDDICB_LOCKFLAGS structure identifies how to lock an allocation.</p>

<h2 id="members">Members</h2>

<h3 id="readonly"><code>ReadOnly</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the locked allocation can only be read from. Setting this member is equivalent to setting the first bit of the 32-bit <strong>Value</strong> member (0x00000001).</p>

<h3 id="writeonly"><code>WriteOnly</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the locked allocation can only be written to. Setting this member is equivalent to setting the second bit of the 32-bit <strong>Value</strong> member (0x00000002).</p>

<h3 id="donotwait"><code>DonotWait</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the video memory manager should wait to lock the allocation. If this member is set, the memory manager fails the call to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a> with D3DERR_WASSTILLDRAWING if the graphics hardware is using the allocation.</p>

<p>Setting this member is equivalent to setting the third bit of the 32-bit <strong>Value</strong> member (0x00000004).</p>

<h3 id="ignoresync"><code>IgnoreSync</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the video memory manager should check whether the graphics hardware is using the allocation. If this member is set, the memory manager should not check.</p>

<p><strong>IgnoreSync</strong> can be set only with an allocation that can be placed in an aperture segment. It cannot be set with a swizzled allocation, or with a cached allocation when cache coherency is not supported by the graphics adapter.</p>

<p>Setting this member is equivalent to setting the fourth bit of the 32-bit <strong>Value</strong> member (0x00000008).</p>

<h3 id="lockentire"><code>LockEntire</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the entire allocation region is locked rather than just a subregion.</p>

<p>Setting this member is equivalent to setting the fifth bit of the 32-bit <strong>Value</strong> member (0x00000010).</p>

<h3 id="donotevict"><code>DonotEvict</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the video memory manager should evict the allocation so that the lock can succeed. If this member is set, the memory manager should not evict the allocation. If the allocation must be evicted to handle the lock request, the memory manager fails the call to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a> with D3DERR_NOTAVAILABLE. Eviction might be necessary when all of the deswizzling apertures are exhausted.</p>

<p>Setting this member is equivalent to setting the sixth bit of the 32-bit <strong>Value</strong> member (0x00000020).</p>

<h3 id="acquireaperture"><code>AcquireAperture</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the video memory manager should call the display miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_acquireswizzlingrange">DxgkDdiAcquireSwizzlingRange</a> function to set up an unswizzling aperture for the allocation.</p>

<p>An allocation that was locked without setting <strong>AcquireAperture</strong> cannot be locked again with <strong>AcquireAperture</strong> set.</p>

<p><strong>AcquireAperture</strong> cannot be set if the allocation can be located only in an aperture segment.</p>

<p>Setting this member is equivalent to setting the seventh bit of the 32-bit <strong>Value</strong> member (0x00000040).</p>

<h3 id="discard"><code>Discard</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the video memory manager can rename or multiple-buffer the allocation. For more information about renaming allocations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/requesting-to-rename-an-allocation">Requesting to Rename an Allocation</a>.</p>

<p><strong>Discard</strong> is ignored for pinned, primary, or shared allocations.</p>

<p>Setting this member is equivalent to setting the eighth bit of the 32-bit <strong>Value</strong> member (0x00000080).</p>

<h3 id="noexistingreference"><code>NoExistingReference</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the user-mode display driver currently does not have queued in its command buffer a reference to any instance of the allocation that is being locked. The driver should use the <strong>NoExistingReference</strong> member after the video memory manager fails the lock request by using only the <strong>Discard</strong> flag and after the driver flushes its current command buffer to the kernel. The driver should use <strong>NoExistingReference</strong> in combination with <strong>Discard</strong>.</p>

<p>Setting this member is equivalent to setting the ninth bit of the 32-bit <strong>Value</strong> member (0x00000100).</p>

<h3 id="usealternateva"><code>UseAlternateVA</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the display miniport driver can lock an allocation at a different physical address than the allocation's current segment location or with a different memory footprint than was previously allocated. When this flag is specified, the display miniport driver can update the base address and size of the physical address range that the allocation is CPU accessible through (by updating the <strong>RangeSize</strong> and <strong>CPUTranslatedAddress</strong> members of the <a href="dxgkarg_acquireswizzlingrange" title="typedef struct _DXGKARG_ACQUIRESWIZZLINGRANGE {&#10;  [in]     HANDLE           hAllocation;&#10;  [in]     UINT             PrivateDriverData;&#10;  [in]     UINT             RangeId;&#10;  [in]     UINT             SegmentId;&#10;  [in]     SIZE_T           RangeSize;&#10;  [in/out] PHYSICAL_ADDRESS CPUTranslatedAddress;&#10;} DXGKARG_ACQUIRESWIZZLINGRANGE;">DXGKARG_ACQUIRESWIZZLINGRANGE</a> structure in a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_acquireswizzlingrange">DxgkDdiAcquireSwizzlingRange</a> function). When this flag is specified, the video memory manager attempts to allocate a new virtual address to handle the lock request rather than use the allocation backing store virtual address. However, if the video memory manager cannot allocate the new virtual address, the lock request fails.</p>

<p>This flag is also used to lock swizzled or tiled allocations that are currently located in a non-AGP aperture segment. In this type of lock, the video memory manager maps the alternate virtual address to a physical address range that can be unswizzled or untiled on the fly and then redirects the memory access to the system memory pages.</p>

<p>The video memory manager creates the alternate virtual address when the allocation is first locked with <strong>UseAlternateVA</strong> and releases the virtual address in one of the following scenarios:</p>

<ul>
<li>The allocation is not accessible to the CPU, and the swizzling range is released for reuse by another allocation.</li>
<li>The allocation is not accessible to the CPU and is being evicted.</li>
<li>The allocation is being destroyed.</li>
<li>The allocation is being paged in after it was evicted while under lock.</li>
</ul>

<p>Be aware that <strong>UseAlternateVA</strong> can only be used on the primary allocation if the primary allocation was created by specifying the <strong>UseAlternateVA</strong> bit-field flag in the <strong>Flags</strong> member of the <a href="dxgk_allocationinfo" title="typedef struct _DXGK_ALLOCATIONINFO {&#10;  VOID                       *pPrivateDriverData;&#10;  UINT                       PrivateDriverDataSize;&#10;  union {&#10;    UINT Alignment;&#10;    struct {&#10;      UINT16 MinimumPageSize;&#10;      UINT16 RecommendedPageSize;&#10;    };&#10;  };&#10;  SIZE_T                     Size;&#10;  SIZE_T                     PitchAlignedSize;&#10;  DXGK_SEGMENTBANKPREFERENCE HintedBank;&#10;  DXGK_SEGMENTPREFERENCE     PreferredSegment;&#10;  union {&#10;    UINT SupportedReadSegmentSet;&#10;    UINT MmuSet;&#10;  };&#10;  UINT                       SupportedWriteSegmentSet;&#10;  UINT                       EvictionSegmentSet;&#10;...">DXGK_ALLOCATIONINFO</a> structure in a call to the display miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createallocation">DxgkDdiCreateAllocation</a> function. A primary allocation that is created in such a way can only be locked with the <strong>UseAlternateVA</strong> flag.</p>

<p><strong>UseAlternateVA</strong> cannot be used on a shared allocation.</p>

<p>An allocation that was locked with <strong>UseAlternateVA</strong> set cannot be locked again.</p>

<p><strong>Note</strong> If the user-mode display driver has set <strong>UseAlternateVA</strong> in the <strong>Flags</strong> member of the <strong>D3DDDICB_LOCKFLAGS</strong> structure during a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a> function, the display miniport driver should not call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkcb_exclude_adapter_access">DxgkCbExcludeAdapterAccess</a> function.</p>

<p>Setting this member is equivalent to setting the tenth bit of the 32-bit <strong>Value</strong> member (0x00000200).</p>

<h3 id="ignorereadsync"><code>IgnoreReadSync</code></h3>

<p>A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the video memory manager should wait only for pending Graphics Processing Unit (GPU) write operations to the allocation to complete. If this member is set, the memory manager is not required to wait for GPU read operations to complete. That is, as soon as the last GPU write operation completes, the lock can return even though the GPU might still be reading from the allocation.</p>

<p><strong>IgnoreReadSync</strong> can be set only with an allocation that can be placed in an aperture segment. It cannot be set with a swizzled allocation, or with a cached allocation when cache coherency is not supported by the graphics adapter.</p>

<p>Setting this member is equivalent to setting the eleventh bit of the 32-bit <strong>Value</strong> member (0x00000400).</p>

<h3 id="reserved"><code>Reserved</code></h3>

<p>This member is reserved and should be set to zero. Setting this member to zero is equivalent to setting the remaining 21 bits (0xFFFFF800) of the 32-bit <strong>Value</strong> member to zeros.</p>

<h3 id="value"><code>Value</code></h3>

<p>A member in the union that is contained in D3DDDICB_LOCKFLAGS that can hold one 32-bit value that identifies how to lock an allocation.</p>

<h2 id="remarks">Remarks</h2>

<p>When you use a D3DDDICB_LOCKFLAGS structure to specify how to lock an allocation, you must adhere to the following rules:</p>

<ul>
<li>Simultaneously specifying the <strong>ReadOnly</strong> and <strong>WriteOnly</strong> members is invalid.</li>
<li>The <strong>IgnoreSync</strong> member has no effect if specified with the <strong>Discard</strong> member.</li>
<li>The <strong>DonotWait</strong> member has no effect if specified with the <strong>Discard</strong> member.</li>
<li>Simultaneously specifying the <strong>IgnoreSync</strong> and <strong>AcquireAperture</strong> members is invalid.</li>
<li>Because specifying the <strong>UseAlternateVA</strong> member indicates that an aperture is acquired, the <strong>AcquireAperture</strong> member must also be set.</li>
<li>Retired or offered allocations cannot be locked. See also <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/requesting-to-rename-an-allocation">Requesting to Rename an Allocation</a>.</li>
<li>An allocation can be locked only if it was created with the <strong>CpuVisible</strong> member set in the <a href="dxgk_allocationinfoflags" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS {&#10;  union {&#10;    struct {&#10;      UINT CpuVisible : 1;&#10;      UINT PermanentSysMem : 1;&#10;      UINT Cached : 1;&#10;      UINT Protected : 1;&#10;      UINT ExistingSysMem : 1;&#10;      UINT ExistingKernelSysMem : 1;&#10;      UINT FromEndOfSegment : 1;&#10;      UINT Swizzled : 1;&#10;      UINT Overlay : 1;&#10;      UINT Capture : 1;&#10;      UINT UseAlternateVA : 1;&#10;      UINT SynchronousPaging : 1;&#10;      UINT LinkMirrored : 1;&#10;      UINT LinkInstanced : 1;&#10;      UINT HistoryBuffer : 1;&#10;      UINT AccessedPhysically : 1;&#10;      UINT ExplicitResidencyNotification : 1;&#10;...">DXGK_ALLOCATIONINFOFLAGS</a> structure.</li>
<li>Only the owner (creator) of a shared allocation can lock it, unless it's a GDI non-managed primary allocation.</li>
<li>An allocation that is locked with a swizzled range must be unlocked before it can be locked again.</li>
</ul>

<h2 id="see-also">See also</h2>

<p><a href="d3dddicb_lock" title="typedef struct _D3DDDICB_LOCK {&#10;  [in/out] D3DKMT_HANDLE          hAllocation;&#10;  [in]     UINT                   PrivateDriverData;&#10;  [in]     UINT                   NumPages;&#10;  [in]     const UINT             *pPages;&#10;  [out]    VOID                   *pData;&#10;  [in]     D3DDDICB_LOCKFLAGS     Flags;&#10;           D3DGPU_VIRTUAL_ADDRESS GpuVirtualAddress;&#10;} D3DDDICB_LOCK;">D3DDDICB_LOCK</a></p>

<p><a href="dxgk_allocationinfoflags" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS {&#10;  union {&#10;    struct {&#10;      UINT CpuVisible : 1;&#10;      UINT PermanentSysMem : 1;&#10;      UINT Cached : 1;&#10;      UINT Protected : 1;&#10;      UINT ExistingSysMem : 1;&#10;      UINT ExistingKernelSysMem : 1;&#10;      UINT FromEndOfSegment : 1;&#10;      UINT Swizzled : 1;&#10;      UINT Overlay : 1;&#10;      UINT Capture : 1;&#10;      UINT UseAlternateVA : 1;&#10;      UINT SynchronousPaging : 1;&#10;      UINT LinkMirrored : 1;&#10;      UINT LinkInstanced : 1;&#10;      UINT HistoryBuffer : 1;&#10;      UINT AccessedPhysically : 1;&#10;      UINT ExplicitResidencyNotification : 1;&#10;...">DXGK_ALLOCATIONINFOFLAGS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_acquireswizzlingrange">DxgkDdiAcquireSwizzlingRange</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ns-d3dukmdt-_d3dddicb_lockflags">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dukmdt/ns-d3dukmdt-_d3dddicb_lockflags.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
