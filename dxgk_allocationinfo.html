<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGK_ALLOCATIONINFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGK_ALLOCATIONINFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGK_ALLOCATIONINFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _DXGK_ALLOCATIONINFO {
  VOID                       *pPrivateDriverData;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                       PrivateDriverDataSize;
  union {
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> Alignment;
    struct {
      <a href="uint16" title="typedef unsigned short UINT16;">UINT16</a> MinimumPageSize;
      <a href="uint16" title="typedef unsigned short UINT16;">UINT16</a> RecommendedPageSize;
    };
  };
  <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                     Size;
  <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                     PitchAlignedSize;
  <a href="dxgk_segmentbankpreference" title="typedef struct _DXGK_SEGMENTBANKPREFERENCE {&#10;  union {&#10;    struct {&#10;      UINT Bank0 : 7;&#10;      UINT Direction0 : 1;&#10;      UINT Bank1 : 7;&#10;      UINT Direction1 : 1;&#10;      UINT Bank2 : 7;&#10;      UINT Direction2 : 1;&#10;      UINT Bank3 : 7;&#10;      UINT Direction3 : 1;&#10;    };&#10;    [out] UINT Value;&#10;  };&#10;} DXGK_SEGMENTBANKPREFERENCE;">DXGK_SEGMENTBANKPREFERENCE</a> HintedBank;
  DXGK_SEGMENTPREFERENCE     PreferredSegment;
  union {
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> SupportedReadSegmentSet;
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> MmuSet;
  };
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                       SupportedWriteSegmentSet;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                       EvictionSegmentSet;
  union {
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> MaximumRenamingListLength;
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> PhysicalAdapterIndex;
  };
  HANDLE                     hAllocation;
  union {
    <a href="dxgk_allocationinfoflags" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS {&#10;  union {&#10;    struct {&#10;      UINT CpuVisible : 1;&#10;      UINT PermanentSysMem : 1;&#10;      UINT Cached : 1;&#10;      UINT Protected : 1;&#10;      UINT ExistingSysMem : 1;&#10;      UINT ExistingKernelSysMem : 1;&#10;      UINT FromEndOfSegment : 1;&#10;      UINT Swizzled : 1;&#10;      UINT Overlay : 1;&#10;      UINT Capture : 1;&#10;      UINT UseAlternateVA : 1;&#10;      UINT SynchronousPaging : 1;&#10;      UINT LinkMirrored : 1;&#10;      UINT LinkInstanced : 1;&#10;      UINT HistoryBuffer : 1;&#10;      UINT AccessedPhysically : 1;&#10;      UINT ExplicitResidencyNotification : 1;&#10;...">DXGK_ALLOCATIONINFOFLAGS</a>         Flags;
    <a href="dxgk_allocationinfoflags_wddm2_0" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS_WDDM2_0 {&#10;  union {&#10;    struct {&#10;      UINT CpuVisible : 1;&#10;      UINT PermanentSysMem : 1;&#10;      UINT Cached : 1;&#10;      UINT Protected : 1;&#10;      UINT ExistingSysMem : 1;&#10;      UINT ExistingKernelSysMem : 1;&#10;      UINT FromEndOfSegment : 1;&#10;      UINT DisableLargePageMapping : 1;&#10;      UINT Overlay : 1;&#10;      UINT Capture : 1;&#10;      UINT CreateInVpr : 1;&#10;      UINT Reserved00 : 1;&#10;      UINT DXGK_ALLOC_RESERVED17 : 1;&#10;      UINT Reserved02 : 1;&#10;      UINT MapApertureCpuVisible : 1;&#10;      UINT Reserved03 : 1;&#10;      UINT HistoryBuffer : 1;&#10;...">DXGK_ALLOCATIONINFOFLAGS_WDDM2_0</a> FlagsWddm2;
  };
  <a href="dxgk_allocationusagehint" title="typedef struct _DXGK_ALLOCATIONUSAGEHINT {&#10;  [out] UINT                      Version;&#10;  [out] DXGK_ALLOCATIONUSAGEINFO1 v1;&#10;} DXGK_ALLOCATIONUSAGEHINT;">DXGK_ALLOCATIONUSAGEHINT</a>   *pAllocationUsageHint;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                       AllocationPriority;
  <a href="dxgk_allocationinfoflags2" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS2 {&#10;  union {&#10;    struct {&#10;      UINT ShareBackingStoreWithKmd : 1;&#10;      UINT NoImplicitSynchronization : 1;&#10;      UINT DisablePartialResidency : 1;&#10;      UINT RestrictedToSingleSegment : 1;&#10;      UINT NotifyEviction : 1;&#10;      UINT NotifyIoMmuUnmap : 1;&#10;#if ...&#10;      UINT Reserved : 26;&#10;#else&#10;      UINT Reserved : 31;&#10;#endif&#10;    };&#10;    UINT Value;&#10;  };&#10;} DXGK_ALLOCATIONINFOFLAGS2;">DXGK_ALLOCATIONINFOFLAGS2</a>  Flags2;
} DXGK_ALLOCATIONINFO;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_allocationinfo">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgk_allocationinfo.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dkmddi-_dxgk_allocationinfo)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgk_allocationinfo-structure">DXGK_ALLOCATIONINFO structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>DXGK_ALLOCATIONINFO</strong> structure describes parameters for creating an allocation.</p>

<h2 id="members">Members</h2>

<h3 id="pprivatedriverdata"><code>pPrivateDriverData</code></h3>

<p>[in] A pointer to a block of private data. This data is for each allocation and is distinct from the <strong>pPrivateDriverData</strong> member in the <a rel="noopener" target="_blank" href="dxgkarg_createallocation"><strong>DXGKARG_CREATEALLOCATION</strong></a> structure. The user-mode display driver (UMD) might pass this data to the kernel-mode display miniport driver (KMD). However, if <em>Dxgkrnl</em> passes this data to describe the shared primary or other lockable surface, the data is passed as the first element of the array in the <strong>pAllocationInfo</strong> member of <strong><a href="dxgkarg_createallocation" title="typedef struct _DXGKARG_CREATEALLOCATION {&#10;  [in]     const VOID                 *pPrivateDriverData;&#10;  [in]     UINT                       PrivateDriverDataSize;&#10;  [in]     UINT                       NumAllocations;&#10;  [in/out] DXGK_ALLOCATIONINFO        *pAllocationInfo;&#10;  [in/out] HANDLE                     hResource;&#10;  [in]     DXGK_CREATEALLOCATIONFLAGS Flags;&#10;} DXGKARG_CREATEALLOCATION;">DXGKARG_CREATEALLOCATION</a></strong>.</p>

<h3 id="privatedriverdatasize"><code>PrivateDriverDataSize</code></h3>

<p>[in] The size, in bytes, of the block of private data in <strong>pPrivateDriverData</strong>.</p>

<h3 id="alignment"><code>Alignment</code></h3>

<p>[out] The required alignment, in bytes, for the allocation.</p>

<h3 id="size"><code>Size</code></h3>

<p>[out] The size, in bytes, that is required for the allocation. The size value is expanded to a multiple of the native host page size (for example, 4 KB on the x86 architecture). The KMD specifies the allocation size to the video memory manager (<em>VidMm</em>).</p>

<h3 id="pitchalignedsize"><code>PitchAlignedSize</code></h3>

<p>[out] The size, in bytes, of the allocation when it is located in a pitch-aligned segment, which is specified by the <strong>PitchAlignment</strong> bit-field flag in the <strong>Flags</strong> member of the <a rel="noopener" target="_blank" href="dxgk_segmentdescriptor"><strong>DXGK_SEGMENTDESCRIPTOR</strong></a> structure for the segment. If the allocation is not supported in a pitch-aligned segment (GPUs don't commonly support this type of segment), the driver should set the value in <strong>PitchAlignedSize</strong> to zero. If the driver specifies a nonzero value in <strong>PitchAlignedSize</strong>, the value must be greater than or equal to the value in the <strong>Size</strong> member.</p>

<h3 id="hintedbank"><code>HintedBank</code></h3>

<p>[out] A <a rel="noopener" target="_blank" href="dxgk_segmentbankpreference"><strong>DXGK_SEGMENTBANKPREFERENCE</strong></a> structure that specifies KMD's bank ordering preferences that <em>VidMm</em> use to page-in the allocation. If this member is specified, <em>VidMm</em> uses banking information about the most preferred segment, which is specified by the <strong>SegmentId0</strong> member of the <a rel="noopener" target="_blank" href="d3dddi_segmentpreference"><strong>DXGK_SEGMENTPREFERENCE</strong></a> structure that the <strong>PreferredSegment</strong> member specifies.</p>

<h3 id="preferredsegment"><code>PreferredSegment</code></h3>

<p>[out] A <a rel="noopener" target="_blank" href="d3dddi_segmentpreference"><strong>DXGK_SEGMENTPREFERENCE</strong></a> structure that indicates preferred segments identifiers that the KMD requests that <em>VidMm</em> use to page-in the allocation.</p>

<h3 id="supportedreadsegmentset"><code>SupportedReadSegmentSet</code></h3>

<p>[out] Segment identifiers that the KMD can set in the <strong>PreferredSegment</strong> member for read operations. The segments that these identifiers indicate are segments that the KMD requests <em>VidMm</em> use to page-in the allocation for read operations, regardless of performance. Setting bit 0 indicates that the first segment is supported, setting bit 1 indicates that the second segment is supported, and so on.</p>

<p>The KMD can set preferences only for segments that are supported for read operations. <em>VidMm</em> asserts if the driver attempts to set preferences for unsupported segments in the <strong>PreferredSegment</strong> member.</p>

<h3 id="supportedwritesegmentset"><code>SupportedWriteSegmentSet</code></h3>

<p>[out] Segment identifiers that the KMD can set in the <strong>PreferredSegment</strong> member for write operations. The segments that these identifiers indicate are segments that the KMD requests that <em>VidMm</em> use to page-in the allocation for write operations, regardless of performance. Setting bit 0 indicates that the first segment is supported, setting bit 1 indicates that the second segment is supported, and so on.</p>

<p>The KMD can set preferences only for segments that are supported for write operations. <em>VidMm</em> asserts if the driver attempts to set preferences for unsupported segments in the <strong>PreferredSegment</strong> member.</p>

<h3 id="evictionsegmentset"><code>EvictionSegmentSet</code></h3>

<p>[out] Identifiers of segments that can be used for eviction. Setting bit 0 indicates that the first segment can be used for eviction, setting bit 1 indicates that the second segment can be used for eviction, and so on.</p>

<p>Only aperture segments can be specified by this member. If the driver specifies valid segments to be used for eviction, <em>VidMm</em> attempts to allocate resources in those aperture segments to accelerate the eviction process. If the driver specifies 0, <em>VidMm</em> calls the driver to transfer the content of an allocation directly to paged-locked system memory without mapping the underlying pages through an aperture segment.</p>

<h3 id="maximumrenaminglistlength"><code>MaximumRenamingListLength</code></h3>

<p>[out] The maximum length of the renaming list for the allocation. For more information about the renaming list, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/requesting-to-rename-an-allocation">Requesting to Rename an Allocation</a>.</p>

<p>Support for this member started with Windows 10 and the WDDM v2.</p>

<h3 id="physicaladapterindex"><code>PhysicalAdapterIndex</code></h3>

<p>[out] The index of the physical adapter.</p>

<p>Support for this member started with Windows 10 and the WDDM v2.</p>

<h3 id="hallocation"><code>hAllocation</code></h3>

<p>[out] A handle to the allocation. The KMD must set this member to a value that it can use to refer to its private tracking structure for the allocation.</p>

<h3 id="flags"><code>Flags</code></h3>

<p>[out] A <a rel="noopener" target="_blank" href="dxgk_allocationinfoflags"><strong>DXGK_ALLOCATIONINFOFLAGS</strong></a> structure that identifies properties for an allocation in bit-field flags. These properties indicate the type of allocation to create. The KMD specifies these flags for <em>VidMm</em>. Drivers that target any WDDM version earlier than WDDM 2.0 should use <strong>Flags</strong>; drivers that target any WDDM version &gt;= WDDM 2.0 should use <strong>FlagsWddm2</strong>.</p>

<h3 id="flagswddm2"><code>FlagsWddm2</code></h3>

<p>[out] A <a rel="noopener" target="_blank" href="dxgk_allocationinfoflags_wddm2_0"><strong>DXGK_ALLOCATIONINFOFLAGS_WDDM2_0</strong></a> structure that identifies properties for an allocation in bit-field flags. These properties indicate the type of allocation to create. The KMD specifies these flags for <em>VidMm</em>. Drivers that target any WDDM version &gt;= WDDM 2.0 should use <strong>FlagsWddm2</strong>; drivers that target any WDDM version earlier than WDDM 2.0 should use <strong>Flags</strong>.</p>

<h3 id="pallocationusagehint"><code>pAllocationUsageHint</code></h3>

<p>[out] A pointer to a <a rel="noopener" target="_blank" href="dxgk_allocationusagehint"><strong>DXGK_ALLOCATIONUSAGEHINT</strong></a> structure that the memory manager uses to determine how to use the allocation.</p>

<h3 id="allocationpriority"><code>AllocationPriority</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies the starting priority level of the allocation.</p>

<p>The driver determines the appropriate priority level for each allocation. For more information about priority levels, see the Remarks section of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_setprioritycb"><strong>pfnSetPriorityCb</strong></a> function. If priority level for allocations is not an issue to the driver, the driver should set all priority levels to <strong>D3DDDI_ALLOCATIONPRIORITY_NORMAL</strong>. Note that 0 is an invalid initial allocation priority.</p>

<h3 id="flags2"><code>Flags2</code></h3>

<p>[out] A <a rel="noopener" target="_blank" href="dxgk_allocationinfoflags2"><strong>DXGK_ALLOCATIONINFOFLAGS2</strong></a> structure that contains additional properties for an allocation. Supported starting in Windows 11 (WDDM 3.0).</p>

<h2 id="remarks">Remarks</h2>

<p>With the WDDM v2, the <strong>DXGK_ALLOCATIONINFO</strong> structure has been changed so that the read and write segment set are no longer differentiated. During surface creation, <em>VidMm</em> will ignore the <strong>SupportedReadSegmentSet</strong> value and use only the segment set provide by <strong>SupportedWriteSegmentSet</strong>. Drivers should ensure that this value accurately represents the segment set that can be used by the allocation for its intended purpose.</p>

<p>Ignoring the supported read segment set doesn't mean that it is no longer supported, but simply that there should no longer be a difference between these sets, and <em>VidMm</em> will be allowed to choose an appropriate segment for any allocation from a single segment set.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="dxgkarg_createallocation"><strong>DXGKARG_CREATEALLOCATION</strong></a></p>

<p><a rel="noopener" target="_blank" href="dxgk_allocationinfoflags"><strong>DXGK_ALLOCATIONINFOFLAGS</strong></a></p>

<p><a rel="noopener" target="_blank" href="dxgk_allocationlist"><strong>DXGK_ALLOCATIONLIST</strong></a></p>

<p><a rel="noopener" target="_blank" href="dxgk_allocationusagehint"><strong>DXGK_ALLOCATIONUSAGEHINT</strong></a></p>

<p><a rel="noopener" target="_blank" href="dxgk_segmentbankpreference"><strong>DXGK_SEGMENTBANKPREFERENCE</strong></a></p>

<p><a rel="noopener" target="_blank" href="dxgk_segmentdescriptor"><strong>DXGK_SEGMENTDESCRIPTOR</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff562047(v=vs.85)"><strong>DXGK_SEGMENTPREFERENCE</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createallocation"><strong>DxgkDdiCreateAllocation</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_render"><strong>DxgkDdiRender</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_allocatecb"><strong>pfnAllocateCb</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_allocationinfo">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/ns-d3dkmddi-_dxgk_allocationinfo.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
