<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_GNSS_LISTEN_NI - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_GNSS_LISTEN_NI - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_GNSS_LISTEN_NI - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// gnssdriver.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0022, 0x040, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_GNSS_LISTEN_NI 0x00220100</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/gnssdriver/ni-gnssdriver-ioctl_gnss_listen_ni">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_gnss_listen_ni.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-gnssdriver-ioctl_gnss_listen_ni)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_gnss_listen_ni-ioctl">IOCTL_GNSS_LISTEN_NI IOCTL</h1>

<h2 id="description">Description</h2>

<p>The <strong>IOCTL_GNSS_LISTEN_NI</strong> control code is used to start listening for a SUPL NI request.</p>

<p>This IOCTL effectively provides the GNSS driver with a pending I/O request that it can use to, through the overlapped structures GnssEvent member, convey the NI request to the adapter. The GnssEvent member is a <a href="gnss_event" title="typedef struct {&#10;  ULONG           Size;&#10;  ULONG           Version;&#10;  GNSS_EVENT_TYPE EventType;&#10;  ULONG           EventDataSize;&#10;  BYTE            Unused[512];&#10;  union {&#10;    GNSS_FIXDATA                       FixData;&#10;    GNSS_AGNSS_REQUEST_PARAM           AgnssRequest;&#10;    GNSS_NI_REQUEST_PARAM              NiRequest;&#10;    GNSS_ERRORINFO                     ErrorInformation;&#10;    GNSS_NMEA_DATA                     NmeaData;&#10;    GNSS_GEOFENCE_ALERT_DATA           GeofenceAlertData;&#10;    GNSS_BREADCRUMBING_ALERT_DATA      BreadcrumbAlertData;&#10;    GNSS_GEOFENCES_TRACKINGSTATUS_DATA GeofencesTrackingStatus;&#10;    GNSS_DRIVER_REQUEST_DATA           DriverRequestData;&#10;    BYTE                               CustomData[ANYSIZE_ARRAY];&#10;  };&#10;} GNSS_EVENT, *PGNSS_EVENT;">GNSS_EVENT</a> structure. The adapter ensures that this request is always pending and will issue a new request as soon as the pending one is resolved. When the I/O request is resolved the adapter will issue a corresponding <a href="ioctl_gnss_respond_ni" title="// CTL_CODE(0x0022, 0x043, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_GNSS_RESPOND_NI 0x0022010C">IOCTL_GNSS_RESPOND_NI</a>.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>Set to NULL.</p>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>Set to 0.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>Set to NULL.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p>Set to 0.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p><strong>Irp->IoStatus.Status</strong> is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the request is successful. Otherwise, <strong>Status</strong> to the appropriate error condition as a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-ntstatus-values">NTSTATUS</a> code.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>EventType</strong> must be set to <strong>GNSS_Event_NI</strong> and the <strong>NiRequest</strong> member filled in.</p>

<h3 id="gnss-adapter-notes">GNSS adapter notes</h3>

<p>The GNSS adapter ensures that this request is always pending, so that the driver can indicate there is a NI request.</p>

<p>When the driver completes the I/O call, the adapter issues another IOCTL to continue waiting for further NI requests. The adapter should issue the IOCTL immediately, even if the previous NI requests are held up due to user interaction.</p>

<h3 id="gnss-driver-notes">GNSS driver notes</h3>

<p>Whenever the GNSS driver gets a NI request from the SUPL/CP, it completes the I/O operation.</p>

<p>These certificates, which are specified by the mobile operator and configured via the SUPL configuration service provider, are needed for establishing connection with the H-SLP or E-SLP. The GNSS adapter only pushes the SUPL configuration, including the certificated, to the GNSS driver. It does not install the certificates in the Windows file system. This is because different IHVs may have different implementations of the SUPL client, and some may include implementation of their own TLS stack. The GNSS adapter is agnostic to any implementation details of the SUPL client. The GNSS driver can store the certificates in registry or disk or push them directly to the SUPL client based on their usage. The SUPL client will need to take care of installing/using the certificates as needed.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/creating-ioctl-requests-in-drivers">Creating IOCTL Requests in Drivers</a></p>

<p><a href="wdfiotargetsendinternalioctlotherssynchronously" title="NTSTATUS WdfIoTargetSendInternalIoctlOthersSynchronously(&#10;  [in]            WDFIOTARGET               IoTarget,&#10;  [in, optional]  WDFREQUEST                Request,&#10;  [in]            ULONG                     IoctlCode,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    OtherArg1,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    OtherArg2,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    OtherArg4,&#10;  [in, optional]  PWDF_REQUEST_SEND_OPTIONS RequestOptions,&#10;  [out, optional] PULONG_PTR                BytesReturned&#10;);">WdfIoTargetSendInternalIoctlOthersSynchronously</a></p>

<p><a href="wdfiotargetsendinternalioctlsynchronously" title="NTSTATUS WdfIoTargetSendInternalIoctlSynchronously(&#10;  [in]            WDFIOTARGET               IoTarget,&#10;  [in, optional]  WDFREQUEST                Request,&#10;  [in]            ULONG                     IoctlCode,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    InputBuffer,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    OutputBuffer,&#10;  [in, optional]  PWDF_REQUEST_SEND_OPTIONS RequestOptions,&#10;  [out, optional] PULONG_PTR                BytesReturned&#10;);">WdfIoTargetSendInternalIoctlSynchronously</a></p>

<p><a href="wdfiotargetsendioctlsynchronously" title="NTSTATUS WdfIoTargetSendIoctlSynchronously(&#10;  [in]            WDFIOTARGET               IoTarget,&#10;  [in, optional]  WDFREQUEST                Request,&#10;  [in]            ULONG                     IoctlCode,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    InputBuffer,&#10;  [in, optional]  PWDF_MEMORY_DESCRIPTOR    OutputBuffer,&#10;  [in, optional]  PWDF_REQUEST_SEND_OPTIONS RequestOptions,&#10;  [out, optional] PULONG_PTR                BytesReturned&#10;);">WdfIoTargetSendIoctlSynchronously</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/gnssdriver/ni-gnssdriver-ioctl_gnss_listen_ni">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/gnssdriver/ni-gnssdriver-ioctl_gnss_listen_ni.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
