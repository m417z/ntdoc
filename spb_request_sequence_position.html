<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SPB_REQUEST_SEQUENCE_POSITION - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SPB_REQUEST_SEQUENCE_POSITION - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SPB_REQUEST_SEQUENCE_POSITION - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// spbcx.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef enum _SPB_REQUEST_SEQUENCE_POSITION {
  SpbRequestSequencePositionInvalid,
  SpbRequestSequencePositionSingle,
  SpbRequestSequencePositionFirst,
  SpbRequestSequencePositionContinue,
  SpbRequestSequencePositionLast,
  SpbRequestSequencePositionMax
} SPB_REQUEST_SEQUENCE_POSITION, *PSPB_REQUEST_SEQUENCE_POSITION;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/spbcx/ne-spbcx-_spb_request_sequence_position">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/spb_request_sequence_position.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ne-spbcx-_spb_request_sequence_position)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_spb_request_sequence_position-enumeration">_SPB_REQUEST_SEQUENCE_POSITION enumeration</h1>

<h2 id="description">Description</h2>

<p>The <strong>SPB_REQUEST_SEQUENCE_POSITION</strong> enumeration indicates the position of an I/O request in the list of transfers for an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/spb/i-o-transfer-sequences">I/O transfer sequence</a>.</p>

<h2 id="constants">Constants</h2>

<h3 id="spbrequestsequencepositioninvalid"><code>SpbRequestSequencePositionInvalid</code></h3>

<p>For internal use only.</p>

<h3 id="spbrequestsequencepositionsingle"><code>SpbRequestSequencePositionSingle</code></h3>

<p>A single-transfer I/O request. This request is either a read or write (<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-read">IRP_MJ_READ</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mj-write">IRP_MJ_WRITE</a>) request that is not part of a sequence, or it is an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/spb/spb-ioctls#ioctl_spb_execute_sequence">IOCTL_SPB_EXECUTE_SEQUENCE</a> I/O control request for a sequence that consists of a single transfer.</p>

<p>The controller should select the target before performing the transfer, and release the target after the transfer finishes.</p>

<h3 id="spbrequestsequencepositionfirst"><code>SpbRequestSequencePositionFirst</code></h3>

<p>The first I/O request in a sequence. This request is the read or write request that immediately follows the lock (<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/spb/spb-ioctls#ioctl_spb_lock_controller-control-code">IOCTL_SPB_LOCK_CONTROLLER</a>) I/O control request that signals the start of the sequence.</p>

<p>The controller should select the target before performing this transfer, and the target should remain selected after the transfer finishes.</p>

<h3 id="spbrequestsequencepositioncontinue"><code>SpbRequestSequencePositionContinue</code></h3>

<p>An I/O request in the middle of a sequence. This request is a read or write request that is neither the first nor the last transfer in the sequence.</p>

<p>In some cases, the SPB framework extension (SpbCx) cannot identify the last transfer and labels the last transfer as <strong>SpbRequestSequencePositionContinue</strong> instead of <strong>SpbRequestSequencePositionLast</strong>. For more information, see the following Remarks section.</p>

<p>The controller should already have the target selected before it starts this transfer, and the target should remain selected after the transfer finishes.</p>

<h3 id="spbrequestsequencepositionlast"><code>SpbRequestSequencePositionLast</code></h3>

<p>The last I/O request in a sequence. This request is the read or write request that immediately precedes the unlock (<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/spb/spb-ioctls#ioctl_spb_unlock_controller-control-code">IOCTL_SPB_UNLOCK_CONTROLLER</a>) I/O control request that signals the end of the sequence.</p>

<p>In some cases, SpbCx cannot identify the last transfer and labels the last transfer as <strong>SpbRequestSequencePositionContinue</strong> instead of <strong>SpbRequestSequencePositionLast</strong>. For more information, see the following Remarks section.</p>

<p>The controller should already have the target selected before it starts this transfer, and should release the target after the transfer finishes.</p>

<h3 id="spbrequestsequencepositionmax"><code>SpbRequestSequencePositionMax</code></h3>

<p>For internal use only.</p>

<h2 id="remarks">Remarks</h2>

<p>A client (peripheral driver) of the SPB controller can perform an I/O transfer sequence by sending a series of read and write requests to a target device on the bus. Each read or write request in the series occupies a position in the list of transfers for the sequence. The values in the <strong>SPB_REQUEST_SEQUENCE_POSITION</strong> enumeration indicate the relative positions of the read and write requests in this list.</p>

<p>The <a href="spbrequestgetparameters" title="VOID SpbRequestGetParameters(&#10;  [in]  SPBREQUEST             SpbRequest,&#10;  [out] SPB_REQUEST_PARAMETERS *Parameters&#10;);">SpbRequestGetParameters</a> method retrieves the SPB-specific parameter values from an I/O request and writes them to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/hh406209(v=vs.85)">SPB_REQUEST_PARAMETERS</a> structure. Included in these parameters is an <strong>SPB_REQUEST_SEQUENCE_POSITION</strong> enumeration value that indicates the position of the I/O request in the I/O transfer sequence of which it is part.</p>

<p>If <strong><a href="spbrequestgetparameters" title="VOID SpbRequestGetParameters(&#10;  [in]  SPBREQUEST             SpbRequest,&#10;  [out] SPB_REQUEST_PARAMETERS *Parameters&#10;);">SpbRequestGetParameters</a></strong> is called to retrieve the position value of an I/O request that is not a part of a sequence, this method assigns an appropriate <strong>SPB_REQUEST_SEQUENCE_POSITION</strong> enumeration value to the request.</p>

<p>For read and write requests, the position value is set to one of the following values: <strong>SpbRequestSequencePositionSingle</strong>, <strong>SpbRequestSequencePositionFirst</strong>, <strong>SpbRequestSequencePositionContinue</strong>, or <strong>SpbRequestSequencePositionLast</strong>.</p>

<p>If the client sends a simple read or write (<strong><a href="irp_mj_read" title="#define IRP_MJ_READ 0x03">IRP_MJ_READ</a></strong> or <strong><a href="irp_mj_write" title="#define IRP_MJ_WRITE 0x04">IRP_MJ_WRITE</a></strong>) request that is not part of a sequence, the position value is set to <strong>SpbRequestSequencePositionSingle</strong>.</p>

<p>If the client sends a lock (<strong>IOCTL_SPB_LOCK_CONTROLLER</strong>) request to signal the start of a sequence, the position value for the first transfer (read or write request) in the sequence is <strong>SpbRequestSequencePositionFirst</strong>, and the position value for the remaining transfers in the sequence is <strong>SpbRequestSequencePositionContinue</strong>. In this case, SpbCx cannot assign <strong>SpbRequestSequencePositionLast</strong> to the last transfer because it does not know that the client has sent the last read or write request until the client sends the unlock (<strong>IOCTL_SPB_UNLOCK_CONTROLLER</strong>) request that ends the sequence.</p>

<p>For lock requests, the position value is set to <strong>SpbRequestSequencePositionFirst</strong>. For unlock requests, the position value is set to <strong>SpbRequestSequencePositionLast</strong>.</p>

<p>Some controllers might support special operations, such as full-duplex bus transfers that simultaneously read from and write to a target device. A client can perform a custom sequence operation by locking the controller and sending a series of custom I/O requests, which SpbCx passes to the SPB controller driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/spbcx/nc-spbcx-evt_spb_controller_other">EvtSpbControllerIoOther</a> callback function. In this case, the position value for the first custom I/O request in the sequence is <strong>SpbRequestSequencePositionFirst</strong>, and the position value for the remaining custom I/O requests in the sequence is <strong>SpbRequestSequencePositionContinue</strong>. The sequence ends when the client unlocks the controller. If the <em>EvtSpbControllerIoOther</em> callback function receives a custom I/O request that is not part of a sequence, the position value for this request is <strong>SpbRequestSequencePositionSingle</strong>.</p>

<p>For a position value of <strong>SpbRequestSequencePositionLast</strong>, the <strong>Length</strong> member of the <strong>SPB_REQUEST_PARAMETERS</strong> structure can be 0 to indicate that the target should simply be released and that no I/O data should be transferred (or, equivalently, to indicate that a 0-byte transfer should occur, if the controller cannot release the device without running the clock).</p>

<p>For position values of <strong>SpbRequestSequencePositionContinue</strong> and <strong>SpbRequestSequencePositionLast</strong>, the transfer direction might have changed from the previous transfer and the SPB controller driver might need to indicate this possible direction change on the bus (for example, an I2C controller issues a new START condition). For more information about transfer directions, see <a href="spb_transfer_direction" title="typedef enum SPB_TRANSFER_DIRECTION {&#10;  SpbTransferDirectionNone,&#10;  SpbTransferDirectionFromDevice,&#10;  SpbTransferDirectionToDevice,&#10;  SpbTransferDirectionMax&#10;}  *PSPB_TRANSFER_DIRECTION;">SPB_TRANSFER_DIRECTION</a>.</p>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/spbcx/nc-spbcx-evt_spb_controller_sequence">EvtSpbControllerIoSequence</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/spb/spb-ioctls#ioctl_spb_lock_controller-control-code">IOCTL_SPB_LOCK_CONTROLLER</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/spb/spb-ioctls#ioctl_spb_unlock_controller-control-code">IOCTL_SPB_UNLOCK_CONTROLLER</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-read">IRP_MJ_READ</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mj-write">IRP_MJ_WRITE</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/hh406209(v=vs.85)">SPB_REQUEST_PARAMETERS</a></li>
<li><a href="spb_transfer_direction" title="typedef enum SPB_TRANSFER_DIRECTION {&#10;  SpbTransferDirectionNone,&#10;  SpbTransferDirectionFromDevice,&#10;  SpbTransferDirectionToDevice,&#10;  SpbTransferDirectionMax&#10;}  *PSPB_TRANSFER_DIRECTION;">SPB_TRANSFER_DIRECTION</a></li>
<li><a href="spbrequestgetparameters" title="VOID SpbRequestGetParameters(&#10;  [in]  SPBREQUEST             SpbRequest,&#10;  [out] SPB_REQUEST_PARAMETERS *Parameters&#10;);">SpbRequestGetParameters</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/spbcx/ne-spbcx-_spb_request_sequence_position">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/spbcx/ne-spbcx-_spb_request_sequence_position.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
