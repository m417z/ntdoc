<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtAssociateWaitCompletionPacket - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtAssociateWaitCompletionPacket - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtAssociateWaitCompletionPacket - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTIOAPI_H
//
// Wait completion packet
//
#if (PHNT_VERSION &gt;= PHNT_WINDOWS_8)

</span><span class="ntdoc-code-intro">/**
 * The NtAssociateWaitCompletionPacket routine associates a wait completion packet
 * with an I/O completion port or other target object so that a completion packet
 * will be queued when the target object becomes signaled or an I/O completes.
 *
 * This routine links the specified wait completion packet with the target
 * completion object so the packet will carry the supplied context and status
 * information when it is delivered.
 *
 * \param[in] WaitCompletionPacketHandle Handle to the wait completion packet object.
 * \param[in] IoCompletionHandle Handle to an I/O completion port (or compatible object)
 *        with which the wait completion packet should be associated.
 * \param[in] TargetObjectHandle Handle to the object to watch for completion or
 *        signalling (for example, a waitable kernel object).
 * \param[in] KeyContext Optional pointer to caller-specified context that will be
 *        stored in the completion packet and returned to the consumer.
 * \param[in] ApcContext Optional pointer to caller-specified APC/context value that
 *        will be stored in the completion packet and returned to the consumer.
 * \param[in] IoStatus The <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value to be placed in the completion packet.
 * \param[in] IoStatusInformation Additional information ( <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> ) to be placed
 *        in the completion packet (commonly used for number of bytes transferred).
 * \param[out] AlreadySignaled Optional pointer to a BOOLEAN that, on return, is set
 *        to TRUE if the packet was already signaled at the time of association;
 *        otherwise FALSE. May be NULL.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \remarks Use this routine to arrange for notification of a target object&#x27;s
 *          completion by queuing a wait completion packet containing the
 *          supplied context and status.
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtAssociateWaitCompletionPacket(
    _In_ HANDLE WaitCompletionPacketHandle,
    _In_ HANDLE IoCompletionHandle,
    _In_ HANDLE TargetObjectHandle,
    _In_opt_ PVOID KeyContext,
    _In_opt_ PVOID ApcContext,
    _In_ <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoStatus,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> IoStatusInformation,
    _Out_opt_ PBOOLEAN AlreadySignaled
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/d9393a49b3707fc786047a2ca5ae4afefd760b30/phnt/include/ntioapi.h#L2863">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwAssociateWaitCompletionPacket(
    _In_ HANDLE WaitCompletionPacketHandle,
    _In_ HANDLE IoCompletionHandle,
    _In_ HANDLE TargetObjectHandle,
    _In_opt_ PVOID KeyContext,
    _In_opt_ PVOID ApcContext,
    _In_ <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoStatus,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> IoStatusInformation,
    _Out_opt_ PBOOLEAN AlreadySignaled
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/d9393a49b3707fc786047a2ca5ae4afefd760b30/phnt/include/ntzwapi.h#L641">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header"></span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NtAssociateWaitCompletionPacket (
    _In_ HANDLE WaitCompletionPacketHandle,
    _In_ HANDLE IoCompletionHandle,
    _In_ HANDLE TargetObjectHandle,
    _In_opt_ PVOID KeyContext,
    _In_opt_ PVOID ApcContext,
    _In_ <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoStatus,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> IoStatusInformation,
    _Out_opt_ PBOOLEAN AlreadySignaled
    )</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/ntassociatewaitcompletionpacket">View the official Win32 development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/devnotes/ntassociatewaitcompletionpacket">documented in Windows SDK</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntassociatewaitcompletionpacket.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 development documentation (ntassociatewaitcompletionpacket)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>NtAssociateWaitCompletionPacket function</h1>

<p>Creates a wait completion association for the target object.</p>

<h2>Parameters</h2>

<h3>WaitCompletionPacketHandle [in]</h3>

<p>A handle to a wait completion packet which describes the association. This object must not be in use.</p>

<h3>IoCompletionHandle [in]</h3>

<p>A handle to an IO completion object which will receive a notification when the object becomes signaled.</p>

<h3>TargetObjectHandle [in]</h3>

<p>A handle to a waitable object for which notifications are to be received.</p>

<h3>KeyContext [in]</h3>

<p>Supplies the key context that is returned during a call to <a href="ntremoveiocompletion" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRemoveIoCompletion(&#10;    _In_ HANDLE IoCompletionHandle,&#10;    _Out_ PVOID *KeyContext,&#10;    _Out_ PVOID *ApcContext,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER Timeout&#10;    );">NtRemoveIoCompletion</a>.</p>

<h3>ApcContext [in]</h3>

<p>The apc context that is returned during a call to <strong><a href="ntremoveiocompletion" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRemoveIoCompletion(&#10;    _In_ HANDLE IoCompletionHandle,&#10;    _Out_ PVOID *KeyContext,&#10;    _Out_ PVOID *ApcContext,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER Timeout&#10;    );">NtRemoveIoCompletion</a></strong>.</p>

<h3>IoStatus [in]</h3>

<p>The IoStatus->Status data that is returned during a call to <strong><a href="ntremoveiocompletion" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRemoveIoCompletion(&#10;    _In_ HANDLE IoCompletionHandle,&#10;    _Out_ PVOID *KeyContext,&#10;    _Out_ PVOID *ApcContext,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER Timeout&#10;    );">NtRemoveIoCompletion</a></strong>.</p>

<h3>IoStatusInformation [in]</h3>

<p>The IoStatus->Information data that is returned during a call to <a href="ntremoveiocompletion" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRemoveIoCompletion(&#10;    _In_ HANDLE IoCompletionHandle,&#10;    _Out_ PVOID *KeyContext,&#10;    _Out_ PVOID *ApcContext,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER Timeout&#10;    );">NtRemoveIoCompletion</a>.</p>

<h3>AlreadySignaled [out]</h3>

<p>An optional pointer to a boolean variable that receives an indication of whether the target object was already signaled at the time of the association when this function succeeds.</p>

<h2>Return value</h2>

<p>An <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> code. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-ntstatus-values">Using NTSTATUS values</a>.</p>

<h2>Remarks</h2>

<p>When the object is signaled, a packet is queued to the supplied completion port and the supplied values will be conveyed to a caller of <a href="ntremoveiocompletion" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRemoveIoCompletion(&#10;    _In_ HANDLE IoCompletionHandle,&#10;    _Out_ PVOID *KeyContext,&#10;    _Out_ PVOID *ApcContext,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER Timeout&#10;    );">NtRemoveIoCompletion</a>. When the packet is picked up, the association must be reestablished by calling this function again. An error is returned if the wait completion packet is already in use for an association.</p>

<p>This function has no associated import library or header file; you must call it using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress"><strong>GetProcAddress</strong></a> functions. The API is exported from ntdll.dll.</p>

<h2>Requirements</h2>

<table>
<thead>
<tr>
  <th>Requirement</th>
  <th>Value</th>
</tr>
</thead>
<tbody>
<tr>
  <td>DLL</td>
  <td>ntdll.dll</td>
</tr>
</tbody>
</table>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/ntassociatewaitcompletionpacket">View the official Win32 development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/win32/blob/docs/desktop-src/DevNotes/ntassociatewaitcompletionpacket.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
