<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PREGISTER_NOTIFICATION_CALLBACK - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PREGISTER_NOTIFICATION_CALLBACK - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PREGISTER_NOTIFICATION_CALLBACK - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// hdaudio.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PREGISTER_NOTIFICATION_CALLBACK PregisterNotificationCallback;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PregisterNotificationCallback(
  PVOID _context,
  HANDLE Handle,
  <a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a> Fdo,
  <a href="phdaudio_dma_notification_callback" title="PHDAUDIO_DMA_NOTIFICATION_CALLBACK PhdaudioDmaNotificationCallback;&#10;&#10;VOID PhdaudioDmaNotificationCallback(&#10;  PVOID unnamedParam1,&#10;  LARGE_INTEGER unnamedParam2&#10;)&#10;{...}">PHDAUDIO_DMA_NOTIFICATION_CALLBACK</a> NotificationCallback,
  PVOID CallbackContext
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-pregister_notification_callback">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pregister_notification_callback.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-hdaudio-pregister_notification_callback)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pregister_notification_callback-callback-function">PREGISTER_NOTIFICATION_CALLBACK callback function</h1>

<h2 id="description">Description</h2>

<p>The RegisterNotificationCallback routine registers a callback routine so that it can receive DMA progress notifications with more accurate timing information.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="_context"><code>_context</code></h3>

<p>Specifies the context value from the Context member of the <a href="hdaudio_bus_interface_v3" title="typedef struct _HDAUDIO_BUS_INTERFACE_V3 {&#10;  USHORT                                 Size;&#10;  USHORT                                 Version;&#10;  PVOID                                  Context;&#10;  PINTERFACE_REFERENCE                   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE                 InterfaceDereference;&#10;  PTRANSFER_CODEC_VERBS                  TransferCodecVerbs;&#10;  PALLOCATE_CAPTURE_DMA_ENGINE           AllocateCaptureDmaEngine;&#10;  PALLOCATE_RENDER_DMA_ENGINE            AllocateRenderDmaEngine;&#10;  PCHANGE_BANDWIDTH_ALLOCATION           ChangeBandwidthAllocation;&#10;  PALLOCATE_DMA_BUFFER                   AllocateDmaBuffer;&#10;  PFREE_DMA_BUFFER                       FreeDmaBuffer;&#10;  PFREE_DMA_ENGINE                       FreeDmaEngine;&#10;  PSET_DMA_ENGINE_STATE                  SetDmaEngineState;&#10;  PGET_WALL_CLOCK_REGISTER               GetWallClockRegister;&#10;  PGET_LINK_POSITION_REGISTER            GetLinkPositionRegister;&#10;  PREGISTER_EVENT_CALLBACK               RegisterEventCallback;&#10;  PUNREGISTER_EVENT_CALLBACK             UnregisterEventCallback;&#10;  PGET_DEVICE_INFORMATION                GetDeviceInformation;&#10;  PGET_RESOURCE_INFORMATION              GetResourceInformation;&#10;...">HDAUDIO_BUS_INTERFACE_V3</a> structure.</p>

<h3 id="handle"><code>Handle</code></h3>

<p>Handle that identifies the DMA engine. This handle value was obtained from a previous call to AllocateCaptureDmaEngine or AllocateRenderDmaEngine.</p>

<h3 id="fdo"><code>Fdo</code></h3>

<p>The FDO that owns the callback. The hdaudbus driver will take a reference on this FDO while the callback is registered to ensure the callback routine is valid.</p>

<h3 id="notificationcallback"><code>NotificationCallback</code></h3>

<p>The callback routine that will be called to notify the driver as DMA is progressing. Depending on the notification count parameter that is used with AllocateDmaBufferWithNotification, the registered event is signaled one or two times for every time that the DMA passes through the audio buffer.</p>

<h3 id="callbackcontext"><code>CallbackContext</code></h3>

<p>Driver-specific context value for the callback routine.</p>

<h2 id="return-value">Return value</h2>

<p>RegisterNotificationCallback returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call successfully registers the event. Otherwise, the routine returns STATUS_INSUFFICIENT_RESOURCES to indicate that there are insufficient resources that are available to complete the operation.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS Values</a>.</p>

<h2 id="prototype">Prototype</h2>

<p>The function pointer type for a RegisterNotificationCallback routine is defined as follows.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="c1">//Declaration</span>

<span class="n">PREGISTER_NOTIFICATION_CALLBACK</span><span class="w"> </span><span class="n">PRegisterNotificationCallback</span><span class="p">;</span>

<span class="c1">// Definition</span>

<span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span><span class="w"> </span><span class="nf">PRegisterNotificationCallback</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">PVOID</span><span class="w"> </span><span class="n">_context</span>
<span class="w">    </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">Handle</span>
<span class="w">    </span><span class="n"><a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a></span><span class="w"> </span><span class="n">Fdo</span>
<span class="w">    </span><span class="n"><a href="phdaudio_dma_notification_callback" title="PHDAUDIO_DMA_NOTIFICATION_CALLBACK PhdaudioDmaNotificationCallback;&#10;&#10;VOID PhdaudioDmaNotificationCallback(&#10;  PVOID unnamedParam1,&#10;  LARGE_INTEGER unnamedParam2&#10;)&#10;{...}">PHDAUDIO_DMA_NOTIFICATION_CALLBACK</a></span><span class="w"> </span><span class="n">NotificationCallback</span>
<span class="w">    </span><span class="n">PVOID</span><span class="w"> </span><span class="n">CallbackContext</span>
<span class="p">)</span>
<span class="p">{...}</span>
</code></pre>
</div>

<h2 id="remarks">Remarks</h2>

<p>RegisterNotificationCallback registers the notification callback routine with the HD Audio bus driver. The HD Audio bus driver maintains a list of the registered notification events and callback routines for each DMA engine. Every time the engine receives an IOC interrupt all events will be signaled and all notification callback routines will be called at IRQL=DPC with the QPC timestamp at the time the IOC occurred.</p>

<p>Notification Callback routines are unregistered by calling UnregisterNotificationCallback with the same NotificationCallback and CallbackContext values.</p>

<p>The HD Audio bus driver will maintain a reference on the FDO after registration until the matching unregistration is called.</p>

<h2 id="see-also">See also</h2>

<p><a href="hdaudio_bus_interface_v3" title="typedef struct _HDAUDIO_BUS_INTERFACE_V3 {&#10;  USHORT                                 Size;&#10;  USHORT                                 Version;&#10;  PVOID                                  Context;&#10;  PINTERFACE_REFERENCE                   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE                 InterfaceDereference;&#10;  PTRANSFER_CODEC_VERBS                  TransferCodecVerbs;&#10;  PALLOCATE_CAPTURE_DMA_ENGINE           AllocateCaptureDmaEngine;&#10;  PALLOCATE_RENDER_DMA_ENGINE            AllocateRenderDmaEngine;&#10;  PCHANGE_BANDWIDTH_ALLOCATION           ChangeBandwidthAllocation;&#10;  PALLOCATE_DMA_BUFFER                   AllocateDmaBuffer;&#10;  PFREE_DMA_BUFFER                       FreeDmaBuffer;&#10;  PFREE_DMA_ENGINE                       FreeDmaEngine;&#10;  PSET_DMA_ENGINE_STATE                  SetDmaEngineState;&#10;  PGET_WALL_CLOCK_REGISTER               GetWallClockRegister;&#10;  PGET_LINK_POSITION_REGISTER            GetLinkPositionRegister;&#10;  PREGISTER_EVENT_CALLBACK               RegisterEventCallback;&#10;  PUNREGISTER_EVENT_CALLBACK             UnregisterEventCallback;&#10;  PGET_DEVICE_INFORMATION                GetDeviceInformation;&#10;  PGET_RESOURCE_INFORMATION              GetResourceInformation;&#10;...">HDAUDIO_BUS_INTERFACE_V3</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/hdaudio/">hdaudio.h</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/hdaudio/nc-hdaudio-pregister_notification_callback">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/hdaudio/nc-hdaudio-pregister_notification_callback.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
