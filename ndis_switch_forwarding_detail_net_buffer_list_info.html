<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ndis.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">typedef union _NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO {
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a> AsUINT64;
  struct {
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> NumAvailableDestinations : 16;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> SourcePortId : 16;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> SourceNicIndex : 8;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> NativeForwardingRequired : 1;
#if ...
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> Reserved1 : 1;
#else
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> Reserved1 : 2;
#endif
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> IsPacketDataSafe : 1;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> SafePacketDataSize : 12;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> IsPacketDataUncached : 1;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> IsSafePacketDataUncached : 1;
    <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> Reserved2 : 7;
  };
} NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO, *PNDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO;</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_switch_forwarding_detail_net_buffer_list_info">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_switch_forwarding_detail_net_buffer_list_info.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ndis-_ndis_switch_forwarding_detail_net_buffer_list_info)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO structure</h1>
<h2>Description</h2>
<p>The <strong>NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO</strong> union specifies the information for forwarding a packet to one or more Hyper-V extensible switch ports.</p>
<p>This information is contained in the out-of-band (OOB) data of the packet's <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure.</p>
<h2>Members</h2>
<h3><code>AsUINT64</code></h3>
<p>The complete 64-bit <strong>NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO</strong> value.</p>
<h3><code>NumAvailableDestinations</code></h3>
<p>A value that specifies the number of unused extensible switch destination ports elements within an <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure. For more information, see the Remarks section.</p>
<h3><code>SourcePortId</code></h3>
<p>The identifier of the source extensible switch port from which the <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> originated.</p>
<h3><code>SourceNicIndex</code></h3>
<p>A <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> value that specifies the index of the source network adapter that is connected to the extensible switch port specified by the <strong>SourcePortId</strong> member.</p>
<p>For more information on this index value, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-adapter-index-values">Network Adapter Index Values</a>.</p>
<h3><code>NativeForwardingRequired</code></h3>
<p>If this member is set to <strong>TRUE</strong>, packet is an NVGRE packet, and the Hyper-V Network Virtualization (HNV) component of the Hyper-V extensible switch will forward this packet. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/hybrid-forwarding">Hybrid Forwarding</a>.</p>
<p>This flag must not be written to by any extension.</p>
<p><strong>Note</strong> This flag is available only in NDIS 6.40 and later.</p>
<h3><code>Reserved1</code></h3>
<p>This member is reserved for future use by NDIS.</p>
<p>This member is reserved for future use by NDIS.</p>
<h3><code>IsPacketDataSafe</code></h3>
<p>If this member is set to <strong>TRUE</strong>, all of the packet data comes from trusted
host memory.</p>
<h3><code>SafePacketDataSize</code></h3>
<p>A value that specifies the number of consecutive bytes in the packet data that is located in trusted host memory. This value is in units of bytes from the start of the packet data. The rest of the packet data (if any) after the <strong>SafePacketDataSize</strong> value is located in untrusted
shared memory that is accessed by the Hyper-V child and parent partitions.</p>
<p>For more information, see the Remarks section.</p>
<p><strong>Note</strong> This member is valid only if the <strong>IsPacketDataSafe</strong> member is set to <strong>FALSE</strong>.</p>
<h3><code>IsPacketDataUncached</code></h3>
<p>If this flag is not set, the entire packet data is cached. If it is set, part or all of the data is <em>not</em> cached. When set, check the <strong>IsSafePacketDataUncached</strong> field to see if at least the SafePacketData portion is cached.</p>
<h3><code>IsSafePacketDataUncached</code></h3>
<p>If the <strong>IsPacketDataUncached</strong> flag is set, this field indicates whether the SafePacketData part of the packet is cached. If so, see the <strong>SafePacketDataSize</strong> field for how many bytes are cached.</p>
<h3><code>Reserved2</code></h3>
<p>This member is reserved for future use by NDIS.</p>
<h2>Remarks</h2>
<p>Extensible switch extensions can use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-switch-forwarding-detail">NET_BUFFER_LIST_SWITCH_FORWARDING_DETAIL</a> macro to access the <strong>NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO</strong> union in a <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure.</p>
<p>The <strong>NumAvailableDestinations</strong> member of the <strong>NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO</strong> union specifies the number of unused extensible switch destination port elements within a <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure. Each extensible switch destination port is specified by an <a href="ndis_switch_port_destination" title="typedef struct _NDIS_SWITCH_PORT_DESTINATION {&#10;  NDIS_SWITCH_PORT_ID   PortId;&#10;  NDIS_SWITCH_NIC_INDEX NicIndex;&#10;  USHORT                IsExcluded : 1;&#10;  USHORT                PreserveVLAN : 1;&#10;  USHORT                PreservePriority : 1;&#10;  USHORT                Reserved : 13;&#10;} NDIS_SWITCH_PORT_DESTINATION, *PNDIS_SWITCH_PORT_DESTINATION;">NDIS_SWITCH_PORT_DESTINATION</a> element within the <a href="ndis_switch_forwarding_destination_array" title="typedef struct _NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY {&#10;  NDIS_OBJECT_HEADER Header;&#10;  UINT32             ElementSize;&#10;  UINT32             NumElements;&#10;  UINT32             NumDestinations;&#10;  PVOID              FirstElement;&#10;} NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY, *PNDIS_SWITCH_FORWARDING_DESTINATION_ARRAY;">NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY</a> structure of a <strong><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></strong> structure. The extensible switch extension calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_switch_get_net_buffer_list_destinations">GetNetBufferListDestinations</a> to obtain the current <strong><a href="ndis_switch_forwarding_destination_array" title="typedef struct _NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY {&#10;  NDIS_OBJECT_HEADER Header;&#10;  UINT32             ElementSize;&#10;  UINT32             NumElements;&#10;  UINT32             NumDestinations;&#10;  PVOID              FirstElement;&#10;} NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY, *PNDIS_SWITCH_FORWARDING_DESTINATION_ARRAY;">NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY</a></strong> in a <strong><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></strong> structure.</p>
<p>The <strong>NativeForwardingRequired</strong> member specifies whether the packet is an NVGRE packet or not. If it is <strong>TRUE</strong>, the packet is an NVGRE packet, and the forwarding extension doesn't determine the packet's forwarding destination port array, although it can add or exclude destination ports in the array. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/hybrid-forwarding">Hybrid Forwarding</a>.</p>
<p>The <strong>IsPacketDataUncached</strong> flag can help extensible switch extensions determine if part or all of the packet data is cached or not. If this flag is set, part or all of the data is <em>not</em> cached, and the <strong>IsSafePacketDataUncached</strong> flag tells the extension whether the safe packet data part is cached. If the safe packet data is cached, then the <strong>SafePacketDataSize</strong> member specifies how many bytes are cached.</p>
<p><strong>SafePacketDataSize</strong> specifies the size of the packet data that is located in local, or <em>trusted</em>, memory in the parent operating system of the Hyper-V parent partition. This memory is not accessible by the child partition. Therefore, it is considered &quot;safe&quot; from unsynchronized updates by the guest operating system that runs in that partition.</p>
<p>If an extensible switch extension requires more trusted space in order to inspect the packet data, it must follow these steps:</p>
<ol>
<li>The extension must duplicate the packet's <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure by allocating a <strong><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></strong> and <a href="net_buffer" title="typedef struct _NET_BUFFER {&#10;  union {&#10;    struct {&#10;      NET_BUFFER *Next;&#10;      MDL        *CurrentMdl;&#10;      ULONG      CurrentMdlOffset;&#10;      union {&#10;        ULONG  DataLength;&#10;        SIZE_T stDataLength;&#10;      };&#10;      MDL        *MdlChain;&#10;      ULONG      DataOffset;&#10;    };&#10;    SLIST_HEADER      Link;&#10;    NET_BUFFER_HEADER NetBufferHeader;&#10;  };&#10;  USHORT           ChecksumBias;&#10;  USHORT           Reserved;&#10;  NDIS_HANDLE      NdisPoolHandle;&#10;  PVOID            NdisReserved[2];&#10;...">NET_BUFFER</a> structure. The extension then calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndiscopyfromnetbuffertonetbuffer">NdisCopyFromNetBufferToNetBuffer</a> to duplicate the packet's <strong><a href="net_buffer" title="typedef struct _NET_BUFFER {&#10;  union {&#10;    struct {&#10;      NET_BUFFER *Next;&#10;      MDL        *CurrentMdl;&#10;      ULONG      CurrentMdlOffset;&#10;      union {&#10;        ULONG  DataLength;&#10;        SIZE_T stDataLength;&#10;      };&#10;      MDL        *MdlChain;&#10;      ULONG      DataOffset;&#10;    };&#10;    SLIST_HEADER      Link;&#10;    NET_BUFFER_HEADER NetBufferHeader;&#10;  };&#10;  USHORT           ChecksumBias;&#10;  USHORT           Reserved;&#10;  NDIS_HANDLE      NdisPoolHandle;&#10;  PVOID            NdisReserved[2];&#10;...">NET_BUFFER</a></strong> structure. If this function completes successfully, the packet's data is copied to trusted memory.</li>
<li>The extension must call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_switch_copy_net_buffer_list_info">CopyNetBufferListInfo</a> to copy the packet's OOB data to the duplicated packet.</li>
<li>After the original packet has been duplicated, the extension must obtain the <strong>NDIS_SWITCH_FORWARDING_DETAIL_NET_BUFFER_LIST_INFO</strong> union in the duplicated packet by using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-switch-forwarding-detail">NET_BUFFER_LIST_SWITCH_FORWARDING_DETAIL</a> macro. The extension must set the <strong>IsPacketDataSafe</strong> member to <strong>TRUE</strong>.</li>
</ol>
<p>For more information on how to duplicate packets in the extensible switch interface, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/originating-packet-traffic">Originating Packet Traffic</a>.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/forwarding-extensions">Forwarding Extensions</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/forwarding-packets-to-hyper-v-extensible-switch-ports">Forwarding Packets to Hyper-V Extensible Switch Ports</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/forwarding-packets-to-physical-network-adapters">Forwarding Packets to Physical Network Adapters</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_switch_get_net_buffer_list_destinations">GetNetBufferListDestinations</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/hybrid-forwarding">Hybrid Forwarding</a></p>
<p><a href="ndis_switch_forwarding_destination_array" title="typedef struct _NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY {&#10;  NDIS_OBJECT_HEADER Header;&#10;  UINT32             ElementSize;&#10;  UINT32             NumElements;&#10;  UINT32             NumDestinations;&#10;  PVOID              FirstElement;&#10;} NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY, *PNDIS_SWITCH_FORWARDING_DESTINATION_ARRAY;">NDIS_SWITCH_FORWARDING_DESTINATION_ARRAY</a></p>
<p><a href="ndis_switch_port_destination" title="typedef struct _NDIS_SWITCH_PORT_DESTINATION {&#10;  NDIS_SWITCH_PORT_ID   PortId;&#10;  NDIS_SWITCH_NIC_INDEX NicIndex;&#10;  USHORT                IsExcluded : 1;&#10;  USHORT                PreserveVLAN : 1;&#10;  USHORT                PreservePriority : 1;&#10;  USHORT                Reserved : 13;&#10;} NDIS_SWITCH_PORT_DESTINATION, *PNDIS_SWITCH_PORT_DESTINATION;">NDIS_SWITCH_PORT_DESTINATION</a></p>
<p><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-switch-forwarding-detail">NET_BUFFER_LIST_SWITCH_FORWARDING_DETAIL</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/overview-of-the-hyper-v-extensible-switch">Overview of the Hyper-V Extensible Switch</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_switch_forwarding_detail_net_buffer_list_info">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/ns-ndis-_ndis_switch_forwarding_detail_net_buffer_list_info.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
