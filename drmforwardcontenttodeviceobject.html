<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DrmForwardContentToDeviceObject - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DrmForwardContentToDeviceObject - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DrmForwardContentToDeviceObject - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// drmk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DrmForwardContentToDeviceObject(
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>        ContentId,
  [in, optional] PVOID        Reserved,
  [in]           PCDRMFORWARD DrmForward
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/drmk/nf-drmk-drmforwardcontenttodeviceobject">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/drmforwardcontenttodeviceobject.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-drmk-drmforwardcontenttodeviceobject)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="drmforwardcontenttodeviceobject-function">DrmForwardContentToDeviceObject function</h1>

<h2 id="description">Description</h2>

<p>The <code>DrmForwardContentToDeviceObject</code> function accepts a device object representing a device to which the caller intends to forward protected content. The function authenticates the device and sends it the content ID and DRM rights that the system has assigned to the protected content.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="contentid-in"><code>ContentId</code> [in]</h3>

<p>Specifies the DRM content ID. This parameter identifies a protected KS audio stream.</p>

<h3 id="reserved-in-optional"><code>Reserved</code> [in, optional]</h3>

<p>Reserved for future use. Set to <strong>NULL</strong>.</p>

<h3 id="drmforward-in"><code>DrmForward</code> [in]</h3>

<p>Pointer to a <a href="drmforward" title="typedef struct tagDRMFORWARD {&#10;  DWORD          Flags;&#10;  PDEVICE_OBJECT DeviceObject;&#10;  PFILE_OBJECT   FileObject;&#10;  PVOID          Context;&#10;} DRMFORWARD, *PDRMFORWARD;">DRMFORWARD</a> structure specifying a device object and file object that identify the target device and a KS audio pin on that device, respectively. The structure also contains the context value that the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff537351(v=vs.85)">KSPROPERTY_DRMAUDIOSTREAM_CONTENTID</a>set-property request passes to the device.</p>

<h2 id="return-value">Return value</h2>

<p><code>DrmForwardContentToDeviceObject</code> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call was successful. Otherwise, it returns an appropriate error code.</p>

<h2 id="remarks">Remarks</h2>

<p>Before allowing protected content to flow through a data path, the system verifies that the data path is secure. To do so, the system authenticates each module in the data path beginning at the upstream end of the data path and moving downstream. As each module is authenticated, that module gives the system information about the next module in the data path so that it can also be authenticated. To be successfully authenticated, a module's binary file must be signed as DRM-compliant.</p>

<p>Two adjacent modules in the data path can communicate with each other in one of several ways. If the upstream module calls the downstream module through <a href="iocalldriver" title="#define IoCallDriver(a,b)   \&#10;        IofCallDriver(a,b)&#10;);">IoCallDriver</a>, the downstream module is part of a WDM driver. In this case, the upstream module calls the <code>DrmForwardContentToDeviceObject</code> function to provide the system with the device object representing the downstream module. (If the two modules communicate through the downstream module's COM interface or content handlers, the upstream module calls <a href="drmforwardcontenttointerface" title="NTSTATUS DrmForwardContentToInterface(&#10;  [in] ULONG    ContentId,&#10;  [in] PUNKNOWN pUnknown,&#10;  [in] ULONG    NumMethods&#10;);">DrmForwardContentToInterface</a> or <a href="drmaddcontenthandlers" title="NTSTATUS DrmAddContentHandlers(&#10;  [in] ULONG ContentId,&#10;  [in] PVOID *paHandlers,&#10;  [in] ULONG NumHandlers&#10;);">DrmAddContentHandlers</a> instead.)</p>

<p>The caller fills in the <strong>DeviceObject</strong>, <strong>FileObject</strong>, and <strong>Context</strong> members of the <a href="drmforward" title="typedef struct tagDRMFORWARD {&#10;  DWORD          Flags;&#10;  PDEVICE_OBJECT DeviceObject;&#10;  PFILE_OBJECT   FileObject;&#10;  PVOID          Context;&#10;} DRMFORWARD, *PDRMFORWARD;">DRMFORWARD</a> structure that parameter <em>DrmForward</em> points to. <code>DrmForwardContentToDeviceObject</code> uses these values as follows:</p>

<ul>
<li><strong>DeviceObject</strong> specifies the device object that represents the driver (the downstream module). <code>DrmForwardContentToDeviceObject</code> uses the device object to authenticate the driver. If successful, the function sets the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff537351(v=vs.85)">KSPROPERTY_DRMAUDIOSTREAM_CONTENTID</a> property on the device by sending a set-property request to a KS pin on the device.</li>
<li><strong>FileObject</strong> specifies the KS pin to which <code>DrmForwardContentToDeviceObject</code> sends the property request.</li>
<li><strong>Context</strong> specifies a context value that the caller passes to the driver through the property request. <code>DrmForwardContentToDeviceObject</code> copies the context value into the request's property descriptor. The context value is typically a pointer to a buffer containing data in some custom format that both the caller and driver understand. By convention, if the downstream module is a KS filter, the <strong>Context</strong> member points to a file object that specifies the KS pin to which the <code>DrmForwardContentToDeviceObject</code> function sends the property request. In other words, the <strong>Context</strong> member points to the same file object as the <strong>FileObject</strong> member. USB audio drivers must set the <strong>Context</strong> parameter to a USBD_PIPE_HANDLE value.</li>
</ul>

<p>The property request also contains the DRM content ID from parameter <em>ContentId</em> and the DRM content rights belonging to that content ID. <code>DrmForwardContentToDeviceObject</code> copies these values into the request's property value. <code>DrmForwardContentToDeviceObject</code> makes no further use of the device object after returning.</p>

<p><code>DrmForwardContentToDeviceObject</code> performs the same function as <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/portcls/nf-portcls-pcforwardcontenttodeviceobject">PcForwardContentToDeviceObject</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/portcls/nf-portcls-idrmport2-forwardcontenttodeviceobject">IDrmPort2::ForwardContentToDeviceObject</a>. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/audio/drm-functions-and-interfaces">DRM Functions and Interfaces</a>.</p>

<p>The KSPROPERTY_DRMAUDIOSTREAM_CONTENTID property assigns the DRM content ID and DRM content rights to a KS audio pin.</p>

<h2 id="-1">#</h2>

<h3 id="usage-summary-table">Usage Summary Table</h3>

<table>
<thead>
<tr>
  <th>Get</th>
  <th>Set</th>
  <th>Target</th>
  <th>Property descriptor type</th>
  <th>Property value type</th>
</tr>
</thead>
<tbody>
<tr>
  <td>No</td>
  <td>Yes</td>
  <td>Pin</td>
  <td><a href="ksp_drmaudiostream_contentid" title="typedef struct {&#10;  KSPROPERTY                         Property;&#10;  PVOID                              Context;&#10;  PFNDRMADDCONTENTHANDLERS           DrmAddContentHandlers;&#10;  PFNDRMCREATECONTENTMIXED           DrmCreateContentMixed;&#10;  PFNDRMDESTROYCONTENT               DrmDestroyContent;&#10;  PFNDRMFORWARDCONTENTTODEVICEOBJECT DrmForwardContentToDeviceObject;&#10;  PFNDRMFORWARDCONTENTTOFILEOBJECT   DrmForwardContentToFileObject;&#10;  PFNDRMFORWARDCONTENTTOINTERFACE    DrmForwardContentToInterface;&#10;  PFNDRMGETCONTENTRIGHTS             DrmGetContentRights;&#10;} KSP_DRMAUDIOSTREAM_CONTENTID, *PKSP_DRMAUDIOSTREAM_CONTENTID;">KSP_DRMAUDIOSTREAM_CONTENTID</a></td>
  <td><a href="ksdrmaudiostream_contentid" title="typedef struct {&#10;  ULONG     ContentId;&#10;  DRMRIGHTS DrmRights;&#10;} KSDRMAUDIOSTREAM_CONTENTID, *PKSDRMAUDIOSTREAM_CONTENTID;">KSDRMAUDIOSTREAM_CONTENTID</a></td>
</tr>
</tbody>
</table>

<p>The property value (operation data) is a <a href="ksdrmaudiostream_contentid" title="typedef struct {&#10;  ULONG     ContentId;&#10;  DRMRIGHTS DrmRights;&#10;} KSDRMAUDIOSTREAM_CONTENTID, *PKSDRMAUDIOSTREAM_CONTENTID;">KSDRMAUDIOSTREAM_CONTENTID</a> structure that specifies the stream's DRM content ID and DRM content rights.</p>

<h3 id="return-value-2">Return Value</h3>

<p>A KSPROPERTY_DRMAUDIOSTREAM_CONTENTID property request returns a status code that indicates whether the KS filter can enforce the specified DRM content rights, as shown in the following table.</p>

<table>
<thead>
<tr>
  <th>Status Code</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></td>
  <td>The KS audio filter enforces the specified DRM content rights.</td>
</tr>
<tr>
  <td>STATUS_NOT_IMPLEMENTED</td>
  <td>The KS filter cannot enforce the specified DRM content rights.</td>
</tr>
</tbody>
</table>

<p>The <strong>DrmForwardContentToDeviceObject</strong> function uses this property to set the DRM content ID and content rights on the audio stream entering the KS pin that is the target of the property request.</p>

<p>A KS audio filter handles this property request synchronously. If the request returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, all the downstream KS audio nodes (see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/audio/audio-topology-nodes">Audio Topology Nodes</a>) of the target KS audio pin were also successfully configured with the specified DRM content ID and DRM content rights. (Note that a downstream node is a direct or indirect sink for the audio content flowing through an audio pin.)</p>

<p>The DRM system can set this property at any time during the lifetime of the file object that represents a KS audio pin. If the request does not succeed, the previously set DRM content ID and DRM content rights remain in effect on the KS audio stream.</p>

<p>The handler for the KSPROPERTY_DRMAUDIOSTREAM_CONTENTID property must verify that the property-request <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> originates in kernel mode (that is, confirm that the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>'s <strong>RequestorMode</strong> field equals <strong>KernelMode</strong>). If the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> originates in user mode, the handler must fail the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> and return status code INVALID_DEVICE_REQUEST.</p>

<p><strong>DrmForwardContentToDeviceObject</strong> is an entry point in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/audio/kernel-mode-wdm-audio-components">DRMK system driver</a>, Drmk.sys. DRMK sends an <a href="ioctl_ks_property" title="// CTL_CODE(0x002f, 0x000, METHOD_NEITHER, FILE_ANY_ACCESS)&#10;#define IOCTL_KS_PROPERTY 0x002F0003">IOCTL_KS_PROPERTY</a> request for the KSPROPERTY_DRMAUDIOSTREAM_CONTENTID property at IRQL PASSIVE_LEVEL.</p>

<h2 id="see-also">See also</h2>

<p><a href="drmforward" title="typedef struct tagDRMFORWARD {&#10;  DWORD          Flags;&#10;  PDEVICE_OBJECT DeviceObject;&#10;  PFILE_OBJECT   FileObject;&#10;  PVOID          Context;&#10;} DRMFORWARD, *PDRMFORWARD;">DRMFORWARD</a></p>

<p><a href="drmaddcontenthandlers" title="NTSTATUS DrmAddContentHandlers(&#10;  [in] ULONG ContentId,&#10;  [in] PVOID *paHandlers,&#10;  [in] ULONG NumHandlers&#10;);">DrmAddContentHandlers</a></p>

<p><a href="drmforwardcontenttointerface" title="NTSTATUS DrmForwardContentToInterface(&#10;  [in] ULONG    ContentId,&#10;  [in] PUNKNOWN pUnknown,&#10;  [in] ULONG    NumMethods&#10;);">DrmForwardContentToInterface</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/portcls/nf-portcls-idrmport2-forwardcontenttodeviceobject">IDrmPort2::ForwardContentToDeviceObject</a></p>

<p><a href="iocalldriver" title="#define IoCallDriver(a,b)   \&#10;        IofCallDriver(a,b)&#10;);">IoCallDriver</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff537351(v=vs.85)">KSPROPERTY_DRMAUDIOSTREAM_CONTENTID</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/portcls/nf-portcls-pcforwardcontenttodeviceobject">PcForwardContentToDeviceObject</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/drmk/nf-drmk-drmforwardcontenttodeviceobject">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/drmk/nf-drmk-drmforwardcontenttodeviceobject.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
