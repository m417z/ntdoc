<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KeInitializeQueue - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KeInitializeQueue - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KeInitializeQueue - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID KeInitializeQueue(
  [out] PRKQUEUE Queue,
  [in]  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>    Count
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-keinitializequeue">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/keinitializequeue.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-keinitializequeue)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="keinitializequeue-function">KeInitializeQueue function</h1>

<h2 id="description">Description</h2>

<p>The <strong>KeInitializeQueue</strong> routine initializes a queue object on which threads can wait for entries.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="queue-out"><code>Queue</code> [out]</h3>

<p>Pointer to a KQUEUE structure for which the caller must provide resident storage in nonpaged pool. This structure is defined as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>typedef struct _KQUEUE {
    DISPATCHER_HEADER Header;
    <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> EntryListHead;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> CurrentCount;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MaximumCount;
    <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> ThreadListHead;
} KQUEUE, *PKQUEUE, *RESTRICTED_POINTER PRKQUEUE;
</code></pre>

<table>
<thead>
<tr>
  <th>Member</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Header</strong></td>
  <td>Queue header.</td>
</tr>
<tr>
  <td><strong>EntryListHead</strong></td>
  <td>Pointer to the first entry in the queue.</td>
</tr>
<tr>
  <td><strong>CurrentCount</strong></td>
  <td>Current number of threads waiting on the queue.</td>
</tr>
<tr>
  <td><strong>MaximumCount</strong></td>
  <td>Maximum number of concurrent threads the queue can satisfy waits for.</td>
</tr>
<tr>
  <td><strong>ThreadListHead</strong></td>
  <td>Pointer to the first entry in the thread list.</td>
</tr>
</tbody>
</table>

<h3 id="count-in"><code>Count</code> [in]</h3>

<p>The maximum number of threads for which the waits on the queue object can be satisfied concurrently. If this parameter is not supplied, the number of processors in the machine is used.</p>

<h2 id="remarks">Remarks</h2>

<p>Usually the caller of <strong>KeInitializeQueue</strong> also creates a set of dedicated threads to queue and dequeue its entries. Such a caller can specify an explicit <em>Count</em> to prevent too many of its dedicated threads from waiting concurrently on its queue object.</p>

<p><strong>KeInitializeQueue</strong> sets the queue object's initial signal state to Not Signaled.</p>

<p>For more information about using driver-managed internal queues, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/driver-managed-irp-queues">Driver-Managed IRP Queues</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a></p>

<p><a href="ioallocateworkitem" title="PIO_WORKITEM IoAllocateWorkItem(&#10;  [in] PDEVICE_OBJECT DeviceObject&#10;);">IoAllocateWorkItem</a></p>

<p><a href="ioqueueworkitem" title="VOID IoQueueWorkItem(&#10;  [in]           __drv_aliasesMem PIO_WORKITEM IoWorkItem,&#10;  [in]           PIO_WORKITEM_ROUTINE          WorkerRoutine,&#10;  [in]           WORK_QUEUE_TYPE               QueueType,&#10;  [in, optional] __drv_aliasesMem PVOID        Context&#10;);">IoQueueWorkItem</a></p>

<p><a href="keinsertqueue" title="LONG KeInsertQueue(&#10;  [in, out] PRKQUEUE    Queue,&#10;  [in, out] PLIST_ENTRY Entry&#10;);">KeInsertQueue</a></p>

<p><a href="keremovequeue" title="PLIST_ENTRY KeRemoveQueue(&#10;  [in, out]      PRKQUEUE        Queue,&#10;  [in]           KPROCESSOR_MODE WaitMode,&#10;  [in, optional] PLARGE_INTEGER  Timeout&#10;);">KeRemoveQueue</a></p>

<p><a href="kerundownqueue" title="PLIST_ENTRY KeRundownQueue(&#10;  [in, out] PRKQUEUE Queue&#10;);">KeRundownQueue</a></p>

<p><a href="pscreatesystemthread" title="NTSTATUS PsCreateSystemThread(&#10;  [out]           PHANDLE            ThreadHandle,&#10;  [in]            ULONG              DesiredAccess,&#10;  [in, optional]  POBJECT_ATTRIBUTES ObjectAttributes,&#10;  [in, optional]  HANDLE             ProcessHandle,&#10;  [out, optional] PCLIENT_ID         ClientId,&#10;  [in]            PKSTART_ROUTINE    StartRoutine,&#10;  [in, optional]  PVOID              StartContext&#10;);">PsCreateSystemThread</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-keinitializequeue">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-keinitializequeue.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
