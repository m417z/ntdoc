<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_CDROM_EXCLUSIVE_ACCESS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_CDROM_EXCLUSIVE_ACCESS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_CDROM_EXCLUSIVE_ACCESS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddcdrm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0002, 0x017, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
#define IOCTL_CDROM_EXCLUSIVE_ACCESS 0x0002C05C</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddcdrm/ni-ntddcdrm-ioctl_cdrom_exclusive_access">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_cdrom_exclusive_access.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ntddcdrm-ioctl_cdrom_exclusive_access)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_cdrom_exclusive_access-ioctl">IOCTL_CDROM_EXCLUSIVE_ACCESS IOCTL</h1>

<h2 id="description">Description</h2>

<p>The IOCTL_CDROM_EXCLUSIVE_ACCESS request instructs the CD-ROM class driver to:</p>

<ul>
<li>Report the access state of a CD-ROM device.</li>
<li>Lock a CD-ROM device for exclusive access.</li>
<li>Unlock a CD-ROM device for exclusive access.</li>
</ul>

<p>A valid FileObject handle must exist in order for this IOCTL to succeed. The FileObject handle protects the system from unexpected application termination or accidental acquisition of an exclusive access lock without subsequent release of the exclusive access lock. A valid FileObject handle is necessary because when an application closes, the CD-ROM class driver will receive CLEANUP and CLOSE I/O Request Packets (IRPs), which it can use to automatically release an exclusive access lock obtained by that handle. This simple method protects against the majority of accidental releases of exclusive access. Any methods used to avoid this functionality may reduce the safety and effectiveness of the exclusive access locking method.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>Depending on the operation that the caller requests, the caller must provide one of the following structures as input at <strong>Irp->AssociatedIrp.SystemBuffer</strong>:</p>

<ul>
<li><a href="cdrom_exclusive_access" title="typedef struct _CDROM_EXCLUSIVE_ACCESS {&#10;  EXCLUSIVE_ACCESS_REQUEST_TYPE RequestType;&#10;  ULONG                         Flags;&#10;} CDROM_EXCLUSIVE_ACCESS, *PCDROM_EXCLUSIVE_ACCESS;">CDROM_EXCLUSIVE_ACCESS</a> (to report the access state of a CD-ROM device)</li>
<li><a href="cdrom_exclusive_lock" title="typedef struct _CDROM_EXCLUSIVE_LOCK {&#10;  CDROM_EXCLUSIVE_ACCESS Access;&#10;  UCHAR                  CallerName[CDROM_EXCLUSIVE_CALLER_LENGTH];&#10;} CDROM_EXCLUSIVE_LOCK, *PCDROM_EXCLUSIVE_LOCK;">CDROM_EXCLUSIVE_LOCK</a> (to lock a CD-ROM device for exclusive access)</li>
<li><a href="cdrom_exclusive_access" title="typedef struct _CDROM_EXCLUSIVE_ACCESS {&#10;  EXCLUSIVE_ACCESS_REQUEST_TYPE RequestType;&#10;  ULONG                         Flags;&#10;} CDROM_EXCLUSIVE_ACCESS, *PCDROM_EXCLUSIVE_ACCESS;">CDROM_EXCLUSIVE_ACCESS</a> (to unlock a CD-ROM device that the application locked for exclusive access)</li>
</ul>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>The <strong>Parameters.DeviceIoControl.InputBufferLength</strong> member in the <a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a> structure indicates the size, in bytes, of the user-allocated input buffer.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>If the caller requests the exclusive access state of the CD-ROM device (<strong>RequestType</strong> = <strong>ExclusiveAccessQueryState</strong>), the CD-ROM class driver returns a <a href="cdrom_exclusive_lock_state" title="typedef struct _CDROM_EXCLUSIVE_LOCK_STATE {&#10;  BOOLEAN LockState;&#10;  UCHAR   CallerName[CDROM_EXCLUSIVE_CALLER_LENGTH];&#10;} CDROM_EXCLUSIVE_LOCK_STATE, *PCDROM_EXCLUSIVE_LOCK_STATE;">CDROM_EXCLUSIVE_LOCK_STATE</a>-type structure in the buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong> whose <strong>LockState</strong> member indicates the access state of the device.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p>The <strong>Parameters.DeviceIoControl.OutputBufferLength</strong> member in the I/O stack location (<a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a>) indicates the size, in bytes, of the output buffer.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p>The <strong>Information</strong> field is set to the number of bytes that are returned. The <strong>Status</strong> field is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the request succeeds.</p>

<p>If the request fails, the <strong>Status</strong> field might be set to one of the following error messages:</p>

<p><strong>STATUS_ACCESS_DENIED (Windows error code: ERROR_ACCESS_DENIED)</strong></p>

<p>The device is already locked for exclusive access.</p>

<p><strong>STATUS_BUFFER_TOO_SMALL (Windows error code: ERROR_INSUFFICIENT_BUFFER)</strong></p>

<p>The output buffer was too small for a <strong>ExclusiveAccessQueryState</strong> request.</p>

<p><strong>STATUS_INFO_LENGTH_MISMATCH (Windows error code: ERROR_BAD_LENGTH)</strong></p>

<p>The input buffer was too small.</p>

<p><strong>STATUS_INVALID_DEVICE_REQUEST (Windows error code: ERROR_INVALID_FUNCTION)</strong></p>

<p>The CD-ROM class driver returns this status code when one of the following two errors occurs:</p>

<ul>
<li>The caller made the request at an IRQL level other than PASSIVE_LEVEL.</li>
<li>The caller sent a request with <strong>RequestType</strong> = <strong>ExclusiveAccessUnlockDevice</strong> to unlock a device that is not in exclusive mode.</li>
</ul>

<p><strong>STATUS_INVALID_DEVICE_STATE (Windows error code: ERROR_BAD_COMMAND)</strong></p>

<p>The caller attempted to lock a device while the file system driver was mounted on this device, without specifying that the class driver should suspend the check for a mounted file system driver. To suspend the check for a mounted file system driver, the caller must set the <strong>Flags</strong> member of <a href="cdrom_exclusive_access" title="typedef struct _CDROM_EXCLUSIVE_ACCESS {&#10;  EXCLUSIVE_ACCESS_REQUEST_TYPE RequestType;&#10;  ULONG                         Flags;&#10;} CDROM_EXCLUSIVE_ACCESS, *PCDROM_EXCLUSIVE_ACCESS;">CDROM_EXCLUSIVE_ACCESS</a> to 1.</p>

<p><strong>STATUS_INVALID_HANDLE (Windows error code: ERROR_INVALID_HANDLE)</strong></p>

<p>The CD-ROM class driver returns this status code when one of the following two errors occurs:</p>

<ul>
<li>The file object that is required to keep track of the request was not available. The CD-ROM class driver did not receive a request to create a file object from this caller.</li>
<li>The caller sent a request with <strong>RequestType</strong> = <strong>ExclusiveAccessUnlockDevice</strong> to unlock a device, even though the caller does not have exclusive access to the device.</li>
</ul>

<p><strong>STATUS_INVALID_PARAMETER (Windows error code: ERROR_INVALID_PARAMETER)</strong></p>

<p>The CD-ROM class driver returns this status code when one of the following two errors occurs:</p>

<ul>
<li>The <strong>RequestType</strong> that was specified is not a valid member of <a href="exclusive_access_request_type" title="typedef enum _EXCLUSIVE_ACCESS_REQUEST_TYPE {&#10;  ExclusiveAccessQueryState,&#10;  ExclusiveAccessLockDevice,&#10;  ExclusiveAccessUnlockDevice&#10;} EXCLUSIVE_ACCESS_REQUEST_TYPE, *PEXCLUSIVE_ACCESS_REQUEST_TYPE;">EXCLUSIVE_ACCESS_REQUEST_TYPE</a>.</li>
<li>The caller name string in the <strong>CallerName</strong> member of <a href="cdrom_exclusive_lock" title="typedef struct _CDROM_EXCLUSIVE_LOCK {&#10;  CDROM_EXCLUSIVE_ACCESS Access;&#10;  UCHAR                  CallerName[CDROM_EXCLUSIVE_CALLER_LENGTH];&#10;} CDROM_EXCLUSIVE_LOCK, *PCDROM_EXCLUSIVE_LOCK;">CDROM_EXCLUSIVE_LOCK</a> violates the naming convention. <strong>CallerName</strong> must be a <strong>NULL</strong>-terminated string that contains the following characters: alphanumerics (A - Z, a - z, 0 - 9), spaces, periods, commas, colons (:), semi-colons (;), hyphens (-), and underscores (_). The length of the string must be less than CDROM_EXCLUSIVE_CALLER_LENGTH bytes, including the <strong>NULL</strong> at the end of the string.</li>
</ul>

<h2 id="see-also">See also</h2>

<p><a href="cdrom_exclusive_access" title="typedef struct _CDROM_EXCLUSIVE_ACCESS {&#10;  EXCLUSIVE_ACCESS_REQUEST_TYPE RequestType;&#10;  ULONG                         Flags;&#10;} CDROM_EXCLUSIVE_ACCESS, *PCDROM_EXCLUSIVE_ACCESS;">CDROM_EXCLUSIVE_ACCESS</a></p>

<p><a href="cdrom_exclusive_lock" title="typedef struct _CDROM_EXCLUSIVE_LOCK {&#10;  CDROM_EXCLUSIVE_ACCESS Access;&#10;  UCHAR                  CallerName[CDROM_EXCLUSIVE_CALLER_LENGTH];&#10;} CDROM_EXCLUSIVE_LOCK, *PCDROM_EXCLUSIVE_LOCK;">CDROM_EXCLUSIVE_LOCK</a></p>

<p><a href="cdrom_exclusive_lock_state" title="typedef struct _CDROM_EXCLUSIVE_LOCK_STATE {&#10;  BOOLEAN LockState;&#10;  UCHAR   CallerName[CDROM_EXCLUSIVE_CALLER_LENGTH];&#10;} CDROM_EXCLUSIVE_LOCK_STATE, *PCDROM_EXCLUSIVE_LOCK_STATE;">CDROM_EXCLUSIVE_LOCK_STATE</a></p>

<p><a href="exclusive_access_request_type" title="typedef enum _EXCLUSIVE_ACCESS_REQUEST_TYPE {&#10;  ExclusiveAccessQueryState,&#10;  ExclusiveAccessLockDevice,&#10;  ExclusiveAccessUnlockDevice&#10;} EXCLUSIVE_ACCESS_REQUEST_TYPE, *PEXCLUSIVE_ACCESS_REQUEST_TYPE;">EXCLUSIVE_ACCESS_REQUEST_TYPE</a></p>

<p><a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddcdrm/ni-ntddcdrm-ioctl_cdrom_exclusive_access">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddcdrm/ni-ntddcdrm-ioctl_cdrom_exclusive_access.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
