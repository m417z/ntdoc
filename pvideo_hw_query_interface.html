<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PVIDEO_HW_QUERY_INTERFACE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PVIDEO_HW_QUERY_INTERFACE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PVIDEO_HW_QUERY_INTERFACE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// video.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PVIDEO_HW_QUERY_INTERFACE PvideoHwQueryInterface;

VP_STATUS PvideoHwQueryInterface(
  PVOID HwDeviceExtension,
  <a href="query_interface" title="typedef struct _QUERY_INTERFACE {&#10;  const GUID *InterfaceType;&#10;  USHORT     Size;&#10;  USHORT     Version;&#10;  PINTERFACE Interface;&#10;  PVOID      InterfaceSpecificData;&#10;  ULONG      DeviceUid;&#10;} QUERY_INTERFACE, *PQUERY_INTERFACE;">PQUERY_INTERFACE</a> QueryInterface
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_query_interface">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pvideo_hw_query_interface.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-video-pvideo_hw_query_interface)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pvideo_hw_query_interface-callback-function">PVIDEO_HW_QUERY_INTERFACE callback function</h1>

<h2 id="description">Description</h2>

<p><em>HwVidQueryInterface</em> returns a miniport driver-implemented functional interface that a child device can call.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hwdeviceextension"><code>HwDeviceExtension</code></h3>

<p>Pointer to the miniport driver's per-adapter storage area. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/device-extensions">Device Extensions</a>.</p>

<h3 id="queryinterface"><code>QueryInterface</code></h3>

<p>Pointer to a <a href="query_interface" title="typedef struct _QUERY_INTERFACE {&#10;  const GUID *InterfaceType;&#10;  USHORT     Size;&#10;  USHORT     Version;&#10;  PINTERFACE Interface;&#10;  PVOID      InterfaceSpecificData;&#10;  ULONG      DeviceUid;&#10;} QUERY_INTERFACE, *PQUERY_INTERFACE;">QUERY_INTERFACE</a> structure in which the miniport driver should return information about the interface it supports.</p>

<h2 id="return-value">Return value</h2>

<p><em>HwVidQueryInterface</em> should return NO_ERROR upon success; otherwise it should return the appropriate error code. For example, a miniport driver should return ERROR_OUTOFMEMORY if it cannot allocate memory to complete the operation.</p>

<h2 id="remarks">Remarks</h2>

<p><em>HwVidQueryInterface</em> exposes a communication mechanism between the video miniport driver and the driver of a child device. A miniport driver that exposes such a mechanism should implement this function.</p>

<p>The video port calls <em>HwVidQueryInterface</em> when it receives an <a href="irp_mn_query_interface" title="#define IRP_MN_QUERY_INTERFACE 0x08">IRP_MN_QUERY_INTERFACE</a> request. If the miniport driver fails the call, the video port driver passes the request to the parent of the miniport driver's device.</p>

<p><em>HwVidQueryInterface</em> should fill in the members of the <a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a> structure to which <em>QueryInterface</em>-><strong>Interface</strong> points as follows:</p>

<ul>
<li>Set <strong>Size</strong> to the number of bytes in the <a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a> structure. This value must not exceed the number of bytes specified by <em>QueryInterface</em>-><strong>Size</strong>.</li>
<li>Set <strong>Version</strong> to the version of the interface being returned by the miniport driver. The miniport driver should best match the version requested by the child driver in <em>QueryInterface</em>-><strong>Version</strong>.</li>
<li>Set <strong>Context</strong> to point to a miniport driver-defined context for the interface. Typically, a miniport driver would set <strong>Context</strong> to point to the device extension identified by <em>HwDeviceExtension</em>.</li>
<li>Initialize <strong>InterfaceReference</strong> and <strong>InterfaceDereference</strong> to point to the miniport driver-implemented reference and dereference routines for this interface.</li>
<li>Initialize all additional interface-specific members to point to the appropriate routines of the interface being exposed.</li>
</ul>

<p>A miniport driver that returns an interface is responsible for referencing the interface by calling <em>QueryInterface</em>-><strong>Interface.InterfaceReference</strong>. The child driver requesting the interface is responsible for dereferencing it when the driver no longer requires the interface by calling <em>QueryInterface</em>-><strong>Interface.InterfaceDereference</strong>. If the child driver passes the interface to another component, the child is responsible for taking out another reference, and the other component is responsible for removing the additional reference when it no longer needs access to the interface. Referencing allows a parent to determine when the interface is still required by the child device, and consequently when the parent can free any interface-associated resources.</p>

<p>The driver of a child device can call into the miniport driver through the functions exposed by <em>HwVidQueryInterface</em> at any time without the video port driver's knowledge. Consequently, the miniport driver must synchronize access to itself by acquiring and releasing the video port driver-maintained device lock in all of the functions exposed by <em>HwVidQueryInterface</em>.</p>

<p>A child device is enumerated by <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_get_child_descriptor">HwVidGetVideoChildDescriptor</a>.</p>

<p><em>HwVidQueryInterface</em> should be made pageable.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_get_child_descriptor">HwVidGetVideoChildDescriptor</a></p>

<p><a href="query_interface" title="typedef struct _QUERY_INTERFACE {&#10;  const GUID *InterfaceType;&#10;  USHORT     Size;&#10;  USHORT     Version;&#10;  PINTERFACE Interface;&#10;  PVOID      InterfaceSpecificData;&#10;  ULONG      DeviceUid;&#10;} QUERY_INTERFACE, *PQUERY_INTERFACE;">QUERY_INTERFACE</a></p>

<p><a href="videoportacquiredevicelock" title="VIDEOPORT_API VOID VideoPortAcquireDeviceLock(&#10;  [in] IN PVOID HwDeviceExtension&#10;);">VideoPortAcquireDeviceLock</a></p>

<p><a href="videoportreleasedevicelock" title="VIDEOPORT_API VOID VideoPortReleaseDeviceLock(&#10;  [in] IN PVOID HwDeviceExtension&#10;);">VideoPortReleaseDeviceLock</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_query_interface">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/video/nc-video-pvideo_hw_query_interface.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
