<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KsAddItemToObjectBag - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KsAddItemToObjectBag - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KsAddItemToObjectBag - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">KSDDKAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> KsAddItemToObjectBag(
  [in]           KSOBJECT_BAG           ObjectBag,
  [in]           __drv_aliasesMem PVOID Item,
  [in, optional] PFNKSFREE              Free
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-ksadditemtoobjectbag">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ksadditemtoobjectbag.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ks-ksadditemtoobjectbag)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ksadditemtoobjectbag-function">KsAddItemToObjectBag function</h1>

<h2 id="description">Description</h2>

<p>The <strong>KsAddItemToObjectBag</strong> function adds an object or block of memory to the given object bag.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="objectbag-in"><code>ObjectBag</code> [in]</h3>

<p>The KSOBJECT_BAG (equivalent to type PVOID) to which to add the requested item. Every AVStream object (for example, <a href="ksfilter" title="typedef struct _KSFILTER {&#10;  const KSFILTER_DESCRIPTOR *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;} KSFILTER, *PKSFILTER;">KSFILTER</a> and <a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">KSPIN</a>) contains a member called <em>Bag</em>. Pass that member in this parameter.</p>

<h3 id="item-in"><code>Item</code> [in]</h3>

<p>A pointer to the item to add to the object bag.</p>

<h3 id="free-in-optional"><code>Free</code> [in, optional]</h3>

<p>A function that is called when the item is removed from the object bag or when the object bag is deleted. This function typically is used to free any dynamic memory associated with <em>Item</em>. The function should be prototyped as follows:</p>

<div class="codehilite">
<pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">Free</span><span class="w"> </span><span class="p">(</span><span class="n">IN</span><span class="w"> </span><span class="n">PVOID</span><span class="w"> </span><span class="n">Data</span><span class="p">);</span>
</code></pre>
</div>

<p>If the caller does not specify this optional parameter, <em>Item</em> is freed with <a href="exfreepool" title="void ExFreePool(&#10;  a&#10;);">ExFreePool</a> when removed from the object bag or when the object bag is deleted.</p>

<h2 id="return-value">Return value</h2>

<p>Either returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> indicating that the addition went normally or STATUS_INSUFFICIENT_RESOURCES indicating that there are insufficient system resources for the operation to proceed.</p>

<h2 id="remarks">Remarks</h2>

<p>Before calling <strong>KsAddItemToObjectBag</strong>, the minidriver must acquire the mutex associated with the specific object bag. If <em>ObjectBag</em> is a member of a <a href="ksdevice" title="typedef struct _KSDEVICE {&#10;  const KSDEVICE_DESCRIPTOR *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  PDEVICE_OBJECT            FunctionalDeviceObject;&#10;  PDEVICE_OBJECT            PhysicalDeviceObject;&#10;  PDEVICE_OBJECT            NextDeviceObject;&#10;  BOOLEAN                   Started;&#10;  SYSTEM_POWER_STATE        SystemPowerState;&#10;  DEVICE_POWER_STATE        DevicePowerState;&#10;} KSDEVICE, *PKSDEVICE;">KSDEVICE</a> or <a href="ksfilterfactory" title="typedef struct _KSFILTERFACTORY {&#10;  const KSFILTER_DESCRIPTOR *FilterDescriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;} KSFILTERFACTORY, *PKSFILTERFACTORY;">KSFILTERFACTORY</a>, acquire the device mutex. If the bag is a member of a <a href="ksfilter" title="typedef struct _KSFILTER {&#10;  const KSFILTER_DESCRIPTOR *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;} KSFILTER, *PKSFILTER;">KSFILTER</a>, acquire the filter control mutex. If the bag is a member of a <a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">KSPIN</a> object, acquire the parent <a href="ksfilter" title="typedef struct _KSFILTER {&#10;  const KSFILTER_DESCRIPTOR *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;} KSFILTER, *PKSFILTER;">KSFILTER</a>'s filter control mutex.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/object-bags">Object Bags</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/mutexes-in-avstream">Mutexes in AVStream</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="exfreepool" title="void ExFreePool(&#10;  a&#10;);">ExFreePool</a></p>

<p><a href="ksallocateobjectbag" title="KSDDKAPI NTSTATUS KsAllocateObjectBag(&#10;  [in]  PKSDEVICE    Device,&#10;  [out] KSOBJECT_BAG *ObjectBag&#10;);">KsAllocateObjectBag</a></p>

<p><a href="kscopyobjectbagitems" title="KSDDKAPI NTSTATUS KsCopyObjectBagItems(&#10;  [in] KSOBJECT_BAG ObjectBagDestination,&#10;  [in] KSOBJECT_BAG ObjectBagSource&#10;);">KsCopyObjectBagItems</a></p>

<p><a href="ksdiscard" title="void KsDiscard(&#10;  [in] Object,&#10;  [in] Pointer&#10;);">KsDiscard</a></p>

<p><a href="ksfreeobjectbag" title="void KsFreeObjectBag(&#10;  [in] KSOBJECT_BAG ObjectBag&#10;);">KsFreeObjectBag</a></p>

<p><a href="ksremoveitemfromobjectbag" title="KSDDKAPI ULONG KsRemoveItemFromObjectBag(&#10;  [in] KSOBJECT_BAG ObjectBag,&#10;  [in] PVOID        Item,&#10;  [in] BOOLEAN      Free&#10;);">KsRemoveItemFromObjectBag</a></p>

<p><a href="_ksedit" title="KSDDKAPI NTSTATUS _KsEdit(&#10;  [in]      KSOBJECT_BAG ObjectBag,&#10;  [in, out] PVOID        *PointerToPointerToItem,&#10;  [in]      ULONG        NewSize,&#10;  [in]      ULONG        OldSize,&#10;  [in]      ULONG        Tag&#10;);">_KsEdit</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-ksadditemtoobjectbag">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/nf-ks-ksadditemtoobjectbag.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
