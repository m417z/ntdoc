<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FsRtlRegisterUncProvider - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FsRtlRegisterUncProvider - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FsRtlRegisterUncProvider - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> FsRtlRegisterUncProvider(
  [out] PHANDLE          MupHandle,
        <a href="pcunicode_string" title="typedef const UNICODE_STRING *PCUNICODE_STRING;">PCUNICODE_STRING</a> RedirectorDeviceName,
  [in]  BOOLEAN          MailslotsSupported
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlregisteruncprovider">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsrtlregisteruncprovider.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlregisteruncprovider)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fsrtlregisteruncprovider-function">FsRtlRegisterUncProvider function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FsRtlRegisterUncProvider</strong> routine registers a network redirector as a universal naming convention (UNC) provider with the system multiple UNC provider (MUP).</p>

<h2 id="parameters">Parameters</h2>

<h3 id="muphandle-out"><code>MupHandle</code> [out]</h3>

<p>A pointer to a location in which to return a MUP handle to be used when calling <strong>FsRtlRegisterUncProvider</strong> to deregister the network redirector. The returned handle is valid only if <strong>FsRtlRegisterUncProvider</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>.</p>

<h3 id="redirectordevicename"><code>RedirectorDeviceName</code></h3>

<p>A pointer to a Unicode string that contains the device name of the network redirector.</p>

<h3 id="mailslotssupported-in"><code>MailslotsSupported</code> [in]</h3>

<p>Set to <strong>TRUE</strong> if the network redirector supports mailslots. This option is normally reserved for use by the Microsoft SMB redirector.</p>

<h2 id="return-value">Return value</h2>

<p><strong>FsRtlRegisterUncProvider</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success or an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value such as one of the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_ACCESS_DENIED</strong></td>
  <td>The execution mode of the original requester for the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> operation sent to MUP was not from kernel mode.</td>
</tr>
<tr>
  <td><strong>STATUS_ACCESS_VIOLATION</strong></td>
  <td>An access violation occurred when attempting access to the MUP device.</td>
</tr>
<tr>
  <td><strong>STATUS_DATATYPE_MISALIGNMENT</strong></td>
  <td>There was a misalignment of data.</td>
</tr>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>There were insufficient resources available to allocate memory for buffers.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_HANDLE</strong></td>
  <td>An invalid parameter was passed to MUP in the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_USER_BUFFER</strong></td>
  <td>An invalid parameter was passed in the <em>RedirDevName</em> parameter or an abnormal termination occurred.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A network redirector must register with the MUP to handle UNC names. MUP is a kernel-mode component responsible for channeling all remote file system accesses using a Universal Naming Convention (UNC) name to a network redirector (the UNC provider) that is capable of handling the remote file system requests. MUP is involved when a UNC path is used by an application as illustrated by the following example that could be executed from a command line:</p>

<pre><code>notepad \\server\public\readme.txt
</code></pre>

<p>MUP is not involved during an operation that creates a mapped drive letter (the "NET USE" command, for example). This operation is handled by the multiple provider router (MPR) and a user-mode WNet provider DLL for the network redirector. However, a user-mode WNet provider DLL might communicate directly with a kernel-mode network redirector driver during this operation.</p>

<p>On Windows Server 2003, Windows XP, and Windows 2000, remote file operations performed on a mapped drive that does not represent a Distributed File System (DFS) drive don't go through MUP. These operations go directly to the network provider that handled the drive letter mapping.</p>

<p>For network redirectors that conform to the Windows Vistaredirector model, MUP is involved even when a mapped network drive is used. File operations performed on the mapped drive go through MUP to the network redirector. Note that in this case that MUP simply passes the operation to the network redirector that is involved.</p>

<p>Network redirectors that conform to the Windows Vista redirector model should use <a href="fsrtlregisteruncproviderex" title="NTSTATUS FsRtlRegisterUncProviderEx(&#10;  [out] PHANDLE                  MupHandle,&#10;  [in]  PCUNICODE_STRING         RedirDevName,&#10;  [in]  PDEVICE_OBJECT           DeviceObject,&#10;  [in]  FSRTL_UNC_PROVIDER_FLAGS Flags&#10;);">FsRtlRegisterUncProviderEx</a>, not <strong>FsRtlRegisterUncProvider</strong>.</p>

<p><strong>FsRtlRegisterUncProvider</strong> sends a private file system control (FSCTL) to MUP to perform the registration.</p>

<p>The ProviderOrder registry value determines the order in which MUP issues prefix resolution requests to individual network redirectors. This registry value is located under the following registry key:</p>

<pre><code>HKLM\CurrentControlSet\Control\NetworkProvider\Order
</code></pre>

<p>Changes to the ProviderOrder registry value require a reboot to take effect in MUP on Windows Server 2003, Windows XP, and Windows 2000.</p>

<p>Only one network provider on a system can support mailslots. So the <em>MailslotsSupported</em> parameter is normally only set to <strong>TRUE</strong> for the Microsoft SMB redirector.</p>

<p>A driver calling <a href="iocreatedevice" title="NTSTATUS IoCreateDevice(&#10;  [in]           PDRIVER_OBJECT  DriverObject,&#10;  [in]           ULONG           DeviceExtensionSize,&#10;  [in, optional] PUNICODE_STRING DeviceName,&#10;  [in]           DEVICE_TYPE     DeviceType,&#10;  [in]           ULONG           DeviceCharacteristics,&#10;  [in]           BOOLEAN         Exclusive,&#10;  [out]          PDEVICE_OBJECT  *DeviceObject&#10;);">IoCreateDevice</a> to create a device object for a network redirector that registers as a UNC provider (a driver that calls <strong>FsRtlRegisterUncProvider</strong>) must pass <a href="file_remote_device" title="#define FILE_REMOTE_DEVICE 0x00000010">FILE_REMOTE_DEVICE</a> as one of the options in the <em>DeviceCharacteristics</em> parameter that is passed to <strong><a href="iocreatedevice" title="NTSTATUS IoCreateDevice(&#10;  [in]           PDRIVER_OBJECT  DriverObject,&#10;  [in]           ULONG           DeviceExtensionSize,&#10;  [in, optional] PUNICODE_STRING DeviceName,&#10;  [in]           DEVICE_TYPE     DeviceType,&#10;  [in]           ULONG           DeviceCharacteristics,&#10;  [in]           BOOLEAN         Exclusive,&#10;  [out]          PDEVICE_OBJECT  *DeviceObject&#10;);">IoCreateDevice</a></strong>.</p>

<p>To deregister a UNC provider, use <a href="fsrtlderegisteruncprovider" title="VOID FsRtlDeregisterUncProvider(&#10;  [in] HANDLE Handle&#10;);">FsRtlDeregisterUncProvider</a> and pass the <em>MupHandle</em> parameter.</p>

<p>If a driver registers as a local disk file system (calls <a href="iocreatedevice" title="NTSTATUS IoCreateDevice(&#10;  [in]           PDRIVER_OBJECT  DriverObject,&#10;  [in]           ULONG           DeviceExtensionSize,&#10;  [in, optional] PUNICODE_STRING DeviceName,&#10;  [in]           DEVICE_TYPE     DeviceType,&#10;  [in]           ULONG           DeviceCharacteristics,&#10;  [in]           BOOLEAN         Exclusive,&#10;  [out]          PDEVICE_OBJECT  *DeviceObject&#10;);">IoCreateDevice</a> with the <em>DeviceType</em> parameter set to FILE_DEVICE_DISK_FILE_SYSTEM rather than FILE_NETWORK_FILE_SYSTEM, for example), the driver must not call <strong>FsRtlRegisterUncProvider</strong> to register as a UNC provider with MUP.</p>

<p>For more information, see the following sections in the Design Guide:</p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/support-for-unc-naming-and-mup">Support for UNC Naming and MUP</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/mup-changes-in-microsoft-windows-vista">MUP Changes in Microsoft Windows Vista</a></p>

<h2 id="see-also">See also</h2>

<p><a href="fsrtlderegisteruncprovider" title="VOID FsRtlDeregisterUncProvider(&#10;  [in] HANDLE Handle&#10;);">FsRtlDeregisterUncProvider</a></p>

<p><a href="fsrtlregisteruncproviderex" title="NTSTATUS FsRtlRegisterUncProviderEx(&#10;  [out] PHANDLE                  MupHandle,&#10;  [in]  PCUNICODE_STRING         RedirDevName,&#10;  [in]  PDEVICE_OBJECT           DeviceObject,&#10;  [in]  FSRTL_UNC_PROVIDER_FLAGS Flags&#10;);">FsRtlRegisterUncProviderEx</a></p>

<p><a href="ioctl_redir_query_path_ex" title="// CTL_CODE(0x0014, 0x064, METHOD_NEITHER, FILE_ANY_ACCESS)&#10;#define IOCTL_REDIR_QUERY_PATH_EX 0x00140193">IOCTL_REDIR_QUERY_PATH_EX</a></p>

<p><a href="iocreatedevice" title="NTSTATUS IoCreateDevice(&#10;  [in]           PDRIVER_OBJECT  DriverObject,&#10;  [in]           ULONG           DeviceExtensionSize,&#10;  [in, optional] PUNICODE_STRING DeviceName,&#10;  [in]           DEVICE_TYPE     DeviceType,&#10;  [in]           ULONG           DeviceCharacteristics,&#10;  [in]           BOOLEAN         Exclusive,&#10;  [out]          PDEVICE_OBJECT  *DeviceObject&#10;);">IoCreateDevice</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlregisteruncprovider">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlregisteruncprovider.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
