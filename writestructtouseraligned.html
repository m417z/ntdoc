<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WriteStructToUserAligned - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WriteStructToUserAligned - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WriteStructToUserAligned - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// usermode_accessors.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">void WriteStructToUserAligned(
  Destination,
  Source,
  Alignment
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usermode_accessors/nf-usermode_accessors-writestructtouseraligned">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/writestructtouseraligned.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-usermode_accessors-writestructtouseraligned)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>WriteStructToUserAligned</strong> macro safely writes a structure to user-mode memory with alignment validation.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="destination"><code>Destination</code></h3>

<p>[out] A pointer to the user-mode memory location where the structure will be written.</p>

<h3 id="source"><code>Source</code></h3>

<p>[in] A pointer to the structure to write to the destination memory location.</p>

<h3 id="alignment"><code>Alignment</code></h3>

<p>[in] The required alignment for the destination address, in bytes.</p>

<h2 id="remarks">Remarks</h2>

<p>This macro provides a safe way to write a structure to user-mode memory with alignment enforcement. It ensures the provided address is a user-mode address and meets the specified alignment requirements before writing to it.</p>

<p>The macro validates that <strong>Source</strong> and <strong>Destination</strong> point to compatible types and automatically determines the structure size for the copy operation.</p>

<p>This macro enforces alignment by verifying that the destination address meets the specified alignment requirement. This helps prevent performance penalties and potential hardware faults that can occur when accessing misaligned data structures.</p>

<p>It raises a structured exception if the memory access fails, such as when the destination address isn't a user-mode address, is inaccessible, or doesn't meet the alignment requirements.</p>

<p>This macro will never be optimized away by the compiler, nor will the compiler create additional accesses to this memory location before the macro is called or after the macro returns (unless the source code explicitly performs these accesses). The memory access is performed with <a rel="noopener" target="_blank" href="https://learn.microsoft.com/cpp/standard-library/atomic-enums?view=msvc-170#memory_order_enum">memory_order_relaxed semantics</a>.</p>

<p>This macro works on all versions of Windows, not just the latest. You need to consume the latest WDK to get the macro declaration from the <em>usermode_accessors.h</em> header. You also need the library (*umaccess.lib*) from the latest WDK. However, the resulting driver will run fine on older versions of Windows.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="writestructtouser" title="void WriteStructToUser(&#10;  Destination,&#10;  Source&#10;);">WriteStructToUser</a></strong></p>

<p><strong><a href="writestructtomodealigned" title="void WriteStructToModeAligned(&#10;  Destination,&#10;  Source,&#10;  Mode,&#10;  Alignment&#10;);">WriteStructToModeAligned</a></strong></p>

<p><strong><a href="writestructtouserhelper" title="VOID WriteStructToUserHelper(&#10;  volatile VOID *Destination,&#10;  const VOID    *Source,&#10;  SIZE_T        Size&#10;);">WriteStructToUserHelper</a></strong></p>

<p><strong><a href="readstructfromuseraligned" title="void ReadStructFromUserAligned(&#10;  Destination,&#10;  Source,&#10;  Alignment&#10;);">ReadStructFromUserAligned</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usermode_accessors/nf-usermode_accessors-writestructtouseraligned">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/usermode_accessors/nf-usermode_accessors-writestructtouseraligned.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
