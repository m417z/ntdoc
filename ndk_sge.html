<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDK_SGE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDK_SGE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDK_SGE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndkpi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDK_SGE {
  union {
    PVOID               VirtualAddress;
    NDK_LOGICAL_ADDRESS LogicalAddress;
  };
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  Length;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> MemoryRegionToken;
} NDK_SGE;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndkpi/ns-ndkpi-_ndk_sge">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndk_sge.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ndkpi-_ndk_sge)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_NDK_SGE structure</h1>
<h2>Description</h2>
<p>The <strong>NDK_SGE</strong> structure specifies the local buffers for NDK work requests.</p>
<h2>Members</h2>
<h3><code>VirtualAddress</code></h3>
<p>A virtual address.</p>
<h3><code>LogicalAddress</code></h3>
<p>A logical address.</p>
<h3><code>Length</code></h3>
<p>The length, in bytes, of the buffer.</p>
<h3><code>MemoryRegionToken</code></h3>
<p>A memory region token. When <strong>MemoryRegionToken</strong> is set to the token returned by <em>NdkGetPrivilegedMemoryRegionToken</em> (<a href="ndk_fn_get_privileged_memory_region_token" title="NDK_FN_GET_PRIVILEGED_MEMORY_REGION_TOKEN NdkFnGetPrivilegedMemoryRegionToken;&#10;&#10;VOID NdkFnGetPrivilegedMemoryRegionToken(&#10;  [in]  NDK_PD *pNdkPd,&#10;  [out] UINT32 *pToken&#10;)&#10;{...}">NDK_FN_GET_PRIVILEGED_MEMORY_REGION_TOKEN</a>), the <strong>NDK_SGE</strong> must contain a <strong>LogicalAddress</strong>. When <strong>MemoryRegionToken</strong> is not equal to the token returned by <em>NdkGetPrivilegedMemoryRegionToken</em>, the <strong>NDK_SGE</strong> structure must contain a <strong>VirtualAddress</strong>. When an <strong>NDK_SGE</strong> structure is used in a work request with the <strong>NDK_OP_FLAG_INLINE</strong> flag, <strong>MemoryRegionToken</strong> might be invalid. See the remarks section for more information about the <strong>MemoryRegionToken</strong>.</p>
<h2>Remarks</h2>
<p>The <strong>NDK_SGE</strong> structure specifies the local buffers for send, receive, read, and write work requests.</p>
<p>When the <strong>MemoryRegionToken</strong> member is set to the token returned by <em>NdkGetPrivilegedMemoryRegionToken</em> (<a href="ndk_fn_get_privileged_memory_region_token" title="NDK_FN_GET_PRIVILEGED_MEMORY_REGION_TOKEN NdkFnGetPrivilegedMemoryRegionToken;&#10;&#10;VOID NdkFnGetPrivilegedMemoryRegionToken(&#10;  [in]  NDK_PD *pNdkPd,&#10;  [out] UINT32 *pToken&#10;)&#10;{...}">NDK_FN_GET_PRIVILEGED_MEMORY_REGION_TOKEN</a>), the <strong>NDK_SGE</strong> must contain a logical address returned by the <em>NdkBuildLam</em> (<a href="ndk_fn_build_lam" title="NDK_FN_BUILD_LAM NdkFnBuildLam;&#10;&#10;NTSTATUS NdkFnBuildLam(&#10;  [in]           NDK_ADAPTER *pNdkAdapter,&#10;  [in]           MDL *Mdl,&#10;  [in]           SIZE_T Length,&#10;  [in]           NDK_FN_REQUEST_COMPLETION RequestCompletion,&#10;  [in, optional] PVOID RequestContext,&#10;                 NDK_LOGICAL_ADDRESS_MAPPING *pNdkLAM,&#10;                 ULONG *pLAMSize,&#10;  [out]          ULONG *pFBO&#10;)&#10;{...}">NDK_FN_BUILD_LAM</a>) function with the <a href="ndk_logical_address_mapping" title="typedef struct _NDK_LOGICAL_ADDRESS_MAPPING {&#10;  PVOID               AdapterContext;&#10;  ULONG               AdapterPageCount;&#10;  NDK_LOGICAL_ADDRESS AdapterPageArray[1];&#10;} NDK_LOGICAL_ADDRESS_MAPPING;">NDK_LOGICAL_ADDRESS_MAPPING</a> structure. Note that consecutive entries in the <strong>AdapterPageArray</strong> member of an <strong><a href="ndk_logical_address_mapping" title="typedef struct _NDK_LOGICAL_ADDRESS_MAPPING {&#10;  PVOID               AdapterContext;&#10;  ULONG               AdapterPageCount;&#10;  NDK_LOGICAL_ADDRESS AdapterPageArray[1];&#10;} NDK_LOGICAL_ADDRESS_MAPPING;">NDK_LOGICAL_ADDRESS_MAPPING</a></strong> are not necessarily contiguous pages in the adapter's logical address space. Therefore, an NDK consumer might use multiple SGEs to cover all of the pages in an adapter page array.</p>
<p>When the token in the <strong>MemoryRegionToken</strong> member is not equal to the token that is returned by <em>NdkGetPrivilegedMemoryRegionToken</em>, the <strong>NDK_SGE</strong> structure must contain a virtual address that falls within the virtual address span of a previously registered memory region.</p>
<p>When an <strong>NDK_SGE</strong> structure is used in a work request with the <strong>NDK_OP_FLAG_INLINE</strong> flag, the token in <strong>MemoryRegionToken</strong> might be invalid, so it must be ignored by the NDK provider. When the <strong>NDK_OP_FLAG_INLINE</strong> flag is specified, the <strong>VirtualAddress</strong> member of any <strong>NDK_SGE</strong> structure that is passed to the work request function must point to a buffer that can be accessed by the NDK provider at an IRQL less than or equal to <strong>DISPATCH_LEVEL</strong>, That is, the buffer must be guaranteed to be resident in physical memory until the work request function returns. The total size of inline data that is passed to the provider in a single call must not exceed the value in the <em>InlineDataSize</em> parameter that was specified when the queue pair (QP) was created.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndkpi-object-lifetime-requirements">NDKPI Object Lifetime Requirements</a></p>
<p><a href="ndk_fn_build_lam" title="NDK_FN_BUILD_LAM NdkFnBuildLam;&#10;&#10;NTSTATUS NdkFnBuildLam(&#10;  [in]           NDK_ADAPTER *pNdkAdapter,&#10;  [in]           MDL *Mdl,&#10;  [in]           SIZE_T Length,&#10;  [in]           NDK_FN_REQUEST_COMPLETION RequestCompletion,&#10;  [in, optional] PVOID RequestContext,&#10;                 NDK_LOGICAL_ADDRESS_MAPPING *pNdkLAM,&#10;                 ULONG *pLAMSize,&#10;  [out]          ULONG *pFBO&#10;)&#10;{...}">NDK_FN_BUILD_LAM</a></p>
<p><a href="ndk_fn_get_privileged_memory_region_token" title="NDK_FN_GET_PRIVILEGED_MEMORY_REGION_TOKEN NdkFnGetPrivilegedMemoryRegionToken;&#10;&#10;VOID NdkFnGetPrivilegedMemoryRegionToken(&#10;  [in]  NDK_PD *pNdkPd,&#10;  [out] UINT32 *pToken&#10;)&#10;{...}">NDK_FN_GET_PRIVILEGED_MEMORY_REGION_TOKEN</a></p>
<p><a href="ndk_fn_read" title="NDK_FN_READ NdkFnRead;&#10;&#10;NTSTATUS NdkFnRead(&#10;  [in]           NDK_QP *pNdkQp,&#10;  [in, optional] PVOID RequestContext,&#10;                 const NDK_SGE *pSgl,&#10;  [in]           ULONG nSge,&#10;  [in]           UINT64 RemoteAddress,&#10;  [in]           UINT32 RemoteToken,&#10;  [in]           ULONG Flags&#10;)&#10;{...}">NDK_FN_READ</a></p>
<p><a href="ndk_fn_receive" title="NDK_FN_RECEIVE NdkFnReceive;&#10;&#10;NTSTATUS NdkFnReceive(&#10;  [in]           NDK_QP *pNdkQp,&#10;  [in, optional] PVOID RequestContext,&#10;                 const NDK_SGE *pSgl,&#10;  [in]           ULONG nSge&#10;)&#10;{...}">NDK_FN_RECEIVE</a></p>
<p><a href="ndk_fn_send" title="NDK_FN_SEND NdkFnSend;&#10;&#10;NTSTATUS NdkFnSend(&#10;  [in]           NDK_QP *pNdkQp,&#10;  [in, optional] PVOID RequestContext,&#10;                 const NDK_SGE *pSgl,&#10;  [in]           ULONG nSge,&#10;  [in]           ULONG Flags&#10;)&#10;{...}">NDK_FN_SEND</a></p>
<p><a href="ndk_fn_srq_receive" title="NDK_FN_SRQ_RECEIVE NdkFnSrqReceive;&#10;&#10;NTSTATUS NdkFnSrqReceive(&#10;  [in]           NDK_SRQ *pNdkSrq,&#10;  [in, optional] PVOID RequestContext,&#10;                 const NDK_SGE *pSgl,&#10;  [in]           ULONG nSge&#10;)&#10;{...}">NDK_FN_SRQ_RECEIVE</a></p>
<p><a href="ndk_fn_write" title="NDK_FN_WRITE NdkFnWrite;&#10;&#10;NTSTATUS NdkFnWrite(&#10;  [in]           NDK_QP *pNdkQp,&#10;  [in, optional] PVOID RequestContext,&#10;                 const NDK_SGE *pSgl,&#10;  [in]           ULONG nSge,&#10;  [in]           UINT64 RemoteAddress,&#10;  [in]           UINT32 RemoteToken,&#10;  [in]           ULONG Flags&#10;)&#10;{...}">NDK_FN_WRITE</a></p>
<p><a href="ndk_logical_address_mapping" title="typedef struct _NDK_LOGICAL_ADDRESS_MAPPING {&#10;  PVOID               AdapterContext;&#10;  ULONG               AdapterPageCount;&#10;  NDK_LOGICAL_ADDRESS AdapterPageArray[1];&#10;} NDK_LOGICAL_ADDRESS_MAPPING;">NDK_LOGICAL_ADDRESS_MAPPING</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndkpi/ns-ndkpi-_ndk_sge">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndkpi/ns-ndkpi-_ndk_sge.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
