<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_PD_FLUSH_QUEUE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_PD_FLUSH_QUEUE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_PD_FLUSH_QUEUE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_PD_FLUSH_QUEUE NdisPdFlushQueue;

VOID() NdisPdFlushQueue(
  [in, out] <a href="ndis_pd_queue" title="typedef struct _NDIS_PD_QUEUE {&#10;  NDIS_OBJECT_HEADER           Header;&#10;  ULONG                        Flags;&#10;  const NDIS_PD_QUEUE_DISPATCH *Dispatch;&#10;  PVOID                        PDPlatformReserved[2];&#10;  PVOID                        PDClientReserved[2];&#10;} NDIS_PD_QUEUE;">NDIS_PD_QUEUE</a> *Queue
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_pd_flush_queue">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_pd_flush_queue.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-ndis_pd_flush_queue)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndis_pd_flush_queue-callback-function">NDIS_PD_FLUSH_QUEUE callback function</h1>

<h2 id="description">Description</h2>

<p>The PacketDirect (PD) platform calls a PD-capable miniport driver's
<em>PDFlushQueue</em> function to flush a specified queue, ensuring that any items that are not yet in a complete state in the queue will be completed imminently.</p>

<p><strong>Note</strong> You must declare the function by using the <strong>NDIS_PD_FLUSH_QUEUE</strong> type. For more
information, see the following Examples section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="queue-in-out"><code>Queue</code> [in, out]</h3>

<p>The queue to flush. For more information, see the <a href="ndis_pd_queue" title="typedef struct _NDIS_PD_QUEUE {&#10;  NDIS_OBJECT_HEADER           Header;&#10;  ULONG                        Flags;&#10;  const NDIS_PD_QUEUE_DISPATCH *Dispatch;&#10;  PVOID                        PDPlatformReserved[2];&#10;  PVOID                        PDClientReserved[2];&#10;} NDIS_PD_QUEUE;">NDIS_PD_QUEUE</a> structure.</p>

<h2 id="return-value">Return value</h2>

<p>This callback function does not return a value.</p>

<h2 id="remarks">Remarks</h2>

<p>The caller is responsible for waiting for and draining all previously posted requests before closing the queue. The caller must not post any further <a href="pd_buffer" title="typedef struct _PD_BUFFER {&#10;  struct _PD_BUFFER   *NextPDBuffer;&#10;  struct _PD_BUFFER   *NextPartialPDBuffer;&#10;  PVOID               PDClientReserved;&#10;  PVOID               PDClientContext;&#10;  PUCHAR              DataBufferVirtualAddress;&#10;  DMA_LOGICAL_ADDRESS DataBufferDmaLogicalAddress;&#10;  ULONG               DataBufferSize;&#10;  USHORT              PDClientContextSize;&#10;  USHORT              Attributes;&#10;  USHORT              Flags;&#10;  USHORT              DataStart;&#10;  ULONG               DataLength;&#10;  union {&#10;    struct {&#10;      union {&#10;        ULONG64 RxFilterContext;&#10;        ULONG64 GftFlowEntryId;&#10;      };&#10;      ULONG                         RxHashValue;&#10;...">PD_BUFFER</a> structures to the queue after this call. The primary use case for this routine is flushing the receive queues--if there's no incoming traffic, posted buffers will sit in the receive queue indefinitely, and these need to be drained by being flushed before the queue can be closed. The same issue does not exist for transmit queues in practice because transmit requests will not pend indefinitely. However, providers must honor the flush call for transmit queues (this may be a no-operation if the provider knows that the pending transmit request will complete very soon, which is the typical case except for L2 flow control).</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>PDFlushQueue</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>PDFlushQueue</em> function that is named "MyPDFlushQueue", use the <strong>NDIS_PD_FLUSH_QUEUE</strong> type as shown in this code example:</p>

<pre><code>NDIS_PD_FLUSH_QUEUE MyPDFlushQueue;
</code></pre>

<p>Then, implement your function as follows:</p>

<pre><code>_Use_decl_annotations_
VOID
 MyPDFlushQueue(
    <a href="ndis_pd_queue" title="typedef struct _NDIS_PD_QUEUE {&#10;  NDIS_OBJECT_HEADER           Header;&#10;  ULONG                        Flags;&#10;  const NDIS_PD_QUEUE_DISPATCH *Dispatch;&#10;  PVOID                        PDPlatformReserved[2];&#10;  PVOID                        PDClientReserved[2];&#10;} NDIS_PD_QUEUE;">NDIS_PD_QUEUE</a>*  NdisPDQueue
    )
  {...}
</code></pre>

<p>The <strong>NDIS_PD_FLUSH_QUEUE</strong> function type is defined in the Ntddndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the <em>Use_decl_annotations</em> annotation to your function definition. The <em>Use_decl_annotations</em> annotation ensures that the annotations that are applied to the <strong>NDIS_PD_FLUSH_QUEUE</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about <em>Use_decl_annotations</em>, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_pd_flush_queue">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-ndis_pd_flush_queue.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
