<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="_CPSUICALLBACK - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>_CPSUICALLBACK - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            _CPSUICALLBACK - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// compstui.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">_CPSUICALLBACK Cpsuicallback;

<a href="long" title="typedef long LONG;">LONG</a> Cpsuicallback(
  <a href="cpsuicbparam" title="typedef struct _CPSUICBPARAM {&#10;  WORD      cbSize;&#10;  WORD      Reason;&#10;  HWND      hDlg;&#10;  POPTITEM  pOptItem;&#10;  WORD      cOptItem;&#10;  WORD      Flags;&#10;  POPTITEM  pCurItem;&#10;  union {&#10;    LONG   OldSel;&#10;    LPTSTR pOldSel;&#10;  } DUMMYUNIONNAME;&#10;  ULONG_PTR UserData;&#10;  ULONG_PTR Result;&#10;} CPSUICBPARAM, *PCPSUICBPARAM;">PCPSUICBPARAM</a> pCPSUICBParam
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/compstui/nc-compstui-_cpsuicallback">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/_cpsuicallback.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-compstui-_cpsuicallback)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The _CPSUICALLBACK function type is used by CPSUI applications (including printer interface DLLs) for defining a callback function intended for use as a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/print/cpsui-message-handler">CPSUI message handler</a>.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="pcpsuicbparam"><code>pCPSUICBParam</code></h3>

<p>CPSUI-supplied pointer to a <strong><a href="cpsuicbparam" title="typedef struct _CPSUICBPARAM {&#10;  WORD      cbSize;&#10;  WORD      Reason;&#10;  HWND      hDlg;&#10;  POPTITEM  pOptItem;&#10;  WORD      cOptItem;&#10;  WORD      Flags;&#10;  POPTITEM  pCurItem;&#10;  union {&#10;    LONG   OldSel;&#10;    LPTSTR pOldSel;&#10;  } DUMMYUNIONNAME;&#10;  ULONG_PTR UserData;&#10;  ULONG_PTR Result;&#10;} CPSUICBPARAM, *PCPSUICBPARAM;">CPSUICBPARAM</a></strong> structure.</p>

<h2 id="return-value">Return value</h2>

<p>A _CPSUICALLBACK-typed callback function must return one of the values listed in the following table. Each value indicates an action that CPSUI should perform.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>CPSUICB_ACTION_ITEMS_APPLIED</strong></td>
  <td>The <strong><a href="cpsuicbparam" title="typedef struct _CPSUICBPARAM {&#10;  WORD      cbSize;&#10;  WORD      Reason;&#10;  HWND      hDlg;&#10;  POPTITEM  pOptItem;&#10;  WORD      cOptItem;&#10;  WORD      Flags;&#10;  POPTITEM  pCurItem;&#10;  union {&#10;    LONG   OldSel;&#10;    LPTSTR pOldSel;&#10;  } DUMMYUNIONNAME;&#10;  ULONG_PTR UserData;&#10;  ULONG_PTR Result;&#10;} CPSUICBPARAM, *PCPSUICBPARAM;">CPSUICBPARAM</a></strong> structure's <strong>Reason</strong> member was set to CPSUICB_REASON_APPLYNOW, and the callback function has successfully processed the current option values.</td>
</tr>
<tr>
  <td><strong>CPSUICB_ACTION_NO_APPLY_EXIT</strong></td>
  <td>The <strong><a href="cpsuicbparam" title="typedef struct _CPSUICBPARAM {&#10;  WORD      cbSize;&#10;  WORD      Reason;&#10;  HWND      hDlg;&#10;  POPTITEM  pOptItem;&#10;  WORD      cOptItem;&#10;  WORD      Flags;&#10;  POPTITEM  pCurItem;&#10;  union {&#10;    LONG   OldSel;&#10;    LPTSTR pOldSel;&#10;  } DUMMYUNIONNAME;&#10;  ULONG_PTR UserData;&#10;  ULONG_PTR Result;&#10;} CPSUICBPARAM, *PCPSUICBPARAM;">CPSUICBPARAM</a></strong> structure's <strong>Reason</strong> member was set to CPSUICB_REASON_APPLYNOW, but the callback function has detected invalid or incompatible option values. The callback function must display a dialog box telling the user of the problem.</td>
</tr>
<tr>
  <td><strong>CPSUICB_ACTION_NONE</strong></td>
  <td>No action by CPSUI is required.</td>
</tr>
<tr>
  <td><strong>CPSUICB_ACTION_OPTIF_CHANGED</strong></td>
  <td>The callback function has set the OPTIF_CHANGED flag in an <a href="optitem" title="typedef struct _OPTITEM {&#10;  WORD      cbSize;&#10;  BYTE      Level;&#10;  BYTE      DlgPageIdx;&#10;  DWORD     Flags;&#10;  ULONG_PTR UserData;&#10;  LPTSTR    pName;&#10;  union {&#10;    LONG   Sel;&#10;    LPTSTR pSel;&#10;  } DUMMYUNIONNAME;&#10;  union {&#10;    PEXTCHKBOX pExtChkBox;&#10;    PEXTPUSH   pExtPush;&#10;  } DUMMYUNIONNAME2;&#10;  POPTTYPE  pOptType;&#10;  DWORD     HelpIndex;&#10;  BYTE      DMPubID;&#10;  BYTE      UserItemID;&#10;  WORD      wReserved;&#10;...">OPTITEM</a> structure to indicate that the selected option has changed, or that another OPTIF-prefixed flag has changed.</td>
</tr>
<tr>
  <td><strong>CPSUICB_ACTION_REINIT_ITEMS</strong></td>
  <td>The callback function has set the OPTIF_CHANGED flag in an <a href="optitem" title="typedef struct _OPTITEM {&#10;  WORD      cbSize;&#10;  BYTE      Level;&#10;  BYTE      DlgPageIdx;&#10;  DWORD     Flags;&#10;  ULONG_PTR UserData;&#10;  LPTSTR    pName;&#10;  union {&#10;    LONG   Sel;&#10;    LPTSTR pSel;&#10;  } DUMMYUNIONNAME;&#10;  union {&#10;    PEXTCHKBOX pExtChkBox;&#10;    PEXTPUSH   pExtPush;&#10;  } DUMMYUNIONNAME2;&#10;  POPTTYPE  pOptType;&#10;  DWORD     HelpIndex;&#10;  BYTE      DMPubID;&#10;  BYTE      UserItemID;&#10;  WORD      wReserved;&#10;...">OPTITEM</a> structure to indicate that <strong>Flags</strong> or <strong>pData</strong> members of the associated <a href="opttype" title="typedef struct _OPTTYPE {&#10;  WORD      cbSize;&#10;  BYTE      Type;&#10;  BYTE      Flags;&#10;  WORD      Count;&#10;  WORD      BegCtrlID;&#10;  POPTPARAM pOptParam;&#10;  WORD      Style;&#10;  WORD      wReserved[3];&#10;  ULONG_PTR dwReserved[3];&#10;} OPTTYPE, *POPTTYPE;">OPTTYPE</a> or <a href="optparam" title="typedef struct _OPTPARAM {&#10;  WORD      cbSize;&#10;  BYTE      Flags;&#10;  BYTE      Style;&#10;  LPTSTR    pData;&#10;  ULONG_PTR IconID;&#10;  LPARAM    lParam;&#10;  ULONG_PTR dwReserved[2];&#10;} OPTPARAM, *POPTPARAM;">OPTPARAM</a> structure have changed.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Callback functions specified using the _CPSUICALLBACK function type are supplied by applications that use <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/print/common-property-sheet-user-interface">CPSUI</a> to manage property sheet pages. If one of these callback functions is associated with a property sheet page, CPSUI calls it when user activity (such as changing the page's control focus, modifying option values, or clicking <strong>OK</strong>) is detected.</p>

<p>A _CPSUICALLBACK-typed callback function is assigned to a property sheet page by including its address in a <strong><a href="compropsheetui" title="typedef struct _COMPROPSHEETUI {&#10;  WORD           cbSize;&#10;  WORD           Flags;&#10;  HINSTANCE      hInstCaller;&#10;  LPTSTR         pCallerName;&#10;  ULONG_PTR      UserData;&#10;  LPTSTR         pHelpFile;&#10;  _CPSUICALLBACK pfnCallBack;&#10;  POPTITEM       pOptItem;&#10;  PDLGPAGE       pDlgPage;&#10;  WORD           cOptItem;&#10;  WORD           cDlgPage;&#10;  ULONG_PTR      IconID;&#10;  LPTSTR         pOptItemName;&#10;  WORD           CallerVersion;&#10;  WORD           OptItemVersion;&#10;  ULONG_PTR      dwReserved[4];&#10;} COMPROPSHEETUI, *PCOMPROPSHEETUI;">COMPROPSHEETUI</a></strong> structure, which is passed to CPSUI's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/compstui/nc-compstui-pfncompropsheet">ComPropSheet</a> function when the function code is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff546388(v=vs.85)">CPSFUNC_ADD_PCOMPROPSHEETUI</a>.</p>

<p>Additionally, callback functions can be assigned to extended push buttons through the use of <a href="extpush" title="typedef struct _EXTPUSH {&#10;  WORD      cbSize;&#10;  WORD      Flags;&#10;  LPTSTR    pTitle;&#10;  union {&#10;    DLGPROC DlgProc;&#10;    FARPROC pfnCallBack;&#10;  } DUMMYUNIONNAME;&#10;  ULONG_PTR IconID;&#10;  union {&#10;    WORD   DlgTemplateID;&#10;    HANDLE hDlgTemplate;&#10;  } DUMMYUNIONNAME2;&#10;  ULONG_PTR dwReserved[3];&#10;} EXTPUSH, *PEXTPUSH;">EXTPUSH</a> structures.</p>

<p>When one of these callback functions is called, it receives a pointer to a <strong><a href="cpsuicbparam" title="typedef struct _CPSUICBPARAM {&#10;  WORD      cbSize;&#10;  WORD      Reason;&#10;  HWND      hDlg;&#10;  POPTITEM  pOptItem;&#10;  WORD      cOptItem;&#10;  WORD      Flags;&#10;  POPTITEM  pCurItem;&#10;  union {&#10;    LONG   OldSel;&#10;    LPTSTR pOldSel;&#10;  } DUMMYUNIONNAME;&#10;  ULONG_PTR UserData;&#10;  ULONG_PTR Result;&#10;} CPSUICBPARAM, *PCPSUICBPARAM;">CPSUICBPARAM</a></strong> structure. This structure describes the current option settings for the page and indicates the user event that caused the function to be called. The callback function is responsible for validating and processing the settings. It should display a dialog box if a setting (or a combination of settings) is invalid. The function's return value indicates to CPSUI whether the page needs to be redisplayed or reinitialized.</p>

<p>Callback functions specified with this function type cannot be used if the <strong>DlgProc</strong> member of the <strong><a href="dlgpage" title="typedef struct _DLGPAGE {&#10;  WORD      cbSize;&#10;  WORD      Flags;&#10;  DLGPROC   DlgProc;&#10;  LPTSTR    pTabName;&#10;  ULONG_PTR IconID;&#10;  union {&#10;    WORD   DlgTemplateID;&#10;    HANDLE hDlgTemplate;&#10;  } DUMMYUNIONNAME;&#10;} DLGPAGE, *PDLGPAGE;">DLGPAGE</a></strong> structure specifies an application-supplied dialog box procedure. This is because _CPSUICALLBACK-typed callbacks are called from CPSUI's dialog box procedures, which are not used if the application supplies its own procedures.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/compstui/nc-compstui-_cpsuicallback">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/compstui/nc-compstui-_cpsuicallback.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
