<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FSCTL_ENUM_EXTERNAL_BACKING - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FSCTL_ENUM_EXTERNAL_BACKING - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FSCTL_ENUM_EXTERNAL_BACKING - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0009, 0x0c6, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define FSCTL_ENUM_EXTERNAL_BACKING 0x00090318</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/fsctl-enum-external-backing">View the official Windows hardware development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsctl_enum_external_backing.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows hardware development documentation (fsctl-enum-external-backing)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>FSCTL_ENUM_EXTERNAL_BACKING control code</h1>
<p>The <strong>FSCTL_ENUM_EXTERNAL_BACKING</strong> control code begins or continues an enumeration of files on a volume that have a backing source. For each successful completion of the request, an identifier for the backed file is returned. All backed files are enumerated regardless of which external provider is backing it. Successive <strong>FSCTL_ENUM_EXTERNAL_BACKING</strong> requests are required to enumerate all the backed files on the volume.</p>
<p>To perform this operation, call <strong><a href="fltfscontrolfile" title="NTSTATUS FLTAPI FltFsControlFile(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PFILE_OBJECT  FileObject,&#10;  [in]            ULONG         FsControlCode,&#10;  [in, optional]  PVOID         InputBuffer,&#10;  [in]            ULONG         InputBufferLength,&#10;  [out, optional] PVOID         OutputBuffer,&#10;  [in]            ULONG         OutputBufferLength,&#10;  [out, optional] PULONG        LengthReturned&#10;);">FltFsControlFile</a></strong> or <a href="https://learn.microsoft.com/previous-versions/ff566462(v=vs.85)"><strong>ZwFsControlFile</strong></a> with the following parameters.</p>
<h2>Parameters</h2>
<ul>
<li>
<p><strong>Instance</strong> [in]: <strong><a href="fltfscontrolfile" title="NTSTATUS FLTAPI FltFsControlFile(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PFILE_OBJECT  FileObject,&#10;  [in]            ULONG         FsControlCode,&#10;  [in, optional]  PVOID         InputBuffer,&#10;  [in]            ULONG         InputBufferLength,&#10;  [out, optional] PVOID         OutputBuffer,&#10;  [in]            ULONG         OutputBufferLength,&#10;  [out, optional] PULONG        LengthReturned&#10;);">FltFsControlFile</a></strong> only. Opaque instance pointer for the caller. This parameter is required and cannot be <strong>NULL</strong>.</p>
</li>
<li>
<p><strong>FileObject</strong> [in]: <strong><a href="fltfscontrolfile" title="NTSTATUS FLTAPI FltFsControlFile(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PFILE_OBJECT  FileObject,&#10;  [in]            ULONG         FsControlCode,&#10;  [in, optional]  PVOID         InputBuffer,&#10;  [in]            ULONG         InputBufferLength,&#10;  [out, optional] PVOID         OutputBuffer,&#10;  [in]            ULONG         OutputBufferLength,&#10;  [out, optional] PULONG        LengthReturned&#10;);">FltFsControlFile</a></strong> only. The file pointer object specifying the volume to be dismounted. This parameter is required and cannot be <strong>NULL</strong>.</p>
</li>
<li>
<p><strong>FileHandle</strong> [in]: <a href="https://learn.microsoft.com/previous-versions/ff566462(v=vs.85)"><strong>ZwFsControlFile</strong></a> only. The file handle of the volume to be dismounted. This parameter is required and cannot be <strong>NULL</strong>.</p>
</li>
<li>
<p><strong>FsControlCode</strong> [in]: Control code for the operation. Use <strong>FSCTL_ENUM_EXTERNAL_BACKING</strong> for this operation.</p>
</li>
<li>
<p><strong>InputBuffer</strong> [in]: None. Set to <strong>NULL</strong>.</p>
</li>
<li>
<p><strong>InputBufferLength</strong> [in]: Set to 0.</p>
</li>
<li>
<p><strong>OutputBuffer</strong> [out]: A pointer to the output buffer, which must have a size large enough to receive one or more <strong><a href="wof_external_file_id" title="typedef struct _WOF_EXTERNAL_FILE_ID {&#10;  FILE_ID_128 FileId;&#10;} WOF_EXTERNAL_FILE_ID, *PWOF_EXTERNAL_FILE_ID;">WOF_EXTERNAL_FILE_ID</a></strong> structures.</p>
</li>
<li>
<p><strong>OutputBufferLength</strong> [out]: Size of the output buffer pointed to by <strong>OutputBuffer</strong>. <strong>OutputBufferLength</strong> must be &gt;= <strong>sizeof</strong>(<a href="wof_external_file_id" title="typedef struct _WOF_EXTERNAL_FILE_ID {&#10;  FILE_ID_128 FileId;&#10;} WOF_EXTERNAL_FILE_ID, *PWOF_EXTERNAL_FILE_ID;">WOF_EXTERNAL_FILE_ID</a>).</p>
</li>
<li>
<p><strong>LengthReturned</strong> [out]: Specifies the number of bytes written into <strong>OutputBuffer</strong> on successful completion.</p>
</li>
</ul>
<h2>Status block</h2>
<p><strong><a href="fltfscontrolfile" title="NTSTATUS FLTAPI FltFsControlFile(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PFILE_OBJECT  FileObject,&#10;  [in]            ULONG         FsControlCode,&#10;  [in, optional]  PVOID         InputBuffer,&#10;  [in]            ULONG         InputBufferLength,&#10;  [out, optional] PVOID         OutputBuffer,&#10;  [in]            ULONG         OutputBufferLength,&#10;  [out, optional] PULONG        LengthReturned&#10;);">FltFsControlFile</a></strong> or <a href="https://learn.microsoft.com/previous-versions/ff566462(v=vs.85)"><strong>ZwFsControlFile</strong></a> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, the appropriate function might return one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values.</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>STATUS_ACCESS_DENIED</td>
<td>The requester does not have administrative privileges.</td>
</tr>
<tr>
<td>STATUS_BUFFER_TOO_SMALL</td>
<td>The length of the output buffer pointed to by <strong>OutputBuffer</strong> and specified by <strong>OutputBufferLength</strong> is too small.</td>
</tr>
<tr>
<td>STATUS_NO_MORE_FILES</td>
<td>No more files on the volume have a backing source.</td>
</tr>
<tr>
<td>STATUS_INTERNAL_ERROR</td>
<td>The requested volume is not accessible.</td>
</tr>
<tr>
<td>STATUS_INVALID_DEVICE_REQUEST</td>
<td>The backing service is not present or not started.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>The <strong><a href="wof_external_file_id" title="typedef struct _WOF_EXTERNAL_FILE_ID {&#10;  FILE_ID_128 FileId;&#10;} WOF_EXTERNAL_FILE_ID, *PWOF_EXTERNAL_FILE_ID;">WOF_EXTERNAL_FILE_ID</a></strong> structure returned in <strong>OutputBuffer</strong> contains unique file identifiers for backed files. The structure is defined in ntifs.h as the following.</p>
<pre lang="ManagedCPlusPlus"><code>typedef <a href="wof_external_file_id" title="typedef struct _WOF_EXTERNAL_FILE_ID {&#10;  FILE_ID_128 FileId;&#10;} WOF_EXTERNAL_FILE_ID, *PWOF_EXTERNAL_FILE_ID;">struct _WOF_EXTERNAL_FILE_ID</a> {
    FILE_ID_128 FileId;
} <a href="wof_external_file_id" title="typedef struct _WOF_EXTERNAL_FILE_ID {&#10;  FILE_ID_128 FileId;&#10;} WOF_EXTERNAL_FILE_ID, *PWOF_EXTERNAL_FILE_ID;">WOF_EXTERNAL_FILE_ID</a>, *<a href="wof_external_file_id" title="typedef struct _WOF_EXTERNAL_FILE_ID {&#10;  FILE_ID_128 FileId;&#10;} WOF_EXTERNAL_FILE_ID, *PWOF_EXTERNAL_FILE_ID;">PWOF_EXTERNAL_FILE_ID</a>;
</code></pre>
<p>A <strong>FSCTL_ENUM_EXTERNAL_BACKING</strong> request is issued successively to retrieve the identifiers for each file on the volume having backing source. When all the files are enumerated, the STATUS_NO_MORE_FILES status code is returned.</p>
<h2>Requirements</h2>
<table>
<thead>
<tr>
<th>Requirement type</th>
<th>Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minimum supported client</td>
<td>Windows 8.1 Update</td>
</tr>
<tr>
<td>Header</td>
<td><em>Ntifs.h</em> (include <em>Ntifs.h</em> or <em>Fltkernel.h</em>)</td>
</tr>
</tbody>
</table>
<h2>See also</h2>
<p><strong><a href="fltfscontrolfile" title="NTSTATUS FLTAPI FltFsControlFile(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PFILE_OBJECT  FileObject,&#10;  [in]            ULONG         FsControlCode,&#10;  [in, optional]  PVOID         InputBuffer,&#10;  [in]            ULONG         InputBufferLength,&#10;  [out, optional] PVOID         OutputBuffer,&#10;  [in]            ULONG         OutputBufferLength,&#10;  [out, optional] PULONG        LengthReturned&#10;);">FltFsControlFile</a></strong></p>
<p><a href="https://learn.microsoft.com/previous-versions/ff566462(v=vs.85)"><strong>ZwFsControlFile</strong></a></p>
<p><strong><a href="fsctl_get_external_backing" title="// CTL_CODE(0x0009, 0x0c4, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_GET_EXTERNAL_BACKING 0x00090310">FSCTL_GET_EXTERNAL_BACKING</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/fsctl-enum-external-backing">View the official Windows hardware development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs/blob/staging/windows-driver-docs-pr/ifs/fsctl-enum-external-backing.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
