<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FltEnlistInTransaction - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FltEnlistInTransaction - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FltEnlistInTransaction - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> FLTAPI FltEnlistInTransaction(
  [in] PFLT_INSTANCE     Instance,
  [in] PKTRANSACTION     Transaction,
  [in] PFLT_CONTEXT      TransactionContext,
  [in] NOTIFICATION_MASK NotificationMask
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltenlistintransaction">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fltenlistintransaction.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-fltkernel-fltenlistintransaction)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fltenlistintransaction-function">FltEnlistInTransaction function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FltEnlistInTransaction</strong> routine enlists a minifilter driver in a given transaction.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="instance-in"><code>Instance</code> [in]</h3>

<p>An opaque instance pointer for the caller. This parameter is required and cannot be <strong>NULL</strong>.</p>

<h3 id="transaction-in"><code>Transaction</code> [in]</h3>

<p>An opaque transaction pointer for the transaction.</p>

<h3 id="transactioncontext-in"><code>TransactionContext</code> [in]</h3>

<p>A pointer to the minifilter driver's transaction context. This parameter is required and cannot be <strong>NULL</strong>.</p>

<h3 id="notificationmask-in"><code>NotificationMask</code> [in]</h3>

<p>Specifies the type of notifications that the filter manager is to send to the minifilter driver, as one or more of the values listed in the following table. This parameter is required and cannot be zero.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>TRANSACTION_NOTIFY_COMMIT</td>
  <td>This notification is sent when the transaction is being committed.</td>
</tr>
<tr>
  <td>TRANSACTION_NOTIFY_COMMIT_FINALIZE</td>
  <td>For Windows Vista SP1 and later, this notification is sent when the transaction is fully committed (that is, when all of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions//aa365519(v=vs.85)">resource managers</a> associated with the transaction, such as <a rel="noopener" target="_blank" href="https://go.microsoft.com/fwlink/p/?linkid=66161">TxF</a>, have committed).</td>
</tr>
<tr>
  <td>TRANSACTION_NOTIFY_PREPARE</td>
  <td>This notification is sent when the transaction has entered the prepare for commit phase.</td>
</tr>
<tr>
  <td>TRANSACTION_NOTIFY_PREPREPARE</td>
  <td>This notification is sent when the transaction has entered the pre-prepare for commit phase.</td>
</tr>
<tr>
  <td>TRANSACTION_NOTIFY_ROLLBACK</td>
  <td>This notification is sent when the transaction is being rolled back or aborted.</td>
</tr>
<tr>
  <td>FLT_MAX_TRANSACTION_NOTIFICATIONS</td>
  <td>TRANSACTION_NOTIFY_COMMIT</td>
  <td>TRANSACTION_NOTIFY_PREPARE</td>
  <td>TRANSACTION_NOTIFY_PREPREPARE</td>
  <td>TRANSACTION_NOTIFY_ROLLBACK</td>
</tr>
</tbody>
</table>

<h2 id="return-value">Return value</h2>

<p><strong>FltEnlistInTransaction</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value such as one of the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_FLT_ALREADY_ENLISTED</strong></td>
  <td>The caller is already enlisted in the transaction. This is an error code.</td>
</tr>
<tr>
  <td><strong>STATUS_FLT_DELETING_OBJECT</strong></td>
  <td>The instance specified in the <em>Instance</em> parameter is being torn down. This is an error code.</td>
</tr>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td><strong>FltEnlistInTransaction</strong> encountered a pool allocation error. This is an error code.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>The caller did not register a <em>TransactionNotificationCallback</em> routine. This is an error code.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER_4</strong></td>
  <td>The caller specified an invalid value for the <em>NotificationMask</em> parameter. This is an error code.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A minifilter driver calls <strong>FltEnlistInTransaction</strong> to enlist in a transaction. Before calling <strong>FltEnlistInTransaction</strong>, the minifilter driver must have registered a <em>TransactionNotificationCallback</em> routine. Otherwise, the call to <strong>FltEnlistInTransaction</strong> will fail.</p>

<p>To register a <em>TransactionNotificationCallback</em> routine, a minifilter driver stores the address of a routine of type <a href="pflt_transaction_notification_callback" title="PFLT_TRANSACTION_NOTIFICATION_CALLBACK PfltTransactionNotificationCallback;&#10;&#10;NTSTATUS PfltTransactionNotificationCallback(&#10;  [in] PCFLT_RELATED_OBJECTS FltObjects,&#10;  [in] PFLT_CONTEXT TransactionContext,&#10;  [in] ULONG NotificationMask&#10;)&#10;{...}">PFLT_TRANSACTION_NOTIFICATION_CALLBACK</a> in the **TransactionNotificationCallback** member of the <a href="flt_registration" title="typedef struct _FLT_REGISTRATION {&#10;  USHORT                                      Size;&#10;  USHORT                                      Version;&#10;  FLT_REGISTRATION_FLAGS                      Flags;&#10;  const FLT_CONTEXT_REGISTRATION              *ContextRegistration;&#10;  const FLT_OPERATION_REGISTRATION            *OperationRegistration;&#10;  PFLT_FILTER_UNLOAD_CALLBACK                 FilterUnloadCallback;&#10;  PFLT_INSTANCE_SETUP_CALLBACK                InstanceSetupCallback;&#10;  PFLT_INSTANCE_QUERY_TEARDOWN_CALLBACK       InstanceQueryTeardownCallback;&#10;  PFLT_INSTANCE_TEARDOWN_CALLBACK             InstanceTeardownStartCallback;&#10;  PFLT_INSTANCE_TEARDOWN_CALLBACK             InstanceTeardownCompleteCallback;&#10;  PFLT_GENERATE_FILE_NAME                     GenerateFileNameCallback;&#10;  PFLT_NORMALIZE_NAME_COMPONENT               NormalizeNameComponentCallback;&#10;  PFLT_NORMALIZE_CONTEXT_CLEANUP              NormalizeContextCleanupCallback;&#10;  PFLT_TRANSACTION_NOTIFICATION_CALLBACK      TransactionNotificationCallback;&#10;  PFLT_NORMALIZE_NAME_COMPONENT_EX            NormalizeNameComponentExCallback;&#10;  PFLT_SECTION_CONFLICT_NOTIFICATION_CALLBACK SectionNotificationCallback;&#10;} FLT_REGISTRATION, *PFLT_REGISTRATION;">FLT_REGISTRATION</a> structure that the minifilter driver passes as the <em>Registration</em> parameter of <a href="fltregisterfilter" title="NTSTATUS FLTAPI FltRegisterFilter(&#10;  [in]  PDRIVER_OBJECT         Driver,&#10;  [in]  const FLT_REGISTRATION *Registration,&#10;  [out] PFLT_FILTER            *RetFilter&#10;);">FltRegisterFilter</a>.</p>

<p>To roll back or abort a transaction, call <a href="fltrollbackenlistment" title="NTSTATUS FLTAPI FltRollbackEnlistment(&#10;  [in]           PFLT_INSTANCE Instance,&#10;  [in]           PKTRANSACTION Transaction,&#10;  [in, optional] PFLT_CONTEXT  TransactionContext&#10;);">FltRollbackEnlistment</a>.</p>

<p>To allocate a new transaction context, call <a href="fltallocatecontext" title="NTSTATUS FLTAPI FltAllocateContext(&#10;  [in]  PFLT_FILTER      Filter,&#10;  [in]  FLT_CONTEXT_TYPE ContextType,&#10;  [in]  SIZE_T           ContextSize,&#10;  [in]  POOL_TYPE        PoolType,&#10;  [out] PFLT_CONTEXT     *ReturnedContext&#10;);">FltAllocateContext</a>.</p>

<p>To retrieve a transaction context, call <a href="fltgettransactioncontext" title="NTSTATUS FLTAPI FltGetTransactionContext(&#10;  [in]  PFLT_INSTANCE Instance,&#10;  [in]  PKTRANSACTION Transaction,&#10;  [out] PFLT_CONTEXT  *Context&#10;);">FltGetTransactionContext</a>.</p>

<p>To delete a transaction context, call <a href="fltdeletetransactioncontext" title="NTSTATUS FLTAPI FltDeleteTransactionContext(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PKTRANSACTION Transaction,&#10;  [out, optional] PFLT_CONTEXT  *OldContext&#10;);">FltDeleteTransactionContext</a> or <a href="fltdeletecontext" title="VOID FLTAPI FltDeleteContext(&#10;  [in] PFLT_CONTEXT Context&#10;);">FltDeleteContext</a>.</p>

<p>To set a transaction context, call <a href="fltsettransactioncontext" title="NTSTATUS FLTAPI FltSetTransactionContext(&#10;  [in]            PFLT_INSTANCE             Instance,&#10;  [in]            PKTRANSACTION             Transaction,&#10;  [in]            FLT_SET_CONTEXT_OPERATION Operation,&#10;  [in]            PFLT_CONTEXT              NewContext,&#10;  [out, optional] PFLT_CONTEXT              *OldContext&#10;);">FltSetTransactionContext</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="fltallocatecontext" title="NTSTATUS FLTAPI FltAllocateContext(&#10;  [in]  PFLT_FILTER      Filter,&#10;  [in]  FLT_CONTEXT_TYPE ContextType,&#10;  [in]  SIZE_T           ContextSize,&#10;  [in]  POOL_TYPE        PoolType,&#10;  [out] PFLT_CONTEXT     *ReturnedContext&#10;);">FltAllocateContext</a></p>

<p><a href="fltcommitcomplete" title="NTSTATUS FLTAPI FltCommitComplete(&#10;  [in]           PFLT_INSTANCE Instance,&#10;  [in]           PKTRANSACTION Transaction,&#10;  [in, optional] PFLT_CONTEXT  TransactionContext&#10;);">FltCommitComplete</a></p>

<p><a href="fltdeletecontext" title="VOID FLTAPI FltDeleteContext(&#10;  [in] PFLT_CONTEXT Context&#10;);">FltDeleteContext</a></p>

<p><a href="fltdeletetransactioncontext" title="NTSTATUS FLTAPI FltDeleteTransactionContext(&#10;  [in]            PFLT_INSTANCE Instance,&#10;  [in]            PKTRANSACTION Transaction,&#10;  [out, optional] PFLT_CONTEXT  *OldContext&#10;);">FltDeleteTransactionContext</a></p>

<p><a href="fltgettransactioncontext" title="NTSTATUS FLTAPI FltGetTransactionContext(&#10;  [in]  PFLT_INSTANCE Instance,&#10;  [in]  PKTRANSACTION Transaction,&#10;  [out] PFLT_CONTEXT  *Context&#10;);">FltGetTransactionContext</a></p>

<p><a href="fltprepreparecomplete" title="NTSTATUS FLTAPI FltPrePrepareComplete(&#10;  [in]           PFLT_INSTANCE Instance,&#10;  [in]           PKTRANSACTION Transaction,&#10;  [in, optional] PFLT_CONTEXT  TransactionContext&#10;);">FltPrePrepareComplete</a></p>

<p><a href="fltpreparecomplete" title="NTSTATUS FLTAPI FltPrepareComplete(&#10;  [in]           PFLT_INSTANCE Instance,&#10;  [in]           PKTRANSACTION Transaction,&#10;  [in, optional] PFLT_CONTEXT  TransactionContext&#10;);">FltPrepareComplete</a></p>

<p><a href="fltregisterfilter" title="NTSTATUS FLTAPI FltRegisterFilter(&#10;  [in]  PDRIVER_OBJECT         Driver,&#10;  [in]  const FLT_REGISTRATION *Registration,&#10;  [out] PFLT_FILTER            *RetFilter&#10;);">FltRegisterFilter</a></p>

<p><a href="fltreleasecontext" title="VOID FLTAPI FltReleaseContext(&#10;  [in] PFLT_CONTEXT Context&#10;);">FltReleaseContext</a></p>

<p><a href="fltrollbackcomplete" title="NTSTATUS FLTAPI FltRollbackComplete(&#10;  [in]           PFLT_INSTANCE Instance,&#10;  [in]           PKTRANSACTION Transaction,&#10;  [in, optional] PFLT_CONTEXT  TransactionContext&#10;);">FltRollbackComplete</a></p>

<p><a href="fltrollbackenlistment" title="NTSTATUS FLTAPI FltRollbackEnlistment(&#10;  [in]           PFLT_INSTANCE Instance,&#10;  [in]           PKTRANSACTION Transaction,&#10;  [in, optional] PFLT_CONTEXT  TransactionContext&#10;);">FltRollbackEnlistment</a></p>

<p><a href="fltsettransactioncontext" title="NTSTATUS FLTAPI FltSetTransactionContext(&#10;  [in]            PFLT_INSTANCE             Instance,&#10;  [in]            PKTRANSACTION             Transaction,&#10;  [in]            FLT_SET_CONTEXT_OPERATION Operation,&#10;  [in]            PFLT_CONTEXT              NewContext,&#10;  [out, optional] PFLT_CONTEXT              *OldContext&#10;);">FltSetTransactionContext</a></p>

<p><a href="pflt_transaction_notification_callback" title="PFLT_TRANSACTION_NOTIFICATION_CALLBACK PfltTransactionNotificationCallback;&#10;&#10;NTSTATUS PfltTransactionNotificationCallback(&#10;  [in] PCFLT_RELATED_OBJECTS FltObjects,&#10;  [in] PFLT_CONTEXT TransactionContext,&#10;  [in] ULONG NotificationMask&#10;)&#10;{...}">PFLT_TRANSACTION_NOTIFICATION_CALLBACK</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltenlistintransaction">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nf-fltkernel-fltenlistintransaction.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
