<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FltCreateCommunicationPort - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FltCreateCommunicationPort - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FltCreateCommunicationPort - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> FLTAPI FltCreateCommunicationPort(
  PFLT_FILTER            Filter,
  PFLT_PORT              *ServerPort,
  <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a>     ObjectAttributes,
  PVOID                  ServerPortCookie,
  <a href="pflt_connect_notify" title="PFLT_CONNECT_NOTIFY PfltConnectNotify;&#10;&#10;NTSTATUS PfltConnectNotify(&#10;  PFLT_PORT ClientPort,&#10;  PVOID ServerPortCookie,&#10;  PVOID ConnectionContext,&#10;  ULONG SizeOfContext,&#10;  PVOID *ConnectionPortCookie&#10;)&#10;{...}">PFLT_CONNECT_NOTIFY</a>    ConnectNotifyCallback,
  <a href="pflt_disconnect_notify" title="PFLT_DISCONNECT_NOTIFY PfltDisconnectNotify;&#10;&#10;VOID PfltDisconnectNotify(&#10;  PVOID ConnectionCookie&#10;)&#10;{...}">PFLT_DISCONNECT_NOTIFY</a> DisconnectNotifyCallback,
  <a href="pflt_message_notify" title="PFLT_MESSAGE_NOTIFY PfltMessageNotify;&#10;&#10;NTSTATUS PfltMessageNotify(&#10;  PVOID PortCookie,&#10;  PVOID InputBuffer,&#10;  ULONG InputBufferLength,&#10;  PVOID OutputBuffer,&#10;  ULONG OutputBufferLength,&#10;  PULONG ReturnOutputBufferLength&#10;)&#10;{...}">PFLT_MESSAGE_NOTIFY</a>    MessageNotifyCallback,
  <a href="long" title="typedef long LONG;">LONG</a>                   MaxConnections
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltcreatecommunicationport">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fltcreatecommunicationport.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-fltkernel-fltcreatecommunicationport)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>FltCreateCommunicationPort function</h1>
<h2>Description</h2>
<p><strong>FltCreateCommunicationPort</strong> creates a communication server port on which a minifilter can receive connection requests from user-mode applications and services.</p>
<h2>Parameters</h2>
<h3><code>Filter</code></h3>
<p>[in] Opaque filter pointer for the caller.</p>
<h3><code>ServerPort</code></h3>
<p>[out] Pointer to a caller-allocated variable that receives an opaque port handle for the communication server port. The minifilter uses this handle to listen for incoming connection requests from a user-mode application.</p>
<h3><code>ObjectAttributes</code></h3>
<p>[in] Pointer to an <strong><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></strong> structure that specifies the attributes of the communication server port. This structure must have been initialized by a previous call to <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong>. This parameter is required and can't be NULL. Members of this structure for a communication port object include the following.</p>
<table>
<thead>
<tr>
  <th>Member</th>
  <th>Value</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>Length</strong></td>
  <td><strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong> sets this member to <code>sizeof(<a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a>)</code>.</td>
</tr>
<tr>
  <td><strong>ObjectName</strong></td>
  <td>Pointer to a <strong><a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a></strong> structure containing a unique name (for example, L"\MyFilterPort") for the port object.</td>
</tr>
<tr>
  <td><strong>SecurityDescriptor</strong></td>
  <td>Pointer to a security descriptor (<strong><a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a></strong>) to be applied to the port object. If needed, a default security descriptor can be created by calling <strong><a href="fltbuilddefaultsecuritydescriptor" title="NTSTATUS FLTAPI FltBuildDefaultSecurityDescriptor(&#10;  [out] PSECURITY_DESCRIPTOR *SecurityDescriptor,&#10;  [in]  ACCESS_MASK          DesiredAccess&#10;);">FltBuildDefaultSecurityDescriptor</a></strong>.</td>
</tr>
<tr>
  <td><strong>Attributes</strong></td>
  <td>Bitmask of flags specifying the desired attributes for the port handle. These flags must include <a href="obj_kernel_handle" title="#define OBJ_KERNEL_HANDLE 0x00000200L">OBJ_KERNEL_HANDLE</a>. The caller can also optionally set the <a href="obj_case_insensitive" title="#define OBJ_CASE_INSENSITIVE 0x00000040L">OBJ_CASE_INSENSITIVE</a> flag, which indicates that name-lookup code should ignore the case of <strong>ObjectName</strong> rather than performing an exact-match search.</td>
</tr>
</tbody>
</table>
<h3><code>ServerPortCookie</code></h3>
<p>[in, optional] Pointer to context information defined by the minifilter. This information can be used to distinguish among multiple communication server ports that are created by the same minifilter. <em>FltMgr</em> passes this context pointer as a parameter to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_connect_notify"><strong>ConnectNotifyCallback</strong></a> routine. This parameter is optional and can be NULL.</p>
<h3><code>ConnectNotifyCallback</code></h3>
<p>[in] Pointer to a caller-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_connect_notify"><strong>ConnectNotifyCallback</strong></a> callback routine. <em>FltMgr</em> calls this routine whenever a user-mode application calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a> to send a connection request to the minifilter. This parameter is required and can't be NULL.</p>
<h3><code>DisconnectNotifyCallback</code></h3>
<p>[in] Pointer to a caller-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_disconnect_notify"><strong>DisconnectNotifyCallback</strong></a> callback routine. <em>FltMgr</em> calls this routine whenever the user-mode handle count for the client port reaches zero or when the minifilter is about to be unloaded. This parameter is required and can't be NULL.</p>
<h3><code>MessageNotifyCallback</code></h3>
<p>[in, optional] Pointer to a caller-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_message_notify"><strong>MessageNotifyCallback</strong></a> callback routine. <em>FltMgr</em> calls this routine whenever a user-mode application calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtersendmessage"><strong>FilterSendMessage</strong></a> to send a message to the minifilter through the client port. This parameter is optional and can be NULL. If it is NULL, any request made from user mode to send data to the port receives an error.</p>
<h3><code>MaxConnections</code></h3>
<p>[in] Maximum number of simultaneous client connections to be allowed for this server port. This parameter is required and must be greater than zero.</p>
<h2>Return value</h2>
<p><strong>FltCreateCommunicationPort</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value such as one of the following.</p>
<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_FLT_DELETING_OBJECT</td>
  <td>The specified <strong>Filter</strong> is being torn down. This is an error code.</td>
</tr>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td><strong>FltCreateCommunicationPort</strong> encountered a pool allocation failure. This is an error code.</td>
</tr>
<tr>
  <td>STATUS_OBJECT_NAME_COLLISION</td>
  <td>A minifilter communication port with the same name already exists. Port names must be unique. This is an error code.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>A minifilter calls <strong>FltCreateCommunicationPort</strong> to create a communication server port object.</p>
<p>After the server port has been created, a user-mode application can connect to the port by calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a>. When connected, the user-mode application can send and receive messages by calling user-mode messaging functions such as <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtersendmessage"><strong>FilterSendMessage</strong></a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtergetmessage"><strong>FilterGetMessage</strong></a>, and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterreplymessage"><strong>FilterReplyMessage</strong></a>.</p>
<p>Callers must set the <a href="obj_kernel_handle" title="#define OBJ_KERNEL_HANDLE 0x00000200L">OBJ_KERNEL_HANDLE</a> <strong>Attributes</strong> flag for the <strong>ObjectAttributes</strong> parameter of <strong>FltCreateCommunicationPort</strong>. Setting this flag prevents the minifilter communication server port handle from being used by a user-mode process in whose context a caller of <strong>FltCreateCommunicationPort</strong> might be running. If this flag is not set, <strong>FltCreateCommunicationPort</strong> returns STATUS_INVALID_PARAMETER.</p>
<p>Any server port that <strong>FltCreateCommunicationPort</strong> creates must eventually be closed by calling <strong><a href="fltclosecommunicationport" title="VOID FLTAPI FltCloseCommunicationPort(&#10;  [in] PFLT_PORT ServerPort&#10;);">FltCloseCommunicationPort</a></strong>. When the server port is closed, no new connections to the server port are allowed, and all calls to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a> fail. However, any existing connections remain open until they are closed by the user-mode application or the minifilter, or until the minifilter is unloaded.</p>
<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/communication-between-user-mode-and-kernel-mode">Communication between user-mode and minifilters</a>.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtergetmessage"><strong>FilterGetMessage</strong></a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterreplymessage"><strong>FilterReplyMessage</strong></a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtersendmessage"><strong>FilterSendMessage</strong></a></p>
<p><strong><a href="fltbuilddefaultsecuritydescriptor" title="NTSTATUS FLTAPI FltBuildDefaultSecurityDescriptor(&#10;  [out] PSECURITY_DESCRIPTOR *SecurityDescriptor,&#10;  [in]  ACCESS_MASK          DesiredAccess&#10;);">FltBuildDefaultSecurityDescriptor</a></strong></p>
<p><strong><a href="fltcloseclientport" title="VOID FLTAPI FltCloseClientPort(&#10;  [in]  PFLT_FILTER Filter,&#10;  [out] PFLT_PORT   *ClientPort&#10;);">FltCloseClientPort</a></strong></p>
<p><strong><a href="fltclosecommunicationport" title="VOID FLTAPI FltCloseCommunicationPort(&#10;  [in] PFLT_PORT ServerPort&#10;);">FltCloseCommunicationPort</a></strong></p>
<p><strong><a href="fltfreesecuritydescriptor" title="VOID FLTAPI FltFreeSecurityDescriptor(&#10;  [in] PSECURITY_DESCRIPTOR SecurityDescriptor&#10;);">FltFreeSecurityDescriptor</a></strong></p>
<p><strong><a href="fltsendmessage" title="NTSTATUS FLTAPI FltSendMessage(&#10;  [in]            PFLT_FILTER    Filter,&#10;  [in]            PFLT_PORT      *ClientPort,&#10;  [in]            PVOID          SenderBuffer,&#10;  [in]            ULONG          SenderBufferLength,&#10;  [out, optional] PVOID          ReplyBuffer,&#10;  [in, out]       PULONG         ReplyLength,&#10;  [in, optional]  PLARGE_INTEGER Timeout&#10;);">FltSendMessage</a></strong></p>
<p><strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong></p>
<p><strong><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></strong></p>
<p><strong><a href="pflt_filter_unload_callback" title="PFLT_FILTER_UNLOAD_CALLBACK PfltFilterUnloadCallback;&#10;&#10;NTSTATUS PfltFilterUnloadCallback(&#10;  FLT_FILTER_UNLOAD_FLAGS Flags&#10;)&#10;{...}">PFLT_FILTER_UNLOAD_CALLBACK</a></strong></p>
<p><strong><a href="probeforread" title="VOID ProbeForRead(&#10;  [in] const volatile VOID *Address,&#10;  [in] SIZE_T              Length,&#10;  [in] ULONG               Alignment&#10;);">ProbeForRead</a></strong></p>
<p><strong><a href="probeforwrite" title="VOID ProbeForWrite(&#10;  [in, out] volatile VOID *Address,&#10;  [in]      SIZE_T        Length,&#10;  [in]      ULONG         Alignment&#10;);">ProbeForWrite</a></strong></p>
<p><strong><a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltcreatecommunicationport">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nf-fltkernel-fltcreatecommunicationport.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
