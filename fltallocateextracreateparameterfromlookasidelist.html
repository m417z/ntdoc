<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FltAllocateExtraCreateParameterFromLookasideList - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FltAllocateExtraCreateParameterFromLookasideList - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FltAllocateExtraCreateParameterFromLookasideList - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> FLTAPI FltAllocateExtraCreateParameterFromLookasideList(
  [in]           PFLT_FILTER                                    Filter,
  [in]           LPCGUID                                        EcpType,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                                          SizeOfContext,
  [in]           FSRTL_ALLOCATE_ECP_FLAGS                       Flags,
  [in, optional] <a href="pfsrtl_extra_create_parameter_cleanup_callback" title="PFSRTL_EXTRA_CREATE_PARAMETER_CLEANUP_CALLBACK PfsrtlExtraCreateParameterCleanupCallback;&#10;&#10;VOID PfsrtlExtraCreateParameterCleanupCallback(&#10;  [in, out] PVOID EcpContext,&#10;  [in[]     LPCGUID EcpType&#10;)&#10;{...}">PFSRTL_EXTRA_CREATE_PARAMETER_CLEANUP_CALLBACK</a> CleanupCallback,
  [in, out]      PVOID                                          LookasideList,
  [out]          PVOID                                          *EcpContext
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltallocateextracreateparameterfromlookasidelist">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fltallocateextracreateparameterfromlookasidelist.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-fltkernel-fltallocateextracreateparameterfromlookasidelist)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fltallocateextracreateparameterfromlookasidelist-function">FltAllocateExtraCreateParameterFromLookasideList function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FltAllocateExtraCreateParameterFromLookasideList</strong> routine allocates memory pool from a given lookaside list for an extra create parameter (ECP) context structure and generates a pointer to that structure.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="filter-in"><code>Filter</code> [in]</h3>

<p>Opaque filter pointer to the minifilter driver. This pointer uniquely identifies the minifilter driver and remains constant as long as the minifilter driver is loaded.</p>

<h3 id="ecptype-in"><code>EcpType</code> [in]</h3>

<p>Pointer to a GUID that indicates the type of the ECP context structure. See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-guids-in-drivers">Using GUIDs in Drivers</a> for more information.</p>

<h3 id="sizeofcontext-in"><code>SizeOfContext</code> [in]</h3>

<p>The size, in bytes, of the ECP context structure.</p>

<h3 id="flags-in"><code>Flags</code> [in]</h3>

<p>Defines pool allocation options. If the value of the <em>SizeOfContext</em> parameter is larger than the size, in bytes, of the given lookaside list, the ECP context structure will be allocated from system pool instead of the lookaside list. In this case, if the <em>Flags</em> parameter contains the FSRTL_ALLOCATE_ECP_FLAG_CHARGE_QUOTA bit flag value, system pool allocated by the routine will be charged against the current process' memory quota. See the *Flags* parameter of <a href="fltallocateextracreateparameter" title="NTSTATUS FLTAPI FltAllocateExtraCreateParameter(&#10;  [in]           PFLT_FILTER                                    Filter,&#10;  [in]           LPCGUID                                        EcpType,&#10;  [in]           ULONG                                          SizeOfContext,&#10;  [in]           FSRTL_ALLOCATE_ECP_FLAGS                       Flags,&#10;  [in, optional] PFSRTL_EXTRA_CREATE_PARAMETER_CLEANUP_CALLBACK CleanupCallback,&#10;  [in]           ULONG                                          PoolTag,&#10;  [out]          PVOID                                          *EcpContext&#10;);">FltAllocateExtraCreateParameter</a> for more information. In the more typical case when memory for the ECP context structure is allocated from the lookaside list, the FSRTL_ALLOCATE_ECP_FLAG_CHARGE_QUOTA bit flag is not used by the routine.</p>

<h3 id="cleanupcallback-in-optional"><code>CleanupCallback</code> [in, optional]</h3>

<p>Optional pointer to a minifilter-defined cleanup callback routine of type <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff551124(v=vs.85)">PFSRTL_EXTRA_CREATE_PARAMETER_CLEANUP_CALLBACK</a>. The cleanup callback routine is called when the ECP context structure is deleted. Set this parameter to <strong>NULL</strong> if a cleanup callback routine is not applicable.</p>

<h3 id="lookasidelist-in-out"><code>LookasideList</code> [in, out]</h3>

<p>Pointer to an initialized lookaside list in which to attempt to allocate pool from (for the ECP context structure). To initialize the lookaside list, use the <a href="fltinitextracreateparameterlookasidelist" title="VOID FLTAPI FltInitExtraCreateParameterLookasideList(&#10;  [in]      PFLT_FILTER               Filter,&#10;  [in, out] PVOID                     Lookaside,&#10;  [in]      FSRTL_ECP_LOOKASIDE_FLAGS Flags,&#10;  [in]      SIZE_T                    Size,&#10;  [in]      ULONG                     Tag&#10;);">FltInitExtraCreateParameterLookasideList</a> routine.</p>

<h3 id="ecpcontext-out"><code>EcpContext</code> [out]</h3>

<p>Receives a pointer to the allocated ECP context structure. If the routine failed to allocate sufficient pool for the ECP context structure, <em>EcpContext</em> will be <strong>NULL</strong> and the routine will return status code STATUS_INSUFFICIENT_RESOURCES.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong>FltAllocateExtraCreateParameterFromLookasideList</strong> routine can return one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>The <strong>FltAllocateExtraCreateParameterFromLookasideList</strong> routine was unable to allocate sufficient memory for an ECP context structure. In this case, <em>EcpContext</em> will be <strong>NULL</strong>.</td>
</tr>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The ECP context structure was successfully allocated. In this case, a pointer to the allocated structure is returned by the <em>EcpContext</em> parameter.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>This routine is available starting with Windows Vista.</p>

<p>The <strong>FltAllocateExtraCreateParameterFromLookasideList</strong> routine allocates memory pool for an ECP context structure from the given initialized paged or non-paged lookaside list. However, if the size of the ECP context structure (as defined by the <em>SizeOfContext</em> parameter) is larger than the lookaside list, the routine analogously allocates memory from paged or non-paged system pool.</p>

<p>Use the <a href="fltinitextracreateparameterlookasidelist" title="VOID FLTAPI FltInitExtraCreateParameterLookasideList(&#10;  [in]      PFLT_FILTER               Filter,&#10;  [in, out] PVOID                     Lookaside,&#10;  [in]      FSRTL_ECP_LOOKASIDE_FLAGS Flags,&#10;  [in]      SIZE_T                    Size,&#10;  [in]      ULONG                     Tag&#10;);">FltInitExtraCreateParameterLookasideList</a> routine to initialize a paged or non-paged pool lookaside list. Use the <strong>FltAllocateExtraCreateParameterFromLookasideList</strong> routine to allocate an ECP context structure from the lookaside list, and the <a href="fltfreeextracreateparameter" title="VOID FLTAPI FltFreeExtraCreateParameter(&#10;  [in] PFLT_FILTER Filter,&#10;  [in] PVOID       EcpContext&#10;);">FltFreeExtraCreateParameter</a> routine to deallocate the ECP context structure.</p>

<p>Use the <a href="fltdeleteextracreateparameterlookasidelist" title="VOID FLTAPI FltDeleteExtraCreateParameterLookasideList(&#10;  [in]      PFLT_FILTER               Filter,&#10;  [in, out] PVOID                     Lookaside,&#10;  [in]      FSRTL_ECP_LOOKASIDE_FLAGS Flags&#10;);">FltDeleteExtraCreateParameterLookasideList</a> routine to free a lookaside list.</p>

<p>Drivers must free all ECP context structures and lookaside lists they create before unloading. However, if a file system or file system filter driver attaches an ECP to an existing or newly-created ECP_LIST while processing an <a href="irp_mj_create" title="#define IRP_MJ_CREATE 0x00">IRP_MJ_CREATE</a> request, this ECP is automatically cleaned up when the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> completes. As a result, a filter driver does not have to clean up ECPs that are added dynamically. This allows a filter driver's ECP to be properly propagated across the reparse points--a process that can require multiple <a href="irp_mj_create" title="#define IRP_MJ_CREATE 0x00">IRP_MJ_CREATE</a> requests to be generated.</p>

<p>For more information about using lookaside lists with drivers, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-lookaside-lists">Using Lookaside Lists</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff540148(v=vs.85)">ECP_LIST</a></p>

<p><a href="fltallocateextracreateparameter" title="NTSTATUS FLTAPI FltAllocateExtraCreateParameter(&#10;  [in]           PFLT_FILTER                                    Filter,&#10;  [in]           LPCGUID                                        EcpType,&#10;  [in]           ULONG                                          SizeOfContext,&#10;  [in]           FSRTL_ALLOCATE_ECP_FLAGS                       Flags,&#10;  [in, optional] PFSRTL_EXTRA_CREATE_PARAMETER_CLEANUP_CALLBACK CleanupCallback,&#10;  [in]           ULONG                                          PoolTag,&#10;  [out]          PVOID                                          *EcpContext&#10;);">FltAllocateExtraCreateParameter</a></p>

<p><a href="fltallocateextracreateparameterlist" title="NTSTATUS FLTAPI FltAllocateExtraCreateParameterList(&#10;  [in]  PFLT_FILTER                  Filter,&#10;  [in]  FSRTL_ALLOCATE_ECPLIST_FLAGS Flags,&#10;  [out] PECP_LIST                    *EcpList&#10;);">FltAllocateExtraCreateParameterList</a></p>

<p><a href="fltcreatefileex2" title="NTSTATUS FLTAPI FltCreateFileEx2(&#10;  [in]            PFLT_FILTER               Filter,&#10;  [in, optional]  PFLT_INSTANCE             Instance,&#10;  [out]           PHANDLE                   FileHandle,&#10;  [out, optional] PFILE_OBJECT              *FileObject,&#10;  [in]            ACCESS_MASK               DesiredAccess,&#10;  [in]            POBJECT_ATTRIBUTES        ObjectAttributes,&#10;  [out]           PIO_STATUS_BLOCK          IoStatusBlock,&#10;  [in, optional]  PLARGE_INTEGER            AllocationSize,&#10;  [in]            ULONG                     FileAttributes,&#10;  [in]            ULONG                     ShareAccess,&#10;  [in]            ULONG                     CreateDisposition,&#10;  [in]            ULONG                     CreateOptions,&#10;  [in, optional]  PVOID                     EaBuffer,&#10;  [in]            ULONG                     EaLength,&#10;  [in]            ULONG                     Flags,&#10;  [in, optional]  PIO_DRIVER_CREATE_CONTEXT DriverContext&#10;);">FltCreateFileEx2</a></p>

<p><a href="fltdeleteextracreateparameterlookasidelist" title="VOID FLTAPI FltDeleteExtraCreateParameterLookasideList(&#10;  [in]      PFLT_FILTER               Filter,&#10;  [in, out] PVOID                     Lookaside,&#10;  [in]      FSRTL_ECP_LOOKASIDE_FLAGS Flags&#10;);">FltDeleteExtraCreateParameterLookasideList</a></p>

<p><a href="fltfreeextracreateparameter" title="VOID FLTAPI FltFreeExtraCreateParameter(&#10;  [in] PFLT_FILTER Filter,&#10;  [in] PVOID       EcpContext&#10;);">FltFreeExtraCreateParameter</a></p>

<p><a href="fltfreeextracreateparameterlist" title="VOID FLTAPI FltFreeExtraCreateParameterList(&#10;  [in] PFLT_FILTER Filter,&#10;  [in] PECP_LIST   EcpList&#10;);">FltFreeExtraCreateParameterList</a></p>

<p><a href="fltgetecplistfromcallbackdata" title="NTSTATUS FLTAPI FltGetEcpListFromCallbackData(&#10;  [in]  PFLT_FILTER        Filter,&#10;        PFLT_CALLBACK_DATA CallbackData,&#10;  [out] PECP_LIST          *EcpList&#10;);">FltGetEcpListFromCallbackData</a></p>

<p><a href="fltinitextracreateparameterlookasidelist" title="VOID FLTAPI FltInitExtraCreateParameterLookasideList(&#10;  [in]      PFLT_FILTER               Filter,&#10;  [in, out] PVOID                     Lookaside,&#10;  [in]      FSRTL_ECP_LOOKASIDE_FLAGS Flags,&#10;  [in]      SIZE_T                    Size,&#10;  [in]      ULONG                     Tag&#10;);">FltInitExtraCreateParameterLookasideList</a></p>

<p><a href="fltinsertextracreateparameter" title="NTSTATUS FLTAPI FltInsertExtraCreateParameter(&#10;  [in]      PFLT_FILTER Filter,&#10;  [in, out] PECP_LIST   EcpList,&#10;  [in, out] PVOID       EcpContext&#10;);">FltInsertExtraCreateParameter</a></p>

<p><a href="fltremoveextracreateparameter" title="NTSTATUS FLTAPI FltRemoveExtraCreateParameter(&#10;  [in]            PFLT_FILTER Filter,&#10;  [in, out]       PECP_LIST   EcpList,&#10;  [in]            LPCGUID     EcpType,&#10;  [out]           PVOID       *EcpContext,&#10;  [out, optional] ULONG       *EcpContextSize&#10;);">FltRemoveExtraCreateParameter</a></p>

<p><a href="fltsetecplistintocallbackdata" title="NTSTATUS FLTAPI FltSetEcpListIntoCallbackData(&#10;  [in] PFLT_FILTER        Filter,&#10;       PFLT_CALLBACK_DATA CallbackData,&#10;  [in] PECP_LIST          EcpList&#10;);">FltSetEcpListIntoCallbackData</a></p>

<p><a href="iocreatefileex" title="NTSTATUS IoCreateFileEx(&#10;  [out]          PHANDLE                   FileHandle,&#10;  [in]           ACCESS_MASK               DesiredAccess,&#10;  [in]           POBJECT_ATTRIBUTES        ObjectAttributes,&#10;  [out]          PIO_STATUS_BLOCK          IoStatusBlock,&#10;  [in, optional] PLARGE_INTEGER            AllocationSize,&#10;  [in]           ULONG                     FileAttributes,&#10;  [in]           ULONG                     ShareAccess,&#10;  [in]           ULONG                     Disposition,&#10;  [in]           ULONG                     CreateOptions,&#10;  [in, optional] PVOID                     EaBuffer,&#10;  [in]           ULONG                     EaLength,&#10;  [in]           CREATE_FILE_TYPE          CreateFileType,&#10;  [in, optional] PVOID                     InternalParameters,&#10;  [in]           ULONG                     Options,&#10;  [in, optional] PIO_DRIVER_CREATE_CONTEXT DriverContext&#10;);">IoCreateFileEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff551124(v=vs.85)">PFSRTL_EXTRA_CREATE_PARAMETER_CLEANUP_CALLBACK</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltallocateextracreateparameterfromlookasidelist">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nf-fltkernel-fltallocateextracreateparameterfromlookasidelist.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
