<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// nblchecksum.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO {
  union {
    struct {
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IsIPv4 : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IsIPv6 : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TcpChecksum : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UdpChecksum : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IpHeaderChecksum : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved : 11;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TcpHeaderOffset : 10;
    } Transmit;
    struct {
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TcpChecksumFailed : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UdpChecksumFailed : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IpChecksumFailed : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TcpChecksumSucceeded : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UdpChecksumSucceeded : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IpChecksumSucceeded : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Loopback : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TcpChecksumValueInvalid : 1;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IpChecksumValueInvalid : 1;
    } Receive;
    PVOID Value;
  };
} NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO, *PNDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/nblchecksum/ns-nblchecksum-ndis_tcp_ip_checksum_net_buffer_list_info">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_tcp_ip_checksum_net_buffer_list_info.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-nblchecksum-ndis_tcp_ip_checksum_net_buffer_list_info)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO structure</h1>

<h2>Description</h2>

<p>The <strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure specifies information used in offloading
checksum tasks from the TCP/IP transport to a NIC. The <strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure
is part of the
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> information (out-of-band data)
that is associated with a <strong><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></strong> structure.</p>

<h2>Members</h2>

<h3><code>Transmit</code></h3>

<p>A structure that contains the following members:</p>

<h3><code>Transmit.IsIPv4</code></h3>

<p>Set by the TCP/IP transport to indicate that the send packet contains IPv4 addresses.</p>

<h3><code>Transmit.IsIPv6</code></h3>

<p>Set by the TCP/IP transport to indicate that the send packet contains IPv6 addresses.</p>

<h3><code>Transmit.TcpChecksum</code></h3>

<p>Set by the TCP/IP transport to indicate that the NIC should calculate the packet's TCP
checksum.</p>

<h3><code>Transmit.UdpChecksum</code></h3>

<p>Set by the TCP/IP transport to indicate that the NIC should calculate the packet's UDP
checksum.</p>

<h3><code>Transmit.IpHeaderChecksum</code></h3>

<p>Set by the TCP/IP transport to indicate that the NIC should calculate the IP checksum for the
first IP header in the packet. If the packet contains both a tunnel IP header and a transport IP
header, the NIC should calculate the checksum for both IP headers.</p>

<h3><code>Transmit.Reserved</code></h3>

<p>Reserved for NDIS.</p>

<h3><code>Transmit.TcpHeaderOffset</code></h3>

<p>The offset, in bytes, of the TCP header from the beginning of the packet for TCP packets. Miniport drivers can use <strong>TcpHeaderOffset</strong> to determine the location of the TCP header so that they do not need to parse the MAC and IP header.</p>

<h3><code>Receive</code></h3>

<p>A structure that contains the following members:</p>

<h3><code>Receive.TcpChecksumFailed</code></h3>

<p>Set by the miniport driver to indicate that the TCP checksum calculated by the NIC did not match
the checksum in the receive packet's TCP header.</p>

<h3><code>Receive.UdpChecksumFailed</code></h3>

<p>Set by the miniport driver to indicate that the UDP checksum calculated by the NIC did not match
the checksum in the receive packet's UDP header.</p>

<h3><code>Receive.IpChecksumFailed</code></h3>

<p>Set by the miniport driver to indicate that the IP checksum calculated by the NIC did not match
the checksum in the receive packet's first IP header. If the receive packet contains both a tunnel IP
header and a transport IP header, the NIC validates the checksum for both IP headers.</p>

<p><strong>Note</strong> For encapsulated packets that have both a tunnel (outer) IPv4 header and a transport (inner) IPv4 header, the miniport driver should set this flag if either of the IP header checksum validations failed.</p>

<h3><code>Receive.TcpChecksumSucceeded</code></h3>

<p>Set by the miniport driver to indicate that the TCP checksum calculated by the NIC matched the
checksum in the receive packet's TCP header.</p>

<h3><code>Receive.UdpChecksumSucceeded</code></h3>

<p>Set by the miniport driver to indicate that the UDP checksum calculated by the NIC matched the
checksum in the receive packet's UDP header.</p>

<h3><code>Receive.IpChecksumSucceeded</code></h3>

<p>Set by the miniport driver to indicate that the IP checksum calculated by the NIC matched the
checksum in the receive packet's first IP header. If the receive packet contains both a tunnel IP
header and a transport IP header, the NIC validates the checksum for the both IP headers.</p>

<p><strong>Note</strong> For encapsulated packets that have both a tunnel (outer) IPv4 header and a transport (inner) IPv4 header, the miniport driver should set this flag only if both IP header checksum validations succeeded.</p>

<h3><code>Receive.Loopback</code></h3>

<p>NDIS uses this bit. The miniport driver must not examine or set this bit; the miniport driver
should just ignore this bit.</p>

<h3><code>Receive.TcpChecksumValueInvalid</code></h3>

<p>A miniport driver that supports <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/receive-segment-coalescing--rsc-">Receive Segment Coalescing (RSC)</a> sets this flag to indicate that the TCP header checksum was validated by the NIC but the TCP header checksum value in the packet is not valid. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/indicating-coalesced-segments">Indicating Coalesced Segments</a>.</p>

<p>Miniport drivers that do not support RSC should set this flag to zero.</p>

<p><strong>Note</strong> This flag is supported in NDIS 6.30 and later miniport drivers in Windows 8, Windows Server 2012, and later.</p>

<h3><code>Receive.IpChecksumValueInvalid</code></h3>

<p>A miniport driver that supports RSC sets this flag to indicate that for an IPv4 packet, the IP header checksum was validated by the NIC but the IP header checksum value in the packet is not valid. For a packet consisting of both a tunnel and a transport IP header, this bit is applicable only to the tunnel IP header. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/indicating-coalesced-segments">Indicating Coalesced Segments</a>.</p>

<p>Miniport drivers that do not support RSC should set this flag to zero.</p>

<p><strong>Note</strong> This flag is supported in NDIS 6.30 and later miniport drivers in Windows 8, Windows Server 2012, and later.</p>

<h3><code>Value</code></h3>

<p>A <strong>PVOID</strong> version of the checksum information. Miniport drivers can use this member to access the
raw information instead of the specific fields.</p>

<h2>Remarks</h2>

<p>The <strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure specifies information that is used in
offloading checksum tasks from the TCP/IP transport to a NIC. The
<strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure is part of the
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> information (out-of-band
data) that is associated with a <strong><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></strong> structure.</p>

<p>Before the TCP/IP transport passes to the miniport driver a TCP/IP packet on which the miniport driver will perform checksum tasks, the TCP/IP transport updates the <strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure that is associated with the <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure. Specifically, the TCP/IP transport sets the <strong>IsIPv4</strong> or <strong>IsIPv6</strong> flag to indicate that the send packet is an IPv4 or IPv6 packet.</p>

<p>yyIf the TCP/IP transport does not set either the <strong>IsIPv4</strong> or <strong>IsIPv6</strong> flag, the miniport driver should not perform checksum tasks on the packet. If the TCP/IP transport sets the <strong>IsIPv4</strong> or <strong>IsIPv6</strong> flag, it also sets the appropriate flags that are required to indicate which checksums the miniport driver should calculate for the packet. For IPv4, this includes the <strong>IpHeaderChecksum</strong>, <strong>TcpChecksum</strong>, or <strong>UdpChecksum</strong> flags. For IPv6, this includes the <strong>TcpChecksum</strong> or <strong>UdpChecksum</strong> flags. In addition, for TCP packets, the TCP/IP transport sets the <strong>TcpHeaderOffset</strong> field when either the <strong>IsIPv4</strong> or <strong>IPv6</strong> flag is set. The transport does not set this field for UDP packets.</p>

<p>Before indicating up a receive TCP/IP packet on which it performs checksum tasks, a miniport driver sets the appropriate Xxx<strong>ChecksumFailed</strong> or Xxx<strong>ChecksumSucceeded</strong> flags in the <strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure.</p>

<p><strong>Note</strong> Checksum offload is disabled until the miniport receives <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-offload-encapsulation">OID_OFFLOAD_ENCAPSULATION</a>. After it receives this OID, the miniport is then permitted to start validating the checksums on some received packets. The miniport is not required to validate the checksum on every packet; if both the Xxx<strong>ChecksumFailed</strong> and Xxx<strong>ChecksumSucceeded</strong> flags are clear, the OS will fall back to validating the checksum in software. This behavior is independent of WHCP driver certification requirements, which may require the miniport to validate the checksum on all packets as other protocol drivers on the system may not have a fallback mechanism.</p>

<p>To obtain the <strong>NDIS_TCP_IP_CHECKSUM_NET_BUFFER_LIST_INFO</strong> structure, a driver should call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-info">NET_BUFFER_LIST_INFO</a> macro with an
<em>_Id</em> of
<strong>TcpIpChecksumNetBufferListInfo</strong>.</p>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/indicating-coalesced-segments">Indicating Coalesced Segments</a></p>

<p><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-info">NET_BUFFER_LIST_INFO</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/nblchecksum/ns-nblchecksum-ndis_tcp_ip_checksum_net_buffer_list_info">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/nblchecksum/ns-nblchecksum-ndis_tcp_ip_checksum_net_buffer_list_info.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
