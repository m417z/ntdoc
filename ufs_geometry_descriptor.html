<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="UFS_GEOMETRY_DESCRIPTOR - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>UFS_GEOMETRY_DESCRIPTOR - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            UFS_GEOMETRY_DESCRIPTOR - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ufs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct {
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bLength;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bDescriptorIDN;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bMediaTechnology;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  Reserved1;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  qTotalRawDeviceCapacity[8];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bMaxNumberLU;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dSegmentSize[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bAllocationUnitSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bMinAddrBlockSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bOptimalReadBlockSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bOptimalWriteBlockSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bMaxInBufferSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bMaxOutBufferSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bRPMB_ReadWriteSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bDynamicCapacityResourcePolicy;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bDataOrdering;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bMaxContexIDNumber;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bSysDataTagUnitSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bSysDataTagResSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bSupportedSecRTypes;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wSupportedMemoryTypes[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dSystemCodeMaxNAllocU[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wSystemCodeCapAdjFac[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dNonPersistMaxNAllocU[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wNonPersistCapAdjFac[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dEnhanced1MaxNAllocU[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wEnhanced1CapAdjFac[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dEnhanced2MaxNAllocU[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wEnhanced2CapAdjFac[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dEnhanced3MaxNAllocU[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wEnhanced3CapAdjFac[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dEnhanced4MaxNAllocU[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  wEnhanced4CapAdjFac[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dOptimalLogicalBlockSize[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bHPBRegionSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bHPBNumberLU;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bHPBSubRegionSize;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a> wDeviceMaxActiveHPBRegions;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  Reserved2[2];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  dWriteBoosterBufferMaxNAllocUnits[4];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bDeviceMaxWriteBoosterLUs;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bWriteBoosterBufferCapAdjFac;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bSupportedWriteBoosterBufferUserSpaceReductionTypes;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>  bSupportedWriteBoosterBufferTypes;
} UFS_GEOMETRY_DESCRIPTOR, *PUFS_GEOMETRY_DESCRIPTOR;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ufs/ns-ufs-ufs_geometry_descriptor">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ufs_geometry_descriptor.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ufs-ufs_geometry_descriptor)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ufs_geometry_descriptor-structure">UFS_GEOMETRY_DESCRIPTOR structure</h1>

<h2 id="description">Description</h2>

<p><strong>UFS_GEOMETRY_DESCRIPTOR</strong> describes a device's geometric parameters.</p>

<h2 id="members">Members</h2>

<h3 id="blength"><code>bLength</code></h3>

<p>Specifies the length of the descriptor.</p>

<h3 id="bdescriptoridn"><code>bDescriptorIDN</code></h3>

<p>Specifies the type of the descriptor. This descriptor will have a value of <strong>UFS_DESC_GEOMETRY_IDN</strong>.</p>

<h3 id="bmediatechnology"><code>bMediaTechnology</code></h3>

<p>Reserved for future use.</p>

<h3 id="reserved1"><code>Reserved1</code></h3>

<p>Reserved for future use.</p>

<h3 id="qtotalrawdevicecapacity8"><code>qTotalRawDeviceCapacity[8]</code></h3>

<p>Specifies the total raw device capacity. Expressed in units of 512 bytes.</p>

<h3 id="bmaxnumberlu"><code>bMaxNumberLU</code></h3>

<p>Specifies the maximum number of logical unit(s) supported by the UFS (Universal Flash Storage). Contains one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0x00</td>
  <td>8 logical units.</td>
</tr>
<tr>
  <td>0x01</td>
  <td>32 logical units.</td>
</tr>
<tr>
  <td>Other Values</td>
  <td>Reserved for future use.</td>
</tr>
</tbody>
</table>

<h3 id="dsegmentsize4"><code>dSegmentSize[4]</code></h3>

<p>Specifies the segment size of the device in units of 512 bytes.</p>

<h3 id="ballocationunitsize"><code>bAllocationUnitSize</code></h3>

<p>Specifies the allocation unit size in number of segments.</p>

<h3 id="bminaddrblocksize"><code>bMinAddrBlockSize</code></h3>

<p>Specifies the minimum addressable block size in units of 512 bytes. The minimum size is 4 KB or a value of 0x08.</p>

<h3 id="boptimalreadblocksize"><code>bOptimalReadBlockSize</code></h3>

<p>Specifies the optimal read block size in units of 512 bytes.</p>

<h3 id="boptimalwriteblocksize"><code>bOptimalWriteBlockSize</code></h3>

<p>Specifies the optimal write block size in units of 512 bytes. <strong>bOptimalWriteBlockSize</strong> is equal to or greater than <strong>bMinAddrBlockSize</strong>.</p>

<h3 id="bmaxinbuffersize"><code>bMaxInBufferSize</code></h3>

<p>Specifies the max size of the data-in buffer in units of 512 bytes. The minium size is 4 KB or a value of 0x08.</p>

<h3 id="bmaxoutbuffersize"><code>bMaxOutBufferSize</code></h3>

<p>Specifies the max size of the data-out buffer in units of 512 bytes. The minium size is 4 KB or a value of 0x08.</p>

<h3 id="brpmb_readwritesize"><code>bRPMB_ReadWriteSize</code></h3>

<p>Specifies the maximum number of Replay Protected Memory Block (RPMB) frames allowed in Security Protocol In and Security Protocol Out. Each frame is 256-bytes.</p>

<h3 id="bdynamiccapacityresourcepolicy"><code>bDynamicCapacityResourcePolicy</code></h3>

<p>Specifies a device's spare blocks resource management policy. Contains one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0x00</td>
  <td>Spare blocks resource management policy is per logical unit.</td>
</tr>
<tr>
  <td>0x01</td>
  <td>Spare blocks resource management policy is per memory type.</td>
</tr>
</tbody>
</table>

<h3 id="bdataordering"><code>bDataOrdering</code></h3>

<p>Specifies if a device supports out-of-order data transfer. Contains one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0x00</td>
  <td>Out-of-order data transfer is not supported.</td>
</tr>
<tr>
  <td>0x01</td>
  <td>Out-of-order data transfer is supported.</td>
</tr>
<tr>
  <td>All other values</td>
  <td>Reserved for future use.</td>
</tr>
</tbody>
</table>

<h3 id="bmaxcontexidnumber"><code>bMaxContexIDNumber</code></h3>

<p>Specifies the max number of contexts supported by a device. This number must be greater than 5.</p>

<h3 id="bsysdatatagunitsize"><code>bSysDataTagUnitSize</code></h3>

<p>Specifies the system data tag unit size.</p>

<h3 id="bsysdatatagressize"><code>bSysDataTagResSize</code></h3>

<p>Specifies the maximum size in bytes allocated by the device to handle system data.</p>

<h3 id="bsupportedsecrtypes"><code>bSupportedSecRTypes</code></h3>

<p>Specifies the supported Secure Removal types. The first 3 bits of the variable are flags that represent different supported Secure Removal types.</p>

<table>
<thead>
<tr>
  <th>Bit</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0</td>
  <td>Information removed with an erase of the physical memory.</td>
</tr>
<tr>
  <td>1</td>
  <td>Information removed by overwriting the addressed locations with a single character followed by an erase.</td>
</tr>
<tr>
  <td>2</td>
  <td>Information removed by overwriting the addressed locations with a character, its complement, then a random character.</td>
</tr>
<tr>
  <td>3</td>
  <td>Information removed using a vendor-defined mechanism.</td>
</tr>
<tr>
  <td>4-7</td>
  <td>Reserved for future use.</td>
</tr>
</tbody>
</table>

<h3 id="wsupportedmemorytypes2"><code>wSupportedMemoryTypes[2]</code></h3>

<p>Specifies the supported memory types in a bitmap.</p>

<table>
<thead>
<tr>
  <th>Bit</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0</td>
  <td>A normal memory type is supported.</td>
</tr>
<tr>
  <td>1</td>
  <td>A system code memory type is supported.</td>
</tr>
<tr>
  <td>2</td>
  <td>A non-persistent memory type is supported.</td>
</tr>
<tr>
  <td>3</td>
  <td>Enhanced memory type 1 is supported.</td>
</tr>
<tr>
  <td>4</td>
  <td>Enhanced memory type 2 is supported.</td>
</tr>
<tr>
  <td>5</td>
  <td>Enhanced memory type 3 is supported.</td>
</tr>
<tr>
  <td>6</td>
  <td>Enhanced memory type 4 is supported.</td>
</tr>
<tr>
  <td>7-14</td>
  <td>Reserved for future use.</td>
</tr>
<tr>
  <td>15</td>
  <td>A RPMB memory type is supported.</td>
</tr>
</tbody>
</table>

<h3 id="dsystemcodemaxnallocu4"><code>dSystemCodeMaxNAllocU[4]</code></h3>

<p>Specifies the maximum number of allocation units for the System Code for a device.</p>

<h3 id="wsystemcodecapadjfac2"><code>wSystemCodeCapAdjFac[2]</code></h3>

<p>Species the Capacity Adjustment Factor for the System Code memory type.</p>

<h3 id="dnonpersistmaxnallocu4"><code>dNonPersistMaxNAllocU[4]</code></h3>

<p>Species the maximum number of Allocation Units for a non-persistent memory type.</p>

<h3 id="wnonpersistcapadjfac2"><code>wNonPersistCapAdjFac[2]</code></h3>

<p>Specifies the capacity adjustment factor for the non-persistent memory type.</p>

<h3 id="denhanced1maxnallocu4"><code>dEnhanced1MaxNAllocU[4]</code></h3>

<p>Specifies the max number of Allocation Units for the enhanced memory type 1.</p>

<h3 id="wenhanced1capadjfac2"><code>wEnhanced1CapAdjFac[2]</code></h3>

<p>Specifies the Capacity Adjustment Factor for the enhanced memory type 1.</p>

<h3 id="denhanced2maxnallocu4"><code>dEnhanced2MaxNAllocU[4]</code></h3>

<p>Specifies the max number of Allocation Units for the enhanced memory type 2.</p>

<h3 id="wenhanced2capadjfac2"><code>wEnhanced2CapAdjFac[2]</code></h3>

<p>Specifies the Capacity Adjustment Factor for the enhanced memory type 2.</p>

<h3 id="denhanced3maxnallocu4"><code>dEnhanced3MaxNAllocU[4]</code></h3>

<p>Specifies the max number of Allocation Units for the enhanced memory type 3.</p>

<h3 id="wenhanced3capadjfac2"><code>wEnhanced3CapAdjFac[2]</code></h3>

<p>Specifies the Capacity Adjustment Factor for the enhanced memory type 3.</p>

<h3 id="denhanced4maxnallocu4"><code>dEnhanced4MaxNAllocU[4]</code></h3>

<p>Specifies the max number of Allocation Units for the enhanced memory type 4.</p>

<h3 id="wenhanced4capadjfac2"><code>wEnhanced4CapAdjFac[2]</code></h3>

<p>Specifies the Capacity Adjustment Factor for the enhanced memory type 4.</p>

<h3 id="doptimallogicalblocksize4"><code>dOptimalLogicalBlockSize[4]</code></h3>

<p>Specifies the optimal logical block size.</p>

<ul>
<li>bit [3:0]: Normal memory type</li>
<li>bit [7:4]: System code memory type</li>
<li>bit [11:8]: Non-persistent memory type</li>
<li>bit [15:12]: Enhanced memory type 1</li>
<li>bit [19:16]: Enhanced memory type 2</li>
<li>bit [23:20]: Enhanced memory type 3</li>
<li>bit [27:24]: Enhanced memory type 4</li>
<li>bit [31:28]:Reserved</li>
</ul>

<h3 id="bhpbregionsize"><code>bHPBRegionSize</code></h3>

<p>Specifies the size of the HPB region.</p>

<h3 id="bhpbnumberlu"><code>bHPBNumberLU</code></h3>

<p>Specifies the maximum number of logical units in which HPB can be enabled.</p>

<h3 id="bhpbsubregionsize"><code>bHPBSubRegionSize</code></h3>

<p>Specifies the size of the HPB subregion. The <strong>bHPBSubRegionSize</strong> can't exceed <strong>bHPBRegionSize</strong>.</p>

<h3 id="wdevicemaxactivehpbregions"><code>wDeviceMaxActiveHPBRegions</code></h3>

<p>Specifies the mximum number of active HPB regions supported by the device.</p>

<h3 id="reserved22"><code>Reserved2[2]</code></h3>

<p>Reserved for future use.</p>

<h3 id="dwriteboosterbuffermaxnallocunits4"><code>dWriteBoosterBufferMaxNAllocUnits[4]</code></h3>

<p>Specifies the total WriteBooster buffer size supported by the device. The sum of WriteBooster buffer sizes for all LUs is less than or equal to the value indicated by <strong>dWriteBoosterBufferMaxNAllocUnits</strong>.</p>

<h3 id="bdevicemaxwriteboosterlus"><code>bDeviceMaxWriteBoosterLUs</code></h3>

<p>Specifies the maximum number of supported WriteBooster buffers.</p>

<h3 id="bwriteboosterbuffercapadjfac"><code>bWriteBoosterBufferCapAdjFac</code></h3>

<p>Specifies the capacity adjustment factor for the WriteBooster buffer memory type. This value provides the LBA space reduction multiplication factor when WriteBooster Buffer is configured in user space reduction mode. Therefore, this parameter applies only if <strong>bWriteBoosterBufferPreserveUserSpaceEn</strong> is 0x00.</p>

<h3 id="bsupportedwriteboosterbufferuserspacereductiontypes"><code>bSupportedWriteBoosterBufferUserSpaceReductionTypes</code></h3>

<p>Specifies the supportability of user space reduction mode and preserve user space mode.</p>

<ul>
<li>0x00: WriteBooster buffer can only be configured in user space reduction type.</li>
<li>ox01: WriteBooster buffer can only be configured in preserve user space type.</li>
<li>ox02: Device can be configured in either user space reduction type or preserve user space type.</li>
<li>Others : Reserved</li>
</ul>

<h3 id="bsupportedwriteboosterbuffertypes"><code>bSupportedWriteBoosterBufferTypes</code></h3>

<p>Specifies the supportability of WriteBooster buffer type.</p>

<ul>
<li>00h: LU based WriteBooster buffer configuration</li>
<li>01h: Single shared WriteBooster buffer configuration</li>
<li>02h: Supporting both LU based WriteBooster buffer and single shared WriteBooster buffer configuration</li>
<li>Others: Reserved</li>
</ul>

<h2 id="remarks">Remarks</h2>

<p>If the size of the data transferred exceeds the number of frames <strong>bRPMB_ReadWriteSize</strong>, it will be done in multiple Security commands.</p>

<p>The Capacity Adjustment Factor value for a normal memory type is equal to one.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ufs/ns-ufs-ufs_geometry_descriptor">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ufs/ns-ufs-ufs_geometry_descriptor.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
