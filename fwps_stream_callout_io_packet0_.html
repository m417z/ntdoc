<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FWPS_STREAM_CALLOUT_IO_PACKET0_ - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FWPS_STREAM_CALLOUT_IO_PACKET0_ - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FWPS_STREAM_CALLOUT_IO_PACKET0_ - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fwpsk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct FWPS_STREAM_CALLOUT_IO_PACKET0_ {
  <a href="fwps_stream_data0_" title="typedef struct FWPS_STREAM_DATA0_ {&#10;  UINT32                   flags;&#10;  FWPS_STREAM_DATA_OFFSET0 dataOffset;&#10;  SIZE_T                   dataLength;&#10;  NET_BUFFER_LIST          *netBufferListChain;&#10;} FWPS_STREAM_DATA0;">FWPS_STREAM_DATA0</a>       *streamData;
  <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                  missedBytes;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                  countBytesRequired;
  <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                  countBytesEnforced;
  FWPS_STREAM_ACTION_TYPE streamAction;
} FWPS_STREAM_CALLOUT_IO_PACKET0;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fwpsk/ns-fwpsk-fwps_stream_callout_io_packet0_">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fwps_stream_callout_io_packet0_.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-fwpsk-fwps_stream_callout_io_packet0_)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fwps_stream_callout_io_packet0_-structure">FWPS_STREAM_CALLOUT_IO_PACKET0_ structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>FWPS_STREAM_CALLOUT_IO_PACKET0</strong> structure describes the data passed by the filter engine to a
callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function when filtering a
data stream.</p>

<p><strong>Note</strong> <strong>FWPS_STREAM_CALLOUT_IO_PACKET0</strong> is a specific version of <strong>FWPS_STREAM_CALLOUT_IO_PACKET</strong>. See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/FWP/wfp-version-independent-names-and-targeting-specific-versions-of-windows">WFP Version-Independent Names and Targeting Specific Versions of Windows</a> for more information.</p>

<h2 id="members">Members</h2>

<h3 id="streamdata"><code>streamData</code></h3>

<p>A pointer to an
<a href="fwps_stream_data0_" title="typedef struct FWPS_STREAM_DATA0_ {&#10;  UINT32                   flags;&#10;  FWPS_STREAM_DATA_OFFSET0 dataOffset;&#10;  SIZE_T                   dataLength;&#10;  NET_BUFFER_LIST          *netBufferListChain;&#10;} FWPS_STREAM_DATA0;">FWPS_STREAM_DATA0</a> structure that
describes the portion of the data stream available to the callout driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function for processing.</p>

<h3 id="missedbytes"><code>missedBytes</code></h3>

<p>The number of bytes in the data stream that are missing since the last time the callout driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function was called. This
member is nonzero if a higher weight filter in the filter engine prevented the callout driver's
classifyFn callout function from processing a
portion of the data stream.</p>

<h3 id="countbytesrequired"><code>countBytesRequired</code></h3>

<p>A value set by a callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function. This value
specifies how many additional bytes of stream data are required by the callout function if it sets the
<strong>streamAction</strong> member to <strong>FWPS_STREAM_ACTION_NEED_MORE_DATA</strong>. The filter engine waits until it
receives at least this many additional bytes of stream data before calling the callout driver's
classifyFn callout function again.</p>

<p>If a callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function sets the
<strong>streamAction</strong> member to a value other than <strong>FWPS_STREAM_ACTION_NEED_MORE_DATA</strong>, then it should set
this member to zero.</p>

<h3 id="countbytesenforced"><code>countBytesEnforced</code></h3>

<p>A value set by a callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function. This value
specifies the number of leading bytes of data in the portion of the data stream being processed to which
the action specified by the
<strong>streamAction</strong> member or by the action returned by the callout function applies. Any remaining data
in the stream buffer will be passed to the callout driver again the next time the filter engine calls
the callout driver's
classifyFn callout function.</p>

<h3 id="streamaction"><code>streamAction</code></h3>

<p>An <strong>FWPS_STREAM_ACTION_TYPE</strong> value set by a callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function that specifies
the action to be applied to the data stream. This action is independent of the action returned by the
callout function. A callout's
classifyFn callout function sets this member
to one of the following:</p>

<h4 id="fwps_stream_action_none">FWPS_STREAM_ACTION_NONE</h4>

<p>No stream-specific action is required.</p>

<h4 id="fwps_stream_action_allow_connection">FWPS_STREAM_ACTION_ALLOW_CONNECTION</h4>

<p>Indicates that all future data segments belonging to a flow are permitted. In this case, WFP stops classifying any data segments to the callout and attempts to offload the flow to the hardware such that no more inspection overhead is incurred.</p>

<h4 id="fwps_stream_action_need_more_data">FWPS_STREAM_ACTION_NEED_MORE_DATA</h4>

<p>More stream data is required by the callout function.</p>

<h4 id="fwps_stream_action_drop_connection">FWPS_STREAM_ACTION_DROP_CONNECTION</h4>

<p>The stream connection should be dropped. A callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function should only set
the
<strong>streamAction</strong> member to this value if the
<strong>action.type</strong> member of the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_filter0">FWPS_FILTER0</a> structure that the filter
engine passed to the callout driver's
classifyFn callout function contains the value <strong>FWP_ACTION_CALLOUT_UNKNOWN</strong>. If a callout's
classifyFn callout function sets the
<strong>streamAction</strong> member to this value when the
<strong>action.type</strong> member of the <strong>FWPS_FILTER0</strong> structure contains the value
<strong>FWP_ACTION_CALLOUT_INSPECTION</strong>, the connection will not be dropped.</p>

<h4 id="fwps_stream_action_defer">FWPS_STREAM_ACTION_DEFER</h4>

<p>Processing of the stream data will be deferred until the callout driver calls the
<a href="fwpsstreamcontinue0" title="NTSTATUS FwpsStreamContinue0(&#10;  [in] UINT64 flowId,&#10;  [in] UINT32 calloutId,&#10;  [in] UINT16 layerId,&#10;  [in] UINT32 streamFlags&#10;);">FwpsStreamContinue0</a> function. This
action can only be set for an inbound data stream.</p>

<p>Deferring an inbound data stream will cause the network stack to stop acknowledging data received
from the sender. This will lead to a reduction in the size of the sliding TCP window. A callout driver
can use this behavior to implement flow control to slow down the incoming data rate.</p>

<p>The <strong>FWPS_STREAM_ACTION_TYPE_MAX</strong> value is a maximum value for testing purposes.</p>

<p>If a callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function sets this member
to a value other than <strong>FWPS_STREAM_ACTION_NONE</strong>, then the action returned by the callout function is
ignored by the filter engine.</p>

<h2 id="remarks">Remarks</h2>

<p>The filter engine passes a pointer to an <strong>FWPS_STREAM_CALLOUT_IO_PACKET0</strong> structure to a callout's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function as the
<em>layerData</em> parameter when filtering a data stream.</p>

<h2 id="see-also">See also</h2>

<p><a href="fwps_stream_data0_" title="typedef struct FWPS_STREAM_DATA0_ {&#10;  UINT32                   flags;&#10;  FWPS_STREAM_DATA_OFFSET0 dataOffset;&#10;  SIZE_T                   dataLength;&#10;  NET_BUFFER_LIST          *netBufferListChain;&#10;} FWPS_STREAM_DATA0;">FWPS_STREAM_DATA0</a></p>

<p><a href="fwpsstreamcontinue0" title="NTSTATUS FwpsStreamContinue0(&#10;  [in] UINT64 flowId,&#10;  [in] UINT32 calloutId,&#10;  [in] UINT16 layerId,&#10;  [in] UINT32 streamFlags&#10;);">FwpsStreamContinue0</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/types-of-callouts">Types of Callouts</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fwpsk/ns-fwpsk-fwps_stream_callout_io_packet0_">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fwpsk/ns-fwpsk-fwps_stream_callout_io_packet0_.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
