<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisMRegisterUnloadHandler - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisMRegisterUnloadHandler - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisMRegisterUnloadHandler - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID NdisMRegisterUnloadHandler(
  [in] NDIS_HANDLE    NdisWrapperHandle,
  [in] PDRIVER_UNLOAD UnloadHandler
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismregisterunloadhandler">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndismregisterunloadhandler.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndismregisterunloadhandler)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndismregisterunloadhandler-function">NdisMRegisterUnloadHandler function</h1>

<h2 id="description">Description</h2>

<p><strong>Note</strong> NDIS 5. <em>x</em> has been deprecated and is superseded by NDIS 6. <em>x</em>. For new NDIS driver development, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">Network Drivers Starting with Windows Vista</a>. For information about porting NDIS 5. <em>x</em> drivers to NDIS 6. <em>x</em>, see <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff570059">Porting NDIS 5.x Drivers to NDIS 6.0</a>.</p>

<p>The <strong>NdisMRegisterUnloadHandler</strong> function registers an unload handler for a driver.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="ndiswrapperhandle-in"><code>NdisWrapperHandle</code> [in]</h3>

<p>Specifies the handle returned by <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553547/(v=vs.85/)"><strong>NdisMInitializeWrapper</strong></a>.</p>

<h3 id="unloadhandler-in"><code>UnloadHandler</code> [in]</h3>

<p>Specifies the entry point for the driver's unload routine. An unload routine is declared as follows:</p>

<div class="codehilite">
<pre><span></span><code><span class="n">VOID</span>
<span class="p">(</span><span class="o">*</span><span class="n">PDRIVER_UNLOAD</span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_DRIVER_OBJECT</span><span class="w"> </span><span class="o">*</span><span class="n">DriverObject</span>
<span class="w">    </span><span class="p">);</span>
</code></pre>
</div>

<h2 id="remarks">Remarks</h2>

<p>A driver calls <strong>NdisMRegisterUnloadHandler</strong> from its <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> function after <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> has called <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553602/(v=vs.85/)"><strong>NdisMRegisterMiniport</strong></a> or <strong><a href="ndisimregisterlayeredminiport" title="NDIS_STATUS NdisIMRegisterLayeredMiniport(&#10;  [in]  NDIS_HANDLE                    NdisWrapperHandle,&#10;  [in]  PNDIS_MINIPORT_CHARACTERISTICS MiniportCharacteristics,&#10;  [in]  UINT                           CharacteristicsLength,&#10;  [out] PNDIS_HANDLE                   DriverHandle&#10;);">NdisIMRegisterLayeredMiniport</a></strong>. <strong>NdisMRegisterUnloadHandler</strong> registers an unload handler for the driver.</p>

<p>The functionality of the unload handler is driver-specific. For example, an intermediate driver should register an unload handler that calls <strong><a href="ndisderegisterprotocol" title="VOID NdisDeregisterProtocol(&#10;  [out] PNDIS_STATUS Status,&#10;  [in]  NDIS_HANDLE  NdisProtocolHandle&#10;);">NdisDeregisterProtocol</a></strong> to deregister the protocol portion of the intermediate driver. The unload handler should also perform any necessary cleanup operations, such as deallocating resources used by the protocol portion of the driver.</p>

<p>A miniport driver, such as a load-balancing miniport driver, that monitors more than one miniport driver instance should register an unload handler that cleans up state information and deallocates resources after the miniport driver instances that it monitors are halted. Note that an unload handler differs from a <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549451/(v=vs.85/)"><strong>MiniportHalt</strong></a> function: the unload handler has a more global scope, whereas the scope of the MiniportHalt function is restricted to a particular miniport driver instance.</p>

<ul>
<li>Target platform: <a rel="noopener" target="_blank" href="https://go.microsoft.com/fwlink/p/?linkid=531356">Universal</a></li>
<li>Version: Not supported for NDIS 6.0 drivers in Windows Vista. Use <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff563654"><strong>NdisMRegisterMiniportDriver</strong></a>instead. Supported for NDIS 5.1 drivers in Windows Vista and Windows XP.</li>
</ul>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548818"><strong>DriverEntry of NDIS Miniport Drivers</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549451/(v=vs.85/)"><strong>MiniportHalt</strong></a></li>
<li><strong><a href="ndisderegisterprotocol" title="VOID NdisDeregisterProtocol(&#10;  [out] PNDIS_STATUS Status,&#10;  [in]  NDIS_HANDLE  NdisProtocolHandle&#10;);">NdisDeregisterProtocol</a></strong></li>
<li><strong><a href="ndisimregisterlayeredminiport" title="NDIS_STATUS NdisIMRegisterLayeredMiniport(&#10;  [in]  NDIS_HANDLE                    NdisWrapperHandle,&#10;  [in]  PNDIS_MINIPORT_CHARACTERISTICS MiniportCharacteristics,&#10;  [in]  UINT                           CharacteristicsLength,&#10;  [out] PNDIS_HANDLE                   DriverHandle&#10;);">NdisIMRegisterLayeredMiniport</a></strong></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553602/(v=vs.85/)"><strong>NdisMRegisterMiniport</strong></a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismregisterunloadhandler">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndismregisterunloadhandler.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
