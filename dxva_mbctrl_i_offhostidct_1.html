<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXVA_MBctrl_I_OffHostIDCT_1 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXVA_MBctrl_I_OffHostIDCT_1 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXVA_MBctrl_I_OffHostIDCT_1 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// dxva.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _DXVA_MBctrl_I_OffHostIDCT_1 {
  <a href="word" title="typedef unsigned short WORD;">WORD</a>  wMBaddress;
  <a href="word" title="typedef unsigned short WORD;">WORD</a>  wMBtype;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> dwMB_SNL;
  <a href="word" title="typedef unsigned short WORD;">WORD</a>  wPatternCode;
  <a href="byte" title="typedef unsigned char BYTE;">BYTE</a>  bNumCoef[DXVA_NumBlocksPerMB_420];
} DXVA_MBctrl_I_OffHostIDCT_1;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_mbctrl_i_offhostidct_1">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxva_mbctrl_i_offhostidct_1.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-dxva-_dxva_mbctrl_i_offhostidct_1)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_dxva_mbctrl_i_offhostidct_1-structure">_DXVA_MBctrl_I_OffHostIDCT_1 structure</h1>

<h2 id="description">Description</h2>

<p>The DXVA_MBctrl_I_OffHostIDCT_1 structure is sent once per macroblock by the host decoder to the accelerator to specify macroblock control commands for 4:2:0 intra pictures when using off-host IDCT.</p>

<h2 id="members">Members</h2>

<h3 id="wmbaddress"><code>wMBaddress</code></h3>

<p>Specifies the macroblock address of the current macroblock in raster scan order. For examples of macroblock addresses see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/macroblock-addresses">macroblock addresses</a>.</p>

<h3 id="wmbtype"><code>wMBtype</code></h3>

<p>Specifies the type of macroblock being processed. The following bits define macroblock processing.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;"><strong>Bits</strong></th>
  <th style="text-align:left;"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;">15 to 12</td>
  <td style="text-align:left;">MvertFieldSel_3 (bit 15, the most significant bit) through MvertFieldSel_0 (bit 12)<br>Must be zero.</td>
</tr>
<tr>
  <td style="text-align:left;">11</td>
  <td style="text-align:left;"><em>Reserved Bit</em><br>Must be zero.</td>
</tr>
<tr>
  <td style="text-align:left;">10</td>
  <td style="text-align:left;"><em>HostResidDiff</em><br>Specifies whether spatial-domain residual difference decoded blocks are sent or whether transform coefficients are sent for off-host IDCT for the current macroblock.<br>The HostResidDiff flag is always equal to zero in this structure. This flag must be zero if bConfigResidDiffHost is zero. This flag must be 1 if bConfigResidDiffAccelerator is zero. The bConfigResidDiffHost and bConfigResidDiffAccelerator members are contained in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_configpicturedecode">DXVA_ConfigPictureDecode</a> structure.</td>
</tr>
<tr>
  <td style="text-align:left;">9 and 8</td>
  <td style="text-align:left;"><em>MotionType</em><br>This does not apply to intra pictures. Both bits must be zero.</td>
</tr>
<tr>
  <td style="text-align:left;">7 and 6</td>
  <td style="text-align:left;"><em>MBscanMethod</em><br>Specifies the scan method of the macroblock control command. This must be equal to bPicScanMethod if bPicScanFixed is 1.<br>If bConfigHostInverseScan is zero, MBscanMethod is one of the following values:</td>
</tr>
</tbody>
</table>

<ul>
<li>Zero âˆ’ zigzag scan (MPEG-2 Figure 7-2)</li>
<li>1 âˆ’ alternate-vertical scan (MPEG-2 Figure 7-3)</li>
<li>2 âˆ’ alternate-horizontal scan (H.263 Figure I.2 Part a)</li>
</ul>

<p>If bConfigHostInverseScan is 1, MBscanMethod is equal to 3, which is an arbitrary scan with absolute coefficient address. bPicScanMethod and bPicScanFixed are members of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_pictureparameters">DXVA_PictureParameters</a> . bConfigHostInverseScan is a member of <a href="lpdxva_configpicturedecode" title="typedef struct _DXVA_ConfigPictureDecode {&#10;  DXVA_ConfigQueryOrReplyFunc dwFunction;&#10;  DWORD                       dwReservedBits[3];&#10;  GUID                        guidConfigBitstreamEncryption;&#10;  GUID                        guidConfigMBcontrolEncryption;&#10;  GUID                        guidConfigResidDiffEncryption;&#10;  BYTE                        bConfigBitstreamRaw;&#10;  BYTE                        bConfigMBcontrolRasterOrder;&#10;  BYTE                        bConfigResidDiffHost;&#10;  BYTE                        bConfigSpatialResid8;&#10;  BYTE                        bConfigResid8Subtraction;&#10;  BYTE                        bConfigSpatialHost8or9Clipping;&#10;  BYTE                        bConfigSpatialResidInterleaved;&#10;  BYTE                        bConfigIntraResidUnsigned;&#10;  BYTE                        bConfigResidDiffAccelerator;&#10;  BYTE                        bConfigHostInverseScan;&#10;  BYTE                        bConfigSpecificIDCT;&#10;  BYTE                        bConfig4GroupedCoefs;&#10;} DXVA_ConfigPictureDecode, *LPDXVA_ConfigPictureDecode;">DXVA_ConfigPictureDecode</a>. |
| 5 | <em>FieldResidual</em><br>Indicates whether the residual difference blocks use a field IDCT structure as specified in MPEG-2.<br>Must be 1 if the bPicStructure member of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_pictureparameters">DXVA_PictureParameters</a> is 1 or 2. When used for MPEG-2, FieldResidual must be zero if the frame_pred_frame_DCT flag in the MPEG-2 syntax is 1, and must be equal to the dct_type element of the MPEG-2 syntax if dct_type is present for the macroblock. |
| 4 | <em>H261LoopFilter</em><br>Must be zero. |
| 3 | <em>Motion4MV</em><br>Must be zero. |
| 2 | <em>MotionBackward</em><br>Must be zero. |
| 1 | <em>MotionForward</em><br>Must be zero. |
| 0 | <em>IntraMacroblock</em><br>Must be 1. |</p>

<h3 id="dwmb_snl"><code>dwMB_SNL</code></h3>

<h3 id="wpatterncode"><code>wPatternCode</code></h3>

<p>Indicates whether residual difference data is sent for each block in the macroblock. In an intra picture, residual difference data is sent for every block in the macroblock. The bits in <strong>wPatternCode</strong> that refer to all blocks of the current macroblock must be 1 in DXVA_MBctrl_I_OffHostIDCT_1.</p>

<p>Bit (11-<em>i</em>) of <strong>wPatternCode</strong> (where bit 0 is the least significant bit) indicates whether residual difference data is sent for block <em>i</em>, where <em>i</em> is the index of the block within the macroblock as specified in MPEG-2 figures 6-10, 6-11, and 6-12 (raster scan order for Y, followed by 4:2:0 blocks of Cb in raster scan order, followed by 4:2:0 blocks of Cr, followed by 4:2:2 blocks of Cb, followed by 4:2:2 blocks of Cr, followed by 4:4:4 blocks of Cb, followed by 4:4:4 blocks of Cr). The data for the coded blocks (those blocks having bit (11-<em>i</em>) equal to 1) is found in the residual coding buffer in the same indexing order (increasing <em>i</em>). For 4:2:0 MPEG-2 data, the value of <strong>wPatternCode</strong> corresponds to shifting the decoded value of CBP (coded block pattern) to the left by six bit positions (those lower-bit positions being used for 4:2:2 and 4:4:4 chroma formats).</p>

<h3 id="bnumcoef"><code>bNumCoef</code></h3>

<p>Each value in the <strong>bNumCoef</strong> array indicates the number of coefficients in the residual difference data buffer for each block <em>i</em> of the macroblock.</p>

<p>The array subscript <em>i</em> is the index of the block within the macroblock as specified in MPEG-2 video Figures 6-10, 6-11, and 6-12 (raster-scan order for Y, followed by Cb, followed by Cr).</p>

<p>This member is used only when the <em>HostResidDiff</em> flag (bit 10 in <strong>wMBtype</strong>) is zero, and <strong>bChromaFormat</strong> is 1 (4:2:0). If used in 4:2:2 or 4:4:4 formats, it would increase the size of typical macroblock control commands past a critical memory alignment boundary. As a result, the <em>TCoefEOB</em> bit within the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_tcoefsingle">DXVA_TCoefSingle</a> structure is used for determining the number of coefficients in each block in non-4:2:0 cases.</p>

<p>The purpose of <strong>bNumCoef</strong> is to indicate the quantity of data present for each block in the residual difference data buffer, expressed as the number of coefficients present. When the <strong>bConfig4GroupedCoefs</strong> member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_configpicturedecode">DXVA_ConfigPictureDecode</a> structure is 1, <strong>bNumCoef</strong> may contain either the actual number of coefficients sent for the block or that value rounded up to be a multiple of four. The data for these coefficients is found in the residual difference buffer in the same order.</p>

<h2 id="remarks">Remarks</h2>

<p>Skipped macroblocks are not used by intra pictures, so the <em>MBskipsFollowing</em> variable must be zero. The <em>MBdataLocation</em> variable must be zero for the first macroblock in the macroblock control command buffer. For more information about how skipped macroblocks are generated, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/generating-skipped-macroblocks">Generating Skipped Macroblocks</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_configpicturedecode">DXVA_ConfigPictureDecode</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_mbctrl_i_hostresiddiff_1">DXVA_MBctrl_I_HostResidDiff_1</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_pictureparameters">DXVA_PictureParameters</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_tcoefsingle">DXVA_TCoefSingle</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_mbctrl_i_offhostidct_1">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/dxva/ns-dxva-_dxva_mbctrl_i_offhostidct_1.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
