<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_GETDISPLAYSTATEINTRUSIVE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_GETDISPLAYSTATEINTRUSIVE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_GETDISPLAYSTATEINTRUSIVE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// dispmprt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKDDI_GETDISPLAYSTATEINTRUSIVE DxgkddiGetdisplaystateintrusive;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiGetdisplaystateintrusive(
  [in]     HANDLE Context,
  [in/out] <a href="dxgkarg_getdisplaystateintrusive" title="typedef struct _DXGKARG_GETDISPLAYSTATE_INTRUSIVE {&#10;  UINT                        NumOfTargets;&#10;  UINT                        SizeOfDisplayStateIntrusiveElement;&#10;  DXGK_DISPLAYSTATE_INTRUSIVE **ppDisplayStateIntrusive;&#10;} DXGKARG_GETDISPLAYSTATEINTRUSIVE, *PDXGKARG_GETDISPLAYSTATEINTRUSIVE;">PDXGKARG_GETDISPLAYSTATEINTRUSIVE</a> pArgs
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystateintrusive">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_getdisplaystateintrusive.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-dispmprt-dxgkddi_getdisplaystateintrusive)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgkddi_getdisplaystateintrusive-callback-function">DXGKDDI_GETDISPLAYSTATEINTRUSIVE callback function</h1>

<h2 id="description">Description</h2>

<p>The operating system (OS) calls a display miniport driver's <strong>DxgkDdiGetDisplayStateNonIntrusive</strong> routine to collect display state information from the driver.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="context-in"><code>Context</code> [in]</h3>

<p>Pointer to a private context returned by <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_query_interface"><strong>DxgkDdiQueryInterface</strong></a>.</p>

<h3 id="pargs-inout"><code>pArgs</code> [in/out]</h3>

<p>Pointer to a <strong><a href="dxgkarg_getdisplaystateintrusive" title="typedef struct _DXGKARG_GETDISPLAYSTATE_INTRUSIVE {&#10;  UINT                        NumOfTargets;&#10;  UINT                        SizeOfDisplayStateIntrusiveElement;&#10;  DXGK_DISPLAYSTATE_INTRUSIVE **ppDisplayStateIntrusive;&#10;} DXGKARG_GETDISPLAYSTATEINTRUSIVE, *PDXGKARG_GETDISPLAYSTATEINTRUSIVE;">DXGKARG_GETDISPLAYSTATEINTRUSIVE</a></strong> structure.</p>

<h2 id="return-value">Return value</h2>

<p><strong>DxgkDdiGetDisplayStateIntrusive</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it succeeds. Otherwise it returns an error code such as one of the following.</p>

<table>
<thead>
<tr>
  <th>Error Code</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_DRIVER_INTERNAL_ERROR</td>
  <td>A generic software error occurred inside the driver.</td>
</tr>
<tr>
  <td>STATUS_ACCESS_DENIED</td>
  <td>The hardware is being currently used by other threads and this DDI can't get access to it.</td>
</tr>
<tr>
  <td>STATUS_DEVICE_HARDWARE_ERROR</td>
  <td>Generic HW error happened.</td>
</tr>
<tr>
  <td>STATUS_DEVICE_POWERED_OFF</td>
  <td>The device is powered off.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The OS calls <strong>DxgkDdiGetDisplayStateIntrusive</strong> to collect display state information from the driver when the user is already in a bad state. Unlike <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystatenonintrusive"><strong>DxgkDdiGetDisplayStateNonIntrusive</strong></a>, the driver's <strong>DxgkDdiGetDisplayStateIntrusive</strong> routine can carry out more intrusive operations that have visible side effects to the user . An intrusive operation is defined as follows (non-intrusive operations do not have any of these properties):</p>

<ul>
<li><p>It causes side effects (glitches) that are visible to the user (such as temporarily stopping scan out and destructive monitor connectivity check).</p></li>
<li><p>It is slow, and affects system or display performance if called frequently (multiple times in a second).</p></li>
<li><p>It changes the state of the display subsystem (or any other subsystem) directly or indirectly.</p></li>
</ul>

<p>The driver should not change the state of the system intentionally when collecting data.</p>

<p>The OS will call this routine much less frequently relative to calls to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystatenonintrusive"><strong>DxgkDdiGetDisplayStateNonIntrusive</strong></a>. In the majority of error scenarios, the OS will first call <strong>DxgkDdiGetDisplayStateNonIntrusive</strong> and then call <strong>DxgkDdiGetDisplayStateIntrusive</strong> to ensure that any unintentional effect of the intrusive call is not affecting the non-intrusive data collection.</p>

<p>DXGKRNL will call this routine with <strong>NumOfTargets</strong> set to the number of targets on which the OS reports that there is a monitor connected with corresponding <strong>VidPnTargetId</strong> filled in. When the driver believes there is no monitor connected on a given target then it should set the <strong>ReturnSubStatus</strong> for that target to be DXGK_DIAG_GETDISPLAYSTATE_MONITOR_NOT_CONNECTED.</p>

<blockquote>
  <p>[!NOTE]
  If the driver hits a failure on a given vidpntarget while collecting information, it should use <strong>ReturnSubStatus</strong> to set the error state and proceed to the next vidpntarget and not fail the overall call unless all the paths hit failures. Drivers should ideally record errors hit during this call in some internal error log so that when OS calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_collectdiagnosticinfo"><strong>DxgkDdiCollectDiagnosticInfo</strong></a> for collecting black box information, these errors are captured as part of an internal log collection to help IHVs debug.</p>
  
  <p>The OS will have a sufficient timeout (approximately 5 seconds) for <strong>DxgkDdiGetDisplayStateIntrusive</strong> to complete, giving the driver more time to collect all the relevant state. After a timeout, the OS might bugcheck the machine and collect a dump if the driver hangs in this call, so the miniport should try to always complete this call within the time frame.</p>
</blockquote>

<p>Synchronization level for this DDI is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/threading-and-synchronization-zero-level">zero level synchronization</a>.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="dxgkarg_getdisplaystateintrusive" title="typedef struct _DXGKARG_GETDISPLAYSTATE_INTRUSIVE {&#10;  UINT                        NumOfTargets;&#10;  UINT                        SizeOfDisplayStateIntrusiveElement;&#10;  DXGK_DISPLAYSTATE_INTRUSIVE **ppDisplayStateIntrusive;&#10;} DXGKARG_GETDISPLAYSTATEINTRUSIVE, *PDXGKARG_GETDISPLAYSTATEINTRUSIVE;">DXGKARG_GETDISPLAYSTATEINTRUSIVE</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_collectdiagnosticinfo"><strong>DxgkDdiCollectDiagnosticInfo</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystatenonintrusive"><strong>DxgkDdiGetDisplayStateNonIntrusive</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_query_interface"><strong>DxgkDdiQueryInterface</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_getdisplaystateintrusive">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/dispmprt/nc-dispmprt-dxgkddi_getdisplaystateintrusive.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
