<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WNODE_HEADER - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WNODE_HEADER - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WNODE_HEADER - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wmistr.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _WNODE_HEADER {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> BufferSize;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ProviderId;
  union {
    <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> HistoricalContext;
    struct {
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Version;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Linkage;
    } DUMMYSTRUCTNAME;
  } DUMMYUNIONNAME;
  union {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>         CountLost;
    HANDLE        KernelHandle;
    LARGE_INTEGER TimeStamp;
  } DUMMYUNIONNAME2;
  GUID  Guid;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ClientContext;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags;
} WNODE_HEADER, *PWNODE_HEADER;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wmistr/ns-wmistr-_wnode_header">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wnode_header.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-wmistr-_wnode_header)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_wnode_header-structure">_WNODE_HEADER structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>WNODE_HEADER</strong> structure is the first member of all other <strong>WNODE_*XXX*</strong> structures. It contains information common to all such structures.</p>

<h2 id="members">Members</h2>

<h3 id="buffersize"><code>BufferSize</code></h3>

<p>This member specifies the size, in bytes, of the nonpaged buffer to receive any <strong>WNODE_*XXX*</strong> data to be returned, including this <strong>WNODE_HEADER</strong> structure, additional members of a <strong>WNODE_*XXX*</strong> structure of the type indicated by <strong>Flags</strong>, and any WMI- or driver-determined data that accompanies that structure.</p>

<h3 id="providerid"><code>ProviderId</code></h3>

<p>If <strong>Flags</strong> is set to WNODE_FLAG_EVENT_ITEM or WNODE_FLAG_EVENT_REFERENCE, <strong>ProviderId</strong> should contain the ID of the WMI provider associated with the device object. You can obtain the <strong>ProviderId</strong> value by calling <a rel="noopener" target="_blank" href="iowmideviceobjecttoproviderid">IoWMIDeviceObjectToProviderId</a>. If <strong>Flags</strong> is set to any other value, this member is reserved.</p>

<h3 id="dummyunionname"><code>DUMMYUNIONNAME</code></h3>

<h3 id="dummyunionnamehistoricalcontext"><code>DUMMYUNIONNAME.HistoricalContext</code></h3>

<p>This member stores the handle to the event tracing session.</p>

<h3 id="dummyunionnamedummystructname"><code>DUMMYUNIONNAME.DUMMYSTRUCTNAME</code></h3>

<h3 id="dummyunionnamedummystructnameversion"><code>DUMMYUNIONNAME.DUMMYSTRUCTNAME.Version</code></h3>

<p>This member is reserved for WMI.</p>

<h3 id="dummyunionnamedummystructnamelinkage"><code>DUMMYUNIONNAME.DUMMYSTRUCTNAME.Linkage</code></h3>

<p>This member is reserved for WMI.</p>

<h3 id="dummyunionname2"><code>DUMMYUNIONNAME2</code></h3>

<h3 id="dummyunionname2countlost"><code>DUMMYUNIONNAME2.CountLost</code></h3>

<p>Reserved</p>

<h3 id="dummyunionname2kernelhandle"><code>DUMMYUNIONNAME2.KernelHandle</code></h3>

<p>This member is reserved for WMI.</p>

<h3 id="dummyunionname2timestamp"><code>DUMMYUNIONNAME2.TimeStamp</code></h3>

<p>This member indicates the time at which a driver collected the <strong>WNODE_*XXX*</strong> data. This time value is expressed in absolute system time format. Absolute system time is the number of 100-nanosecond intervals since the start of the year 1601 in the Gregorian calendar. A driver can call <strong><a href="kequerysystemtime" title="VOID KeQuerySystemTime(&#10;  [out] PLARGE_INTEGER CurrentTime&#10;);">KeQuerySystemTime</a></strong> to obtain this value. If the block is to be written to a log file (WNODE_FLAG_LOG_WNODE), an NT driver might also set WNODE_FLAG_USE_TIMESTAMP in <strong>Flags</strong> to request that the system logger leave the value of <strong>TimeStamp</strong> unchanged.</p>

<h3 id="guid"><code>Guid</code></h3>

<p>This member indicates the GUID that represents the data block associated with the <strong>WNODE_*XXX*</strong> to be returned.</p>

<h3 id="clientcontext"><code>ClientContext</code></h3>

<p>This member stores the clock type for the session. Possible values are included in the following table.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>1</td>
  <td>Performance counter value (also called QPC, QueryPerformanceCounter, or PerfCounter)</td>
</tr>
<tr>
  <td>2</td>
  <td>System timer</td>
</tr>
<tr>
  <td>3</td>
  <td>CPU cycle</td>
</tr>
</tbody>
</table>

<h3 id="flags"><code>Flags</code></h3>

<p>This member indicates the type of <strong>WNODE_*XXX*</strong> structure that contains the WNODE_HEADER structure:</p>

<h4 id="wnode_flag_all_data">WNODE_FLAG_ALL_DATA</h4>

<p>The rest of a <a rel="noopener" target="_blank" href="wnode_all_data">WNODE_ALL_DATA</a> structure follows the <strong>WNODE_HEADER</strong> structure in the buffer.</p>

<p>WMI sets this flag in the <strong>WNODE_HEADER</strong> structure that it passes with an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-query-all-data">IRP_MN_QUERY_ALL_DATA</a> request.</p>

<p>A driver sets this flag in the <strong>WNODE_HEADER</strong> structure of an event that consists of all instances of a data block. If the data block size is identical for all instances, a driver also sets WNODE_FLAG_FIXED_INSTANCE_SIZE.</p>

<h4 id="wnode_flag_event_item">WNODE_FLAG_EVENT_ITEM</h4>

<p>A driver sets this flag to indicate that the <strong>WNODE_*XXX*</strong> structure was generated as an event. This flag is valid only if WNODE_FLAG_ALL_DATA, WNODE_FLAG_SINGLE_INSTANCE, or WNODE_FLAG_SINGLE_ITEM is also set.</p>

<h4 id="wnode_flag_event_reference">WNODE_FLAG_EVENT_REFERENCE</h4>

<p>The rest of a <a rel="noopener" target="_blank" href="wnode_event_reference">WNODE_EVENT_REFERENCE</a> structure follows the <strong>WNODE_HEADER</strong> structure in the buffer.</p>

<p>A driver sets this flag when it generates an event that is larger than the maximum size specified in the registry for an event. WMI uses the information in the <strong><a href="wnode_event_reference" title="typedef struct tagWNODE_EVENT_REFERENCE {&#10;  struct _WNODE_HEADER WnodeHeader;&#10;  GUID                 TargetGuid;&#10;  ULONG                TargetDataBlockSize;&#10;  union {&#10;    ULONG TargetInstanceIndex;&#10;    WCHAR TargetInstanceName[];&#10;  } DUMMYUNIONNAME;&#10;} WNODE_EVENT_REFERENCE, *PWNODE_EVENT_REFERENCE;">WNODE_EVENT_REFERENCE</a></strong> structure to request the event data and schedules such a request according to the value of WNODE_FLAG_SEVERITY_MASK.</p>

<h4 id="wnode_flag_method_item">WNODE_FLAG_METHOD_ITEM</h4>

<p>The rest of a <a rel="noopener" target="_blank" href="wnode_method_item">WNODE_METHOD_ITEM</a> structure follows the <strong>WNODE_HEADER</strong> structure in the buffer.</p>

<p>WMI sets this flag in the <strong>WNODE_HEADER</strong> structure that it passes with an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-execute-method">IRP_MN_EXECUTE_METHOD</a> request.</p>

<h4 id="wnode_flag_single_instance">WNODE_FLAG_SINGLE_INSTANCE</h4>

<p>The rest of a <a rel="noopener" target="_blank" href="wnode_single_instance">WNODE_SINGLE_INSTANCE</a> structure follows the <strong>WNODE_HEADER</strong> structure in the buffer.</p>

<p>WMI sets this flag in the <strong>WNODE_HEADER</strong> structure that it passes with a request to query or change an instance.</p>

<p>A driver sets this flag in the <strong>WNODE_HEADER</strong> structure of an event that consists of a single instance of a data block.</p>

<h4 id="wnode_flag_single_item">WNODE_FLAG_SINGLE_ITEM</h4>

<p>The rest of a <a rel="noopener" target="_blank" href="wnode_single_instance">WNODE_SINGLE_INSTANCE</a> structure follows the <strong>WNODE_HEADER</strong> structure in the buffer.</p>

<p>WMI sets this flag in the <strong>WNODE_HEADER</strong> structure that it passes with a request to change an item.</p>

<p>A driver sets this flag in the <strong>WNODE_HEADER</strong> structure of an event that consists of a single data item.</p>

<h4 id="wnode_flag_too_small">WNODE_FLAG_TOO_SMALL</h4>

<p>The rest of a <a rel="noopener" target="_blank" href="wnode_too_small">WNODE_TOO_SMALL</a> structure follows the <strong>WNODE_HEADER</strong> structure in the buffer.</p>

<p>A driver sets this flag when it passes a <strong><a href="wnode_too_small" title="typedef struct tagWNODE_TOO_SMALL {&#10;  struct _WNODE_HEADER WnodeHeader;&#10;  ULONG                SizeNeeded;&#10;} WNODE_TOO_SMALL, *PWNODE_TOO_SMALL;">WNODE_TOO_SMALL</a></strong> structure, indicating that the buffer is too small for all of the <strong>WNODE_*XXX*</strong> data to be returned.</p>

<p>In addition, <strong>Flags</strong> might be set with one or more of the following flags that provide additional information about the <strong>WNODE_*XXX*</strong>:</p>

<h4 id="wnode_flag_fixed_instance_size">WNODE_FLAG_FIXED_INSTANCE_SIZE</h4>

<p>All instances of a data block are the same size. This flag is valid only if WNODE_FLAG_ALL_DATA is also set.</p>

<h4 id="wnode_flag_instances_same">WNODE_FLAG_INSTANCES_SAME</h4>

<p>The number of instances and the dynamic instance names in a <strong><a href="wnode_all_data" title="typedef struct tagWNODE_ALL_DATA {&#10;  struct _WNODE_HEADER WnodeHeader;&#10;  ULONG                DataBlockOffset;&#10;  ULONG                InstanceCount;&#10;  ULONG                OffsetInstanceNameOffsets;&#10;  union {&#10;    ULONG                       FixedInstanceSize;&#10;    OFFSETINSTANCEDATAANDLENGTH OffsetInstanceDataAndLength[];&#10;  } DUMMYUNIONNAME;&#10;} WNODE_ALL_DATA, *PWNODE_ALL_DATA;">WNODE_ALL_DATA</a></strong> structure to be returned are identical to those returned from the previous <strong><a href="wnode_all_data" title="typedef struct tagWNODE_ALL_DATA {&#10;  struct _WNODE_HEADER WnodeHeader;&#10;  ULONG                DataBlockOffset;&#10;  ULONG                InstanceCount;&#10;  ULONG                OffsetInstanceNameOffsets;&#10;  union {&#10;    ULONG                       FixedInstanceSize;&#10;    OFFSETINSTANCEDATAANDLENGTH OffsetInstanceDataAndLength[];&#10;  } DUMMYUNIONNAME;&#10;} WNODE_ALL_DATA, *PWNODE_ALL_DATA;">WNODE_ALL_DATA</a></strong> query. This flag is valid only if WNODE_FLAG_ALL_DATA is also set. This flag is ignored for data blocks registered with static instance names.</p>

<p>For optimized performance, a driver should set this flag if it can track changes to the number or names of its data blocks. WMI can then skip the processing required to detect and update dynamic instance names.</p>

<h4 id="wnode_flag_static_instance_names">WNODE_FLAG_STATIC_INSTANCE_NAMES</h4>

<p>The <strong>WNODE_*XXX*</strong> data to be returned does not include instance names.</p>

<p>WMI sets this flag before requesting <strong>WNODE_*XXX*</strong> data for data blocks registered with static instance names. After receiving the returned <strong>WNODE_*XXX*</strong> from the driver, WMI fills in the static instance names specified at registration before passing the returned <strong>WNODE_*XXX*</strong> to a data consumer.</p>

<h4 id="wnode_flag_pdo_instance_names">WNODE_FLAG_PDO_INSTANCE_NAMES</h4>

<p>Static instance names are based on the device instance ID of the PDO for the device. A driver requests such names by setting WMIREG_FLAG_INSTANCE_PDO in the <a rel="noopener" target="_blank" href="wmiregguidw">WMIREGGUID</a> it uses to register the block.</p>

<p>WMI sets this flag before requesting <strong>WNODE_*XXX*</strong> data for data blocks registered with PDO-based instance names.</p>

<h4 id="wnode_flag_severity_mask">WNODE_FLAG_SEVERITY_MASK</h4>

<p>The driver-determined severity level of the event associated with a returned <a rel="noopener" target="_blank" href="wnode_event_reference">WNODE_EVENT_REFERENCE</a>, with 0x00 indicating the least severe and 0xff indicating the most severe level.</p>

<p>WMI uses the value of this flag to prioritize its requests for the event data.</p>

<h4 id="wnode_flag_use_timestamp">WNODE_FLAG_USE_TIMESTAMP</h4>

<p>The system logger should not modify the value of <strong>TimeStamp</strong> set by the driver.</p>

<p>An NT driver might also set <strong>Flags</strong> to one or more of the following values for event blocks to be written to a system log file:</p>

<h4 id="wnode_flag_log_wnode">WNODE_FLAG_LOG_WNODE</h4>

<p>An event block is to be sent to the system logger. The event header is a standard <strong>WNODE_HEADER</strong> structure. If the driver clears WNODE_FLAG_TRACED_GUID, the block will also be sent to WMI for delivery to any data consumers that have enabled the event. The driver must allocate the <strong>WNODE_*XXX*</strong> from pool memory. WMI frees the memory after delivering the event to data consumers.</p>

<h4 id="wnode_flag_traced_guid">WNODE_FLAG_TRACED_GUID</h4>

<p>An event block is to be sent only to the system logger. It does not get sent to WMI data consumers. The event header is an <strong>EVENT_TRACE_HEADER</strong> structure, declared in <em>Evntrace.h</em>, instead of a <strong>WNODE_HEADER</strong>. The driver must allocate memory for the <strong>WNODE_*XXX*</strong> and free it after <a rel="noopener" target="_blank" href="iowmiwriteevent">IoWMIWriteEvent</a> returns. The driver can allocate such memory either from the stack or, to minimize the overhead of allocating and freeing the memory, from the driver's thread local storage if the driver creates and maintains its own thread pool.</p>

<h4 id="wnode_flag_use_guid_ptr">WNODE_FLAG_USE_GUID_PTR</h4>

<p>The <strong>Guid</strong> member points to a GUID in memory, rather than containing the GUID itself. The system logger dereferences the pointer before passing the data to the consumer. This flag is valid only if WNODE_FLAG_LOG_WNODE or WNODE_FLAG_TRACED_GUID are also set.</p>

<h4 id="wnode_flag_use_mof_ptr">WNODE_FLAG_USE_MOF_PTR</h4>

<p>Data that follows the fixed members of a <strong>WNODE_*XXX*</strong> structure consists of an array of MOF_FIELD structures, defined in Evntrace.h, that contain pointers to data and sizes rather than the data itself. The array can contain up to MAX_MOF_FIELD elements. The system logger dereferences the pointers before passing the data to the consumer This flag is valid only for blocks registered with WMIREG_FLAG_TRACED_GUID.</p>

<h2 id="remarks">Remarks</h2>

<p>In an <strong>IRP_MN_CHANGE_*XXX*</strong> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-execute-method">IRP_MN_EXECUTE_METHOD</a> request, <strong>BufferSize</strong> in the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the maximum size in bytes of the output buffer, while <strong>BufferSize</strong> in the input <strong>WNODE_HEADER</strong> for such a request indicates the size, in bytes, of the input data in the buffer.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="iowmideviceobjecttoproviderid">IoWMIDeviceObjectToProviderId</a></p>

<p><a rel="noopener" target="_blank" href="iowmiwriteevent">IoWMIWriteEvent</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime">KeQuerySystemTime</a></p>

<p><a rel="noopener" target="_blank" href="wnode_all_data">WNODE_ALL_DATA</a></p>

<p><a rel="noopener" target="_blank" href="wnode_event_item">WNODE_EVENT_ITEM</a></p>

<p><a rel="noopener" target="_blank" href="wnode_event_reference">WNODE_EVENT_REFERENCE</a></p>

<p><a rel="noopener" target="_blank" href="wnode_method_item">WNODE_METHOD_ITEM</a></p>

<p><a rel="noopener" target="_blank" href="wnode_single_instance">WNODE_SINGLE_INSTANCE</a></p>

<p><a rel="noopener" target="_blank" href="wnode_single_item">WNODE_SINGLE_ITEM</a></p>

<p><a rel="noopener" target="_blank" href="wnode_too_small">WNODE_TOO_SMALL</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wmistr/ns-wmistr-_wnode_header">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wmistr/ns-wmistr-_wnode_header.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
