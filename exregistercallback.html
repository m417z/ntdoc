<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ExRegisterCallback - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ExRegisterCallback - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ExRegisterCallback - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PVOID ExRegisterCallback(
  [in, out]      PCALLBACK_OBJECT   CallbackObject,
  [in]           PCALLBACK_FUNCTION CallbackFunction,
  [in, optional] PVOID              CallbackContext
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exregistercallback">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/exregistercallback.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-exregistercallback)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>ExRegisterCallback</strong> routine registers a given callback routine with a given callback object.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="callbackobject-in-out"><code>CallbackObject</code> [in, out]</h3>

<p>A pointer to a callback object obtained from the <a href="excreatecallback" title="NTSTATUS ExCreateCallback(&#10;  [out] PCALLBACK_OBJECT   *CallbackObject,&#10;  [in]  POBJECT_ATTRIBUTES ObjectAttributes,&#10;  [in]  BOOLEAN            Create,&#10;  [in]  BOOLEAN            AllowMultipleCallbacks&#10;);">ExCreateCallback</a> routine.</p>

<h3 id="callbackfunction-in"><code>CallbackFunction</code> [in]</h3>

<p>A pointer to a driver-implemented callback routine, which must be nonpageable. The callback routine must conform to the following prototype:</p>

<div class="codehilite">
<pre><span></span><code><span class="n">VOID</span>
<span class="p">(</span><span class="o">*</span><span class="n">PCALLBACK_FUNCTION</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PVOID</span><span class="w"> </span><span class="n">CallbackContext</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PVOID</span><span class="w"> </span><span class="n">Argument1</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PVOID</span><span class="w"> </span><span class="n">Argument2</span>
<span class="w">    </span><span class="p">);</span>
</code></pre>
</div>

<p>The callback routine parameters are as follows:</p>

<h4 id="callbackcontext">CallbackContext</h4>

<p>A pointer to a driver-supplied context area as specified in the <em>CallbackContext</em> parameter of <strong>ExRegisterCallback</strong>.</p>

<h4 id="argument1">Argument1</h4>

<p>A pointer to a parameter defined by the callback object.</p>

<h4 id="argument2">Argument2</h4>

<p>A pointer to a parameter defined by the callback object.</p>

<h3 id="callbackcontext-in-optional"><code>CallbackContext</code> [in, optional]</h3>

<p>A pointer to a caller-defined structure of data items to be passed as the context parameter of the callback routine each time it is called. Typically the context is part of the caller's device object extension.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ExRegisterCallback</strong> returns a pointer to a callback registration handle that should be treated as opaque and reserved for system use. This pointer is <strong>NULL</strong> if <strong>ExRegisterCallback</strong> completes with an error.</p>

<h2 id="remarks">Remarks</h2>

<p>A driver calls <strong>ExRegisterCallback</strong> to register a callback routine with a specified callback object.</p>

<p>If the object allows only one registered callback routine, and such a routine is already registered, <strong>ExRegisterCallback</strong> returns <strong>NULL</strong>.</p>

<p>Callers of <strong>ExRegisterCallback</strong> must save the returned pointer for use later in a call to <a href="exunregistercallback" title="VOID ExUnregisterCallback(&#10;  [in, out] PVOID CallbackRegistration&#10;);">ExUnregisterCallback</a>. The pointer is required when removing the callback routine from the list of registered callback routines for the callback object.</p>

<p>The meanings of <em>Argument1</em> and <em>Argument2</em> of the registered callback routine depend on the callback object and are defined by the component that created it. The following are the parameters for the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-a-system-defined-callback-object">system-defined callback objects</a>:</p>

<h3 id="callbacksetsystemtime">\Callback\SetSystemTime</h3>

<h4 id="argument1-setsystemtime"><em>Argument1</em> (SetSystemTime)</h4>

<ul>
<li>Not used.</li>
</ul>

<h4 id="argument2-setsystemtime"><em>Argument2</em> (SetSystemTime)</h4>

<ul>
<li>Not used.</li>
</ul>

<h3 id="callbackpowerstate">\Callback\PowerState**</h3>

<h4 id="argument1-powerstate"><em>Argument1</em> (PowerState)</h4>

<ul>
<li><p>A PO_CB_XXX constant value that is cast to type PVOID.</p></li>
<li><p>PO_CB_AC_STATUS — Indicates that the system has changed from A/C to battery power, or vice versa.</p></li>
<li><p>PO_CB_LID_SWITCH_STATE — Indicates that the lid switch has changed states.</p></li>
<li><p>PO_CB_PROCESSOR_POWER_POLICY — Indicates that the system processor power policy has changed.</p></li>
<li><p>PO_CB_SYSTEM_POWER_POLICY — Indicates that the system power policy has changed.</p></li>
<li><p>PO_CB_SYSTEM_STATE_LOCK — Indicates that a system power state change is imminent. Drivers in the paging path can register for this callback to receive early warning of such a change, allowing them the opportunity to lock their code in memory before the power state changes.</p></li>
</ul>

<h4 id="argument2-powerstate"><em>Argument2</em> (PowerState)</h4>

<p>A value of <strong>TRUE</strong> or <strong>FALSE</strong> that is cast to type PVOID.</p>

<ul>
<li><p>If <em>Argument1</em> is PO_CB_AC_STATUS, <em>Argument2</em> is <strong>TRUE</strong> if the computer is currently using an A/C power supply, and is <strong>FALSE</strong> if the computer is running on battery power.</p></li>
<li><p>If <em>Argument1</em> is PO_CB_LID_SWITCH_STATE, <em>Argument2</em> is <strong>TRUE</strong> if the lid is currently open, and is <strong>FALSE</strong> if the lid is closed.</p></li>
<li><p>If <em>Argument1</em> is PO_CB_PROCESSOR_POWER_POLICY, <em>Argument2</em> is not used.</p></li>
<li><p>If <em>Argument1</em> is PO_CB_SYSTEM_POWER_POLICY, <em>Argument2</em> is not used.</p></li>
<li><p>If <em>Argument1</em> is PO_CB_SYSTEM_STATE_LOCK, <em>Argument2</em> is <strong>FALSE</strong> if the computer is about to exit system power state S0, and is <strong>TRUE</strong> if the computer has just reentered S0.</p></li>
</ul>

<h3 id="callbackprocessoradd">\Callback\ProcessorAdd</h3>

<h4 id="argument1-processoradd"><em>Argument1</em> (ProcessorAdd)</h4>

<ul>
<li>A pointer to a <strong><a href="ke_processor_change_notify_context" title="typedef struct _KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT {&#10;  KE_PROCESSOR_CHANGE_NOTIFY_STATE State;&#10;  ULONG                            NtNumber;&#10;  NTSTATUS                         Status;&#10;  PROCESSOR_NUMBER                 ProcNumber;&#10;} KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT, *PKE_PROCESSOR_CHANGE_NOTIFY_CONTEXT;">KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT</a></strong> structure that describes the processor change notification event. This pointer is cast to type PVOID. The callback routine must not modify the contents of this structure.</li>
</ul>

<h4 id="argument2-processoradd"><em>Argument2</em> (ProcessorAdd)</h4>

<p>A pointer to a variable that contains an <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value. This pointer is cast to type PVOID. Under certain conditions, a callback routine can write an error status value to this variable to indicate why the new processor should not be added. A device driver must not change the value of this variable unless all three of the following conditions are true:</p>

<ul>
<li><p>An error occurs during the processing of the callback routine that should prevent the new processor from being added.</p></li>
<li><p>The value of the <strong>State</strong> member of the <strong><a href="ke_processor_change_notify_context" title="typedef struct _KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT {&#10;  KE_PROCESSOR_CHANGE_NOTIFY_STATE State;&#10;  ULONG                            NtNumber;&#10;  NTSTATUS                         Status;&#10;  PROCESSOR_NUMBER                 ProcNumber;&#10;} KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT, *PKE_PROCESSOR_CHANGE_NOTIFY_CONTEXT;">KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT</a></strong> structure that <em>Argument1</em> points to is <strong>KeProcessorAddStartNotify</strong>.</p></li>
<li><p>The NSTATUS variable that <em>Argument2</em> points to contains the value <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>. That is, the callback routine must not overwrite an error status value that was previously written by another callback notification client.</p></li>
</ul>

<p>Starting with Windows Vista, the <strong>\Callback\ProcessorAdd</strong> callback object is available to dynamically track changes in the processor population. The <a href="keregisterprocessorchangecallback" title="PVOID KeRegisterProcessorChangeCallback(&#10;  [in]           PPROCESSOR_CALLBACK_FUNCTION CallbackFunction,&#10;  [in, optional] PVOID                        CallbackContext,&#10;  [in]           ULONG                        Flags&#10;);">KeRegisterProcessorChangeCallback</a> routine provides similar information, but additionally supports a KE_PROCESSOR_CHANGE_ADD_EXISTING flag that a driver can use to enumerate the processors in the initial multiprocessor system configuration. For drivers that run in Windows Server 2008 and later versions of Windows, use <strong><a href="keregisterprocessorchangecallback" title="PVOID KeRegisterProcessorChangeCallback(&#10;  [in]           PPROCESSOR_CALLBACK_FUNCTION CallbackFunction,&#10;  [in, optional] PVOID                        CallbackContext,&#10;  [in]           ULONG                        Flags&#10;);">KeRegisterProcessorChangeCallback</a></strong> instead of the <strong>\Callback\ProcessorAdd</strong> callback object, if possible.</p>

<p>For more information about callback objects, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/callback-objects">Callback Objects</a>.</p>

<p>The operating system calls registered callback routines at the same IRQL at which the driver that created the callback called the <a href="exnotifycallback" title="VOID ExNotifyCallback(&#10;  [in]           PVOID CallbackObject,&#10;  [in, optional] PVOID Argument1,&#10;  [in, optional] PVOID Argument2&#10;);">ExNotifyCallback</a> routine.</p>

<h2 id="see-also">See also</h2>

<p><a href="excreatecallback" title="NTSTATUS ExCreateCallback(&#10;  [out] PCALLBACK_OBJECT   *CallbackObject,&#10;  [in]  POBJECT_ATTRIBUTES ObjectAttributes,&#10;  [in]  BOOLEAN            Create,&#10;  [in]  BOOLEAN            AllowMultipleCallbacks&#10;);">ExCreateCallback</a></p>

<p><a href="exnotifycallback" title="VOID ExNotifyCallback(&#10;  [in]           PVOID CallbackObject,&#10;  [in, optional] PVOID Argument1,&#10;  [in, optional] PVOID Argument2&#10;);">ExNotifyCallback</a></p>

<p><a href="exunregistercallback" title="VOID ExUnregisterCallback(&#10;  [in, out] PVOID CallbackRegistration&#10;);">ExUnregisterCallback</a></p>

<p><strong><a href="ke_processor_change_notify_context" title="typedef struct _KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT {&#10;  KE_PROCESSOR_CHANGE_NOTIFY_STATE State;&#10;  ULONG                            NtNumber;&#10;  NTSTATUS                         Status;&#10;  PROCESSOR_NUMBER                 ProcNumber;&#10;} KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT, *PKE_PROCESSOR_CHANGE_NOTIFY_CONTEXT;">KE_PROCESSOR_CHANGE_NOTIFY_CONTEXT</a></strong></p>

<p><a href="keregisterprocessorchangecallback" title="PVOID KeRegisterProcessorChangeCallback(&#10;  [in]           PPROCESSOR_CALLBACK_FUNCTION CallbackFunction,&#10;  [in, optional] PVOID                        CallbackContext,&#10;  [in]           ULONG                        Flags&#10;);">KeRegisterProcessorChangeCallback</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exregistercallback">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-exregistercallback.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
