<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KsAllocateDefaultClockEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KsAllocateDefaultClockEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KsAllocateDefaultClockEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">KSDDKAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> KsAllocateDefaultClockEx(
  [out]          PKSDEFAULTCLOCK     *DefaultClock,
  [in, optional] PVOID               Context,
  [in, optional] <a href="pfnkssettimer" title="PFNKSSETTIMER Pfnkssettimer;&#10;&#10;BOOLEAN Pfnkssettimer(&#10;  [in] PVOID Context,&#10;  [in] PKTIMER Timer,&#10;  [in] LARGE_INTEGER DueTime,&#10;  [in] PKDPC Dpc&#10;)&#10;{...}">PFNKSSETTIMER</a>       SetTimer,
  [in, optional] <a href="pfnkscanceltimer" title="PFNKSCANCELTIMER Pfnkscanceltimer;&#10;&#10;BOOLEAN Pfnkscanceltimer(&#10;  [in] PVOID Context,&#10;  [in] PKTIMER Timer&#10;)&#10;{...}">PFNKSCANCELTIMER</a>    CancelTimer,
  [in, optional] <a href="pfnkscorrelatedtime" title="PFNKSCORRELATEDTIME Pfnkscorrelatedtime;&#10;&#10;LONGLONG Pfnkscorrelatedtime(&#10;  [in]  PVOID Context,&#10;  [out] PLONGLONG SystemTime&#10;)&#10;{...}">PFNKSCORRELATEDTIME</a> CorrelatedTime,
  [in, optional] const <a href="ksresolution" title="typedef struct {&#10;  LONGLONG Granularity;&#10;  LONGLONG Error;&#10;} KSRESOLUTION, *PKSRESOLUTION;">KSRESOLUTION</a>  *Resolution,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>               Flags
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-ksallocatedefaultclockex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ksallocatedefaultclockex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ks-ksallocatedefaultclockex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ksallocatedefaultclockex-function">KsAllocateDefaultClockEx function</h1>

<h2 id="description">Description</h2>

<p>The <strong>KsAllocateDefaultClockEx</strong> function allocates and initializes the default clock structure.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="defaultclock-out"><code>DefaultClock</code> [out]</h3>

<p>Specifies the caller-allocated shared default clock structure. The current time is set to zero and the state is set to KSSTATE_STOP. Upon successful completion of this routine, the structure indicated by this pointer will contain a reference to the default clock. The data returned should be treated as opaque and reserved for system use.</p>

<h3 id="context-in-optional"><code>Context</code> [in, optional]</h3>

<p>Optionally contains the context of the alternate time facilities. This must be set if a timer or correlated time function is used.</p>

<h3 id="settimer-in-optional"><code>SetTimer</code> [in, optional]</h3>

<p>Optionally contains a pointer to a driver-defined <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkssettimer">KStrSetTimer</a> function to use to generate DPC timer callbacks based on a Presentation Time. If this is set, the function will be used to set timers based on deltas to the current Presentation Time in order to generate event notifications. If you supply a <em>KStrSetTimer</em> function to set timers, you must also supply a corresponding <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkscanceltimer">KStrCancelTimer</a> function. Pass <strong>NULL</strong> in this parameter if the default <a href="kesettimerex" title="BOOLEAN KeSetTimerEx(&#10;  [in, out]      PKTIMER       Timer,&#10;  [in]           LARGE_INTEGER DueTime,&#10;  [in]           LONG          Period,&#10;  [in, optional] PKDPC         Dpc&#10;);">KeSetTimerEx</a> function is to be used to approximate the next notification time. This parameter would normally be set only if a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkscorrelatedtime">KStrCorrelatedTime</a> function was also being used. The <em>KStrSetTimer</em> function must have the same characteristics as <strong><a href="kesettimerex" title="BOOLEAN KeSetTimerEx(&#10;  [in, out]      PKTIMER       Timer,&#10;  [in]           LARGE_INTEGER DueTime,&#10;  [in]           LONG          Period,&#10;  [in, optional] PKDPC         Dpc&#10;);">KeSetTimerEx</a></strong>.</p>

<h3 id="canceltimer-in-optional"><code>CancelTimer</code> [in, optional]</h3>

<p>Optionally contains a pointer to a driver-defined <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkscanceltimer">KStrCancelTimer</a> function to use to cancel outstanding timer callbacks. If you supply a <em>KStrCancelTimer</em> function to cancel timers, you must also supply a corresponding <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkssettimer">KStrSetTimer</a> function. Pass <strong>NULL</strong> in this parameter if the default <a href="kecanceltimer" title="BOOLEAN KeCancelTimer(&#10;  [in, out] PKTIMER unnamedParam1&#10;);">KeCancelTimer</a> function is to be used to cancel timers. The <em>KStrCancelTimer</em> function must have the same characteristics as <strong><a href="kecanceltimer" title="BOOLEAN KeCancelTimer(&#10;  [in, out] PKTIMER unnamedParam1&#10;);">KeCancelTimer</a></strong>.</p>

<h3 id="correlatedtime-in-optional"><code>CorrelatedTime</code> [in, optional]</h3>

<p>Optionally contains a pointer to a driver-defined <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkscorrelatedtime">KStrCorrelatedTime</a> function to retrieve both the Presentation and Physical Time in a correlated manner. This allows the clock owner to completely determine the current time. Pass <strong>NULL</strong> if the default <a href="kequeryperformancecounter" title="NTHALAPI LARGE_INTEGER KeQueryPerformanceCounter(&#10;  [out, optional] PLARGE_INTEGER PerformanceFrequency&#10;);">KeQueryPerformanceCounter</a> function is to be used to regulate time progression.</p>

<h3 id="resolution-in-optional"><code>Resolution</code> [in, optional]</h3>

<p>Optionally contains an alternate Granularity and/or Error factor for the clock. This can only be used only if an alternate timer or correlated time function are being provided. An alternate Granularity may be specified if an alternate correlated time is being used, else the structure element must be zero. An alternate Error may be specified if an alternate timer is being used, else the structure element must be zero.</p>

<h3 id="flags-in"><code>Flags</code> [in]</h3>

<p>Reserved, set to zero.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong>KsAllocateDefaultClockEx</strong> function returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if successful, or a memory error if unsuccessful.</p>

<h2 id="remarks">Remarks</h2>

<p>The internal DefaultClock.ReferenceCount element is initialized to one by the <a href="ksallocatedefaultclock" title="KSDDKAPI NTSTATUS KsAllocateDefaultClock(&#10;  [out] PKSDEFAULTCLOCK *DefaultClock&#10;);">KsAllocateDefaultClock</a> function. The element is incremented and decremented as each notification DPC is queued and completed. When the structure is to be freed, the element is used to determine if the owner of the clock should free the structure or if a pending DPC should free it asynchronously.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkscanceltimer">KStrCancelTimer</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkscorrelatedtime">KStrCorrelatedTime</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkssettimer">KStrSetTimer</a></p>

<p><a href="ksallocatedefaultclock" title="KSDDKAPI NTSTATUS KsAllocateDefaultClock(&#10;  [out] PKSDEFAULTCLOCK *DefaultClock&#10;);">KsAllocateDefaultClock</a></p>

<p><a href="ksfreedefaultclock" title="KSDDKAPI VOID KsFreeDefaultClock(&#10;  [in] PKSDEFAULTCLOCK DefaultClock&#10;);">KsFreeDefaultClock</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-ksallocatedefaultclockex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/nf-ks-ksallocatedefaultclockex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
