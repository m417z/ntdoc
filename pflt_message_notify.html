<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFLT_MESSAGE_NOTIFY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFLT_MESSAGE_NOTIFY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFLT_MESSAGE_NOTIFY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFLT_MESSAGE_NOTIFY PfltMessageNotify;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PfltMessageNotify(
  PVOID PortCookie,
  PVOID InputBuffer,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> InputBufferLength,
  PVOID OutputBuffer,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> OutputBufferLength,
  PULONG ReturnOutputBufferLength
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_message_notify">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pflt_message_notify.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-fltkernel-pflt_message_notify)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p><em>FltMgr</em> calls a minifilter's <strong>MessageNotifyCallback</strong> callback function whenever a user-mode application calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtersendmessage"><strong>FilterSendMessage</strong></a> to send a message to the minifilter through the client port.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="portcookie"><code>PortCookie</code></h3>

<p>[in] Pointer to minifilter-defined information that uniquely identifies this client port. When the client port was created, the minifilter returned this context pointer in the <strong>ConnectionPortCookie</strong> parameter of its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_connect_notify"><strong>ConnectNotifyCallback</strong></a> routine.</p>

<h3 id="inputbuffer"><code>InputBuffer</code></h3>

<p>[in] Pointer to a caller-allocated buffer containing the message to be sent to the minifilter.</p>

<p><strong>InputBuffer</strong> is a pointer to a raw, unlocked user-mode buffer. This pointer is valid only in the context of the user-mode process and must only be accessed from within a <strong>try/except</strong> block.</p>

<p><em>FltMgr</em> calls <strong><a href="probeforread" title="VOID ProbeForRead(&#10;  [in] const volatile VOID *Address,&#10;  [in] SIZE_T              Length,&#10;  [in] ULONG               Alignment&#10;);">ProbeForRead</a></strong> to validate this pointer, but it doesn't ensure that the buffer is properly aligned. If the buffer contains structures that have alignment requirements, the minifilter is responsible for performing any necessary alignment checks. To do this, the minifilter can use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff549486(v=vs.85)"><strong>IS_ALIGNED</strong></a> macro as shown in the <a rel="noopener" target="_blank" href="https://github.com/microsoft/windows-driver-samples/tree/main/filesys/miniFilter/minispy">MiniSpy</a> sample minifilter.</p>

<p>This parameter is optional and can be NULL.</p>

<h3 id="inputbufferlength"><code>InputBufferLength</code></h3>

<p>[in] Size, in bytes, of the buffer that <strong>InputBuffer</strong> points to. This parameter is ignored if <strong>InputBuffer</strong> is NULL.</p>

<h3 id="outputbuffer"><code>OutputBuffer</code></h3>

<p>[out] Pointer to a caller-allocated buffer that receives the reply, if any, from the minifilter.</p>

<p><strong>OutputBuffer</strong> is a pointer to a raw, unlocked user-mode buffer. This pointer is valid only in the context of the user-mode process and must only be accessed from within a <strong>try/except</strong> block.</p>

<p><em>FltMgr</em> calls <strong><a href="probeforwrite" title="VOID ProbeForWrite(&#10;  [in, out] volatile VOID *Address,&#10;  [in]      SIZE_T        Length,&#10;  [in]      ULONG         Alignment&#10;);">ProbeForWrite</a></strong> to validate this pointer, but it doesn't ensure that the buffer is properly aligned. If the buffer contains structures that have alignment requirements, the minifilter is responsible for performing any necessary alignment checks. To do this, the minifilter can use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff549486(v=vs.85)"><strong>IS_ALIGNED</strong></a> macro as shown in the <a rel="noopener" target="_blank" href="https://github.com/microsoft/windows-driver-samples/tree/main/filesys/miniFilter/minispy">MiniSpy</a> sample minifilter.</p>

<p>This parameter is optional and can be NULL.</p>

<h3 id="outputbufferlength"><code>OutputBufferLength</code></h3>

<p>[in] Size, in bytes, of the buffer that <strong>OutputBuffer</strong> points to. This parameter is ignored if <strong>OutputBuffer</strong> is NULL.</p>

<h3 id="returnoutputbufferlength"><code>ReturnOutputBufferLength</code></h3>

<p>[out] Pointer to a caller-allocated variable that receives the number of bytes returned in the buffer that <strong>OutputBuffer</strong> points to.</p>

<h2 id="return-value">Return value</h2>

<p><strong>MessageNotifyCallback</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, it returns an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value such as:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td>There aren't enough resources to complete the operation.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER</td>
  <td>One or more of the input parameters are invalid.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Minifilters can optionally implement <strong>MessageNotifyCallback</strong>. If a minifilter doesn't implement this callback, any request made from user mode to send data to the port will receive an error.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/communication-between-user-mode-and-kernel-mode">Communication between user-mode and minifilters</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_connect_notify"><strong>ConnectNotifyCallback</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filtersendmessage"><strong>FilterSendMessage</strong></a></p>

<p><strong><a href="fltcreatecommunicationport" title="NTSTATUS FLTAPI FltCreateCommunicationPort(&#10;  PFLT_FILTER            Filter,&#10;  PFLT_PORT              *ServerPort,&#10;  POBJECT_ATTRIBUTES     ObjectAttributes,&#10;  PVOID                  ServerPortCookie,&#10;  PFLT_CONNECT_NOTIFY    ConnectNotifyCallback,&#10;  PFLT_DISCONNECT_NOTIFY DisconnectNotifyCallback,&#10;  PFLT_MESSAGE_NOTIFY    MessageNotifyCallback,&#10;  LONG                   MaxConnections&#10;);">FltCreateCommunicationPort</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_message_notify">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nc-fltkernel-pflt_message_notify.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
