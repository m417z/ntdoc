<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IoConnectInterrupt - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IoConnectInterrupt - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IoConnectInterrupt - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoConnectInterrupt(
  [out]          PKINTERRUPT       *InterruptObject,
  [in]           PKSERVICE_ROUTINE ServiceRoutine,
  [in, optional] PVOID             ServiceContext,
  [in, optional] PKSPIN_LOCK       SpinLock,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>             Vector,
  [in]           <a href="kirql" title="typedef UCHAR KIRQL, *PKIRQL;">KIRQL</a>             Irql,
  [in]           <a href="kirql" title="typedef UCHAR KIRQL, *PKIRQL;">KIRQL</a>             SynchronizeIrql,
  [in]           <a href="kinterrupt_mode" title="typedef enum _KINTERRUPT_MODE {&#10;  LevelSensitive,&#10;  Latched&#10;} KINTERRUPT_MODE;">KINTERRUPT_MODE</a>   InterruptMode,
  [in]           BOOLEAN           ShareVector,
  [in]           KAFFINITY         ProcessorEnableMask,
  [in]           BOOLEAN           FloatingSave
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-ioconnectinterrupt">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioconnectinterrupt.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-ioconnectinterrupt)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioconnectinterrupt-function">IoConnectInterrupt function</h1>

<h2 id="description">Description</h2>

<p>The <strong>IoConnectInterrupt</strong> routine registers a device driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-kservice_routine">InterruptService</a> routine (ISR), so that it will be called when a device interrupts on any of a specified set of processors.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="interruptobject-out"><code>InterruptObject</code> [out]</h3>

<p>Pointer to the address of driver-supplied storage for a pointer to a set of interrupt objects. This pointer must be passed in subsequent calls to <a rel="noopener" target="_blank" href="kesynchronizeexecution">KeSynchronizeExecution</a>.</p>

<h3 id="serviceroutine-in"><code>ServiceRoutine</code> [in]</h3>

<p>Pointer to the entry point for the driver-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-kservice_routine">InterruptService</a> routine.</p>

<h3 id="servicecontext-in-optional"><code>ServiceContext</code> [in, optional]</h3>

<p>Pointer to the driver-determined context that will be supplied to the <em>InterruptService</em> routine when it is called. The <em>ServiceContext</em> area must be in resident memory: in the device extension of a driver-created device object, in the controller extension of a driver-created controller object, or in nonpaged pool allocated by the device driver. See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/providing-isr-context-information">Providing ISR Context Information</a> for details.</p>

<h3 id="spinlock-in-optional"><code>SpinLock</code> [in, optional]</h3>

<p>Pointer to an initialized spin lock, for which the driver supplies the storage, that will be used to synchronize access to driver-determined data shared by other driver routines. This parameter is required if the ISR handles more than one vector or if the driver has more than one ISR. Otherwise, the driver need not allocate storage for an interrupt spin lock and the input pointer is <strong>NULL</strong>.</p>

<h3 id="vector-in"><code>Vector</code> [in]</h3>

<p>Specifies the interrupt vector passed in the interrupt resource at the <strong>u.Interrupt.Vector</strong> member of <a rel="noopener" target="_blank" href="cm_partial_resource_descriptor">CM_PARTIAL_RESOURCE_DESCRIPTOR</a>.</p>

<h3 id="irql-in"><code>Irql</code> [in]</h3>

<p>Specifies the DIRQL passed in the interrupt resource at the <strong>u.Interrupt.Level</strong> member of <strong><a href="cm_partial_resource_descriptor" title="typedef struct _CM_PARTIAL_RESOURCE_DESCRIPTOR {&#10;  UCHAR  Type;&#10;  UCHAR  ShareDisposition;&#10;  USHORT Flags;&#10;  union {&#10;    struct {&#10;      PHYSICAL_ADDRESS Start;&#10;      ULONG            Length;&#10;    } Generic;&#10;    struct {&#10;      PHYSICAL_ADDRESS Start;&#10;      ULONG            Length;&#10;    } Port;&#10;    struct {&#10;#if ...&#10;      USHORT    Level;&#10;      USHORT    Group;&#10;#else&#10;      ULONG     Level;&#10;#endif&#10;...">CM_PARTIAL_RESOURCE_DESCRIPTOR</a></strong>.</p>

<h3 id="synchronizeirql-in"><code>SynchronizeIrql</code> [in]</h3>

<p>Specifies the DIRQL at which the ISR will run. If the ISR handles more than one interrupt vector or the driver has more than one ISR, this value must be the highest of the <em>Irql</em> values passed at <strong>u.Interrupt.Level</strong> in each interrupt resource. Otherwise, the <em>Irql</em> and <em>SynchronizeIrql</em> values are identical.</p>

<h3 id="interruptmode-in"><code>InterruptMode</code> [in]</h3>

<p>Specifies whether the device interrupt is <strong>LevelSensitive</strong> or <strong>Latched</strong>.</p>

<h3 id="sharevector-in"><code>ShareVector</code> [in]</h3>

<p>Specifies whether the interrupt vector is sharable.</p>

<h3 id="processorenablemask-in"><code>ProcessorEnableMask</code> [in]</h3>

<p>Specifies a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/interrupt-affinity-and-priority#about-kaffinity"><strong>KAFFINITY</strong></a> value representing the set of processors on which device interrupts can occur in this platform. This value is passed in the interrupt resource at <strong>u.Interrupt.Affinity</strong>.</p>

<h3 id="floatingsave-in"><code>FloatingSave</code> [in]</h3>

<p>Specifies whether to save the floating-point stack when the driver's device interrupts. For x86-based and Itanium-based platforms, this value must be set to <strong>FALSE</strong>. For more information about saving floating-point and MMX state, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-floating-point-or-mmx-in-a-wdm-driver">Using Floating Point or MMX in a WDM Driver</a>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>IoConnectInterrupt</strong> can return one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>

<p><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></p>

<p><strong>STATUS_INVALID_PARAMETER</strong>: No processors were specified.</p>

<p><strong>STATUS_INSUFFICIENT_RESOURCES</strong>: There was not enough nonpaged pool.</p>

<h2 id="remarks">Remarks</h2>

<p>New drivers should use the <a rel="noopener" target="_blank" href="ioconnectinterruptex">IoConnectInterruptEx</a> routine, which is easier to use. Drivers for devices that support message-signaled interrupts (MSI) must use <strong><a href="ioconnectinterruptex" title="NTSTATUS IoConnectInterruptEx(&#10;  [in, out] PIO_CONNECT_INTERRUPT_PARAMETERS Parameters&#10;);">IoConnectInterruptEx</a></strong>.</p>

<p>A PnP driver should call <strong>IoConnectInterrupt</strong> as part of device start-up, before it completes the PnP <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-start-device">IRP_MN_START_DEVICE</a> request.</p>

<p>When a driver receives an <strong><a href="irp_mn_start_device" title="#define IRP_MN_START_DEVICE 0x00">IRP_MN_START_DEVICE</a></strong> request, the driver receives raw and translated hardware resources in the <strong>Parameters.StartDevice.AllocatedResources</strong> and <strong>Parameters.StartDevice.AllocatedResourcesTranslated</strong> members of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>'s <a rel="noopener" target="_blank" href="io_stack_location">IO_STACK_LOCATION</a> structure, respectively. To connect its interrupt, the driver uses the resources at <strong>AllocatedResourcesTranslated.List.PartialResourceList.PartialDescriptors[]</strong>. The driver must scan the array of partial descriptors for resources of type <strong>CmResourceTypeInterrupt</strong>.</p>

<p>If the driver supplies the storage for the <em>SpinLock</em>, it must call <a rel="noopener" target="_blank" href="keinitializespinlock">KeInitializeSpinLock</a> before passing its interrupt spin lock to <strong>IoConnectInterrupt</strong>.</p>

<p>On return from a successful call to <strong>IoConnectInterrupt</strong>, the caller's ISR can be called if interrupts are enabled on the driver's device or if <em>ShareVector</em> was set to <strong>TRUE</strong>. Drivers must not enable interrupts until after <strong>IoConnectInterrupt</strong> returns.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="cm_partial_resource_descriptor">CM_PARTIAL_RESOURCE_DESCRIPTOR</a></p>

<p><a rel="noopener" target="_blank" href="io_stack_location">IO_STACK_LOCATION</a></p>

<p><a rel="noopener" target="_blank" href="iodisconnectinterrupt">IoDisconnectInterrupt</a></p>

<p><a rel="noopener" target="_blank" href="keinitializespinlock">KeInitializeSpinLock</a></p>

<p><a rel="noopener" target="_blank" href="kesynchronizeexecution">KeSynchronizeExecution</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-ioconnectinterrupt">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-ioconnectinterrupt.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
