<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FltNotifyFilterChangeDirectory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FltNotifyFilterChangeDirectory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FltNotifyFilterChangeDirectory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID FLTAPI FltNotifyFilterChangeDirectory(
  [in, out]      PNOTIFY_SYNC               NotifySync,
  [in, out]      <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">PLIST_ENTRY</a>                NotifyList,
  [in]           PVOID                      FsContext,
  [in]           <a href="string" title="typedef struct _STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PCHAR Buffer;&#10;} STRING, *PSTRING, ANSI_STRING, *PANSI_STRING, OEM_STRING, *POEM_STRING;">PSTRING</a>                    FullDirectoryName,
  [in]           BOOLEAN                    WatchTree,
  [in]           BOOLEAN                    IgnoreBuffer,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                      CompletionFilter,
  [in]           <a href="flt_callback_data" title="typedef struct _FLT_CALLBACK_DATA {&#10;  FLT_CALLBACK_DATA_FLAGS     Flags;&#10;  PETHREAD                    Thread;&#10;  PFLT_IO_PARAMETER_BLOCK     Iopb;&#10;  IO_STATUS_BLOCK             IoStatus;&#10;  struct _FLT_TAG_DATA_BUFFER *TagData;&#10;  union {&#10;    struct {&#10;      LIST_ENTRY QueueLinks;&#10;      PVOID      QueueContext[2];&#10;    };&#10;    PVOID FilterContext[4];&#10;  };&#10;  KPROCESSOR_MODE             RequestorMode;&#10;} FLT_CALLBACK_DATA, *PFLT_CALLBACK_DATA;">PFLT_CALLBACK_DATA</a>         NotifyCallbackData,
  [in, optional] PCHECK_FOR_TRAVERSE_ACCESS TraverseCallback,
  [in, optional] <a href="security_subject_context" title="typedef struct _SECURITY_SUBJECT_CONTEXT {&#10;  PACCESS_TOKEN                ClientToken;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  PACCESS_TOKEN                PrimaryToken;&#10;  PVOID                        ProcessAuditId;&#10;} SECURITY_SUBJECT_CONTEXT, *PSECURITY_SUBJECT_CONTEXT;">PSECURITY_SUBJECT_CONTEXT</a>  SubjectContext,
  [in, optional] PFILTER_REPORT_CHANGE      FilterCallback
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltnotifyfilterchangedirectory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fltnotifyfilterchangedirectory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-fltkernel-fltnotifyfilterchangedirectory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>FltNotifyFilterChangeDirectory function</h1>
<h2>Description</h2>
<p>The <strong>FltNotifyFilterChangeDirectory</strong> routine creates a notify structure for an IRP_MN_NOTIFY_CHANGE_DIRECTORY operation and adds it to the specified notify list.</p>
<h2>Parameters</h2>
<h3><code>NotifySync</code> [in, out]</h3>
<p>Pointer to an opaque synchronization object for the change directory notify list that the <em>NotifyList</em> parameter points to.</p>
<h3><code>NotifyList</code> [in, out]</h3>
<p>Pointer to the head of the change directory notify list for the current volume. Each element in the list is an opaque notify structure.</p>
<h3><code>FsContext</code> [in]</h3>
<p>Pointer to a unique value assigned by the caller to identify the notify structure to be created. If a callback routine is supplied in the <em>TraverseCallback</em> parameter, <em>FsContext</em> is passed as the <em>NotifyContext</em> parameter to that routine.</p>
<h3><code>FullDirectoryName</code> [in]</h3>
<p>Pointer to an ANSI or Unicode string that contains the full name for the directory associated with this notify structure.</p>
<h3><code>WatchTree</code> [in]</h3>
<p>Set to <strong>TRUE</strong> if all subdirectories of the directory that is specified by the <em>FullDirectoryName</em> parameter should also be watched. Set to <strong>FALSE</strong> if only the directory itself is to be watched.</p>
<h3><code>IgnoreBuffer</code> [in]</h3>
<p>Set to <strong>TRUE</strong> to ignore any user buffers and force the directory to be reenumerated. This action speeds the operation.</p>
<h3><code>CompletionFilter</code> [in]</h3>
<p>Bitmask of flags that specify the types of changes to files or directories that should cause the callback data structures in the notify list to be completed. The possible flag values are described in the following table.</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="file_notify_change_file_name" title="#define FILE_NOTIFY_CHANGE_FILE_NAME 0x00000001 // winnt">FILE_NOTIFY_CHANGE_FILE_NAME</a></td>
<td>A file has been added, deleted, or renamed in this directory.</td>
</tr>
<tr>
<td><a href="file_notify_change_dir_name" title="#define FILE_NOTIFY_CHANGE_DIR_NAME 0x00000002 // winnt">FILE_NOTIFY_CHANGE_DIR_NAME</a></td>
<td>A subdirectory has been created, removed, or renamed.</td>
</tr>
<tr>
<td><a href="file_notify_change_name" title="#define FILE_NOTIFY_CHANGE_NAME 0x00000003">FILE_NOTIFY_CHANGE_NAME</a></td>
<td>This directory's name has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_attributes" title="#define FILE_NOTIFY_CHANGE_ATTRIBUTES 0x00000004 // winnt">FILE_NOTIFY_CHANGE_ATTRIBUTES</a></td>
<td>The value of an attribute of this file, such as last access time, has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_size" title="#define FILE_NOTIFY_CHANGE_SIZE 0x00000008 // winnt">FILE_NOTIFY_CHANGE_SIZE</a></td>
<td>This file's size has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_last_write" title="#define FILE_NOTIFY_CHANGE_LAST_WRITE 0x00000010 // winnt">FILE_NOTIFY_CHANGE_LAST_WRITE</a></td>
<td>This file's last modification time has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_last_access" title="#define FILE_NOTIFY_CHANGE_LAST_ACCESS 0x00000020 // winnt">FILE_NOTIFY_CHANGE_LAST_ACCESS</a></td>
<td>This file's last access time has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_creation" title="#define FILE_NOTIFY_CHANGE_CREATION 0x00000040 // winnt">FILE_NOTIFY_CHANGE_CREATION</a></td>
<td>This file's creation time has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_ea" title="#define FILE_NOTIFY_CHANGE_EA 0x00000080">FILE_NOTIFY_CHANGE_EA</a></td>
<td>This file's extended attributes have been modified.</td>
</tr>
<tr>
<td><a href="file_notify_change_security" title="#define FILE_NOTIFY_CHANGE_SECURITY 0x00000100 // winnt">FILE_NOTIFY_CHANGE_SECURITY</a></td>
<td>This file's security information has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_stream_name" title="#define FILE_NOTIFY_CHANGE_STREAM_NAME 0x00000200">FILE_NOTIFY_CHANGE_STREAM_NAME</a></td>
<td>A file stream has been added, deleted, or renamed in this directory.</td>
</tr>
<tr>
<td><a href="file_notify_change_stream_size" title="#define FILE_NOTIFY_CHANGE_STREAM_SIZE 0x00000400">FILE_NOTIFY_CHANGE_STREAM_SIZE</a></td>
<td>This file stream's size has changed.</td>
</tr>
<tr>
<td><a href="file_notify_change_stream_write" title="#define FILE_NOTIFY_CHANGE_STREAM_WRITE 0x00000800">FILE_NOTIFY_CHANGE_STREAM_WRITE</a></td>
<td>This file stream's data has changed.</td>
</tr>
</tbody>
</table>
<h3><code>NotifyCallbackData</code> [in]</h3>
<p>Pointer to the callback data structure for the operation to be added to the notify list. This parameter is required and cannot be <strong>NULL</strong>.</p>
<h3><code>TraverseCallback</code> [in, optional]</h3>
<p>Optional pointer to a callback routine to be invoked when a change occurs in a subdirectory that is being watched in a directory tree. This pointer lets the file system check whether the watcher has traverse access to that directory. Such a caller-supplied routine is declared as follows:</p>
<pre><code><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
(*PCHECK_FOR_TRAVERSE_ACCESS) (
    IN PVOID NotifyContext,                     // FsContext
    IN PVOID TargetContext,                     // Context pointer
    IN <a href="security_subject_context" title="typedef struct _SECURITY_SUBJECT_CONTEXT {&#10;  PACCESS_TOKEN                ClientToken;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  PACCESS_TOKEN                PrimaryToken;&#10;  PVOID                        ProcessAuditId;&#10;} SECURITY_SUBJECT_CONTEXT, *PSECURITY_SUBJECT_CONTEXT;">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext // SubjectContext
    );
</code></pre>
<p>For more information about the <em>TargetContext</em> parameter, see the <em>TargetContext</em> parameter of the <a href="fsrtlnotifyfullreportchange" title="VOID FsRtlNotifyFullReportChange(&#10;  [in]           PNOTIFY_SYNC NotifySync,&#10;  [in]           PLIST_ENTRY  NotifyList,&#10;  [in]           PSTRING      FullTargetName,&#10;  [in]           USHORT       TargetNameOffset,&#10;  [in, optional] PSTRING      StreamName,&#10;  [in, optional] PSTRING      NormalizedParentName,&#10;  [in]           ULONG        FilterMatch,&#10;  [in]           ULONG        Action,&#10;  [in, optional] PVOID        TargetContext&#10;);">FsRtlNotifyFullReportChange</a> routine.</p>
<h3><code>SubjectContext</code> [in, optional]</h3>
<p>Pointer to a context structure to be passed to <em>TraverseCallback</em>. <strong>FltNotifyFilterChangeDirectory</strong> releases the context and frees the structure after using it. If a <em>TraverseCallback</em> routine is supplied, <em>SubjectContext</em> is passed as the <em>SubjectContext</em> parameter to that routine.</p>
<h3><code>FilterCallback</code> [in, optional]</h3>
<p>Optional pointer to a callback routine to be invoked when a change occurs to the directory. If this callback routine returns <strong>TRUE</strong>, <a href="fsrtlnotifyfilterreportchange" title="VOID FsRtlNotifyFilterReportChange(&#10;  [in]           PNOTIFY_SYNC NotifySync,&#10;  [in]           PLIST_ENTRY  NotifyList,&#10;  [in]           PSTRING      FullTargetName,&#10;  [in]           USHORT       TargetNameOffset,&#10;  [in, optional] PSTRING      StreamName,&#10;  [in, optional] PSTRING      NormalizedParentName,&#10;  [in]           ULONG        FilterMatch,&#10;  [in]           ULONG        Action,&#10;  [in, optional] PVOID        TargetContext,&#10;  [in, optional] PVOID        FilterContext&#10;);">FsRtlNotifyFilterReportChange</a> completes the pending IRP_MN_NOTIFY_CHANGE_DIRECTORY operations in the notify list; otherwise, it does not. Such a caller-supplied routine is declared as follows:</p>
<pre><code>BOOLEAN
(*PFILTER_REPORT_CHANGE) (
    IN PVOID NotifyContext,                     // FsContext
    IN PVOID FilterContext                      // Context pointer
    );
</code></pre>
<h2>Return value</h2>
<p>None</p>
<h2>Remarks</h2>
<p>A minifilter driver can call <strong>FltNotifyFilterChangeDirectory</strong> from the preoperation callback routine (<a href="pflt_pre_operation_callback" title="PFLT_PRE_OPERATION_CALLBACK PfltPreOperationCallback;&#10;&#10;FLT_PREOP_CALLBACK_STATUS PfltPreOperationCallback(&#10;  [in, out] PFLT_CALLBACK_DATA Data,&#10;  [in]      PCFLT_RELATED_OBJECTS FltObjects,&#10;  [out]     PVOID *CompletionContext&#10;)&#10;{...}">PFLT_PRE_OPERATION_CALLBACK</a>) that it registered to process notify change directory operations. These operations have a major function code of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-directory-control">IRP_MJ_DIRECTORY_CONTROL</a> and a minor function code of IRP_MN_NOTIFY_CHANGE_DIRECTORY.</p>
<p>The minifilter driver calls <strong>FltNotifyFilterChangeDirectory</strong> to create a notify structure to hold the callback data structure for the operation and add the notify structure to the notify list for the current volume.</p>
<p><strong>FltNotifyFilterChangeDirectory</strong> does the following:</p>
<ul>
<li>Checks whether the operation's file object has been cleaned up. If so, <strong>FltNotifyFilterChangeDirectory</strong> completes the operation with status STATUS_NOTIFY_CLEANUP and does not add it to the notify list.</li>
<li>If the operation's file object has not been cleaned up, <strong>FltNotifyFilterChangeDirectory</strong> checks whether the notify list already contains a notify structure for the given <em>FsContext</em> value. If such a notify structure is found, and there are pending changes to report, <strong>FltNotifyFilterChangeDirectory</strong> completes the callback data structure pointed to by the <em>NotifyCallbackData</em> parameter. If a notify structure is found, but there are no pending changes to report, <strong>FltNotifyFilterChangeDirectory</strong> adds the operation to the notify structure. If no such notify structure is found, <strong>FltNotifyFilterChangeDirectory</strong> creates a notify structure for the operation and inserts it into the list.</li>
</ul>
<p>When a change occurs to the directory, the file system calls <a href="fsrtlnotifyfilterreportchange" title="VOID FsRtlNotifyFilterReportChange(&#10;  [in]           PNOTIFY_SYNC NotifySync,&#10;  [in]           PLIST_ENTRY  NotifyList,&#10;  [in]           PSTRING      FullTargetName,&#10;  [in]           USHORT       TargetNameOffset,&#10;  [in, optional] PSTRING      StreamName,&#10;  [in, optional] PSTRING      NormalizedParentName,&#10;  [in]           ULONG        FilterMatch,&#10;  [in]           ULONG        Action,&#10;  [in, optional] PVOID        TargetContext,&#10;  [in, optional] PVOID        FilterContext&#10;);">FsRtlNotifyFilterReportChange</a> to complete the pending IRP_MN_NOTIFY_CHANGE_DIRECTORY operations in the notify list.</p>
<h2>See also</h2>
<p><a href="fsrtlnotifyfilterreportchange" title="VOID FsRtlNotifyFilterReportChange(&#10;  [in]           PNOTIFY_SYNC NotifySync,&#10;  [in]           PLIST_ENTRY  NotifyList,&#10;  [in]           PSTRING      FullTargetName,&#10;  [in]           USHORT       TargetNameOffset,&#10;  [in, optional] PSTRING      StreamName,&#10;  [in, optional] PSTRING      NormalizedParentName,&#10;  [in]           ULONG        FilterMatch,&#10;  [in]           ULONG        Action,&#10;  [in, optional] PVOID        TargetContext,&#10;  [in, optional] PVOID        FilterContext&#10;);">FsRtlNotifyFilterReportChange</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-directory-control">IRP_MJ_DIRECTORY_CONTROL</a></p>
<p><a href="pflt_pre_operation_callback" title="PFLT_PRE_OPERATION_CALLBACK PfltPreOperationCallback;&#10;&#10;FLT_PREOP_CALLBACK_STATUS PfltPreOperationCallback(&#10;  [in, out] PFLT_CALLBACK_DATA Data,&#10;  [in]      PCFLT_RELATED_OBJECTS FltObjects,&#10;  [out]     PVOID *CompletionContext&#10;)&#10;{...}">PFLT_PRE_OPERATION_CALLBACK</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nf-fltkernel-fltnotifyfilterchangedirectory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nf-fltkernel-fltnotifyfilterchangedirectory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
