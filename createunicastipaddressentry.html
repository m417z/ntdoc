<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="CreateUnicastIpAddressEntry - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>CreateUnicastIpAddressEntry - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            CreateUnicastIpAddressEntry - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// netioapi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NETIOAPI_API CreateUnicastIpAddressEntry(
  _In_ const <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> *Row
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/createunicastipaddressentry">View the official Windows hardware development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/createunicastipaddressentry.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows hardware development documentation (createunicastipaddressentry)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="createunicastipaddressentry-function">CreateUnicastIpAddressEntry function</h1>

<p>The <strong>CreateUnicastIpAddressEntry</strong> function adds a new unicast IP address entry on the local computer.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><em>Row</em> [in]
A pointer to a <strong><a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a></strong> structure entry for a unicast IP address entry.</li>
</ul>

<h2 id="return-value">Return value</h2>

<p><strong>CreateUnicastIpAddressEntry</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the function succeeds.</p>

<p>If the function fails, <strong>CreateUnicastIpAddressEntry</strong> returns one of the following error codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>An invalid parameter was passed to the function. This error is returned if a <strong>NULL</strong> pointer is passed in the <em>Row</em> parameter, the <strong>Address</strong> member of the <strong><a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a></strong> structure that the <em>Row</em> parameter points to was not set to a valid unicast IPv4 or IPv6 address, or both <strong>InterfaceLuid</strong> and <strong>InterfaceIndex</strong> members of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure were unspecified.<br><br>This error is also returned for other errors in the values that are set for members in the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure. These errors include the following situations:<br><br>* The <strong>ValidLifetime</strong> member is less than the <strong>PreferredLifetime</strong> member.<br>* The <strong>PrefixOrigin</strong> member is set to <strong>IpPrefixOriginUnchanged</strong> and the <strong>SuffixOrigin</strong> is not set to IpSuffixOriginUnchanged.<br>* The <strong>PrefixOrigin</strong> member is not set to <strong>IpPrefixOriginUnchanged</strong> and the <strong>SuffixOrigin</strong> is set to IpSuffixOriginUnchanged.<br>* The <strong>PrefixOrigin</strong> member is not set to a value from the <strong><a href="nl_prefix_origin" title="typedef enum  { &#10;  IpPrefixOriginOther                = 0,&#10;  IpPrefixOriginManual,&#10;  IpPrefixOriginWellKnown,&#10;  IpPrefixOriginDhcp,&#10;  IpPrefixOriginRouterAdvertisement,&#10;  IpPrefixOriginUnchanged            = 1 &lt;&lt; 4&#10;} NL_PREFIX_ORIGIN;">NL_PREFIX_ORIGIN</a></strong> enumeration.<br>* The <strong>SuffixOrigin</strong> member is not set to a value from the <a href="nl_suffix_origin" title="typedef enum  { &#10;  NlsoOther,&#10;  NlsoManual,&#10;  NlsoWellKnown,&#10;  NlsoDhcp,&#10;  NlsoLinkLayerAddress,&#10;  NlsoRandom,&#10;  IpSuffixOriginOther             = 0,&#10;  IpSuffixOriginManual,&#10;  IpSuffixOriginWellKnown,&#10;  IpSuffixOriginDhcp,&#10;  IpSuffixOriginLinkLayerAddress,&#10;  IpSuffixOriginRandom,&#10;  IpSuffixOriginUnchanged         = 1 &lt;&lt; 4&#10;} NL_SUFFIX_ORIGIN;">NL_SUFFIX_ORIGIN</a> enumeration.<br>* The <strong>OnLinkPrefixLength</strong> member is set to a value that is greater than the IP address length, in bits (32 for a unicast IPv4 address or 128 for a unicast IPv6 address).<br><br>For possible values of the <a href="nl_prefix_origin" title="typedef enum  { &#10;  IpPrefixOriginOther                = 0,&#10;  IpPrefixOriginManual,&#10;  IpPrefixOriginWellKnown,&#10;  IpPrefixOriginDhcp,&#10;  IpPrefixOriginRouterAdvertisement,&#10;  IpPrefixOriginUnchanged            = 1 &lt;&lt; 4&#10;} NL_PREFIX_ORIGIN;">NL_PREFIX_ORIGIN</a> and <a href="nl_suffix_origin" title="typedef enum  { &#10;  NlsoOther,&#10;  NlsoManual,&#10;  NlsoWellKnown,&#10;  NlsoDhcp,&#10;  NlsoLinkLayerAddress,&#10;  NlsoRandom,&#10;  IpSuffixOriginOther             = 0,&#10;  IpSuffixOriginManual,&#10;  IpSuffixOriginWellKnown,&#10;  IpSuffixOriginDhcp,&#10;  IpSuffixOriginLinkLayerAddress,&#10;  IpSuffixOriginRandom,&#10;  IpSuffixOriginUnchanged         = 1 &lt;&lt; 4&#10;} NL_SUFFIX_ORIGIN;">NL_SUFFIX_ORIGIN</a> enumerations, see <strong><a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a></strong>.</td>
</tr>
<tr>
  <td><strong>STATUS_NOT_FOUND</strong></td>
  <td>The specified interface could not be found. This error is returned if the function cannot find the network interface that is specified by the <strong>InterfaceLuid</strong> or <strong>InterfaceIndex</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to.</td>
</tr>
<tr>
  <td><strong>STATUS_NOT_SUPPORTED</strong></td>
  <td>The request is not supported. This error is returned if no IPv4 stack is located on the local computer and an IPv4 address was specified in the <strong>Address</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to, or if no IPv6 stack is located on the local computer and an IPv6 address was specified in the <strong>Address</strong> member.</td>
</tr>
<tr>
  <td><strong>ERROR_OBJECT_ALREADY_EXISTS</strong></td>
  <td>The object already exists. This error is returned if the <strong>Address</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to is a duplicate of an existing unicast IP address on the interface that is specified by the <strong>InterfaceLuid</strong> or <strong>InterfaceIndex</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a>.</td>
</tr>
<tr>
  <td><strong>Other</strong></td>
  <td>Use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-formatmessage">FormatMessage</a> function to obtain the message string for the returned error.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Use the <strong><a href="initializeunicastipaddressentry" title="VOID NETIOAPI_API_ InitializeUnicastIpAddressEntry(&#10;  _Out_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">InitializeUnicastIpAddressEntry</a></strong> function to initialize the members of a <strong><a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a></strong> structure entry with default values. A driver can then change the members in the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> entry that it wants to modify, and then call the <strong>CreateUnicastIpAddressEntry</strong> function.</p>

<p>On input, your driver must initialize the following members of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to.</p>

<ul>
<li><p><strong>Address</strong>
Set to a valid unicast IPv4 or IPv6 address and family.</p></li>
<li><p><strong>InterfaceLuid</strong> or <strong>InterfaceIndex</strong>
These members are used in the order that is listed earlier. So if <strong>InterfaceLuid</strong> is specified, this member is used to determine the interface to add the unicast IP address to. If no value was set for the <strong>InterfaceLuid</strong> member (the value of this member was set to zero), the <strong>InterfaceIndex</strong> member is next used to determine the interface.</p></li>
</ul>

<p>If the <strong>OnLinkPrefixLength</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to is set to 255, <strong>CreateUnicastIpAddressEntry</strong> adds the new unicast IP address with the <strong>OnLinkPrefixLength</strong> member set equal to the length of the IP address. So for a unicast IPv4 address, the <strong>OnLinkPrefixLength</strong> is set to 32 and the <strong>OnLinkPrefixLength</strong> is set to 128 for a unicast IPv6 address. If this setting would result in the incorrect subnet mask for an IPv4 address or the incorrect link prefix for an IPv6 address, the driver should set the <strong>OnLinkPrefixLength</strong> member to the correct value before calling <strong>CreateUnicastIpAddressEntry</strong>.</p>

<p>If a unicast IP address is created with the <strong>OnLinkPrefixLength</strong> member set incorrectly, your driver can change the IP address by calling <strong><a href="setunicastipaddressentry" title="NETIOAPI_API SetUnicastIpAddressEntry(&#10;  _In_ const MIB_UNICASTIPADDRESS_ROW *Row&#10;);">SetUnicastIpAddressEntry</a></strong> with the <strong>OnLinkPrefixLength</strong> member set to the correct value.</p>

<p>The <strong>DadState</strong>, <strong>ScopeId</strong>, and <strong>CreationTimeStamp</strong> members of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to are ignored when the <strong>CreateUnicastIpAddressEntry</strong> function is called. These members are set by the network stack. The <strong>ScopeId</strong> member is automatically determined by the interface that the address is added on.</p>

<p>The <strong>CreateUnicastIpAddressEntry</strong> function fails if the unicast IP address that is passed in the <strong>Address</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to is a duplicate of an existing unicast IP address on the interface. Note that your driver can add a loopback IP address to a loopback interface only by using the <strong>CreateUnicastIpAddressEntry</strong> function.</p>

<p>The unicast IP address that is passed in the <strong>Address</strong> member of the <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure that the <em>Row</em> parameter points to is not usable immediately. The IP address is usable after the duplicate address detection process has completed successfully. It can take several seconds for the duplicate address detection process to complete because IP packets must be sent and potential responses must be waited for. For IPv6, the duplicate address detection process typically takes about 1 second. For IPv4, the duplicate address detection process typically takes about 3 seconds.</p>

<p>After a driver calls the <strong>CreateUnicastIpAddressEntry</strong> function, it can use the following methods to determine if an IP address is still usable:</p>

<ul>
<li><p><strong>Use polling and the <a href="getunicastipaddressentry" title="NETIOAPI_API GetUnicastIpAddressEntry(&#10;  _Inout_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">GetUnicastIpAddressEntry</a> function</strong>
After the call to the <strong>CreateUnicastIpAddressEntry</strong> function returns successfully, pause for 1 to 3 seconds (depending on whether an IPv6 or IPv4 address is being created) to allow time for the successful completion of the duplication address detection process. Then, call <strong><a href="getunicastipaddressentry" title="NETIOAPI_API GetUnicastIpAddressEntry(&#10;  _Inout_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">GetUnicastIpAddressEntry</a></strong> to retrieve the updated <a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a> structure and examine the value of the <strong>DadState</strong> member. If the value of the <strong>DadState</strong> member is set to IpDadStatePreferred, the IP address is now usable. If the value of the <strong>DadState</strong> member is set to IpDadStateTentative, duplicate address detection has not yet completed. In this case, call the <strong><a href="getunicastipaddressentry" title="NETIOAPI_API GetUnicastIpAddressEntry(&#10;  _Inout_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">GetUnicastIpAddressEntry</a></strong> function again every 0.5 seconds while the <strong>DadState</strong> member is still set to IpDadStateTentative. If the value of the <strong>DadState</strong> member returns with some value other than <strong>IpDadStatePreferred</strong> or IpDadStateTentative, duplicate address detection has failed and the IP address is not usable.</p></li>
<li><p><strong>Call one of the IP Helper NotifyXxx notification functions to set up an asynchronous notification for when an address changes</strong>
After the call to the <strong>CreateUnicastIpAddressEntry</strong> function returns successfully, call the <strong><a href="notifyunicastipaddresschange" title="NETIOAPI_API NotifyUnicastIpAddressChange(&#10;  _In_    ADDRESS_FAMILY                     Family,&#10;  _In_    PUNICAST_IPADDRESS_CHANGE_CALLBACK Callback,&#10;  _In_    PVOID                              CallerContext,&#10;  _In_    BOOLEAN                            InitialNotification,&#10;  _Inout_ HANDLE                             *NotificationHandle&#10;);">NotifyUnicastIpAddressChange</a></strong> function to register the driver to be notified of changes to either IPv6 or IPv4 unicast IP addresses, depending on the type of IP address that is being created. When a notification is received for the IP address that is being created, call the <strong><a href="getunicastipaddressentry" title="NETIOAPI_API GetUnicastIpAddressEntry(&#10;  _Inout_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">GetUnicastIpAddressEntry</a></strong> function to retrieve the <strong>DadState</strong> member. If the value of the <strong>DadState</strong> member is set to IpDadStatePreferred, the IP address is now usable. If the value of the <strong>DadState</strong> member is set to IpDadStateTentative, duplicate address detection has not yet completed and the driver must wait for future notifications. If the value of the <strong>DadState</strong> member returns with some value other than <strong>IpDadStatePreferred</strong> or IpDadStateTentative, duplicate address detection has failed and the IP address is not usable.</p>

<p>If, during the duplicate address detection process, the media is disconnected and then reconnected, the duplicate address detection process is restarted. So the time to complete the process might increase beyond the typical 1 second value for IPv6 or 3 second value for IPv4.</p></li>
</ul>

<h2 id="requirements">Requirements</h2>

<table>
<thead>
<tr>
  <th></th>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td>Target platform</td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/develop/target-platforms">Universal</a></td>
</tr>
<tr>
  <td>Version</td>
  <td>Available in Windows Vista and later versions of the Windows operating systems.</td>
</tr>
<tr>
  <td>Header</td>
  <td>Netioapi.h (include Netioapi.h)</td>
</tr>
<tr>
  <td>Library</td>
  <td>Netio.lib</td>
</tr>
<tr>
  <td>IRQL</td>
  <td>&lt; DISPATCH_LEVEL</td>
</tr>
</tbody>
</table>

<h2 id="see-also">See also</h2>

<p><strong><a href="deleteunicastipaddressentry" title="NETIOAPI_API DeleteUnicastIpAddressEntry(&#10;  _In_ const MIB_UNICASTIPADDRESS_ROW *Row&#10;);">DeleteUnicastIpAddressEntry</a></strong></p>

<p><strong><a href="getunicastipaddressentry" title="NETIOAPI_API GetUnicastIpAddressEntry(&#10;  _Inout_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">GetUnicastIpAddressEntry</a></strong></p>

<p><strong><a href="getunicastipaddresstable" title="NETIOAPI_API GetUnicastIpAddressTable(&#10;  _In_  ADDRESS_FAMILY              Family,&#10;  _Out_ PMIB_UNICASTIPADDRESS_TABLE *Table&#10;);">GetUnicastIpAddressTable</a></strong></p>

<p><strong><a href="initializeunicastipaddressentry" title="VOID NETIOAPI_API_ InitializeUnicastIpAddressEntry(&#10;  _Out_ PMIB_UNICASTIPADDRESS_ROW Row&#10;);">InitializeUnicastIpAddressEntry</a></strong></p>

<p><strong><a href="mib_unicastipaddress_row" title="typedef struct _MIB_UNICASTIPADDRESS_ROW {&#10;  SOCKADDR_INET    Address;&#10;  NET_LUID         InterfaceLuid;&#10;  NET_IFINDEX      InterfaceIndex;&#10;  NL_PREFIX_ORIGIN PrefixOrigin;&#10;  NL_SUFFIX_ORIGIN SuffixOrigin;&#10;  ULONG            ValidLifetime;&#10;  ULONG            PreferredLifetime;&#10;  UINT8            OnLinkPrefixLength;&#10;  BOOLEAN          SkipAsSource;&#10;  NL_DAD_STATE     DadState;&#10;  SCOPE_ID         ScopeId;&#10;  LARGE_INTEGER    CreationTimeStamp;&#10;} MIB_UNICASTIPADDRESS_ROW, *PMIB_UNICASTIPADDRESS_ROW;">MIB_UNICASTIPADDRESS_ROW</a></strong></p>

<p><strong><a href="mib_unicastipaddress_table" title="typedef struct _MIB_UNICASTIPADDRESS_TABLE {&#10;  ULONG                    NumEntries;&#10;  MIB_UNICASTIPADDRESS_ROW Table[ANY_SIZE];&#10;} MIB_UNICASTIPADDRESS_TABLE, *PMIB_UNICASTIPADDRESS_TABLE;">MIB_UNICASTIPADDRESS_TABLE</a></strong></p>

<p><strong><a href="nl_prefix_origin" title="typedef enum  { &#10;  IpPrefixOriginOther                = 0,&#10;  IpPrefixOriginManual,&#10;  IpPrefixOriginWellKnown,&#10;  IpPrefixOriginDhcp,&#10;  IpPrefixOriginRouterAdvertisement,&#10;  IpPrefixOriginUnchanged            = 1 &lt;&lt; 4&#10;} NL_PREFIX_ORIGIN;">NL_PREFIX_ORIGIN</a></strong></p>

<p><strong><a href="nl_suffix_origin" title="typedef enum  { &#10;  NlsoOther,&#10;  NlsoManual,&#10;  NlsoWellKnown,&#10;  NlsoDhcp,&#10;  NlsoLinkLayerAddress,&#10;  NlsoRandom,&#10;  IpSuffixOriginOther             = 0,&#10;  IpSuffixOriginManual,&#10;  IpSuffixOriginWellKnown,&#10;  IpSuffixOriginDhcp,&#10;  IpSuffixOriginLinkLayerAddress,&#10;  IpSuffixOriginRandom,&#10;  IpSuffixOriginUnchanged         = 1 &lt;&lt; 4&#10;} NL_SUFFIX_ORIGIN;">NL_SUFFIX_ORIGIN</a></strong></p>

<p><strong><a href="notifyipinterfacechange" title="NETIOAPI_API NotifyIpInterfaceChange(&#10;  _In_    ADDRESS_FAMILY               Family,&#10;  _In_    PIPINTERFACE_CHANGE_CALLBACK Callback,&#10;  _In_    PVOID                        CallerContext,&#10;  _In_    BOOLEAN                      InitialNotification,&#10;  _Inout_ HANDLE                       *NotificationHandle&#10;);">NotifyIpInterfaceChange</a></strong></p>

<p><strong><a href="notifyroutechange2" title="NETIOAPI_API NotifyRouteChange2(&#10;  _In_    ADDRESS_FAMILY             Family,&#10;  _In_    PIPFORWARD_CHANGE_CALLBACK Callback,&#10;  _In_    PVOID                      CallerContext,&#10;  _In_    BOOLEAN                    InitialNotification,&#10;  _Inout_ HANDLE                     *NotificationHandle&#10;);">NotifyRouteChange2</a></strong></p>

<p><strong><a href="notifystableunicastipaddresstable" title="NETIOAPI_API NotifyStableUnicastIpAddressTable(&#10;  _In_    ADDRESS_FAMILY                           Family,&#10;  _Out_   PMIB_UNICASTIPADDRESS_TABLE              *Table,&#10;  _In_    PSTABLE_UNICAST_IPADDRESS_TABLE_CALLBACK CallerCallback,&#10;  _In_    PVOID                                    CallerContext,&#10;  _Inout_ HANDLE                                   *NotificationHandle&#10;);">NotifyStableUnicastIpAddressTable</a></strong></p>

<p><strong><a href="notifyteredoportchange" title="NETIOAPI_API NotifyTeredoPortChange(&#10;  _In_    PTEREDO_PORT_CHANGE_CALLBACK Callback,&#10;  _In_    PVOID                        CallerContext,&#10;  _In_    BOOLEAN                      InitialNotification,&#10;  _Inout_ HANDLE *                     NotificationHandle&#10;);">NotifyTeredoPortChange</a></strong></p>

<p><strong><a href="notifyunicastipaddresschange" title="NETIOAPI_API NotifyUnicastIpAddressChange(&#10;  _In_    ADDRESS_FAMILY                     Family,&#10;  _In_    PUNICAST_IPADDRESS_CHANGE_CALLBACK Callback,&#10;  _In_    PVOID                              CallerContext,&#10;  _In_    BOOLEAN                            InitialNotification,&#10;  _Inout_ HANDLE                             *NotificationHandle&#10;);">NotifyUnicastIpAddressChange</a></strong></p>

<p><strong><a href="setunicastipaddressentry" title="NETIOAPI_API SetUnicastIpAddressEntry(&#10;  _In_ const MIB_UNICASTIPADDRESS_ROW *Row&#10;);">SetUnicastIpAddressEntry</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/createunicastipaddressentry">View the official Windows hardware development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs/blob/staging/windows-driver-docs-pr/network/createunicastipaddressentry.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
