<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFND3DDDI_MAKERESIDENTCB - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFND3DDDI_MAKERESIDENTCB - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFND3DDDI_MAKERESIDENTCB - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dumddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFND3DDDI_MAKERESIDENTCB Pfnd3dddiMakeresidentcb;

HRESULT Pfnd3dddiMakeresidentcb(
  HANDLE hDevice,
  <a href="d3dddi_makeresident" title="typedef struct D3DDDI_MAKERESIDENT {&#10;  [in]     D3DKMT_HANDLE             hPagingQueue;&#10;  [in/out] UINT                      NumAllocations;&#10;  [in]     const D3DKMT_HANDLE       *AllocationList;&#10;  [in]     const UINT                *PriorityList;&#10;  [in]     D3DDDI_MAKERESIDENT_FLAGS Flags;&#10;  [out]    D3DKMT_ALIGN64 UINT64     PagingFenceValue;&#10;  [out]    D3DKMT_ALIGN64 UINT64     NumBytesToTrim;&#10;} D3DDDI_MAKERESIDENT;">D3DDDI_MAKERESIDENT</a> *unnamedParam2
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_makeresidentcb">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfnd3dddi_makeresidentcb.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dumddi-pfnd3dddi_makeresidentcb)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pfnd3dddi_makeresidentcb-callback-function">PFND3DDDI_MAKERESIDENTCB callback function</h1>

<h2 id="description">Description</h2>

<p><strong>pfnMakeResidentCb</strong> is used to instruct the OS to add a resource to the device residency list and increment the residency reference count on this allocation.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hdevice"><code>hDevice</code></h3>

<p>A handle to the display device.</p>

<h3 id="unnamedparam2"><code>unnamedParam2</code></h3>

<p><em>pData</em> [in, out]</p>

<p>A pointer to a <a href="d3dddi_makeresident" title="typedef struct D3DDDI_MAKERESIDENT {&#10;  [in]     D3DKMT_HANDLE             hPagingQueue;&#10;  [in/out] UINT                      NumAllocations;&#10;  [in]     const D3DKMT_HANDLE       *AllocationList;&#10;  [in]     const UINT                *PriorityList;&#10;  [in]     D3DDDI_MAKERESIDENT_FLAGS Flags;&#10;  [out]    D3DKMT_ALIGN64 UINT64     PagingFenceValue;&#10;  [out]    D3DKMT_ALIGN64 UINT64     NumBytesToTrim;&#10;} D3DDDI_MAKERESIDENT;">D3DDDI_MAKERESIDENT</a> structure that describes the memory pages to make resident.</p>

<h2 id="return-value">Return value</h2>

<p><em>pfnMakeResidentCb</em> returns one of the following values:</p>

<table>
<thead>
<tr>
  <th style="text-align:left;"><strong>Return code</strong></th>
  <th style="text-align:left;"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><strong>S_OK</strong></td>
  <td style="text-align:left;">All allocations have been made resident on the GPU upon the exit from this function and are ready to be accessed immediately.</td>
</tr>
<tr>
  <td style="text-align:left;"><strong>E_PENDING</strong></td>
  <td style="text-align:left;">The allocations have been added to the device residency requirement list but still have pending paging operations to complete before they can be successfully accessed. In this case the user mode driver must wait for the PagingFenceValue on the monitored fence sync object associated with hPagingQueue to be signaled prior to submitting command buffers that reference allocations or a GPU page fault may occur.</td>
</tr>
<tr>
  <td style="text-align:left;"><strong>E_OUTOFMEMORY</strong></td>
  <td style="text-align:left;">The video memory manager canâ€™t make every requested allocation resident. When this happens, no allocation in the provided list will see their residency count modified. In other word this is an atomic operation where either all of the allocation get their residency count increased, or none of them. Further, NumBytesToTrim indicates to the driver how many bytes must be trimmed from the device residency requirement list, by calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_evictcb">pfnEvictCb</a>, before attempting to made the failed allocations resident again.&lt;br&gt;The memory budget associated with an application can change asynchronously with the application running. As a consequence of this, trimming the requested number of bytes will not guarantee that the next attempt to make the set of allocations resident will succeed as the memory budget for the application may have decreased. Because of this a driver should ensure that it attempts residency request in a loop, trimming between each iteration, until the request either succeeds or the driver has trimmed everything it possibly can to make forward progress on a single operation and use the required resource on that final attempt. If that final attempt fails, the underlying device will be put in error and the user mode driver should abort the request and return back to the application. No further submissions to any of the contexts belonging to a device in error will be allowed by the kernel.&lt;br&gt;For the DirectX 12.0 user mode driver, pfnMakeResidentCb behaves slightly differently because it is no longer responsible for trimming or paging in allocations. This is done to ensure that the state of all allocations after returning from the call remain the same as before the call. This means that if E_OUTOFMEMORY is returned from the function:&lt;br&gt;- All of the allocations remain in their original state.&lt;br&gt;- The allocations were not made resident.&lt;br&gt;- PagingFenceValue should be ignored.&lt;br&gt;If the driver needs to perform pfnMakeResidentCb calls in multiple batches to accommodate resource-to-allocation translation, the driver should undo any prior calls to pfnMakeResidentCb with equivalent calls to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_evictcb">pfnEvictCb</a>, and propagate the error code back to the runtime.</td>
</tr>
</tbody>
</table>

<h2 id="see-also">See also</h2>

<p><a href="d3dddi_makeresident" title="typedef struct D3DDDI_MAKERESIDENT {&#10;  [in]     D3DKMT_HANDLE             hPagingQueue;&#10;  [in/out] UINT                      NumAllocations;&#10;  [in]     const D3DKMT_HANDLE       *AllocationList;&#10;  [in]     const UINT                *PriorityList;&#10;  [in]     D3DDDI_MAKERESIDENT_FLAGS Flags;&#10;  [out]    D3DKMT_ALIGN64 UINT64     PagingFenceValue;&#10;  [out]    D3DKMT_ALIGN64 UINT64     NumBytesToTrim;&#10;} D3DDDI_MAKERESIDENT;">D3DDDI_MAKERESIDENT</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_evictcb">pfnEvictCb</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_makeresidentcb">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dumddi/nc-d3dumddi-pfnd3dddi_makeresidentcb.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
