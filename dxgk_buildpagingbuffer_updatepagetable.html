<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE {
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                        PageTableLevel;
  HANDLE                      hAllocation;
  <a href="dxgk_pagetableupdateaddress" title="typedef struct _DXGK_PAGETABLEUPDATEADDRESS {&#10;  union {&#10;    PVOID                   CpuVirtual;&#10;    D3DGPU_PHYSICAL_ADDRESS GpuPhysical;&#10;    D3DGPU_VIRTUAL_ADDRESS  GpuVirtual;&#10;  };&#10;} DXGK_PAGETABLEUPDATEADDRESS;">DXGK_PAGETABLEUPDATEADDRESS</a> PageTableAddress;
  <a href="dxgk_pte" title="typedef struct _DXGK_PTE {&#10;  union {&#10;    struct {&#10;      ULONGLONG Valid : 1;&#10;      ULONGLONG Zero : 1;&#10;      ULONGLONG CacheCoherent : 1;&#10;      ULONGLONG ReadOnly : 1;&#10;      ULONGLONG NoExecute : 1;&#10;      ULONGLONG Segment : 5;&#10;      ULONGLONG LargePage : 1;&#10;      ULONGLONG PhysicalAdapterIndex : 6;&#10;      ULONGLONG PageTablePageSize : 2;&#10;      ULONGLONG SystemReserved0 : 1;&#10;      ULONGLONG Reserved : 44;&#10;    };&#10;    ULONGLONG Flags;&#10;  };&#10;  union {&#10;    ULONGLONG PageAddress;&#10;    ULONGLONG PageTableAddress;&#10;...">DXGK_PTE</a>                    *pPageTableEntries;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                        StartIndex;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                        NumPageTableEntries;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                        Reserved0;
  <a href="dxgk_updatepagetableflags" title="typedef struct _DXGK_UPDATEPAGETABLEFLAGS {&#10;  UINT Repeat : 1;&#10;  UINT InitialUpdate : 1;&#10;  UINT NotifyEviction : 1;&#10;  UINT Use64KBPages : 1;&#10;  UINT NativeFence : 1;&#10;#if ...&#10;  UINT Reserved : 27;&#10;#else&#10;  UINT Reserved : 28;&#10;#endif&#10;} DXGK_UPDATEPAGETABLEFLAGS;">DXGK_UPDATEPAGETABLEFLAGS</a>   Flags;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                      DriverProtection;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                      AllocationOffsetInBytes;
  HANDLE                      hProcess;
  <a href="dxgk_pagetableupdatemode" title="typedef enum _DXGK_PAGETABLEUPDATEMODE {&#10;  DXGK_PAGETABLEUPDATE_CPU_VIRTUAL,&#10;  DXGK_PAGETABLEUPDATE_GPU_VIRTUAL,&#10;  DXGK_PAGETABLEUPDATE_GPU_PHYSICAL&#10;} DXGK_PAGETABLEUPDATEMODE;">DXGK_PAGETABLEUPDATEMODE</a>    UpdateMode;
  <a href="dxgk_pte" title="typedef struct _DXGK_PTE {&#10;  union {&#10;    struct {&#10;      ULONGLONG Valid : 1;&#10;      ULONGLONG Zero : 1;&#10;      ULONGLONG CacheCoherent : 1;&#10;      ULONGLONG ReadOnly : 1;&#10;      ULONGLONG NoExecute : 1;&#10;      ULONGLONG Segment : 5;&#10;      ULONGLONG LargePage : 1;&#10;      ULONGLONG PhysicalAdapterIndex : 6;&#10;      ULONGLONG PageTablePageSize : 2;&#10;      ULONGLONG SystemReserved0 : 1;&#10;      ULONGLONG Reserved : 44;&#10;    };&#10;    ULONGLONG Flags;&#10;  };&#10;  union {&#10;    ULONGLONG PageAddress;&#10;    ULONGLONG PageTableAddress;&#10;...">DXGK_PTE</a>                    *pPageTableEntries64KB;
  D3DGPU_VIRTUAL_ADDRESS      FirstPteVirtualAddress;
} DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_buildpagingbuffer_updatepagetable">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgk_buildpagingbuffer_updatepagetable.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dkmddi-_dxgk_buildpagingbuffer_updatepagetable)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_dxgk_buildpagingbuffer_updatepagetable-structure">_DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE structure</h1>

<h2 id="description">Description</h2>

<p><strong>DXGK_BUILDPAGINGBUFFER_UPDATEPAGETABLE</strong> is used as part of a page table update operation.</p>

<h2 id="members">Members</h2>

<h3 id="pagetablelevel"><code>PageTableLevel</code></h3>

<p>Level of a page table, which is updated.</p>

<h3 id="hallocation"><code>hAllocation</code></h3>

<p>Kernel mode driver handle of an allocation, which is mapped by the page table entries. The handle is returned by the kernel mode driver from <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createallocation">DxgkDdiCreateAllocation</a>. The handle can be <strong>NULL</strong> for allocations, which do not have a kernel mode driver handle (page tables, page directories, etc.).</p>

<h3 id="pagetableaddress"><code>PageTableAddress</code></h3>

<p>Address of the page table to update. If <strong>DXGK_VIRTUALADDRESSCAPS:: PageTableUpdateMode</strong> is <strong>DXGK_PAGETABLEUPDATE_CPU_VIRTUAL</strong>, the CPU virtual address is in the <strong>CpuVirtual</strong> field. If <strong>DXGK_VIRTUALADDRESSCAPS:: PageTableUpdateMode</strong> is <strong>DXGK_PAGETABLEUPDATE_GPU_VIRTUAL</strong>, the GPU virtual address is in the <strong>GpuVirtual</strong> field. If <strong>DXGK_VIRTUALADDRESSCAPS:: PageTableUpdateMode</strong> is <strong>DXGK_PAGETABLEUPDATE_GPU_PHYSICAL</strong>, the GPU physical address is in the <strong>GpuPhysical</strong> field.</p>

<h3 id="ppagetableentries"><code>pPageTableEntries</code></h3>

<p>The entries which need to be copied. The index zero in the <strong>pPageTableEntries</strong> array corresponds to the <strong>StartIndex</strong> in the driver page table entry array.</p>

<h3 id="startindex"><code>StartIndex</code></h3>

<p>The starting index of a page table entry within the page table where the entries should be copied. The page table entry array index is zero-based.</p>

<h3 id="numpagetableentries"><code>NumPageTableEntries</code></h3>

<p>The number of entries which need to be copied.</p>

<h3 id="reserved0"><code>Reserved0</code></h3>

<p>This member is reserved and should be set to zero.</p>

<h3 id="flags"><code>Flags</code></h3>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_updatepagetableflags">DXGK_UPDATEPAGETABLEFLAGS</a> structure describing the update operation.</p>

<h3 id="driverprotection"><code>DriverProtection</code></h3>

<p>Passed by UMD in MapGpuVirtualAddressRangeCb.</p>

<h3 id="allocationoffsetinbytes"><code>AllocationOffsetInBytes</code></h3>

<p>When <strong>hAllocation</strong> is non-NULL, this field specifies the relative offset, in bytes, from the beginning of the allocation to the first page being targeted by this update operation. If the update target multiple pages from <strong>hAllocation</strong>, those pages are guaranteed to be sequential. For example, video memory manager may be updating a GPU virtual address to page 4,5,6,7 in <strong>hAllocation</strong>. There will never be a case where a driver would see a single update operation which target non sequential pages (ex. 4,5,7). Note that although the pages are guaranteed to be sequential from the point of view of the allocation, they may not be physically contiguous in memory.</p>

<h3 id="hprocess"><code>hProcess</code></h3>

<p>Kernel mode driver process handle for the process whose page table entries are updated. This is the value returned from <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createprocess">DxgkDdiCreateProcess</a>.</p>

<h3 id="updatemode"><code>UpdateMode</code></h3>

<p>Defines the meaning of <strong>PageTableAddress</strong>. When initializing page tables for the paging process, the update mode is always <strong>DXGK_PAGETABLEUPDATE_CPU_VIRTUAL</strong> and <strong>pDmaBuffer</strong> is set to <strong>NULL</strong>. In this case the driver must update page tables immediately. In other cases the <strong>UpdateMode</strong> is set to the value, which is specified in <strong>DXGK_VIRTUALADDRESSCAPS::GpuMmu.PageTableUpdateMode</strong>.</p>

<p>When updating page table entries for a leaf page table, video memory manager assumes that each entry covers a 4KB page. If a GPU page is bigger (4 KB * 2n), the video memory manager will provide entries in the array, which point within GPU pages. The kernel mode driver might only need to initialize page table entries, which point to the beginning of GPU pages. The following figure illustrates this for the case when GPU page is 16 KB.</p>

<h3 id="ppagetableentries64kb"><code>pPageTableEntries64KB</code></h3>

<p>The entries which need to be copied from the 64KB page tables. The index zero in the <strong>pPageTableEntries</strong> array corresponds to the <strong>StartIndex</strong> in the driver page table entry array. The array should be use only when the <strong><a href="dxgk_gpummucaps" title="typedef struct _DXGK_GPUMMUCAPS {&#10;  union {&#10;    struct {&#10;      UINT ReadOnlyMemorySupported : 1;&#10;      UINT NoExecuteMemorySupported : 1;&#10;      UINT ZeroInPteSupported : 1;&#10;      UINT ExplicitPageTableInvalidation : 1;&#10;      UINT CacheCoherentMemorySupported : 1;&#10;      UINT PageTableUpdateRequireAddressSpaceIdle : 1;&#10;      UINT LargePageSupported : 1;&#10;      UINT DualPteSupported : 1;&#10;      UINT AllowNonAlignedLargePageAddress : 1;&#10;      UINT SysMem64KBPageSupported : 1;&#10;      UINT InvalidTlbEntriesNotCached : 1;&#10;      UINT SysMemLargePageSupported : 1;&#10;      UINT CachedPageTables : 1;&#10;#if ...&#10;      UINT Reserved : 19;&#10;#elif&#10;      UINT Reserved : 20;&#10;...">DXGK_GPUMMUCAPS</a>::DualPteSupported</strong> cap is set.</p>

<h3 id="firstptevirtualaddress"><code>FirstPteVirtualAddress</code></h3>

<p>The GPU virtual address that is mapped by the first updated page table entry.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_buildpagingbuffer_updatepagetable">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/ns-d3dkmddi-_dxgk_buildpagingbuffer_updatepagetable.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
