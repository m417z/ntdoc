<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DRIVER_PROXY_REGISTER_CALLBACK_PHASE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DRIVER_PROXY_REGISTER_CALLBACK_PHASE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DRIVER_PROXY_REGISTER_CALLBACK_PHASE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef enum _DRIVER_PROXY_REGISTER_CALLBACK_PHASE {
  DriverProxyRegisterCallbackPreProcess,
  DriverProxyRegisterCallbackProxyStalled,
  DriverProxyRegisterCallbackPostProcess,
  DriverProxyRegisterCallbackMax
} DRIVER_PROXY_REGISTER_CALLBACK_PHASE, *PDRIVER_PROXY_REGISTER_CALLBACK_PHASE;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ne-wdm-driver_proxy_register_callback_phase">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/driver_proxy_register_callback_phase.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ne-wdm-driver_proxy_register_callback_phase)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>DRIVER_PROXY_REGISTER_CALLBACK_PHASE</strong> enumeration defines the different phases during which a <strong><a href="driver_proxy_register_callback" title="DRIVER_PROXY_REGISTER_CALLBACK DriverProxyRegisterCallback;&#10;&#10;NTSTATUS DriverProxyRegisterCallback(&#10;  DRIVER_PROXY_REGISTER_CALLBACK_PHASE Phase,&#10;  PVOID Context&#10;)&#10;{...}">DRIVER_PROXY_REGISTER_CALLBACK</a></strong> callback can be invoked during endpoint registration or hot-swap operations.</p>

<h2 id="constants">Constants</h2>

<h3 id="driverproxyregistercallbackpreprocess"><code>DriverProxyRegisterCallbackPreProcess</code></h3>

<p>Indicates the pre-processing phase. The callback is invoked before any endpoint function switching begins, allowing the driver to perform preparation operations such as acquiring locks, saving state, or notifying other components of the impending change.</p>

<h3 id="driverproxyregistercallbackproxystalled"><code>DriverProxyRegisterCallbackProxyStalled</code></h3>

<p>Indicates the proxy stalled phase. The callback is invoked while all calls to registered endpoints are blocked (stalled). During this phase, the DriverProxy system has acquired the rundown lock and no new calls to endpoint functions will proceed. This is the safest time for the driver to perform operations that require exclusive access to resources that might be accessed by endpoint functions.</p>

<h3 id="driverproxyregistercallbackpostprocess"><code>DriverProxyRegisterCallbackPostProcess</code></h3>

<p>Indicates the post-processing phase. The callback is invoked after endpoint function switching is complete and normal operation has resumed. This allows the driver to perform cleanup operations, release locks, update state, or notify other components that the hot-swap operation has completed.</p>

<h3 id="driverproxyregistercallbackmax"><code>DriverProxyRegisterCallbackMax</code></h3>

<p>Maximum value for the enumeration. This value is not used as a callback phase and is reserved for internal validation purposes.</p>

<h2 id="remarks">Remarks</h2>

<p>This enumeration is used by <strong><a href="ioregisterdriverproxyendpoints" title="NTSTATUS IoRegisterDriverProxyEndpoints(&#10;  PDRIVER_PROXY_EXTENSION            DriverProxyExtension,&#10;  PDRIVER_PROXY_ENDPOINT_INFORMATION EndpointInfo,&#10;  ULONG                              Count,&#10;  PDRIVER_PROXY_REGISTER_CALLBACK    PhasedCallback,&#10;  PVOID                              Context&#10;);">IoRegisterDriverProxyEndpoints</a></strong> to indicate which phase of the registration process is currently executing when the <strong><a href="driver_proxy_register_callback" title="DRIVER_PROXY_REGISTER_CALLBACK DriverProxyRegisterCallback;&#10;&#10;NTSTATUS DriverProxyRegisterCallback(&#10;  DRIVER_PROXY_REGISTER_CALLBACK_PHASE Phase,&#10;  PVOID Context&#10;)&#10;{...}">DRIVER_PROXY_REGISTER_CALLBACK</a></strong> callback is invoked.</p>

<p>The callback phases occur in a specific sequence during endpoint registration or hot-swap operations:</p>

<ol>
<li><strong>DriverProxyRegisterCallbackPreProcess</strong>: Called before any function switching begins.</li>
<li><strong>DriverProxyRegisterCallbackProxyStalled</strong>: Called while all endpoint calls are blocked.</li>
<li><strong>DriverProxyRegisterCallbackPostProcess</strong>: Called after function switching is complete.</li>
</ol>

<p>Each phase serves a different purpose in the hot-swap operation:</p>

<ul>
<li>The <strong>PreProcess</strong> phase allows drivers to prepare for the upcoming change.</li>
<li>The <strong>ProxyStalled</strong> phase provides exclusive access when endpoint calls are blocked.</li>
<li>The <strong>PostProcess</strong> phase allows drivers to clean up after the change is complete.</li>
</ul>

<p>The callback must return <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> for the operation to continue. If any callback phase returns a failure status, the entire registration operation will fail and any partial changes will be rolled back.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="driver_proxy_register_callback" title="DRIVER_PROXY_REGISTER_CALLBACK DriverProxyRegisterCallback;&#10;&#10;NTSTATUS DriverProxyRegisterCallback(&#10;  DRIVER_PROXY_REGISTER_CALLBACK_PHASE Phase,&#10;  PVOID Context&#10;)&#10;{...}">DRIVER_PROXY_REGISTER_CALLBACK</a></strong></p>

<p><strong><a href="ioregisterdriverproxyendpoints" title="NTSTATUS IoRegisterDriverProxyEndpoints(&#10;  PDRIVER_PROXY_EXTENSION            DriverProxyExtension,&#10;  PDRIVER_PROXY_ENDPOINT_INFORMATION EndpointInfo,&#10;  ULONG                              Count,&#10;  PDRIVER_PROXY_REGISTER_CALLBACK    PhasedCallback,&#10;  PVOID                              Context&#10;);">IoRegisterDriverProxyEndpoints</a></strong></p>

<p><strong><a href="driver_proxy_endpoint_information" title="typedef struct _DRIVER_PROXY_ENDPOINT_INFORMATION {&#10;  DRIVER_PROXY_ENDPOINT_FUNCTION_ID Id;&#10;  PDRIVER_PROXY_ENDPOINT_FUNCTION   EndpointFunction;&#10;  ULONG                             ParameterCount;&#10;} DRIVER_PROXY_ENDPOINT_INFORMATION, *PDRIVER_PROXY_ENDPOINT_INFORMATION;">DRIVER_PROXY_ENDPOINT_INFORMATION</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ne-wdm-driver_proxy_register_callback_phase">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/ne-wdm-driver_proxy_register_callback_phase.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
