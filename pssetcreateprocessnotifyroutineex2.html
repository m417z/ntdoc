<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PsSetCreateProcessNotifyRoutineEx2 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PsSetCreateProcessNotifyRoutineEx2 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PsSetCreateProcessNotifyRoutineEx2 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PsSetCreateProcessNotifyRoutineEx2(
  [in] <a href="pscreateprocessnotifytype" title="typedef enum _PSCREATEPROCESSNOTIFYTYPE {&#10;  PsCreateProcessNotifySubsystems&#10;} PSCREATEPROCESSNOTIFYTYPE;">PSCREATEPROCESSNOTIFYTYPE</a> NotifyType,
  [in] PVOID                     NotifyInformation,
  [in] BOOLEAN                   Remove
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-pssetcreateprocessnotifyroutineex2">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pssetcreateprocessnotifyroutineex2.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntddk-pssetcreateprocessnotifyroutineex2)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pssetcreateprocessnotifyroutineex2-function">PsSetCreateProcessNotifyRoutineEx2 function</h1>

<h2 id="description">Description</h2>

<p>The <strong>PsSetCreateProcessNotifyRoutineEx2</strong> routine registers or removes a callback routine that notifies the caller when a process is created or deleted.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="notifytype-in"><code>NotifyType</code> [in]</h3>

<p>A <a rel="noopener" target="_blank" href="pscreateprocessnotifytype">PSCREATEPROCESSNOTIFYTYPE</a>-type value that indicates the type of process notification.</p>

<h3 id="notifyinformation-in"><code>NotifyInformation</code> [in]</h3>

<p>The address of the notification information for the specified type of process notification. If <em>NotifyType</em> is <strong>PsCreateProcessNotifySubsystems</strong>, <em>NotifyInformation</em> is a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nc-ntddk-pcreate_process_notify_routine_ex">PCREATE_PROCESS_NOTIFY_ROUTINE_EX</a> that specifies the entry point of the caller-supplied process-creation callback.</p>

<h3 id="remove-in"><code>Remove</code> [in]</h3>

<p>A Boolean value that specifies whether <strong>PsSetCreateProcessNotifyRoutineEx2</strong> will add or remove a specified routine from the list of callback routines. If this parameter is <strong>TRUE</strong>, the specified routine is removed from the list of callback routines. If this parameter is <strong>FALSE</strong>, the specified routine is added to the list of callback routines. If <em>Remove</em> is <strong>TRUE</strong>, the system also waits for all in-flight callback routines to complete before returning.</p>

<h2 id="return-value">Return value</h2>

<p><strong>PsSetCreateProcessNotifyRoutineEx2</strong> returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The specified routine is now registered with the operating system. The operating system calls this routine whenever a new process is created.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>The specified routine was already registered, or the operating system has reached its limit for registering process-creation callback routines.<br><br> <em>NotifyType</em> is not <strong>PsCreateProcessNotifySubsystems</strong>.</td>
</tr>
<tr>
  <td><strong>STATUS_ACCESS_DENIED</strong></td>
  <td>The image that contains the callback routine pointer did not have IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY set in its image header.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Drivers can call <strong>PsSetCreateProcessNotifyRoutineEx2</strong> to register their process-creation notify routines.</p>

<p>After a driver-supplied routine is registered, it is called with the unique ID (indicated by <em>ProcessId</em>)
of the created or deleted process. The <em>ParentId</em> identifies the parent process of the new process (this is the parent used for priority, affinity, quota, token, and handle inheritance, among others) if it was
created with the inherit handles option. If it was created without
the inherit handle options, then the parent process ID is NULL.</p>

<p>If the <em>Create</em> value is TRUE, the subsystem process
was created; FALSE indicates the process was deleted.</p>

<p>When the process is created, the callback function is invoked just after the first thread in the
process has been created. Conversely, for deletion, the function is invoked after the
last thread in the process has terminated and the address space is about
to be deleted. It is possible that the callback is only invoked for deletion without getting a creation
call in cases where the process was created and deleted
without a thread ever being created.</p>

<p>A driver must remove any callback function that it registers before it unloads. You can remove the callback by calling <strong>PsSetCreateProcessNotifyRoutineEx2</strong> with <em>Remove</em> = <strong>TRUE</strong>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nc-ntddk-pcreate_process_notify_routine_ex">PCREATE_PROCESS_NOTIFY_ROUTINE_EX</a></p>

<p><a rel="noopener" target="_blank" href="pssetcreateprocessnotifyroutine">PsSetCreateProcessNotifyRoutine</a></p>

<p><a rel="noopener" target="_blank" href="pssetcreateprocessnotifyroutineex">PsSetCreateProcessNotifyRoutineEx</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-pssetcreateprocessnotifyroutineex2">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddk/nf-ntddk-pssetcreateprocessnotifyroutineex2.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
