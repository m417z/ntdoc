<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFND3DDDI_CREATEQUERY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFND3DDDI_CREATEQUERY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFND3DDDI_CREATEQUERY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dumddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFND3DDDI_CREATEQUERY Pfnd3dddiCreatequery;

HRESULT Pfnd3dddiCreatequery(
  HANDLE hDevice,
  <a href="d3dddiarg_createquery" title="typedef struct _D3DDDIARG_CREATEQUERY {&#10;  [in]  D3DDDIQUERYTYPE QueryType;&#10;  [out] HANDLE          hQuery;&#10;} D3DDDIARG_CREATEQUERY;">D3DDDIARG_CREATEQUERY</a> *unnamedParam2
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_createquery">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfnd3dddi_createquery.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dumddi-pfnd3dddi_createquery)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pfnd3dddi_createquery-callback-function">PFND3DDDI_CREATEQUERY callback function</h1>

<h2 id="description">Description</h2>

<p>The <strong>CreateQuery</strong> function creates driver-side resources for a query that the Microsoft Direct3D runtime subsequently issues for processing.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hdevice"><code>hDevice</code></h3>

<p>A handle to the display device (graphics context).</p>

<h3 id="unnamedparam2"><code>unnamedParam2</code></h3>

<p><em>pData</em> [in, out]</p>

<p>A pointer to a <a href="d3dddiarg_createquery" title="typedef struct _D3DDDIARG_CREATEQUERY {&#10;  [in]  D3DDDIQUERYTYPE QueryType;&#10;  [out] HANDLE          hQuery;&#10;} D3DDDIARG_CREATEQUERY;">D3DDDIARG_CREATEQUERY</a> structure that identifies the query.</p>

<h2 id="return-value">Return value</h2>

<p><strong>CreateQuery</strong> returns one of the following values:</p>

<table>
<thead>
<tr>
  <th style="text-align:left;"><strong>Return code</strong></th>
  <th style="text-align:left;"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><strong>S_OK</strong></td>
  <td style="text-align:left;">The query is successfully created.</td>
</tr>
<tr>
  <td style="text-align:left;"><strong>E_OUTOFMEMORY</strong></td>
  <td style="text-align:left;"><a href="#">CreateQuery</a> could not allocate the required memory for it to complete.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The Direct3D runtime calls the user-mode display driver's <strong>CreateQuery</strong> function with a query type to create resources for a query. The user-mode display driver creates the following resources for query types:</p>

<ul>
<li>BOOL for D3DDDIQUERYTYPE_EVENT. Before responding about an event, the driver must ensure that the graphics processing unit (GPU) is finished processing all of the operations that are related to the event. That is, the driver responds about an event after the issue end state occurs. The driver must always set the event's BOOL value to <strong>TRUE</strong> when responding.</li>
<li><a href="uint" title="typedef unsigned int UINT;">UINT</a> for D3DDDIQUERYTYPE_OCCLUSION. The driver sets this <a href="uint" title="typedef unsigned int UINT;">UINT</a> variable to the number of pixels for which the z-test passed for all of the primitives between the beginning and end states of the issue query. If the depth buffer is multisampled, the driver determines the number of pixels from the number of samples. However, if the display device is capable of z-test accuracy for each multisample, the conversion to number of pixels should generally be rounded up. An application can then check the occlusion result against 0, to effectively mean "fully occluded." Drivers that convert multisampled quantities to pixel quantities should detect render target multisampling changes and continue to compute the query results appropriately.</li>
<li>A <a href="d3dddidevinfo_vcache" title="typedef struct _D3DDDIDEVINFO_VCACHE {&#10;  [out] UINT Pattern;&#10;  [out] UINT OptMethod;&#10;  [out] UINT CacheSize;&#10;  [out] UINT MagicNumber;&#10;} D3DDDIDEVINFO_VCACHE;">D3DDDIDEVINFO_VCACHE</a> structure for D3DDDIQUERYTYPE_VCACHE. The driver responds after the issue end state occurs.</li>
</ul>

<p>For more information about issue query states, see <a href="d3dddi_issuequeryflags" title="typedef struct _D3DDDI_ISSUEQUERYFLAGS {&#10;  union {&#10;    struct {&#10;      UINT Begin : 1;&#10;      UINT End : 1;&#10;      UINT Reserved : 30;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_ISSUEQUERYFLAGS;">D3DDDI_ISSUEQUERYFLAGS</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="d3dddiarg_createquery" title="typedef struct _D3DDDIARG_CREATEQUERY {&#10;  [in]  D3DDDIQUERYTYPE QueryType;&#10;  [out] HANDLE          hQuery;&#10;} D3DDDIARG_CREATEQUERY;">D3DDDIARG_CREATEQUERY</a></p>

<p><a href="d3dddidevinfo_vcache" title="typedef struct _D3DDDIDEVINFO_VCACHE {&#10;  [out] UINT Pattern;&#10;  [out] UINT OptMethod;&#10;  [out] UINT CacheSize;&#10;  [out] UINT MagicNumber;&#10;} D3DDDIDEVINFO_VCACHE;">D3DDDIDEVINFO_VCACHE</a></p>

<p><a href="d3dddi_devicefuncs" title="typedef struct _D3DDDI_DEVICEFUNCS {&#10;  PFND3DDDI_SETRENDERSTATE                           pfnSetRenderState;&#10;  PFND3DDDI_UPDATEWINFO                              pfnUpdateWInfo;&#10;  PFND3DDDI_VALIDATEDEVICE                           pfnValidateDevice;&#10;  PFND3DDDI_SETTEXTURESTAGESTATE                     pfnSetTextureStageState;&#10;  PFND3DDDI_SETTEXTURE                               pfnSetTexture;&#10;  PFND3DDDI_SETPIXELSHADER                           pfnSetPixelShader;&#10;  PFND3DDDI_SETPIXELSHADERCONST                      pfnSetPixelShaderConst;&#10;  PFND3DDDI_SETSTREAMSOURCEUM                        pfnSetStreamSourceUm;&#10;  PFND3DDDI_SETINDICES                               pfnSetIndices;&#10;  PFND3DDDI_SETINDICESUM                             pfnSetIndicesUm;&#10;  PFND3DDDI_DRAWPRIMITIVE                            pfnDrawPrimitive;&#10;  PFND3DDDI_DRAWINDEXEDPRIMITIVE                     pfnDrawIndexedPrimitive;&#10;  PFND3DDDI_DRAWRECTPATCH                            pfnDrawRectPatch;&#10;  PFND3DDDI_DRAWTRIPATCH                             pfnDrawTriPatch;&#10;  PFND3DDDI_DRAWPRIMITIVE2                           pfnDrawPrimitive2;&#10;  PFND3DDDI_DRAWINDEXEDPRIMITIVE2                    pfnDrawIndexedPrimitive2;&#10;  PFND3DDDI_VOLBLT                                   pfnVolBlt;&#10;  PFND3DDDI_BUFBLT                                   pfnBufBlt;&#10;  PFND3DDDI_TEXBLT                                   pfnTexBlt;&#10;...">D3DDDI_DEVICEFUNCS</a></p>

<p><a href="d3dddi_issuequeryflags" title="typedef struct _D3DDDI_ISSUEQUERYFLAGS {&#10;  union {&#10;    struct {&#10;      UINT Begin : 1;&#10;      UINT End : 1;&#10;      UINT Reserved : 30;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDI_ISSUEQUERYFLAGS;">D3DDDI_ISSUEQUERYFLAGS</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_createquery">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dumddi/nc-d3dumddi-pfnd3dddi_createquery.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
