<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFN_WSK_INSPECT_EVENT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFN_WSK_INSPECT_EVENT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFN_WSK_INSPECT_EVENT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wsk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFN_WSK_INSPECT_EVENT PfnWskInspectEvent;

WSK_INSPECT_ACTION PfnWskInspectEvent(
  [in, optional] PVOID SocketContext,
  [in]           PSOCKADDR LocalAddress,
  [in]           PSOCKADDR RemoteAddress,
  [in, optional] <a href="wsk_inspect_id" title="typedef struct _WSK_INSPECT_ID {&#10;  ULONG_PTR Key;&#10;  ULONG     SerialNumber;&#10;} WSK_INSPECT_ID, *PWSK_INSPECT_ID;">PWSK_INSPECT_ID</a> InspectID
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_inspect_event">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfn_wsk_inspect_event.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wsk-pfn_wsk_inspect_event)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pfn_wsk_inspect_event-callback-function">PFN_WSK_INSPECT_EVENT callback function</h1>

<h2 id="description">Description</h2>

<p>The
<em>WskInspectEvent</em> event callback function notifies a WSK application that an incoming connection
request on a listening socket that has conditional accept mode enabled has been received.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="socketcontext-in-optional"><code>SocketContext</code> [in, optional]</h3>

<p>A pointer to the socket context for the listening socket on which the incoming connection request
was received. The WSK application provided this pointer to the WSK subsystem when it called the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_socket">WskSocket</a> function to create the listening
socket.</p>

<h3 id="localaddress-in"><code>LocalAddress</code> [in]</h3>

<p>A pointer to a buffer that contains the local transport address on which the incoming connection
request arrived. The buffer contains the specific SOCKADDR structure type that corresponds to the
address family that the WSK application specified when it created the listening socket.</p>

<h3 id="remoteaddress-in"><code>RemoteAddress</code> [in]</h3>

<p>A pointer to a buffer that contains the remote transport address from which the incoming
connection request originated. The buffer contains the specific SOCKADDR structure type that corresponds
to the address family that the WSK application specified when it created the listening socket.</p>

<h3 id="inspectid-in-optional"><code>InspectID</code> [in, optional]</h3>

<p>A pointer to a
<a href="wsk_inspect_id" title="typedef struct _WSK_INSPECT_ID {&#10;  ULONG_PTR Key;&#10;  ULONG     SerialNumber;&#10;} WSK_INSPECT_ID, *PWSK_INSPECT_ID;">WSK_INSPECT_ID</a> structure. The contents of
the structure identify the incoming connection request that is being inspected. If this pointer is <strong>NULL</strong>,
the listening socket is no longer functional and the WSK application must call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_close_socket">WskCloseSocket</a> function to close the
listening socket as soon as possible.</p>

<h2 id="return-value">Return value</h2>

<p>A WSK application's
<em>WskInspectEvent</em> event callback function can return one of the following WSK_INSPECT_ACTION
values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><em>*<strong>WskInspectAccept</strong></em>*</td>
  <td>The incoming connection request is accepted.</td>
</tr>
<tr>
  <td><em>*<strong>WskInspectReject</strong></em>*</td>
  <td>The incoming connection request is rejected.</td>
</tr>
<tr>
  <td><em>*<strong>WskInspectPend</strong></em>*</td>
  <td>The WSK application could not determine if the incoming connection request should be accepted or rejected immediately.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The WSK subsystem calls a WSK application's
<em>WskInspectEvent</em> event callback function on a listening socket that has conditional accept mode
enabled. A WSK application can enable conditional accept mode on a listening socket by enabling the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/so-conditional-accept">SO_CONDITIONAL_ACCEPT</a> socket option.
For more information about conditionally accepting incoming connections, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/listening-for-and-accepting-incoming-connections">Listening for and
Accepting Incoming Connections</a>.</p>

<p>If a WSK application returns
<strong>WskInspectAccept</strong> from its
<em>WskInspectEvent</em> event callback function, the WSK subsystem continues to establish the socket
connection. The WSK subsystem returns the socket to the WSK application by either completing a call to
the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept">WskAccept</a> function, or by calling the WSK
application's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept_event">WskAcceptEvent</a> event callback function if
the event callback function is enabled. If the incoming connection request is dropped before the socket
connection is fully established, the WSK subsystem calls the WSK application's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_abort_event">WskAbortEvent</a> event callback function.</p>

<p>If a WSK application returns
<strong>WskInspectReject</strong> from its
<em>WskInspectEvent</em> event callback function, the incoming connection request is dropped and the socket
connection is not established.</p>

<p>If a WSK application returns
<strong>WskInspectPend</strong> from its
<em>WskInspectEvent</em> event callback function, the application must call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_inspect_complete">WskInspectComplete</a> function after it
has determined whether the incoming connection request should be accepted or rejected (unless the
incoming connection request is aborted in the meantime). The WSK application must copy the contents of
the
<a href="wsk_inspect_id" title="typedef struct _WSK_INSPECT_ID {&#10;  ULONG_PTR Key;&#10;  ULONG     SerialNumber;&#10;} WSK_INSPECT_ID, *PWSK_INSPECT_ID;">WSK_INSPECT_ID</a> structure that is pointed to
by the
<em>InspectID</em> parameter to its own <a href="wsk_inspect_id" title="typedef struct _WSK_INSPECT_ID {&#10;  ULONG_PTR Key;&#10;  ULONG     SerialNumber;&#10;} WSK_INSPECT_ID, *PWSK_INSPECT_ID;">WSK_INSPECT_ID</a> structure before returning from the
<em>WskInspectEvent</em> event callback function. The WSK application passes a pointer to its own
<a href="wsk_inspect_id" title="typedef struct _WSK_INSPECT_ID {&#10;  ULONG_PTR Key;&#10;  ULONG     SerialNumber;&#10;} WSK_INSPECT_ID, *PWSK_INSPECT_ID;">WSK_INSPECT_ID</a> structure to the
<strong>WskInspectComplete</strong> function when it completes the inspection. The WSK application also uses this
structure to identify the incoming connection request if the request is aborted before the inspection is
complete.</p>

<p>The
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ws2def/ns-ws2def-sockaddr">SOCKADDR</a> structures that are pointed to by the
<em>LocalAddress</em> and
<em>RemoteAddress</em> parameters are valid only for the duration of the call to the
<em>WskInspectEvent</em> event callback function. If a WSK application returns
<strong>WskInspectPend</strong> from its
<em>WskInspectEvent</em> event callback function and it needs these transport addresses during the remainder
of the inspection, it must copy the contents of these structures to its own SOCKADDR structures before
returning from the
<em>WskInspectEvent</em> event callback function.</p>

<p>The WSK subsystem calls a WSK application's
<em>WskInspectEvent</em> event callback function at IRQL &lt;= DISPATCH_LEVEL.</p>

<p>A WSK application's <em>WskInspectEvent</em> event callback function must not wait for completion of other WSK requests in the context of WSK completion or event callback functions. The callback can initiate other WSK requests (assuming that it doesn't spend too much time at DISPATCH_LEVEL), but it must not wait for their completion even when the callback is called at IRQL = PASSIVE_LEVEL.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ws2def/ns-ws2def-sockaddr">SOCKADDR</a></p>

<p><a href="wsk_client_listen_dispatch" title="typedef struct _WSK_CLIENT_LISTEN_DISPATCH {&#10;  PFN_WSK_ACCEPT_EVENT  WskAcceptEvent;&#10;  PFN_WSK_INSPECT_EVENT WskInspectEvent;&#10;  PFN_WSK_ABORT_EVENT   WskAbortEvent;&#10;} WSK_CLIENT_LISTEN_DISPATCH, *PWSK_CLIENT_LISTEN_DISPATCH;">WSK_CLIENT_LISTEN_DISPATCH</a></p>

<p><a href="wsk_inspect_id" title="typedef struct _WSK_INSPECT_ID {&#10;  ULONG_PTR Key;&#10;  ULONG     SerialNumber;&#10;} WSK_INSPECT_ID, *PWSK_INSPECT_ID;">WSK_INSPECT_ID</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_abort_event">WskAbortEvent</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept">WskAccept</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_accept_event">WskAcceptEvent</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_close_socket">WskCloseSocket</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_control_socket">WskControlSocket</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_inspect_complete">WskInspectComplete</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_socket">WskSocket</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_inspect_event">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wsk/nc-wsk-pfn_wsk_inspect_event.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
