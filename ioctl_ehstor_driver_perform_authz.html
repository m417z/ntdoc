<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_EHSTOR_DRIVER_PERFORM_AUTHZ - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_EHSTOR_DRIVER_PERFORM_AUTHZ - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_EHSTOR_DRIVER_PERFORM_AUTHZ - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ehstorioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x002d, 0x512, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
#define IOCTL_EHSTOR_DRIVER_PERFORM_AUTHZ 0x002DD448</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_driver_perform_authz">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_ehstor_driver_perform_authz.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ehstorioctl-ioctl_ehstor_driver_perform_authz)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_ehstor_driver_perform_authz-ioctl">IOCTL_EHSTOR_DRIVER_PERFORM_AUTHZ IOCTL</h1>

<h2 id="description">Description</h2>

<p><strong>IOCTL_EHSTOR_DRIVER_PERFORM_AUTHZ</strong> is sent by the Enhanced Storage Class Driver (EHSTOR) to the silo driver to initiate on-demand authentication or deauthentication.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>The input buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong> must contain an <strong>AUTHZ_STATE</strong> structure that indicates the type of authentication operation to perform. <strong>AUTHZ_STATE</strong> is declared in <em>ehstorioctl.h</em> as the following.</p>

<p><!-- CODE_MARKER --></p>

<pre><code>typedef struct _AUTHZ_STATE
{
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AuthzState;
} AUTHZ_STATE;
</code></pre>

<p>The value of <strong>AuthzState</strong> specifies the authentication operation. This is one of the following.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0</td>
  <td>Perform on-demand deauthentication.</td>
</tr>
<tr>
  <td>AUTHZSTATE_AUTHENTICATE</td>
  <td>Perform on-demand authentication.</td>
</tr>
<tr>
  <td>AUTHZSTATE_CLEAR_AUTHKEY_CACHE</td>
  <td>Perform on-demand deauthentication and clear cached authentication keys.</td>
</tr>
</tbody>
</table>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>The length of an <strong>AUTHZ_STATE</strong> structure.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>None.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p>None.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> is returned in the <strong>Status</strong> field by the silo driver if the authentication state is changed. Otherwise, STATUS_UNSUCCESSFUL is returned.</p>

<h2 id="remarks">Remarks</h2>

<p>This IOCTL is sent by EHSTOR to a silo driver that supports on-demand authentication. The silo driver notifies EHSTOR of this capability in a prior <a href="ioctl_ehstor_driver_report_capabilities" title="// CTL_CODE(0x002d, 0x510, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)&#10;#define IOCTL_EHSTOR_DRIVER_REPORT_CAPABILITIES 0x002DD440">IOCTL_EHSTOR_DRIVER_REPORT_CAPABILITIES</a> request with the <strong>CAP_ON_DEMAND_AUTHENTICATION</strong> flag set in the <strong>Capabilities</strong> member of <a href="silo_driver_capabilities" title="typedef struct _SILO_DRIVER_CAPABILITIES {&#10;  ULONG StructSize;&#10;  ULONG Capabilities;&#10;  ULONG MaxLbaFilterCount;&#10;  ULONG RedirectedIoctlListCount;&#10;  ULONG RedirectedIoctlListOffset;&#10;} SILO_DRIVER_CAPABILITIES, *PSILO_DRIVER_CAPABILITIES;">SILO_DRIVER_CAPABILITIES</a>.</p>

<p>In response to this IOCTL, the silo driver performs authentication or deauthentication for the device. For banded devices, the silo driver will, depending on the specified operation in the system buffer, unlock or lock as many bands as possible for reads and writes.</p>

<p>If the silo driver fails to perform the requested operation, it will not change the authentication state of a device.</p>

<p>If the <strong>AuthzState</strong> member of <strong>AUTHZ_STATE</strong> is set to <strong>AUTHZSTATE_CLEAR_AUTHKEY_CACHE</strong>, then the silo driver clears its authentication key cache in addition to deauthenticating. <strong>AUTHZSTATE_CLEAR_AUTHKEY_CACHE</strong> is set when the system is shutting down or hibernating. This prevents the presence of the key cache in the hibernation file.</p>

<p>If a device supports multiple silos, authentication by each silo is exclusive. An authentication operation by one silo driver does not affect the authentication state set by another silo driver.</p>

<h2 id="see-also">See also</h2>

<p><a href="ioctl_ehstor_driver_report_capabilities" title="// CTL_CODE(0x002d, 0x510, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)&#10;#define IOCTL_EHSTOR_DRIVER_REPORT_CAPABILITIES 0x002DD440">IOCTL_EHSTOR_DRIVER_REPORT_CAPABILITIES</a></p>

<p><a href="silo_driver_capabilities" title="typedef struct _SILO_DRIVER_CAPABILITIES {&#10;  ULONG StructSize;&#10;  ULONG Capabilities;&#10;  ULONG MaxLbaFilterCount;&#10;  ULONG RedirectedIoctlListCount;&#10;  ULONG RedirectedIoctlListOffset;&#10;} SILO_DRIVER_CAPABILITIES, *PSILO_DRIVER_CAPABILITIES;">SILO_DRIVER_CAPABILITIES</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_driver_perform_authz">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_driver_perform_authz.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
