<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtCreateSection - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtCreateSection - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtCreateSection - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTMMAPI_H
//
// Sections
//
#if (PHNT_MODE != PHNT_MODE_KERNEL)

</span><span class="ntdoc-code-intro">/**
 * The NtCreateSection routine creates a section object.
 *
 * \param SectionHandle Pointer to a variable that receives a handle to the section object.
 * \param DesiredAccess The access mask that specifies the requested access to the section object.
 * \param ObjectAttributes Pointer to the base virtual address of the view to unmap. This value can be any virtual address within the view.
 * \param MaximumSize The maximum size, in bytes, of the section. The actual size when backed by the paging file, or the maximum the file can be extended or mapped when backed by an ordinary file.
 * \param SectionPageProtection Specifies the protection to place on each page in the section.
 * \param AllocationAttributes A bitmask of SEC_XXX flags that determines the allocation attributes of the section.
 * \param FileHandle Optionally specifies a handle for an open file object. If the value of FileHandle is NULL, the section is backed by the paging file. Otherwise, the section is backed by the specified file.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwcreatesection
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtCreateSection(
    _Out_ PHANDLE SectionHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="pcobject_attributes" title="typedef const OBJECT_ATTRIBUTES *PCOBJECT_ATTRIBUTES;">PCOBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_opt_ PLARGE_INTEGER MaximumSize,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> SectionPageProtection,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationAttributes,
    _In_opt_ HANDLE FileHandle
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/78124af1f54187762af94ebc9aab9a9818a53adf/phnt/include/ntmmapi.h#L1153">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwCreateSection(
    _Out_ PHANDLE SectionHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="pcobject_attributes" title="typedef const OBJECT_ATTRIBUTES *PCOBJECT_ATTRIBUTES;">PCOBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_opt_ PLARGE_INTEGER MaximumSize,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> SectionPageProtection,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationAttributes,
    _In_opt_ HANDLE FileHandle
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/78124af1f54187762af94ebc9aab9a9818a53adf/phnt/include/ntzwapi.h#L1315">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">__kernel_entry NTSYSCALLAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NtCreateSection(
  [out]          PHANDLE            SectionHandle,
  [in]           ACCESS_MASK        DesiredAccess,
  [in, optional] <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
  [in, optional] PLARGE_INTEGER     MaximumSize,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              SectionPageProtection,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              AllocationAttributes,
  [in, optional] HANDLE             FileHandle
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntcreatesection">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwCreateSection(
  [out]          PHANDLE            SectionHandle,
  [in]           ACCESS_MASK        DesiredAccess,
  [in, optional] <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
  [in, optional] PLARGE_INTEGER     MaximumSize,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              SectionPageProtection,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              AllocationAttributes,
  [in, optional] HANDLE             FileHandle
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwcreatesection">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntcreatesection.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-ntcreatesection)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ntcreatesection-function">NtCreateSection function</h1>

<h2 id="description">Description</h2>

<p>The <strong>NtCreateSection</strong> routine creates a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/section-objects-and-views">section object</a>.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="sectionhandle-out"><code>SectionHandle</code> [out]</h3>

<p>Pointer to a HANDLE variable that receives a handle to the section object.</p>

<h3 id="desiredaccess-in"><code>DesiredAccess</code> [in]</h3>

<p>Specifies an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask"><strong>ACCESS_MASK</strong></a> value that determines the requested access to the object. In addition to the access rights that are defined for all types of objects, the caller can specify any of the following access rights, which are specific to section objects:</p>

<table>
<thead>
<tr>
  <th>DesiredAccess flag</th>
  <th>Allows caller to do this</th>
</tr>
</thead>
<tbody>
<tr>
  <td>SECTION_EXTEND_SIZE</td>
  <td>Dynamically extend the size of the section.</td>
</tr>
<tr>
  <td>SECTION_MAP_EXECUTE</td>
  <td>Execute views of the section.</td>
</tr>
<tr>
  <td>SECTION_MAP_READ</td>
  <td>Read views of the section.</td>
</tr>
<tr>
  <td>SECTION_MAP_WRITE</td>
  <td>Write views of the section.</td>
</tr>
<tr>
  <td>SECTION_QUERY</td>
  <td>Query the section object for information about the section. Drivers should set this flag.</td>
</tr>
<tr>
  <td>SECTION_ALL_ACCESS</td>
  <td>All of the previous flags combined with STANDARD_RIGHTS_REQUIRED.</td>
</tr>
</tbody>
</table>

<h3 id="objectattributes-in-optional"><code>ObjectAttributes</code> [in, optional]</h3>

<p>Pointer to an <strong><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></strong> structure that specifies the object name and other attributes. Use <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong> to initialize this structure. If the caller is not running in a system thread context, it must set the <a href="obj_kernel_handle" title="#define OBJ_KERNEL_HANDLE 0x00000200L">OBJ_KERNEL_HANDLE</a> attribute when it calls <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong>.</p>

<h3 id="maximumsize-in-optional"><code>MaximumSize</code> [in, optional]</h3>

<p>Specifies the maximum size, in bytes, of the section. <strong>NtCreateSection</strong> rounds this value up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a>. If the section is backed by the paging file, <strong>MaximumSize</strong> specifies the actual size of the section. If the section is backed by an ordinary file, <strong>MaximumSize</strong> specifies the maximum size that the file can be extended or mapped to.</p>

<h3 id="sectionpageprotection-in"><code>SectionPageProtection</code> [in]</h3>

<p>Specifies the protection to place on each page in the section. Use one of the following four values: <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a>, <a href="page_readwrite" title="#define PAGE_READWRITE 0x04 // Enables read-only or read/write access to the committed region of pages.">PAGE_READWRITE</a>, <a href="page_execute" title="#define PAGE_EXECUTE 0x10 // Enables execute access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE</a>, or <a href="page_writecopy" title="#define PAGE_WRITECOPY 0x08 // Enables read-only or copy-on-write access to a mapped view of a file mapping object.">PAGE_WRITECOPY</a>. For a description of these values, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-createfilemappinga"><strong>CreateFileMapping</strong></a>.</p>

<h3 id="allocationattributes-in"><code>AllocationAttributes</code> [in]</h3>

<p>Specifies a bitmask of SEC_<em>XXX</em> flags that determines the allocation attributes of the section. For a description of these flags, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-createfilemappinga"><strong>CreateFileMapping</strong></a>.</p>

<h3 id="filehandle-in-optional"><code>FileHandle</code> [in, optional]</h3>

<p>Optionally specifies a handle for an open file object. If the value of <strong>FileHandle</strong> is <strong>NULL</strong>, the section is backed by the paging file. Otherwise, the section is backed by the specified file.</p>

<h2 id="return-value">Return value</h2>

<p><strong>NtCreateSection</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success, or the appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> error code on failure. Possible error status codes include the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_FILE_LOCK_CONFLICT</td>
  <td>The file specified by the <strong>FileHandle</strong> parameter is locked.</td>
</tr>
<tr>
  <td>STATUS_INVALID_FILE_FOR_SECTION</td>
  <td>The file specified by <strong>FileHandle</strong> does not support sections.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PAGE_PROTECTION</td>
  <td>The value specified for the <strong>SectionPageProtection</strong> parameter is invalid.</td>
</tr>
<tr>
  <td>STATUS_MAPPED_FILE_SIZE_ZERO</td>
  <td>The size of the file specified by <strong>FileHandle</strong> is zero, and <strong>MaximumSize</strong> is zero.</td>
</tr>
<tr>
  <td>STATUS_SECTION_TOO_BIG</td>
  <td>The value of <strong>MaximumSize</strong> is too big. This occurs when either <strong>MaximumSize</strong> is greater than the system-defined maximum for sections, or if <strong>MaximumSize</strong> is greater than the specified file and the section is not writable.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Once the handle pointed to by <strong>SectionHandle</strong> is no longer in use, the driver must call <strong><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">NtClose</a></strong> to close it.</p>

<p>If the caller is not running in a system thread context, it must ensure that any handles it creates are private handles. Otherwise, the handle can be accessed by the process in whose context the driver is running. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/object-handles">Object Handles</a>.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/managing-memory-sections">Managing Memory Sections</a>.</p>

<blockquote>
  <p>[!NOTE]
  If the call to this function occurs in user mode, you should use the name "<strong>NtCreateSection</strong>" instead of "<strong>ZwCreateSection</strong>".</p>
</blockquote>

<p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask"><strong>ACCESS_MASK</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-createfilemappinga"><strong>CreateFileMapping</strong></a></p>

<p><strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong></p>

<p><strong><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a></strong></p>

<p><strong><a href="ntmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMapViewOfSection(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _In_ SIZE_T CommitSize,&#10;    _Inout_opt_ PLARGE_INTEGER SectionOffset,&#10;    _Inout_ PSIZE_T ViewSize,&#10;    _In_ SECTION_INHERIT InheritDisposition,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">ZwMapViewOfSection</a></strong></p>

<p><strong><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenSection</a></strong></p>

<p><strong><a href="ntunmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnmapViewOfSection(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ PVOID BaseAddress&#10;    );">ZwUnmapViewOfSection</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntcreatesection">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-ntcreatesection.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwcreatesection)</h1>
</div>
<div class="ntdoc-description">
<h2>Description</h2>

<p>The <strong>ZwCreateSection</strong> routine creates a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/section-objects-and-views">section object</a>.</p>

<h2>Parameters</h2>

<h3><code>SectionHandle</code> [out]</h3>

<p>Pointer to a HANDLE variable that receives a handle to the section object.</p>

<h3><code>DesiredAccess</code> [in]</h3>

<p>Specifies an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> value that determines the requested access to the object. In addition to the access rights that are defined for all types of objects (see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a>), the caller can specify any of the following access rights, which are specific to section objects:</p>

<table>
<thead>
<tr>
  <th><em>DesiredAccess</em> flag</th>
  <th>Allows caller to do this</th>
</tr>
</thead>
<tbody>
<tr>
  <td>SECTION_EXTEND_SIZE</td>
  <td>Dynamically extend the size of the section.</td>
</tr>
<tr>
  <td>SECTION_MAP_EXECUTE</td>
  <td>Execute views of the section.</td>
</tr>
<tr>
  <td>SECTION_MAP_READ</td>
  <td>Read views of the section.</td>
</tr>
<tr>
  <td>SECTION_MAP_WRITE</td>
  <td>Write views of the section.</td>
</tr>
<tr>
  <td>SECTION_QUERY</td>
  <td>Query the section object for information about the section. Drivers should set this flag.</td>
</tr>
<tr>
  <td>SECTION_ALL_ACCESS</td>
  <td>All of the previous flags combined with STANDARD_RIGHTS_REQUIRED.</td>
</tr>
</tbody>
</table>

<h3><code>ObjectAttributes</code> [in, optional]</h3>

<p>Pointer to an <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a> structure that specifies the object name and other attributes. Use <a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a> to initialize this structure. If the caller is not running in a system thread context, it must set the <a href="obj_kernel_handle" title="#define OBJ_KERNEL_HANDLE 0x00000200L">OBJ_KERNEL_HANDLE</a> attribute when it calls <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong>.</p>

<h3><code>MaximumSize</code> [in, optional]</h3>

<p>Specifies the maximum size, in bytes, of the section. <strong>ZwCreateSection</strong> rounds this value up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a>. If the section is backed by the paging file, <em>MaximumSize</em> specifies the actual size of the section. If the section is backed by an ordinary file, <em>MaximumSize</em> specifies the maximum size that the file can be extended or mapped to.</p>

<h3><code>SectionPageProtection</code> [in]</h3>

<p>Specifies the protection to place on each page in the section. Use one of the following four values: <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a>, <a href="page_readwrite" title="#define PAGE_READWRITE 0x04 // Enables read-only or read/write access to the committed region of pages.">PAGE_READWRITE</a>, <a href="page_execute" title="#define PAGE_EXECUTE 0x10 // Enables execute access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE</a>, or <a href="page_writecopy" title="#define PAGE_WRITECOPY 0x08 // Enables read-only or copy-on-write access to a mapped view of a file mapping object.">PAGE_WRITECOPY</a>. For a description of these values, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-createfilemappinga">CreateFileMapping</a>.</p>

<h3><code>AllocationAttributes</code> [in]</h3>

<p>Specifies a bitmask of SEC_<em>XXX</em> flags that determines the allocation attributes of the section. For a description of these flags, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-createfilemappinga">CreateFileMapping</a>.</p>

<h3><code>FileHandle</code> [in, optional]</h3>

<p>Optionally specifies a handle for an open file object. If the value of <em>FileHandle</em> is <strong>NULL</strong>, the section is backed by the paging file. Otherwise, the section is backed by the specified file.</p>

<h2>Return value</h2>

<p><strong>ZwCreateSection</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success, or the appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> error code on failure. Possible error status codes include the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_FILE_LOCK_CONFLICT</strong></td>
  <td>The file specified by the <em>FileHandle</em> parameter is locked.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_FILE_FOR_SECTION</strong></td>
  <td>The file specified by <em>FileHandle</em> does not support sections.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PAGE_PROTECTION</strong></td>
  <td>The value specified for the <em>SectionPageProtection</em> parameter is invalid.</td>
</tr>
<tr>
  <td><strong>STATUS_MAPPED_FILE_SIZE_ZERO</strong></td>
  <td>The size of the file specified by <em>FileHandle</em> is zero, and <em>MaximumSize</em> is zero.</td>
</tr>
<tr>
  <td><strong>STATUS_SECTION_TOO_BIG</strong></td>
  <td>The value of <em>MaximumSize</em> is too big. This occurs when either <em>MaximumSize</em> is greater than the system-defined maximum for sections, or if <em>MaximumSize</em> is greater than the specified file and the section is not writable.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>Once the handle pointed to by <em>SectionHandle</em> is no longer in use, the driver must call <a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a> to close it.</p>

<p>If the caller is not running in a system thread context, it must ensure that any handles it creates are private handles. Otherwise, the handle can be accessed by the process in whose context the driver is running. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/object-handles">Object Handles</a>.</p>

<p>For more information about setting up mapped sections and views of memory, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/section-objects-and-views">Sections and Views</a>.</p>

<p>If the call to this function occurs in user mode, you should use the name "<strong>NtCreateSection</strong>" instead of "<strong>ZwCreateSection</strong>".</p>

<p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winbase/nf-winbase-createfilemappinga">CreateFileMapping</a></p>

<p><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></p>

<p><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a></p>

<p><a href="ntmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMapViewOfSection(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _In_ SIZE_T CommitSize,&#10;    _Inout_opt_ PLARGE_INTEGER SectionOffset,&#10;    _Inout_ PSIZE_T ViewSize,&#10;    _In_ SECTION_INHERIT InheritDisposition,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">ZwMapViewOfSection</a></p>

<p><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenSection</a></p>

<p><a href="ntunmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnmapViewOfSection(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ PVOID BaseAddress&#10;    );">ZwUnmapViewOfSection</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwcreatesection">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwcreatesection.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is documented in Windows Driver Kit <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntcreatesection">here</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwcreatesection">here</a>.</p>

<hr />

<p>Function <code>NtCreateSection</code> creates Section Object (virtual memory block with associated file).</p>

<h3>SectionHandle</h3>

<p>Result of call - <code>HANDLE</code> to Section Object.</p>

<h3>DesiredAccess</h3>

<p>Access mask. Can be combination of:</p>

<ul>
<li><code>SECTION_QUERY</code></li>
<li><code>SECTION_MAP_WRITE</code></li>
<li><code>SECTION_MAP_READ</code></li>
<li><code>SECTION_MAP_EXECUTE</code></li>
<li><code>SECTION_EXTEND_SIZE</code></li>
<li><code>SECTION_ALL_ACCESS</code></li>
</ul>

<h3>ObjectAttributes</h3>

<p>Pointer to <code><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></code> structure contains section name, in Object Namespace format.</p>

<h3>MaximumSize</h3>

<p>Optionally define maximum size of section. Must be defined when caller create section based on system <em>PageFile</em>.</p>

<h3>PageAttributes</h3>

<p>Can be one or combination of:</p>

<ul>
<li><code><a href="page_noaccess" title="#define PAGE_NOACCESS 0x01 // Disables all access to the committed region of pages. An attempt to read from, write to, or execute the committed region results in an access violation.">PAGE_NOACCESS</a></code></li>
<li><code><a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a></code></li>
<li><code><a href="page_readwrite" title="#define PAGE_READWRITE 0x04 // Enables read-only or read/write access to the committed region of pages.">PAGE_READWRITE</a></code></li>
<li><code><a href="page_writecopy" title="#define PAGE_WRITECOPY 0x08 // Enables read-only or copy-on-write access to a mapped view of a file mapping object.">PAGE_WRITECOPY</a></code></li>
<li><code><a href="page_execute" title="#define PAGE_EXECUTE 0x10 // Enables execute access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE</a></code></li>
<li><code><a href="page_execute_read" title="#define PAGE_EXECUTE_READ 0x20 // Enables execute or read-only access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE_READ</a></code></li>
<li><code><a href="page_execute_readwrite" title="#define PAGE_EXECUTE_READWRITE 0x40 // Enables execute, read-only, or read/write access to the committed region of pages.">PAGE_EXECUTE_READWRITE</a></code></li>
<li><code><a href="page_execute_writecopy" title="#define PAGE_EXECUTE_WRITECOPY 0x80 // Enables execute, read-only, or copy-on-write access to a mapped view of a file mapping object.">PAGE_EXECUTE_WRITECOPY</a></code></li>
<li><code><a href="page_guard" title="#define PAGE_GUARD 0x100 // Pages in the region become guard pages. Any attempt to access a guard page causes the system to raise a STATUS_GUARD_PAGE_VIOLATION exception.">PAGE_GUARD</a></code></li>
<li><code><a href="page_nocache" title="#define PAGE_NOCACHE 0x200 // Sets all pages to be non-cachable. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_NOCACHE</a></code></li>
<li><code><a href="page_writecombine" title="#define PAGE_WRITECOMBINE 0x400 // Sets all pages to be write-combined. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_WRITECOMBINE</a></code></li>
</ul>

<h3>SectionAttributes</h3>

<p>Can be one or combination of:</p>

<ul>
<li><code><a href="sec_file" title="#define SEC_FILE 0x00800000">SEC_FILE</a></code></li>
<li><code><a href="sec_image" title="#define SEC_IMAGE 0x01000000">SEC_IMAGE</a></code></li>
<li><code><a href="sec_reserve" title="#define SEC_RESERVE 0x04000000">SEC_RESERVE</a></code></li>
<li><code><a href="sec_commit" title="#define SEC_COMMIT 0x08000000">SEC_COMMIT</a></code></li>
<li><code><a href="sec_nocache" title="#define SEC_NOCACHE 0x10000000">SEC_NOCACHE</a></code></li>
</ul>

<h3>FileHandle</h3>

<p>Optionally <code>HANDLE</code> to File Object opened with proper access.</p>

<h1>Documented by</h1>

<ul>
<li>Tomasz Nowak</li>
</ul>

<h1>See also</h1>

<ul>
<li><code><a href="ntcreatefile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateFile(&#10;    _Out_ PHANDLE FileHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER AllocationSize,&#10;    _In_ ULONG FileAttributes,&#10;    _In_ ULONG ShareAccess,&#10;    _In_ ULONG CreateDisposition,&#10;    _In_ ULONG CreateOptions,&#10;    _In_reads_bytes_opt_(EaLength) PVOID EaBuffer,&#10;    _In_ ULONG EaLength&#10;    );">NtCreateFile</a></code></li>
<li><code><a href="ntextendsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtExtendSection(&#10;    _In_ HANDLE SectionHandle,&#10;    _Inout_ PLARGE_INTEGER NewSectionSize&#10;    );">NtExtendSection</a></code></li>
<li><code><a href="ntflushvirtualmemory" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtFlushVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ PVOID *BaseAddress,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _Out_ PIO_STATUS_BLOCK IoStatus&#10;    );">NtFlushVirtualMemory</a></code></li>
<li><code><a href="ntmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMapViewOfSection(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _In_ SIZE_T CommitSize,&#10;    _Inout_opt_ PLARGE_INTEGER SectionOffset,&#10;    _Inout_ PSIZE_T ViewSize,&#10;    _In_ SECTION_INHERIT InheritDisposition,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtMapViewOfSection</a></code></li>
<li><code><a href="ntopenfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenFile(&#10;    _Out_ PHANDLE FileHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_ ULONG ShareAccess,&#10;    _In_ ULONG OpenOptions&#10;    );">NtOpenFile</a></code></li>
<li><code><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">NtOpenSection</a></code></li>
<li><code><a href="ntquerysection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQuerySection(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ SECTION_INFORMATION_CLASS SectionInformationClass,&#10;    _Out_writes_bytes_(SectionInformationLength) PVOID SectionInformation,&#10;    _In_ SIZE_T SectionInformationLength,&#10;    _Out_opt_ PSIZE_T ReturnLength&#10;    );">NtQuerySection</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntcreatesection.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
