<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ClfsCreateLogFile - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ClfsCreateLogFile - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ClfsCreateLogFile - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">CLFSUSER_API <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ClfsCreateLogFile(
  [out]          PPLOG_FILE_OBJECT    pplfoLog,
  [in]           <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a>      puszLogFileName,
  [in]           ACCESS_MASK          fDesiredAccess,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                dwShareMode,
  [in, optional] PSECURITY_DESCRIPTOR psdLogFile,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                fCreateDisposition,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                fCreateOptions,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                fFlagsAndAttributes,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                fLogOptionFlag,
  [in, optional] PVOID                pvContext,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                cbContext
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-clfscreatelogfile">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/clfscreatelogfile.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-clfscreatelogfile)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="clfscreatelogfile-function">ClfsCreateLogFile function</h1>

<h2 id="description">Description</h2>

<p>The <strong>ClfsCreateLogFile</strong> routine creates or opens a CLFS stream. If necessary, <strong>ClfsCreateLogFile</strong> also creates the underlying physical log that holds the stream's records.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="pplfolog-out"><code>pplfoLog</code> [out]</h3>

<p>A pointer to a variable that receives a pointer to a <a rel="noopener" target="_blank" href="file_object">LOG_FILE_OBJECT</a> structure that represents an open instance of the stream.</p>

<h3 id="puszlogfilename-in"><code>puszLogFileName</code> [in]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="unicode_string">UNICODE_STRING</a> structure that supplies the name of the stream or the underlying physical log.</p>

<p>If the stream already exists and is the only stream of a dedicated log, the name has the form log:<em>physical log name</em>, where <em>physical log name</em> is the path name, on the underlying file system, of the existing physical log that contains the stream's records.</p>

<p>If the stream does not already exist and is to become the only stream of a dedicated log (that does not yet exist), the name has the form log:<em>physical log name</em>, where <em>physical log name</em> is the path name, on the underlying file system, of the physical log that will be created to hold the stream's records.</p>

<p>If the stream is (or is to become) one of the streams of a multiplexed log, the name has the form log:<em>physical log name</em>::<em>stream name</em>, where <em>physical log name</em> is the path name, on the underlying file system, of the physical log that holds the stream's records, and <em>stream name</em> is the name of a stream that shares (or will share) that physical log.</p>

<p>If you want to create a multiplexed log that has no streams for the moment, use a name of the form log:<em>physical log name</em>::, where <em>physical log name</em> is the path name, on the underlying file system, of the physical log to be created.</p>

<p>The following list gives some examples of valid names.</p>

<ul>
<li>"Log:c:\myLog" creates or opens a dedicated log and its one stream.</li>
<li>"Log:c:\myCommonLog::" creates a multiplexed log that does not yet have any streams.</li>
<li>"Log:c:\myCommonLog::Stream1" creates or opens one of the streams (Stream1) of a multiplexed log.</li>
</ul>

<h3 id="fdesiredaccess-in"><code>fDesiredAccess</code> [in]</h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> that supplies the type of access the client will have (by using the pointer returned in <em>pplfoLog</em>) to the stream. If this parameter is zero, clients can query the stream for its attributes, but cannot read from or write to the stream. This parameter can be zero or any combination of the following flags:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>GENERIC_READ</td>
  <td>The client has read access to the stream.</td>
</tr>
<tr>
  <td>GENERIC_WRITE</td>
  <td>The client has write access to the stream.</td>
</tr>
<tr>
  <td>DELETE</td>
  <td>The client can mark the stream for deletion.</td>
</tr>
</tbody>
</table>

<h3 id="dwsharemode-in"><code>dwShareMode</code> [in]</h3>

<p>The sharing mode of the stream, which can be zero (not shared) or any combination of the following flags:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="file_share_delete" title="#define FILE_SHARE_DELETE 0x00000004">FILE_SHARE_DELETE</a></td>
  <td>Subsequent requests to open the stream with delete access will succeed.</td>
</tr>
<tr>
  <td><a href="file_share_read" title="#define FILE_SHARE_READ 0x00000001">FILE_SHARE_READ</a></td>
  <td>Subsequent requests to open the stream with read access will succeed.</td>
</tr>
<tr>
  <td><a href="file_share_write" title="#define FILE_SHARE_WRITE 0x00000002">FILE_SHARE_WRITE</a></td>
  <td>Subsequent requests to open the stream with write access will succeed.</td>
</tr>
</tbody>
</table>

<h3 id="psdlogfile-in-optional"><code>psdLogFile</code> [in, optional]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="pisecurity_descriptor">SECURITY_DESCRIPTOR</a> structure that supplies security attributes for the stream. This parameter can be <strong>NULL</strong>.</p>

<h3 id="fcreatedisposition-in"><code>fCreateDisposition</code> [in]</h3>

<p>The action to take that depends on whether the stream already exists. This parameter must be set to one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CREATE_NEW</td>
  <td>Create a new stream if the stream does not already exits. Fail if the stream already exists.</td>
</tr>
<tr>
  <td>OPEN_EXISTING</td>
  <td>Open an existing stream. Fail if the stream does not already exist.</td>
</tr>
<tr>
  <td>OPEN_ALWAYS</td>
  <td>Open an existing stream. Create the stream if it does not already exist.</td>
</tr>
</tbody>
</table>

<h3 id="fcreateoptions-in"><code>fCreateOptions</code> [in]</h3>

<p>A set of flags that specify options to apply when creating or opening the stream. This parameter can be zero or a compatible combination of the following flags:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="file_no_intermediate_buffering" title="#define FILE_NO_INTERMEDIATE_BUFFERING 0x00000008">FILE_NO_INTERMEDIATE_BUFFERING</a></td>
  <td>The stream's records cannot be cached in a driver's internal buffers.</td>
</tr>
<tr>
  <td><a href="file_synchronous_io_alert" title="#define FILE_SYNCHRONOUS_IO_ALERT 0x00000010">FILE_SYNCHRONOUS_IO_ALERT</a></td>
  <td>All operations on the stream are performed synchronously. Any wait on behalf of the caller is subject to premature termination from alerts. If this flag is set, the <a href="file_synchronous_io_nonalert" title="#define FILE_SYNCHRONOUS_IO_NONALERT 0x00000020">FILE_SYNCHRONOUS_IO_NONALERT</a> flag must be cleared.</td>
</tr>
<tr>
  <td><a href="file_synchronous_io_nonalert" title="#define FILE_SYNCHRONOUS_IO_NONALERT 0x00000020">FILE_SYNCHRONOUS_IO_NONALERT</a></td>
  <td>All operations on the stream are performed synchronously. Waits in the system that synchronize I/O queuing and completion are not subject to alerts. If this flag is set, the <a href="file_synchronous_io_alert" title="#define FILE_SYNCHRONOUS_IO_ALERT 0x00000010">FILE_SYNCHRONOUS_IO_ALERT</a> flag must be cleared.</td>
</tr>
</tbody>
</table>

<h3 id="fflagsandattributes-in"><code>fFlagsAndAttributes</code> [in]</h3>

<p>A value that specifies whether the stream is opened for normal or read-only access. This parameter must be set to either</p>

<p>FILE_ATTRIBUTE_NORMAL or FILE_ATTRIBUTE_READONLY.</p>

<h3 id="flogoptionflag-in"><code>fLogOptionFlag</code> [in]</h3>

<p>A hint about the relationship between CLFS and the component creating or opening the stream. This parameter must be set to one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CLFS_FLAG_NO_FLAGS</td>
  <td>CLFS and the creating component have the standard, normal relationship. Kernel-mode components use this value unless they fall into one of the three other categories listed in this table. If <em>pvContext</em> is not <strong>NULL</strong>, CLFS verifies that <em>cbContext</em> is greater than zero. Otherwise, <em>pvContext</em> and <em>cbContext</em> are ignored.</td>
</tr>
<tr>
  <td>CLFS_FLAG_REENTRANT_FILE_SYSTEM</td>
  <td>The creating component is the file system that provides the underlying storage for CLFS. CLFS uses the file system for allocating containers, and the file system uses CLFS streams. In this case, it is possible for the file system to call CLFS and for CLFS to make calls back into the file system on the same thread or different threads. If <em>pvContext</em> is not <strong>NULL</strong>, CLFS verifies that <em>cbContext</em> is greater than zero. Otherwise, <em>pvContext</em> and <em>cbContext</em> are ignored.</td>
</tr>
<tr>
  <td>CLFS_FLAG_NON_REENTRANT_FILTER</td>
  <td>The creating component is a file system filter driver that sends all of its CLFS I/O to a specified level below itself on the filter stack. This option allows a filter driver to create a CLFS log without seeing its own logging I/O. The caller passes the non-<strong>NULL</strong> target device object in the <em>pvContext</em> parameter with <em>cbContext</em> set to the appropriate size. CLFS uses the <a rel="noopener" target="_blank" href="iocreatefilespecifydeviceobjecthint">IoCreateFileSpecifyDeviceObjectHint</a> routine to create containers at a targeted level in the I/O filter stack specified by the device object.</td>
</tr>
<tr>
  <td>CLFS_FLAG_REENTRANT_FILTER</td>
  <td>The creating component is a file system filter driver that sends all of its CLFS I/O to the top of the filter stack. The filter has a recursive relationship with CLFS because it filters its own logging I/O when CLFS performs any file system operation on its containers. The <em>pvContext</em> parameter provides a means for filters to associate a recognizable context with its CLFS containers as log I/O comes down the filter stack. The <em>cbContext</em> parameter specifies the size of the opaque context in bytes.</td>
</tr>
<tr>
  <td>CLFS_FLAG_MINIFILTER_LEVEL</td>
  <td>The creating component is a file system minifilter driver that sends all of its CLFS I/O to a specified level below itself on the filter stack. This option allows a minifilter to create a CLFS log without seeing its own logging I/O. The caller passes the non-<strong>NULL</strong> minifilter context object in the <em>pvContext</em> parameter with <em>cbContext</em> set to the appropriate size. CLFS uses the <strong><a href="iocreatefilespecifydeviceobjecthint" title="NTSTATUS IoCreateFileSpecifyDeviceObjectHint(&#10;  [out]          PHANDLE            FileHandle,&#10;  [in]           ACCESS_MASK        DesiredAccess,&#10;  [in]           POBJECT_ATTRIBUTES ObjectAttributes,&#10;  [out]          PIO_STATUS_BLOCK   IoStatusBlock,&#10;  [in, optional] PLARGE_INTEGER     AllocationSize,&#10;  [in]           ULONG              FileAttributes,&#10;  [in]           ULONG              ShareAccess,&#10;  [in]           ULONG              Disposition,&#10;  [in]           ULONG              CreateOptions,&#10;  [in, optional] PVOID              EaBuffer,&#10;  [in]           ULONG              EaLength,&#10;  [in]           CREATE_FILE_TYPE   CreateFileType,&#10;  [in, optional] PVOID              InternalParameters,&#10;  [in]           ULONG              Options,&#10;  [in, optional] PVOID              DeviceObject&#10;);">IoCreateFileSpecifyDeviceObjectHint</a></strong> routine to create containers at an altitude (specified within the minifilter context) in the filter manager's minifilter stack.</td>
</tr>
</tbody>
</table>

<h3 id="pvcontext-in-optional"><code>pvContext</code> [in, optional]</h3>

<p>A pointer to a context. The way the context is interpreted depends on the value passed to <em>fLogOptionsFlag</em>.</p>

<h3 id="cbcontext-in"><code>cbContext</code> [in]</h3>

<p>The size, in bytes, of the context pointed to by <em>pvContext</em>. If <em>pvContext</em> is not <strong>NULL</strong>, this parameter must be greater than zero.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ClfsCreateLogFile</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it succeeds; otherwise, it returns one of the error codes defined in Ntstatus.h.</p>

<h2 id="remarks">Remarks</h2>

<p>When you create a CLFS stream, it is backed by an underlying physical CLFS log. The underlying log can be either dedicated (backs only one stream) or multiplexed (backs several streams). A dedicated log cannot be converted to a multiplexed log, and a multiplexed log cannot be converted to a dedicated log.</p>

<p>A physical CLFS log name does not include the .blf extension.</p>

<p>For an explanation of CLFS concepts and terminology, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-common-log-file-system">Common Log File System</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="clfscloseandresetlogfile">ClfsCloseAndResetLogFile</a></p>

<p><a rel="noopener" target="_blank" href="clfscloselogfileobject">ClfsCloseLogFileObject</a></p>

<p><a rel="noopener" target="_blank" href="clfsdeletelogbypointer">ClfsDeleteLogByPointer</a></p>

<p><a rel="noopener" target="_blank" href="clfsdeletelogfile">ClfsDeleteLogFile</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-clfscreatelogfile">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-clfscreatelogfile.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
