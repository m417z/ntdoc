<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DKMTPresent - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DKMTPresent - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DKMTPresent - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmthk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> D3DKMTPresent(
  [in] <a href="d3dkmt_present" title="typedef struct _D3DKMT_PRESENT {&#10;  union {&#10;    [in] D3DKMT_HANDLE hDevice;&#10;    [in] D3DKMT_HANDLE hContext;&#10;  };&#10;  [in] HWND                           hWindow;&#10;  [in] D3DDDI_VIDEO_PRESENT_SOURCE_ID VidPnSourceId;&#10;  [in] D3DKMT_HANDLE                  hSource;&#10;  [in] D3DKMT_HANDLE                  hDestination;&#10;  [in] UINT                           Color;&#10;  [in] RECT                           DstRect;&#10;  [in] RECT                           SrcRect;&#10;  [in] UINT                           SubRectCnt;&#10;  [in] const RECT                     *pSrcSubRects;&#10;  [in] UINT                           PresentCount;&#10;  [in] D3DDDI_FLIPINTERVAL_TYPE       FlipInterval;&#10;  [in] D3DKMT_PRESENTFLAGS            Flags;&#10;  [in] ULONG                          BroadcastContextCount;&#10;       D3DKMT_HANDLE                  BroadcastContext[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] HANDLE                         PresentLimitSemaphore;&#10;...">D3DKMT_PRESENT</a> *unnamedParam1
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtpresent">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dkmtpresent.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-d3dkmthk-d3dkmtpresent)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>D3DKMTPresent function</h1>
<h2>Description</h2>
<p>The <strong>D3DKMTPresent</strong> function submits a present command to the Microsoft DirectX graphics kernel subsystem (<em>Dxgkrnl.sys</em>).</p>
<h2>Parameters</h2>
<h3><code>unnamedParam1</code> [in]</h3>
<p><strong>pData</strong>: A pointer to a <strong><a href="d3dkmt_present" title="typedef struct _D3DKMT_PRESENT {&#10;  union {&#10;    [in] D3DKMT_HANDLE hDevice;&#10;    [in] D3DKMT_HANDLE hContext;&#10;  };&#10;  [in] HWND                           hWindow;&#10;  [in] D3DDDI_VIDEO_PRESENT_SOURCE_ID VidPnSourceId;&#10;  [in] D3DKMT_HANDLE                  hSource;&#10;  [in] D3DKMT_HANDLE                  hDestination;&#10;  [in] UINT                           Color;&#10;  [in] RECT                           DstRect;&#10;  [in] RECT                           SrcRect;&#10;  [in] UINT                           SubRectCnt;&#10;  [in] const RECT                     *pSrcSubRects;&#10;  [in] UINT                           PresentCount;&#10;  [in] D3DDDI_FLIPINTERVAL_TYPE       FlipInterval;&#10;  [in] D3DKMT_PRESENTFLAGS            Flags;&#10;  [in] ULONG                          BroadcastContextCount;&#10;       D3DKMT_HANDLE                  BroadcastContext[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] HANDLE                         PresentLimitSemaphore;&#10;...">D3DKMT_PRESENT</a></strong> structure that describes parameters for presenting.</p>
<h2>Return value</h2>
<p><strong>D3DKMTPresent</strong> returns an <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value, such as one of the following values:</p>
<table>
<thead>
<tr>
<th align="left"><strong>Return code</strong></th>
<th align="left"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
<td align="left">The present was successfully performed.</td>
</tr>
<tr>
<td align="left"><strong>STATUS_DEVICE_REMOVED</strong></td>
<td align="left">The graphics adapter was stopped or the display context was reset.</td>
</tr>
<tr>
<td align="left"><strong>STATUS_INVALID_PARAMETER</strong></td>
<td align="left">Parameters were validated and determined to be incorrect.</td>
</tr>
<tr>
<td align="left"><strong>STATUS_NO_MEMORY</strong></td>
<td align="left"><strong>D3DKMTPresent</strong> could not complete because of insufficient memory.</td>
</tr>
<tr>
<td align="left"><strong>STATUS_GRAPHICS_ALLOCATION_INVALID</strong></td>
<td align="left">The primary surface handle was invalidated because of a display mode change. If the OpenGL installable client driver (ICD) receives this error code, it should reopen or re-create the primary handle, replace all references in the command buffer to the old handle with the new handle, and then resubmit the buffer.</td>
</tr>
<tr>
<td align="left"><strong>STATUS_GRAPHICS_GPU_EXCEPTION_ON_DEVICE</strong></td>
<td align="left">An error occurred on the rendering device context that the <strong>hContext</strong> member of <strong><a href="d3dkmt_present" title="typedef struct _D3DKMT_PRESENT {&#10;  union {&#10;    [in] D3DKMT_HANDLE hDevice;&#10;    [in] D3DKMT_HANDLE hContext;&#10;  };&#10;  [in] HWND                           hWindow;&#10;  [in] D3DDDI_VIDEO_PRESENT_SOURCE_ID VidPnSourceId;&#10;  [in] D3DKMT_HANDLE                  hSource;&#10;  [in] D3DKMT_HANDLE                  hDestination;&#10;  [in] UINT                           Color;&#10;  [in] RECT                           DstRect;&#10;  [in] RECT                           SrcRect;&#10;  [in] UINT                           SubRectCnt;&#10;  [in] const RECT                     *pSrcSubRects;&#10;  [in] UINT                           PresentCount;&#10;  [in] D3DDDI_FLIPINTERVAL_TYPE       FlipInterval;&#10;  [in] D3DKMT_PRESENTFLAGS            Flags;&#10;  [in] ULONG                          BroadcastContextCount;&#10;       D3DKMT_HANDLE                  BroadcastContext[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] HANDLE                         PresentLimitSemaphore;&#10;...">D3DKMT_PRESENT</a></strong> specifies.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>[!NOTE]
The <strong>STATUS_GRAPHICS_GPU_EXCEPTION_ON_DEVICE</strong> error code does not indicate the initiation of a Timeout Detection and Recovery (TDR) process or that the GPU stopped responding. For example, the DirectX graphics kernel subsystem puts a device into an error state if the display miniport driver indicated that a DMA buffer that was submitted from this device caused a fault or if the video memory manager could not page-in all of the allocations that are required for a DMA buffer even after splitting the DMA buffer. After a device is in an error state, it cannot perform any more operations and must be destroyed and re-created. The ICD can call the <a href="d3dkmtgetdevicestate" title="NTSTATUS D3DKMTGetDeviceState(&#10;  [in/out] D3DKMT_GETDEVICESTATE *unnamedParam1&#10;);">D3DKMTGetDeviceState</a> function to determine a more precise reason for the error.</p>
</blockquote>
<h2>Remarks</h2>
<p>The <strong>D3DKMTPresent</strong> function might return STATUS_INVALID_PARAMETER, depending on the combination of parameter values (that is, values in members of the <strong><a href="d3dkmt_present" title="typedef struct _D3DKMT_PRESENT {&#10;  union {&#10;    [in] D3DKMT_HANDLE hDevice;&#10;    [in] D3DKMT_HANDLE hContext;&#10;  };&#10;  [in] HWND                           hWindow;&#10;  [in] D3DDDI_VIDEO_PRESENT_SOURCE_ID VidPnSourceId;&#10;  [in] D3DKMT_HANDLE                  hSource;&#10;  [in] D3DKMT_HANDLE                  hDestination;&#10;  [in] UINT                           Color;&#10;  [in] RECT                           DstRect;&#10;  [in] RECT                           SrcRect;&#10;  [in] UINT                           SubRectCnt;&#10;  [in] const RECT                     *pSrcSubRects;&#10;  [in] UINT                           PresentCount;&#10;  [in] D3DDDI_FLIPINTERVAL_TYPE       FlipInterval;&#10;  [in] D3DKMT_PRESENTFLAGS            Flags;&#10;  [in] ULONG                          BroadcastContextCount;&#10;       D3DKMT_HANDLE                  BroadcastContext[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] HANDLE                         PresentLimitSemaphore;&#10;...">D3DKMT_PRESENT</a></strong> structure that <strong>pData</strong> points to). The following list describes the most common combinations of parameter values that might cause <strong>D3DKMTPresent</strong> to return STATUS_INVALID PARAMETER:</p>
<ul>
<li>
<p>The <strong>hDestination</strong> member is non-<strong>NULL</strong> and at least one of the following conditions is true:</p>
<ul>
<li>
The <strong>pSrcSubRects</strong> member is <strong>NULL</strong>.
</li>
<li>
The <strong>SubRectCnt</strong> member is 0.
</li>
<li>
The <strong>Blt</strong> bit-field flag of the <strong>Flags</strong> member is not set.
</li>
<li>
The <strong>SrcRectValid</strong> bit-field flag of <strong>Flags</strong> is not set.
</li>
<li>
The <strong>ColorFill</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>Flip</strong>, <strong>FlipDoNotFlip</strong>, <strong>FlipDoNotWait</strong>, or <strong>FlipRestart</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>SrcColorKey</strong> or <strong>DstColorKey</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>hSource</strong> member is equal to <strong>hDestination</strong>.
</li>
<li>
The source and destination are not a primary surface.
</li>
</ul>
</li>
<li>
<p>The <strong>Flip</strong> bit-field flag of <strong>Flags</strong> is set and at least one of the following conditions is true:</p>
<ul>
<li>
The <strong>ColorFill</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>Blt</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>SrcColorKey</strong> or <strong>DstColorKey</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>SrcRectValid</strong> or <strong>DstRectValid</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>Rotate</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>RestrictVidPnSource</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The source is not a primary surface.
</li>
<li>
The display miniport driver does not support the flip interval that the <strong>FlipInterval</strong> member specifies.
</li>
<li>
The <strong><a href="d3dkmtsetdisplaymode" title="NTSTATUS D3DKMTSetDisplayMode(&#10;  [in, out] const D3DKMT_SETDISPLAYMODE *unnamedParam1&#10;);">D3DKMTSetDisplayMode</a></strong> function was not previously called.
</li>
</ul>
</li>
<li>
<p>The <strong>ColorFill</strong> bit-field flag of <strong>Flags</strong> is set and one of the following conditions is true:</p>
<ul>
<li>
<strong>pSrcSubRects</strong> is <strong>NULL</strong>.
</li>
<li>
<strong>SubRectCnt</strong> is 0.
</li>
<li>
The <strong>Blt</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>Flip</strong>, <strong>FlipDoNotFlip</strong>, <strong>FlipDoNotWait</strong>, or <strong>FlipRestart</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>SrcColorKey</strong> or <strong>DstColorKey</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>SrcRectValid</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
</ul>
</li>
<li>
<p>The <strong>Blt</strong> bit-field flag of <strong>Flags</strong> is set and one of the following conditions is true:</p>
<ul>
<li>
<strong>pSrcSubRects</strong> is <strong>NULL</strong>.
</li>
<li>
<strong>SubRectCnt</strong> is 0.
</li>
<li>
The <strong>ColorFill</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
<li>
The <strong>Flip</strong>, <strong>FlipDoNotFlip</strong>, <strong>FlipDoNotWait</strong>, or <strong>FlipRestart</strong> bit-field flag of <strong>Flags</strong> is set.
</li>
</ul>
</li>
</ul>
<p>User-mode graphics drivers that call <strong>D3DKMTPresent</strong> for blit style present, with the <strong>Blt</strong> bit-field flag of <strong>Flags</strong> set, need to take special care to ensure that all previously submitted work to the context(s) being presented from is fully drainable. Failure to do so can result in the application deadlocking itself, or in some corner cases deadlocking the current user desktop. A context is fully drainable if it only contains waits on the GPU sync object where the corresponding signal has already been queued to the GPU scheduler database and where that signal itself is not behind another undrainable wait. In other words, if the user space of all processes in the system was paused immediately after the call to <strong>D3DKMTPresent</strong>, the wait would get satisfied once the dependent rendering chain already queued to the GPU scheduler would finish rendering. A driver must never call blit present on a context that is dependent on a GPU wait which is not currently satisfied and expected to be satisfied by some later operation originating from this or another process.</p>
<h3>Examples</h3>
<p>The following code example demonstrates how an OpenGL ICD can use <strong>D3DKMTPresent</strong> to present data.</p>
<pre><code>HRESULT Present(D3DKMT_HANDLE hDevice,
                HWND hWnd,
                RECT* pSrcRect,
                 RECT* pDstRect)
{
    <a href="d3dkmt_present" title="typedef struct _D3DKMT_PRESENT {&#10;  union {&#10;    [in] D3DKMT_HANDLE hDevice;&#10;    [in] D3DKMT_HANDLE hContext;&#10;  };&#10;  [in] HWND                           hWindow;&#10;  [in] D3DDDI_VIDEO_PRESENT_SOURCE_ID VidPnSourceId;&#10;  [in] D3DKMT_HANDLE                  hSource;&#10;  [in] D3DKMT_HANDLE                  hDestination;&#10;  [in] UINT                           Color;&#10;  [in] RECT                           DstRect;&#10;  [in] RECT                           SrcRect;&#10;  [in] UINT                           SubRectCnt;&#10;  [in] const RECT                     *pSrcSubRects;&#10;  [in] UINT                           PresentCount;&#10;  [in] D3DDDI_FLIPINTERVAL_TYPE       FlipInterval;&#10;  [in] D3DKMT_PRESENTFLAGS            Flags;&#10;  [in] ULONG                          BroadcastContextCount;&#10;       D3DKMT_HANDLE                  BroadcastContext[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] HANDLE                         PresentLimitSemaphore;&#10;...">D3DKMT_PRESENT</a> PresentData = {0};

    PresentData.hDevice = hDevice;
    PresentData.Flags.Blt =
    PresentData.Flags.DstRectValid =
    PresentData.Flags.SrcRectValid = TRUE;
    PresentData.hWindow = hWnd;
    PresentData.DstRect = *pDstRect;
    PresentData.SrcRect = *pSrcRect;
    PresentData.SubRectCnt = 1;
    PresentData.pSrcSubRects = pSrcRect;

    if (<a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a>((*pfnKTPresent)(&amp;PresentData))) {
        return S_OK;
    }
    return E_FAIL;
}
</code></pre>
<h2>See also</h2>
<p><strong><a href="d3dkmtgetdevicestate" title="NTSTATUS D3DKMTGetDeviceState(&#10;  [in/out] D3DKMT_GETDEVICESTATE *unnamedParam1&#10;);">D3DKMTGetDeviceState</a></strong></p>
<p><strong><a href="d3dkmtsetdisplaymode" title="NTSTATUS D3DKMTSetDisplayMode(&#10;  [in, out] const D3DKMT_SETDISPLAYMODE *unnamedParam1&#10;);">D3DKMTSetDisplayMode</a></strong></p>
<p><strong><a href="d3dkmt_present" title="typedef struct _D3DKMT_PRESENT {&#10;  union {&#10;    [in] D3DKMT_HANDLE hDevice;&#10;    [in] D3DKMT_HANDLE hContext;&#10;  };&#10;  [in] HWND                           hWindow;&#10;  [in] D3DDDI_VIDEO_PRESENT_SOURCE_ID VidPnSourceId;&#10;  [in] D3DKMT_HANDLE                  hSource;&#10;  [in] D3DKMT_HANDLE                  hDestination;&#10;  [in] UINT                           Color;&#10;  [in] RECT                           DstRect;&#10;  [in] RECT                           SrcRect;&#10;  [in] UINT                           SubRectCnt;&#10;  [in] const RECT                     *pSrcSubRects;&#10;  [in] UINT                           PresentCount;&#10;  [in] D3DDDI_FLIPINTERVAL_TYPE       FlipInterval;&#10;  [in] D3DKMT_PRESENTFLAGS            Flags;&#10;  [in] ULONG                          BroadcastContextCount;&#10;       D3DKMT_HANDLE                  BroadcastContext[D3DDDI_MAX_BROADCAST_CONTEXT];&#10;  [in] HANDLE                         PresentLimitSemaphore;&#10;...">D3DKMT_PRESENT</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtpresent">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmthk/nf-d3dkmthk-d3dkmtpresent.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
