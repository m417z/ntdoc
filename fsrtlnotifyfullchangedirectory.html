<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FsRtlNotifyFullChangeDirectory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FsRtlNotifyFullChangeDirectory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FsRtlNotifyFullChangeDirectory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID FsRtlNotifyFullChangeDirectory(
  [in]           PNOTIFY_SYNC               NotifySync,
  [in]           <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">PLIST_ENTRY</a>                NotifyList,
  [in]           PVOID                      FsContext,
  [in]           <a href="string" title="typedef struct _STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PCHAR Buffer;&#10;} STRING, *PSTRING, ANSI_STRING, *PANSI_STRING, OEM_STRING, *POEM_STRING;">PSTRING</a>                    FullDirectoryName,
  [in]           BOOLEAN                    WatchTree,
  [in]           BOOLEAN                    IgnoreBuffer,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                      CompletionFilter,
  [in, optional] PIRP                       NotifyIrp,
  [in, optional] PCHECK_FOR_TRAVERSE_ACCESS TraverseCallback,
  [in, optional] <a href="security_subject_context" title="typedef struct _SECURITY_SUBJECT_CONTEXT {&#10;  PACCESS_TOKEN                ClientToken;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  PACCESS_TOKEN                PrimaryToken;&#10;  PVOID                        ProcessAuditId;&#10;} SECURITY_SUBJECT_CONTEXT, *PSECURITY_SUBJECT_CONTEXT;">PSECURITY_SUBJECT_CONTEXT</a>  SubjectContext
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullchangedirectory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// rxprocs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">void FsRtlNotifyFullChangeDirectory(
  A1,
  A2,
  A3,
  A4,
  A5,
  A6,
  A7,
  A8,
  A9,
  A10
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/rxprocs/nf-rxprocs-fsrtlnotifyfullchangedirectory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsrtlnotifyfullchangedirectory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullchangedirectory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fsrtlnotifyfullchangedirectory-function">FsRtlNotifyFullChangeDirectory function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FsRtlNotifyFullChangeDirectory</strong> routine creates a notify structure for a notification request and adds it to the specified notify list.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="notifysync-in"><code>NotifySync</code> [in]</h3>

<p>A pointer to an opaque synchronization object for the notify list for the current volume.</p>

<h3 id="notifylist-in"><code>NotifyList</code> [in]</h3>

<p>A pointer to the head of a notify list. Each element in the list is an opaque notify structure.</p>

<h3 id="fscontext-in"><code>FsContext</code> [in]</h3>

<p>A pointer to a unique value assigned by the file system to identify the notify structure to be created as belonging to a particular file object. If a <strong>TraverseCallback</strong> routine is supplied, <strong>FsContext</strong> is passed as the <strong>NotifyContext</strong> parameter to that routine.</p>

<h3 id="fulldirectoryname-in"><code>FullDirectoryName</code> [in]</h3>

<p>A pointer to an ANSI or Unicode string that contains the full name for the directory associated with this notify structure. Ignored if <strong>NotifyIrp</strong> is NULL.</p>

<h3 id="watchtree-in"><code>WatchTree</code> [in]</h3>

<p>Set to TRUE if all subdirectories of this directory should also be watched. Set to FALSE if only the directory itself is to be watched. Ignored if <strong>NotifyIrp</strong> is NULL.</p>

<h3 id="ignorebuffer-in"><code>IgnoreBuffer</code> [in]</h3>

<p>Set to TRUE to ignore any user buffers and force the directory to be reenumerated. This action speeds the operation. Ignored if <strong>NotifyIrp</strong> is NULL.</p>

<h3 id="completionfilter-in"><code>CompletionFilter</code> [in]</h3>

<p>Bitmask of flags that specify the types of changes to files or subdirectories that should cause the queue of pending notify IRPs to be completed. The following table describes the possible flag values.</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="file_notify_change_file_name" title="#define FILE_NOTIFY_CHANGE_FILE_NAME 0x00000001 // winnt">FILE_NOTIFY_CHANGE_FILE_NAME</a> (0x0001)</td>
  <td>A file has been added, deleted, or renamed in this directory.</td>
</tr>
<tr>
  <td><a href="file_notify_change_dir_name" title="#define FILE_NOTIFY_CHANGE_DIR_NAME 0x00000002 // winnt">FILE_NOTIFY_CHANGE_DIR_NAME</a> (0x0002)</td>
  <td>A subdirectory has been created, removed, or renamed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_name" title="#define FILE_NOTIFY_CHANGE_NAME 0x00000003">FILE_NOTIFY_CHANGE_NAME</a> (0x0003)</td>
  <td>This directory's name has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_attributes" title="#define FILE_NOTIFY_CHANGE_ATTRIBUTES 0x00000004 // winnt">FILE_NOTIFY_CHANGE_ATTRIBUTES</a> (0x0004)</td>
  <td>The value of an attribute of this file, such as last access time, has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_size" title="#define FILE_NOTIFY_CHANGE_SIZE 0x00000008 // winnt">FILE_NOTIFY_CHANGE_SIZE</a> (0x0008)</td>
  <td>This file's size has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_last_write" title="#define FILE_NOTIFY_CHANGE_LAST_WRITE 0x00000010 // winnt">FILE_NOTIFY_CHANGE_LAST_WRITE</a> (0x0010)</td>
  <td>This file's last modification time has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_last_access" title="#define FILE_NOTIFY_CHANGE_LAST_ACCESS 0x00000020 // winnt">FILE_NOTIFY_CHANGE_LAST_ACCESS</a> (0x0020)</td>
  <td>This file's last access time has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_creation" title="#define FILE_NOTIFY_CHANGE_CREATION 0x00000040 // winnt">FILE_NOTIFY_CHANGE_CREATION</a> (0x0040)</td>
  <td>This file's creation time has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_ea" title="#define FILE_NOTIFY_CHANGE_EA 0x00000080">FILE_NOTIFY_CHANGE_EA</a> (0x0080)</td>
  <td>This file's extended attributes have been modified.</td>
</tr>
<tr>
  <td><a href="file_notify_change_security" title="#define FILE_NOTIFY_CHANGE_SECURITY 0x00000100 // winnt">FILE_NOTIFY_CHANGE_SECURITY</a> (0x0100)</td>
  <td>This file's security information has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_stream_name" title="#define FILE_NOTIFY_CHANGE_STREAM_NAME 0x00000200">FILE_NOTIFY_CHANGE_STREAM_NAME</a> (0x0200)</td>
  <td>A file stream has been added, deleted, or renamed in this directory.</td>
</tr>
<tr>
  <td><a href="file_notify_change_stream_size" title="#define FILE_NOTIFY_CHANGE_STREAM_SIZE 0x00000400">FILE_NOTIFY_CHANGE_STREAM_SIZE</a> (0x0400)</td>
  <td>This file stream's size has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_stream_write" title="#define FILE_NOTIFY_CHANGE_STREAM_WRITE 0x00000800">FILE_NOTIFY_CHANGE_STREAM_WRITE</a> (0x0800)</td>
  <td>This file stream's data has changed.</td>
</tr>
</tbody>
</table>

<p><strong>CompletionFilter</strong> is ignored if <strong>NotifyIrp</strong> is NULL.</p>

<h3 id="notifyirp-in-optional"><code>NotifyIrp</code> [in, optional]</h3>

<p>A pointer to the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> to complete on notify change. If <strong>NotifyIrp</strong> is NULL, this means that the file stream represented by this file object is being deleted.</p>

<h3 id="traversecallback-in-optional"><code>TraverseCallback</code> [in, optional]</h3>

<p>Optional pointer to a callback routine to be invoked when a change occurs in a subdirectory being watched in a directory tree. This lets the file system check whether the watcher has traverse access to that directory. Such a caller-supplied routine is declared as follows:</p>

<pre><code><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
(*PCHECK_FOR_TRAVERSE_ACCESS) (
    IN PVOID NotifyContext,                     // FsContext
    IN PVOID TargetContext,                     // Context pointer
    IN <a href="security_subject_context" title="typedef struct _SECURITY_SUBJECT_CONTEXT {&#10;  PACCESS_TOKEN                ClientToken;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  PACCESS_TOKEN                PrimaryToken;&#10;  PVOID                        ProcessAuditId;&#10;} SECURITY_SUBJECT_CONTEXT, *PSECURITY_SUBJECT_CONTEXT;">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext // SubjectContext
    );
</code></pre>

<p>For more information about the <strong>TargetContext</strong> parameter, see the <strong>TargetContext</strong> parameter of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullreportchange"><strong>FsRtlNotifyFullReportChange</strong></a>. <strong>TraverseCallback</strong> is ignored if <strong>NotifyIrp</strong> is NULL.</p>

<h3 id="subjectcontext-in-optional"><code>SubjectContext</code> [in, optional]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess#security_subject_context"><strong>SECURITY_SUBJECT_CONTEXT</strong></a> structure to be passed to <strong>TraverseCallback</strong>. <strong>FsRtlNotifyFullChangeDirectory</strong> releases the context and frees the structure after using it. Ignored if <strong>NotifyIrp</strong> is NULL. If a <strong>TraverseCallback</strong> routine is supplied, <strong>SubjectContext</strong> is passed as the <strong>SubjectContext</strong> parameter to that routine.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>FsRtlNotifyFullChangeDirectory</strong> is called by a file system that has received a notify change request. This request is received as an <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> with major function code <a href="irp_mj_directory_control" title="#define IRP_MJ_DIRECTORY_CONTROL 0x0c">IRP_MJ_DIRECTORY_CONTROL</a>, minor function code IRP_MN_NOTIFY_CHANGE_DIRECTORY.</p>

<p>If <strong>NotifyIrp</strong> is NULL, <strong>FsRtlNotifyFullChangeDirectory</strong> checks whether the notify list contains a pending <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> that refers to this file object and, if so, completes it with STATUS_DELETE_PENDING.</p>

<p>If <strong>NotifyIrp</strong> is not NULL, <strong>FsRtlNotifyFullChangeDirectory</strong> does the following:</p>

<ul>
<li><p>Checks whether the file object has undergone cleanup. If so, <strong>FsRtlNotifyFullChangeDirectory</strong> completes the notify <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> with status STATUS_NOTIFY_CLEANUP.</p></li>
<li><p>If the file object has not undergone cleanup, <strong>FsRtlNotifyFullChangeDirectory</strong> checks whether the notify list for this volume already contains a notify structure for this change. If so, <strong>FsRtlNotifyFullChangeDirectory</strong> completes any pending IRPs. If not, <strong>FsRtlNotifyFullChangeDirectory</strong> marks the notify <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> as pending, creates a notify structure, and inserts it into the list.</p></li>
</ul>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullreportchange"><strong>FsRtlNotifyFullReportChange</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-directory-control"><strong>IRP_MJ_DIRECTORY_CONTROL</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess#security_subject_context"><strong>SECURITY_SUBJECT_CONTEXT</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullchangedirectory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullchangedirectory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-rxprocs-fsrtlnotifyfullchangedirectory)</h1>
</div>
<div class="ntdoc-description">
<h1>FsRtlNotifyFullChangeDirectory macro</h1>

<h2>Description</h2>

<p>The <strong>FsRtlNotifyFullChangeDirectory</strong> routine creates a notify structure for a notification request and adds it to the specified notify list.</p>

<h2>Parameters</h2>

<h3><code>A1</code></h3>

<p>A pointer to an opaque synchronization object for the notify list for the current volume.</p>

<h3><code>A2</code></h3>

<p>A pointer to the head of a notify list. Each element in the list is an opaque notify structure.</p>

<h3><code>A3</code></h3>

<p>A pointer to a unique value assigned by the file system to identify the notify structure to be created as belonging to a particular file object. If a <em>TraverseCallback</em> routine is supplied, <em>FsContext</em> is passed as the <em>NotifyContext</em> parameter to that routine.</p>

<h3><code>A4</code></h3>

<p>A pointer to an ANSI or Unicode string that contains the full name for the directory associated with this notify structure. Ignored if <em>NotifyIrp</em> is <strong>NULL</strong>.</p>

<h3><code>A5</code></h3>

<p>Set to <strong>TRUE</strong> if all subdirectories of this directory should also be watched. Set to <strong>FALSE</strong> if only the directory itself is to be watched. Ignored if <em>NotifyIrp</em> is <strong>NULL</strong>.</p>

<h3><code>A6</code></h3>

<p>Set to <strong>TRUE</strong> to ignore any user buffers and force the directory to be reenumerated. This action speeds the operation. Ignored if <em>NotifyIrp</em> is <strong>NULL</strong>.</p>

<h3><code>A7</code></h3>

<p>Bitmask of flags that specify the types of changes to files or subdirectories that should cause the queue of pending notify IRPs to be completed. The possible flag values are described following.</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="file_notify_change_file_name" title="#define FILE_NOTIFY_CHANGE_FILE_NAME 0x00000001 // winnt">FILE_NOTIFY_CHANGE_FILE_NAME</a></td>
  <td>A file has been added, deleted, or renamed in this directory.</td>
</tr>
<tr>
  <td><a href="file_notify_change_dir_name" title="#define FILE_NOTIFY_CHANGE_DIR_NAME 0x00000002 // winnt">FILE_NOTIFY_CHANGE_DIR_NAME</a></td>
  <td>A subdirectory has been created, removed, or renamed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_name" title="#define FILE_NOTIFY_CHANGE_NAME 0x00000003">FILE_NOTIFY_CHANGE_NAME</a></td>
  <td>This directory's name has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_attributes" title="#define FILE_NOTIFY_CHANGE_ATTRIBUTES 0x00000004 // winnt">FILE_NOTIFY_CHANGE_ATTRIBUTES</a></td>
  <td>The value of an attribute of this file, such as last access time, has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_size" title="#define FILE_NOTIFY_CHANGE_SIZE 0x00000008 // winnt">FILE_NOTIFY_CHANGE_SIZE</a></td>
  <td>This file's size has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_last_write" title="#define FILE_NOTIFY_CHANGE_LAST_WRITE 0x00000010 // winnt">FILE_NOTIFY_CHANGE_LAST_WRITE</a></td>
  <td>This file's last modification time has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_last_access" title="#define FILE_NOTIFY_CHANGE_LAST_ACCESS 0x00000020 // winnt">FILE_NOTIFY_CHANGE_LAST_ACCESS</a></td>
  <td>This file's last access time has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_creation" title="#define FILE_NOTIFY_CHANGE_CREATION 0x00000040 // winnt">FILE_NOTIFY_CHANGE_CREATION</a></td>
  <td>This file's creation time has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_ea" title="#define FILE_NOTIFY_CHANGE_EA 0x00000080">FILE_NOTIFY_CHANGE_EA</a></td>
  <td>This file's extended attributes have been modified.</td>
</tr>
<tr>
  <td><a href="file_notify_change_security" title="#define FILE_NOTIFY_CHANGE_SECURITY 0x00000100 // winnt">FILE_NOTIFY_CHANGE_SECURITY</a></td>
  <td>This file's security information has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_stream_name" title="#define FILE_NOTIFY_CHANGE_STREAM_NAME 0x00000200">FILE_NOTIFY_CHANGE_STREAM_NAME</a></td>
  <td>A file stream has been added, deleted, or renamed in this directory.</td>
</tr>
<tr>
  <td><a href="file_notify_change_stream_size" title="#define FILE_NOTIFY_CHANGE_STREAM_SIZE 0x00000400">FILE_NOTIFY_CHANGE_STREAM_SIZE</a></td>
  <td>This file stream's size has changed.</td>
</tr>
<tr>
  <td><a href="file_notify_change_stream_write" title="#define FILE_NOTIFY_CHANGE_STREAM_WRITE 0x00000800">FILE_NOTIFY_CHANGE_STREAM_WRITE</a></td>
  <td>This file stream's data has changed.</td>
</tr>
</tbody>
</table>

<p><em>CompletionFilter</em> is ignored if <em>NotifyIrp</em> is <strong>NULL</strong>.</p>

<h3><code>A8</code></h3>

<p>A pointer to the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> to complete on notify change. If <em>NotifyIrp</em> is <strong>NULL</strong>, this means that the file stream represented by this file object is being deleted.</p>

<h3><code>A9</code></h3>

<p>Optional pointer to a callback routine to be invoked when a change occurs in a subdirectory being watched in a directory tree. This lets the file system check whether the watcher has traverse access to that directory. Such a caller-supplied routine is declared as follows:</p>

<table>
<thead>
<tr>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td><code><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> (*PCHECK_FOR_TRAVERSE_ACCESS) (     IN PVOID NotifyContext,                     // FsContext     IN PVOID TargetContext,                     // Context pointer     IN <a href="security_subject_context" title="typedef struct _SECURITY_SUBJECT_CONTEXT {&#10;  PACCESS_TOKEN                ClientToken;&#10;  SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;&#10;  PACCESS_TOKEN                PrimaryToken;&#10;  PVOID                        ProcessAuditId;&#10;} SECURITY_SUBJECT_CONTEXT, *PSECURITY_SUBJECT_CONTEXT;">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext // SubjectContext     );</code></td>
</tr>
</tbody>
</table>

<p>For more information about the <em>TargetContext</em> parameter, see the <em>TargetContext</em> parameter of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullreportchange"><strong>FsRtlNotifyFullReportChange</strong></a>. <em>TraverseCallback</em> is ignored if <em>NotifyIrp</em> is <strong>NULL</strong>.</p>

<h3><code>A10</code></h3>

<p>A pointer to a context structure to be passed to <em>TraverseCallback</em>. <strong>FsRtlNotifyFullChangeDirectory</strong> releases the context and frees the structure after using it. Ignored if <em>NotifyIrp</em> is <strong>NULL</strong>. If a <em>TraverseCallback</em> routine is supplied, <em>SubjectContext</em> is passed as the <em>SubjectContext</em> parameter to that routine.</p>

<h2>Remarks</h2>

<p><strong>FsRtlNotifyFullChangeDirectory</strong> is called by a file system that has received a notify change request. This request is received as an <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> with major function code <a href="irp_mj_directory_control" title="#define IRP_MJ_DIRECTORY_CONTROL 0x0c">IRP_MJ_DIRECTORY_CONTROL</a>, minor function code IRP_MN_NOTIFY_CHANGE_DIRECTORY.</p>

<p>If <em>NotifyIrp</em> is <strong>NULL</strong>, <strong>FsRtlNotifyFullChangeDirectory</strong> checks whether the notify list contains a pending <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> that refers to this file object and, if so, completes it with STATUS_DELETE_PENDING.</p>

<p>If <em>NotifyIrp</em> is not <strong>NULL</strong>, <strong>FsRtlNotifyFullChangeDirectory</strong> does the following:</p>

<ul>
<li>Checks whether the file object has undergone cleanup. If so, <strong>FsRtlNotifyFullChangeDirectory</strong> completes the notify <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> with status STATUS_NOTIFY_CLEANUP.</li>
<li>If the file object has not undergone cleanup, <strong>FsRtlNotifyFullChangeDirectory</strong> checks whether the notify list for this volume already contains a notify structure for this change. If so, <strong>FsRtlNotifyFullChangeDirectory</strong> completes any pending IRPs. If not, <strong>FsRtlNotifyFullChangeDirectory</strong> marks the notify <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> as pending, creates a notify structure, and inserts it into the list.</li>
</ul>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlnotifyfullreportchange">FsRtlNotifyFullReportChange</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-directory-control">IRP_MJ_DIRECTORY_CONTROL</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">SECURITY_SUBJECT_CONTEXT</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/rxprocs/nf-rxprocs-fsrtlnotifyfullchangedirectory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/rxprocs/nf-rxprocs-fsrtlnotifyfullchangedirectory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
