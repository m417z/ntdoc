<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KeReleaseSemaphore - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KeReleaseSemaphore - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KeReleaseSemaphore - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="long" title="typedef long LONG;">LONG</a> KeReleaseSemaphore(
  [in, out] PRKSEMAPHORE Semaphore,
  [in]      <a href="kpriority" title="typedef LONG KPRIORITY, *PKPRIORITY;">KPRIORITY</a>    Increment,
  [in]      <a href="long" title="typedef long LONG;">LONG</a>         Adjustment,
  [in]      BOOLEAN      Wait
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kereleasesemaphore">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/kereleasesemaphore.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-kereleasesemaphore)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="kereleasesemaphore-function">KeReleaseSemaphore function</h1>

<h2 id="description">Description</h2>

<p>The <strong>KeReleaseSemaphore</strong> routine releases the specified semaphore object.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="semaphore-in-out"><code>Semaphore</code> [in, out]</h3>

<p>A pointer to an initialized semaphore object for which the caller provides the storage.</p>

<h3 id="increment-in"><code>Increment</code> [in]</h3>

<p>Specifies the priority increment to be applied if releasing the semaphore causes a wait to be satisfied.</p>

<h3 id="adjustment-in"><code>Adjustment</code> [in]</h3>

<p>Specifies a value to be added to the current semaphore count. This value must be positive.</p>

<h3 id="wait-in"><code>Wait</code> [in]</h3>

<p>Specifies whether the call to <strong>KeReleaseSemaphore</strong> is to be followed immediately by a call to one of the <strong>KeWait*Xxx</strong>* routines. If <strong>TRUE</strong>, the <strong>KeReleaseSemaphore</strong> call must be followed by a call to <a href="kewaitformultipleobjects" title="NTSTATUS&#10;KeWaitForMultipleObjects (&#10;    ULONG Count,&#10;    PVOID Object[],&#10;    WaitType,&#10;    KWAIT_REASON WaitReason,&#10;    KPROCESSOR_MODE WaitMode,&#10;    BOOLEAN Alertable,&#10;    PLARGE_INTEGER Timeout,&#10;    PKWAIT_BLOCK WaitBlockArray&#10;    );">KeWaitForMultipleObjects</a>, <strong>KeWaitForMutexObject</strong>, or <a href="kewaitforsingleobject" title="NTSTATUS&#10;KeWaitForSingleObject (&#10;    PVOID Object,&#10;    KWAIT_REASON WaitReason,&#10;    KPROCESSOR_MODE WaitMode,&#10;    BOOLEAN Alertable,&#10;    PLARGE_INTEGER Timeout&#10;    );">KeWaitForSingleObject</a>. For more information, see the following Remarks section.</p>

<h2 id="return-value">Return value</h2>

<p>If the return value is zero, the previous state of the semaphore object is not-signaled.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>KeReleaseSemaphore</strong> supplies a run-time priority boost for waiting threads. If this call sets the semaphore to the signaled state, the semaphore count is augmented by the specified value. The caller can also specify whether it will call one of the <strong>KeWait*Xxx</strong>* routines as soon as <strong>KeReleaseSemaphore</strong> returns control.</p>

<p>Releasing a semaphore object causes the semaphore count to be augmented by the value of the <em>Adjustment</em> parameter. If the resulting value is greater than the limit of the semaphore object, the count is not adjusted and an exception, STATUS_SEMAPHORE_LIMIT_EXCEEDED, is raised.</p>

<p>Augmenting the semaphore object count causes the semaphore to attain a signaled state, and an attempt is made to satisfy as many waits as possible on the semaphore object.</p>

<p>The <strong>KeReleaseSemaphore</strong> routine might temporarily raise the IRQL. If the <em>Wait</em> parameter is <strong>FALSE</strong>, the routine, before it returns, restores the IRQL to the original value that it had at the start of the call.</p>

<p>If <em>Wait</em> = <strong>TRUE</strong>, the routine returns without lowering the IRQL. In this case, the <strong>KeReleaseSemaphore</strong> call must be immediately followed by a <strong>KeWait*Xxx</strong>* call. By setting <em>Wait</em> = <strong>TRUE</strong>, the caller can prevent an unnecessary context switch from occurring between the <strong>KeReleaseSemaphore</strong> call and the <strong>KeWait*Xxx</strong>* call. The <strong>KeWait*Xxx</strong>* routine, before it returns, restores the IRQL to its original value at the start of the <strong>KeReleaseSemaphore</strong> call. Although the IRQL disables context switches between the two calls, these calls cannot reliably be used as the start and end of an atomic operation. For example, between these two calls, a thread that is running at the same time on another processor might change the state of the semaphore object or of the target of the wait.</p>

<blockquote>
  <p>[!WARNING]
  A pageable thread or pageable driver routine that runs at IRQL = PASSIVE_LEVEL should never call <strong>KeReleaseSemaphore</strong> with the <em>Wait</em> parameter set to <strong>TRUE</strong>. Such a call causes a fatal page fault if the calling function happens to be paged out between the calls to <strong>KeReleaseSemaphore</strong> and <strong>KeWait*Xxx</strong>*.</p>
</blockquote>

<p>For more information about semaphore objects, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/semaphore-objects">Semaphore Objects</a>.</p>

<p>Callers of <strong>KeReleaseSemaphore</strong> must be running at IRQL &lt;= DISPATCH_LEVEL provided that <em>Wait</em> is set to <strong>FALSE</strong>. Otherwise, the caller must be running at IRQL = PASSIVE_LEVEL.</p>

<h2 id="see-also">See also</h2>

<p><a href="keinitializesemaphore" title="VOID KeInitializeSemaphore(&#10;  [out] PRKSEMAPHORE Semaphore,&#10;  [in]  LONG         Count,&#10;  [in]  LONG         Limit&#10;);">KeInitializeSemaphore</a></p>

<p><a href="kereadstatesemaphore" title="LONG KeReadStateSemaphore(&#10;  [in] PRKSEMAPHORE Semaphore&#10;);">KeReadStateSemaphore</a></p>

<p><a href="kewaitformultipleobjects" title="NTSTATUS&#10;KeWaitForMultipleObjects (&#10;    ULONG Count,&#10;    PVOID Object[],&#10;    WaitType,&#10;    KWAIT_REASON WaitReason,&#10;    KPROCESSOR_MODE WaitMode,&#10;    BOOLEAN Alertable,&#10;    PLARGE_INTEGER Timeout,&#10;    PKWAIT_BLOCK WaitBlockArray&#10;    );">KeWaitForMultipleObjects</a></p>

<p><a href="kewaitforsingleobject" title="NTSTATUS&#10;KeWaitForSingleObject (&#10;    PVOID Object,&#10;    KWAIT_REASON WaitReason,&#10;    KPROCESSOR_MODE WaitMode,&#10;    BOOLEAN Alertable,&#10;    PLARGE_INTEGER Timeout&#10;    );">KeWaitForSingleObject</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kereleasesemaphore">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-kereleasesemaphore.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
