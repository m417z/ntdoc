<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DKMTConnectDoorbell - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DKMTConnectDoorbell - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DKMTConnectDoorbell - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmthk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> D3DKMTConnectDoorbell(
  <a href="d3dkmt_connect_doorbell" title="typedef struct _D3DKMT_CONNECT_DOORBELL {&#10;  D3DKMT_HANDLE                 hDoorbell;&#10;  D3DKMT_CONNECT_DOORBELL_FLAGS Flags;&#10;} D3DKMT_CONNECT_DOORBELL;">D3DKMT_CONNECT_DOORBELL</a> *unnamedParam1
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtconnectdoorbell">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dkmtconnectdoorbell.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-d3dkmthk-d3dkmtconnectdoorbell)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p><strong>D3DKMTConnectDoorbell</strong> connects (or reconnects) a <a rel="noopener" target="_blank" href="d3dkmtcreatedoorbell">previously created doorbell</a> to a hardware queue.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="unnamedparam1"><code>unnamedParam1</code></h3>

<p>[in] Pointer to a <em><a rel="noopener" target="_blank" href="d3dkmt_connect_doorbell"></em>D3DKMT_CONNECT_DOORBELL**</a> structure that describes the doorbell to connect.</p>

<h2 id="return-value">Return value</h2>

<p><strong>D3DKMTConnectDoorbell</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> when the OS successfully connects the doorbell to the hardware queue and UMD can use this doorbell for work submission. Typically this call should not fail; however, a failure code would be from GPU lost or stop kinds of irrecoverable scenarios.</p>

<h2 id="remarks">Remarks</h2>

<p>Each time the UMD submits new work to the hardware queue and rings the doorbell, it must read the <a rel="noopener" target="_blank" href="d3dkmt_create_doorbell"><strong>DoorbellStatusCPUVirtualAddress</strong></a> to check whether the doorbell ring succeeded. On failure, UMD must call <strong>D3DKMTConnectDoorbell</strong> to reconnect the doorbell and then try the submission again.</p>

<p>A doorbell can be disconnected for several reasons:</p>

<ul>
<li>When a <a rel="noopener" target="_blank" href="d3dkmtcreatedoorbell">doorbell is created</a>, the OS initializes it in a "disconnected" state, and only connects it when UMD calls <strong>D3DKMTConnectDoorbell</strong> for the first time.</li>
<li>The doorbell was "victimized" on hardware that supports the dedicated doorbell model. That is, this hardware queue's physical doorbell was assigned to another hardware queue. This reassignment is likely because there are more hardware queues created on the GPU than physical doorbells.</li>
<li>The doorbell was disconnected as a part of suspending the hardware queue or powering down the GPU.</li>
</ul>

<p>When UMD calls <strong>D3DKMTConnectDoorbell</strong> to connect the doorbell assigned to a hardware queue, the OS makes a corresponding <a rel="noopener" target="_blank" href="dxgkddi_createdoorbell"><strong>DxgkDdiConnectDoorbell</strong></a> call to KMD, so that the KMD can find a physical doorbell, assign it to this hardware queue, and make the required connections between the hardware queue, doorbell, GPU scheduler and so forth.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/user-mode-work-submission">User-mode work submission</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="d3dkmt_connect_doorbell"><strong>D3DKMT_CONNECT_DOORBELL</strong></a></p>

<p><a rel="noopener" target="_blank" href="d3dkmt_create_doorbell"><strong>D3DKMTCreateDoorbell</strong></a></p>

<p><a rel="noopener" target="_blank" href="dxgkddi_createdoorbell"><strong>DxgkDdiConnectDoorbell</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtconnectdoorbell">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmthk/nf-d3dkmthk-d3dkmtconnectdoorbell.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
