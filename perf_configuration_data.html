<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PERF_CONFIGURATION_DATA - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PERF_CONFIGURATION_DATA - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PERF_CONFIGURATION_DATA - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// storport.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _PERF_CONFIGURATION_DATA {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Version;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Size;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Flags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           ConcurrentChannels;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           FirstRedirectionMessageNumber;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           LastRedirectionMessageNumber;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           DeviceNode;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Reserved;
  <a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">PGROUP_AFFINITY</a> MessageTargets;
} PERF_CONFIGURATION_DATA, *PPERF_CONFIGURATION_DATA;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/ns-storport-_perf_configuration_data">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/perf_configuration_data.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-storport-_perf_configuration_data)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_PERF_CONFIGURATION_DATA structure</h1>
<h2>Description</h2>
<p>The PERF_CONFIGURATION_DATA structure describes the performance optimizations that are supported by the <a href="storportinitializeperfopts" title="ULONG StorPortInitializePerfOpts(&#10;  [in]      PVOID                    HwDeviceExtension,&#10;  [in]      BOOLEAN                  Query,&#10;  [in, out] PPERF_CONFIGURATION_DATA PerfConfigData&#10;);">StorPortInitializePerfOpts</a> routine.</p>
<h2>Members</h2>
<h3><code>Version</code></h3>
<p>The version number of the structure. Set this member when querying and initializing optimizations.</p>
<h3><code>Size</code></h3>
<p>The size of the structure, set to <strong>sizeof(PERF_CONFIGURATION_DATA)</strong>.</p>
<h3><code>Flags</code></h3>
<p>A bitwise-OR of supported flags. Currently, the following flags are supported:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>STOR_PERF_DPC_REDIRECTION</td>
<td>This flag is used to indicate that DPC processing should be spread out over multiple CPUs.<br><br>This flag is valid when <strong>Version</strong> is set to 2 or 3.</td>
</tr>
<tr>
<td>STOR_PERF_CONCURRENT_CHANNELS</td>
<td>This flag is used to indicate that concurrent calls to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_startio">HwStorStartIo</a> routine are supported. Prior to Windows 8, miniports must not set this flag.<br><br>This flag is valid when <strong>Version</strong> is set to 2 or 3.</td>
</tr>
<tr>
<td>STOR_PERF_INTERRUPT_MESSAGE_RANGES</td>
<td>This flag is used to indicate that interrupt redirection is supported. When you use this flag, you must also set the STOR_PERF_DPC_REDIRECTION flag.<br><br>This flag is valid when <strong>Version</strong> is set to 2 or 3.</td>
</tr>
<tr>
<td>STOR_PERF_ADV_CONFIG_LOCALITY</td>
<td>This flag is used to indicate that you should use the group and mask that pertain to the message group with the correct affinity. When you use this flag, you must also set the STOR_PERF_INTERRUPT_MESSAGE_RANGES and the STOR_PERF_DPC_REDIRECTION flags.<br><br>This flag is valid when <strong>Version</strong> is set to 3.</td>
</tr>
<tr>
<td>STOR_PERF_OPTIMIZE_FOR_COMPLETION_DURING_STARTIO</td>
<td>This flag is used to indicate that the miniport driver will complete I/Os concurrently with the submission of new I/Os. When you use this flag, you must also set the STOR_PERF_DPC_REDIRECTION flag.<br><br>This flag is valid when <strong>Version</strong> is set to 3. See remarks below.</td>
</tr>
<tr>
<td>STOR_PERF_DPC_REDIRECTION_CURRENT_CPU</td>
<td>This flag is used to indicate that you are opting into DPC Redirection (required) but the IO redirection choice is set to the CPU requesting the DPC and not the CPU originating the IO request into Storport.<br><br>When you use this flag, you must also set the STOR_PERF_DPC_REDIRECTION flag.<br><br>This flag is valid when <strong>Version</strong> is set to 4.</td>
</tr>
<tr>
<td>STOR_PERF_NO_SGL</td>
<td>This flag is used to indicate that miniport doesn't need SGLs to be created by storport driver for an IO request buffer. <br><br>This flag is valid when <strong>Version</strong> is set to 5.</td>
</tr>
</tbody>
</table>
<h3><code>ConcurrentChannels</code></h3>
<p>The number of concurrent calls to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_startio">HwStorStartIo</a> routine that the miniport driver and the device support. This member is only accessed when the STOR_PERF_CONCURRENT_CHANNELS flag has been set. Prior to Windows 8, miniports must not set this value.</p>
<h3><code>FirstRedirectionMessageNumber</code></h3>
<p>When the <strong>Flags</strong> member has the STOR_PERF_INTERRUPT_MESSAGE_RANGES flag set, the miniport driver initializes interrupt redirection to begin with this message number. This member is only accessed when the STOR_PERF_INTERRUPT_MESSAGE_RANGES flag is set.</p>
<h3><code>LastRedirectionMessageNumber</code></h3>
<p>When the <strong>Flags</strong> member has the STOR_PERF_INTERRUPT_MESSAGE_RANGES flag set, the miniport driver initializes interrupt redirection to end with this message number. This member is only accessed when the STOR_PERF_INTERRUPT_MESSAGE_RANGES flag is set.</p>
<h3><code>DeviceNode</code></h3>
<p>When the <strong>Flags</strong> member has the STOR_PERF_ADV_CONFIG_LOCALITY flag set, Storport initializes this field to contain the NUMA node number in which the miniport driver's device resides.</p>
<h3><code>Reserved</code></h3>
<p>Reserved for system use.</p>
<h3><code>MessageTargets</code></h3>
<p>When the <strong>Flags</strong> member has the STOR_PERF_ADV_CONFIG_LOCALITY flag set, Storport initializes the fields of in the structures of a <a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">GROUP_AFFINITY</a> array. These structures correspond to the redirection messages that are currently in use. The array itself is zero-based, but <strong>FirstRedirectionMessageNumber</strong> is not required to be zero. The miniport allocates this array and sets <strong>MessageTargets</strong> to point to it. The miniport driver must allocate a <strong><a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">GROUP_AFFINITY</a></strong> array large enough to hold all the returned affinity masks.</p>
<h2>Remarks</h2>
<p>The current version of this structure is defined by <strong>STOR_PERF_VERSION</strong>. Setting <strong>Version</strong> to this value will allow <strong>Flags</strong> to specify all supported optimizations.</p>
<p>The purpose of the STOR_PERF_DPC_REDIRECTION flag is to ensure that individual CPUs are not overwhelmed with DPC processing. When this flag is set, DPC processing is spread over multiple CPUs. If STOR_PERF_DPC_REDIRECTION_CURRENT_CPU is not set, StorPort will attempt to schedule I/O completion DPCs on the same CPU that originated the I/O.</p>
<p>Typically, a miniport completes I/O requests in it's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nc-storport-hw_startio">HwStorStartIo</a> routine and calls <a href="storportnotification" title="STORPORT_API VOID StorPortNotification(&#10;  SCSI_NOTIFICATION_TYPE NotificationType,&#10;  PVOID                  HwDeviceExtension,&#10;  ...                    &#10;);">StorPortNotification</a> with the <strong>RequestComplete</strong> notification type. For processing I/O in this manner, the miniport will leave the STOR_PERF_OPTIMIZE_FOR_COMPLETION_DURING_STARTIO flag set in the <strong>Flags</strong> member allowing Storport to adjust DPC redirection.</p>
<p>For information about enabling message-signaled interrupts for a device, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/enabling-message-signaled-interrupts-in-the-registry">Enabling Message-Signaled Interrupts in the Registry</a>.</p>
<h2>See also</h2>
<p><a href="storportinitializeperfopts" title="ULONG StorPortInitializePerfOpts(&#10;  [in]      PVOID                    HwDeviceExtension,&#10;  [in]      BOOLEAN                  Query,&#10;  [in, out] PPERF_CONFIGURATION_DATA PerfConfigData&#10;);">StorPortInitializePerfOpts</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/ns-storport-_perf_configuration_data">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/storport/ns-storport-_perf_configuration_data.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
