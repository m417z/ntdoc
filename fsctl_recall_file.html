<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FSCTL_RECALL_FILE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FSCTL_RECALL_FILE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FSCTL_RECALL_FILE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0009, 0x045, METHOD_NEITHER, FILE_ANY_ACCESS)
#define FSCTL_RECALL_FILE 0x00090117</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-fsctl_recall_file">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsctl_recall_file.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (ni-winioctl-fsctl_recall_file)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fsctl_recall_file-ioctl">FSCTL_RECALL_FILE IOCTL</h1>

<h2 id="description">Description</h2>

<p>Recalls a file from storage media that Remote Storage manages, which is the hierarchical storage management software.</p>

<p>To recall a file, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function with the following parameters.</p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOL</span><span class="w"> </span><span class="n">DeviceIoControl</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="w"> </span><span class="n">hDevice</span><span class="p">,</span><span class="w">                 </span><span class="c1">// handle to file or directory</span>
<span class="w">  </span><span class="n">FSCTL_RECALL_FILE</span><span class="p">,</span><span class="w">                </span><span class="c1">// dwIoControlCode</span>
<span class="w">  </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                             </span><span class="c1">// lpInBuffer</span>
<span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w">                                </span><span class="c1">// nInBufferSize</span>
<span class="w">  </span><span class="nb">NULL</span><span class="p">,</span><span class="w">                             </span><span class="c1">// lpOutBuffer</span>
<span class="w">  </span><span class="mi">0</span><span class="p">,</span><span class="w">                                </span><span class="c1">// nOutBufferSize</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPDWORD</span><span class="p">)</span><span class="w"> </span><span class="n">lpBytesReturned</span><span class="p">,</span><span class="w">        </span><span class="c1">// number of bytes returned</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPOVERLAPPED</span><span class="p">)</span><span class="w"> </span><span class="n">lpOverlapped</span><span class="w">       </span><span class="c1">// OVERLAPPED structure</span>
<span class="p">);</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<h3 id="input-buffer">Input buffer</h3>

<h3 id="input-buffer-length">Input buffer length</h3>

<h3 id="output-buffer">Output buffer</h3>

<h3 id="output-buffer-length">Output buffer length</h3>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p>Irp->IoStatus.Status is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the request is successful.</p>

<p>Otherwise, Status to the appropriate error condition as a <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> code.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS Values</a>.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>FSCTL_RECALL_FILE</strong> recovers a file from storage, for example, a tape that is managed by Remote Storage. If the file is already cached locally, this operation does nothing. Similarly, if the file has not been moved to remote storage, this operation does nothing.</p>

<p><strong>FSCTL_RECALL_FILE</strong> operates only on systems where Remote Storage is installed. If Remote Storage is not installed, the operation fails and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror">GetLastError</a> returns the error code <strong>ERROR_INVALID_FUNCTION</strong>.</p>

<p>Directories cannot be moved to remote storage. Calling <strong>FSCTL_RECALL_FILE</strong> for a directory fails, and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror">GetLastError</a> returns the error code <strong>ERROR_INVALID_HANDLE</strong>.</p>

<p>Typically, files that are stored on media that is managed by Remote Storage are recalled when an application attempts to make the first access to data. An application that opens a file without immediately accessing the data can speed up the first access by using <strong>FSCTL_RECALL_FILE</strong> immediately after opening the file. However, avoid indiscriminate recall of files that an application does not touch.</p>

<p>Before you call <strong>FSCTL_RECALL_FILE</strong> you do not need to test a file's attributes for the flag <strong>FILE_ATTRIBUTE_OFFLINE</strong> with the function <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fileapi/nf-fileapi-getfileattributesa">GetFileAttributes</a>. The test is unnecessary because an online file is not affected by this operation. However, any operating system call takes processor time. To conserve processor time, call <strong>GetFileAttributes</strong> to check file attributes to determine if <strong>FSCTL_RECALL_FILE</strong> is necessary.</p>

<p>For the implications of overlapped I/O on this operation, see the Remarks section of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol">DeviceIoControl</a> topic.</p>

<p>In Windows 8 and Windows Server 2012, this code is supported by the following technologies.</p>

<table>
<thead>
<tr>
  <th>Technology</th>
  <th>Supported</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Server Message Block (SMB) 3.0 protocol</td>
  <td>No</td>
</tr>
<tr>
  <td>SMB 3.0 Transparent Failover (TFO)</td>
  <td>No</td>
</tr>
<tr>
  <td>SMB 3.0 with Scale-out File Shares (SO)</td>
  <td>No</td>
</tr>
<tr>
  <td>Cluster Shared Volume File System (CsvFS)</td>
  <td>No</td>
</tr>
<tr>
  <td>Resilient File System (ReFS)</td>
  <td>Yes</td>
</tr>
</tbody>
</table>

<h4 id="examples">Examples</h4>

<p>The following code example is a command-line utility that recalls one or more files indicated on the command line from remote storage.</p>

<div class="codehilite">
<pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Windows.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;malloc.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;WinIoCtl.h&gt;</span>

<span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="w"> </span><span class="nf">RecallFile</span><span class="p">(</span><span class="n">PTCHAR</span><span class="w"> </span><span class="n">FileName</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="n">_cdecl</span><span class="w"> </span><span class="nf">_tmain</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">TCHAR</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="w">  </span><span class="n"><a href="long" title="typedef long LONG;">LONG</a></span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: recall &lt;file-name1&gt; &lt;file-name2&gt; ...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">argc</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">RecallFile</span><span class="p">((</span><span class="n">PTCHAR</span><span class="p">)</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="w"> </span><span class="nf">RecallFile</span><span class="p">(</span><span class="n">IN</span><span class="w"> </span><span class="n">PTCHAR</span><span class="w"> </span><span class="n">FileName</span><span class="p">)</span>
<span class="w">  </span><span class="cm">/*++</span>
<span class="cm">Routine Description</span>
<span class="cm">    Recalls the file with the supplied path.</span>
<span class="cm">Arguments</span>
<span class="cm">    FileName - Path of the file to be recalled</span>
<span class="cm">Return Value</span>
<span class="cm">    0                   - Recall is successful.</span>
<span class="cm">    Any other value     - Error code for the operation.</span>

<span class="cm">--*/</span>

<span class="p">{</span>
<span class="w">  </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">fileHandle</span><span class="p">;</span>
<span class="w">  </span><span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="w">  </span><span class="n">nbytes</span><span class="p">;</span>
<span class="w">  </span><span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="w">  </span><span class="n">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="n">fileHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateFile</span><span class="p">((</span><span class="n">LPCTSTR</span><span class="p">)</span><span class="w"> </span><span class="n">FileName</span><span class="p">,</span>
<span class="w">                          </span><span class="n">GENERIC_READ</span><span class="p">,</span>
<span class="w">                          </span><span class="n"><a href="file_share_read" title="#define FILE_SHARE_READ 0x00000001">FILE_SHARE_READ</a></span><span class="p">,</span>
<span class="w">                          </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">                          </span><span class="n">OPEN_EXISTING</span><span class="p">,</span>
<span class="w">                          </span><span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span>
<span class="w">                          </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileHandle</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">INVALID_HANDLE_VALUE</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetLastError</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t open file %s: error %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FileName</span><span class="p">,</span>
<span class="w">           </span><span class="n">errorCode</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">errorCode</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">DeviceIoControl</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">,</span>
<span class="w">                       </span><span class="n">FSCTL_RECALL_FILE</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">                       </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">NULL</span><span class="p">,</span>
<span class="w">                       </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                       </span><span class="o">&amp;</span><span class="n">nbytes</span><span class="p">,</span>
<span class="w">                       </span><span class="nb">NULL</span><span class="p">))</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">errorCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetLastError</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t recall file %s: error %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">           </span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">errorCode</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">CloseHandle</span><span class="p">(</span><span class="n">fileHandle</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">errorCode</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fileapi/nf-fileapi-createfilea">CreateFile</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol">DeviceIoControl</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/FileIO/file-management-control-codes">File Management Control Codes</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fileapi/nf-fileapi-getfileattributesa">GetFileAttributes</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/minwinbase/ns-minwinbase-overlapped">OVERLAPPED</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-fsctl_recall_file">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winioctl/ni-winioctl-fsctl_recall_file.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
