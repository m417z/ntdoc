<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="CcMapData - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>CcMapData - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            CcMapData - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">BOOLEAN CcMapData(
  [in]  <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a>   FileObject,
  [in]  PLARGE_INTEGER FileOffset,
  [in]  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>          Length,
  [in]  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>          Flags,
  [out] PVOID          *Bcb,
  [out] PVOID          *Buffer
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ccmapdata">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ccmapdata.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-ccmapdata)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>CcMapData function</h1>
<h2>Description</h2>
<p>The <strong>CcMapData</strong> routine maps a specified byte range of a cached file to a buffer in memory.</p>
<h2>Parameters</h2>
<h3><code>FileObject</code> [in]</h3>
<p>Pointer to a file object for the file whose data is to be mapped for read access.</p>
<h3><code>FileOffset</code> [in]</h3>
<p>Pointer to a variable that specifies the starting byte offset within the cached file where the desired data resides.</p>
<h3><code>Length</code> [in]</h3>
<p>Length of desired data in bytes.</p>
<h3><code>Flags</code> [in]</h3>
<p>Bitmask of flags specifying how the mapping operation is to be performed. This is a bitwise OR combination of one or more of the following values:</p>
<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>MAP_WAIT</td>
  <td>The caller can be put into a wait state until the data has been mapped.</td>
</tr>
<tr>
  <td>MAP_NO_READ</td>
  <td>Only pages that are already resident in memory are to be mapped.</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong> In Windows 2000and earlier, this parameter was a BOOLEAN value named <em>Wait</em>:</p>
<h4>Wait</h4>
<p>Set to <strong>TRUE</strong> if the caller can be put into a wait state until the data has been mapped, <strong>FALSE</strong> otherwise.</p>
<h3><code>Bcb</code> [out]</h3>
<p>On the first call this returns a pointer to a buffer control block (BCB) structure. This pointer must be supplied as input on all subsequent calls, for this buffer.</p>
<h3><code>Buffer</code> [out]</h3>
<p>Pointer to a buffer containing the mapped data.</p>
<h2>Return value</h2>
<p><strong>CcMapData</strong> returns <strong>TRUE</strong> if the data for the cached file was mapped successfully, <strong>FALSE</strong> otherwise.</p>
<h2>Remarks</h2>
<p><strong>CcMapData</strong> maps data in a cached file for read access. Note that after <strong>CcMapData</strong> is called, the data is mapped; but it is not pinned. This distinction is important. Data that is mapped but not pinned cannot safely be modified. To pin the data, use <a href="ccpinmappeddata" title="BOOLEAN CcPinMappedData(&#10;  [in]      PFILE_OBJECT   FileObject,&#10;  [in]      PLARGE_INTEGER FileOffset,&#10;  [in]      ULONG          Length,&#10;  [in]      ULONG          Flags,&#10;  [in, out] PVOID          *Bcb&#10;);">CcPinMappedData</a>, <a href="ccpinread" title="BOOLEAN CcPinRead(&#10;  [in]  PFILE_OBJECT   FileObject,&#10;  [in]  PLARGE_INTEGER FileOffset,&#10;  [in]  ULONG          Length,&#10;  [in]  ULONG          Flags,&#10;  [out] PVOID          *Bcb,&#10;  [out] PVOID          *Buffer&#10;);">CcPinRead</a>, or <a href="ccpreparepinwrite" title="BOOLEAN CcPreparePinWrite(&#10;  [in]  PFILE_OBJECT   FileObject,&#10;  [in]  PLARGE_INTEGER FileOffset,&#10;  [in]  ULONG          Length,&#10;  [in]  BOOLEAN        Zero,&#10;  [in]  ULONG          Flags,&#10;  [out] PVOID          *Bcb,&#10;  [out] PVOID          *Buffer&#10;);">CcPreparePinWrite</a>.</p>
<p>Every successful call to <strong>CcMapData</strong> must be matched by a subsequent call to <a href="ccunpindata" title="VOID CcUnpinData(&#10;  [in] PVOID Bcb&#10;);">CcUnpinData</a>.</p>
<p><strong>CcMapData</strong> cannot map data across view boundaries in the cache manager. The cache manager manages files in the system in 256 KB-aligned views. (The cache manager's view size is specified by the system-defined constant <strong>VACB_MAPPING_GRANULARITY</strong>, which is set to 256 KB in <em>ntifs.h</em>.) Mapped regions cannot span more than one 256 KB view. Therefore, the largest region that can be mapped is 256 KB, beginning at a 256 KB-aligned offset in the file.</p>
<p>Mapping a byte range in a cached file does not ensure that the pages remain resident in memory. As long as the pages are mapped, the byte range is guaranteed to stay mapped into the system cache virtual address space, but the memory manager can page out the physical pages as the system's memory demand requires.</p>
<p>If the <strong>MAP_WAIT</strong> flag is set (or <em>Wait</em> is <strong>TRUE</strong>), <strong>CcMapData</strong> is guaranteed to complete the mapping request and return <strong>TRUE</strong>. If the required pages of the cached file are already resident in memory, the data is mapped immediately and no blocking will occur. If any needed pages are not resident, the caller is put in a wait state until all required pages have been made resident and the data can be mapped. If the <strong>MAP_WAIT</strong> flag is not set (or <em>Wait</em> is <strong>FALSE</strong>) and the data cannot be mapped immediately, <strong>CcMapData</strong> returns <strong>FALSE</strong>.</p>
<p>The pointer returned in <em>Buffer</em> is valid until <a href="ccunpindata" title="VOID CcUnpinData(&#10;  [in] PVOID Bcb&#10;);">CcUnpinData</a> is called. If <a href="ccpinmappeddata" title="BOOLEAN CcPinMappedData(&#10;  [in]      PFILE_OBJECT   FileObject,&#10;  [in]      PLARGE_INTEGER FileOffset,&#10;  [in]      ULONG          Length,&#10;  [in]      ULONG          Flags,&#10;  [in, out] PVOID          *Bcb&#10;);">CcPinMappedData</a> is called while this pointer is still valid, the pointer remains valid after the call to <strong><a href="ccpinmappeddata" title="BOOLEAN CcPinMappedData(&#10;  [in]      PFILE_OBJECT   FileObject,&#10;  [in]      PLARGE_INTEGER FileOffset,&#10;  [in]      ULONG          Length,&#10;  [in]      ULONG          Flags,&#10;  [in, out] PVOID          *Bcb&#10;);">CcPinMappedData</a></strong> (but only until <strong><a href="ccunpindata" title="VOID CcUnpinData(&#10;  [in] PVOID Bcb&#10;);">CcUnpinData</a></strong> is called).</p>
<p>If any failure occurs, <strong>CcMapData</strong> raises a status exception for that particular failure. For example, if a pool allocation failure occurs, <strong>CcMapData</strong> raises a <strong>STATUS_INSUFFICIENT_RESOURCES</strong> exception; if an I/O error occurs, <strong>CcMapData</strong> raises the status exception of the I/O error. Therefore, to gain control if a failure occurs, the driver should wrap the call to <strong>CcMapData</strong> in a <strong>try-except</strong> or <strong>try-finally</strong> statement.</p>
<p>To cache a file, use <a href="ccinitializecachemap" title="VOID CcInitializeCacheMap(&#10;  [in] PFILE_OBJECT             FileObject,&#10;  [in] PCC_FILE_SIZES           FileSizes,&#10;  [in] BOOLEAN                  PinAccess,&#10;  [in] PCACHE_MANAGER_CALLBACKS Callbacks,&#10;  [in] PVOID                    LazyWriteContext&#10;);">CcInitializeCacheMap</a>.</p>
<h2>See also</h2>
<p><a href="ccinitializecachemap" title="VOID CcInitializeCacheMap(&#10;  [in] PFILE_OBJECT             FileObject,&#10;  [in] PCC_FILE_SIZES           FileSizes,&#10;  [in] BOOLEAN                  PinAccess,&#10;  [in] PCACHE_MANAGER_CALLBACKS Callbacks,&#10;  [in] PVOID                    LazyWriteContext&#10;);">CcInitializeCacheMap</a></p>
<p><a href="ccpinmappeddata" title="BOOLEAN CcPinMappedData(&#10;  [in]      PFILE_OBJECT   FileObject,&#10;  [in]      PLARGE_INTEGER FileOffset,&#10;  [in]      ULONG          Length,&#10;  [in]      ULONG          Flags,&#10;  [in, out] PVOID          *Bcb&#10;);">CcPinMappedData</a></p>
<p><a href="ccpinread" title="BOOLEAN CcPinRead(&#10;  [in]  PFILE_OBJECT   FileObject,&#10;  [in]  PLARGE_INTEGER FileOffset,&#10;  [in]  ULONG          Length,&#10;  [in]  ULONG          Flags,&#10;  [out] PVOID          *Bcb,&#10;  [out] PVOID          *Buffer&#10;);">CcPinRead</a></p>
<p><a href="ccpreparepinwrite" title="BOOLEAN CcPreparePinWrite(&#10;  [in]  PFILE_OBJECT   FileObject,&#10;  [in]  PLARGE_INTEGER FileOffset,&#10;  [in]  ULONG          Length,&#10;  [in]  BOOLEAN        Zero,&#10;  [in]  ULONG          Flags,&#10;  [out] PVOID          *Bcb,&#10;  [out] PVOID          *Buffer&#10;);">CcPreparePinWrite</a></p>
<p><a href="ccunpindata" title="VOID CcUnpinData(&#10;  [in] PVOID Bcb&#10;);">CcUnpinData</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ccmapdata">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-ccmapdata.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
