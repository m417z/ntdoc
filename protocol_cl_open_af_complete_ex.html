<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PROTOCOL_CL_OPEN_AF_COMPLETE_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PROTOCOL_CL_OPEN_AF_COMPLETE_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PROTOCOL_CL_OPEN_AF_COMPLETE_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PROTOCOL_CL_OPEN_AF_COMPLETE_EX ProtocolClOpenAfCompleteEx;

VOID ProtocolClOpenAfCompleteEx(
  [in] NDIS_HANDLE ProtocolAfContext,
  [in] NDIS_HANDLE NdisAfHandle,
  [in] NDIS_STATUS Status
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_open_af_complete_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/protocol_cl_open_af_complete_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-protocol_cl_open_af_complete_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="protocol_cl_open_af_complete_ex-callback-function">PROTOCOL_CL_OPEN_AF_COMPLETE_EX callback function</h1>

<h2 id="description">Description</h2>

<p>The
<em>ProtocolClOpenAfCompleteEx</em> function completes the opening of an address family (AF) that was started
when a CoNDIS client called the
<a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a> function.</p>

<p><strong>Note</strong> You must declare the function by using the <strong>PROTOCOL_CL_OPEN_AF_COMPLETE_EX</strong> type.
For more information, see the following Examples section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="protocolafcontext-in"><code>ProtocolAfContext</code> [in]</h3>

<p>A client-supplied handle to its context area for an address AF. The client allocated this context
area and passed this handle to NDIS in its call to the
<a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a> function.</p>

<h3 id="ndisafhandle-in"><code>NdisAfHandle</code> [in]</h3>

<p>An NDIS-supplied handle to an AF, if
<em>Status</em> is NDIS_STATUS_SUCCESS. Otherwise, this parameter is <strong>NULL</strong>. This handle represents an
association that NDIS established between the client and a call manager that is bound to a CoNDIS
miniport adapter. If the handle is not <strong>NULL</strong>, the client must save the handle for use in subsequent calls
to
<strong>NdisCl<em>Xxx</em></strong> and
<strong>NdisCo<em>Xxx</em></strong> functions.</p>

<h3 id="status-in"><code>Status</code> [in]</h3>

<p>The final status of the client's call to
<strong><a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a></strong>, which can be any of the following:</p>

<h4 id="ndis_status_success">NDIS_STATUS_SUCCESS</h4>

<p>The AF has been opened, so the client can initialize its state at
<em>ProtocolAfContext</em> and use the returned handle from
<em>NdisAfHandle</em> in subsequent calls to
<strong>NdisCl<em>Xxx</em></strong> and
<strong>NdisCo<em>Xxx</em></strong> functions, such as
<a href="ndiscooidrequest" title="NDIS_STATUS NdisCoOidRequest(&#10;  [in]           NDIS_HANDLE       NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE       NdisAfHandle,&#10;  [in, optional] NDIS_HANDLE       NdisVcHandle,&#10;  [in, optional] NDIS_HANDLE       NdisPartyHandle,&#10;  [in, out]      PNDIS_OID_REQUEST OidRequest&#10;);">NdisCoOidRequest</a>.</p>

<h4 id="ndis_status_resources">NDIS_STATUS_RESOURCES</h4>

<p>The requested operation failed because NDIS or the call manager could not allocate sufficient
memory or initialize the state that one of them uses to track the client's open of the AF that
<em>ProtocolAfContext</em> specifies.</p>

<h4 id="ndis_status_failure">NDIS_STATUS_FAILURE</h4>

<p>NDIS failed the call, possibly for one of the following reasons:</p>

<ul>
<li>The given AF does not match any AF that was registered for the underlying miniport driver to
which the caller is bound.</li>
<li>The caller's adapter binding is closing.</li>
<li>The call manager that registered the specified AF is closing its binding to the underlying
miniport adapter.</li>
</ul>

<h2 id="remarks">Remarks</h2>

<p>The
<em>ProtocolClOpenAfCompleteEx</em> function is required for CoNDIS clients. CoNDIS clients must provide
<em>ProtocolClOpenAfCompleteEx</em> to complete the asynchronous operations that the clients initiate by
calling the
<a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a> function.</p>

<p>NDIS calls
<em>ProtocolClOpenAfCompleteEx</em> to indicate that some or all of the following have occurred:</p>

<ul>
<li>If all of the parameters that the client's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_af_register_notify">ProtocolCoAfRegisterNotify</a> function passed to the
<strong><a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a></strong> function were valid, NDIS called the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_open_af">ProtocolCmOpenAf</a> function of the
call manager that just registered the specified AF with NDIS.</li>
<li>The call manager has examined the specification that the client's
<em>ProtocolCoAfRegisterNotify</em> function passed to
<strong><a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a></strong> at the
<em>AddressFamily</em> parameter and returned whether it was valid for this call manager to NDIS.</li>
</ul>

<p>If the client's attempt to open an AF fails, NDIS cleans up its saved state before calling
<em>ProtocolClOpenAfCompleteEx</em>. In this case,
<em>ProtocolClOpenAfCompleteEx</em> can release the resources that the client allocated for its call to
<a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a> or
prepare them for reuse.</p>

<p>Otherwise,
<em>ProtocolClOpenAfCompleteEx</em> should set up whatever client-determined state the client will need for
subsequent operations on the newly opened AF. In particular, the client must save the handle from the
<em>NdisAfHandle</em> parameter, typically in the client's
<em>ProtocolAfContext</em> context area.</p>

<p>If the client accepts incoming calls, it might allocate a per-service access point (SAP) state area
and call the
<a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a> function. If the
client makes outgoing calls, it might allocate a per-virtual connection (VC) state area and create a VC
with the
<a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a> function to prepare for an
incoming request from one of the client's own clients to make an outgoing call to a remote node.</p>

<p>NDIS calls
<em>ProtocolClOpenAfCompleteEx</em> at IRQL = PASSIVE_LEVEL.</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>ProtocolClOpenAfCompleteEx</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>ProtocolClOpenAfCompleteEx</em> function that is named "MyClOpenAfCompleteEx", use the <strong>PROTOCOL_CL_OPEN_AF_COMPLETE_EX</strong> type as shown in this code example:</p>

<pre><code>PROTOCOL_CL_OPEN_AF_COMPLETE_EX MyClOpenAfCompleteEx;
</code></pre>

<p>Then, implement your function as follows:</p>

<pre><code>_Use_decl_annotations_
VOID
 MyClOpenAfCompleteEx(
    NDIS_HANDLE  ProtocolAfContext,
    NDIS_HANDLE  NdisAfHandle,
    NDIS_STATUS  Status
    )
  {...}
</code></pre>

<p>The <strong>PROTOCOL_CL_OPEN_AF_COMPLETE_EX</strong> function type is defined in the Ndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the _Use_decl_annotations_ annotation to your function definition. The _Use_decl_annotations_ annotation ensures that the annotations that are applied to the <strong>PROTOCOL_CL_OPEN_AF_COMPLETE_EX</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about _Use_decl_annotations_, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a></p>

<p><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></p>

<p><a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a></p>

<p><a href="ndiscooidrequest" title="NDIS_STATUS NdisCoOidRequest(&#10;  [in]           NDIS_HANDLE       NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE       NdisAfHandle,&#10;  [in, optional] NDIS_HANDLE       NdisVcHandle,&#10;  [in, optional] NDIS_HANDLE       NdisPartyHandle,&#10;  [in, out]      PNDIS_OID_REQUEST OidRequest&#10;);">NdisCoOidRequest</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_open_af">ProtocolCmOpenAf</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_af_register_notify">ProtocolCoAfRegisterNotify</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_open_af_complete_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-protocol_cl_open_af_complete_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
