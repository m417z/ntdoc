<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PCONVERTSTREAMTOTREE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PCONVERTSTREAMTOTREE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PCONVERTSTREAMTOTREE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// bthsdpddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PCONVERTSTREAMTOTREE Pconvertstreamtotree;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Pconvertstreamtotree(
  PUCHAR Stream,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Size,
  <a href="sdp_tree_root_node" title="typedef struct _SDP_TREE_ROOT_NODE {&#10;  SDP_NODE RootNode;&#10;} SDP_TREE_ROOT_NODE, *PSDP_TREE_ROOT_NODE;">PSDP_TREE_ROOT_NODE</a> *Node,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> tag
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthsdpddi/nc-bthsdpddi-pconvertstreamtotree">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pconvertstreamtotree.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-bthsdpddi-pconvertstreamtotree)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pconvertstreamtotree-callback-function">PCONVERTSTREAMTOTREE callback function</h1>

<h2 id="description">Description</h2>

<p>The Bluetooth
<strong>SdpConvertStreamToTree</strong> function is used to create a Microsoft proprietary tree-based representation
of an SDP record, while leaving the original stream-based representation unmodified.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="stream"><code>Stream</code></h3>

<p>The SDP record stream to convert into a tree-based representation.</p>

<h3 id="size"><code>Size</code></h3>

<p>The size of the source SDP record stream.</p>

<h3 id="node"><code>Node</code></h3>

<p>A pointer to the
<a href="sdp_tree_root_node" title="typedef struct _SDP_TREE_ROOT_NODE {&#10;  SDP_NODE RootNode;&#10;} SDP_TREE_ROOT_NODE, *PSDP_TREE_ROOT_NODE;">SDP_TREE_ROOT_NODE</a> structure that serves
as the root of the SDP tree-based representation of the SDP record.</p>

<h3 id="tag"><code>tag</code></h3>

<p>Specifies a 4-byte
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/">pool tag</a> that uniquely identifies the driver that does the memory
allocation. For more information about pool tags, see
<a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a>.</p>

<h2 id="return-value">Return value</h2>

<p>Possible return values include:</p>

<p><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></p>

<p>STATUS_INSUFFICIENT_RESOURCES</p>

<p>STATUS_INVALID_PARAMETER</p>

<h2 id="remarks">Remarks</h2>

<p>Because a tree can be traversed by evaluating pointers, the
<strong>SdpConvertStreamToTree</strong> function can make it easier for profile drivers to extract information from
an SDP record.</p>

<p>The tree representation of the SDP record that results from calling the
<strong>SdpConvertStreamToTree</strong> function consists of a series of interconnected
<a href="sdp_node" title="typedef struct _SDP_NODE {&#10;  SDP_NODE_HEADER hdr;&#10;  ULONG           DataSize;&#10;  SDP_NODE_DATA   u;&#10;  PVOID           Reserved;&#10;} SDP_NODE, *PSDP_NODE;">SDP_NODE</a> structures. The root node contains a single
<a href="sdp_tree_root_node" title="typedef struct _SDP_TREE_ROOT_NODE {&#10;  SDP_NODE RootNode;&#10;} SDP_TREE_ROOT_NODE, *PSDP_TREE_ROOT_NODE;">SDP_TREE_ROOT_NODE</a> structure.</p>

<p>Each <a href="sdp_node" title="typedef struct _SDP_NODE {&#10;  SDP_NODE_HEADER hdr;&#10;  ULONG           DataSize;&#10;  SDP_NODE_DATA   u;&#10;  PVOID           Reserved;&#10;} SDP_NODE, *PSDP_NODE;">SDP_NODE</a> structure contains an
<a href="sdp_node_header" title="typedef struct _SDP_NODE_HEADER {&#10;  LIST_ENTRY Link;&#10;  USHORT     Type;&#10;  USHORT     SpecificType;&#10;} SDP_NODE_HEADER, *PSDP_NODE_HEADER;">SDP_NODE_HEADER</a> structure and an
<a href="sdp_node_data" title="typedef union _SDP_NODE_DATA {&#10;  SDP_LARGE_INTEGER_16  int128;&#10;  SDP_ULARGE_INTEGER_16 uint128;&#10;  GUID                  uuid128;&#10;  ULONG                 uuid32;&#10;  USHORT                uuid16;&#10;  LONGLONG              int64;&#10;  ULONGLONG             uint64;&#10;  LONG                  int32;&#10;  ULONG                 uint32;&#10;  SHORT                 int16;&#10;  USHORT                uint16;&#10;  CHAR                  int8;&#10;  UCHAR                 uint8;&#10;  SDP_BOOLEAN           boolean;&#10;  PCHAR                 string;&#10;  PCHAR                 url;&#10;  SDP_NODE_HEADER       sequence;&#10;  SDP_NODE_HEADER       alternative;&#10;  ISdpNodeContainer     *container;&#10;...">SDP_NODE_DATA</a> union. The header specifies the
type of data, and Bluetooth profile drivers can access links to peer <a href="sdp_node" title="typedef struct _SDP_NODE {&#10;  SDP_NODE_HEADER hdr;&#10;  ULONG           DataSize;&#10;  SDP_NODE_DATA   u;&#10;  PVOID           Reserved;&#10;} SDP_NODE, *PSDP_NODE;">SDP_NODE</a> structures through the
<a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> system structure. By evaluating this
structure's
<code>Node.hdr.Link.Flink</code>and
<code>Node.hdr.Link.Blink</code>, drivers can obtain the addresses of peer
nodes in the tree. Keep in mind that the pointers in the <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> structure hold addresses to other
<a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> structures, and that Bluetooth drivers must use the
<strong><a href="containing_record" title="#define CONTAINING_RECORD(address, type, field) \&#10;    ((type *)((ULONG_PTR)(address) - UFIELD_OFFSET(type, field)))">CONTAINING_RECORD</a></strong> memory manager macro to
extract the address of the containing node record.</p>

<p>By using the
<a href="sdp_node_data" title="typedef union _SDP_NODE_DATA {&#10;  SDP_LARGE_INTEGER_16  int128;&#10;  SDP_ULARGE_INTEGER_16 uint128;&#10;  GUID                  uuid128;&#10;  ULONG                 uuid32;&#10;  USHORT                uuid16;&#10;  LONGLONG              int64;&#10;  ULONGLONG             uint64;&#10;  LONG                  int32;&#10;  ULONG                 uint32;&#10;  SHORT                 int16;&#10;  USHORT                uint16;&#10;  CHAR                  int8;&#10;  UCHAR                 uint8;&#10;  SDP_BOOLEAN           boolean;&#10;  PCHAR                 string;&#10;  PCHAR                 url;&#10;  SDP_NODE_HEADER       sequence;&#10;  SDP_NODE_HEADER       alternative;&#10;  ISdpNodeContainer     *container;&#10;...">SDP_NODE_DATA</a> union's
<strong>sequence</strong> and
<strong>alternative</strong> members, profile drivers can access sub-elements of the tree. If the data type of the
node is
<strong>SDP_TYPE_SEQUENCE</strong>, the node is an SDP sequence. If the data type of the node is
<strong>SDP_TYPE_ALTERNATIVE</strong>, the node is an SDP alternative sequence. In the first case, the sequence
member is valid and contains the information necessary to access the portion of the tree corresponding
with the sequence. In the second case, the alternative member is valid and contains the information
necessary to access the portion of the tree corresponding to the alternative. The
<strong>sequence</strong> or
<strong>alternative</strong> member, when used, contains an extra <a href="sdp_node_header" title="typedef struct _SDP_NODE_HEADER {&#10;  LIST_ENTRY Link;&#10;  USHORT     Type;&#10;  USHORT     SpecificType;&#10;} SDP_NODE_HEADER, *PSDP_NODE_HEADER;">SDP_NODE_HEADER</a> structure that is used to access
the nodes in the sequence or alternative. For example,
<code>node-&gt;u.sequence.Flink</code>points to the <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> structure of
the first member of the sequence represented by the node.</p>

<p>The remaining members of the data union contain actual data extracted from the SDP stream. For most
types, the data is directly present in the structure. However, for strings and URLs, a pointer is
provided to the actual data. The memory for the string is allocated by the
<strong>SdpConvertStreamToTree</strong> function call and must be freed by calling the
<a href="sdpfreetree" title="NTSTATUS SdpFreeTree(&#10;  [in] PSDP_TREE_ROOT_NODE Tree&#10;);">SdpFreeTree</a> function for the tree.</p>

<p>Bluetooth profile drivers can obtain a pointer to this function through the
<a href="bthddi_sdp_parse_interface" title="typedef struct _BTHDDI_SDP_PARSE_INTERFACE {&#10;  INTERFACE            Interface;&#10;  PVALIDATESTREAM      SdpValidateStream;&#10;  PCONVERTSTREAMTOTREE SdpConvertStreamToTree;&#10;  PCONVERTTREETOSTREAM SdpConvertTreeToStream;&#10;  PFREETREE            SdpFreeTree;&#10;  PBYTESWAPUUID128     SdpByteSwapUuid128;&#10;  PBYTESWAPUINT128     SdpByteSwapUint128;&#10;  PBYTESWAPUINT64      SdpByteSwapUint64;&#10;  PRETRIEVEUUID128     SdpRetrieveUuid128;&#10;  PRETRIEVEUINT128     SdpRetrieveUint128;&#10;  PRETRIEVEUINT64      SdpRetrieveUint64;&#10;  PFINDATTRIBUTEINTREE SdpFindAttributeInTree;&#10;  PGETNEXTELEMENT      SdpGetNextElement;&#10;  pReservedFunction    Reserved1;&#10;  pReservedFunction    Reserved2;&#10;  pReservedFunction    Reserved3;&#10;  pReservedFunction    Reserved4;&#10;} BTHDDI_SDP_PARSE_INTERFACE, *PBTHDDI_SDP_PARSE_INTERFACE;">BTHDDI_SDP_PARSE_INTERFACE</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="bthddi_sdp_parse_interface" title="typedef struct _BTHDDI_SDP_PARSE_INTERFACE {&#10;  INTERFACE            Interface;&#10;  PVALIDATESTREAM      SdpValidateStream;&#10;  PCONVERTSTREAMTOTREE SdpConvertStreamToTree;&#10;  PCONVERTTREETOSTREAM SdpConvertTreeToStream;&#10;  PFREETREE            SdpFreeTree;&#10;  PBYTESWAPUUID128     SdpByteSwapUuid128;&#10;  PBYTESWAPUINT128     SdpByteSwapUint128;&#10;  PBYTESWAPUINT64      SdpByteSwapUint64;&#10;  PRETRIEVEUUID128     SdpRetrieveUuid128;&#10;  PRETRIEVEUINT128     SdpRetrieveUint128;&#10;  PRETRIEVEUINT64      SdpRetrieveUint64;&#10;  PFINDATTRIBUTEINTREE SdpFindAttributeInTree;&#10;  PGETNEXTELEMENT      SdpGetNextElement;&#10;  pReservedFunction    Reserved1;&#10;  pReservedFunction    Reserved2;&#10;  pReservedFunction    Reserved3;&#10;  pReservedFunction    Reserved4;&#10;} BTHDDI_SDP_PARSE_INTERFACE, *PBTHDDI_SDP_PARSE_INTERFACE;">BTHDDI_SDP_PARSE_INTERFACE</a></p>

<p><strong><a href="containing_record" title="#define CONTAINING_RECORD(address, type, field) \&#10;    ((type *)((ULONG_PTR)(address) - UFIELD_OFFSET(type, field)))">CONTAINING_RECORD</a></strong></p>

<p><a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a></p>

<p><a href="sdp_node" title="typedef struct _SDP_NODE {&#10;  SDP_NODE_HEADER hdr;&#10;  ULONG           DataSize;&#10;  SDP_NODE_DATA   u;&#10;  PVOID           Reserved;&#10;} SDP_NODE, *PSDP_NODE;">SDP_NODE</a></p>

<p><a href="sdp_node_data" title="typedef union _SDP_NODE_DATA {&#10;  SDP_LARGE_INTEGER_16  int128;&#10;  SDP_ULARGE_INTEGER_16 uint128;&#10;  GUID                  uuid128;&#10;  ULONG                 uuid32;&#10;  USHORT                uuid16;&#10;  LONGLONG              int64;&#10;  ULONGLONG             uint64;&#10;  LONG                  int32;&#10;  ULONG                 uint32;&#10;  SHORT                 int16;&#10;  USHORT                uint16;&#10;  CHAR                  int8;&#10;  UCHAR                 uint8;&#10;  SDP_BOOLEAN           boolean;&#10;  PCHAR                 string;&#10;  PCHAR                 url;&#10;  SDP_NODE_HEADER       sequence;&#10;  SDP_NODE_HEADER       alternative;&#10;  ISdpNodeContainer     *container;&#10;...">SDP_NODE_DATA</a></p>

<p><a href="sdp_node_header" title="typedef struct _SDP_NODE_HEADER {&#10;  LIST_ENTRY Link;&#10;  USHORT     Type;&#10;  USHORT     SpecificType;&#10;} SDP_NODE_HEADER, *PSDP_NODE_HEADER;">SDP_NODE_HEADER</a></p>

<p><a href="sdp_tree_root_node" title="typedef struct _SDP_TREE_ROOT_NODE {&#10;  SDP_NODE RootNode;&#10;} SDP_TREE_ROOT_NODE, *PSDP_TREE_ROOT_NODE;">SDP_TREE_ROOT_NODE</a></p>

<p><a href="sdpfreetree" title="NTSTATUS SdpFreeTree(&#10;  [in] PSDP_TREE_ROOT_NODE Tree&#10;);">SdpFreeTree</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthsdpddi/nc-bthsdpddi-pconvertstreamtotree">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/bthsdpddi/nc-bthsdpddi-pconvertstreamtotree.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
