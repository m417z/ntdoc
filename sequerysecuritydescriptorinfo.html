<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SeQuerySecurityDescriptorInfo - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SeQuerySecurityDescriptorInfo - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SeQuerySecurityDescriptorInfo - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> SeQuerySecurityDescriptorInfo(
  [in]      PSECURITY_INFORMATION SecurityInformation,
  [out]     PSECURITY_DESCRIPTOR  SecurityDescriptor,
  [in, out] PULONG                Length,
  [in, out] PSECURITY_DESCRIPTOR  *ObjectsSecurityDescriptor
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequerysecuritydescriptorinfo">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/sequerysecuritydescriptorinfo.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-sequerysecuritydescriptorinfo)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="sequerysecuritydescriptorinfo-function">SeQuerySecurityDescriptorInfo function</h1>

<h2 id="description">Description</h2>

<p>The <strong>SeQuerySecurityDescriptorInfo</strong> routine retrieves a copy of an object's security descriptor.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="securityinformation-in"><code>SecurityInformation</code> [in]</h3>

<p>Pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/security-information">SECURITY_INFORMATION</a> value specifying which security information is being queried.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>DACL_SECURITY_INFORMATION</td>
  <td>Indicates the discretionary access control list (DACL) of the object is being queried. Requires READ_CONTROL access.</td>
</tr>
<tr>
  <td>GROUP_SECURITY_INFORMATION</td>
  <td>Indicates the primary group identifier of the object is being queried. Requires READ_CONTROL access.</td>
</tr>
<tr>
  <td>OWNER_SECURITY_INFORMATION</td>
  <td>Indicates the owner identifier of the object is being queried. Requires READ_CONTROL access.</td>
</tr>
<tr>
  <td>SACL_SECURITY_INFORMATION</td>
  <td>Indicates the system <a href="acl" title="typedef struct _ACL {&#10;  UCHAR  AclRevision;&#10;  UCHAR  Sbz1;&#10;  USHORT AclSize;&#10;  USHORT AceCount;&#10;  USHORT Sbz2;&#10;} ACL;">ACL</a> (SACL) of the object is being queried. Requires ACCESS_SYSTEM_SECURITY access.</td>
</tr>
</tbody>
</table>

<h3 id="securitydescriptor-out"><code>SecurityDescriptor</code> [out]</h3>

<p>Caller-allocated user buffer that <strong>SeQuerySecurityDescriptorInfo</strong> fills with a copy of the specified security descriptor in self-relative format.</p>

<h3 id="length-in-out"><code>Length</code> [in, out]</h3>

<p>Pointer to a variable that specifies the size, in bytes, of the buffer pointed to by <em>SecurityDescriptor</em>. Upon return, <strong>SeQuerySecurityDescriptorInfo</strong> sets this variable to the number of bytes required to store the requested information.</p>

<h3 id="objectssecuritydescriptor-in-out"><code>ObjectsSecurityDescriptor</code> [in, out]</h3>

<p>Pointer to a pointer to an object's security descriptor. The security descriptor must be in self-relative format.</p>

<h2 id="return-value">Return value</h2>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The call to <strong>SeQuerySecurityDescriptorInfo</strong> succeeded.</td>
</tr>
<tr>
  <td><strong>STATUS_BUFFER_TOO_SMALL</strong></td>
  <td>The buffer is too small for the security descriptor. None of the security information was copied to the buffer.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A security descriptor can be in absolute or self-relative format. A security descriptor in absolute format contains pointers to the information it contains, rather than containing the information itself. A security descriptor in self-relative format contains the information in a contiguous block of memory. In a self-relative security descriptor, a <a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a> structure always starts the information, but the security descriptor's other components can follow the <a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a> structure in any order. Instead of using memory addresses, the components of the security descriptor are identified by offsets from the beginning of the security descriptor. This format is useful when a security descriptor must be stored on a disk or transmitted by means of a communications protocol.</p>

<p>Because the security descriptor is returned in self-relative format, the caller of <strong>SeQuerySecurityDescriptorInfo</strong> should cast the value returned in the <em>SecurityDescriptor</em> parameter to type PISECURITY_DESCRIPTOR_RELATIVE.</p>

<p>For more information about security and access control, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/driversecurity/windows-security-model">Windows security model for driver developers</a> and the documentation on these topics in the Windows SDK.</p>

<h2 id="see-also">See also</h2>

<p><a href="acl" title="typedef struct _ACL {&#10;  UCHAR  AclRevision;&#10;  UCHAR  Sbz1;&#10;  USHORT AclSize;&#10;  USHORT AceCount;&#10;  USHORT Sbz2;&#10;} ACL;">ACL</a></p>

<p><a href="rtlabsolutetoselfrelativesd" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlAbsoluteToSelfRelativeSD(&#10;    _In_ PSECURITY_DESCRIPTOR AbsoluteSecurityDescriptor,&#10;    _Out_writes_bytes_to_opt_(*BufferLength, *BufferLength) PSECURITY_DESCRIPTOR SelfRelativeSecurityDescriptor,&#10;    _Inout_ PULONG BufferLength&#10;    );">RtlAbsoluteToSelfRelativeSD</a></p>

<p><a href="rtlcreatesecuritydescriptor" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlCreateSecurityDescriptor(&#10;    _Out_ PSECURITY_DESCRIPTOR SecurityDescriptor,&#10;    _In_ ULONG Revision&#10;    );">RtlCreateSecurityDescriptor</a></p>

<p><a href="rtlcreatesecuritydescriptorrelative" title="NTSYSAPI NTSTATUS RtlCreateSecurityDescriptorRelative(&#10;  [out] PISECURITY_DESCRIPTOR_RELATIVE SecurityDescriptor,&#10;  [in]  ULONG                          Revision&#10;);">RtlCreateSecurityDescriptorRelative</a></p>

<p><a href="rtlgetownersecuritydescriptor" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlGetOwnerSecurityDescriptor(&#10;    _In_ PSECURITY_DESCRIPTOR SecurityDescriptor,&#10;    _Outptr_result_maybenull_ PSID *Owner,&#10;    _Out_ PBOOLEAN OwnerDefaulted&#10;    );">RtlGetOwnerSecurityDescriptor</a></p>

<p><a href="rtllengthsecuritydescriptor" title="NTSYSAPI&#10;ULONG&#10;NTAPI&#10;RtlLengthSecurityDescriptor(&#10;    _In_ PSECURITY_DESCRIPTOR SecurityDescriptor&#10;    );">RtlLengthSecurityDescriptor</a></p>

<p><a href="rtlsetdaclsecuritydescriptor" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlSetDaclSecurityDescriptor(&#10;    _Inout_ PSECURITY_DESCRIPTOR SecurityDescriptor,&#10;    _In_ BOOLEAN DaclPresent,&#10;    _In_opt_ PACL Dacl,&#10;    _In_ BOOLEAN DaclDefaulted&#10;    );">RtlSetDaclSecurityDescriptor</a></p>

<p><a href="rtlsetownersecuritydescriptor" title="NTSYSAPI&#10;NTSTATUS&#10;NTAPI&#10;RtlSetOwnerSecurityDescriptor(&#10;    _Inout_ PSECURITY_DESCRIPTOR SecurityDescriptor,&#10;    _In_opt_ PSID Owner,&#10;    _In_ BOOLEAN OwnerDefaulted&#10;    );">RtlSetOwnerSecurityDescriptor</a></p>

<p><a href="rtlvalidsecuritydescriptor" title="_Check_return_&#10;NTSYSAPI&#10;BOOLEAN&#10;NTAPI&#10;RtlValidSecurityDescriptor(&#10;    _In_ PSECURITY_DESCRIPTOR SecurityDescriptor&#10;    );">RtlValidSecurityDescriptor</a></p>

<p><a href="pisecurity_descriptor" title="typedef struct _SECURITY_DESCRIPTOR {&#10;  UCHAR                       Revision;&#10;  UCHAR                       Sbz1;&#10;  SECURITY_DESCRIPTOR_CONTROL Control;&#10;  PSID                        Owner;&#10;  PSID                        Group;&#10;  PACL                        Sacl;&#10;  PACL                        Dacl;&#10;} SECURITY_DESCRIPTOR, *PISECURITY_DESCRIPTOR;">SECURITY_DESCRIPTOR</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequerysecuritydescriptorinfo">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-sequerysecuritydescriptorinfo.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
