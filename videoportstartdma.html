<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="VideoPortStartDma - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>VideoPortStartDma - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            VideoPortStartDma - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// video.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortStartDma(
  [in]      IN PVOID           HwDeviceExtension,
  [in]      IN PVP_DMA_ADAPTER VpDmaAdapter,
  [in]      IN PVOID           Mdl,
  [in]      IN <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Offset,
  [in, out] IN OUT PULONG      pLength,
  [in]      IN <a href="pexecute_dma" title="PEXECUTE_DMA PexecuteDma;&#10;&#10;VOID PexecuteDma(&#10;  PVOID HwDeviceExtension,&#10;  PVP_DMA_ADAPTER VpDmaAdapter,&#10;  PVP_SCATTER_GATHER_LIST SGList,&#10;  PVOID Context&#10;)&#10;{...}">PEXECUTE_DMA</a>    ExecuteDmaRoutine,
  [in]      IN PVOID           Context,
  [in]      IN BOOLEAN         WriteToDevice
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nf-video-videoportstartdma">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/videoportstartdma.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-video-videoportstartdma)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>VideoPortStartDma function</h1>
<h2>Description</h2>
<p>The <strong>VideoPortStartDma</strong> function prepares the system for a DMA operation. As soon as the appropriate resource is available, <strong>VideoPortStartDma</strong> creates a scatter/gather list, initializes the system resources, and calls the video miniport driver-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pexecute_dma">HwVidExecuteDma</a> routine to carry out the DMA operation.</p>
<h2>Parameters</h2>
<h3><code>HwDeviceExtension</code> [in]</h3>
<p>Pointer to the miniport driver's device extension.</p>
<h3><code>VpDmaAdapter</code> [in]</h3>
<p>Pointer to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff570570(v=vs.85)">VP_DMA_ADAPTER</a> structure that represents the bus-master adapter. This structure is returned from a call to <a href="videoportgetdmaadapter" title="VIDEOPORT_DEPRECATED VIDEOPORT_API PVP_DMA_ADAPTER VideoPortGetDmaAdapter(&#10;  [in] IN PVOID                  HwDeviceExtension,&#10;  [in] IN PVP_DEVICE_DESCRIPTION VpDeviceDescription&#10;);">VideoPortGetDmaAdapter</a>.</p>
<h3><code>Mdl</code> [in]</h3>
<p>Pointer to the <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a> that describes the buffer. This pointer is returned from a call to the video port driver's <a href="videoportlockbuffer" title="VIDEOPORT_DEPRECATED VIDEOPORT_API PVOID VideoPortLockBuffer(&#10;  [in] IN PVOID             HwDeviceExtension,&#10;  [in] IN PVOID             BaseAddress,&#10;  [in] IN ULONG             Length,&#10;  [in] IN VP_LOCK_OPERATION Operation&#10;);">VideoPortLockBuffer</a> function.</p>
<h3><code>Offset</code> [in]</h3>
<p>Specifies the byte offset in the buffer at which the DMA operation begins. The <em>Mdl</em> parameter describes this buffer.</p>
<h3><code>pLength</code> [in, out]</h3>
<p>Pointer to a variable that specifies the requested transfer size, in bytes, and that will receive the actual size to be transferred. The variable will be updated when either of the following events occurs: <strong>VideoPortStartDma</strong> returns or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pexecute_dma">HwVidExecuteDma</a> is called. It is therefore safe to read this variable from within <em>HwVidExecuteDma</em> even before <strong>VideoPortStartDma</strong> returns.</p>
<h3><code>ExecuteDmaRoutine</code> [in]</h3>
<p>Pointer to a miniport driver-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pexecute_dma">HwVidExecuteDma</a> callback routine. <strong>VideoPortStartDma</strong> calls this routine to program the hardware registers and start the actual DMA operation.</p>
<h3><code>Context</code> [in]</h3>
<p>Pointer to the driver-determined context to be passed to the miniport driver's <em>HwVidExecuteDma</em> callback routine. Since the <em>HwVidExecuteDma</em> callback routine runs at DISPATCH_LEVEL, the data that <em>Context</em> points to should be in nonpaged memory.</p>
<h3><code>WriteToDevice</code> [in]</h3>
<p>Specifies the direction of the DMA transfer. A value of <strong>TRUE</strong> denotes a transfer from the buffer to the device, and a value of <strong>FALSE</strong> denotes a transfer from the device to the buffer.</p>
<h2>Return value</h2>
<p><strong>VideoPortStartDma</strong> returns one of the following status codes:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>NO_ERROR</td>
<td>The operation was successfully carried out.</td>
</tr>
<tr>
<td>ERROR_NOT_ENOUGH_MEMORY</td>
<td>There are not enough system resources for this operation.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>To prepare for a DMA-transfer operation, <strong>VideoPortStartDma</strong>:</p>
<ul>
<li>
Flushes the memory region in the host processor's caches.
</li>
<li>
Builds a scatter/gather list.
</li>
<li>
Calls the video miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pexecute_dma">HwVidExecuteDma</a> callback.
</li>
</ul>
<p>It is possible that not all of the requested data has been transferred, since the actual amount of memory transferred is limited by the number of map registers available to the driver. Callers of this function should inspect the actual transfer size returned at <em>pLength</em> to determine whether additional data remains to be transferred. If so, the miniport driver should call <strong>VideoPortStartDma</strong> (and subsequently, <a href="videoportcompletedma" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortCompleteDma(&#10;  [in] IN PVOID                   HwDeviceExtension,&#10;  [in] IN PVP_DMA_ADAPTER         VpDmaAdapter,&#10;  [in] IN PVP_SCATTER_GATHER_LIST VpScatterGather,&#10;  [in] IN BOOLEAN                 WriteToDevice&#10;);">VideoPortCompleteDma</a>) as many times as necessary to fulfill the entire transfer request.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pexecute_dma">HwVidExecuteDma</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff570570(v=vs.85)">VP_DMA_ADAPTER</a></p>
<p><a href="videoportcompletedma" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortCompleteDma(&#10;  [in] IN PVOID                   HwDeviceExtension,&#10;  [in] IN PVP_DMA_ADAPTER         VpDmaAdapter,&#10;  [in] IN PVP_SCATTER_GATHER_LIST VpScatterGather,&#10;  [in] IN BOOLEAN                 WriteToDevice&#10;);">VideoPortCompleteDma</a></p>
<p><a href="videoportgetdmaadapter" title="VIDEOPORT_DEPRECATED VIDEOPORT_API PVP_DMA_ADAPTER VideoPortGetDmaAdapter(&#10;  [in] IN PVOID                  HwDeviceExtension,&#10;  [in] IN PVP_DEVICE_DESCRIPTION VpDeviceDescription&#10;);">VideoPortGetDmaAdapter</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nf-video-videoportstartdma">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/video/nf-video-videoportstartdma.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
