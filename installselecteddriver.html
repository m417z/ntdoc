<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="InstallSelectedDriver - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>InstallSelectedDriver - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            InstallSelectedDriver - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header"></span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">BOOL WINAPI InstallSelectedDriver(
  _In_  HWND     hwndParent,
  _In_  HDEVINFO DeviceInfoSet,
  _In_  LPCTSTR  Reserved,
  _In_  BOOL     Backup,
  _Out_ PDWORD   bReboot
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/install/installselecteddriver">View the official Windows hardware development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/installselecteddriver.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows hardware development documentation (installselecteddriver)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="installselecteddriver-function">InstallSelectedDriver function</h1>

<p>The <strong>InstallSelectedDriver</strong> function is deprecated. For Windows Vista and later, use <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-diinstalldevice"><strong>DiInstallDevice</strong></a> instead.</p>

<h2 id="parameters">Parameters</h2>

<p><em>hwndParent</em> [in]
A handle to the top-level window that the <strong>InstallSelectedDriver</strong> function uses to display user interface components that are associated with installing the driver.</p>

<p><em>DeviceInfoSet</em> [in]
A handle to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/install/device-information-sets">device information set</a> that contains a device information element that represents a selected device and a selected driver for the device. For more information about how to select a device and a driver for a device, see the following <strong>Remarks</strong> section.</p>

<p><em>Reserved</em> [in]
This parameter must be set to <strong>NULL</strong>.</p>

<p><em>Backup</em> [in]
A value of type BOOL that determines whether <strong>InstallSelectedDriver</strong> backs up the currently installed drivers for the selected device before the function installs the selected driver for the device. If the currently installed drivers are backed up and the user encounters a problem with the new driver, the user can roll back the installation of the new driver to the backed up driver. If the currently installed drivers are not backed up, the user cannot roll back the installation of the new driver to the previously installed driver. If <em>Backup</em> is set to <strong>TRUE</strong>, <strong>InstallSelectedDriver</strong> backs up the currently installed drivers; otherwise, the function does not back up the currently installed drivers. For more information about driver back up, see <strong>DiRollbackDriver</strong>.</p>

<p><em>bReboot</em> [out]
A pointer to a variable of type <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> that <strong>InstallSelectedDriver</strong> sets to indicate whether a system restart is required to complete the installation. If the variable is set to DI_NEEDREBOOT, a system restart is required; otherwise, a system restart is not required. The caller is responsible for restarting the system.</p>

<h2 id="return-value">Return value</h2>

<p><strong>InstallSelectedDriver</strong> returns <strong>TRUE</strong> if the selected driver was installed on the selected device; otherwise, the function returns <strong>FALSE</strong> and the logged error can be retrieved by making a call to <strong>GetLastError</strong>.</p>

<p>Some of the more common error values that <strong>GetLastError</strong> might return are as follows:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NO_ERROR</strong></td>
  <td>The selected driver was a better match to the driver than the driver that was previously installed on the device.</td>
</tr>
<tr>
  <td><strong>ERROR_IN_WOW64</strong></td>
  <td>The calling application is a 32-bit application that is attempting to execute in a 64-bit environment, which is not allowed. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/install/device-installations-on-64-bit-systems">Installing Devices on 64-Bit Systems</a>.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>To access <strong>InstallSelectedDriver</strong>, call <strong>LoadLibrary</strong> to load <em>Newdev.dll</em> and then call <strong>GetProcAddress</strong> to obtain a function pointer to <strong>InstallSelectedDriver</strong>.</p>

<p>You should only call <strong>InstallSelectedDriver</strong> if it is necessary to install a specific driver on a specific device.</p>

<p><strong>Important</strong> For Windows Vista and later versions of Windows, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-diinstalldevice"><strong>DiInstallDevice</strong></a> instead of <strong>InstallSelectedDriver</strong> to perform this type of operation.</p>

<p>Other than the special applications that require the installation of a specific driver on a specific device, an installation application should install the driver that is the best match for a device. To install the driver that is the best match for a device, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-diinstalldrivera"><strong>DiInstallDriver</strong></a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-updatedriverforplugandplaydevicesa"><strong>UpdateDriverForPlugAndPlayDevices</strong></a>. For more information about which of these functions to call to install a driver on a device, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/install/functions-that-simplify-driver-installation">SetupAPI Functions that Simplify Driver Installation</a>.</p>

<p>Before calling <strong>InstallSelectedDriver</strong>, the caller must obtain a device information set that contains the device, select the device in the set, and select a driver for the device.</p>

<p>To create a device information set that contains the device, do one of the following:</p>

<ul>
<li><p>Call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdigetclassdevsw"><strong>SetupDiGetClassDevs</strong></a> to retrieve a device information set that contains the device and then call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdienumdeviceinfo"><strong>SetupDiEnumDeviceInfo</strong></a> to enumerate the devices in the device information set. On each call, <strong>SetupDiEnumDeviceInfo</strong> returns an SP_DEVINFO_DATA structure that represents the enumerated device in the device information set. To obtain specific information about the enumerated device, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdigetdeviceregistrypropertya"><strong>SetupDiGetDeviceRegistryProperty</strong></a> and supply the SP_DEVINFO_DATA structure that was returned by <strong>SetupDiEnumDeviceInfo</strong>.</p>

<ul>
<li>OR -</li>
</ul></li>
<li><p>Call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdiopendeviceinfoa"><strong>SetupDiOpenDeviceInfo</strong></a> to add a device with a known device instance ID to the device information set. <strong>SetupDiOpenDeviceInfo</strong> returns an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/ns-setupapi-sp_devinfo_data"><strong>SP_DEVINFO_DATA</strong></a> structure that represents the device in the device information set.</p></li>
</ul>

<p>After obtaining the SP_DEVINFO_DATA structure for a device, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdisetselecteddevice"><strong>SetupDiSetSelectedDevice</strong></a> to select the device in the device information set.</p>

<p>To retrieve a driver for a device, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdibuilddriverinfolist"><strong>SetupDiBuildDriverInfoList</strong></a> to build a list of compatible drivers for the device and then call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdienumdriverinfoa"><strong>SetupDiEnumDriverInfo</strong></a> to enumerate the elements of the driver list for the device. For each enumerated driver, <strong>SetupDiEnumDriverInfo</strong> retrieves an SP_DRVINFO_DATA structure that represents the driver. <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdigetdriverinfodetaila"><strong>SetupDiGetDriverInfoDetail</strong></a> can be called to retrieve additional details about an enumerated driver.</p>

<p>After obtaining an SP_DRVINFO_DATA structure for the driver, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdisetselecteddrivera"><strong>SetupDiSetSelectedDriver</strong></a> to select the driver for the device.</p>

<h2 id="requirements">Requirements</h2>

<table>
<thead>
<tr>
  <th></th>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td>Target platform</td>
  <td>Desktop</td>
</tr>
<tr>
  <td>Version</td>
  <td>Available in Microsoft Windows 2000 and later versions of Windows.</td>
</tr>
<tr>
  <td>Header</td>
  <td>None (The <strong>InstallSelectedDriver</strong> function is not defined in a public header file. For more information, see the <strong>Remarks</strong> section. )</td>
</tr>
<tr>
  <td>Library</td>
  <td>Newdev.lib</td>
</tr>
<tr>
  <td>DLL</td>
  <td>Newdev.dll</td>
</tr>
</tbody>
</table>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-diinstalldevice"><strong>DiInstallDevice</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-diinstalldrivera"><strong>DiInstallDriver</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdibuilddriverinfolist"><strong>SetupDiBuildDriverInfoList</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdienumdeviceinfo"><strong>SetupDiEnumDeviceInfo</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdienumdriverinfoa"><strong>SetupDiEnumDriverInfo</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdigetclassdevsw"><strong>SetupDiGetClassDevs</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdigetdeviceregistrypropertya"><strong>SetupDiGetDeviceRegistryProperty</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdigetdriverinfodetaila"><strong>SetupDiGetDriverInfoDetail</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdiopendeviceinfoa"><strong>SetupDiOpenDeviceInfo</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdisetselecteddevice"><strong>SetupDiSetSelectedDevice</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/setupapi/nf-setupapi-setupdisetselecteddrivera"><strong>SetupDiSetSelectedDriver</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/newdev/nf-newdev-updatedriverforplugandplaydevicesa"><strong>UpdateDriverForPlugAndPlayDevices</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/install/installselecteddriver">View the official Windows hardware development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs/blob/staging/windows-driver-docs-pr/install/installselecteddriver.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
