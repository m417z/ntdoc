<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SeImpersonateClientEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SeImpersonateClientEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SeImpersonateClientEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ntifs.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> SeImpersonateClientEx(
  [in]           PSECURITY_CLIENT_CONTEXT ClientContext,
  [in, optional] PETHREAD                 ServerThread
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-seimpersonateclientex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/seimpersonateclientex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-seimpersonateclientex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>SeImpersonateClientEx function</h1>
<h2>Description</h2>
<p>The <strong>SeImpersonateClientEx</strong> routine causes a thread to impersonate a user.</p>
<h2>Parameters</h2>
<h3><code>ClientContext</code> [in]</h3>
<p>Pointer to the user's security client context.</p>
<h3><code>ServerThread</code> [in, optional]</h3>
<p>Pointer to the thread that is to impersonate the user. If not specified, the calling thread is used.</p>
<h2>Return value</h2>
<p><strong>SeImpersonateClientEx</strong> returns an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value, such as the following:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
<td>The impersonation attempt succeeded.</td>
</tr>
<tr>
<td><strong>STATUS_ACCESS_DENIED</strong></td>
<td>The thread specified in <strong>ServerThread</strong> parameter did not have sufficient access rights to impersonate the user whose security client context is specified in the <strong>ClientContext</strong> parameter.</td>
</tr>
<tr>
<td><strong>STATUS_NO_MEMORY</strong></td>
<td><strong>SeImpersonateClientEx</strong> encountered a pool allocation failure when allocating memory for the impersonation information structure.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p><strong>SeImpersonateClientEx</strong> is used to cause a thread to impersonate a user. The client security context in <strong>ClientContext</strong> is assumed to be up to date.</p>
<p>It is extremely unsafe to raise the privilege state of an untrusted user thread (take a user's thread and impersonate LocalSystem, for example). If an untrusted user thread had its privilege raised, the user could grab the thread token after it has been elevated and subvert the security of the entire system.</p>
<p>In cases where a higher privilege state is required, the task should be dispatched to a work queue where the task can be safely handled by system worker thread. This way no impersonation is necessary.</p>
<p>To end the impersonation of the user, call the <a href="sestopimpersonatingclient" title="VOID SeStopImpersonatingClient(void);">SeStopImpersonatingClient</a> routine.</p>
<p>The <a href="psimpersonateclient" title="NTSTATUS PsImpersonateClient(&#10;  [in, out] PETHREAD                     Thread,&#10;  [in]      PACCESS_TOKEN                Token,&#10;  [in]      BOOLEAN                      CopyOnOpen,&#10;  [in]      BOOLEAN                      EffectiveOnly,&#10;  [in]      SECURITY_IMPERSONATION_LEVEL ImpersonationLevel&#10;);">PsImpersonateClient</a> routine can be used to cause a server thread to impersonate a client.</p>
<p>For more information about security and access control, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/driversecurity/windows-security-model">Windows security model for driver developers</a> and the documentation on these topics in the Windows SDK.</p>
<h2>See also</h2>
<p><a href="psimpersonateclient" title="NTSTATUS PsImpersonateClient(&#10;  [in, out] PETHREAD                     Thread,&#10;  [in]      PACCESS_TOKEN                Token,&#10;  [in]      BOOLEAN                      CopyOnOpen,&#10;  [in]      BOOLEAN                      EffectiveOnly,&#10;  [in]      SECURITY_IMPERSONATION_LEVEL ImpersonationLevel&#10;);">PsImpersonateClient</a></p>
<p><a href="secreateclientsecurity" title="NTSTATUS SeCreateClientSecurity(&#10;  [in]  PETHREAD                     ClientThread,&#10;  [in]  PSECURITY_QUALITY_OF_SERVICE ClientSecurityQos,&#10;        BOOLEAN                      RemoteSession,&#10;  [out] PSECURITY_CLIENT_CONTEXT     ClientContext&#10;);">SeCreateClientSecurity</a></p>
<p><a href="secreateclientsecurityfromsubjectcontext" title="NTSTATUS SeCreateClientSecurityFromSubjectContext(&#10;  [in]  PSECURITY_SUBJECT_CONTEXT    SubjectContext,&#10;  [in]  PSECURITY_QUALITY_OF_SERVICE ClientSecurityQos,&#10;  [in]  BOOLEAN                      ServerIsRemote,&#10;  [out] PSECURITY_CLIENT_CONTEXT     ClientContext&#10;);">SeCreateClientSecurityFromSubjectContext</a></p>
<p><a href="sestopimpersonatingclient" title="VOID SeStopImpersonatingClient(void);">SeStopImpersonatingClient</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-seimpersonateclientex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-seimpersonateclientex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
