<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PEXTERNAL_CACHE_CALLBACK_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PEXTERNAL_CACHE_CALLBACK_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PEXTERNAL_CACHE_CALLBACK_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PEXTERNAL_CACHE_CALLBACK_EX PexternalCacheCallbackEx;

VOID PexternalCacheCallbackEx(
  PVOID ExternalCacheContext,
  <a href="cc_dirty_pages_info" title="typedef struct _CC_DIRTY_PAGES_INFO {&#10;  ULONG    Version;&#10;  LONGLONG DirtyPageThreshold;&#10;  LONGLONG DirtyPageTarget;&#10;  LONGLONG CleanLockedCachedPagesThreshold;&#10;  LONGLONG CleanLockedCachedPagesTarget;&#10;  LONGLONG CurrentDirtyPages;&#10;  LONGLONG CurrentCleanLockedCachedPages;&#10;  LONGLONG CurrentPagesQueuedForWriting;&#10;} CC_DIRTY_PAGES_INFO, *PCC_DIRTY_PAGES_INFO;">PCC_DIRTY_PAGES_INFO</a> DirtyPagesInfo
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nc-ntifs-pexternal_cache_callback_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pexternal_cache_callback_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ntifs-pexternal_cache_callback_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>PEXTERNAL_CACHE_CALLBACK_EX</strong> callback function is called by the cache manager (<em>Cc</em>) on every lazy write scan.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="externalcachecontext"><code>ExternalCacheContext</code></h3>

<p>[in] Pointer to the context that identifies the external cache structure. This context was returned by <strong><a href="ccregisterexternalcacheex" title="NTSTATUS CcRegisterExternalCacheEx(&#10;  PFILE_OBJECT                FileObject,&#10;  PEXTERNAL_CACHE_CALLBACK_EX Callback,&#10;  PVOID                       *ExternalCacheContext&#10;);">CcRegisterExternalCacheEx</a></strong>.</p>

<h3 id="dirtypagesinfo"><code>DirtyPagesInfo</code></h3>

<p>[in] Pointer to a <strong><a href="cc_dirty_pages_info" title="typedef struct _CC_DIRTY_PAGES_INFO {&#10;  ULONG    Version;&#10;  LONGLONG DirtyPageThreshold;&#10;  LONGLONG DirtyPageTarget;&#10;  LONGLONG CleanLockedCachedPagesThreshold;&#10;  LONGLONG CleanLockedCachedPagesTarget;&#10;  LONGLONG CurrentDirtyPages;&#10;  LONGLONG CurrentCleanLockedCachedPages;&#10;  LONGLONG CurrentPagesQueuedForWriting;&#10;} CC_DIRTY_PAGES_INFO, *PCC_DIRTY_PAGES_INFO;">CC_DIRTY_PAGES_INFO</a></strong> structure that contains information about dirty page statistics for the external cache.</p>

<h2 id="remarks">Remarks</h2>

<p>A client (file system) must register an external cache with <em>Cc</em> by calling <strong><a href="ccregisterexternalcacheex" title="NTSTATUS CcRegisterExternalCacheEx(&#10;  PFILE_OBJECT                FileObject,&#10;  PEXTERNAL_CACHE_CALLBACK_EX Callback,&#10;  PVOID                       *ExternalCacheContext&#10;);">CcRegisterExternalCacheEx</a></strong> before it can receive callbacks from <em>Cc</em> during lazy write scans.</p>

<p>The values in <strong>DirtyPagesInfo</strong> are provided by the <em>Cc</em> to the external cache client through this callback routine.</p>

<p>Targets (<strong>DirtyPageTarget</strong> and <strong>CleanLockedCachedPagesTarget</strong>) are for defining the upper limits. The client must strive to keep these metrics at or under their target value. When targets are exceeded, the client needs to aggressively bring down the corresponding metric.</p>

<p>Thresholds (<strong>DirtyPageThreshold</strong> and <strong>CleanLockedCachedPagesThreshold</strong>) define the hard upper limit that a client must not cross. The client must therefore pause all activities that could cause thresholds to be exceeded.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="ccregisterexternalcacheex" title="NTSTATUS CcRegisterExternalCacheEx(&#10;  PFILE_OBJECT                FileObject,&#10;  PEXTERNAL_CACHE_CALLBACK_EX Callback,&#10;  PVOID                       *ExternalCacheContext&#10;);">CcRegisterExternalCacheEx</a></strong></p>

<p><strong><a href="cc_dirty_pages_info" title="typedef struct _CC_DIRTY_PAGES_INFO {&#10;  ULONG    Version;&#10;  LONGLONG DirtyPageThreshold;&#10;  LONGLONG DirtyPageTarget;&#10;  LONGLONG CleanLockedCachedPagesThreshold;&#10;  LONGLONG CleanLockedCachedPagesTarget;&#10;  LONGLONG CurrentDirtyPages;&#10;  LONGLONG CurrentCleanLockedCachedPages;&#10;  LONGLONG CurrentPagesQueuedForWriting;&#10;} CC_DIRTY_PAGES_INFO, *PCC_DIRTY_PAGES_INFO;">CC_DIRTY_PAGES_INFO</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nc-ntifs-pexternal_cache_callback_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nc-ntifs-pexternal_cache_callback_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
