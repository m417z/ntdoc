<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="USB_NODE_CONNECTION_INFORMATION_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>USB_NODE_CONNECTION_INFORMATION_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            USB_NODE_CONNECTION_INFORMATION_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// usbioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _USB_NODE_CONNECTION_INFORMATION_EX {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                 ConnectionIndex;
  <a href="usb_device_descriptor" title="typedef struct _USB_DEVICE_DESCRIPTOR {&#10;  UCHAR  bLength;&#10;  UCHAR  bDescriptorType;&#10;  USHORT bcdUSB;&#10;  UCHAR  bDeviceClass;&#10;  UCHAR  bDeviceSubClass;&#10;  UCHAR  bDeviceProtocol;&#10;  UCHAR  bMaxPacketSize0;&#10;  USHORT idVendor;&#10;  USHORT idProduct;&#10;  USHORT bcdDevice;&#10;  UCHAR  iManufacturer;&#10;  UCHAR  iProduct;&#10;  UCHAR  iSerialNumber;&#10;  UCHAR  bNumConfigurations;&#10;} USB_DEVICE_DESCRIPTOR, *PUSB_DEVICE_DESCRIPTOR;">USB_DEVICE_DESCRIPTOR</a> DeviceDescriptor;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                 CurrentConfigurationValue;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                 Speed;
  BOOLEAN               DeviceIsHub;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>                DeviceAddress;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                 NumberOfOpenPipes;
  <a href="usb_connection_status" title="typedef enum _USB_CONNECTION_STATUS {&#10;  NoDeviceConnected,&#10;  DeviceConnected,&#10;  DeviceFailedEnumeration,&#10;  DeviceGeneralFailure,&#10;  DeviceCausedOvercurrent,&#10;  DeviceNotEnoughPower,&#10;  DeviceNotEnoughBandwidth,&#10;  DeviceHubNestedTooDeeply,&#10;  DeviceInLegacyHub,&#10;  DeviceEnumerating,&#10;  DeviceReset&#10;} USB_CONNECTION_STATUS, *PUSB_CONNECTION_STATUS;">USB_CONNECTION_STATUS</a> ConnectionStatus;
  <a href="usb_pipe_info" title="typedef struct _USB_PIPE_INFO {&#10;  USB_ENDPOINT_DESCRIPTOR EndpointDescriptor;&#10;  ULONG                   ScheduleOffset;&#10;} USB_PIPE_INFO, *PUSB_PIPE_INFO;">USB_PIPE_INFO</a>         PipeList[0];
} USB_NODE_CONNECTION_INFORMATION_EX, *PUSB_NODE_CONNECTION_INFORMATION_EX;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbioctl/ns-usbioctl-_usb_node_connection_information_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/usb_node_connection_information_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-usbioctl-_usb_node_connection_information_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_usb_node_connection_information_ex-structure">_USB_NODE_CONNECTION_INFORMATION_EX structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>USB_NODE_CONNECTION_INFORMATION_EX</strong> structure is used in conjunction with the <strong><a href="ioctl_usb_get_node_connection_information_ex" title="// CTL_CODE(0x0022, 0x112, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX 0x00220448">IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX</a></strong> request to obtain information about the connection associated with the indicated USB port.</p>

<h2 id="members">Members</h2>

<h3 id="connectionindex"><code>ConnectionIndex</code></h3>

<p>Contains a value greater than or equal to 1 that specifies the number of the port.</p>

<h3 id="devicedescriptor"><code>DeviceDescriptor</code></h3>

<p>Contains a structure of type <strong><a href="usb_device_descriptor" title="typedef struct _USB_DEVICE_DESCRIPTOR {&#10;  UCHAR  bLength;&#10;  UCHAR  bDescriptorType;&#10;  USHORT bcdUSB;&#10;  UCHAR  bDeviceClass;&#10;  UCHAR  bDeviceSubClass;&#10;  UCHAR  bDeviceProtocol;&#10;  UCHAR  bMaxPacketSize0;&#10;  USHORT idVendor;&#10;  USHORT idProduct;&#10;  USHORT bcdDevice;&#10;  UCHAR  iManufacturer;&#10;  UCHAR  iProduct;&#10;  UCHAR  iSerialNumber;&#10;  UCHAR  bNumConfigurations;&#10;} USB_DEVICE_DESCRIPTOR, *PUSB_DEVICE_DESCRIPTOR;">USB_DEVICE_DESCRIPTOR</a></strong> that reports the USB device descriptor returned by the attached device during enumeration.</p>

<h3 id="currentconfigurationvalue"><code>CurrentConfigurationValue</code></h3>

<p>Contains the ID used with the SetConfiguration request to specify that current configuration of the device connected to the indicated port. For an explanation of this value, see section 9.4.7 in the Universal Serial Bus 3.1 Specification available at <a rel="noopener" target="_blank" href="https://www.usb.org/documents">USB Document Library</a>.</p>

<h3 id="speed"><code>Speed</code></h3>

<p>Contains a value of type <strong><a href="usb_device_speed" title="typedef enum _USB_DEVICE_SPEED {&#10;  UsbLowSpeed,&#10;  UsbFullSpeed,&#10;  UsbHighSpeed,&#10;  UsbSuperSpeed&#10;} USB_DEVICE_SPEED;">USB_DEVICE_SPEED</a></strong> that indicates the speed of the device.</p>

<h3 id="deviceishub"><code>DeviceIsHub</code></h3>

<p>Indicates, when <strong>TRUE</strong>, that the device attached to the port is a hub.</p>

<h3 id="deviceaddress"><code>DeviceAddress</code></h3>

<p>Contains the USB-assigned, bus-relative address of the device that is attached to the port.</p>

<h3 id="numberofopenpipes"><code>NumberOfOpenPipes</code></h3>

<p>Indicates the number of open USB pipes associated with the port.</p>

<h3 id="connectionstatus"><code>ConnectionStatus</code></h3>

<p>Contains an enumerator of type <strong><a href="usb_connection_status" title="typedef enum _USB_CONNECTION_STATUS {&#10;  NoDeviceConnected,&#10;  DeviceConnected,&#10;  DeviceFailedEnumeration,&#10;  DeviceGeneralFailure,&#10;  DeviceCausedOvercurrent,&#10;  DeviceNotEnoughPower,&#10;  DeviceNotEnoughBandwidth,&#10;  DeviceHubNestedTooDeeply,&#10;  DeviceInLegacyHub,&#10;  DeviceEnumerating,&#10;  DeviceReset&#10;} USB_CONNECTION_STATUS, *PUSB_CONNECTION_STATUS;">USB_CONNECTION_STATUS</a></strong> that indicates the connection status.</p>

<h3 id="pipelist"><code>PipeList</code></h3>

<p>Contains an array of structures of type <strong><a href="usb_pipe_info" title="typedef struct _USB_PIPE_INFO {&#10;  USB_ENDPOINT_DESCRIPTOR EndpointDescriptor;&#10;  ULONG                   ScheduleOffset;&#10;} USB_PIPE_INFO, *PUSB_PIPE_INFO;">USB_PIPE_INFO</a></strong> that describes the open pipes associated with the port. Pipe descriptions include the schedule offset of the pipe and the associated endpoint descriptor. This information can be used to calculate bandwidth usage.</p>

<h2 id="remarks">Remarks</h2>

<p>If there is no device connected, <strong><a href="ioctl_usb_get_node_connection_information_ex" title="// CTL_CODE(0x0022, 0x112, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX 0x00220448">IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX</a></strong>` just returns information about the port. If a device is connected to the port <strong><a href="ioctl_usb_get_node_connection_information_ex" title="// CTL_CODE(0x0022, 0x112, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX 0x00220448">IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX</a></strong> returns information about both the port and the connected device.</p>

<p>The <strong>USB_NODE_CONNECTION_INFORMATION_EX</strong> structure is an extended version of <strong><a href="usb_node_connection_information" title="typedef struct _USB_NODE_CONNECTION_INFORMATION {&#10;  ULONG                 ConnectionIndex;&#10;  USB_DEVICE_DESCRIPTOR DeviceDescriptor;&#10;  UCHAR                 CurrentConfigurationValue;&#10;  BOOLEAN               LowSpeed;&#10;  BOOLEAN               DeviceIsHub;&#10;  USHORT                DeviceAddress;&#10;  ULONG                 NumberOfOpenPipes;&#10;  USB_CONNECTION_STATUS ConnectionStatus;&#10;  USB_PIPE_INFO         PipeList[0];&#10;} USB_NODE_CONNECTION_INFORMATION, *PUSB_NODE_CONNECTION_INFORMATION;">USB_NODE_CONNECTION_INFORMATION</a></strong>. The two structures are identical, except for one member. In the extended structure, the <strong>Speed</strong> member indicates the device speed.</p>

<p>The <strong>Speed</strong> member of the <strong>USB_NODE_CONNECTION_INFORMATION_EX</strong> structure is a <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> and it can specify any of the values of the <strong><a href="usb_device_speed" title="typedef enum _USB_DEVICE_SPEED {&#10;  UsbLowSpeed,&#10;  UsbFullSpeed,&#10;  UsbHighSpeed,&#10;  UsbSuperSpeed&#10;} USB_DEVICE_SPEED;">USB_DEVICE_SPEED</a></strong> enumerator. The <strong>Speed</strong> member supports up to <em>UsbHighSpeed</em> (USB 2.0). To determine if a device supports <em>UsbSuperSpeed</em> (USB 3.0), use the <strong><a href="usb_node_connection_information_ex_v2" title="typedef struct _USB_NODE_CONNECTION_INFORMATION_EX_V2 {&#10;  ULONG                                       ConnectionIndex;&#10;  ULONG                                       Length;&#10;  USB_PROTOCOLS                               SupportedUsbProtocols;&#10;  USB_NODE_CONNECTION_INFORMATION_EX_V2_FLAGS Flags;&#10;} USB_NODE_CONNECTION_INFORMATION_EX_V2, *PUSB_NODE_CONNECTION_INFORMATION_EX_V2;">USB_NODE_CONNECTION_INFORMATION_EX_V2</a></strong> structure.</p>

<p>The following C++ code snippet from the <a rel="noopener" target="_blank" href="https://github.com/microsoft/Windows-driver-samples/tree/main/usb/usbview">USBView sample</a> demonstrates how to determine if a device supports UsbSuperSpeed (USB 3.0):</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="c1">// Since the USB_NODE_CONNECTION_INFORMATION_EX is used to display</span>
<span class="c1">// the device speed, but the hub driver doesn&#39;t support indication</span>
<span class="c1">// of superspeed, we overwrite the value if the super speed</span>
<span class="c1">// data structures are available and indicate the device is operating</span>
<span class="c1">// at SuperSpeed.</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connectionInfoEx</span><span class="o">-&gt;</span><span class="n">Speed</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UsbHighSpeed</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">connectionInfoExV2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">connectionInfoExV2</span><span class="o">-&gt;</span><span class="n">Flags</span><span class="p">.</span><span class="n">DeviceIsOperatingAtSuperSpeedOrHigher</span><span class="w"> </span><span class="o">||</span>
<span class="w">        </span><span class="n">connectionInfoExV2</span><span class="o">-&gt;</span><span class="n">Flags</span><span class="p">.</span><span class="n">DeviceIsOperatingAtSuperSpeedPlusOrHigher</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">connectionInfoEx</span><span class="o">-&gt;</span><span class="n">Speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UsbSuperSpeed</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_usbref/#structures">USB Structures</a></li>
<li><strong><a href="usb_connection_status" title="typedef enum _USB_CONNECTION_STATUS {&#10;  NoDeviceConnected,&#10;  DeviceConnected,&#10;  DeviceFailedEnumeration,&#10;  DeviceGeneralFailure,&#10;  DeviceCausedOvercurrent,&#10;  DeviceNotEnoughPower,&#10;  DeviceNotEnoughBandwidth,&#10;  DeviceHubNestedTooDeeply,&#10;  DeviceInLegacyHub,&#10;  DeviceEnumerating,&#10;  DeviceReset&#10;} USB_CONNECTION_STATUS, *PUSB_CONNECTION_STATUS;">USB_CONNECTION_STATUS</a></strong></li>
<li><strong><a href="usb_pipe_info" title="typedef struct _USB_PIPE_INFO {&#10;  USB_ENDPOINT_DESCRIPTOR EndpointDescriptor;&#10;  ULONG                   ScheduleOffset;&#10;} USB_PIPE_INFO, *PUSB_PIPE_INFO;">USB_PIPE_INFO</a></strong></li>
<li><strong><a href="ioctl_usb_get_node_connection_information_ex" title="// CTL_CODE(0x0022, 0x112, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX 0x00220448">IOCTL_USB_GET_NODE_CONNECTION_INFORMATION_EX</a></strong></li>
<li><strong><a href="usb_node_connection_information" title="typedef struct _USB_NODE_CONNECTION_INFORMATION {&#10;  ULONG                 ConnectionIndex;&#10;  USB_DEVICE_DESCRIPTOR DeviceDescriptor;&#10;  UCHAR                 CurrentConfigurationValue;&#10;  BOOLEAN               LowSpeed;&#10;  BOOLEAN               DeviceIsHub;&#10;  USHORT                DeviceAddress;&#10;  ULONG                 NumberOfOpenPipes;&#10;  USB_CONNECTION_STATUS ConnectionStatus;&#10;  USB_PIPE_INFO         PipeList[0];&#10;} USB_NODE_CONNECTION_INFORMATION, *PUSB_NODE_CONNECTION_INFORMATION;">USB_NODE_CONNECTION_INFORMATION</a></strong></li>
<li><strong><a href="usb_device_speed" title="typedef enum _USB_DEVICE_SPEED {&#10;  UsbLowSpeed,&#10;  UsbFullSpeed,&#10;  UsbHighSpeed,&#10;  UsbSuperSpeed&#10;} USB_DEVICE_SPEED;">USB_DEVICE_SPEED</a></strong></li>
<li><strong><a href="usb_node_connection_information_ex_v2" title="typedef struct _USB_NODE_CONNECTION_INFORMATION_EX_V2 {&#10;  ULONG                                       ConnectionIndex;&#10;  ULONG                                       Length;&#10;  USB_PROTOCOLS                               SupportedUsbProtocols;&#10;  USB_NODE_CONNECTION_INFORMATION_EX_V2_FLAGS Flags;&#10;} USB_NODE_CONNECTION_INFORMATION_EX_V2, *PUSB_NODE_CONNECTION_INFORMATION_EX_V2;">USB_NODE_CONNECTION_INFORMATION_EX_V2</a></strong></li>
<li><a rel="noopener" target="_blank" href="https://github.com/microsoft/Windows-driver-samples/tree/main/usb">USB samples</a></li>
<li><a rel="noopener" target="_blank" href="https://github.com/microsoft/Windows-driver-samples/tree/main/usb/usbview">USBView sample</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbioctl/ns-usbioctl-_usb_node_connection_information_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/usbioctl/ns-usbioctl-_usb_node_connection_information_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
