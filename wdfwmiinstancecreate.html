<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfWmiInstanceCreate - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfWmiInstanceCreate - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfWmiInstanceCreate - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// wdfwmi.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> WdfWmiInstanceCreate(
  [in]            WDFDEVICE                Device,
  [in]            <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">PWDF_WMI_INSTANCE_CONFIG</a> InstanceConfig,
  [in, optional]  <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">PWDF_OBJECT_ATTRIBUTES</a>   InstanceAttributes,
  [out, optional] WDFWMIINSTANCE           *Instance
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfwmi/nf-wdfwmi-wdfwmiinstancecreate">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfwmiinstancecreate.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfwmi-wdfwmiinstancecreate)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>WdfWmiInstanceCreate function</h1>
<h2>Description</h2>
<p>[Applies to KMDF only]</p>
<p>The <strong>WdfWmiInstanceCreate</strong> method creates a WMI instance object that represents an instance of a WMI data provider.</p>
<h2>Parameters</h2>
<h3><code>Device</code> [in]</h3>
<p>A handle to a framework device object that represents the device that the instance is being created for. The device object cannot be a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-control-device-objects">control device object</a>.</p>
<h3><code>InstanceConfig</code> [in]</h3>
<p>A pointer to a caller-initialized <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure, which contains configuration information for an instance of a WMI data provider.</p>
<h3><code>InstanceAttributes</code> [in, optional]</h3>
<p>A pointer to a caller-allocated <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure that contains driver-supplied object attributes for the new WMI instance object. (The structure's <strong>ParentObject</strong> member must be <strong>NULL</strong>.) This parameter is optional and can be WDF_NO_OBJECT_ATTRIBUTES.</p>
<h3><code>Instance</code> [out, optional]</h3>
<p>A pointer to a location that receives a handle to the new WMI instance object. This parameter is optional and can be <strong>NULL</strong>.</p>
<h2>Return value</h2>
<p><strong>WdfWmiInstanceCreate</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, this method might return one of the following values:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>STATUS_INVALID_PARAMETER</strong></td>
<td>An invalid parameter was detected.</td>
</tr>
<tr>
<td><strong>STATUS_INFO_LENGTH_MISMATCH</strong></td>
<td>The size of the <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure that the <strong>InstanceConfig</strong> parameter points to was incorrect.</td>
</tr>
<tr>
<td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
<td>There was insufficient memory.</td>
</tr>
<tr>
<td><strong>STATUS_INTEGER_OVERFLOW</strong></td>
<td>The driver set the <strong>UseContextForQuery</strong> member of the <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure to <strong>TRUE</strong> but specified a context space size that is larger than <a href="ulong_max" title="#define ULONG_MAX 0xffffffffUL">ULONG_MAX</a> in the <strong>InstanceAttributes</strong> parameter's <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure.</td>
</tr>
</tbody>
</table>
<p>For a list of other return values that the <strong>WdfWmiInstanceCreate</strong> method might return, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/framework-object-creation-errors">Framework Object Creation Errors</a>.</p>
<p>This method also might return other <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS values</a>.</p>
<p>A bug check occurs if the driver supplies an invalid object handle.</p>
<h2>Remarks</h2>
<p>If a driver is creating multiple instances of a provider, the driver must call <a href="wdfwmiprovidercreate" title="NTSTATUS WdfWmiProviderCreate(&#10;  [in]           WDFDEVICE                Device,&#10;  [in]           PWDF_WMI_PROVIDER_CONFIG WmiProviderConfig,&#10;  [in, optional] PWDF_OBJECT_ATTRIBUTES   ProviderAttributes,&#10;  [out]          WDFWMIPROVIDER           *WmiProvider&#10;);">WdfWmiProviderCreate</a> to create a provider object before calling <strong>WdfWmiInstanceCreate</strong>. The driver passes the provider object's handle to <strong>WdfWmiInstanceCreate</strong> by placing the handle in a <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure. (If the driver supplies a provider object handle, the <strong>Device</strong> parameter is not used and can be <strong>NULL</strong>.)</p>
<p>If the driver is creating a single instance of a provider, it does not have to call <strong>WdfWmiInstanceCreate</strong> before calling <strong>WdfWmiInstanceCreate</strong>. In this case, <strong>WdfWmiInstanceCreate</strong> also creates a WMI provider object. Therefore, the driver's <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure must include a pointer to a <a href="wdf_wmi_provider_config" title="typedef struct _WDF_WMI_PROVIDER_CONFIG {&#10;  ULONG                                 Size;&#10;  GUID                                  Guid;&#10;  ULONG                                 Flags;&#10;  ULONG                                 MinInstanceBufferSize;&#10;  PFN_WDF_WMI_PROVIDER_FUNCTION_CONTROL EvtWmiProviderFunctionControl;&#10;} WDF_WMI_PROVIDER_CONFIG, *PWDF_WMI_PROVIDER_CONFIG;">WDF_WMI_PROVIDER_CONFIG</a> structure that describes the WMI data provider.</p>
<p>The framework instructs WMI to create a dynamic instance name, which applications can use, from the device instance ID of the driver's physical device object (PDO). (The framework does not support static instance names that Windows Driver Model (WDM) drivers set in an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-reginfo">IRP_MN_REGINFO</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-reginfo-ex">IRP_MN_REGINFO_EX</a> structure.)</p>
<p>The WMI instance object's parent is the WMI provider object. The driver cannot change this parent, and the <strong>ParentObject</strong> member or the <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure must be <strong>NULL</strong>.</p>
<p>After the driver calls <strong>WdfWmiInstanceCreate</strong>, it can call <a href="wdfwmiinstancegetprovider" title="WDFWMIPROVIDER WdfWmiInstanceGetProvider(&#10;  [in] WDFWMIINSTANCE WmiInstance&#10;);">WdfWmiInstanceGetProvider</a> to obtain a handle to the parent provider object and <a href="wdfwmiinstancegetdevice" title="WDFDEVICE WdfWmiInstanceGetDevice(&#10;  [in] WDFWMIINSTANCE WmiInstance&#10;);">WdfWmiInstanceGetDevice</a> to obtain a handle to the provider's device.</p>
<p>For more information about the <strong>WdfWmiInstanceCreate</strong> method, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/supporting-wmi-in-kmdf-drivers">Supporting WMI in Framework-Based Drivers</a>.</p>
<p>If the <strong>Register</strong> member of the <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure that <strong>InstanceConfig</strong> points to is <strong>TRUE</strong>, <strong>WdfWmiInstanceCreate</strong> registers the provider instance synchronously (that is, before returning) if this method is called at IRQL = PASSIVE_LEVEL and asynchronously if it is called at IRQL &gt; PASSIVE_LEVEL.</p>
<h4>Examples</h4>
<p>The following code example is from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/sample-kmdf-drivers">PCIDRV</a> sample driver. This example registers a MOF resource name for a device, initializes a <a href="wdf_wmi_provider_config" title="typedef struct _WDF_WMI_PROVIDER_CONFIG {&#10;  ULONG                                 Size;&#10;  GUID                                  Guid;&#10;  ULONG                                 Flags;&#10;  ULONG                                 MinInstanceBufferSize;&#10;  PFN_WDF_WMI_PROVIDER_FUNCTION_CONTROL EvtWmiProviderFunctionControl;&#10;} WDF_WMI_PROVIDER_CONFIG, *PWDF_WMI_PROVIDER_CONFIG;">WDF_WMI_PROVIDER_CONFIG</a> structure and a <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a> structure, and calls <strong>WdfWmiInstanceCreate</strong>.</p>
<pre><code class="language-cpp"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
PciDrvWmiRegistration(
    WDFDEVICE  Device
    )
{
    <a href="wdf_wmi_provider_config" title="typedef struct _WDF_WMI_PROVIDER_CONFIG {&#10;  ULONG                                 Size;&#10;  GUID                                  Guid;&#10;  ULONG                                 Flags;&#10;  ULONG                                 MinInstanceBufferSize;&#10;  PFN_WDF_WMI_PROVIDER_FUNCTION_CONTROL EvtWmiProviderFunctionControl;&#10;} WDF_WMI_PROVIDER_CONFIG, *PWDF_WMI_PROVIDER_CONFIG;">WDF_WMI_PROVIDER_CONFIG</a>  providerConfig;
    <a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a>  instanceConfig;
    <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>  status;
    <a href="declare_const_unicode_string" title="#define DECLARE_CONST_UNICODE_STRING(_var, _str) \&#10;const WCHAR _var ## _buffer[] = _str; \&#10;const UNICODE_STRING _var = { sizeof(_str) - sizeof(WCHAR), sizeof(_str), (PWCH) _var ## _buffer }">DECLARE_CONST_UNICODE_STRING</a>(mofRsrcName, MOFRESOURCENAME);

    status = <a href="wdfdeviceassignmofresourcename" title="NTSTATUS WdfDeviceAssignMofResourceName(&#10;  [in] WDFDEVICE        Device,&#10;  [in] PCUNICODE_STRING MofResourceName&#10;);">WdfDeviceAssignMofResourceName</a>(
                                            Device,
                                            &amp;mofRsrcName
                                            );
    if (!<a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a>(status)) {
        return status;
    }
    <a href="wdf_wmi_provider_config_init" title="VOID WDF_WMI_PROVIDER_CONFIG_INIT(&#10;  [out] PWDF_WMI_PROVIDER_CONFIG Config,&#10;  [in]  const GUID               *Guid&#10;);">WDF_WMI_PROVIDER_CONFIG_INIT</a>(
                                 &amp;providerConfig,
                                 &amp;PCIDRV_WMI_STD_DATA_GUID
                                 );
    providerConfig.MinInstanceBufferSize = sizeof(PCIDRV_WMI_STD_DATA);

    <a href="wdf_wmi_instance_config_init_provider_config" title="VOID WDF_WMI_INSTANCE_CONFIG_INIT_PROVIDER_CONFIG(&#10;  [out] PWDF_WMI_INSTANCE_CONFIG Config,&#10;  [in]  PWDF_WMI_PROVIDER_CONFIG ProviderConfig&#10;);">WDF_WMI_INSTANCE_CONFIG_INIT_PROVIDER_CONFIG</a>(
                                                 &amp;instanceConfig,
                                                 &amp;providerConfig
                                                 );
    instanceConfig.Register = TRUE;
    instanceConfig.EvtWmiInstanceQueryInstance = EvtWmiDeviceInfoQueryInstance;
    instanceConfig.EvtWmiInstanceSetInstance = EvtWmiDeviceInfoSetInstance;

    status = WdfWmiInstanceCreate(
                                  Device,
                                  &amp;instanceConfig,
                                  WDF_NO_OBJECT_ATTRIBUTES,
                                  WDF_NO_HANDLE
                                  );
    if (!<a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a>(status)) {
        return status;
    }
    return status;
}
</code></pre>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mn-reginfo">IRP_MN_REGINFO</a></p>
<p><a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a></p>
<p><a href="wdf_wmi_instance_config" title="typedef struct _WDF_WMI_INSTANCE_CONFIG {&#10;  ULONG                               Size;&#10;  WDFWMIPROVIDER                      Provider;&#10;  PWDF_WMI_PROVIDER_CONFIG            ProviderConfig;&#10;  BOOLEAN                             UseContextForQuery;&#10;  BOOLEAN                             Register;&#10;  PFN_WDF_WMI_INSTANCE_QUERY_INSTANCE EvtWmiInstanceQueryInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_INSTANCE   EvtWmiInstanceSetInstance;&#10;  PFN_WDF_WMI_INSTANCE_SET_ITEM       EvtWmiInstanceSetItem;&#10;  PFN_WDF_WMI_INSTANCE_EXECUTE_METHOD EvtWmiInstanceExecuteMethod;&#10;} WDF_WMI_INSTANCE_CONFIG, *PWDF_WMI_INSTANCE_CONFIG;">WDF_WMI_INSTANCE_CONFIG</a></p>
<p><a href="wdf_wmi_instance_config_init_provider_config" title="VOID WDF_WMI_INSTANCE_CONFIG_INIT_PROVIDER_CONFIG(&#10;  [out] PWDF_WMI_INSTANCE_CONFIG Config,&#10;  [in]  PWDF_WMI_PROVIDER_CONFIG ProviderConfig&#10;);">WDF_WMI_INSTANCE_CONFIG_INIT_PROVIDER_CONFIG</a></p>
<p><a href="wdf_wmi_provider_config" title="typedef struct _WDF_WMI_PROVIDER_CONFIG {&#10;  ULONG                                 Size;&#10;  GUID                                  Guid;&#10;  ULONG                                 Flags;&#10;  ULONG                                 MinInstanceBufferSize;&#10;  PFN_WDF_WMI_PROVIDER_FUNCTION_CONTROL EvtWmiProviderFunctionControl;&#10;} WDF_WMI_PROVIDER_CONFIG, *PWDF_WMI_PROVIDER_CONFIG;">WDF_WMI_PROVIDER_CONFIG</a></p>
<p><a href="wdf_wmi_provider_config_init" title="VOID WDF_WMI_PROVIDER_CONFIG_INIT(&#10;  [out] PWDF_WMI_PROVIDER_CONFIG Config,&#10;  [in]  const GUID               *Guid&#10;);">WDF_WMI_PROVIDER_CONFIG_INIT</a></p>
<p><a href="wdfdeviceassignmofresourcename" title="NTSTATUS WdfDeviceAssignMofResourceName(&#10;  [in] WDFDEVICE        Device,&#10;  [in] PCUNICODE_STRING MofResourceName&#10;);">WdfDeviceAssignMofResourceName</a></p>
<p><a href="wdfwmiinstancegetdevice" title="WDFDEVICE WdfWmiInstanceGetDevice(&#10;  [in] WDFWMIINSTANCE WmiInstance&#10;);">WdfWmiInstanceGetDevice</a></p>
<p><a href="wdfwmiinstancegetprovider" title="WDFWMIPROVIDER WdfWmiInstanceGetProvider(&#10;  [in] WDFWMIINSTANCE WmiInstance&#10;);">WdfWmiInstanceGetProvider</a></p>
<p><a href="wdfwmiprovidercreate" title="NTSTATUS WdfWmiProviderCreate(&#10;  [in]           WDFDEVICE                Device,&#10;  [in]           PWDF_WMI_PROVIDER_CONFIG WmiProviderConfig,&#10;  [in, optional] PWDF_OBJECT_ATTRIBUTES   ProviderAttributes,&#10;  [out]          WDFWMIPROVIDER           *WmiProvider&#10;);">WdfWmiProviderCreate</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfwmi/nf-wdfwmi-wdfwmiinstancecreate">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfwmi/nf-wdfwmi-wdfwmiinstancecreate.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
