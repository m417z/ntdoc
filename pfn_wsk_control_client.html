<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFN_WSK_CONTROL_CLIENT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFN_WSK_CONTROL_CLIENT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFN_WSK_CONTROL_CLIENT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wsk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFN_WSK_CONTROL_CLIENT PfnWskControlClient;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PfnWskControlClient(
  [in]            PWSK_CLIENT Client,
  [in]            <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ControlCode,
  [in]            <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> InputSize,
  [in, optional]  PVOID InputBuffer,
  [in]            <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> OutputSize,
  [out, optional] PVOID OutputBuffer,
  [out, optional] <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> *OutputSizeReturned,
  [in, out]       PIRP Irp
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_control_client">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfn_wsk_control_client.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wsk-pfn_wsk_control_client)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pfn_wsk_control_client-callback-function">PFN_WSK_CONTROL_CLIENT callback function</h1>

<h2 id="description">Description</h2>

<p>The <strong>WskControlClient</strong> function performs control operations on a WSK client object.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="client-in"><code>Client</code> [in]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/wsk-client">WSK_CLIENT</a> structure that was returned through the <em>WskProviderNpi</em> parameter of the  <a href="wskcaptureprovidernpi" title="NTSTATUS WskCaptureProviderNPI(&#10;  [in]  PWSK_REGISTRATION WskRegistration,&#10;  [in]  ULONG             WaitTimeout,&#10;  [out] PWSK_PROVIDER_NPI WskProviderNpi&#10;);">WskCaptureProviderNPI</a> function.</p>

<h3 id="controlcode-in"><code>ControlCode</code> [in]</h3>

<p>The control operation that is being performed. A WSK application can specify one of the following control codes:</p>

<h4 id="wsk_transport_list_query">WSK_TRANSPORT_LIST_QUERY</h4>

<p>Retrieve a list of available network transports.</p>

<h4 id="wsk_transport_list_change">WSK_TRANSPORT_LIST_CHANGE</h4>

<p>Receive notification of a change to the list of available network transports.</p>

<h4 id="wsk_cache_sd">WSK_CACHE_SD</h4>

<p>Obtain a cached copy of a security descriptor.</p>

<h4 id="wsk_release_sd">WSK_RELEASE_SD</h4>

<p>Release a cached copy of a security descriptor.</p>

<h4 id="wsk_set_static_event_callbacks">WSK_SET_STATIC_EVENT_CALLBACKS</h4>

<p>Enable specified event callback functions automatically on all sockets.</p>

<h4 id="wsk_tdi_devicename_mapping">WSK_TDI_DEVICENAME_MAPPING</h4>

<p>Map combinations of address family, socket type, and protocol to device names of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff565094(v=vs.85)">TDI</a> transports.</p>

<h4 id="wsk_tdi_behavior">WSK_TDI_BEHAVIOR</h4>

<p>Control whether the WSK subsystem will divert network I/O to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff565094(v=vs.85)">TDI</a> transports.</p>

<h3 id="inputsize-in"><code>InputSize</code> [in]</h3>

<p>The number of bytes of data in the buffer that is pointed to by the <em>InputBuffer</em> parameter.</p>

<h3 id="inputbuffer-in-optional"><code>InputBuffer</code> [in, optional]</h3>

<p>A caller-allocated buffer that supplies any input data that is required to perform the specified control operation. If no input data is required for the specified control operation, the WSK application should set this parameter to <strong>NULL</strong> and set the <em>InputSize</em> parameter to zero.</p>

<h3 id="outputsize-in"><code>OutputSize</code> [in]</h3>

<p>The size, in bytes, of the buffer that is pointed to by the <em>OutputBuffer</em> parameter.</p>

<h3 id="outputbuffer-out-optional"><code>OutputBuffer</code> [out, optional]</h3>

<p>A caller-allocated buffer that receives any output data that is returned by the specified control operation. If no output data is returned by the specified control operation, the WSK application should set this parameter to <strong>NULL</strong> and set the <em>OutputSize</em> parameter to zero.</p>

<h3 id="outputsizereturned-out-optional"><code>OutputSizeReturned</code> [out, optional]</h3>

<p>A pointer to a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>-typed variable that receives the number of bytes of data that is returned in the buffer that is pointed to by the <em>OutputBuffer</em> parameter. A WSK application should set this pointer to <strong>NULL</strong> except when all of the following are true:</p>

<ul>
<li>The <em>Irp</em> parameter is <strong>NULL</strong>.</li>
<li>The operation that is being performed returns output data in the buffer that is pointed to by the <em>OutputBuffer</em> parameter.</li>
<li>The number of bytes of output data that is returned by the operation that is being performed is unknown.</li>
</ul>

<h3 id="irp-in-out"><code>Irp</code> [in, out]</h3>

<p>A pointer to a caller-allocated <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> that the WSK subsystem uses to complete the control operation asynchronously. For more information about using IRPs with WSK functions, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/using-irps-with-winsock-kernel-functions">Using IRPs with Winsock Kernel Functions</a>.</p>

<p>This parameter is required, is optional, or must be <strong>NULL</strong>, depending on the particular client control operation that is being performed. For more information about the requirements for this parameter for each of the supported client control operations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/performing-control-operations-on-a-client-object">WSK Client Control Operations</a>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>WskControlClient</strong> returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The control operation completed successfully. If the WSK application specified a pointer to an <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> in the _Irp_ parameter, the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> will be completed with success status.</td>
</tr>
<tr>
  <td><strong>STATUS_PENDING</strong></td>
  <td>The WSK subsystem could not complete the control operation immediately. The WSK subsystem will complete the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> after it has completed the control operation. The status of the control operation will be returned in the <strong>IoStatus.Status</strong> field of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a>.</td>
</tr>
<tr>
  <td><strong>STATUS_BUFFER_OVERFLOW</strong></td>
  <td>The output buffer is not large enough to contain the returned data. The variable that is pointed to by the _OutputSizeReturned_ parameter contains the required buffer size.</td>
</tr>
<tr>
  <td><strong>Other status codes</strong></td>
  <td>An error occurred. The <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> will be completed with failure status.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>For more information about how the input and output buffers are used for each client control operation, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/performing-control-operations-on-a-client-object">WSK Client Control Operations</a>.</p>

<p>If the <strong>WskControlClient</strong> function returns STATUS_PENDING, any buffers that are pointed to by the <em>InputBuffer</em> parameter or the <em>OutputBuffer</em> parameter must remain valid until the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> is completed. If the WSK application allocated the buffers with one of the <strong>ExAllocate*Xxx</strong>* functions, it cannot free the memory with the corresponding <strong>ExFree*Xxx</strong>* function until after the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> is completed. If the WSK application allocated the buffers on the stack, it cannot return from the function that calls the <strong>WskControlClient</strong> function until after the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> is completed.</p>

<p><strong>Note</strong> TDI will not be supported in Microsoft Windows versions after Windows Vista. Use <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">Windows Filtering Platform</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">Winsock Kernel</a> instead.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/performing-control-operations-on-a-client-object">WSK Client Control Operations</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/wsk-client">WSK_CLIENT</a></p>

<p><a href="wsk_provider_dispatch" title="typedef struct _WSK_PROVIDER_DISPATCH {&#10;  USHORT                    Version;&#10;  USHORT                    Reserved;&#10;  PFN_WSK_SOCKET            WskSocket;&#10;  PFN_WSK_SOCKET_CONNECT    WskSocketConnect;&#10;  PFN_WSK_CONTROL_CLIENT    WskControlClient;&#10;  PFN_WSK_GET_ADDRESS_INFO  WskGetAddressInfo;&#10;  PFN_WSK_FREE_ADDRESS_INFO WskFreeAddressInfo;&#10;  PFN_WSK_GET_NAME_INFO     WskGetNameInfo;&#10;} WSK_PROVIDER_DISPATCH, *PWSK_PROVIDER_DISPATCH;">WSK_PROVIDER_DISPATCH</a></p>

<p><a href="wsk_provider_npi" title="typedef struct _WSK_PROVIDER_NPI {&#10;  PWSK_CLIENT                 Client;&#10;  const WSK_PROVIDER_DISPATCH *Dispatch;&#10;} WSK_PROVIDER_NPI, *PWSK_PROVIDER_NPI;">WSK_PROVIDER_NPI</a></p>

<p><a href="wsk_transport" title="typedef struct _WSK_TRANSPORT {&#10;  USHORT         Version;&#10;  USHORT         SocketType;&#10;  ULONG          Protocol;&#10;  ADDRESS_FAMILY AddressFamily;&#10;  GUID           ProviderId;&#10;} WSK_TRANSPORT, *PWSK_TRANSPORT;">WSK_TRANSPORT</a></p>

<p><a href="wskcaptureprovidernpi" title="NTSTATUS WskCaptureProviderNPI(&#10;  [in]  PWSK_REGISTRATION WskRegistration,&#10;  [in]  ULONG             WaitTimeout,&#10;  [out] PWSK_PROVIDER_NPI WskProviderNpi&#10;);">WskCaptureProviderNPI</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wsk/nc-wsk-pfn_wsk_control_client">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wsk/nc-wsk-pfn_wsk_control_client.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
