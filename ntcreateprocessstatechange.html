<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtCreateProcessStateChange - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtCreateProcessStateChange - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtCreateProcessStateChange - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTPSAPI_H
#if (PHNT_VERSION &gt;= PHNT_WIN11)

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtCreateProcessStateChange(
    _Out_ PHANDLE ProcessStateChangeHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ HANDLE ProcessHandle,
    _In_opt_ _Reserved_ <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> Reserved
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/04e6539d4c389b219a35eb85d526d574d7e174b1/phnt/include/ntpsapi.h#L1575">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwCreateProcessStateChange(
    _Out_ PHANDLE ProcessStateChangeHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_opt_ <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ HANDLE ProcessHandle,
    _In_opt_ _Reserved_ <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> Reserved
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/04e6539d4c389b219a35eb85d526d574d7e174b1/phnt/include/ntzwapi.h#L1166">View code on GitHub</a></span></code></pre></div>
</div>
<div class="ntdoc-description">
<p>Creates a new process state object. This object offers a more resilient alternative to suspending processes, tying the duration of the operation to the lifetime of the state object. To change the state of the process state object, use <code><a href="ntchangeprocessstate" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtChangeProcessState(&#10;    _In_ HANDLE ProcessStateChangeHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_ PROCESS_STATE_CHANGE_TYPE StateChangeType,&#10;    _In_opt_ _Reserved_ PVOID ExtendedInformation,&#10;    _In_opt_ _Reserved_ SIZE_T ExtendedInformationLength,&#10;    _In_opt_ _Reserved_ ULONG64 Reserved&#10;    );">NtChangeProcessState</a></code>.</p>

<h1 id="parameters">Parameters</h1>

<ul>
<li><code>ProcessStateChangeHandle</code> - a pointer to a variable that receives a handle to the new process state object.</li>
<li><code>DesiredAccess</code> - the access mask to provide on the returned handle. This value is usually <code>PROCESS_STATE_ALL_ACCESS</code>.</li>
<li><code>ObjectAttributes</code> - an optional pointer to an <code><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PVOID SecurityDescriptor; // PSECURITY_DESCRIPTOR;&#10;    PVOID SecurityQualityOfService; // PSECURITY_QUALITY_OF_SERVICE&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></code> structure that specifies attributes of the new object/handle.</li>
<li><code>ProcessHandle</code> - a handle to the associated process. The handle must grant <code><a href="process_set_information" title="#define PROCESS_SET_INFORMATION 0x0200">PROCESS_SET_INFORMATION</a></code> access.</li>
<li><code>Reserved</code> - this parameter is unused and should be set to zero.</li>
</ul>

<h1 id="remarks">Remarks</h1>

<p>To avoid retaining unused resources, call <code><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">NtClose</a></code> to close the returned handle when it is no longer required. When the reference counter on the process state object drops to zero, the system automatically undoes the effect of the state changes on the associated process.</p>

<h1 id="related-win32-api">Related Win32 API</h1>

<p>This functionality is not exposed in Win32 API.</p>

<h1 id="required-os-version">Required OS version</h1>

<p>This function was introduced in Windows 11.</p>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntchangeprocessstate" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtChangeProcessState(&#10;    _In_ HANDLE ProcessStateChangeHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_ PROCESS_STATE_CHANGE_TYPE StateChangeType,&#10;    _In_opt_ _Reserved_ PVOID ExtendedInformation,&#10;    _In_opt_ _Reserved_ SIZE_T ExtendedInformationLength,&#10;    _In_opt_ _Reserved_ ULONG64 Reserved&#10;    );">NtChangeProcessState</a></code></li>
<li><code><a href="ntopenprocess" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenProcess(&#10;    _Out_ PHANDLE ProcessHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PCLIENT_ID ClientId&#10;    );">NtOpenProcess</a></code></li>
<li><code><a href="ntsuspendprocess" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSuspendProcess(&#10;    _In_ HANDLE ProcessHandle&#10;    );">NtSuspendProcess</a></code></li>
<li><code><a href="ntcreatethreadstatechange" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateThreadStateChange(&#10;    _Out_ PHANDLE ThreadStateChangeHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE ThreadHandle,&#10;    _In_opt_ ULONG64 Reserved&#10;    );">NtCreateThreadStateChange</a></code></li>
</ul>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntcreateprocessstatechange.md">Edit description on GitHub</a>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
