<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="EtwWriteEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EtwWriteEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            EtwWriteEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> EtwWriteEx(
  [in]           <a href="reghandle" title="typedef ULONGLONG REGHANDLE, *PREGHANDLE;">REGHANDLE</a>              RegHandle,
  [in]           <a href="pcevent_descriptor" title="typedef const EVENT_DESCRIPTOR* PCEVENT_DESCRIPTOR;">PCEVENT_DESCRIPTOR</a>     EventDescriptor,
  [in]           <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a>                Filter,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                  Flags,
  [in, optional] LPCGUID                ActivityId,
  [in, optional] LPCGUID                RelatedActivityId,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                  UserDataCount,
  [in, optional] <a href="event_data_descriptor" title="typedef struct _EVENT_DATA_DESCRIPTOR EVENT_DATA_DESCRIPTOR, *PEVENT_DATA_DESCRIPTOR;">PEVENT_DATA_DESCRIPTOR</a> UserData
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-etwwriteex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/etwwriteex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-etwwriteex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="etwwriteex-function">EtwWriteEx function</h1>

<h2 id="description">Description</h2>

<p>The <strong>EtwWriteEx</strong> function is a tracing function for publishing events that support filtering in your kernel-mode driver code.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="reghandle-in"><code>RegHandle</code> [in]</h3>

<p>A pointer to the event provider registration handle, which is returned by the <a href="etwregister" title="NTSTATUS EtwRegister(&#10;  [in]           LPCGUID            ProviderId,&#10;  [in, optional] PETWENABLECALLBACK EnableCallback,&#10;  [in, optional] PVOID              CallbackContext,&#10;  [out]          PREGHANDLE         RegHandle&#10;);">EtwRegister</a> function if the event provider registration is successful.</p>

<h3 id="eventdescriptor-in"><code>EventDescriptor</code> [in]</h3>

<p>A pointer to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/ns-evntprov-event_descriptor">EVENT_DESCRIPTOR</a> structure.</p>

<h3 id="filter-in"><code>Filter</code> [in]</h3>

<p>The instance identifiers that identify the session to which the event will not written. That is, the value is a mask of sessions which should be excluded from logging (filtered out). Use a bitwise OR to specify multiple identifiers. Set to zero if you do not support filters or if the event is being written to all sessions (no filters failed). For information on getting the identifier for a session, see the <em>FilterData</em> parameter of your <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-etwenablecallback">EtwEnableCallback</a> callback.</p>

<h3 id="flags-in"><code>Flags</code> [in]</h3>

<p>Reserved. Must be zero (0).</p>

<h3 id="activityid-in-optional"><code>ActivityId</code> [in, optional]</h3>

<p>The identifier that indicates the activity associated with the event. The <em>ActivityID</em> provides a way to group related events and is used in end-to-end tracing. If NULL, ETW gets the identifier from the thread local storage. For details on getting this identifier, see <a href="etwactivityidcontrol" title="NTSTATUS EtwActivityIdControl(&#10;  [in]      ULONG  ControlCode,&#10;  [in, out] LPGUID ActivityId&#10;);">EtwActivityIdControl</a>.</p>

<h3 id="relatedactivityid-in-optional"><code>RelatedActivityId</code> [in, optional]</h3>

<p>Activity identifier from the previous component. Use this parameter to link your component's events to the previous component's events. To get the activity identifier that was set for the previous component, see the descriptions for the <em>ControlCode</em> parameter of the <a href="etwactivityidcontrol" title="NTSTATUS EtwActivityIdControl(&#10;  [in]      ULONG  ControlCode,&#10;  [in, out] LPGUID ActivityId&#10;);">EtwActivityIdControl</a> function.</p>

<h3 id="userdatacount-in"><code>UserDataCount</code> [in]</h3>

<p>Number of <a href="event_data_descriptor" title="typedef struct _EVENT_DATA_DESCRIPTOR EVENT_DATA_DESCRIPTOR, *PEVENT_DATA_DESCRIPTOR;">EVENT_DATA_DESCRIPTOR</a> structures in <em>UserData</em>. The maximum number is 128.</p>

<h3 id="userdata-in-optional"><code>UserData</code> [in, optional]</h3>

<p>A pointer to the array of <a href="event_data_descriptor" title="typedef struct _EVENT_DATA_DESCRIPTOR EVENT_DATA_DESCRIPTOR, *PEVENT_DATA_DESCRIPTOR;">EVENT_DATA_DESCRIPTOR</a> structures. Set this parameter to NULL if <em>UserDataCount</em> is zero. The data must be in the order specified in the manifest.</p>

<h2 id="return-value">Return value</h2>

<p>Returns ERROR_SUCCESS if successful or one of the following values on error.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>EtwWriteEx</strong> function is the kernel-mode equivalent of the user-mode <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwriteex">EventWriteEx</a> function. Event data written with this function requires a manifest. The manifest is embedded in the provider, so the provider must be available for a consumer to consume the data. To ensure that there is a consumer for the event you are publishing, you can precede the call to <strong><a href="etwwrite" title="NTSTATUS EtwWrite(&#10;  [in]           REGHANDLE              RegHandle,&#10;  [in]           PCEVENT_DESCRIPTOR     EventDescriptor,&#10;  [in, optional] LPCGUID                ActivityId,&#10;  [in]           ULONG                  UserDataCount,&#10;  [in, optional] PEVENT_DATA_DESCRIPTOR UserData&#10;);">EtwWrite</a></strong> with a call to <a href="etweventenabled" title="NTSYSAPI&#10;BOOLEAN&#10;NTAPI&#10;EtwEventEnabled(&#10;    _In_ REGHANDLE RegHandle,&#10;    _In_ PCEVENT_DESCRIPTOR EventDescriptor&#10;    );">EtwEventEnabled</a> or <a href="etwproviderenabled" title="BOOLEAN EtwProviderEnabled(&#10;  [in] REGHANDLE RegHandle,&#10;  [in] UCHAR     Level,&#10;  [in] ULONGLONG Keyword&#10;);">EtwProviderEnabled</a>.</p>

<p>Use the <em>ActivityId</em> and <em>RelatedActivityId</em> parameters when you want to relate events in different components in an end-to-end tracing scenario. For example, components A, B, and C perform work on a related activity and want to link their events so that a consumer can consume all the events related to that activity.</p>

<p>You can call <strong>EtwWriteEx</strong> at any IRQL. However, when IRQL is greater than APC_LEVEL, any data passed to the <strong><a href="etwwrite" title="NTSTATUS EtwWrite(&#10;  [in]           REGHANDLE              RegHandle,&#10;  [in]           PCEVENT_DESCRIPTOR     EventDescriptor,&#10;  [in, optional] LPCGUID                ActivityId,&#10;  [in]           ULONG                  UserDataCount,&#10;  [in, optional] PEVENT_DATA_DESCRIPTOR UserData&#10;);">EtwWrite</a></strong>, <strong>EtwWriteEx</strong>, <strong><a href="etwwritestring" title="NTSTATUS EtwWriteString(&#10;  [in]           REGHANDLE RegHandle,&#10;  [in]           UCHAR     Level,&#10;  [in]           ULONGLONG Keyword,&#10;  [in, optional] LPCGUID   ActivityId,&#10;  [in]           PCWSTR    String&#10;);">EtwWriteString</a></strong>, <strong><a href="etwwritetransfer" title="NTSTATUS EtwWriteTransfer(&#10;  [in]           REGHANDLE              RegHandle,&#10;  [in]           PCEVENT_DESCRIPTOR     EventDescriptor,&#10;  [in, optional] LPCGUID                ActivityId,&#10;  [in, optional] LPCGUID                RelatedActivityId,&#10;  [in]           ULONG                  UserDataCount,&#10;  [in, optional] PEVENT_DATA_DESCRIPTOR UserData&#10;);">EtwWriteTransfer</a></strong> functions must not be pageable. That is, any kernel-mode routine that is running at IRQL greater than APC_LEVEL cannot access pageable memory. Data passed to the <strong><a href="etwwrite" title="NTSTATUS EtwWrite(&#10;  [in]           REGHANDLE              RegHandle,&#10;  [in]           PCEVENT_DESCRIPTOR     EventDescriptor,&#10;  [in, optional] LPCGUID                ActivityId,&#10;  [in]           ULONG                  UserDataCount,&#10;  [in, optional] PEVENT_DATA_DESCRIPTOR UserData&#10;);">EtwWrite</a></strong>, <strong>EtwWriteEx</strong>, <strong><a href="etwwritestring" title="NTSTATUS EtwWriteString(&#10;  [in]           REGHANDLE RegHandle,&#10;  [in]           UCHAR     Level,&#10;  [in]           ULONGLONG Keyword,&#10;  [in, optional] LPCGUID   ActivityId,&#10;  [in]           PCWSTR    String&#10;);">EtwWriteString</a></strong>, and <strong><a href="etwwritetransfer" title="NTSTATUS EtwWriteTransfer(&#10;  [in]           REGHANDLE              RegHandle,&#10;  [in]           PCEVENT_DESCRIPTOR     EventDescriptor,&#10;  [in, optional] LPCGUID                ActivityId,&#10;  [in, optional] LPCGUID                RelatedActivityId,&#10;  [in]           ULONG                  UserDataCount,&#10;  [in, optional] PEVENT_DATA_DESCRIPTOR UserData&#10;);">EtwWriteTransfer</a></strong> functions must reside in system-space memory, regardless of what the IRQL is.</p>

<h2 id="see-also">See also</h2>

<p><a href="etwwrite" title="NTSTATUS EtwWrite(&#10;  [in]           REGHANDLE              RegHandle,&#10;  [in]           PCEVENT_DESCRIPTOR     EventDescriptor,&#10;  [in, optional] LPCGUID                ActivityId,&#10;  [in]           ULONG                  UserDataCount,&#10;  [in, optional] PEVENT_DATA_DESCRIPTOR UserData&#10;);">EtwWrite</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwrite">EventWrite</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwriteex">EventWriteEx</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-etwwriteex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-etwwriteex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
