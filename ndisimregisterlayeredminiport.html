<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisIMRegisterLayeredMiniport - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisIMRegisterLayeredMiniport - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisIMRegisterLayeredMiniport - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_STATUS NdisIMRegisterLayeredMiniport(
  [in]  NDIS_HANDLE                    NdisWrapperHandle,
  [in]  PNDIS_MINIPORT_CHARACTERISTICS MiniportCharacteristics,
  [in]  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                           CharacteristicsLength,
  [out] PNDIS_HANDLE                   DriverHandle
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisimregisterlayeredminiport">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndisimregisterlayeredminiport.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndisimregisterlayeredminiport)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndisimregisterlayeredminiport-function">NdisIMRegisterLayeredMiniport function</h1>

<h2 id="description">Description</h2>

<p><strong>Note</strong> NDIS 5. <em>x</em> has been deprecated and is superseded by NDIS 6. <em>x</em>. For new NDIS driver development, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">Network Drivers Starting with Windows Vista</a>. For information about porting NDIS 5. <em>x</em> drivers to NDIS 6. <em>x</em>, see <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff570059">Porting NDIS 5.x Drivers to NDIS 6.0</a>.</p>

<p><strong>NdisIMRegisterLayeredMiniport</strong> registers an intermediate driver's <em>MiniportXxx</em> entry points and name with the NDIS library when the driver initializes.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="ndiswrapperhandle-in"><code>NdisWrapperHandle</code> [in]</h3>

<p>Specifies the handle returned by <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553547/(v=vs.85/)"><strong>NdisMInitializeWrapper</strong></a>.</p>

<h3 id="miniportcharacteristics-in"><code>MiniportCharacteristics</code> [in]</h3>

<p>Pointer to an NDIS <em>XX</em>_MINIPORT_CHARACTERISTICS structure set up by the caller. The structure at <em>MiniportCharacteristics</em> is defined as follows:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="w">        </span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_NDIS_MINIPORT_CHARACTERISTICS</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n"><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></span><span class="w"> </span><span class="n">MajorNdisVersion</span><span class="p">;</span>
<span class="w">            </span><span class="n"><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></span><span class="w"> </span><span class="n">MinorNdisVersion</span><span class="p">;</span>
<span class="w">            </span><span class="n"><a href="uint" title="typedef unsigned int UINT;">UINT</a></span><span class="w"> </span><span class="n">Reserved</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_CHECK_FOR_HANG_HANDLER</span><span class="w"> </span><span class="n">CheckForHangHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_DISABLE_INTERRUPT_HANDLER</span><span class="w"> </span><span class="n">DisableInterruptHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_ENABLE_INTERRUPT_HANDLER</span><span class="w">  </span><span class="n">EnableInterruptHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_HALT_HANDLER</span><span class="w"> </span><span class="n">HaltHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_HANDLE_INTERRUPT_HANDLER</span><span class="w">  </span><span class="n">HandleInterruptHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_INITIALIZE_HANDLER</span><span class="w"> </span><span class="n">InitializeHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_ISR_HANDLER</span><span class="w"> </span><span class="n">ISRHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_QUERY_INFORMATION_HANDLER</span><span class="w"> </span><span class="n">QueryInformationHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_RECONFIGURE_HANDLER</span><span class="w"> </span><span class="n">ReconfigureHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_RESET_HANDLER</span><span class="w"> </span><span class="n">ResetHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_SEND_HANDLER</span><span class="w"> </span><span class="n">SendHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_SET_INFORMATION_HANDLER</span><span class="w"> </span><span class="n">SetInformationHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_TRANSFER_DATA_HANDLER</span><span class="w"> </span><span class="n">TransferDataHandler</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Version used is V4.0 or V5.0</span>
<span class="w">        </span><span class="c1">// with following members</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">            </span><span class="n">W_RETURN_PACKET_HANDLER</span><span class="w"> </span><span class="n">ReturnPacketHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_SEND_PACKETS_HANDLER</span><span class="w"> </span><span class="n">SendPacketsHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_ALLOCATE_COMPLETE_HANDLER</span><span class="w"> </span><span class="n">AllocateCompleteHandler</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Version used is V5.0 with the following members</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">            </span><span class="n">W_CO_CREATE_VC_HANDLER</span><span class="w"> </span><span class="n">CoCreateVcHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_CO_DELETE_VC_HANDLER</span><span class="w"> </span><span class="n">CoDeleteVcHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_CO_ACTIVATE_VC_HANDLER</span><span class="w"> </span><span class="n">CoActivateVcHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_CO_DEACTIVATE_VC_HANDLER</span><span class="w"> </span><span class="n">CoDeactivateVcHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_CO_SEND_PACKETS_HANDLER</span><span class="w"> </span><span class="n">CoSendPacketsHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_CO_REQUEST_HANDLER</span><span class="w"> </span><span class="n">CoRequestHandler</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Version used is V5.1 with the following members</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">            </span><span class="n">W_CANCEL_SEND_PACKETS_HANDLER</span><span class="w"> </span><span class="n">CancelSendPacketsHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_MINIPORT_PNPEVENTNOTIFY_HANDLER</span><span class="w"> </span><span class="n">PnPEventNotifyHandler</span><span class="p">;</span>
<span class="w">            </span><span class="n">W_MINIPORT_SHUTDOWN_HANDLER</span><span class="w"> </span><span class="n">AdapterShutdownHandler</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">NDIS_MINIPORT_CHARACTERISTICS</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">PNDIS_MINIPORT_CHARACTERISTICS</span><span class="p">;</span>
</code></pre>
</div>

<p>An NDIS intermediate driver should initialize this structure with zeros before setting up any of the following members:</p>

<ul>
<li><p><strong>MajorNdisVersion</strong>
Specifies the major version of the NDIS library the driver is using. The current value is 0x05, although the NDIS library continues to support existing miniport drivers developed for NDIS 4.0.</p></li>
<li><p><strong>MinorNdisVersion</strong>
Specifies the minor version of the NDIS library the driver is using. The current value is 0x00, although NDIS continues to support existing drivers.</p></li>
<li><p><strong>Reserved</strong>
This member is reserved for system use.</p></li>
<li><p><strong>CheckForHangHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549367/(v=vs.85/)"><strong>MiniportCheckForHang</strong></a> function, if any, or <strong>NULL</strong>.</p></li>
<li><p><strong>DisableInterruptHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>EnableInterruptHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>HaltHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549451/(v=vs.85/)"><strong>MiniportHalt</strong></a> function.</p></li>
<li><p><strong>HandleInterruptHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>InitializeHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550472/(v=vs.85/)"><strong>MiniportInitialize</strong></a> function.</p></li>
<li><p><strong>ISRHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>QueryInformationHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550490/(v=vs.85/)"><strong>MiniportQueryInformation</strong></a> function.</p></li>
<li><p><strong>ReconfigureHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>ResetHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550502/(v=vs.85/)"><em>MiniportReset</em></a> function.</p></li>
<li><p><strong>SendHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550518/(v=vs.85/)"><strong>MiniportSend</strong></a> function, <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550561/(v=vs.85/)"><strong>MiniportWanSend</strong></a> function, or <strong>NULL</strong> if the caller supplies a <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550524/(v=vs.85/)"><strong>MiniportSendPackets</strong></a> function.</p>

<p>If the driver supports multipacket sends or media-specific information, it sets the <strong>SendPacketsHandler</strong> member instead and sets this member to <strong>NULL</strong>.</p></li>
<li><p><strong>SetInformationHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550530/(v=vs.85/)"><strong>MiniportSetInformation</strong></a> function.</p></li>
<li><p><strong>TransferDataHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550556/(v=vs.85/)"><strong>MiniportTransferData</strong></a> function, if any, or <strong>NULL</strong>. This miniport driver function is required unless the caller is the driver of a WAN NIC or the caller supports multipacket receives and, therefore, supplies the entry point of its <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550510/(v=vs.85/)"><strong>MiniportReturnPacket</strong></a> function at <strong>ReturnPacketHandler</strong>.</p></li>
<li><p><strong>ReturnPacketHandler</strong>
Specifies the entry point of the caller's <em>MiniportReturnPacket</em> function, if any, or <strong>NULL</strong>.</p></li>
<li><p><strong>SendPacketsHandler</strong>
Specifies the entry point of the caller's <em>MiniportSendPackets</em> function, if any, or <strong>NULL</strong>.</p></li>
<li><p><strong>AllocateCompleteHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CoCreateVcHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CoDeleteVcHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CoActivateVcHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CoDeactivateVcHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CoSendPacketsHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CoRequestHandler</strong>
Specifies <strong>NULL</strong>.</p></li>
<li><p><strong>CancelSendPacketsHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549359/(v=vs.85/)"><strong>MiniportCancelSendPackets</strong></a> function, if any, or <strong>NULL</strong>. Intermediate drivers that queue send packets for more than one second should register a <em>MiniportCancelSendPackets</em> function.</p></li>
<li><p><strong>PnPEventNotifyHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550487/(v=vs.85/)"><strong>MiniportPnPEventNotify</strong></a> function. NDIS 5.1 miniport drivers must register a <em>MiniportPnPEventNotify</em> function. Miniport drivers ''that have a WDM lower edge should register a <em>MiniportPnPEventNotify</em> function.</p></li>
<li><p><strong>AdapterShutdownHandler</strong>
Specifies the entry point of the caller's <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550533/(v=vs.85/)"><strong>MiniportShutdown</strong></a> function, if any, or <strong>NULL</strong>. NDIS 5.1 intermediate drivers must register a <em>MiniportShutdown</em> function. NDIS 5.1 intermediate drivers should register a <em>MiniportShutdown</em> function by calling <strong>NdisIMRegisterLayeredMiniport</strong>--not by calling <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553584/(v=vs.85/)"><strong>NdisMRegisterAdapterShutdownHandler</strong></a>.</p></li>
</ul>

<h3 id="characteristicslength-in"><code>CharacteristicsLength</code> [in]</h3>

<p>Specifies the length in bytes of the caller-supplied characteristics buffer. Depending on the value of <strong>MajorNdisVersion</strong>, this parameter must be either sizeof(NDIS50_MINIPORT_CHARACTERISTICS) if the driver supplies an NDIS50_MINIPORT_CHARACTERISTICS structure or sizeof(NDIS40_MINIPORT_CHARACTERISTICS) if the driver supplies an NDIS40_MINIPORT_CHARACTERISTICS structure.</p>

<p>If the driver includes the build instruction NDIS50_MINIPORT (or NDIS40_MINIPORT, as appropriate) in its sources or if the driver writer uses the -NDIS50_MINIPORT (or ..40..) compiler switch, this parameter is set when the driver is built.</p>

<h3 id="driverhandle-out"><code>DriverHandle</code> [out]</h3>

<p>Pointer to a variable in which <strong>NdisIMRegisterLayeredMiniport</strong>, if this call is successful, returns a handle that the caller should save. The caller subsequently must pass this handle to <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff552161/(v=vs.85/)"><strong>NdisIMInitializeDeviceInstance</strong></a>, usually from its <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff562465/(v=vs.85/)"><strong>ProtocolBindAdapter</strong></a> function.</p>

<h2 id="return-value">Return value</h2>

<p><strong>NdisIMRegisterLayeredMiniport</strong> returns NDIS_STATUS_SUCCESS if it registered the caller as a miniport driver, or it can return one of the following status values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NDIS_STATUS_BAD_CHARACTERISTICS</strong></td>
  <td>The _CharacteristicsLength_ is too small for the <strong>MajorNdisVersion</strong> specified in the buffer at _MiniportCharacteristics_.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_BAD_VERSION</strong></td>
  <td>The <strong>MajorNdisVersion</strong> or <strong>MajorNdisVersion</strong> specified in the characteristics structure is invalid.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_RESOURCES</strong></td>
  <td>A shortage of resources, possibly memory, prevented the NDIS library from registering the caller as a miniport driver.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_FAILURE</strong></td>
  <td>This is a default error status, returned when none of the preceding errors caused the registration to fail. For example, if the NDIS library cannot load the driver's image and lock it into system memory, it returns this error.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Any NDIS intermediate driver that exports both <em>MiniportXxx</em> and <em>ProtocolXxx</em> functions sets up a characteristics structure and calls <strong>NdisIMRegisterLayeredMiniport</strong> from its <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> function after <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> calls <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553547/(v=vs.85/)"><strong>NdisMInitializeWrapper</strong></a>. This structure is copied in the <strong>NdisIMRegisterLayeredMiniport</strong> request to the NDIS library's internal storage. Thus, once it has registered, such a driver cannot change its handler functions.</p>

<p>After such an NDIS intermediate driver has called <strong>NdisIMRegisterLayeredMiniport</strong> successfully, it must call <strong><a href="ndisregisterprotocol" title="VOID NdisRegisterProtocol(&#10;  [out] PNDIS_STATUS                   Status,&#10;  [out] PNDIS_HANDLE                   NdisProtocolHandle,&#10;  [in]  PNDIS_PROTOCOL_CHARACTERISTICS ProtocolCharacteristics,&#10;  [in]  UINT                           CharacteristicsLength&#10;);">NdisRegisterProtocol</a></strong> to register its <em>ProtocolXxx</em> functions with the NDIS library. Such a driver usually has both <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff562465/(v=vs.85/)"><strong>ProtocolBindAdapter</strong></a> and <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff563260/(v=vs.85/)"><strong>ProtocolUnbindAdapter</strong></a> functions. Its <em>ProtocolBindAdapter</em> function will be called next when the underlying NIC driver has initialized successfully. <em>ProtocolBindAdapter</em> then can establish a binding to that NIC driver with <strong><a href="ndisopenadapter" title="VOID NdisOpenAdapter(&#10;  [out]          PNDIS_STATUS Status,&#10;  [out]          PNDIS_STATUS OpenErrorStatus,&#10;  [out]          PNDIS_HANDLE NdisBindingHandle,&#10;  [out]          PUINT        SelectedMediumIndex,&#10;  [in]           PNDIS_MEDIUM MediumArray,&#10;  [in]           UINT         MediumArraySize,&#10;  [in]           NDIS_HANDLE  NdisProtocolHandle,&#10;  [in]           NDIS_HANDLE  ProtocolBindingContext,&#10;  [in]           PNDIS_STRING AdapterName,&#10;  [in]           UINT         OpenOptions,&#10;  [in, optional] PSTRING      AddressingInformation&#10;);">NdisOpenAdapter</a></strong>.</p>

<p>An NDIS intermediate driver should have a <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550524/(v=vs.85/)"><strong>MiniportSendPackets</strong></a> function if an underlying NIC driver might support multipacket sends or consume media-specific information, such as packet priorities, sent down in a packet array from a higher-level protocol. An NDIS intermediate driver should have a <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550510/(v=vs.85/)"><strong>MiniportReturnPacket</strong></a> function if an underlying NIC driver might support multipacket receive indications or indicate packet arrays containing media-specific information. The NDIS library handles packet arrays transferred between an underlying NIC driver and higher-level protocol that support only single-packet transfers on behalf of such an intermediate driver.</p>

<ul>
<li>Target platform: <a rel="noopener" target="_blank" href="https://go.microsoft.com/fwlink/p/?linkid=531356">Universal</a></li>
<li>Version: Not supported for NDIS 6.0 drivers in Windows Vista. Use <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff563654"><strong>NdisMRegisterMiniportDriver</strong></a>instead. Supported for NDIS 5.1 drivers in Windows Vista and Windows XP.</li>
</ul>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548818"><strong>DriverEntry of NDIS Miniport Drivers</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548821"><strong>DriverEntry of NDIS Protocol Drivers</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549367/(v=vs.85/)"><strong>MiniportCheckForHang</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff549451/(v=vs.85/)"><strong>MiniportHalt</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550472/(v=vs.85/)"><strong>MiniportInitialize</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550490/(v=vs.85/)"><strong>MiniportQueryInformation</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550502/(v=vs.85/)"><em>MiniportReset</em></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550510/(v=vs.85/)"><strong>MiniportReturnPacket</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550518/(v=vs.85/)"><strong>MiniportSend</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550524/(v=vs.85/)"><strong>MiniportSendPackets</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550530/(v=vs.85/)"><strong>MiniportSetInformation</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550556/(v=vs.85/)"><strong>MiniportTransferData</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff550561/(v=vs.85/)"><strong>MiniportWanSend</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff552161/(v=vs.85/)"><strong>NdisIMInitializeDeviceInstance</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553584/(v=vs.85/)"><strong>NdisMRegisterAdapterShutdownHandler</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553602/(v=vs.85/)"><strong>NdisMRegisterMiniport</strong></a></li>
<li><strong><a href="ndisopenadapter" title="VOID NdisOpenAdapter(&#10;  [out]          PNDIS_STATUS Status,&#10;  [out]          PNDIS_STATUS OpenErrorStatus,&#10;  [out]          PNDIS_HANDLE NdisBindingHandle,&#10;  [out]          PUINT        SelectedMediumIndex,&#10;  [in]           PNDIS_MEDIUM MediumArray,&#10;  [in]           UINT         MediumArraySize,&#10;  [in]           NDIS_HANDLE  NdisProtocolHandle,&#10;  [in]           NDIS_HANDLE  ProtocolBindingContext,&#10;  [in]           PNDIS_STRING AdapterName,&#10;  [in]           UINT         OpenOptions,&#10;  [in, optional] PSTRING      AddressingInformation&#10;);">NdisOpenAdapter</a></strong></li>
<li><strong><a href="ndisregisterprotocol" title="VOID NdisRegisterProtocol(&#10;  [out] PNDIS_STATUS                   Status,&#10;  [out] PNDIS_HANDLE                   NdisProtocolHandle,&#10;  [in]  PNDIS_PROTOCOL_CHARACTERISTICS ProtocolCharacteristics,&#10;  [in]  UINT                           CharacteristicsLength&#10;);">NdisRegisterProtocol</a></strong></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff564698"><strong>NdisZeroMemory</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff562465/(v=vs.85/)"><strong>ProtocolBindAdapter</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff563251/(v=vs.85/)"><strong>ProtocolReceivePacket</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff563260/(v=vs.85/)"><strong>ProtocolUnbindAdapter</strong></a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisimregisterlayeredminiport">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndisimregisterlayeredminiport.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
