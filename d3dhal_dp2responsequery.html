<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DHAL_DP2RESPONSEQUERY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DHAL_DP2RESPONSEQUERY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DHAL_DP2RESPONSEQUERY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dhal.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _D3DHAL_DP2RESPONSEQUERY {
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> dwQueryID;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> dwSize;
} D3DHAL_DP2RESPONSEQUERY;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/ns-d3dhal-_d3dhal_dp2responsequery">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dhal_dp2responsequery.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dhal-_d3dhal_dp2responsequery)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_D3DHAL_DP2RESPONSEQUERY structure</h1>
<h2>Description</h2>
<p>DirectX 9.0 and later versions only.</p>
<p>One or more D3DHAL_DP2RESPONSEQUERY structure are parsed from the response buffer by the runtime after the runtime calls the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb">D3dDrawPrimitives2</a> callback. The driver sets the <a href="lpd3dhal_dp2response" title="typedef struct _D3DHAL_DP2RESPONSE {&#10;  BYTE  bCommand;&#10;  BYTE  bReserved;&#10;  WORD  wStateCount;&#10;  DWORD dwTotalSize;&#10;} D3DHAL_DP2RESPONSE, *LPD3DHAL_DP2RESPONSE;">D3DHAL_DP2RESPONSE</a> structure's <strong>bCommand</strong> member to D3DDP2OP_RESPONSEQUERY to indicate that responses to previously issued queries are available in the response buffer.</p>
<h2>Members</h2>
<h3><code>dwQueryID</code></h3>
<p>Identifies the query for which response data is available.</p>
<h3><code>dwSize</code></h3>
<p>Specifies the size, in bytes, of the query information that the driver returns to the runtime.</p>
<h2>Remarks</h2>
<p>The runtime uses the D3DDP2OP_ISSUEQUERY command to request that the driver process queries. The driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb">D3dDrawPrimitives2</a> callback should process <strong>wPrimitiveCount</strong> <a href="d3dhal_dp2issuequery" title="typedef struct _D3DHAL_DP2ISSUEQUERY {&#10;  DWORD dwQueryID;&#10;  DWORD dwFlags;&#10;} D3DHAL_DP2ISSUEQUERY;">D3DHAL_DP2ISSUEQUERY</a> query structures from the command buffer. The value of <strong>wPrimitiveCount</strong>  is specified in the <a href="lpd3dhal_dp2command" title="typedef struct _D3DHAL_DP2COMMAND {&#10;  BYTE  bCommand;&#10;  BYTE  bReserved;&#10;  union {&#10;    WORD wPrimitiveCount;&#10;    WORD wStateCount;&#10;  };&#10;} D3DHAL_DP2COMMAND, *LPD3DHAL_DP2COMMAND;">D3DHAL_DP2COMMAND</a> structure. The driver parses these query structures and translates them to its hardware specific commands.</p>
<p>If previously submitted queries using the D3DDP2OP_ISSUEQUERY operation completed, the driver sets the size of the response buffer in the dwErrorOffset member of the <a href="d3dhal_drawprimitives2data" title="typedef struct _D3DHAL_DRAWPRIMITIVES2DATA {&#10;  ULONG_PTR                 dwhContext;&#10;  DWORD                     dwFlags;&#10;  DWORD                     dwVertexType;&#10;  LPDDRAWI_DDRAWSURFACE_LCL lpDDCommands;&#10;  DWORD                     dwCommandOffset;&#10;  DWORD                     dwCommandLength;&#10;  union {&#10;    LPDDRAWI_DDRAWSURFACE_LCL lpDDVertex;&#10;    LPVOID                    lpVertices;&#10;  };&#10;  DWORD                     dwVertexOffset;&#10;  DWORD                     dwVertexLength;&#10;  DWORD                     dwReqVertexBufSize;&#10;  DWORD                     dwReqCommandBufSize;&#10;  LPDWORD                   lpdwRStates;&#10;  union {&#10;    DWORD   dwVertexSize;&#10;    HRESULT ddrval;&#10;  };&#10;...">D3DHAL_DRAWPRIMITIVES2DATA</a> structure and sets the <strong>ddrval</strong> member of <a href="d3dhal_drawprimitives2data" title="typedef struct _D3DHAL_DRAWPRIMITIVES2DATA {&#10;  ULONG_PTR                 dwhContext;&#10;  DWORD                     dwFlags;&#10;  DWORD                     dwVertexType;&#10;  LPDDRAWI_DDRAWSURFACE_LCL lpDDCommands;&#10;  DWORD                     dwCommandOffset;&#10;  DWORD                     dwCommandLength;&#10;  union {&#10;    LPDDRAWI_DDRAWSURFACE_LCL lpDDVertex;&#10;    LPVOID                    lpVertices;&#10;  };&#10;  DWORD                     dwVertexOffset;&#10;  DWORD                     dwVertexLength;&#10;  DWORD                     dwReqVertexBufSize;&#10;  DWORD                     dwReqCommandBufSize;&#10;  LPDWORD                   lpdwRStates;&#10;  union {&#10;    DWORD   dwVertexSize;&#10;    HRESULT ddrval;&#10;  };&#10;...">D3DHAL_DRAWPRIMITIVES2DATA</a> to D3D_OK for successful completion. The driver also overwrites the incoming command buffer with the outgoing response buffer. Each D3DHAL_DP2RESPONSEQUERY in the response buffer is followed by the following data related to the query:</p>
<ul>
<li>BOOL for D3DQUERYTYPE_EVENT. Before responding with D3DDP2OP_RESPONSEQUERY for an event, the driver must ensure that the graphics processing unit (GPU) is finished processing all <a href="d3dhal_dp2operation" title="typedef enum _D3DHAL_DP2OPERATION {&#10;  D3DDP2OP_POINTS,&#10;  D3DDP2OP_INDEXEDLINELIST,&#10;  D3DDP2OP_INDEXEDTRIANGLELIST,&#10;  D3DDP2OP_RENDERSTATE,&#10;  D3DDP2OP_LINELIST,&#10;  D3DDP2OP_LINESTRIP,&#10;  D3DDP2OP_INDEXEDLINESTRIP,&#10;  D3DDP2OP_TRIANGLELIST,&#10;  D3DDP2OP_TRIANGLESTRIP,&#10;  D3DDP2OP_INDEXEDTRIANGLESTRIP,&#10;  D3DDP2OP_TRIANGLEFAN,&#10;  D3DDP2OP_INDEXEDTRIANGLEFAN,&#10;  D3DDP2OP_TRIANGLEFAN_IMM,&#10;  D3DDP2OP_LINELIST_IMM,&#10;  D3DDP2OP_TEXTURESTAGESTATE,&#10;  D3DDP2OP_INDEXEDTRIANGLELIST2,&#10;  D3DDP2OP_INDEXEDLINELIST2,&#10;  D3DDP2OP_VIEWPORTINFO,&#10;  D3DDP2OP_WINFO,&#10;...">D3DHAL_DP2OPERATION</a> operations that are related to the event. That is, the driver only responds after the event's ISSUE_END state occurs. The driver must always set the event's BOOL value to <strong>TRUE</strong> when responding.</li>
<li><a href="dword" title="typedef unsigned long DWORD;">DWORD</a> for D3DQUERYTYPE_OCCLUSION. The driver sets this <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> to the number of pixels for which the z-test passed for all primitives between the begin and end of the query. If the depth buffer is multisampled, the driver determines the number of pixels from the number of samples. However, if the display device is capable of per-multisample z-test accuracy, the conversion to number of pixels should generally be rounded up. An application can then check the occlusion result against 0, to effectively mean "fully occluded". Drivers that convert multisampled quantities to pixel quantities should detect render target multisampling changes and continue to compute the query results appropriately.</li>
<li><a href="lpd3ddevinfo_vcache" title="typedef struct _D3DDEVINFO_VCACHE {&#10;  DWORD Pattern;&#10;  DWORD OptMethod;&#10;  DWORD CacheSize;&#10;  DWORD MagicNumber;&#10;} D3DDEVINFO_VCACHE, *LPD3DDEVINFO_VCACHE;">D3DDEVINFO_VCACHE</a> structure for D3DQUERYTYPE_VCACHE.</li>
</ul>
<p>The runtime parses the returned response buffer and updates its internal data structures.</p>
<h2>See also</h2>
<p><a href="lpd3ddevinfo_vcache" title="typedef struct _D3DDEVINFO_VCACHE {&#10;  DWORD Pattern;&#10;  DWORD OptMethod;&#10;  DWORD CacheSize;&#10;  DWORD MagicNumber;&#10;} D3DDEVINFO_VCACHE, *LPD3DDEVINFO_VCACHE;">D3DDEVINFO_VCACHE</a></p>
<p>D3DDP2OP_ISSUEQUERY</p>
<p>D3DDP2OP_RESPONSEQUERY</p>
<p><a href="lpd3dhal_dp2command" title="typedef struct _D3DHAL_DP2COMMAND {&#10;  BYTE  bCommand;&#10;  BYTE  bReserved;&#10;  union {&#10;    WORD wPrimitiveCount;&#10;    WORD wStateCount;&#10;  };&#10;} D3DHAL_DP2COMMAND, *LPD3DHAL_DP2COMMAND;">D3DHAL_DP2COMMAND</a></p>
<p><a href="d3dhal_dp2issuequery" title="typedef struct _D3DHAL_DP2ISSUEQUERY {&#10;  DWORD dwQueryID;&#10;  DWORD dwFlags;&#10;} D3DHAL_DP2ISSUEQUERY;">D3DHAL_DP2ISSUEQUERY</a></p>
<p><a href="lpd3dhal_dp2response" title="typedef struct _D3DHAL_DP2RESPONSE {&#10;  BYTE  bCommand;&#10;  BYTE  bReserved;&#10;  WORD  wStateCount;&#10;  DWORD dwTotalSize;&#10;} D3DHAL_DP2RESPONSE, *LPD3DHAL_DP2RESPONSE;">D3DHAL_DP2RESPONSE</a></p>
<p><a href="d3dhal_drawprimitives2data" title="typedef struct _D3DHAL_DRAWPRIMITIVES2DATA {&#10;  ULONG_PTR                 dwhContext;&#10;  DWORD                     dwFlags;&#10;  DWORD                     dwVertexType;&#10;  LPDDRAWI_DDRAWSURFACE_LCL lpDDCommands;&#10;  DWORD                     dwCommandOffset;&#10;  DWORD                     dwCommandLength;&#10;  union {&#10;    LPDDRAWI_DDRAWSURFACE_LCL lpDDVertex;&#10;    LPVOID                    lpVertices;&#10;  };&#10;  DWORD                     dwVertexOffset;&#10;  DWORD                     dwVertexLength;&#10;  DWORD                     dwReqVertexBufSize;&#10;  DWORD                     dwReqCommandBufSize;&#10;  LPDWORD                   lpdwRStates;&#10;  union {&#10;    DWORD   dwVertexSize;&#10;    HRESULT ddrval;&#10;  };&#10;...">D3DHAL_DRAWPRIMITIVES2DATA</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb">D3dDrawPrimitives2</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/ns-d3dhal-_d3dhal_dp2responsequery">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dhal/ns-d3dhal-_d3dhal_dp2responsequery.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
