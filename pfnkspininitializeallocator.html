<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFNKSPININITIALIZEALLOCATOR - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFNKSPININITIALIZEALLOCATOR - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFNKSPININITIALIZEALLOCATOR - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFNKSPININITIALIZEALLOCATOR Pfnkspininitializeallocator;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Pfnkspininitializeallocator(
  [in]  <a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">PKSPIN</a> Pin,
  [in]  <a href="ksallocator_framing" title="typedef struct {&#10;  union {&#10;    ULONG OptionsFlags;&#10;    ULONG RequirementsFlags;&#10;  };&#10;#if ...&#10;  POOL_TYPE PoolType;&#10;#else&#10;  ULONG     PoolType;&#10;#endif&#10;  ULONG     Frames;&#10;  ULONG     FrameSize;&#10;  union {&#10;    ULONG FileAlignment;&#10;    LONG  FramePitch;&#10;  };&#10;  ULONG     Reserved;&#10;} KSALLOCATOR_FRAMING, *PKSALLOCATOR_FRAMING;">PKSALLOCATOR_FRAMING</a> AllocatorFraming,
  [out] PVOID *Context
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkspininitializeallocator">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pfnkspininitializeallocator.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ks-pfnkspininitializeallocator)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pfnkspininitializeallocator-callback-function">PFNKSPININITIALIZEALLOCATOR callback function</h1>

<h2 id="description">Description</h2>

<p>An AVStream minidriver's <em>AVStrMiniInitializeAllocator</em> routine initializes an allocator that will be associated with a pin.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="pin-in"><code>Pin</code> [in]</h3>

<p>Pointer to a <a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">KSPIN</a> structure describing the pin with which the allocator is to be associated.</p>

<h3 id="allocatorframing-in"><code>AllocatorFraming</code> [in]</h3>

<p>Pointer to a <a href="ksallocator_framing" title="typedef struct {&#10;  union {&#10;    ULONG OptionsFlags;&#10;    ULONG RequirementsFlags;&#10;  };&#10;#if ...&#10;  POOL_TYPE PoolType;&#10;#else&#10;  ULONG     PoolType;&#10;#endif&#10;  ULONG     Frames;&#10;  ULONG     FrameSize;&#10;  union {&#10;    ULONG FileAlignment;&#10;    LONG  FramePitch;&#10;  };&#10;  ULONG     Reserved;&#10;} KSALLOCATOR_FRAMING, *PKSALLOCATOR_FRAMING;">KSALLOCATOR_FRAMING</a> structure describing the framing requirements that the allocator should use.</p>

<h3 id="context-out"><code>Context</code> [out]</h3>

<p>Pointer to a context for the allocator that will be passed as a parameter to the other routines for this structure. For example, the driver could store pin or allocator framing structures for later reference by the other callback routines. Note that other routines for <a href="ksallocator_dispatch" title="typedef struct _KSALLOCATOR_DISPATCH {&#10;  PFNKSPININITIALIZEALLOCATOR InitializeAllocator;&#10;  PFNKSDELETEALLOCATOR        DeleteAllocator;&#10;  PFNKSDEFAULTALLOCATE        Allocate;&#10;  PFNKSDEFAULTFREE            Free;&#10;} KSALLOCATOR_DISPATCH, *PKSALLOCATOR_DISPATCH;">KSALLOCATOR_DISPATCH</a> must have at least an indirect way of referencing <em>Pin</em>. (For instance, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnksdefaultallocate">AVStrMiniAllocate</a> will need to be able to access the <em>AllocatorFraming</em> information for <em>Pin</em>, and <em>Context</em> is the only parameter that AVStream will pass it.)</p>

<h2 id="return-value">Return value</h2>

<p><em>AVStrMiniInitializeAllocator</em> should return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or the error code that it received attempting to create the allocator.</p>

<h2 id="remarks">Remarks</h2>

<p>The minidriver specifies this routine's address in the <strong>InitializeAllocator</strong> member of its <a href="ksallocator_dispatch" title="typedef struct _KSALLOCATOR_DISPATCH {&#10;  PFNKSPININITIALIZEALLOCATOR InitializeAllocator;&#10;  PFNKSDELETEALLOCATOR        DeleteAllocator;&#10;  PFNKSDEFAULTALLOCATE        Allocate;&#10;  PFNKSDEFAULTFREE            Free;&#10;} KSALLOCATOR_DISPATCH, *PKSALLOCATOR_DISPATCH;">KSALLOCATOR_DISPATCH</a> structure. The minidriver passes this structure to the class driver in <a href="kspin_dispatch" title="typedef struct _KSPIN_DISPATCH {&#10;  PFNKSPINIRP                Create;&#10;  PFNKSPINIRP                Close;&#10;  PFNKSPIN                   Process;&#10;  PFNKSPINVOID               Reset;&#10;  PFNKSPINSETDATAFORMAT      SetDataFormat;&#10;  PFNKSPINSETDEVICESTATE     SetDeviceState;&#10;  PFNKSPIN                   Connect;&#10;  PFNKSPINVOID               Disconnect;&#10;  const KSCLOCK_DISPATCH     *Clock;&#10;  const KSALLOCATOR_DISPATCH *Allocator;&#10;} KSPIN_DISPATCH, *PKSPIN_DISPATCH;">KSPIN_DISPATCH</a>.</p>

<p>Note that kernel-mode allocators cannot allocate frames that could eventually reach user mode.</p>

<p>AVStream calls <em>AVStrMiniInitializeAllocator</em> to initialize the given allocator. The handler for this routine should prepare to handle memory allocation and free requests.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/ks-allocators">KS Allocators</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnksdeleteallocator">AVStrMiniDeleteAllocator</a></p>

<p><a href="ksallocator_dispatch" title="typedef struct _KSALLOCATOR_DISPATCH {&#10;  PFNKSPININITIALIZEALLOCATOR InitializeAllocator;&#10;  PFNKSDELETEALLOCATOR        DeleteAllocator;&#10;  PFNKSDEFAULTALLOCATE        Allocate;&#10;  PFNKSDEFAULTFREE            Free;&#10;} KSALLOCATOR_DISPATCH, *PKSALLOCATOR_DISPATCH;">KSALLOCATOR_DISPATCH</a></p>

<p><a href="ksallocator_framing" title="typedef struct {&#10;  union {&#10;    ULONG OptionsFlags;&#10;    ULONG RequirementsFlags;&#10;  };&#10;#if ...&#10;  POOL_TYPE PoolType;&#10;#else&#10;  ULONG     PoolType;&#10;#endif&#10;  ULONG     Frames;&#10;  ULONG     FrameSize;&#10;  union {&#10;    ULONG FileAlignment;&#10;    LONG  FramePitch;&#10;  };&#10;  ULONG     Reserved;&#10;} KSALLOCATOR_FRAMING, *PKSALLOCATOR_FRAMING;">KSALLOCATOR_FRAMING</a></p>

<p><a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">KSPIN</a></p>

<p><a href="kspin_dispatch" title="typedef struct _KSPIN_DISPATCH {&#10;  PFNKSPINIRP                Create;&#10;  PFNKSPINIRP                Close;&#10;  PFNKSPIN                   Process;&#10;  PFNKSPINVOID               Reset;&#10;  PFNKSPINSETDATAFORMAT      SetDataFormat;&#10;  PFNKSPINSETDEVICESTATE     SetDeviceState;&#10;  PFNKSPIN                   Connect;&#10;  PFNKSPINVOID               Disconnect;&#10;  const KSCLOCK_DISPATCH     *Clock;&#10;  const KSALLOCATOR_DISPATCH *Allocator;&#10;} KSPIN_DISPATCH, *PKSPIN_DISPATCH;">KSPIN_DISPATCH</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnkspininitializeallocator">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/nc-ks-pfnkspininitializeallocator.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
