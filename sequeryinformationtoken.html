<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SeQueryInformationToken - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SeQueryInformationToken - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SeQueryInformationToken - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> SeQueryInformationToken(
  [in]  PACCESS_TOKEN           Token,
  [in]  <a href="token_information_class" title="typedef enum _TOKEN_INFORMATION_CLASS&#10;{&#10;    TokenUser = 1,                        // q: TOKEN_USER, SE_TOKEN_USER&#10;    TokenGroups,                          // q: TOKEN_GROUPS&#10;    TokenPrivileges,                      // q: TOKEN_PRIVILEGES&#10;    TokenOwner,                           // qs: TOKEN_OWNER          &#10;    TokenPrimaryGroup,                    // qs: TOKEN_PRIMARY_GROUP&#10;    TokenDefaultDacl,                     // qs: TOKEN_DEFAULT_DACL&#10;    TokenSource,                          // q: TOKEN_SOURCE&#10;    TokenType,                            // q: TOKEN_TYPE&#10;    TokenImpersonationLevel,              // q: SECURITY_IMPERSONATION_LEVEL&#10;    TokenStatistics,                      // q: TOKEN_STATISTICS // 10&#10;    TokenRestrictedSids,                  // q: TOKEN_GROUPS&#10;    TokenSessionId,                       // q; s: ULONG (requires SeTcbPrivilege)&#10;    TokenGroupsAndPrivileges,             // q: TOKEN_GROUPS_AND_PRIVILEGES&#10;    TokenSessionReference,                // s: ULONG (requires SeTcbPrivilege)&#10;    TokenSandBoxInert,                    // q: ULONG&#10;    TokenAuditPolicy,                     // q; s: TOKEN_AUDIT_POLICY (requires SeSecurityPrivilege/SeTcbPrivilege)&#10;    TokenOrigin,                          // q; s: TOKEN_ORIGIN (requires SeTcbPrivilege)&#10;    TokenElevationType,                   // q: TOKEN_ELEVATION_TYPE&#10;...">TOKEN_INFORMATION_CLASS</a> TokenInformationClass,
  [out] PVOID                   *TokenInformation
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequeryinformationtoken">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/sequeryinformationtoken.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-sequeryinformationtoken)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="sequeryinformationtoken-function">SeQueryInformationToken function</h1>

<h2 id="description">Description</h2>

<p>The <strong>SeQueryInformationToken</strong> routine retrieves a specified type of information about an access token. The calling process must have appropriate access rights to obtain the information.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="token-in"><code>Token</code> [in]</h3>

<p>A pointer to an access token from which information is to be retrieved. If <em>TokenInformationClass</em> is set to <em><a href="tokensource" title="#define TokenSource 7 // q: TOKEN_SOURCE">TokenSource</a></em>, the handle must have TOKEN_QUERY_SOURCE access. For all other <em>TokenInformationClass</em> values, the handle must have TOKEN_QUERY access.</p>

<h3 id="tokeninformationclass-in"><code>TokenInformationClass</code> [in]</h3>

<p>A value from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ne-ntifs-_token_information_class">TOKEN_INFORMATION_CLASS</a> enumerated type that identifies the type of information to be retrieved.</p>

<h3 id="tokeninformation-out"><code>TokenInformation</code> [out]</h3>

<p>If <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> is returned,
<em>TokenInformation</em> receives a pointer to a
location that contains the address of a buffer that holds the requested
information. The format of this information buffer depends upon the
value of <em>TokenInformationClass</em>, as shown in
the following table. Be aware that the buffer is allocated by
<strong>SeQueryInformationToken</strong>
from paged pool. This buffer must eventually be freed by the caller by
using
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-exfreepool">ExFreePool</a>.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="tokendefaultdacl" title="#define TokenDefaultDacl 6 // q; s: TOKEN_DEFAULT_DACL">TokenDefaultDacl</a></strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_default_dacl">TOKEN_DEFAULT_DACL</a> structure that contains the default DACL for newly created objects.</td>
</tr>
<tr>
  <td><strong>TokenGroups</strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_groups">TOKEN_GROUPS</a> structure that contains the group accounts associated with the token.</td>
</tr>
<tr>
  <td><strong><a href="tokenimpersonationlevel" title="#define TokenImpersonationLevel 9 // q: SECURITY_IMPERSONATION_LEVEL">TokenImpersonationLevel</a></strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ne-wdm-_security_impersonation_level">SECURITY_IMPERSONATION_LEVEL</a> value which indicates the impersonation level of the token. If the access token is not an impersonation token, the call to <strong>SeQueryInformationToken</strong> fails.</td>
</tr>
<tr>
  <td><strong>TokenOwner</strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_owner">TOKEN_OWNER</a> structure that contains the default owner security identifier (<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_sid">SID</a>) for newly created objects.</td>
</tr>
<tr>
  <td><strong><a href="tokenprimarygroup" title="#define TokenPrimaryGroup 5 // q; s: TOKEN_PRIMARY_GROUP">TokenPrimaryGroup</a></strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_primary_group">TOKEN_PRIMARY_GROUP</a> structure that contains the default primary group <a href="pisid" title="typedef struct _SID {&#10;  UCHAR                    Revision;&#10;  UCHAR                    SubAuthorityCount;&#10;  SID_IDENTIFIER_AUTHORITY IdentifierAuthority;&#10;#if ...&#10;  ULONG                    *SubAuthority[];&#10;#else&#10;  ULONG                    SubAuthority[ANYSIZE_ARRAY];&#10;#endif&#10;} SID, *PISID;">SID</a> for newly created objects.</td>
</tr>
<tr>
  <td><strong>TokenPrivileges</strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_privileges">TOKEN_PRIVILEGES</a> structure that contains the token's privileges.</td>
</tr>
<tr>
  <td><strong><a href="tokensessionid" title="#define TokenSessionId 12 // q; s: ULONG (requires SeTcbPrivilege)">TokenSessionId</a></strong></td>
  <td>The buffer receives a <strong><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></strong> value (not a pointer to it) that indicates the Terminal Services session identifier that is associated with the token. If the token is associated with the Terminal Server console session, the session identifier is zero. A nonzero session identifier indicates a Terminal Services client session. In a non-Terminal Services environment, the session identifier is zero.</td>
</tr>
<tr>
  <td><strong><a href="tokensource" title="#define TokenSource 7 // q: TOKEN_SOURCE">TokenSource</a></strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_source">TOKEN_SOURCE</a> structure that contains the source of the token. TOKEN_QUERY_SOURCE access is needed to retrieve this information.</td>
</tr>
<tr>
  <td><strong><a href="tokenstatistics" title="#define TokenStatistics 10 // q: TOKEN_STATISTICS // 10">TokenStatistics</a></strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_statistics">TOKEN_STATISTICS</a> structure that contains various token statistics.</td>
</tr>
<tr>
  <td><strong>TokenType</strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ne-ntifs-_token_type">TOKEN_TYPE</a> value that indicates whether the token is a primary or impersonation token.</td>
</tr>
<tr>
  <td><strong>TokenUser</strong></td>
  <td>The buffer receives a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_user">TOKEN_USER</a> structure that contains the token's user account.</td>
</tr>
<tr>
  <td><strong><a href="tokenintegritylevel" title="#define TokenIntegrityLevel 25 // q; s: TOKEN_MANDATORY_LABEL">TokenIntegrityLevel</a></strong></td>
  <td>The buffer receives a <strong><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></strong> value (not a pointer to it) that specifies the tokenâ€™s integrity level.</td>
</tr>
</tbody>
</table>

<h2 id="return-value">Return value</h2>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The call to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequeryinformationtoken">SeQueryInformationToken</a> succeeded.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_INFO_CLASS</strong></td>
  <td>An invalid value was supplied for <em>TokenInformationClass</em>.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>For more information about security and access control, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/driversecurity/windows-security-model">Windows security model for driver developers</a> and the documentation on these topics in the Windows SDK.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-psdereferenceimpersonationtoken">PsDereferenceImpersonationToken</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-psdereferenceprimarytoken">PsDereferencePrimaryToken</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ne-wdm-_security_impersonation_level">SECURITY_IMPERSONATION_LEVEL</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_sid">SID</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequeryauthenticationidtoken">SeQueryAuthenticationIdToken</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequerysubjectcontexttoken">SeQuerySubjectContextToken</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-setokenisadmin">SeTokenIsAdmin</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-setokenisrestricted">SeTokenIsRestricted</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_default_dacl">TOKEN_DEFAULT_DACL</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_groups">TOKEN_GROUPS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ne-ntifs-_token_information_class">TOKEN_INFORMATION_CLASS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_owner">TOKEN_OWNER</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_primary_group">TOKEN_PRIMARY_GROUP</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_privileges">TOKEN_PRIVILEGES</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_source">TOKEN_SOURCE</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_statistics">TOKEN_STATISTICS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ne-ntifs-_token_type">TOKEN_TYPE</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_token_user">TOKEN_USER</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-sequeryinformationtoken">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-sequeryinformationtoken.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
