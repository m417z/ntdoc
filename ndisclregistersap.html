<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisClRegisterSap - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisClRegisterSap - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisClRegisterSap - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_STATUS NdisClRegisterSap(
  [in]  NDIS_HANDLE  NdisAfHandle,
  [in]  NDIS_HANDLE  ProtocolSapContext,
  [in]  PCO_SAP      Sap,
  [out] PNDIS_HANDLE NdisSapHandle
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisclregistersap">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndisclregistersap.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndisclregistersap)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndisclregistersap-function">NdisClRegisterSap function</h1>

<h2 id="description">Description</h2>

<p><strong>NdisClRegisterSap</strong> registers a SAP on which the client can receive incoming calls from a remote
node.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="ndisafhandle-in"><code>NdisAfHandle</code> [in]</h3>

<p>Specifies the handle returned by
<a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a>,
which implicitly identifies the call manager with which to register the SAP.</p>

<h3 id="protocolsapcontext-in"><code>ProtocolSapContext</code> [in]</h3>

<p>Specifies the handle to a caller-supplied resident context area in which the client maintains
state for this SAP after it has been opened. NDIS passes this handle back to the client in all
subsequent calls concerning this SAP if the call to
<strong>NdisClRegisterSap</strong> succeeds.</p>

<h3 id="sap-in"><code>Sap</code> [in]</h3>

<p>Pointer to a client-supplied specification for the SAP to be opened, formatted as a structure of
type
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff545392(v=vs.85)">CO_SAP</a>.</p>

<h3 id="ndissaphandle-out"><code>NdisSapHandle</code> [out]</h3>

<p>Pointer to a variable in which a handle to the newly registered SAP is returned if this call
succeeds.</p>

<h2 id="return-value">Return value</h2>

<p>When
<strong>NdisClRegisterSap</strong> returns anything other than NDIS_STATUS_PENDING, the client should make an
internal call to its
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_register_sap_complete">ProtocolClRegisterSapComplete</a> function. Otherwise, NDIS calls the client's
<em>ProtocolClRegisterSapComplete</em> function when this operation is completed.</p>

<h2 id="remarks">Remarks</h2>

<p>With a call to
<strong>NdisClRegisterSap</strong>, a client requests notifications of incoming calls on a particular SAP. NDIS
forwards the given SAP information to the call manager's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_reg_sap">ProtocolCmRegisterSap</a> function
for validation. If the given SAP is already in use or if the call manager does not recognize the
client-supplied specification at
<em>Sap</em>, the call manager fails this request.</p>

<p>SAP format is medium-dependent and specific to the address family supported by the call manager, which
uses registered SAPs subsequently to route incoming calls to the appropriate client. A call manager can
register SAPs for established PVCs without contacting other network components, depending on the
underlying medium.</p>

<p>If its call to
<strong>NdisClRegisterSap</strong> succeeds, the client must save the handle returned at
<em>NdisSapHandle</em> because it is a required parameter to
<a href="ndisclderegistersap" title="NDIS_STATUS NdisClDeregisterSap(&#10;  [in] NDIS_HANDLE NdisSapHandle&#10;);">NdisClDeregisterSap</a>. Callers of
<strong>NdisClRegisterSap</strong> usually pass a pointer to a variable in the client-allocated state area at
<em>ProtocolSapContext</em> so that NDIS can set it to the
<em>NdisSapHandle</em> if this call succeeds. NDIS passes the given
<em>ProtocolSapContext</em> to the client's registered ProtocolCl/Co*Xxx* functions in all subsequent calls concerning this SAP until the client calls
<strong><a href="ndisclderegistersap" title="NDIS_STATUS NdisClDeregisterSap(&#10;  [in] NDIS_HANDLE NdisSapHandle&#10;);">NdisClDeregisterSap</a></strong>.</p>

<p>Usually, a client calls
<strong>NdisClRegisterSap</strong> from its
<em>ProtocolAfRegisterNotify</em> function following its successful call to
<a href="ndisclopenaddressfamilyex" title="NDIS_STATUS NdisClOpenAddressFamilyEx(&#10;  [in]  NDIS_HANDLE        NdisBindingHandle,&#10;  [in]  PCO_ADDRESS_FAMILY AddressFamily,&#10;  [in]  NDIS_HANDLE        ClientAfContext,&#10;  [out] PNDIS_HANDLE       NdisAfHandle&#10;);">NdisClOpenAddressFamilyEx</a>.
Registering one or more SAPs allows the client to receive its incoming call(s) as soon as the call
manager receives them over the network.</p>

<p>By contrast with client-initiated outgoing calls, a client does not call
<a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a> before it calls
<strong>NdisClRegisterSap</strong>. For incoming calls, the call manager initiates the creation of the VC, as
follows:</p>

<ul>
<li>On receipt of an incoming call on a registered SAP, the call manager first calls
<strong><a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a></strong>, causing NDIS to call the client's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_create_vc">ProtocolCoCreateVc</a> function.</li>
<li>When the VC has been set up and activated, the call manager calls
<a href="ndiscmdispatchincomingcall" title="NDIS_STATUS NdisCmDispatchIncomingCall(&#10;  [in] NDIS_HANDLE         NdisSapHandle,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisCmDispatchIncomingCall</a>,
causing NDIS to call the client's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_call">ProtocolClIncomingCall</a> function.</li>
</ul>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff545392(v=vs.85)">CO_SAP</a></p>

<p><a href="ndisclderegistersap" title="NDIS_STATUS NdisClDeregisterSap(&#10;  [in] NDIS_HANDLE NdisSapHandle&#10;);">NdisClDeregisterSap</a></p>

<p><a href="ndisclmakecall" title="NDIS_STATUS NdisClMakeCall(&#10;  [in]            NDIS_HANDLE         NdisVcHandle,&#10;  [in, out]       PCO_CALL_PARAMETERS CallParameters,&#10;  [in, optional]  NDIS_HANDLE         ProtocolPartyContext,&#10;  [out, optional] PNDIS_HANDLE        NdisPartyHandle&#10;);">NdisClMakeCall</a></p>

<p><a href="ndiscmdispatchincomingcall" title="NDIS_STATUS NdisCmDispatchIncomingCall(&#10;  [in] NDIS_HANDLE         NdisSapHandle,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisCmDispatchIncomingCall</a></p>

<p><a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_call">ProtocolClIncomingCall</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_register_sap_complete">ProtocolClRegisterSapComplete</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_reg_sap">ProtocolCmRegisterSap</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_af_register_notify">ProtocolCoAfRegisterNotify</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_create_vc">ProtocolCoCreateVc</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisclregistersap">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndisclregistersap.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
