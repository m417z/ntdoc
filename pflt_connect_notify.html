<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PFLT_CONNECT_NOTIFY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PFLT_CONNECT_NOTIFY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PFLT_CONNECT_NOTIFY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fltkernel.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PFLT_CONNECT_NOTIFY PfltConnectNotify;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PfltConnectNotify(
  PFLT_PORT ClientPort,
  PVOID ServerPortCookie,
  PVOID ConnectionContext,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> SizeOfContext,
  PVOID *ConnectionPortCookie
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_connect_notify">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pflt_connect_notify.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-fltkernel-pflt_connect_notify)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p><em>FltMgr</em> calls a minifilter's <strong>ConnectNotifyCallback</strong> callback function to notify the minifilter when a new connection to a communication port is being requested.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="clientport"><code>ClientPort</code></h3>

<p>[in] Opaque, <em>FltMgr</em>-generated handle for the new client port that is being established between the user-mode application and the kernel-mode minifilter.</p>

<p>The minifilter must pass this handle as the <strong>ClientPort</strong> parameter to <strong><a href="fltsendmessage" title="NTSTATUS FLTAPI FltSendMessage(&#10;  [in]            PFLT_FILTER    Filter,&#10;  [in]            PFLT_PORT      *ClientPort,&#10;  [in]            PVOID          SenderBuffer,&#10;  [in]            ULONG          SenderBufferLength,&#10;  [out, optional] PVOID          ReplyBuffer,&#10;  [in, out]       PULONG         ReplyLength,&#10;  [in, optional]  PLARGE_INTEGER Timeout&#10;);">FltSendMessage</a></strong> when sending and replying to messages on this client port.</p>

<p>The minifilter must eventually call <strong><a href="fltcloseclientport" title="VOID FLTAPI FltCloseClientPort(&#10;  [in]  PFLT_FILTER Filter,&#10;  [out] PFLT_PORT   *ClientPort&#10;);">FltCloseClientPort</a></strong> to close this client port, typically from its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_disconnect_notify"><strong>DisconnectNotifyCallback</strong></a> routine.</p>

<p><strong>ClientPort</strong> isn't the same as the <strong>ServerPort</strong> handle return by<strong><a href="fltcreatecommunicationport" title="NTSTATUS FLTAPI FltCreateCommunicationPort(&#10;  PFLT_FILTER            Filter,&#10;  PFLT_PORT              *ServerPort,&#10;  POBJECT_ATTRIBUTES     ObjectAttributes,&#10;  PVOID                  ServerPortCookie,&#10;  PFLT_CONNECT_NOTIFY    ConnectNotifyCallback,&#10;  PFLT_DISCONNECT_NOTIFY DisconnectNotifyCallback,&#10;  PFLT_MESSAGE_NOTIFY    MessageNotifyCallback,&#10;  LONG                   MaxConnections&#10;);">FltCreateCommunicationPort</a></strong>.</p>

<h3 id="serverportcookie"><code>ServerPortCookie</code></h3>

<p>[in] Pointer to context information defined by the minifilter. The minifilter can use this information to distinguish among multiple communication server ports that it might create. When the server port was created, the minifilter driver passed this context pointer as the <strong>ServerPortCookie</strong> parameter to <strong><a href="fltcreatecommunicationport" title="NTSTATUS FLTAPI FltCreateCommunicationPort(&#10;  PFLT_FILTER            Filter,&#10;  PFLT_PORT              *ServerPort,&#10;  POBJECT_ATTRIBUTES     ObjectAttributes,&#10;  PVOID                  ServerPortCookie,&#10;  PFLT_CONNECT_NOTIFY    ConnectNotifyCallback,&#10;  PFLT_DISCONNECT_NOTIFY DisconnectNotifyCallback,&#10;  PFLT_MESSAGE_NOTIFY    MessageNotifyCallback,&#10;  LONG                   MaxConnections&#10;);">FltCreateCommunicationPort</a></strong>.</p>

<h3 id="connectioncontext"><code>ConnectionContext</code></h3>

<p>[in] Context information pointer that the user-mode application passed in the <strong>lpContext</strong> parameter to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a>.</p>

<h3 id="sizeofcontext"><code>SizeOfContext</code></h3>

<p>[in] Size, in bytes, of the buffer that <strong>ConnectionContext</strong> points to.</p>

<h3 id="connectionportcookie"><code>ConnectionPortCookie</code></h3>

<p>[out] Pointer to the miniport's information that uniquely identifies this client port. The minifilter can use this cookie to identify the connection when <em>FltMgr</em> passes it in subsequent calls to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_message_notify"><strong>MessageNotifyCallback</strong></a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_disconnect_notify"><strong>DisconnectNotifyCallback</strong></a>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ConnectNotifyCallback</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds and the connection has been accepted. Otherwise, it returns an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value such as:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td>There aren't enough resources to complete the operation.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER</td>
  <td>One or more of the input parameters are invalid.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p><em>FltMgr</em> calls this routine whenever a user-mode application calls <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a> to send a connection request to the minifilter driver.</p>

<p>The minifilter should perform any necessary validation of the connection attempt.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/communication-between-user-mode-and-kernel-mode">Communication between user-mode and minifilters</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fltuser/nf-fltuser-filterconnectcommunicationport"><strong>FilterConnectCommunicationPort</strong></a></p>

<p><strong><a href="fltcloseclientport" title="VOID FLTAPI FltCloseClientPort(&#10;  [in]  PFLT_FILTER Filter,&#10;  [out] PFLT_PORT   *ClientPort&#10;);">FltCloseClientPort</a></strong></p>

<p><strong><a href="fltcreatecommunicationport" title="NTSTATUS FLTAPI FltCreateCommunicationPort(&#10;  PFLT_FILTER            Filter,&#10;  PFLT_PORT              *ServerPort,&#10;  POBJECT_ATTRIBUTES     ObjectAttributes,&#10;  PVOID                  ServerPortCookie,&#10;  PFLT_CONNECT_NOTIFY    ConnectNotifyCallback,&#10;  PFLT_DISCONNECT_NOTIFY DisconnectNotifyCallback,&#10;  PFLT_MESSAGE_NOTIFY    MessageNotifyCallback,&#10;  LONG                   MaxConnections&#10;);">FltCreateCommunicationPort</a></strong></p>

<p><strong><a href="fltsendmessage" title="NTSTATUS FLTAPI FltSendMessage(&#10;  [in]            PFLT_FILTER    Filter,&#10;  [in]            PFLT_PORT      *ClientPort,&#10;  [in]            PVOID          SenderBuffer,&#10;  [in]            ULONG          SenderBufferLength,&#10;  [out, optional] PVOID          ReplyBuffer,&#10;  [in, out]       PULONG         ReplyLength,&#10;  [in, optional]  PLARGE_INTEGER Timeout&#10;);">FltSendMessage</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_disconnect_notify"><strong>DisconnectNotifyCallback</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_message_notify"><strong>MessageNotifyCallback</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fltkernel/nc-fltkernel-pflt_connect_notify">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fltkernel/nc-fltkernel-pflt_connect_notify.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
