<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TransmitChecksumOffloadSupported : 4;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ReceiveChecksumOffloadSupported : 4;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> LsoV2Supported : 4;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> RssSupported : 4;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> VmqSupported : 4;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UsoSupported : 4;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved : 8;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MaxHeaderSizeSupported;
} NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD, *PNDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_encapsulated_packet_task_offload">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_encapsulated_packet_task_offload.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddndis-_ndis_encapsulated_packet_task_offload)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ndis_encapsulated_packet_task_offload-structure">_NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD</strong> structure contains the offload support state for Network Virtualization using Generic Routing Encapsulation (NVGRE) Task Offload (NVGRE-TO). This structure is used in the <strong>EncapsulatedPacketTaskOffloadGre</strong> member of the <a href="ndis_offload" title="typedef struct _NDIS_OFFLOAD {&#10;  NDIS_OBJECT_HEADER                       Header;&#10;  NDIS_TCP_IP_CHECKSUM_OFFLOAD             Checksum;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V1           LsoV1;&#10;  NDIS_IPSEC_OFFLOAD_V1                    IPsecV1;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V2           LsoV2;&#10;  ULONG                                    Flags;&#10;  NDIS_IPSEC_OFFLOAD_V2                    IPsecV2;&#10;  NDIS_TCP_RECV_SEG_COALESCE_OFFLOAD       Rsc;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD    EncapsulatedPacketTaskOffloadGre;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_V2 EncapsulatedPacketTaskOffloadVxlan;&#10;  UCHAR                                    EncapsulationTypes;&#10;  NDIS_RFC6877_464XLAT_OFFLOAD             Rfc6877Xlat;&#10;  NDIS_UDP_SEGMENTATION_OFFLOAD            UdpSegmentation;&#10;  NDIS_UDP_RSC_OFFLOAD                     UdpRsc;&#10;} NDIS_OFFLOAD, *PNDIS_OFFLOAD;">NDIS_OFFLOAD</a> structure.</p>

<h2 id="members">Members</h2>

<h3 id="transmitchecksumoffloadsupported"><code>TransmitChecksumOffloadSupported</code></h3>

<p>Task offload settings for transmit checksum.</p>

<h3 id="receivechecksumoffloadsupported"><code>ReceiveChecksumOffloadSupported</code></h3>

<p>Task offload settings for receive checksum.</p>

<h3 id="lsov2supported"><code>LsoV2Supported</code></h3>

<p>Task offload settings for large send offload version 2 (LSOv2).</p>

<h3 id="rsssupported"><code>RssSupported</code></h3>

<p>Task offload settings for receive side scaling (RSS).</p>

<h3 id="vmqsupported"><code>VmqSupported</code></h3>

<p>Task offload settings for virtual machine queue (VMQ).</p>

<h3 id="usosupported"><code>UsoSupported</code></h3>

<p>Task offload settings for UDP segmentation offload (USO).</p>

<h3 id="reserved"><code>Reserved</code></h3>

<p>Reserved for system use.</p>

<h3 id="maxheadersizesupported"><code>MaxHeaderSizeSupported</code></h3>

<p>This member should be set to the maximum header size from the beginning of the packet to the beginning of the inner TCP or UDP payload (the last byte of TCP or UDP inner header) that the NIC must support for all of these task offloads. The protocol driver is expected to not offload processing of a packet whose combined encapsulation headers exceed this size.</p>

<p><strong>Note</strong>: 256 bytes is a good default value that should cover all possible cases.</p>

<h2 id="remarks">Remarks</h2>

<p>In the initial capability advertisement and in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-task-offload-current-config">NDIS_STATUS_TASK_OFFLOAD_CURRENT_CONFIG</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-task-offload-hardware-capabilities">NDIS_STATUS_TASK_OFFLOAD_HARDWARE_CAPABILITIES</a> status indications, the <strong>TransmitChecksumOffloadSupported</strong>, <strong>ReceiveChecksumOffloadSupported</strong>, <strong>LsoV2Supported</strong>, <strong>RssSupported</strong>, <strong>VmqSupported</strong>, and <strong>UsoSupported</strong> members can be set to a bitwise OR of the following flags:</p>

<table>
<thead>
<tr>
  <th>Term</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_NOT_SUPPORTED</td>
  <td>Specifies that the miniport adapter does not support the corresponding task offload feature that the member specifies.</td>
</tr>
<tr>
  <td>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_INNER_IPV4</td>
  <td>Specifies that the miniport adapter supports the corresponding task offload feature that the member specifies where the inner IP header of an encapsulated packet is IPv4.</td>
</tr>
<tr>
  <td>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_OUTER_IPV4</td>
  <td>Specifies that the miniport adapter supports the corresponding task offload feature that the member specifies where the outer IP header of an encapsulated packet is IPv4.</td>
</tr>
<tr>
  <td>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_INNER_IPV6</td>
  <td>Specifies that the miniport adapter supports the corresponding task offload feature that the member specifies where the inner IP header of an encapsulated packet is IPv6.</td>
</tr>
<tr>
  <td>NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_OUTER_IPV6</td>
  <td>Specifies that the miniport adapter supports the corresponding task offload feature that the member specifies where the outer IP header of an encapsulated packet is IPv6.</td>
</tr>
</tbody>
</table>

<p>As an example, if a miniport adapter and driver only support an IPv6 header as outer IP header but not as inner IP header, it will set <strong>TransmitChecksumOffloadSupported</strong>, <strong>ReceiveChecksumOffloadSupported</strong>, <strong>LsoV2Supported</strong>, <strong>RssSupported</strong>, <strong>VmqSupported</strong>, and <strong>UsoSupported</strong> to the value of the bitwise OR of NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_INNER_IPV4, NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_OUTER_IPV4 and NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_OUTER_IPV6.</p>

<p>Regarding IP options and TCP options, the following assumption was made for encapsulated packets:</p>

<ul>
<li>If the NIC specifies <strong>IpOptions</strong> and <strong>TcpOptions</strong> support in normal checksum offload and LSOv2 advertisement, it must support the option processing for encapsulated packets if <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-virtualization-using-generic-routing-encapsulation--nvgre--task-offload">Network Virtualization using Generic Routing Encapsulation (NVGRE) Task Offload</a> is supported. This means it will support both inner and outer IP options and TCP options inside the encapsulated packets. There is no separate capability advertisement for these specific to only NVGRE Task Offload.</li>
</ul>

<p>It is possible for a protocol driver to offload "mixed mode" packets which means packets in which the inner and outer IP header versions are different. For example, a packet could have outer IP header as IPv6 and the inner IP header as IPv4.</p>

<h2 id="see-also">See also</h2>

<ul>
<li><p><a href="ndis_offload" title="typedef struct _NDIS_OFFLOAD {&#10;  NDIS_OBJECT_HEADER                       Header;&#10;  NDIS_TCP_IP_CHECKSUM_OFFLOAD             Checksum;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V1           LsoV1;&#10;  NDIS_IPSEC_OFFLOAD_V1                    IPsecV1;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V2           LsoV2;&#10;  ULONG                                    Flags;&#10;  NDIS_IPSEC_OFFLOAD_V2                    IPsecV2;&#10;  NDIS_TCP_RECV_SEG_COALESCE_OFFLOAD       Rsc;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD    EncapsulatedPacketTaskOffloadGre;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_V2 EncapsulatedPacketTaskOffloadVxlan;&#10;  UCHAR                                    EncapsulationTypes;&#10;  NDIS_RFC6877_464XLAT_OFFLOAD             Rfc6877Xlat;&#10;  NDIS_UDP_SEGMENTATION_OFFLOAD            UdpSegmentation;&#10;  NDIS_UDP_RSC_OFFLOAD                     UdpRsc;&#10;} NDIS_OFFLOAD, *PNDIS_OFFLOAD;">NDIS_OFFLOAD</a></p></li>
<li><p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-virtualization-using-generic-routing-encapsulation--nvgre--task-offload">Network Virtualization using Generic Routing Encapsulation (NVGRE) Task Offload</a></p></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_encapsulated_packet_task_offload">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddndis/ns-ntddndis-_ndis_encapsulated_packet_task_offload.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
