<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NET_DMA_DESCRIPTOR - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NET_DMA_DESCRIPTOR - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NET_DMA_DESCRIPTOR - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// netdma.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NET_DMA_DESCRIPTOR {
  union {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TransferSize;
    struct {
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> DCAContext : 32;
    } DCAContext32;
    struct {
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> DCAContext : 16;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved : 16;
    } DCAContext16;
    struct {
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> DCAContext : 8;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved : 24;
    } DCAContext8;
  };
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>            ControlFlags;
  <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a> SourceAddress;
  <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a> DestinationAddress;
  <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a> NextDescriptor;
  union {
    <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a>          Reserved1;
    <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a> NextSourceAddress;
  };
  union {
    <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a>          Reserved2;
    <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a> NextDestinationAddress;
  };
  <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a>          UserContext1;
  <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a>          UserContext2;
} NET_DMA_DESCRIPTOR, *PNET_DMA_DESCRIPTOR;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/ns-netdma-_net_dma_descriptor">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/net_dma_descriptor.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-netdma-_net_dma_descriptor)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_net_dma_descriptor-structure">_NET_DMA_DESCRIPTOR structure</h1>

<h2 id="description">Description</h2>

<p><strong>Note</strong> The NetDMA interface is not supported in Windows 8 and later.</p>

<p>The NET_DMA_DESCRIPTOR structure specifies the DMA transfer information for each entry in a linked
list of DMA descriptors.</p>

<h2 id="members">Members</h2>

<h3 id="transfersize"><code>TransferSize</code></h3>

<p>The size, in bytes, of the memory block that is associated with this DMA descriptor.</p>

<p>NetDMA 2.0 and later provider drivers use the
<strong>DCAContext32</strong>,
<strong>DCAContext16</strong>, and
<strong>DCAContext8</strong> members of the union with
<strong>TransferSize</strong> to support
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/direct-cache-access--dca-">Direct Cache Access
(DCA)</a>.</p>

<h3 id="dcacontext32"><code>DCAContext32</code></h3>

<p>A 32 bit DCA context.</p>

<h3 id="dcacontext32dcacontext"><code>DCAContext32.DCAContext</code></h3>

<p>A DCA context.</p>

<h3 id="dcacontext16"><code>DCAContext16</code></h3>

<p>A 16 bit DCA context.</p>

<h3 id="dcacontext16dcacontext"><code>DCAContext16.DCAContext</code></h3>

<p>A DCA context.</p>

<h3 id="dcacontext16reserved"><code>DCAContext16.Reserved</code></h3>

<p>Reserved bits.</p>

<h3 id="dcacontext8"><code>DCAContext8</code></h3>

<p>An 8 bit DCA context.</p>

<h3 id="dcacontext8dcacontext"><code>DCAContext8.DCAContext</code></h3>

<p>A DCA context.</p>

<h3 id="dcacontext8reserved"><code>DCAContext8.Reserved</code></h3>

<p>Reserved bits.</p>

<h3 id="controlflags"><code>ControlFlags</code></h3>

<p>A set of flags that specify the operations that the DMA engine should perform for this DMA
descriptor. This member must contain one or more of the following values (combined with a bitwise OR
operation):</p>

<table>
<thead>
<tr>
  <th>Unless otherwise noted, descriptions apply to when the bit is set.</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NET_DMA_SOURCE_PAGE_BREAK</strong></td>
  <td>A NetDMA version 2.0 or later provider starts the copy from the source physical address that is specified in the <strong>SourceAddress</strong> member and when it reaches the end of the first page, it continues the copy from the physical address that is specified in the <strong>NextSourceAddress</strong> member.</td>
</tr>
<tr>
  <td><strong>NET_DMA_DESTINATION_PAGE_BREAK</strong></td>
  <td>A NetDMA version 2.0 or later provider starts the copy to the destination physical address that is specified in the <strong>DestinationAddress</strong> member and when it reaches the end of the first page, it continues the copy to the physical address that is specified in the <strong>NextDestinationAddress</strong> member.</td>
</tr>
<tr>
  <td><strong>NET_DMA_OP_TYPE_CONTEXT_CHANGE</strong></td>
  <td>The DMA engine should identify the descriptor as a <em>context change</em> descriptor.<br><br>The NetDMA interface submits a context change descriptor to DCA-capable NetDMA providers to set the DCA target processor of the destination data for all of the DMA transfers on a NetDMA channel. The NetDMA interface uses the <strong>DCAContext8</strong> member in a context change descriptor to specify the 8-bit advanced programmable interrupt controller (APIC) identifier of the target processor for the channel.<br><br>A DCA-capable NetDMA provider must keep the DCA affinity of a DMA channel with a processor as long as it has not received a new context change descriptor.<br><br>The NetDMA interface submits a context change descriptor one time after the channel has been allocated and again when NetDMA detects that the DMA provider might have lost the hardware context (for example, after a suspend and resume operation).</td>
</tr>
<tr>
  <td><strong>NET_DMA_DESTINATION_DCA_ENABLE</strong></td>
  <td>If the DMA operation type is a standard DMA transfer, the DMA engine should send a DCA hint for the destination data to the DCA target processor that has been assigned to the DMA channel.<br><br>To set the DCA target processor of a DMA channel, the NetDMA interface previously submitted a context change descriptor to that channel.</td>
</tr>
<tr>
  <td><strong>NET_DMA_INTERRUPT_ON_COMPLETION</strong></td>
  <td>The DMA engine should generate an interrupt for the associated DMA channel after it processes this DMA descriptor.<br><br>When this bit is cleared, the DMA engine does not generate an interrupt.</td>
</tr>
<tr>
  <td><strong>NET_DMA_SOURCE_NO_SNOOP</strong></td>
  <td>The source address should not be snooped.<br><br>When this bit is cleared, the source address is in coherent memory space, and each CPU cache line must be snooped. The DMA client must verify that snooping of CPU caches is not required for proper DMA operation.</td>
</tr>
<tr>
  <td><strong>NET_DMA_DESTINATION_NO_SNOOP</strong></td>
  <td>The destination address should not be snooped.<br><br>When this bit is cleared, the destination address is in coherent memory space, and each CPU cache line must be snooped. The DMA client must verify that snooping of CPU caches is not required for proper DMA operation.</td>
</tr>
<tr>
  <td><strong>NET_DMA_STATUS_UPDATE_ON_COMPLETION</strong></td>
  <td>The <strong>CompletionVirtualAddress</strong> and <strong>CompletionPhysicalAddress</strong> members in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/ns-netdma-_net_dma_channel_parameters">NET_DMA_CHANNEL_PARAMETERS</a> structure reference a completion status value. The DMA engine updates the completion status value when it completes the processing of this descriptor.<br><br>The completion status value is a 64-bit-wide combination of the physical address of the most recent DMA descriptor that the DMA engine processed, and additional status information.<br><br>When this bit is cleared, the DMA engine does not use <strong>CompletionVirtualAddress</strong> or <strong>CompletionPhysicalAddress</strong>.</td>
</tr>
<tr>
  <td><strong>NET_DMA_SERIALIZE_TRANSFER</strong></td>
  <td>The DMA engine guarantees that all writes for this descriptor, including data and completion status, are complete before it reads the data for the next descriptor.<br><br>When this bit is cleared, the DMA engine can start processing the next descriptor before it completes the processing of this descriptor.</td>
</tr>
<tr>
  <td><strong>NET_DMA_NULL_TRANSFER</strong></td>
  <td>A DMA transfer is not required for this descriptor. The DMA engine is not required to check the <strong>TransferSize</strong>, <strong>SourceAddress</strong>, or <strong>DestinationAddress</strong> members.<br><br>When this bit is cleared, a DMA transfer might be required or it might be a zero-length transfer. The DMA engine must check the <strong>TransferSize</strong>, <strong>SourceAddress</strong>, or <strong>DestinationAddress</strong> members.<br><br><strong>Note</strong> If this bit is set or cleared, the NetDMA client must always ensure that the descriptor defines valid transfer parameters.</td>
</tr>
</tbody>
</table>

<p>The following bitmasks identify the remaining bits in the
<strong>ControlFlags</strong> member:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NET_DMA_OP_TYPE_MASK</strong></td>
  <td>A bit mask that specifies bits that are reserved for a DMA operation type. The NetDMA interface sets these bits to zero.</td>
</tr>
<tr>
  <td><strong>NET_DMA_RESERVED_MASK</strong></td>
  <td>A bit mask that specifies bits that are reserved for future applications. The NetDMA interface sets these bits to zero.</td>
</tr>
</tbody>
</table>

<h3 id="sourceaddress"><code>SourceAddress</code></h3>

<p>The physical address of a memory block that is a source for the DMA transfer.</p>

<h3 id="destinationaddress"><code>DestinationAddress</code></h3>

<p>The physical address of a memory block that is a destination for the DMA transfer.</p>

<h3 id="nextdescriptor"><code>NextDescriptor</code></h3>

<p>The physical address of the next NET_DMA_DESCRIPTOR structure in the linked list of descriptors.
If this descriptor is the last descriptor in the list,
<strong>NextDescriptor</strong> is <strong>NULL</strong>.</p>

<h3 id="reserved1"><code>Reserved1</code></h3>

<p>A <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> value that is reserved for the DMA engine or the DMA provider driver to use. NetDMA 2.0
and later provider drivers use the
<strong>NextSourceAddress</strong> member of the union with
<strong>Reserved1</strong> to support
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/source-and-destination-page-break">Source and Destination Page
Break</a>.</p>

<h3 id="nextsourceaddress"><code>NextSourceAddress</code></h3>

<p>The physical address of the second page of source address that is used in source page
break.</p>

<h3 id="reserved2"><code>Reserved2</code></h3>

<p>A <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> value that is reserved for use the DMA engine or the DMA provider driver to use. NetDMA
2.0 and later provider drivers use the
<strong>NextDestinationAddress</strong> member of the union with
<strong>Reserved2</strong> to support
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/source-and-destination-page-break">Source and Destination Page
Break</a>.</p>

<h3 id="nextdestinationaddress"><code>NextDestinationAddress</code></h3>

<p>The physical address of the second page of destination address that is used in destination page
break.</p>

<h3 id="usercontext1"><code>UserContext1</code></h3>

<p>A <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> value that is reserved for the NetDMA interface to use.</p>

<h3 id="usercontext2"><code>UserContext2</code></h3>

<p>A <a href="ulong64" title="typedef unsigned __int64 ULONG64;">ULONG64</a> value that is reserved for the NetDMA interface to use.</p>

<h2 id="remarks">Remarks</h2>

<p>The NET_DMA_DESCRIPTOR structure specifies the source, destination, and control information for a
single DMA transfer in a linked list of DMA descriptors.</p>

<p>To start a DMA transfer, the NetDMA interface supplies the physical address of a NET_DMA_DESCRIPTOR
structure at the
<em>DescriptorPhysicalAddress</em> parameter of the DMA provider driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/nc-netdma-dma_start_handler">ProviderStartDma</a> function. The
<em>DescriptorVirtualAddress</em> parameter contains the virtual address of the descriptor.</p>

<p>The
<strong>NextDescriptor</strong> member of a NET_DMA_DESCRIPTOR structure contains the physical address of the next
NET_DMA_DESCRIPTOR structure in the linked list of descriptors.</p>

<p>The NetDMA interface calls a DMA provider driver's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/nc-netdma-dma_append_handler">ProviderAppendDma</a> function to append a
linked list of DMA descriptors after the last descriptor on a DMA channel.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/ns-netdma-_net_dma_channel_parameters">NET_DMA_CHANNEL_PARAMETERS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/nc-netdma-dma_append_handler">ProviderAppendDma</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/nc-netdma-dma_start_handler">ProviderStartDma</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netdma/ns-netdma-_net_dma_descriptor">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/netdma/ns-netdma-_net_dma_descriptor.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
