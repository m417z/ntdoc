<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_NET_BUFFER_LIST_8021Q_INFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_NET_BUFFER_LIST_8021Q_INFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_NET_BUFFER_LIST_8021Q_INFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// nbl8021q.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDIS_NET_BUFFER_LIST_8021Q_INFO {
  union {
    struct {
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> UserPriority : 3;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> CanonicalFormatId : 1;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> VlanId : 12;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> Reserved : 16;
    } TagHeader;
    struct {
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> UserPriority : 3;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> CanonicalFormatId : 1;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> VlanId : 12;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> WMMInfo : 4;
      <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> Reserved : 12;
    } WLanTagHeader;
    PVOID Value;
  };
} NDIS_NET_BUFFER_LIST_8021Q_INFO, *PNDIS_NET_BUFFER_LIST_8021Q_INFO;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/nbl8021q/ns-nbl8021q-ndis_net_buffer_list_8021q_info">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_net_buffer_list_8021q_info.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-nbl8021q-ndis_net_buffer_list_8021q_info)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ndis_net_buffer_list_8021q_info-structure">_NDIS_NET_BUFFER_LIST_8021Q_INFO structure</h1>

<h2 id="description">Description</h2>

<p>The NDIS_NET_BUFFER_LIST_8021Q_INFO structure specifies 802.1Q information that is associated with a
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure.</p>

<h2 id="members">Members</h2>

<h3 id="tagheader"><code>TagHeader</code></h3>

<p>A member in the union that is contained in NDIS_NET_BUFFER_LIST_8021Q_INFO. 802.3 Ethernet
miniport drivers use
<strong>TagHeader</strong> to access 802.1Q information.
<strong>TagHeader</strong> is a bit field with the following members:</p>

<h3 id="tagheaderuserpriority"><code>TagHeader.UserPriority</code></h3>

<p>Specifies 802.1p priority information that is used to establish packet priority in shared-media
802 networks. The bits in this member specify an 802.1p priority value.</p>

<h3 id="tagheadercanonicalformatid"><code>TagHeader.CanonicalFormatId</code></h3>

<p>This member should be set to zero, which indicates that all MAC address information present in a
packet is in canonical format (that is, simplest form).</p>

<h3 id="tagheadervlanid"><code>TagHeader.VlanId</code></h3>

<p>Identifies the VLAN that a packet belongs to. Outgoing packets are marked with the VLAN
identifier.</p>

<h3 id="tagheaderreserved"><code>TagHeader.Reserved</code></h3>

<p>This member is reserved and should be set to zero.</p>

<h3 id="wlantagheader"><code>WLanTagHeader</code></h3>

<p>A member in the union that is contained in NDIS_NET_BUFFER_LIST_8021Q_INFO. Native 802.11
miniport drivers use
<strong>WLanTagHeader</strong> to access 802.1Q information.
<strong>WLanTagHeader</strong> is a bit field with the following members:</p>

<h3 id="wlantagheaderuserpriority"><code>WLanTagHeader.UserPriority</code></h3>

<p>Specifies 802.1p priority information that is used to establish packet priority in shared-media
802 networks. The bits in this member specify an 802.1p priority value.</p>

<h3 id="wlantagheadercanonicalformatid"><code>WLanTagHeader.CanonicalFormatId</code></h3>

<p>This member should be set to zero, which indicates that all MAC address information present in a
packet is in canonical format (that is, simplest form).</p>

<h3 id="wlantagheadervlanid"><code>WLanTagHeader.VlanId</code></h3>

<p>Identifies the VLAN that a packet belongs to. Outgoing packets are marked with the VLAN
identifier.</p>

<h3 id="wlantagheaderwmminfo"><code>WLanTagHeader.WMMInfo</code></h3>

<p>A wireless multimedia (WMM) integer value that is the same as the traffic identifier (TID) fields
that appear in certain frames that are used to deliver and to control the delivery of 802.1Q Quality
of Service (QoS) data. The values 0 through 7 represent QoS user priorities (UPs) for the MAC service
data units (MSDUs). The values 8 through 15 are reserved. Therefore, the highest bit in
<strong>WMMInfo</strong> must be zero.</p>

<p><strong>Note</strong> Traffic specification (TSPEC) and traffic classification (TCLAS) are not
supported.</p>

<h3 id="wlantagheaderreserved"><code>WLanTagHeader.Reserved</code></h3>

<p>This member is reserved and should be set to zero.</p>

<h3 id="value"><code>Value</code></h3>

<p>A member in the union that is contained in NDIS_NET_BUFFER_LIST_8021Q_INFO.
<strong>Value</strong> contains a pointer value that is type-compatible with the
<strong>NetBufferListInfo</strong> member in the
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure.</p>

<h2 id="remarks">Remarks</h2>

<p>To retrieve or insert 802.1Q information that is associated with a
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure, an NDIS driver
calls the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-info">NET_BUFFER_LIST_INFO</a> macro and specifies
the
<strong>Ieee8021QNetBufferListInfo</strong> information type.</p>

<p>The <a href="net_buffer_list_info" title="void NET_BUFFER_LIST_INFO(&#10;  _NBL,&#10;  _Id&#10;);">NET_BUFFER_LIST_INFO</a> macro returns the pointer that is specified in the
<strong>Value</strong> member of the NDIS_NET_BUFFER_LIST_8021Q_INFO structure. The NDIS driver can use the
<strong>TagHeader</strong> or
<strong>WLanTagHeader</strong> member of the union to access specific types of information, such as 802.1p priority
and VLAN identifier information. The
<strong>WLanTagHeader</strong> member provides access to the wireless multimedia (WMM) information in addition to
the information that is available through the
<strong>TagHeader</strong> member.</p>

<p>Miniport drivers that support the 802.1Q tag in hardware must use the NDIS_NET_BUFFER_LIST_8021Q_INFO
structure for transmit and receive operations:</p>

<ul>
<li>For transmit operations, the miniport driver must check for NDIS_NET_BUFFER_LIST_8021Q_INFO OOB data
in the
<a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure. The miniport
driver must ensure that the hardware creates the 802.1Q tag from the NDIS_NET_BUFFER_LIST_8021Q_INFO
specifications and insert it into the Ethernet frame.</li>
<li>For receive operations, the miniport driver must remove the 802.1Q tag from the Ethernet frame and
map the 802.1Q tag information into the NDIS_NET_BUFFER_LIST_8021Q_INFO OOB data in the <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a>
structure before indicating the data to NDIS with the
<a href="ndismindicatereceivenetbufferlists" title="VOID NdisMIndicateReceiveNetBufferLists(&#10;  [in] NDIS_HANDLE      MiniportAdapterHandle,&#10;       PNET_BUFFER_LIST NetBufferList,&#10;  [in] NDIS_PORT_NUMBER PortNumber,&#10;  [in] ULONG            NumberOfNetBufferLists,&#10;  [in] ULONG            ReceiveFlags&#10;);">NdisMIndicateReceiveNetBufferLists</a> function.</li>
</ul>

<h2 id="see-also">See also</h2>

<p><a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/net-buffer-list-info">NET_BUFFER_LIST_INFO</a></p>

<p><a href="ndismindicatereceivenetbufferlists" title="VOID NdisMIndicateReceiveNetBufferLists(&#10;  [in] NDIS_HANDLE      MiniportAdapterHandle,&#10;       PNET_BUFFER_LIST NetBufferList,&#10;  [in] NDIS_PORT_NUMBER PortNumber,&#10;  [in] ULONG            NumberOfNetBufferLists,&#10;  [in] ULONG            ReceiveFlags&#10;);">NdisMIndicateReceiveNetBufferLists</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/nbl8021q/ns-nbl8021q-ndis_net_buffer_list_8021q_info">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/nbl8021q/ns-nbl8021q-ndis_net_buffer_list_8021q_info.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
