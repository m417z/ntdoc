<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="EVT_MBB_DEVICE_RECEIVE_MBIM_FRAGMENT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EVT_MBB_DEVICE_RECEIVE_MBIM_FRAGMENT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            EVT_MBB_DEVICE_RECEIVE_MBIM_FRAGMENT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// mbbcx.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">EVT_MBB_DEVICE_RECEIVE_MBIM_FRAGMENT EvtMbbDeviceReceiveMbimFragment;

VOID EvtMbbDeviceReceiveMbimFragment(
  WDFDEVICE Device,
  MBBREQUEST ReceiveRequest
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mbbcx/nc-mbbcx-evt_mbb_device_receive_mbim_fragment">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/evt_mbb_device_receive_mbim_fragment.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-mbbcx-evt_mbb_device_receive_mbim_fragment)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="evt_mbb_device_receive_mbim_fragment-callback-function">EVT_MBB_DEVICE_RECEIVE_MBIM_FRAGMENT callback function</h1>

<h2 id="description">Description</h2>

<p>A client driver's <em>EvtMbbDeviceReceiveMbimFragment</em> event callback function provides the response message returned from its device in response to a previous MBIM control message sent from MBBCx. This callback function is the equivalent of the <em>GetEncapsulatedResponse</em> request defined in the MBIM specification.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="device"><code>Device</code></h3>

<p>A handle to a framework device object the client driver obtained from a previous call to <strong><a href="wdfdevicecreate" title="NTSTATUS WdfDeviceCreate(&#10;  [in, out]      PWDFDEVICE_INIT        *DeviceInit,&#10;  [in, optional] PWDF_OBJECT_ATTRIBUTES DeviceAttributes,&#10;  [out]          WDFDEVICE              *Device&#10;);">WdfDeviceCreate</a></strong>.</p>

<h3 id="receiverequest"><code>ReceiveRequest</code></h3>

<p>A handle to the framework object which represents the request to receive a fragmented MBIM message from the device.</p>

<h2 id="prototype">Prototype</h2>

<div class="codehilite">
<pre><span></span><code><span class="c1">//Declaration</span>

<span class="n">EVT_MBB_DEVICE_RECEIVE_MBIM_FRAGMENT</span><span class="w"> </span><span class="n">EvtMbbDeviceReceiveMbimFragment</span><span class="p">;</span>

<span class="c1">// Definition</span>

<span class="n">VOID</span><span class="w"> </span><span class="nf">EvtMbbDeviceReceiveMbimFragment</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">WDFDEVICE</span><span class="w"> </span><span class="n">Device</span>
<span class="w">    </span><span class="n">MBBREQUEST</span><span class="w"> </span><span class="n">ReceiveRequest</span>
<span class="p">)</span>
<span class="p">{...}</span>
</code></pre>
</div>

<h2 id="remarks">Remarks</h2>

<p>An MBBCx client driver must register an <em>EvtMbbDeviceReceiveMbimFragment</em> callback function by calling <strong><a href="mbbdeviceinitialize" title="NTSTATUS MbbDeviceInitialize(&#10;  WDFDEVICE          Device,&#10;  PMBB_DEVICE_CONFIG Config&#10;);">MbbDeviceInitialize</a></strong>.</p>

<p>The MBBCx framework calls this callback function after it is notified by the client driver that <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mbbcx/nf-mbbcx-mbbdeviceresponseavailable">an MBIM message is available from the device</a>, either as a response to a previous MBIM control message request from the framework, or as an unsolicited device event.</p>

<p>In this callback function, the client driver puts the response MBIM message into the buffer space pre-allocated by the MBBCx framework. If the size of a single response message is larger than the size of the pre-allocated buffer, and then it must split this response message into multiple fragmented messages as described in the MBIM specification. When fragmentation happens, MBBCx will continue to call this callback function, once per fragment, until all fragments of the response MBIM message has been received.</p>

<p>To access the pre-allocated buffer space and its size, the client driver should call <strong><a href="mbbrequestgetbuffer" title="PVOID MbbRequestGetBuffer(&#10;  MBBREQUEST Request,&#10;  size_t     *BufferSize&#10;);">MbbRequestGetBuffer</a></strong>. Once the client driver fills this buffer space with the response message, or a fragment of the response message, it must call <strong><a href="mbbrequestcompletewithinformation" title="VOID MbbRequestCompleteWithInformation(&#10;  MBBREQUEST Request,&#10;  NTSTATUS   NtStatus,&#10;  ULONG_PTR  Information&#10;);">MbbRequestCompleteWithInformation</a></strong> with the number of bytes actually being filled. This can be done either asynchronously or synchronously.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/netcx/writing-an-mbbcx-client-driver#handling-mbim-control-messages">Handling MBIM control messages</a>.</p>

<h3 id="example">Example</h3>

<p>Error handling has been left out of this example for brevity and clarity.</p>

<div class="codehilite">
<pre><span></span><code><span class="n">VOID</span>
<span class="nf">EvtMbbDeviceReceiveMbimFragment</span><span class="p">(</span>
<span class="w">    </span><span class="n">WDFDEVICE</span><span class="w">  </span><span class="n">Device</span><span class="p">,</span>
<span class="w">    </span><span class="n">MBBREQUEST</span><span class="w"> </span><span class="n">ReceiveRequest</span>
<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt"><a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a></span><span class="w"> </span><span class="n">filledSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt"><a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a></span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">PVOID</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="mbbrequestgetbuffer" title="PVOID MbbRequestGetBuffer(&#10;  MBBREQUEST Request,&#10;  size_t     *BufferSize&#10;);">MbbRequestGetBuffer</a></span><span class="p">(</span><span class="n">ReceiveRequest</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bufferSize</span><span class="p">);</span>

<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Write the response MBIM message into the buffer.</span>
<span class="w">    </span><span class="c1">// This example uses memset as an illustration of how</span>
<span class="w">    </span><span class="c1">// it can being completed synchronously.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;*&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">);</span>
<span class="w">    </span><span class="n">filledSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">;</span>

<span class="w">    </span><span class="n"><a href="mbbrequestcompletewithinformation" title="VOID MbbRequestCompleteWithInformation(&#10;  MBBREQUEST Request,&#10;  NTSTATUS   NtStatus,&#10;  ULONG_PTR  Information&#10;);">MbbRequestCompleteWithInformation</a></span><span class="p">(</span><span class="n">ReceiveRequest</span><span class="p">,</span>
<span class="w">        </span><span class="n"><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></span><span class="p">,</span>
<span class="w">        </span><span class="n">filledSize</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mbbcx/nc-mbbcx-evt_mbb_device_receive_mbim_fragment">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/mbbcx/nc-mbbcx-evt_mbb_device_receive_mbim_fragment.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
