<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtOpenKey - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtOpenKey - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtOpenKey - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTREGAPI_H

</span><span class="ntdoc-code-intro language-cpp">/**
 * Opens an existing registry key.
 *
 * \param[out] KeyHandle A pointer to a handle that receives the key handle.
 * \param[in] DesiredAccess The access mask that specifies the desired access rights.
 * \param[in] ObjectAttributes A pointer to an <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a> structure that specifies the object attributes.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \remarks NtOpenKey ignores the security information in the ObjectAttributes structure.
 */
</span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtOpenKey(
    _Out_ PHANDLE KeyHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_ <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/8618499032f73e0b25139788113fe705c3461372/phnt/include/ntregapi.h#L750">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwOpenKey(
    _Out_ PHANDLE KeyHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_ <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/8618499032f73e0b25139788113fe705c3461372/phnt/include/ntzwapi.h#L2578">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// wdm.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwOpenKey(
  [out] PHANDLE            KeyHandle,
  [in]  ACCESS_MASK        DesiredAccess,
  [in]  <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwopenkey">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntopenkey.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwopenkey)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>ZwOpenKey</strong> routine opens an existing registry key.</p>
<h2>Parameters</h2>
<h3><code>KeyHandle</code> [out]</h3>
<p>Pointer to the HANDLE variable that receives the handle to the key.</p>
<h3><code>DesiredAccess</code> [in]</h3>
<p>Specifies an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> value that determines the requested access to the object. For more information, see the <em>DesiredAccess</em> parameter of <a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a>.</p>
<h3><code>ObjectAttributes</code> [in]</h3>
<p>Pointer to an <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a> structure that specifies the object name and other attributes. Use <a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a> to initialize this structure. If the caller is not running in a system thread context, it must set the <a href="obj_kernel_handle" title="#define OBJ_KERNEL_HANDLE 0x00000200L">OBJ_KERNEL_HANDLE</a> attribute when it calls <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong>.</p>
<h2>Return value</h2>
<p><strong>ZwOpenKey</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the given key was opened. Otherwise, it can return an error status, including the following:</p>
<ul>
<li>
<p>STATUS_INVALID_HANDLE</p>
</li>
<li>
<p>STATUS_ACCESS_DENIED</p>
</li>
</ul>
<h2>Remarks</h2>
<p><strong>ZwOpenKey</strong> supplies a handle that the caller can use to manipulate a registry key. The routine provides a subset of the functionality of <a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a>. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-the-registry-in-a-driver">Using the Registry in a Driver</a>.</p>
<p>If the specified key does not exist, <strong>ZwOpenKey</strong> returns an error status and does not return a key handle.</p>
<p>Once the handle pointed to by <em>KeyHandle</em> is no longer in use, the driver must call <a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a> to close it.</p>
<p><strong>ZwOpenKey</strong> ignores the security information in the structure that the <em>ObjectAttributes</em> parameter points to.</p>
<p>If the caller is not running in a system thread context, it must ensure that any handles it creates are private handles. Otherwise, the handle can be accessed by the process in whose context the driver is running. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/object-handles">Object Handles</a>.</p>
<p>For more information about working with registry keys, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-the-registry-in-a-driver">Using the Registry in a Driver</a>.</p>
<p>If the call to this function occurs in user mode, you should use the name &quot;<strong>NtOpenKey</strong>&quot; instead of &quot;<strong>ZwOpenKey</strong>&quot;.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a></p>
<p><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></p>
<p><a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a></p>
<p><a href="ntdeletekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtDeleteKey(&#10;    _In_ HANDLE KeyHandle&#10;    );">ZwDeleteKey</a></p>
<p><a href="ntenumeratekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtEnumerateKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ ULONG Index,&#10;    _In_ KEY_INFORMATION_CLASS KeyInformationClass,&#10;    _Out_writes_bytes_to_opt_(Length, *ResultLength) PVOID KeyInformation,&#10;    _In_ ULONG Length,&#10;    _Out_ PULONG ResultLength&#10;    );">ZwEnumerateKey</a></p>
<p><a href="ntenumeratevaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtEnumerateValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ ULONG Index,&#10;    _In_ KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,&#10;    _Out_writes_bytes_to_opt_(Length, *ResultLength) PVOID KeyValueInformation,&#10;    _In_ ULONG Length,&#10;    _Out_ PULONG ResultLength&#10;    );">ZwEnumerateValueKey</a></p>
<p><a href="ntflushkey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtFlushKey(&#10;    _In_ HANDLE KeyHandle&#10;    );">ZwFlushKey</a></p>
<p><a href="ntquerykey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ KEY_INFORMATION_CLASS KeyInformationClass,&#10;    _Out_writes_bytes_to_opt_(Length, *ResultLength) PVOID KeyInformation,&#10;    _In_ ULONG Length,&#10;    _Out_ PULONG ResultLength&#10;    );">ZwQueryKey</a></p>
<p><a href="ntqueryvaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ PCUNICODE_STRING ValueName,&#10;    _In_ KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,&#10;    _Out_writes_bytes_to_opt_(Length, *ResultLength) PVOID KeyValueInformation,&#10;    _In_ ULONG Length,&#10;    _Out_ PULONG ResultLength&#10;    );">ZwQueryValueKey</a></p>
<p><a href="ntsetvaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ PCUNICODE_STRING ValueName,&#10;    _In_opt_ ULONG TitleIndex,&#10;    _In_ ULONG Type,&#10;    _In_reads_bytes_opt_(DataSize) PVOID Data,&#10;    _In_ ULONG DataSize&#10;    );">ZwSetValueKey</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwopenkey">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwopenkey.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwopenkey">documented in Windows Driver Kit</a>.</p>
<hr />
<p>See <code>ZwOpenKey</code> in <em>NT DDK</em> or <em>2000 DDK</em> for detailed description.</p>
<h1>See also</h1>
<ul>
<li><code><a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">NtCreateKey</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntopenkey.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
