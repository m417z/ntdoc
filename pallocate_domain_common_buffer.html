<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PALLOCATE_DOMAIN_COMMON_BUFFER - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PALLOCATE_DOMAIN_COMMON_BUFFER - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PALLOCATE_DOMAIN_COMMON_BUFFER - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PALLOCATE_DOMAIN_COMMON_BUFFER PallocateDomainCommonBuffer;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PallocateDomainCommonBuffer(
  [in]           PDMA_ADAPTER DmaAdapter,
  [in]           HANDLE DomainHandle,
  [in, optional] <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PPHYSICAL_ADDRESS</a> MaximumAddress,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Length,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags,
  [in, optional] <a href="memory_caching_type" title="typedef enum _MEMORY_CACHING_TYPE {&#10;  MmNonCached,&#10;  MmCached,&#10;  MmWriteCombined,&#10;  MmHardwareCoherentCached,&#10;  MmNonCachedUnordered,&#10;  MmUSWCCached,&#10;  MmMaximumCacheType,&#10;  MmNotMapped&#10;} MEMORY_CACHING_TYPE;">MEMORY_CACHING_TYPE</a> *CacheType,
  [in]           NODE_REQUIREMENT PreferredNode,
  [out]          <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PPHYSICAL_ADDRESS</a> LogicalAddress,
  [out]          PVOID *VirtualAddress
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-pallocate_domain_common_buffer">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pallocate_domain_common_buffer.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-pallocate_domain_common_buffer)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>This callback function allocates the memory for a domain common buffer.</p>
<h2>Parameters</h2>
<h3><code>DmaAdapter</code> [in]</h3>
<p>A pointer to a <a href="padapter_object" title="typedef struct _DMA_ADAPTER {&#10;  USHORT          Version;&#10;  USHORT          Size;&#10;  PDMA_OPERATIONS DmaOperations;&#10;} *PADAPTER_OBJECT, DMA_ADAPTER, *PDMA_ADAPTER;">DMA_ADAPTER</a> structure. This structure is the adapter object that represents the driver's bus-master DMA device or system DMA channel. The caller obtained this pointer from a previous call to the <strong><a href="iogetdmaadapter" title="_DMA_ADAPTER * IoGetDmaAdapter(&#10;  [in, optional] PDEVICE_OBJECT      PhysicalDeviceObject,&#10;  [in]           _DEVICE_DESCRIPTION *DeviceDescription,&#10;  [out]          PULONG              NumberOfMapRegisters&#10;);">IoGetDmaAdapter</a></strong> routine.</p>
<h3><code>DomainHandle</code> [in]</h3>
<p>The handle to the DMA domain that the caller obtained from a previous call to <em><a href="pget_dma_domain" title="PGET_DMA_DOMAIN PgetDmaDomain;&#10;&#10;HANDLE PgetDmaDomain(&#10;  [in] PDMA_ADAPTER DmaAdapter&#10;)&#10;{...}">PGET_DMA_DOMAIN</a></em>.</p>
<h3><code>MaximumAddress</code> [in, optional]</h3>
<p>A pointer to a variable that contains the maximum logical address for the common buffer. This parameter indicates that the buffer should be allocated from memory below this address. This parameter is optional and can be specified as NULL to indicate that there is no maximum address.</p>
<h3><code>Length</code> [in]</h3>
<p>The size, in bytes, of the common buffer that is to be allocated for the DMA operation.</p>
<h3><code>Flags</code> [in]</h3>
<p>The size, in bytes, of the common buffer that is to be allocated for the DMA operation.</p>
<p>Possible values include:</p>
<ul>
<li><strong>DOMAIN_COMMON_BUFFER_LARGE_PAGE</strong></li>
</ul>
<p>The common buffer will be allocated using a larger page granularity of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> * 512. Note that this can increase the chance of the allocation being unsuccessful.</p>
<h3><code>CacheType</code> [in, optional]</h3>
<p>A pointer to a <strong><a href="memory_caching_type" title="typedef enum _MEMORY_CACHING_TYPE {&#10;  MmNonCached,&#10;  MmCached,&#10;  MmWriteCombined,&#10;  MmHardwareCoherentCached,&#10;  MmNonCachedUnordered,&#10;  MmUSWCCached,&#10;  MmMaximumCacheType,&#10;  MmNotMapped&#10;} MEMORY_CACHING_TYPE;">MEMORY_CACHING_TYPE</a></strong> enumeration indicating whether the routine must enable or disable cached memory in the common buffer that is to be allocated. Only values of <strong>MmNonCached</strong> and <strong>MmCached</strong> are supported. The parameter is optional and can be specified as NULL to specify the caching will be dependent upon the hardware platform default.</p>
<p>If a caller provides an override value of <strong>MmCached</strong> on an adapter that is not cache-coherent, they are responsible for flushing the contents of the cache. If unsure, a caller should always provide NULL.</p>
<h3><code>PreferredNode</code> [in]</h3>
<p>The preferred NUMA node from which the memory is to be allocated. If N is the number of NUMA nodes in a multiprocessor system, <em>PreferredNode</em> is a number in the range 0 to Nâ€“1. For a one-processor system or a non-NUMA multiprocessor system, set <em>PreferredNode</em> to zero.</p>
<h3><code>LogicalAddress</code> [out]</h3>
<p>A pointer to a variable into which this routine writes the logical address that the device can use to access the common buffer. The DMA device should use this logical address instead of the physical address that is returned by a routine such as <strong><a href="mmgetphysicaladdress" title="PHYSICAL_ADDRESS MmGetPhysicalAddress(&#10;  [in] PVOID BaseAddress&#10;);">MmGetPhysicalAddress</a></strong>.</p>
<h3><code>VirtualAddress</code> [out]</h3>
<p>A pointer to a variable into which this routine writes the corresponding virtual address of the allocated buffer.</p>
<h2>Return value</h2>
<p>Returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful. Otherwise, it returns an appropriate <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS value</a>.</p>
<h2>Remarks</h2>
<h2>See also</h2>
<p><strong><a href="dma_operations" title="typedef struct _DMA_OPERATIONS {&#10;  ULONG                                   Size;&#10;  PPUT_DMA_ADAPTER                        PutDmaAdapter;&#10;  PALLOCATE_COMMON_BUFFER                 AllocateCommonBuffer;&#10;  PFREE_COMMON_BUFFER                     FreeCommonBuffer;&#10;  PALLOCATE_ADAPTER_CHANNEL               AllocateAdapterChannel;&#10;  PFLUSH_ADAPTER_BUFFERS                  FlushAdapterBuffers;&#10;  PFREE_ADAPTER_CHANNEL                   FreeAdapterChannel;&#10;  PFREE_MAP_REGISTERS                     FreeMapRegisters;&#10;  PMAP_TRANSFER                           MapTransfer;&#10;  PGET_DMA_ALIGNMENT                      GetDmaAlignment;&#10;  PREAD_DMA_COUNTER                       ReadDmaCounter;&#10;  PGET_SCATTER_GATHER_LIST                GetScatterGatherList;&#10;  PPUT_SCATTER_GATHER_LIST                PutScatterGatherList;&#10;  PCALCULATE_SCATTER_GATHER_LIST_SIZE     CalculateScatterGatherList;&#10;  PBUILD_SCATTER_GATHER_LIST              BuildScatterGatherList;&#10;  PBUILD_MDL_FROM_SCATTER_GATHER_LIST     BuildMdlFromScatterGatherList;&#10;  PGET_DMA_ADAPTER_INFO                   GetDmaAdapterInfo;&#10;  PGET_DMA_TRANSFER_INFO                  GetDmaTransferInfo;&#10;  PINITIALIZE_DMA_TRANSFER_CONTEXT        InitializeDmaTransferContext;&#10;...">DMA_OPERATIONS</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-pallocate_domain_common_buffer">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-pallocate_domain_common_buffer.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
