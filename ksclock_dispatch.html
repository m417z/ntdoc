<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KSCLOCK_DISPATCH - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KSCLOCK_DISPATCH - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KSCLOCK_DISPATCH - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _KSCLOCK_DISPATCH {
  PFNKSPINSETTIMER       SetTimer;
  PFNKSPINCANCELTIMER    CancelTimer;
  PFNKSPINCORRELATEDTIME CorrelatedTime;
  PFNKSPINRESOLUTION     Resolution;
} KSCLOCK_DISPATCH, *PKSCLOCK_DISPATCH;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/ns-ks-_ksclock_dispatch">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ksclock_dispatch.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ks-_ksclock_dispatch)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ksclock_dispatch-structure">_KSCLOCK_DISPATCH structure</h1>

<h2 id="description">Description</h2>

<p>The KSCLOCK_DISPATCH structure contains the callbacks required for a pin to implement a clock object.</p>

<h2 id="members">Members</h2>

<h3 id="settimer"><code>SetTimer</code></h3>

<p>Optionally contains a pointer to an alternate function to use in generating DPC timer callbacks based on a presentation time. If this is set, this function is used to set timers based on deltas to the current presentation time in order to generate event notifications. If an alternate function is specified to set timers, a corresponding <strong>CancelTimer</strong> function must also be provided. This is set to <strong>NULL</strong> if the default <a href="kesettimerex" title="BOOLEAN KeSetTimerEx(&#10;  [in, out]      PKTIMER       Timer,&#10;  [in]           LARGE_INTEGER DueTime,&#10;  [in]           LONG          Period,&#10;  [in, optional] PKDPC         Dpc&#10;);">KeSetTimerEx</a> function is used to approximate the next notification time. This would normally be set only if a <strong><a href="kesettimerex" title="BOOLEAN KeSetTimerEx(&#10;  [in, out]      PKTIMER       Timer,&#10;  [in]           LARGE_INTEGER DueTime,&#10;  [in]           LONG          Period,&#10;  [in, optional] PKDPC         Dpc&#10;);">KeSetTimerEx</a></strong> function was being used. The function must have the same characteristics as the default function.</p>

<p>The function should be prototyped as follows:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOLEAN</span><span class="w"> </span><span class="nf">SetTimer</span><span class="w"> </span><span class="p">(</span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">PKSPIN</a></span><span class="w"> </span><span class="n">Pin</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PKTIMER</span><span class="w"> </span><span class="n">Timer</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">LARGE_INTEGER</span><span class="w"> </span><span class="n">DueTime</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PKDPC</span><span class="w"> </span><span class="n">Dpc</span><span class="p">);</span>
</code></pre>
</div>

<p>See the documentation for <strong><a href="kesettimerex" title="BOOLEAN KeSetTimerEx(&#10;  [in, out]      PKTIMER       Timer,&#10;  [in]           LARGE_INTEGER DueTime,&#10;  [in]           LONG          Period,&#10;  [in, optional] PKDPC         Dpc&#10;);">KeSetTimerEx</a></strong> for details on implementation of this function. Any client implementation must behave in a similar manner.</p>

<h3 id="canceltimer"><code>CancelTimer</code></h3>

<p>Optionally contains an alternate function to use in canceling outstanding timer callbacks. If an alternate function is provided to cancel timers, a corresponding <em>SetTimer</em> function must also be provided. This is set to <strong>NULL</strong> if the default <strong><a href="kecanceltimer" title="BOOLEAN KeCancelTimer(&#10;  [in, out] PKTIMER unnamedParam1&#10;);">KeCancelTimer</a></strong> function is to be used. The function must have the same characteristics as the default function.</p>

<p>The function should be prototyped as follows:
<!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOLEAN</span><span class="w"> </span><span class="nf">CancelTimer</span><span class="w"> </span><span class="p">(</span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">PKSPIN</a></span><span class="w"> </span><span class="n">Pin</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PKTIMER</span><span class="w"> </span><span class="n">Timer</span><span class="p">);</span>
</code></pre>
</div>

<p>See the documentation for <strong><a href="kecanceltimer" title="BOOLEAN KeCancelTimer(&#10;  [in, out] PKTIMER unnamedParam1&#10;);">KeCancelTimer</a></strong> for details on the implementation of this function. Any client implementation must behave in a similar manner.</p>

<h3 id="correlatedtime"><code>CorrelatedTime</code></h3>

<p>A pointer to a function to retrieve the current clock time and a correlated system time as an atomic operation. The function should be prototyped as follows:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n"><a href="longlong" title="typedef __int64 LONGLONG;">LONGLONG</a></span><span class="w"> </span><span class="nf">CorrelatedTime</span><span class="w"> </span><span class="p">(</span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">PKSPIN</a></span><span class="w"> </span><span class="n">Pin</span><span class="p">,</span>
<span class="w">    </span><span class="n">OUT</span><span class="w"> </span><span class="n">PLONGLONG</span><span class="w"> </span><span class="n">SystemTime</span><span class="p">);</span>
</code></pre>
</div>

<p>The current clock time should be returned and the current system time should be placed in <strong>SystemTime</strong>.</p>

<h3 id="resolution"><code>Resolution</code></h3>

<p>A pointer to a function to specify the resolution of the clock. This corresponds to the KS property <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/ksproperty-clock-resolution">KSPROPERTY_CLOCK_RESOLUTION</a>. This function should report the granularity in terms of 100-nanosecond units. For more information, see the KS documentation on KSPROPERTY_CLOCK_RESOLUTION.</p>

<p>The function should be prototyped as follows:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">Resolution</span><span class="w"> </span><span class="p">(</span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">PKSPIN</a></span><span class="w"> </span><span class="n">Pin</span><span class="p">,</span>
<span class="w">        </span><span class="n">OUT</span><span class="w"> </span><span class="n"><a href="ksresolution" title="typedef struct {&#10;  LONGLONG Granularity;&#10;  LONGLONG Error;&#10;} KSRESOLUTION, *PKSRESOLUTION;">PKSRESOLUTION</a></span><span class="w"> </span><span class="n">Resolution</span><span class="p">);</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">KDPC</a></p>

<p><a href="kspin" title="typedef struct _KSPIN {&#10;  const KSPIN_DESCRIPTOR_EX *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  ULONG                     Id;&#10;  KSPIN_COMMUNICATION       Communication;&#10;  BOOLEAN                   ConnectionIsExternal;&#10;  KSPIN_INTERFACE           ConnectionInterface;&#10;  KSPIN_MEDIUM              ConnectionMedium;&#10;  KSPRIORITY                ConnectionPriority;&#10;  PKSDATAFORMAT             ConnectionFormat;&#10;  PKSMULTIPLE_ITEM          AttributeList;&#10;  ULONG                     StreamHeaderSize;&#10;  KSPIN_DATAFLOW            DataFlow;&#10;  KSSTATE                   DeviceState;&#10;  KSRESET                   ResetState;&#10;  KSSTATE                   ClientState;&#10;} KSPIN, *PKSPIN;">KSPIN</a></p>

<p><a href="kspin_dispatch" title="typedef struct _KSPIN_DISPATCH {&#10;  PFNKSPINIRP                Create;&#10;  PFNKSPINIRP                Close;&#10;  PFNKSPIN                   Process;&#10;  PFNKSPINVOID               Reset;&#10;  PFNKSPINSETDATAFORMAT      SetDataFormat;&#10;  PFNKSPINSETDEVICESTATE     SetDeviceState;&#10;  PFNKSPIN                   Connect;&#10;  PFNKSPINVOID               Disconnect;&#10;  const KSCLOCK_DISPATCH     *Clock;&#10;  const KSALLOCATOR_DISPATCH *Allocator;&#10;} KSPIN_DISPATCH, *PKSPIN_DISPATCH;">KSPIN_DISPATCH</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/ksproperty-clock-resolution">KSPROPERTY_CLOCK_RESOLUTION</a></p>

<p><a href="ksresolution" title="typedef struct {&#10;  LONGLONG Granularity;&#10;  LONGLONG Error;&#10;} KSRESOLUTION, *PKSRESOLUTION;">KSRESOLUTION</a></p>

<p><a href="kesettimerex" title="BOOLEAN KeSetTimerEx(&#10;  [in, out]      PKTIMER       Timer,&#10;  [in]           LARGE_INTEGER DueTime,&#10;  [in]           LONG          Period,&#10;  [in, optional] PKDPC         Dpc&#10;);">KeSetTimerEx</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/ns-ks-_ksclock_dispatch">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/ns-ks-_ksclock_dispatch.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
