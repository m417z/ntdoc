<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="GET_VIRTUAL_FUNCTION_PROBED_BARS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>GET_VIRTUAL_FUNCTION_PROBED_BARS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            GET_VIRTUAL_FUNCTION_PROBED_BARS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">GET_VIRTUAL_FUNCTION_PROBED_BARS GetVirtualFunctionProbedBars;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> GetVirtualFunctionProbedBars(
  [in, out] PVOID Context,
  [out]     PULONG BaseRegisterValues
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-get_virtual_function_probed_bars">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/get_virtual_function_probed_bars.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-get_virtual_function_probed_bars)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>GetVirtualFunctionProbedBars</strong> routine returns the values of the PCI Express (PCIe) Base Address Registers (BARs) of a device that supports the single root I/O virtualization (SR-IOV) interface.</p>

<p><strong>GetVirtualFunctionProbedBars</strong> returns the BAR values that were reported by the device after a query that was performed by the PCI bus driver. This query determines the memory or I/O address space that is required by the device.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="context-in-out"><code>Context</code> [in, out]</h3>

<p>A pointer to interface-specific context information. The caller passes the value that is passed as the <strong>Context</strong> member of the <strong><a href="pci_virtualization_interface" title="typedef struct _PCI_VIRTUALIZATION_INTERFACE {&#10;  USHORT                            Size;&#10;  USHORT                            Version;&#10;  PVOID                             Context;&#10;  PINTERFACE_REFERENCE              InterfaceReference;&#10;  PINTERFACE_DEREFERENCE            InterfaceDereference;&#10;  PSET_VIRTUAL_DEVICE_DATA          SetVirtualFunctionData;&#10;  PGET_VIRTUAL_DEVICE_DATA          GetVirtualFunctionData;&#10;  PGET_VIRTUAL_DEVICE_LOCATION      GetLocation;&#10;  PGET_VIRTUAL_DEVICE_RESOURCES     GetResources;&#10;  PENABLE_VIRTUALIZATION            EnableVirtualization;&#10;  PGET_VIRTUAL_FUNCTION_PROBED_BARS GetVirtualFunctionProbedBars;&#10;} PCI_VIRTUALIZATION_INTERFACE, *PPCI_VIRTUALIZATION_INTERFACE;">PCI_VIRTUALIZATION_INTERFACE</a></strong> structure for the interface.</p>

<h3 id="baseregistervalues-out"><code>BaseRegisterValues</code> [out]</h3>

<p>A pointer to an array of <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> values. The <strong>GetVirtualFunctionProbedBars</strong> routine returns a value for each BAR of the device.</p>

<p><strong>GetVirtualFunctionProbedBars</strong> returns a maximum of <strong>PCI_TYPE0_ADDRESSES</strong> values within this array.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong>GetVirtualFunctionProbedBars</strong> routine returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The operation completed successfully.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_DEVICE_STATE</strong></td>
  <td>The device does not support the SR-IOV interface.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The PCI bus driver. which runs in the management operating system of the Hyper-V parent partition, queries the memory or I/O address space requirements of each BAR of the device. The PCI bus driver performs this query when the it first detects the adapter on the bus.</p>

<p>Through this BAR query, the PCI bus driver determines the following:</p>

<ul>
<li><p>Whether a BAR is supported by the device.</p></li>
<li><p>If a BAR is supported, how much memory or I/O address space is required for the BAR.</p></li>
</ul>

<p>The PCI driver performs this BAR query as follows:</p>

<ol>
<li><p>The PCI bus driver writes 0xFFFFFFFF to a BAR.</p></li>
<li><p>The PCI bus driver reads the BAR to determine the memory or address space that the device requires. A value of zero indicates that the device does not support the BAR.</p></li>
</ol>

<p>The <strong>GetVirtualFunctionProbedBars</strong> routine is provided by the <strong>GUID_PCI_VIRTUALIZATION_INTERFACE</strong> interface.</p>

<p>The following notes apply to the <strong>GetVirtualFunctionProbedBars</strong> routine:</p>

<ul>
<li><p>The SR-IOV interface does not require that the BARs of a PCIe VF comply with the protocol for determining the size of the memory block or I/O address space of a BAR. Therefore, the virtual PCI (VPCI) driver, which runs in the guest operating system, determines the size by using the equivalent size from the BARs on the physical device. The VPCI driver obtains this information by calling the <strong>GetVirtualFunctionProbedBars</strong> routine.</p></li>
<li><p>The VPCI driver requires the size of the memory or I/O
address space for each BAR after the physical device has started. At that point, the PCI driver cannot perform a BAR query on the device without altering the current value of the BAR. Therefore, when the <strong>GetVirtualFunctionProbedBars</strong> routine is called by the VPCI driver, the PCI driver returns the BAR information that it obtained during the BAR query. The PCI driver performed this query when the device was first detected on the bus.</p></li>
</ul>

<h2 id="see-also">See also</h2>

<p><strong><a href="pci_virtualization_interface" title="typedef struct _PCI_VIRTUALIZATION_INTERFACE {&#10;  USHORT                            Size;&#10;  USHORT                            Version;&#10;  PVOID                             Context;&#10;  PINTERFACE_REFERENCE              InterfaceReference;&#10;  PINTERFACE_DEREFERENCE            InterfaceDereference;&#10;  PSET_VIRTUAL_DEVICE_DATA          SetVirtualFunctionData;&#10;  PGET_VIRTUAL_DEVICE_DATA          GetVirtualFunctionData;&#10;  PGET_VIRTUAL_DEVICE_LOCATION      GetLocation;&#10;  PGET_VIRTUAL_DEVICE_RESOURCES     GetResources;&#10;  PENABLE_VIRTUALIZATION            EnableVirtualization;&#10;  PGET_VIRTUAL_FUNCTION_PROBED_BARS GetVirtualFunctionProbedBars;&#10;} PCI_VIRTUALIZATION_INTERFACE, *PPCI_VIRTUALIZATION_INTERFACE;">PCI_VIRTUALIZATION_INTERFACE</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-get_virtual_function_probed_bars">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-get_virtual_function_probed_bars.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
