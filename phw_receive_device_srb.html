<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PHW_RECEIVE_DEVICE_SRB - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PHW_RECEIVE_DEVICE_SRB - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PHW_RECEIVE_DEVICE_SRB - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// strmini.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PHW_RECEIVE_DEVICE_SRB PhwReceiveDeviceSrb;

VOID PhwReceiveDeviceSrb(
  [in] IN <a href="hw_stream_request_block" title="typedef struct _HW_STREAM_REQUEST_BLOCK {&#10;  ULONG                           SizeOfThisPacket;&#10;  SRB_COMMAND                     Command;&#10;  NTSTATUS                        Status;&#10;  PHW_STREAM_OBJECT               StreamObject;&#10;  PVOID                           HwDeviceExtension;&#10;  PVOID                           SRBExtension;&#10;  union {&#10;    PKSSTREAM_HEADER                       DataBufferArray;&#10;    PHW_STREAM_DESCRIPTOR                  StreamBuffer;&#10;    KSSTATE                                StreamState;&#10;    PSTREAM_TIME_REFERENCE                 TimeReference;&#10;    PSTREAM_PROPERTY_DESCRIPTOR            PropertyInfo;&#10;    PKSDATAFORMAT                          OpenFormat;&#10;    struct _PORT_CONFIGURATION_INFORMATION *ConfigInfo;&#10;    HANDLE                                 MasterClockHandle;&#10;    DEVICE_POWER_STATE                     DeviceState;&#10;    PSTREAM_DATA_INTERSECT_INFO            IntersectInfo;&#10;    PVOID                                  MethodInfo;&#10;    LONG                                   FilterTypeIndex;&#10;...">PHW_STREAM_REQUEST_BLOCK</a> SRB
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/strmini/nc-strmini-phw_receive_device_srb">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/phw_receive_device_srb.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-strmini-phw_receive_device_srb)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The minidriver-supplied routine handles class driver requests that apply to the driver as a whole, such as initializing the device, or opening a stream within the device.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="srb-in"><code>SRB</code> [in]</h3>

<p>Pointer to the stream request block.</p>

<h2 id="remarks">Remarks</h2>

<p>The minidriver specifies this routine in the <strong>HwReceivePacket</strong> member of its <a href="hw_initialization_data" title="typedef struct _HW_INITIALIZATION_DATA {&#10;  ULONG               HwInitializationDataSize;&#10;  INTERFACE_TYPE      AdapterInterfaceType;&#10;  PHW_INITIALIZE      HwInitialize;&#10;  PHW_STARTIO         HwStartIo;&#10;  PHW_INTERRUPT       HwInterrupt;&#10;  PHW_FIND_ADAPTER    HwFindAdapter;&#10;  PHW_RESET_BUS       HwResetBus;&#10;  PHW_DMA_STARTED     HwDmaStarted;&#10;  PHW_ADAPTER_STATE   HwAdapterState;&#10;  ULONG               DeviceExtensionSize;&#10;  ULONG               SpecificLuExtensionSize;&#10;  ULONG               SrbExtensionSize;&#10;  ULONG               NumberOfAccessRanges;&#10;  PVOID               Reserved;&#10;  BOOLEAN             MapBuffers;&#10;  BOOLEAN             NeedPhysicalAddresses;&#10;  BOOLEAN             TaggedQueuing;&#10;  BOOLEAN             AutoRequestSense;&#10;  BOOLEAN             MultipleRequestPerLu;&#10;...">HW_INITIALIZATION_DATA</a> structure. The minidriver passes this structure to the class driver when it registers itself by calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/strmini/nf-strmini-streamclassregisteradapter">StreamClassRegisterMinidriver</a>.</p>

<p><em>StrMiniReceiveDevicePacket</em> must handle class driver requests that apply to the driver as a whole, such as initializing the device, or opening a stream within the device. The class driver passes its information in the form of a pointer to a stream request block. The class driver fills in some of the entries in the stream request block. The minidriver, upon completion of the routine, must fill in additional information that the class driver will use to continue processing.</p>

<p>Upon completion of its handling of the request, the minidriver passes the structure back to the class driver by calling <a href="streamclassdevicenotification" title="VOID StreamClassDeviceNotification(&#10;  [in] STREAM_MINIDRIVER_DEVICE_NOTIFICATION_TYPE NotificationType,&#10;  [in] PVOID                                      HwDeviceExtension,&#10;       ...                                        &#10;);">StreamClassDeviceNotification</a><strong>(DeviceRequestComplete, pSRB->HwDeviceExtension, pSRB)</strong>.</p>

<p>See information about relevant SRB codes in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/stream-class-srb-reference">Stream Class SRB Reference</a>.</p>

<p>When the minidriver finishes its processing of the request, it enters the return status of the operation in <em>pSrb</em>-><strong>Status</strong>. The minidriver should enter <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> for normal successful processing. If the minidriver does not support that Command value, it should set <em>pSrb</em>-><strong>Status</strong> to STATUS_NOT_IMPLEMENTED. If there is a device hardware error that prevents the minidriver from completing the request, it should set <em>pSrb</em>-><strong>Status</strong> to STATUS_IO_DEVICE_ERROR. Other error codes the routine uses in specific circumstances are listed above with the specific Command code.</p>

<p>Note that the class driver passes read and write requests to the <a href="#">StrMiniReceiveStreamDataPacket</a> routine.</p>

<p>The minidriver registers its <em>StrMiniReceiveStreamControlPacket</em> routine as follows: When the class driver opens the stream, it passes an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/srb-open-stream">SRB_OPEN_STREAM</a> request block to the minidriver's <em>StrMiniReceiveDevicePacket</em> routine. The <strong>StreamObject</strong> member of the request packet points to an <a href="hw_stream_object" title="typedef struct _HW_STREAM_OBJECT {&#10;  ULONG                          SizeOfThisPacket;&#10;  ULONG                          StreamNumber;&#10;  PVOID                          HwStreamExtension;&#10;  PHW_RECEIVE_STREAM_DATA_SRB    ReceiveDataPacket;&#10;  PHW_RECEIVE_STREAM_CONTROL_SRB ReceiveControlPacket;&#10;  HW_CLOCK_OBJECT                HwClockObject;&#10;  BOOLEAN                        Dma;&#10;  BOOLEAN                        Pio;&#10;  PVOID                          HwDeviceExtension;&#10;  ULONG                          StreamHeaderMediaSpecific;&#10;  ULONG                          StreamHeaderWorkspace;&#10;  BOOLEAN                        Allocator;&#10;  PHW_EVENT_ROUTINE              HwEventRoutine;&#10;  ULONG                          Reserved[2];&#10;} HW_STREAM_OBJECT, *PHW_STREAM_OBJECT;">HW_STREAM_OBJECT</a>. The minidriver sets the <strong>ReceiveControlPacket</strong> member of the structure pointed to by <strong>StreamObject</strong> to the minidriver's <em>StrMiniReceiveControlPacket</em> routine.</p>

<p>Upon completion of its handling of the request, the minidriver passes the structure back to the class driver by calling <a href="streamclassstreamnotification" title="VOID StreamClassStreamNotification(&#10;  [in] STREAM_MINIDRIVER_STREAM_NOTIFICATION_TYPE NotificationType,&#10;  [in] PHW_STREAM_OBJECT                          StreamObject,&#10;       ...                                        &#10;);">StreamClassStreamNotification</a><strong>(StreamRequestComplete, pSRB->StreamObject, pSRB)</strong>.</p>

<p>See information about relevant SRB codes in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/stream-class-srb-reference">Stream Class SRB Reference</a>.</p>

<p>When the minidriver finishes its processing of the request, it enters the return status of the operation in <em>pSrb</em>-><strong>Status</strong>. The minidriver should enter <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> for normal successful processing. If the minidriver does not support that Command value, it should set <em>pSrb</em>-><strong>Status</strong> to STATUS_NOT_IMPLEMENTED. If there is a device hardware error that prevents the minidriver from completing the request, it should set <em>pSrb</em>-><strong>Status</strong> to STATUS_IO_DEVICE_ERROR. Other error codes the routine uses in specific circumstances are listed above with the specific Command code.</p>

<p>The stream class driver calls the minidriver's <em>StrMiniReceiveStreamDataPacket</em> routine to handle read and write requests for a specific stream.</p>

<p>The minidriver registers its <em>StrMiniReceiveStreamDataPacket</em> routine as follows: When the class driver opens the stream, it passes a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/srb-open-stream">SRB_OPEN_STREAM</a> request block to the minidriver's <em>StrMiniReceiveDevicePacket</em> routine. The StreamObject of the request packet points to a <a href="hw_stream_object" title="typedef struct _HW_STREAM_OBJECT {&#10;  ULONG                          SizeOfThisPacket;&#10;  ULONG                          StreamNumber;&#10;  PVOID                          HwStreamExtension;&#10;  PHW_RECEIVE_STREAM_DATA_SRB    ReceiveDataPacket;&#10;  PHW_RECEIVE_STREAM_CONTROL_SRB ReceiveControlPacket;&#10;  HW_CLOCK_OBJECT                HwClockObject;&#10;  BOOLEAN                        Dma;&#10;  BOOLEAN                        Pio;&#10;  PVOID                          HwDeviceExtension;&#10;  ULONG                          StreamHeaderMediaSpecific;&#10;  ULONG                          StreamHeaderWorkspace;&#10;  BOOLEAN                        Allocator;&#10;  PHW_EVENT_ROUTINE              HwEventRoutine;&#10;  ULONG                          Reserved[2];&#10;} HW_STREAM_OBJECT, *PHW_STREAM_OBJECT;">HW_STREAM_OBJECT</a>. The minidriver sets the <strong>ReceiveDataPacket</strong> member of the structure pointed to by <em>pSrb</em>-><strong>StreamObject</strong> to the minidriver's <em>StrMiniReceiveDataPacket</em> routine.</p>

<p>Upon completion of its handling of the request, the minidriver passes the structure back to the class driver by calling <a href="streamclassstreamnotification" title="VOID StreamClassStreamNotification(&#10;  [in] STREAM_MINIDRIVER_STREAM_NOTIFICATION_TYPE NotificationType,&#10;  [in] PHW_STREAM_OBJECT                          StreamObject,&#10;       ...                                        &#10;);">StreamClassStreamNotification</a><strong>(StreamRequestComplete, pSRB->StreamObject, pSRB)</strong>.</p>

<p>See information about relevant SRB codes in <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/stream-class-srb-reference">Stream Class SRB Reference</a>.</p>

<p>When the minidriver finishes its processing of the request, it enters the return status of the operation in <em>pSrb</em>-><strong>Status</strong>. The minidriver should enter <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> for normal successful processing. If the minidriver does not support that Command value, it should set <em>pSrb</em>-><strong>Status</strong> to STATUS_NOT_IMPLEMENTED. If there is a device hardware error that prevents the minidriver from completing the request, it should set <em>pSrb</em>-><strong>Status</strong> to STATUS_IO_DEVICE_ERROR. Other error codes the routine uses in specific circumstances are listed above with the specific Command code.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/strmini/nc-strmini-phw_receive_device_srb">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/strmini/nc-strmini-phw_receive_device_srb.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
