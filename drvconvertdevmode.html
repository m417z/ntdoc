<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DrvConvertDevMode - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DrvConvertDevMode - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DrvConvertDevMode - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winddiui.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">BOOL DrvConvertDevMode(
  [in]      LPTSTR   pPrinterName,
  [in]      PDEVMODE pdmIn,
  [out]     PDEVMODE pdmOut,
  [in, out] PLONG    pcbNeeded,
  [in]      <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>    fMode
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winddiui/nf-winddiui-drvconvertdevmode">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/drvconvertdevmode.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-winddiui-drvconvertdevmode)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="drvconvertdevmode-function">DrvConvertDevMode function</h1>

<h2 id="description">Description</h2>

<p>A printer interface DLL's <strong>DrvConvertDevMode</strong> function converts a printer's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/wingdi/ns-wingdi-devmodew">DEVMODEW</a> structure from one version to another.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="pprintername-in"><code>pPrinterName</code> [in]</h3>

<p>Caller-supplied pointer to a printer name string. For more information about this parameter, see the following Remarks section.</p>

<h3 id="pdmin-in"><code>pdmIn</code> [in]</h3>

<p>Caller-supplied pointer to an input DEVMODEW structure. If <em>fMode</em> is CDM_DRIVER_DEFAULT, this pointer is <strong>NULL</strong>.</p>

<h3 id="pdmout-out"><code>pdmOut</code> [out]</h3>

<p>Caller-supplied pointer to a buffer to receive an output DEVMODEW structure. If <em>fMode</em> is CDM_CONVERT the buffer contains, on input, a valid DEVMODEW structure indicating the target driver version.</p>

<h3 id="pcbneeded-in-out"><code>pcbNeeded</code> [in, out]</h3>

<p>Caller-supplied pointer to the size, in bytes, of the buffer pointed to by <em>pdmOut</em>. On output, the printer interface DLL should overwrite the received size value with the actual size of the converted DEVMODEW structure. If the received buffer is too small, the printer interface DLL should overwrite the received size value with the required buffer size.</p>

<h3 id="fmode-in"><code>fMode</code> [in]</h3>

<p>Caller-supplied bit flag indicating the type of operation to be performed. This can be one of the following flags:</p>

<h4 id="cdm_convert">CDM_CONVERT</h4>

<p>The function should convert the contents of the input DEVMODEW structure (pointed to by <em>pdmIn</em>) into a new DEVMODEW structure, and place the result in the DEVMODEW structure pointed to by <em>pdmOut</em>. The initial contents of the received output DEVMODEW structure (pointed to by <em>pdmOut</em>) should be used to determine the output version.</p>

<h4 id="cdm_convert351">CDM_CONVERT351</h4>

<p>The function should convert the contents of the input DEVMODEW structure (pointed to by <em>pdmIn</em>), creating an output DEVMODEW structure that is compatible with Windows NT 3.51, and place the result in the DEVMODEW structure pointed to by <em>pdmOut</em>.</p>

<p>If the driver does not support a DEVMODEW structure for Windows NT 3.51, the function should convert the input DEVMODEW to the current version.</p>

<h4 id="cdm_driver_default">CDM_DRIVER_DEFAULT</h4>

<p>The function should copy the current version of its default DEVMODEW structure to the buffer pointed to by <em>pdmOut</em>.</p>

<h2 id="return-value">Return value</h2>

<p>If the operation succeeds, the function should return <strong>TRUE</strong>; otherwise, it should call SetLastError to set an error code, and return <strong>FALSE</strong>.</p>

<h2 id="remarks">Remarks</h2>

<p>In a client/server environment, a client might be running one version of the operating system or printer driver while the server (spooler) is running another, which means a printer's DEVMODEW structure definition might be inconsistent between the client and server. The <strong>DrvConvertDevMode</strong> function must be capable of performing conversions from one version of the printer's DEVMODEW structure to another.</p>

<p>When converting from one DEVMODEW version to another, both public and private DEVMODEW members must be included.</p>

<p>The printer name pointed to by <em>pPrinterName</em> can be used as an input argument to the <strong>OpenPrinter</strong> function (described in the Microsoft Windows SDK documentation), which can be called to obtain stored default values when the CDM_DRIVER_DEFAULT flag is received. Note that the printer name string must be not be modified in any way prior to a call to <strong>OpenPrinter</strong>. In addition, a call to <strong>OpenPrinter</strong> must be in the same thread as was used to call <strong>DrvConvertDevMode</strong>.</p>

<p>The function should verify that both <em>pdmIn</em> and <em>pdmOut</em> (if applicable) point to valid DEVMODEW structures. If they do not, the function should call SetLastError(ERROR_INVALID_PARAMETER) and return <strong>FALSE</strong>. If the output DEVMODEW size specified by <em>pcbNeeded</em> is too small, the driver should overwrite the size value supplied by <em>pcbNeeded</em> with the required buffer size, call SetLastError(ERROR_INSUFFICIENT_BUFFER), and return <strong>FALSE</strong>.</p>

<p>The <strong>DrvConvertDevMode</strong> function runs in the spooler's context and must therefore not display a user interface.</p>

<p>When <strong>DrvConvertDevMode</strong> is called with a <strong>NULL</strong> DEVMODEW structure pointer in the <em>pdmOut</em> parameter to get the buffer size, the driver is expected to set the last error to ERROR_INSUFFICIENT_BUFFER. If the last error is not set to this value, the spooler assumes a general error.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winddiui/nf-winddiui-drvconvertdevmode">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/winddiui/nf-winddiui-drvconvertdevmode.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
