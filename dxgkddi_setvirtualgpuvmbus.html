<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_SETVIRTUALGPUVMBUS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_SETVIRTUALGPUVMBUS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_SETVIRTUALGPUVMBUS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// dispmprt.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKDDI_SETVIRTUALGPUVMBUS DxgkddiSetvirtualgpuvmbus;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiSetvirtualgpuvmbus(
  [in]      HANDLE Context,
  [in, out] <a href="dxgkarg_setvirtualgpuvmbus" title="typedef struct _DXGKARG_SETVIRTUALGPUVMBUS {&#10;  ULONG  VirtualGpuIndex;&#10;  HANDLE VmBusHandle;&#10;} DXGKARG_SETVIRTUALGPUVMBUS, *PDXGKARG_SETVIRTUALGPUVMBUS;">DXGKARG_SETVIRTUALGPUVMBUS</a> *pArgs
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_setvirtualgpuvmbus">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_setvirtualgpuvmbus.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-dispmprt-dxgkddi_setvirtualgpuvmbus)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgkddi_setvirtualgpuvmbus-callback-function">DXGKDDI_SETVIRTUALGPUVMBUS callback function</h1>

<h2 id="description">Description</h2>

<p>This function passes a kernel mode virtual machine bus handle to the kernel mode driver. The handle is used to create VM bus channels for communication between guest and host KMDs.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="context-in"><code>Context</code> [in]</h3>

<p>The miniport context that is returned by the driver in the <a href="dxgkddi_gpu_partition_interface" title="typedef struct _DXGKDDI_GPU_PARTITION_INTERFACE {&#10;  [in]  IN USHORT                           Size;&#10;  [in]  IN USHORT                           Version;&#10;  [out] OUT PVOID                           Context;&#10;  [out] OUT PINTERFACE_REFERENCE            InterfaceReference;&#10;  [out] OUT PINTERFACE_DEREFERENCE          InterfaceDereference;&#10;  [out] OUT PDXGKDDI_GETGPUPARTITIONINFO    DxgkDdiGetGpuPartitionInfo;&#10;  [out] OUT PDXGKDDI_SETGPUPARTITIONCOUNT   DxgkDdiSetGpuPartitionCount;&#10;  [out] OUT PDXGKDDI_GETGPUENGINES          DxgkDdiGetGpuEngines;&#10;  [out] OUT PDXGKDDI_GETVIRTUALGPUPROFILE   DxgkDdiGetVirtualGpuProfile;&#10;  [out] OUT PDXGKDDI_CREATEVIRTUALGPU       DxgkDdiCreateVirtualGpu;&#10;  [out] OUT PDXGKDDI_GETVIRTUALGPUINFO      DxgkDdiGetVirtualGpuInfo;&#10;  [out] OUT PDXGKDDI_SETVIRTUALGPURESOURCES DxgkDdiSetVirtualGpuResources;&#10;  [out] OUT PDXGKDDI_DESTROYVIRTUALGPU      DxgkDdiDestroyVirtualGpu;&#10;  [out] OUT PDXGKDDI_SUSPENDVIRTUALGPU      DxgkDdiSuspendVirtualGpu;&#10;  [out] OUT PDXGKDDI_RESUMEVIRTUALGPU       DxgkDdiResumeVirtualGpu;&#10;  [out] OUT PDXGKDDI_VIRTUALGPUDRIVERESCAPE DxgkDdiVirtualGpuDriverEscape;&#10;  [out] OUT PDXGKDDI_SETVIRTUALGPUVMBUS     DxgkDdiSetVirtualGpuVmBus;&#10;} DXGKDDI_GPU_PARTITION_INTERFACE, *PDXGKDDI_GPU_PARTITION_INTERFACE;">DXGKDDI_GPU_PARTITION_INTERFACE</a> structure.</p>

<h3 id="pargs-in-out"><code>pArgs</code> [in, out]</h3>

<p>A pointer to a <a href="dxgkarg_setvirtualgpuvmbus" title="typedef struct _DXGKARG_SETVIRTUALGPUVMBUS {&#10;  ULONG  VirtualGpuIndex;&#10;  HANDLE VmBusHandle;&#10;} DXGKARG_SETVIRTUALGPUVMBUS, *PDXGKARG_SETVIRTUALGPUVMBUS;">DXGKARG_SETVIRTUALGPUVMBUS</a> structure.</p>

<h2 id="return-value">Return value</h2>

<p>Return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds, STATUS_INVALID_PARAMETER otherwise.</p>

<h2 id="prototype">Prototype</h2>

<pre><code>//Declaration

DXGKDDI_SETVIRTUALGPUVMBUS DxgkddiSetvirtualgpuvmbus;

// Definition

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiSetvirtualgpuvmbus
(
    HANDLE Context
    <a href="dxgkarg_setvirtualgpuvmbus" title="typedef struct _DXGKARG_SETVIRTUALGPUVMBUS {&#10;  ULONG  VirtualGpuIndex;&#10;  HANDLE VmBusHandle;&#10;} DXGKARG_SETVIRTUALGPUVMBUS, *PDXGKARG_SETVIRTUALGPUVMBUS;">DXGKARG_SETVIRTUALGPUVMBUS</a> * pArgs
)
{...}

</code></pre>

<h2 id="remarks">Remarks</h2>

<p>The kernel mode driver uses the kernel mode handle to create a VM bus channel. The function is called before the guest KMD gets DxgkDdiAddDevice and DxgkDdiStartDevice calls (in case of Windows OS on the guest partition). The function could be called multiple times with a new handle for the same virtual GPU. When this happened it is recommended to destroy the old channel and create the new one.</p>

<h2 id="see-also">See also</h2>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_setvirtualgpuvmbus">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/dispmprt/nc-dispmprt-dxgkddi_setvirtualgpuvmbus.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
