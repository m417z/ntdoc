<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_PD_SET_RECEIVE_FILTER - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_PD_SET_RECEIVE_FILTER - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_PD_SET_RECEIVE_FILTER - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_PD_SET_RECEIVE_FILTER NdisPdSetReceiveFilter;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>() NdisPdSetReceiveFilter(
  [in]  NDIS_PD_PROVIDER_HANDLE ProviderHandle,
  [in]  const <a href="ndis_pd_filter_parameters" title="typedef struct _NDIS_PD_FILTER_PARAMETERS {&#10;  NDIS_OBJECT_HEADER     Header;&#10;  ULONG                  Flags;&#10;  NDIS_GFP_PROFILE_ID    MatchProfileId;&#10;  ULONG                  Priority;&#10;  NDIS_PD_COUNTER_HANDLE CounterHandle;&#10;  NDIS_PD_QUEUE          *TargetReceiveQueue;&#10;  ULONG64                RxFilterContext;&#10;  PUCHAR                 HeaderGroupMatchArray;&#10;  ULONG                  HeaderGroupMatchArrayNumElements;&#10;  ULONG                  HeaderGroupMatchArrayElementSize;&#10;  ULONG                  HeaderGroupMatchArrayTotalSize;&#10;} NDIS_PD_FILTER_PARAMETERS;">NDIS_PD_FILTER_PARAMETERS</a> *FilterParameters,
  [out] NDIS_PD_FILTER_HANDLE *FilterHandle
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_pd_set_receive_filter">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_pd_set_receive_filter.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-ndis_pd_set_receive_filter)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndis_pd_set_receive_filter-callback-function">NDIS_PD_SET_RECEIVE_FILTER callback function</h1>

<h2 id="description">Description</h2>

<p>The PacketDirect (PD) platform calls a PD-capable miniport driver's
<em>NdisPDSetReceiveFilter</em> function to direct specific flows of packets to a specific PD receive queue.</p>

<p><strong>Note</strong> You must declare the function by using the <strong>NDIS_PD_SET_RECEIVE_FILTER</strong> type. For more
information, see the following Examples section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="providerhandle-in"><code>ProviderHandle</code> [in]</h3>

<p>A provider handle that identifies the PD-capable miniport driver's provider object.</p>

<h3 id="filterparameters-in"><code>FilterParameters</code> [in]</h3>

<p>Parameters that identify any necessary information for the filter. For more information, see the <a href="ndis_pd_filter_parameters" title="typedef struct _NDIS_PD_FILTER_PARAMETERS {&#10;  NDIS_OBJECT_HEADER     Header;&#10;  ULONG                  Flags;&#10;  NDIS_GFP_PROFILE_ID    MatchProfileId;&#10;  ULONG                  Priority;&#10;  NDIS_PD_COUNTER_HANDLE CounterHandle;&#10;  NDIS_PD_QUEUE          *TargetReceiveQueue;&#10;  ULONG64                RxFilterContext;&#10;  PUCHAR                 HeaderGroupMatchArray;&#10;  ULONG                  HeaderGroupMatchArrayNumElements;&#10;  ULONG                  HeaderGroupMatchArrayElementSize;&#10;  ULONG                  HeaderGroupMatchArrayTotalSize;&#10;} NDIS_PD_FILTER_PARAMETERS;">NDIS_PD_FILTER_PARAMETERS</a> structure.</p>

<h3 id="filterhandle-out"><code>FilterHandle</code> [out]</h3>

<p>A handle to the filter.</p>

<h2 id="return-value">Return value</h2>

<p>This function returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> when it completes successful, otherwise it returns the appropriate error code.</p>

<h2 id="remarks">Remarks</h2>

<p>PD filters are applied before any spreading takes place this is why packet matching a PD filter can be placed into their dedicated PD queue, and the rest of the packets can be spread by RSS as usual. The PD client is responsible for plumbing non-overlapping ambiguous filters. However, some PD provides may allow overlapping ambiguous filters as long as the PD client can pass a priority value that indicates which filter must be applied first. The PD provider may fail filter set requests with STATUS_NOT_SUPPORTED if the client attempts to set filters with conflicting profiles or overlapping match conditions. The <a href="ndis_pd_capabilities" title="typedef struct _NDIS_PD_CAPABILITIES {&#10;  NDIS_OBJECT_HEADER Header;&#10;  ULONG              Flags;&#10;  ULONG              MaximumTxPartialBufferCount;&#10;  ULONG              MaximumRxPartialBufferCount;&#10;  UCHAR              RxFilterContextWidth;&#10;  ULONG              CapabilityFlags;&#10;  ULONG              MaxNumberOfRxQueues;&#10;  ULONG              MaxNumberOfTxQueues;&#10;  ULONG              MaxNumberOfRxQueuesForDefaultVport;&#10;  ULONG              MaxNumberOfTxQueuesForDefaultVport;&#10;  ULONG              MaxNumberOfRxQueuesPerNonDefaultVport;&#10;  ULONG              MaxNumberOfTxQueuesPerNonDefaultVport;&#10;  ULONG              ExactMatchProfileArrayOffset;&#10;  ULONG              ExactMatchProfileArrayNumElements;&#10;  ULONG              ExactMatchProfileArrayElementSize;&#10;  ULONG              WildcardMatchProfileArrayOffset;&#10;  ULONG              WildcardMatchProfileArrayNumElements;&#10;  ULONG              WildcardMatchProfileArrayElementSize;&#10;  ULONG              MinimumModerationInterval;&#10;...">NDIS_PD_CAPABILITIES</a> structure does not allow the provider to advertise all valid combinations of profiles that the PD client can use simultaneously, this is why some of the capabilities are discovered by the PD client at runtime when and if the PD provider fails the filter set request with STATUS_NOT_SUPPORTED</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>NdisPDSetReceiveFilter</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>NdisPDSetReceiveFilter</em> function that is named "MyPDSetReceiveFilter", use the <strong>NDIS_PD_SET_RECEIVE_FILTER</strong> type as shown in this code example:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>NDIS_PD_SET_RECEIVE_FILTER MyPDSetReceiveFilter;
</code></pre>

<p>Then, implement your function as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>_Use_decl_annotations_
VOID
 MyPDSetReceiveFilter(
    NDIS_PD_PROVIDER_HANDLE  ProviderHandle,
    CONST <a href="ndis_pd_filter_parameters" title="typedef struct _NDIS_PD_FILTER_PARAMETERS {&#10;  NDIS_OBJECT_HEADER     Header;&#10;  ULONG                  Flags;&#10;  NDIS_GFP_PROFILE_ID    MatchProfileId;&#10;  ULONG                  Priority;&#10;  NDIS_PD_COUNTER_HANDLE CounterHandle;&#10;  NDIS_PD_QUEUE          *TargetReceiveQueue;&#10;  ULONG64                RxFilterContext;&#10;  PUCHAR                 HeaderGroupMatchArray;&#10;  ULONG                  HeaderGroupMatchArrayNumElements;&#10;  ULONG                  HeaderGroupMatchArrayElementSize;&#10;  ULONG                  HeaderGroupMatchArrayTotalSize;&#10;} NDIS_PD_FILTER_PARAMETERS;">NDIS_PD_FILTER_PARAMETERS</a>*  FilterParameters,
    NDIS_PD_FILTER_HANDLE*  FilterHandle
    )
  {...}
</code></pre>

<p>The <strong>NDIS_PD_SET_RECEIVE_FILTER</strong> function type is defined in the Ntddndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the _Use_decl_annotations_ annotation to your function definition. The _Use_decl_annotations_ annotation ensures that the annotations that are applied to the <strong>NDIS_PD_SET_RECEIVE_FILTER</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about _Use_decl_annotations_, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-ndis_pd_set_receive_filter">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-ndis_pd_set_receive_filter.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
