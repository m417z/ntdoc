<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtMapViewOfSection - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtMapViewOfSection - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtMapViewOfSection - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTMMAPI_H
//
// Sections
//
#if (PHNT_MODE != PHNT_MODE_KERNEL)

</span><span class="ntdoc-code-intro">/**
 * Maps a view of a section into the virtual address space of a subject process.
 *
 * \param SectionHandle A handle to an existing section object.
 * \param ProcessHandle A handle to the object that represents the process that the view should be mapped into. The handle must have been opened with <a href="process_vm_operation" title="#define PROCESS_VM_OPERATION 0x0008">PROCESS_VM_OPERATION</a> access.
 * \param BaseAddress A pointer to a variable that receives the base address of the view. If the value is not NULL, the view is allocated starting at the specified virtual address rounded down to the next 64-kilobyte address boundary.
 * \param ZeroBits The number of high-order address bits that must be zero in the base address of the section view. The value of this parameter must be less than 21 and is used only if BaseAddress is NULL.
 * \param CommitSize Specifies the size, in bytes, of the initially committed region of the view. CommitSize is meaningful only for page-file backed sections and is rounded up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a>.
 * \param SectionOffset A pointer to a variable that receives the offset, in bytes, from the beginning of the section to the view. 
 * \param ViewSize A pointer to a variable that specifies the size of the view in bytes. If the initial value is zero, NtMapViewOfSection maps a view of the section that starts at SectionOffset and continues to the end of the section. 
 * \param InheritDisposition A value that specifies how the view is to be shared with child processes. 
 * \param AllocationType Specifies the type of allocation to be performed for the specified region of pages. The valid flags are <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a>, <a href="mem_top_down" title="#define MEM_TOP_DOWN 0x00100000">MEM_TOP_DOWN</a>, <a href="mem_large_pages" title="#define MEM_LARGE_PAGES 0x20000000">MEM_LARGE_PAGES</a>, <a href="mem_different_image_base_ok" title="#define MEM_DIFFERENT_IMAGE_BASE_OK 0x00800000">MEM_DIFFERENT_IMAGE_BASE_OK</a> and <a href="mem_replace_placeholder" title="#define MEM_REPLACE_PLACEHOLDER 0x00004000">MEM_REPLACE_PLACEHOLDER</a>. Although <a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a> is not allowed, it is implied unless <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a> is specified. 
 * \param PageProtection Specifies the page protection to be applied to the mapped view. Not used with <a href="sec_image" title="#define SEC_IMAGE 0x01000000">SEC_IMAGE</a>, must be set to <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a> for <a href="sec_image_no_execute" title="#define SEC_IMAGE_NO_EXECUTE (SEC_IMAGE | SEC_NOCACHE)">SEC_IMAGE_NO_EXECUTE</a>. For non-image sections, the value must be compatible with the section&#x27;s page protection from <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">NtCreateSection</a>.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsection
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtMapViewOfSection(
    _In_ HANDLE SectionHandle,
    _In_ HANDLE ProcessHandle,
    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> ZeroBits,
    _In_ <a href="size_t-win" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> CommitSize,
    _Inout_opt_ PLARGE_INTEGER SectionOffset,
    _Inout_ PSIZE_T ViewSize,
    _In_ <a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1,&#10;    ViewUnmap = 2&#10;} SECTION_INHERIT;">SECTION_INHERIT</a> InheritDisposition,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationType,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PageProtection
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/cec9c08551d6f6f57db4e2a1065179b687923779/phnt/include/ntmmapi.h#L1229">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwMapViewOfSection(
    _In_ HANDLE SectionHandle,
    _In_ HANDLE ProcessHandle,
    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> ZeroBits,
    _In_ <a href="size_t-win" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> CommitSize,
    _Inout_opt_ PLARGE_INTEGER SectionOffset,
    _Inout_ PSIZE_T ViewSize,
    _In_ <a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1,&#10;    ViewUnmap = 2&#10;} SECTION_INHERIT;">SECTION_INHERIT</a> InheritDisposition,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationType,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PageProtection
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/cec9c08551d6f6f57db4e2a1065179b687923779/phnt/include/ntzwapi.h#L2377">View code on GitHub</a></span></code></pre></div>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsection">documented in Windows Driver Kit</a>.</p>

<hr />

<p>Function <code>NtMapViewOfSection</code> maps specified part of Section Object into process memory.</p>

<h3 id="sectionhandle">SectionHandle</h3>

<p><code>HANDLE</code> to Section Object opened with one or more from <code>SECTION_MAP_EXECUTE</code>, <code>SECTION_MAP_READ</code>, <code>SECTION_MAP_WRITE</code> attributes.</p>

<h3 id="processhandle">ProcessHandle</h3>

<p><code>HANDLE</code> to Process Object opened with <code><a href="process_vm_operation" title="#define PROCESS_VM_OPERATION 0x0008">PROCESS_VM_OPERATION</a></code> access.</p>

<h3 id="baseaddress">*BaseAddress</h3>

<p>Pointer to variable receiving virtual address of mapped memory. If this value is not <em>NULL</em>, system tries to allocate memory from specified value.</p>

<h3 id="zerobits">ZeroBits</h3>

<p>Indicates how many high bits must not be set in <code>BaseAddress</code>.</p>

<h3 id="commitsize">CommitSize</h3>

<p>Size of initially committed memory, in bytes.</p>

<h3 id="sectionoffset">SectionOffset</h3>

<p>Pointer to begin of mapped block in section. This value must be rounded up to <code>X64K</code> block size (<em>0x10000</em> on <strong>X86</strong>).</p>

<h3 id="viewsize">ViewSize</h3>

<p>Pointer to size of mapped block, in bytes. This value is rounded up to page size (<em>0x1000</em> on <strong>x86</strong>).</p>

<h3 id="inheritdisposition">InheritDisposition</h3>

<p>How do child processes inherit mapped section. See description of enumeration type <code><a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1,&#10;    ViewUnmap = 2&#10;} SECTION_INHERIT;">SECTION_INHERIT</a></code>.</p>

<h3 id="allocationtype">AllocationType</h3>

<p>Can be one of:</p>

<ul>
<li><code><a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a></code></li>
<li><code><a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a></code></li>
</ul>

<h3 id="protect">Protect</h3>

<p>Page protection. Can be one of:</p>

<ul>
<li><code><a href="page_noaccess" title="#define PAGE_NOACCESS 0x01 // Disables all access to the committed region of pages. An attempt to read from, write to, or execute the committed region results in an access violation.">PAGE_NOACCESS</a></code></li>
<li><code><a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a></code></li>
<li><code><a href="page_readwrite" title="#define PAGE_READWRITE 0x04 // Enables read-only or read/write access to the committed region of pages.">PAGE_READWRITE</a></code></li>
<li><code><a href="page_writecopy" title="#define PAGE_WRITECOPY 0x08 // Enables read-only or copy-on-write access to a mapped view of a file mapping object.">PAGE_WRITECOPY</a></code></li>
<li><code><a href="page_execute" title="#define PAGE_EXECUTE 0x10 // Enables execute access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE</a></code></li>
<li><code><a href="page_execute_read" title="#define PAGE_EXECUTE_READ 0x20 // Enables execute or read-only access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE_READ</a></code></li>
<li><code><a href="page_execute_readwrite" title="#define PAGE_EXECUTE_READWRITE 0x40 // Enables execute, read-only, or read/write access to the committed region of pages.">PAGE_EXECUTE_READWRITE</a></code></li>
<li><code><a href="page_execute_writecopy" title="#define PAGE_EXECUTE_WRITECOPY 0x80 // Enables execute, read-only, or copy-on-write access to a mapped view of a file mapping object.">PAGE_EXECUTE_WRITECOPY</a></code></li>
<li><code><a href="page_guard" title="#define PAGE_GUARD 0x100 // Pages in the region become guard pages. Any attempt to access a guard page causes the system to raise a STATUS_GUARD_PAGE_VIOLATION exception.">PAGE_GUARD</a></code></li>
<li><code><a href="page_nocache" title="#define PAGE_NOCACHE 0x200 // Sets all pages to be non-cachable. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_NOCACHE</a></code></li>
<li><code><a href="page_writecombine" title="#define PAGE_WRITECOMBINE 0x400 // Sets all pages to be write-combined. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_WRITECOMBINE</a></code></li>
</ul>

<h1 id="documented-by">Documented by</h1>

<ul>
<li>Tomasz Nowak</li>
</ul>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtAllocateVirtualMemory</a></code></li>
<li><code><a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">NtCreateSection</a></code></li>
<li><code><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">NtOpenSection</a></code></li>
<li><code><a href="ntunmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnmapViewOfSection(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ PVOID BaseAddress&#10;    );">NtUnmapViewOfSection</a></code></li>
</ul>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntmapviewofsection.md">Edit description on GitHub</a>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
