<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtMapViewOfSection - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtMapViewOfSection - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtMapViewOfSection - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTMMAPI_H
#if (PHNT_MODE != PHNT_MODE_KERNEL)

</span><span class="ntdoc-code-intro language-cpp">/**
 * The NtMapViewOfSection routine maps a view of a section into the virtual address space of a subject process.
 *
 * \param SectionHandle A handle to an existing section object.
 * \param ProcessHandle A handle to the object that represents the process that the view should be mapped into. The handle must have been opened with <a href="process_vm_operation" title="#define PROCESS_VM_OPERATION 0x0008">PROCESS_VM_OPERATION</a> access.
 * \param BaseAddress A pointer to a variable that receives the base address of the view. If the value is not NULL, the view is allocated starting at the specified virtual address rounded down to the next 64-kilobyte address boundary.
 * \param ZeroBits The number of high-order address bits that must be zero in the base address of the section view. The value of this parameter must be less than 21 and is used only if BaseAddress is NULL.
 * \param CommitSize Specifies the size, in bytes, of the initially committed region of the view. CommitSize is meaningful only for page-file backed sections and is rounded up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a>.
 * \param SectionOffset A pointer to a variable that receives the offset, in bytes, from the beginning of the section to the view.
 * \param ViewSize A pointer to a variable that specifies the size of the view in bytes. If the initial value is zero, NtMapViewOfSection maps a view of the section that starts at SectionOffset and continues to the end of the section.
 * \param InheritDisposition A value that specifies how the view is to be shared with child processes.
 * \param AllocationType Specifies the type of allocation to be performed for the specified region of pages. The valid flags are <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a>, <a href="mem_top_down" title="#define MEM_TOP_DOWN 0x00100000">MEM_TOP_DOWN</a>, <a href="mem_large_pages" title="#define MEM_LARGE_PAGES 0x20000000">MEM_LARGE_PAGES</a>, <a href="mem_different_image_base_ok" title="#define MEM_DIFFERENT_IMAGE_BASE_OK 0x00800000">MEM_DIFFERENT_IMAGE_BASE_OK</a> and <a href="mem_replace_placeholder" title="#define MEM_REPLACE_PLACEHOLDER 0x00004000">MEM_REPLACE_PLACEHOLDER</a>. Although <a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a> is not allowed, it is implied unless <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a> is specified.
 * \param PageProtection Specifies the page protection to be applied to the mapped view. Not used with <a href="sec_image" title="#define SEC_IMAGE 0x01000000">SEC_IMAGE</a>, must be set to <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a> for <a href="sec_image_no_execute" title="#define SEC_IMAGE_NO_EXECUTE (SEC_IMAGE | SEC_NOCACHE)">SEC_IMAGE_NO_EXECUTE</a>. For non-image sections, the value must be compatible with the section&#x27;s page protection from <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">NtCreateSection</a>.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsection
 */
</span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtMapViewOfSection(
    _In_ HANDLE SectionHandle,
    _In_ HANDLE ProcessHandle,
    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> ZeroBits,
    _In_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> CommitSize,
    _Inout_opt_ PLARGE_INTEGER SectionOffset,
    _Inout_ PSIZE_T ViewSize,
    _In_ <a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1, // The mapped view of the section will be mapped into any child processes created by the process.&#10;    ViewUnmap = 2  // The mapped view of the section will not be mapped into any child processes created by the process.&#10;} SECTION_INHERIT;">SECTION_INHERIT</a> InheritDisposition,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationType,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PageProtection
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/6af6e7d1515a98719b6ee7f65a38832db9d51856/phnt/include/ntmmapi.h#L1321">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwMapViewOfSection(
    _In_ HANDLE SectionHandle,
    _In_ HANDLE ProcessHandle,
    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,
    _In_ <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a> ZeroBits,
    _In_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> CommitSize,
    _Inout_opt_ PLARGE_INTEGER SectionOffset,
    _Inout_ PSIZE_T ViewSize,
    _In_ <a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1, // The mapped view of the section will be mapped into any child processes created by the process.&#10;    ViewUnmap = 2  // The mapped view of the section will not be mapped into any child processes created by the process.&#10;} SECTION_INHERIT;">SECTION_INHERIT</a> InheritDisposition,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationType,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PageProtection
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/6af6e7d1515a98719b6ee7f65a38832db9d51856/phnt/include/ntzwapi.h#L2377">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// wdm.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwMapViewOfSection(
  [in]                HANDLE          SectionHandle,
  [in]                HANDLE          ProcessHandle,
  [in, out]           PVOID           *BaseAddress,
  [in]                <a href="ulong_ptr" title="typedef [public] unsigned __int3264 ULONG_PTR;">ULONG_PTR</a>       ZeroBits,
  [in]                <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>          CommitSize,
  [in, out, optional] PLARGE_INTEGER  SectionOffset,
  [in, out]           PSIZE_T         ViewSize,
  [in]                <a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1, // The mapped view of the section will be mapped into any child processes created by the process.&#10;    ViewUnmap = 2  // The mapped view of the section will not be mapped into any child processes created by the process.&#10;} SECTION_INHERIT;">SECTION_INHERIT</a> InheritDisposition,
  [in]                <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           AllocationType,
  [in]                <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Win32Protect
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsection">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntmapviewofsection.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwmapviewofsection)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>ZwMapViewOfSection</strong> routine maps a view of a section into the virtual address space of a subject process.</p>
<h2>Parameters</h2>
<h3><code>SectionHandle</code> [in]</h3>
<p>Handle to a section object. This handle is created by a successful call to <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a> or <a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenSection</a>.</p>
<h3><code>ProcessHandle</code> [in]</h3>
<p>Handle to the object that represents the process that the view should be mapped into. Use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/zwcurrentprocess">ZwCurrentProcess</a> macro to specify the current process. The handle must have been opened with <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/procthread/process-security-and-access-rights"><strong>PROCESS_VM_OPERATION</strong></a> access.</p>
<h3><code>BaseAddress</code> [in, out]</h3>
<p>Pointer to a variable that receives the base address of the view. If the value of this parameter is not <strong>NULL</strong>, the view is allocated starting at the specified virtual address rounded down to the next 64-kilobyte address boundary.</p>
<h3><code>ZeroBits</code> [in]</h3>
<p>Specifies the number of high-order address bits that must be zero in the base address of the section view. The value of this parameter must be less than 21 and is used only if <em>BaseAddress</em> is <strong>NULL</strong>â€”in other words, when the caller allows the system to determine where to allocate the view.</p>
<h3><code>CommitSize</code> [in]</h3>
<p>Specifies the size, in bytes, of the initially committed region of the view. <em>CommitSize</em> is meaningful only for page-file backed sections and is rounded up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a>. (For sections that map files, both the data and the image are committed at section-creation time.)</p>
<h3><code>SectionOffset</code> [in, out, optional]</h3>
<p>A pointer to a variable that receives the offset, in bytes, from the beginning of the section to the view. If this pointer is not <strong>NULL</strong>, the offset is rounded down to the next allocation-granularity size boundary.</p>
<h3><code>ViewSize</code> [in, out]</h3>
<p>A pointer to a <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> variable. If the initial value of this variable is zero, <strong>ZwMapViewOfSection</strong> maps a view of the section that starts at <em>SectionOffset</em> and continues to the end of the section. Otherwise, the initial value specifies the view's size, in bytes. <strong>ZwMapViewOfSection</strong> always rounds this value up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> before mapping the view.</p>
<p>On return, the value receives the actual size, in bytes, of the view.</p>
<h3><code>InheritDisposition</code> [in]</h3>
<p>Specifies how the view is to be shared with child processes. The possible values are:</p>
<h4>ViewShare</h4>
<p>The view will be mapped into any child processes that are created in the future.</p>
<h4>ViewUnmap</h4>
<p>The view will not be mapped into child processes.</p>
<p>Drivers should typically specify <strong>ViewUnmap</strong> for this parameter.</p>
<h3><code>AllocationType</code> [in]</h3>
<p>Specifies a set of flags that describes the type of allocation to be performed for the specified region of pages. The valid flags are <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a>, <a href="mem_top_down" title="#define MEM_TOP_DOWN 0x00100000">MEM_TOP_DOWN</a>, <a href="mem_large_pages" title="#define MEM_LARGE_PAGES 0x20000000">MEM_LARGE_PAGES</a>, <a href="mem_different_image_base_ok" title="#define MEM_DIFFERENT_IMAGE_BASE_OK 0x00800000">MEM_DIFFERENT_IMAGE_BASE_OK</a> and <a href="mem_replace_placeholder" title="#define MEM_REPLACE_PLACEHOLDER 0x00004000">MEM_REPLACE_PLACEHOLDER</a>. Although <a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a> is not allowed, it is implied unless <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a> is specified. For more information about the MEM_<em>XXX</em> flags, see the description of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile3">MapViewOfFile3</a> routines.</p>
<h3><code>Win32Protect</code> [in]</h3>
<p>Specifies the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/Memory/memory-protection-constants">page protection</a> to be applied to the mapped view.</p>
<p>For section objects created with the <a href="sec_image" title="#define SEC_IMAGE 0x01000000">SEC_IMAGE</a> attribute, the Win32Protect parameter has no effect, and can be set to any valid value such as <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a>.</p>
<p>For section objects created with the <a href="sec_image_no_execute" title="#define SEC_IMAGE_NO_EXECUTE (SEC_IMAGE | SEC_NOCACHE)">SEC_IMAGE_NO_EXECUTE</a> attribute, the Win32Protect value must be set to <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a>.</p>
<p>For non-image sections, the value of the Win32Protect parameter must be compatible with the section's page protection that was specified when <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a> was called.</p>
<p><strong>ZwMapViewOfSection</strong> sets the cache type of the mapped pages to match the cache type supplied when the section object was created. For example, if <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a> was called with the <a href="sec_nocache" title="#define SEC_NOCACHE 0x10000000">SEC_NOCACHE</a> flag, <strong>ZwMapViewOfSection</strong> will map the pages uncached, regardless of whether the Win32Protect parameter includes the <a href="page_nocache" title="#define PAGE_NOCACHE 0x200 // Sets all pages to be non-cachable. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_NOCACHE</a> flag or not.</p>
<h2>Return value</h2>
<p><strong>ZwMapViewOfSection</strong> returns an <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value. Possible return values include the following:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
<td>The routine successfully performed the requested operation.</td>
</tr>
<tr>
<td><strong>STATUS_CONFLICTING_ADDRESSES</strong></td>
<td>The specified address range conflicts with a range that is already reserved.</td>
</tr>
<tr>
<td><strong>STATUS_INVALID_PAGE_PROTECTION</strong></td>
<td>The value specified for the <em>Win32Protect</em> parameter is invalid.</td>
</tr>
<tr>
<td><strong>STATUS_SECTION_PROTECTION</strong></td>
<td>The value specified for the <em>Win32Protect</em> parameter is incompatible with the page protection specified when the section was created.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>Several different views of a section can be concurrently mapped into the virtual address space of one or more processes.</p>
<p>Do not use <strong>ZwMapViewOfSection</strong> to map a memory range from <strong>\Device\PhysicalMemory</strong> into user mode, unless your driver has directly allocated the memory range through <a href="mmallocatepagesformdlex" title="PMDL MmAllocatePagesForMdlEx(&#10;  [in] PHYSICAL_ADDRESS    LowAddress,&#10;  [in] PHYSICAL_ADDRESS    HighAddress,&#10;  [in] PHYSICAL_ADDRESS    SkipBytes,&#10;  [in] SIZE_T              TotalBytes,&#10;  [in] MEMORY_CACHING_TYPE CacheType,&#10;  [in] ULONG               Flags&#10;);">MmAllocatePagesForMdlEx</a> or another method guaranteeing that no other system component has mapped the same memory range with a different <a href="memory_caching_type" title="typedef enum _MEMORY_CACHING_TYPE {&#10;  MmNonCached,&#10;  MmCached,&#10;  MmWriteCombined,&#10;  MmHardwareCoherentCached,&#10;  MmNonCachedUnordered,&#10;  MmUSWCCached,&#10;  MmMaximumCacheType,&#10;  MmNotMapped&#10;} MEMORY_CACHING_TYPE;">MEMORY_CACHING_TYPE</a> value.</p>
<p>User applications cannot access <strong>\Device\PhysicalMemory</strong> directly starting with Windows Server 2003 with Service Pack 1 (SP1) and can access it only if the driver passes a handle to the application.</p>
<p>For more information about section objects, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/section-objects-and-views">Section Objects and Views</a>.</p>
<p>If the call to this function occurs in user mode, you should use the name &quot;<strong>NtMapViewOfSection</strong>&quot; instead of &quot;<strong>ZwMapViewOfSection</strong>&quot;.</p>
<p>For calls from kernel-mode drivers, the <strong>Nt<em>Xxx</em></strong> and <strong>Zw<em>Xxx</em></strong> versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt<em>Xxx</em></strong> and <strong>Zw<em>Xxx</em></strong> versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a></p>
<p><a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a></p>
<p><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenSection</a></p>
<p><a href="ntmapviewofsectionex" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMapViewOfSectionEx(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,&#10;    _Inout_opt_ PLARGE_INTEGER SectionOffset,&#10;    _Inout_ PSIZE_T ViewSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection,&#10;    _Inout_updates_opt_(ExtendedParameterCount) PMEM_EXTENDED_PARAMETER ExtendedParameters,&#10;    _In_ ULONG ExtendedParameterCount&#10;    );">ZwMapViewOfSectionEx</a></p>
<p><a href="ntunmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnmapViewOfSection(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ PVOID BaseAddress&#10;    );">ZwUnmapViewOfSection</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile3">MapViewOfFile3</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsection">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwmapviewofsection.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsection">documented in Windows Driver Kit</a>.</p>
<hr />
<p>Function <code>NtMapViewOfSection</code> maps specified part of Section Object into process memory.</p>
<h3>SectionHandle</h3>
<p><code>HANDLE</code> to Section Object opened with one or more from <code>SECTION_MAP_EXECUTE</code>, <code>SECTION_MAP_READ</code>, <code>SECTION_MAP_WRITE</code> attributes.</p>
<h3>ProcessHandle</h3>
<p><code>HANDLE</code> to Process Object opened with <code><a href="process_vm_operation" title="#define PROCESS_VM_OPERATION 0x0008">PROCESS_VM_OPERATION</a></code> access.</p>
<h3>*BaseAddress</h3>
<p>Pointer to variable receiving virtual address of mapped memory. If this value is not <em>NULL</em>, system tries to allocate memory from specified value.</p>
<h3>ZeroBits</h3>
<p>Indicates how many high bits must not be set in <code>BaseAddress</code>.</p>
<h3>CommitSize</h3>
<p>Size of initially committed memory, in bytes.</p>
<h3>SectionOffset</h3>
<p>Pointer to begin of mapped block in section. This value must be rounded up to <code>X64K</code> block size (<em>0x10000</em> on <strong>X86</strong>).</p>
<h3>ViewSize</h3>
<p>Pointer to size of mapped block, in bytes. This value is rounded up to page size (<em>0x1000</em> on <strong>x86</strong>).</p>
<h3>InheritDisposition</h3>
<p>How do child processes inherit mapped section. See description of enumeration type <code><a href="section_inherit" title="typedef enum _SECTION_INHERIT&#10;{&#10;    ViewShare = 1, // The mapped view of the section will be mapped into any child processes created by the process.&#10;    ViewUnmap = 2  // The mapped view of the section will not be mapped into any child processes created by the process.&#10;} SECTION_INHERIT;">SECTION_INHERIT</a></code>.</p>
<h3>AllocationType</h3>
<p>Can be one of:</p>
<ul>
<li><code><a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a></code></li>
<li><code><a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a></code></li>
</ul>
<h3>Protect</h3>
<p>Page protection. Can be one of:</p>
<ul>
<li><code><a href="page_noaccess" title="#define PAGE_NOACCESS 0x01 // Disables all access to the committed region of pages. An attempt to read from, write to, or execute the committed region results in an access violation.">PAGE_NOACCESS</a></code></li>
<li><code><a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a></code></li>
<li><code><a href="page_readwrite" title="#define PAGE_READWRITE 0x04 // Enables read-only or read/write access to the committed region of pages.">PAGE_READWRITE</a></code></li>
<li><code><a href="page_writecopy" title="#define PAGE_WRITECOPY 0x08 // Enables read-only or copy-on-write access to a mapped view of a file mapping object.">PAGE_WRITECOPY</a></code></li>
<li><code><a href="page_execute" title="#define PAGE_EXECUTE 0x10 // Enables execute access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE</a></code></li>
<li><code><a href="page_execute_read" title="#define PAGE_EXECUTE_READ 0x20 // Enables execute or read-only access to the committed region of pages. An attempt to write to the committed region results in an access violation.">PAGE_EXECUTE_READ</a></code></li>
<li><code><a href="page_execute_readwrite" title="#define PAGE_EXECUTE_READWRITE 0x40 // Enables execute, read-only, or read/write access to the committed region of pages.">PAGE_EXECUTE_READWRITE</a></code></li>
<li><code><a href="page_execute_writecopy" title="#define PAGE_EXECUTE_WRITECOPY 0x80 // Enables execute, read-only, or copy-on-write access to a mapped view of a file mapping object.">PAGE_EXECUTE_WRITECOPY</a></code></li>
<li><code><a href="page_guard" title="#define PAGE_GUARD 0x100 // Pages in the region become guard pages. Any attempt to access a guard page causes the system to raise a STATUS_GUARD_PAGE_VIOLATION exception.">PAGE_GUARD</a></code></li>
<li><code><a href="page_nocache" title="#define PAGE_NOCACHE 0x200 // Sets all pages to be non-cachable. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_NOCACHE</a></code></li>
<li><code><a href="page_writecombine" title="#define PAGE_WRITECOMBINE 0x400 // Sets all pages to be write-combined. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_WRITECOMBINE</a></code></li>
</ul>
<h1>Documented by</h1>
<ul>
<li>Tomasz Nowak</li>
</ul>
<h1>See also</h1>
<ul>
<li><code><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtAllocateVirtualMemory</a></code></li>
<li><code><a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">NtCreateSection</a></code></li>
<li><code><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">NtOpenSection</a></code></li>
<li><code><a href="ntunmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnmapViewOfSection(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ PVOID BaseAddress&#10;    );">NtUnmapViewOfSection</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntmapviewofsection.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
