<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="wiasDownSampleBuffer - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>wiasDownSampleBuffer - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            wiasDownSampleBuffer - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wiamdef.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">HRESULT wiasDownSampleBuffer(
            <a href="long" title="typedef long LONG;">LONG</a>                  lFlags,
  [in, out] <a href="wias_down_sample_info" title="typedef struct _WIAS_DOWN_SAMPLE_INFO {&#10;  ULONG ulOriginalWidth;&#10;  ULONG ulOriginalHeight;&#10;  ULONG ulBitsPerPixel;&#10;  ULONG ulXRes;&#10;  ULONG ulYRes;&#10;  ULONG ulDownSampledWidth;&#10;  ULONG ulDownSampledHeight;&#10;  ULONG ulActualSize;&#10;  ULONG ulDestBufSize;&#10;  ULONG ulSrcBufSize;&#10;  BYTE  *pSrcBuffer;&#10;  BYTE  *pDestBuffer;&#10;} WIAS_DOWN_SAMPLE_INFO, *PWIAS_DOWN_SAMPLE_INFO;">WIAS_DOWN_SAMPLE_INFO</a> *pInfo
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamdef/nf-wiamdef-wiasdownsamplebuffer">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wiasdownsamplebuffer.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wiamdef-wiasdownsamplebuffer)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>wiasDownSampleBuffer</strong> function takes in a buffer of <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>-aligned pixel data and downsamples it (produces image data of lower resolution) to the specified size and resolution.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="lflags"><code>lFlags</code></h3>

<p>Specifies a set of flags that determine the behavior of this function. Currently, only the following flag is defined.</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>WIAS_GET_DOWNSAMPLED_SIZE_ONLY</strong></td>
  <td>Do not copy the downsampled data to the destination buffer. Instead, set the following members of the <a href="wias_down_sample_info" title="typedef struct _WIAS_DOWN_SAMPLE_INFO {&#10;  ULONG ulOriginalWidth;&#10;  ULONG ulOriginalHeight;&#10;  ULONG ulBitsPerPixel;&#10;  ULONG ulXRes;&#10;  ULONG ulYRes;&#10;  ULONG ulDownSampledWidth;&#10;  ULONG ulDownSampledHeight;&#10;  ULONG ulActualSize;&#10;  ULONG ulDestBufSize;&#10;  ULONG ulSrcBufSize;&#10;  BYTE  *pSrcBuffer;&#10;  BYTE  *pDestBuffer;&#10;} WIAS_DOWN_SAMPLE_INFO, *PWIAS_DOWN_SAMPLE_INFO;">WIAS_DOWN_SAMPLE_INFO</a> structure: <strong>ulDownSampledHeight</strong>, <strong>ulDownSampleWidth</strong>, <strong>ulAlignedHeight</strong>, <strong>ulAlignedWidth</strong>.</td>
</tr>
</tbody>
</table>

<h3 id="pinfo-in-out"><code>pInfo</code> [in, out]</h3>

<p>Pointer to the <a href="wias_down_sample_info" title="typedef struct _WIAS_DOWN_SAMPLE_INFO {&#10;  ULONG ulOriginalWidth;&#10;  ULONG ulOriginalHeight;&#10;  ULONG ulBitsPerPixel;&#10;  ULONG ulXRes;&#10;  ULONG ulYRes;&#10;  ULONG ulDownSampledWidth;&#10;  ULONG ulDownSampledHeight;&#10;  ULONG ulActualSize;&#10;  ULONG ulDestBufSize;&#10;  ULONG ulSrcBufSize;&#10;  BYTE  *pSrcBuffer;&#10;  BYTE  *pDestBuffer;&#10;} WIAS_DOWN_SAMPLE_INFO, *PWIAS_DOWN_SAMPLE_INFO;">WIAS_DOWN_SAMPLE_INFO</a> structure that contains all of the information needed for the downsampling operation.</p>

<h2 id="return-value">Return value</h2>

<p>On success, the function returns S_OK.</p>

<p>If the function fails, it returns a standard COM error or one of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/wia/-wia-error-codes">WIA error codes</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>wiasDownSampleBuffer</strong> function can be used in either of the following two ways:</p>

<ul>
<li><p>The caller specifies the downsampled (that is, output) width and height by setting the <strong>ulDownSampledWidth</strong> and <strong>ulDownSampledHeight</strong> members of the <strong>WIA_DOWN_SAMPLE_INFO</strong> structure.</p></li>
<li><p>The caller sets the <strong>ulDownSampledWidth</strong> and <strong>ulDownSampledHeight</strong> members of the <strong>WIA_DOWN_SAMPLE_INFO</strong> structure to zero, indicating that the function should choose the output width and height.</p></li>
</ul>

<p>To see what output width and height values the function chooses, call this function with the <em>lFlags</em> parameter set to <strong>WIAS_GET_DOWNSAMPLED_SIZE_ONLY</strong>. On return, the <strong>ulDownSampledWidth</strong> and <strong>ulDownSampledHeight</strong> members are set to their new values. No downsampling is performed in this case.</p>

<p>The caller of this function is required to fill in the following members of the <strong>WIA_DOWN_SAMPLE_INFO</strong> structure:</p>

<ul>
<li><p><strong>ulOriginalWidth</strong></p></li>
<li><p><strong>ulOriginal Height</strong></p></li>
<li><p><strong>ulBitsPerPixel</strong></p></li>
<li><p><strong>ulXRes</strong></p></li>
<li><p><strong>ulYRes</strong></p></li>
<li><p><strong>pSrcBuffer</strong></p></li>
</ul>

<p>The <strong>wiasDownSampleBuffer</strong> function expects <strong>ulBitsPerPixel</strong> to be 1, 8, or 24, corresponding to 1-, 8-, and 24-bit-per-pixel data. The caller can also specify the size of the downsampled data by filling in the following <strong>WIA_DOWN_SAMPLE_INFO</strong> structure members: - <strong>ulDownSampledWidth</strong> <strong>ulDownSampledHeight</strong></p>

<p>If the buffer that receives the downsampled data has already been allocated, the caller should fill in these <strong>WIA_DOWN_SAMPLE_INFO</strong> structure members:</p>

<ul>
<li><p><strong>ulDestBufSize</strong></p></li>
<li><p><strong>ulSrcBufSize</strong></p></li>
<li><p><strong>pDestBuffer</strong></p></li>
</ul>

<p>If the caller sets <strong>pDestBuffer</strong> to <strong>NULL</strong>, the destination buffer is allocated by the WIA service. On return from this function, <strong>pDestBuffer</strong> points to the destination buffer. The caller is responsible for freeing this memory when the operation is finished, and does this by calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree"><strong>CoTaskMemFree</strong></a> on the buffer.</p>

<p>Because this function is not able to produce partial output lines, the number of scan lines in the input buffer must be an integer multiple of the scaling factor. For example, suppose the input buffer contains an image sampled at 600 dpi, which you intend to downsample to an equivalent 50 dpi image. In this case, you are scaling down the original image by a factor of 12 (because 600 / 50 = 12). This means that the function must receive 12 input lines for each output line that it produces.</p>

<p>If the original image has a resolution of R<em>in</em> dpi, and is to be scaled down to an image with a resolution of R<em>out</em> dpi, the scale-down factor is R<em>in</em> / R<em>out</em>, and the number of lines in the input buffer should be a multiple of R<em>in</em> / R<em>out</em>. If the scan head reaches the last band of the original image, and there are too few scan lines in the input buffer to produce an output line, pad the input buffer so that it contains the required number of data lines. Failure to do so causes unpredictable results, and can even result in a driver crash.</p>

<h2 id="see-also">See also</h2>

<p><a href="wias_down_sample_info" title="typedef struct _WIAS_DOWN_SAMPLE_INFO {&#10;  ULONG ulOriginalWidth;&#10;  ULONG ulOriginalHeight;&#10;  ULONG ulBitsPerPixel;&#10;  ULONG ulXRes;&#10;  ULONG ulYRes;&#10;  ULONG ulDownSampledWidth;&#10;  ULONG ulDownSampledHeight;&#10;  ULONG ulActualSize;&#10;  ULONG ulDestBufSize;&#10;  ULONG ulSrcBufSize;&#10;  BYTE  *pSrcBuffer;&#10;  BYTE  *pDestBuffer;&#10;} WIAS_DOWN_SAMPLE_INFO, *PWIAS_DOWN_SAMPLE_INFO;">WIAS_DOWN_SAMPLE_INFO</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamdef/nf-wiamdef-wiasdownsamplebuffer">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wiamdef/nf-wiamdef-wiasdownsamplebuffer.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
