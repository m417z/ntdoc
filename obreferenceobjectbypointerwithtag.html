<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ObReferenceObjectByPointerWithTag - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ObReferenceObjectByPointerWithTag - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ObReferenceObjectByPointerWithTag - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ObReferenceObjectByPointerWithTag(
  [in]           PVOID           Object,
  [in]           ACCESS_MASK     DesiredAccess,
  [in, optional] POBJECT_TYPE    ObjectType,
  [in]           KPROCESSOR_MODE AccessMode,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Tag
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obreferenceobjectbypointerwithtag">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/obreferenceobjectbypointerwithtag.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-obreferenceobjectbypointerwithtag)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>ObReferenceObjectByPointerWithTag</strong> routine increments the reference count of the specified object, and writes a four-byte tag value to the object to support <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/debugger/object-reference-tracing">object reference tracing</a>.</p>
<h2>Parameters</h2>
<h3><code>Object</code> [in]</h3>
<p>A pointer to the object. The caller obtains this pointer either when it creates the object, or from a previous call to the <a href="obreferenceobjectbyhandlewithtag" title="NTSTATUS ObReferenceObjectByHandleWithTag(&#10;  [in]            HANDLE                     Handle,&#10;  [in]            ACCESS_MASK                DesiredAccess,&#10;  [in, optional]  POBJECT_TYPE               ObjectType,&#10;  [in]            KPROCESSOR_MODE            AccessMode,&#10;  [in]            ULONG                      Tag,&#10;  [out]           PVOID                      *Object,&#10;  [out, optional] POBJECT_HANDLE_INFORMATION HandleInformation&#10;);">ObReferenceObjectByHandleWithTag</a> routine after it opens the object.</p>
<h3><code>DesiredAccess</code> [in]</h3>
<p>Specifies the types of access to the object that the caller requests. This parameter is a bitmask of type <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a>. The interpretation of this field depends on the object type. Do not use any generic access rights.</p>
<h3><code>ObjectType</code> [in, optional]</h3>
<p>A pointer to an opaque structure that specifies the object type. This parameter points to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">OBJECT_TYPE</a> structure. Set <em>ObjectType</em> to <strong>NULL</strong> or to one of the following pointer values, which are declared in the Wdm.h header file: <em><strong>ExEventObjectType</strong>, *<strong>ExSemaphoreObjectType</strong>, *<strong>IoFileObjectType</strong>, *<strong>PsProcessType</strong>, *<strong>PsThreadType</strong>, *<strong>SeTokenObjectType</strong>, *<strong>TmEnlistmentObjectType</strong>, *<strong>TmResourceManagerObjectType</strong>, *<strong>TmTransactionManagerObjectType</strong>, or *<strong>TmTransactionObjectType</strong>. This parameter can be <strong>NULL</strong> if *AccessMode</em> is <strong>KernelMode</strong>. If <em>ObjectType</em> is not <strong>NULL</strong>, the routine verifies that the supplied object type matches the object type of the object that the <em>Handle</em> parameter specifies.</p>
<h3><code>AccessMode</code> [in]</h3>
<p>Indicates the access mode to use for the access check. Set this parameter to one of the following <strong>MODE</strong> enumeration values:</p>
<ul>
<li><p><strong>UserMode</strong></p></li>
<li><p><strong>KernelMode</strong></p></li>
</ul>
<p>Lower-level drivers should specify <strong>KernelMode</strong>.</p>
<h3><code>Tag</code> [in]</h3>
<p>Specifies a four-byte, custom tag value. For more information, see the following Remarks section.</p>
<h2>Return value</h2>
<p><strong>ObReferenceObjectByPointerWithTag</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful. Possible error return values include the following:</p>
<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_OBJECT_TYPE_MISMATCH</strong></td>
  <td>The <em>ObjectType</em> parameter specifies the wrong object type for the object that the <em>Object</em> parameter points to, or <em>ObjectType</em> is <strong>NULL</strong> but <em>AccessMode</em> is <strong>UserMode</strong>.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>This routine does access validation of the specified object. If access can be granted, the routine increments the object reference count. This increment prevents the object from being deleted while the caller uses the object. When the object is no longer needed, the caller should decrement the reference count by calling the <a href="obdereferenceobjectwithtag" title="void ObDereferenceObjectWithTag(&#10;  [in] a,&#10;  [in] t&#10;);">ObDereferenceObjectWithTag</a> or <a href="obdereferenceobjectdeferdeletewithtag" title="VOID ObDereferenceObjectDeferDeleteWithTag(&#10;  [in] PVOID Object,&#10;  [in] ULONG Tag&#10;);">ObDereferenceObjectDeferDeleteWithTag</a> routine.</p>
<p>For more information about object references, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/life-cycle-of-an-object">Life Cycle of an Object</a>.</p>
<p>The <a href="obreferenceobjectbypointer" title="NTSTATUS ObReferenceObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode&#10;);">ObReferenceObjectByPointer</a> routine is similar to <strong>ObReferenceObjectByPointerWithTag</strong>, except that it does not enable the caller to write a custom tag to an object. In Windows 7 and later versions of Windows, <strong><a href="obreferenceobjectbypointer" title="NTSTATUS ObReferenceObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode&#10;);">ObReferenceObjectByPointer</a></strong> always writes a default tag value ('tlfD') to the object. A call to <strong><a href="obreferenceobjectbypointer" title="NTSTATUS ObReferenceObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode&#10;);">ObReferenceObjectByPointer</a></strong> has the same effect as a call to <strong>ObReferenceObjectByPointerWithTag</strong> that specifies <em>Tag</em> = 'tlfD'.</p>
<p>To view an object reference trace in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/debugger">Windows debugging tools</a>, use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/debugger/-obtrace">!obtrace</a> kernel-mode debugger extension. In Windows 7, the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/debugger/-obtrace">!obtrace</a> extension is enhanced to display object reference tags, if object reference tracing is enabled. By default, object reference tracing is turned off. Use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/debugger/gflags">Global Flags Editor</a> (Gflags) to enable object reference tracing. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/object-reference-tracing-with-tags">Object Reference Tracing with Tags</a>.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">OBJECT_TYPE</a></p>
<p><a href="obdereferenceobjectdeferdeletewithtag" title="VOID ObDereferenceObjectDeferDeleteWithTag(&#10;  [in] PVOID Object,&#10;  [in] ULONG Tag&#10;);">ObDereferenceObjectDeferDeleteWithTag</a></p>
<p><a href="obdereferenceobjectwithtag" title="void ObDereferenceObjectWithTag(&#10;  [in] a,&#10;  [in] t&#10;);">ObDereferenceObjectWithTag</a></p>
<p><a href="obreferenceobjectbypointer" title="NTSTATUS ObReferenceObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode&#10;);">ObReferenceObjectByPointer</a></p>
<p><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obreferenceobjectbypointerwithtag">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-obreferenceobjectbypointerwithtag.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
