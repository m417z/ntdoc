<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisMRegisterDevice - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisMRegisterDevice - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisMRegisterDevice - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_STATUS NdisMRegisterDevice(
  [in]  NDIS_HANDLE      NdisWrapperHandle,
  [in]  PNDIS_STRING     DeviceName,
  [in]  PNDIS_STRING     SymbolicName,
  [in]  PDRIVER_DISPATCH *MajorFunctions,
  [in]  <a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a>   *pDeviceObject,
  [out] NDIS_HANDLE      *NdisDeviceHandle
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismregisterdevice">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndismregisterdevice.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndismregisterdevice)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndismregisterdevice-function">NdisMRegisterDevice function</h1>

<h2 id="description">Description</h2>

<p><strong>Note</strong> NDIS 5. <em>x</em> has been deprecated and is superseded by NDIS 6. <em>x</em>. For new NDIS driver development, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">Network Drivers Starting with Windows Vista</a>. For information about porting NDIS 5. <em>x</em> drivers to NDIS 6. <em>x</em>, see <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff570059">Porting NDIS 5.x Drivers to NDIS 6.0</a>.</p>

<p>The <strong>NdisMRegisterDevice</strong> function creates a named device object and a symbolic link between the device object and a user-visible name for that device.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="ndiswrapperhandle-in"><code>NdisWrapperHandle</code> [in]</h3>

<p>Specifies the handle returned by <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553547/(v=vs.85/)"><strong>NdisMInitializeWrapper</strong></a>.</p>

<h3 id="devicename-in"><code>DeviceName</code> [in]</h3>

<p>Pointer to an NDIS_STRING type containing a null-terminated Unicode string that names the device object. The string must be a full-path name--for example, <em>\Device\DeviceName</em>. For Windows 2000 and later, NDIS defines the NDIS_STRING type as a <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff564879"><strong>UNICODE_STRING</strong></a> type.</p>

<h3 id="symbolicname-in"><code>SymbolicName</code> [in]</h3>

<p>Pointer to an NDIS_STRING type containing a Unicode string that is the Win32-visible name of the device being registered. Typically, the <em>SymbolicName</em> has the following format: <em>\DosDevices\SymbolicName</em>.</p>

<h3 id="majorfunctions-in"><code>MajorFunctions</code> [in]</h3>

<p>Pointer to an array of one or more entry points for the device driver's dispatch routines. A driver must set as many separate dispatch entry points as the IRP_MJ_<em>XXX</em> codes that the driver handles for the device object. Each dispatch routine is declared as follows:</p>

<div class="codehilite">
<pre><span></span><code><span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span>
<span class="p">(</span><span class="o">*</span><span class="n">PDRIVER_DISPATCH</span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a></span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">Object</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PIRP</span><span class="w"> </span><span class="n">Irp</span>
<span class="p">)</span><span class="w">   </span><span class="p">;</span>
</code></pre>
</div>

<p>A driver must not supply entry points for Plug and Play or Power Management handlers since the created device object is not for a physical device and therefore does not receive Plug and Play or Power Management IRPs.</p>

<h3 id="pdeviceobject-in"><code>pDeviceObject</code> [in]</h3>

<p>Pointer to the newly created device object if the call succeeds.</p>

<h3 id="ndisdevicehandle-out"><code>NdisDeviceHandle</code> [out]</h3>

<p>Pointer to a caller-supplied variable in which this function, if it succeeds, returns a handle to the device object. This handle is a required parameter to the <strong><a href="ndismderegisterdevice" title="NDIS_STATUS NdisMDeregisterDevice(&#10;  [in] NDIS_HANDLE NdisDeviceHandle&#10;);">NdisMDeregisterDevice</a></strong> function that the driver calls subsequently.</p>

<h2 id="return-value">Return value</h2>

<p><strong>NdisMRegisterDevice</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it succeeds, NDIS_STATUS_NOT_SUPPORTED if the caller is not an NDIS miniport driver, or a failure code if it fails.</p>

<h2 id="remarks">Remarks</h2>

<p>An intermediate driver or miniport driver may require a separate, stand-alone device object. For example, an intermediate miniport driver might require a stand-alone device object to monitor the status of an underlying NIC when the NIC's miniport driver is not up and running. To obtain the NIC's status in such a case, a user-mode application or environmental subsystem sends an <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> to the device object. The <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> is processed by the intermediate driver. Without the stand-alone device object, the NIC's status is available only when the NIC's miniport driver is up and running.</p>

<p>An intermediate driver or miniport driver creates a device object by calling <strong>NdisMRegisterDevice</strong> from its <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> function after <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> has called <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553547/(v=vs.85/)"><strong>NdisMInitializeWrapper</strong></a>. <strong>NdisMRegisterDevice</strong> creates a named device object and also a symbolic link between the device object name and a user-visible name for that device. If the call to <strong>NdisMRegisterDevice</strong> succeeds, the I/O manager allocates storage in nonpaged pool for the device object itself and for all other data structures associated with the device object, including the driver's device extension. The device extension for an object created with <strong>NdisMRegisterDevice</strong> is reserved for use by NDIS and cannot be used by the driver.</p>

<p>A device object created with <strong>NdisMRegisterDevice</strong> functions in the same way as a device object and symbolic link that were created with <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548397"><strong>IoCreateDevice</strong></a> and <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff549043"><strong>IoCreateSymbolicLink</strong></a>, respectively. The miniport driver is responsible for processing all IRPs that it receives for the device object. (NDIS processes all Plug and Play and power management IRPs sent to the device object.) The driver processes IRPs sent to the device object using dispatch routines that it registered when it supplied the <em>MajorFunctions</em> pointer to <strong>NdisMRegisterDevice</strong>. For more information about device objects, IRPs, and dispatch routines, see <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff543153">Device Objects and Device Stacks</a>, <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff546847">Handling IRPs</a>, and <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff566407">Writing Dispatch Routines</a>.</p>

<p>NDIS miniport and intermediate drivers should never call <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548397"><strong>IoCreateDevice</strong></a> or <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff549043"><strong>IoCreateSymbolicLink</strong></a>. Instead, if an NDIS driver must create a device object, it should call <strong>NdisMRegisterDevice</strong>. Miniport and intermediate drivers should never attempt to stack the device object over the physical device object by calling <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548294"><strong>IoAttachDevice</strong></a>.</p>

<p>The device object that is created with <strong>NdisMRegisterDevice</strong> is not a physical device object and therefore does not receive Plug and Play or Power Management IRPs. Callers of <strong>NdisMRegisterDevice</strong> must therefore omit entry points for Plug and Play or Power Management handlers in the array that is pointed to by <em>MajorFunctions</em>.</p>

<p>Note that, if a handle to the device object that is created with <strong>NdisMRegisterDevice</strong> is open, the driver that created the device object cannot be unloaded. A user-mode application should therefore do either of the following:</p>

<ol>
<li><p>When the application registers for device event notification on the underlying device by calling the <strong>RegisterDeviceNotification</strong> function, specify a DBT_DEVTYP_HANDLE type notification filter. (For more information about the <strong>RegisterDeviceNotification</strong> function, see the Microsoft Windows SDK documentation.) If the application subsequently receives a DBT_DEVICEQUERYREMOVE event for the device, the application should close the open handle.</p></li>
<li><p>When the application registers for device event notification on the underlying device by calling the <strong>RegisterDeviceNotification</strong> function, specify a DBT_DEVTYP_DEVICEINTERFACE type notification filter and GUID_NDIS_LAN_CLASS as the interface class GUID. If the application subsequently receives a DBT_DEVICEREMOVECOMPLETE event for the device interface to which the handle corresponds, the application should close the open handle.</p></li>
</ol>

<p>If a driver's call to <strong>NdisMRegisterDevice</strong> fails, the driver can continue to load or not, depending on how critical the stand-alone device object is for the driver's operation.</p>

<ul>
<li>Target platform: <a rel="noopener" target="_blank" href="https://go.microsoft.com/fwlink/p/?linkid=531356">Universal</a></li>
<li>Version: Not supported for NDIS 6.0 drivers in Windows Vista. Use <a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff564518"><strong>NdisRegisterDeviceEx</strong></a>instead. Supported for NDIS 5.1 drivers in Windows Vista and Windows XP.</li>
</ul>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548818"><strong>DriverEntry of NDIS Miniport Drivers</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548294"><strong>IoAttachDevice</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff548397"><strong>IoCreateDevice</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff549043"><strong>IoCreateSymbolicLink</strong></a></li>
<li><strong><a href="ndismderegisterdevice" title="NDIS_STATUS NdisMDeregisterDevice(&#10;  [in] NDIS_HANDLE NdisDeviceHandle&#10;);">NdisMDeregisterDevice</a></strong></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/ff553547/(v=vs.85/)"><strong>NdisMInitializeWrapper</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff564518"><strong>NdisRegisterDeviceEx</strong></a></li>
<li><a rel="noopener" target="_blank" href="https://msdn.microsoft.com/library/Ff564879"><strong>UNICODE_STRING</strong></a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismregisterdevice">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndismregisterdevice.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
