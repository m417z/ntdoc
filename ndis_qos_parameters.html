<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_QOS_PARAMETERS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_QOS_PARAMETERS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_QOS_PARAMETERS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDIS_QOS_PARAMETERS {
  <a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a> Header;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              Flags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              NumTrafficClasses;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>              PriorityAssignmentTable[NDIS_QOS_MAXIMUM_PRIORITIES];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>              TcBandwidthAssignmentTable[NDIS_QOS_MAXIMUM_TRAFFIC_CLASSES];
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>              TsaAssignmentTable[NDIS_QOS_MAXIMUM_TRAFFIC_CLASSES];
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              PfcEnable;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              NumClassificationElements;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              ClassificationElementSize;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              FirstClassificationElementOffset;
} NDIS_QOS_PARAMETERS, *PNDIS_QOS_PARAMETERS;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_qos_parameters">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_qos_parameters.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddndis-_ndis_qos_parameters)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ndis_qos_parameters-structure">_NDIS_QOS_PARAMETERS structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>NDIS_QOS_PARAMETERS</strong> structure specifies the NDIS Quality of Service (QoS) parameters that are enabled on a network adapter that supports the IEEE 802.1 Data Center Bridging (DCB) interface.</p>

<h2 id="members">Members</h2>

<h3 id="header"><code>Header</code></h3>

<p>The type, revision, and size of the <strong>NDIS_QOS_PARAMETERS</strong> structure. This member is formatted as an <a rel="noopener" target="_blank" href="ndis_object_header">NDIS_OBJECT_HEADER</a> structure.</p>

<p>The miniport driver must set the <strong>Type</strong> member of <strong>Header</strong> to NDIS_OBJECT_TYPE_QOS_PARAMETERS. To specify the version of the <strong>NDIS_QOS_PARAMETERS</strong> structure, the driver must set the <strong>Revision</strong> member of <strong>Header</strong> to the following value:</p>

<h4 id="ndis_qos_parameters_revision_1">NDIS_QOS_PARAMETERS_REVISION_1</h4>

<p>Original version for NDIS 6.30 and later.</p>

<p>Set the <strong>Size</strong> member to NDIS_SIZEOF_QOS_PARAMETERS_REVISION_1.</p>

<h3 id="flags"><code>Flags</code></h3>

<p>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> value that contains a bitwise <strong>OR</strong> of flags that specify the status of the NDIS QoS parameters for the network adapter. For more information about this member, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_qos_parameters#overview">Overview of the Flags Member</a>.</p>

<h3 id="numtrafficclasses"><code>NumTrafficClasses</code></h3>

<p>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> value that specifies the number of NDIS QoS traffic classes that are enabled on the network adapter. Each traffic class is referenced through an identifier in the range from zero to (<strong>NumTrafficClasses</strong>–1).</p>

<p><strong>Note</strong> The value of the <strong>NumTrafficClasses</strong> member must be less than or equal to <strong>min</strong>(<strong>NDIS_QOS_MAXIMUM_TRAFFIC_CLASSES</strong>, <em>MaxNumTrafficClasses</em>), where <em>MaxNumTrafficClasses</em> is the value of the <strong>MaxNumTrafficClasses</strong> member that was specified in the <a rel="noopener" target="_blank" href="ndis_qos_capabilities">NDIS_QOS_CAPABILITIES</a> structure.</p>

<h3 id="priorityassignmenttable"><code>PriorityAssignmentTable</code></h3>

<p>An array of <strong><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></strong> elements where each element represents the traffic class associated with an IEEE 802.1p priority level. The <strong>PriorityAssignmentTable</strong> array is indexed by the 802.1p priority level (0–7).</p>

<p>Each element contains the traffic class identifier. This identifier is the index of the <a rel="noopener" target="_blank" href="ndis_qos_classification_element">NDIS_QOS_CLASSIFICATION_ELEMENT</a> structure for the traffic class within the classification array.</p>

<p><strong>Note</strong> Each element in the <strong>PriorityAssignmentTable</strong> array must be assigned a valid traffic class identifier. A traffic class identifier can be assigned to more than one element in the <strong>PriorityAssignmentTable</strong> array.</p>

<h3 id="tcbandwidthassignmenttable"><code>TcBandwidthAssignmentTable</code></h3>

<p>An array of <strong><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></strong> elements that specifies the percentage of the bandwidth allocation assigned to each traffic class. The <strong>TcBandwidthAssignmentTable</strong> array is indexed by the traffic class identifier.</p>

<p>Each element of the <strong>TcBandwidthAssignmentTable</strong> array specifies the bandwidth allocation for the traffic classes. The total value of all bandwidth allocation assignments in the <strong>TcBandwidthAssignmentTable</strong> array must equal 100.</p>

<p><strong>Note</strong> Bandwidth allocation is supported only for the Enhanced Transmission Selection (ETS) TSA. If the element for the traffic class in the <strong>TsaAssignmentTable</strong> array is not set to NDIS_QOS_TSA_ETS, the element for the traffic class in the <strong>TcBandwidthAssignmentTable</strong> array must be set to zero.</p>

<h3 id="tsaassignmenttable"><code>TsaAssignmentTable</code></h3>

<p>An array of <strong><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></strong> elements that specifies the TSA assigned to each traffic class. The <strong>TsaAssignmentTable</strong> array is indexed by the traffic class identifier.</p>

<p>Each element of the <strong>TsaAssignmentTable</strong> array contains one of the following values:</p>

<h4 id="ndis_qos_tsa_strict">NDIS_QOS_TSA_STRICT</h4>

<p>The strict priority algorithm must be used as the TSA for the traffic class. For more information about this TSA, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/strict-priority-algorithm">Strict Priority Algorithm</a>.</p>

<h4 id="ndis_qos_tsa_cbs">NDIS_QOS_TSA_CBS</h4>

<p>The IEEE 802.1Qav credit-based shaper (CBS) algorithm must be used as the TSA for the traffic class.</p>

<p><strong>Note</strong> Starting with Windows Server 2012, the DCB component (Msdcb.sys) does not support the CBS TSA and won't enable this parameter through object identifier (OID) method requests of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-parameters">OID_QOS_PARAMETERS</a>. For more information on the DCB component, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-qos-architecture-for-data-center-bridging">NDIS QoS Architecture for Data Center Bridging</a>.</p>

<h4 id="ndis_qos_tsa_ets">NDIS_QOS_TSA_ETS</h4>

<p>The IEEE 802.1Qaz Enhanced Transmission Selection (ETS) algorithm must be used as the TSA for the traffic class. For more information about this TSA, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/enhanced-transmission-selection--ets--algorithm">Enhanced Transmission Selection (ETS) Algorithm</a>.</p>

<h3 id="pfcenable"><code>PfcEnable</code></h3>

<p>A bitmap of 32 bits. The most-significant 24 bits are reserved for future use. The least-significant 8 bits are used to specify whether PFC
is enabled on the IEEE 802.1p priority level. If the bit is set to one, PFC is enabled for the priority level.</p>

<table>
<thead>
<tr>
  <th>Bit range</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>31:24</td>
  <td>Reserved for future use.</td>
</tr>
<tr>
  <td>7</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 7 (<em>network control</em>).</td>
</tr>
<tr>
  <td>6</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 6 (<em>internetwork control</em>).</td>
</tr>
<tr>
  <td>5</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 5 (<em>voice</em>).</td>
</tr>
<tr>
  <td>4</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 4 (<em>video</em>).</td>
</tr>
<tr>
  <td>3</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 3 (<em>critical applications</em>).</td>
</tr>
<tr>
  <td>2</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 2 (<em>excellent effort</em>).</td>
</tr>
<tr>
  <td>1</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 1 (<em>background</em>).</td>
</tr>
<tr>
  <td>0</td>
  <td>If set to one, PFC is enabled on 802.1p priority level 0 (<em>best effort</em>).</td>
</tr>
</tbody>
</table>

<p><strong>Note</strong> The total number of 802.1p priority levels that have PFC enabled must be less than or equal to the value of the <strong>MaxNumPfcEnabledTrafficClasses</strong> member in the <a rel="noopener" target="_blank" href="ndis_qos_capabilities">NDIS_QOS_CAPABILITIES</a> structure.</p>

<p>For more information about priority levels, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ieee-802-1p-priority-levels">IEEE 802.1p Priority Levels</a>.</p>

<h3 id="numclassificationelements"><code>NumClassificationElements</code></h3>

<p>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> value that specifies the number of elements in the traffic classification array. The offset to the first element in this array is specified by the <strong>FirstClassificationElementOffset</strong> member.</p>

<p><strong>Note</strong> Each element in the array is formatted as an <a rel="noopener" target="_blank" href="ndis_qos_classification_element">NDIS_QOS_CLASSIFICATION_ELEMENT</a> structure.</p>

<h3 id="classificationelementsize"><code>ClassificationElementSize</code></h3>

<p>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> value that specifies the size, in bytes, of each element in the traffic classification array.</p>

<p><strong>Note</strong> Starting with NDIS 6.30, this member must be set to <code>sizeof(<a href="ndis_qos_classification_element" title="typedef struct _NDIS_QOS_CLASSIFICATION_ELEMENT {&#10;  NDIS_OBJECT_HEADER Header;&#10;  ULONG              Flags;&#10;  USHORT             ConditionSelector;&#10;  USHORT             ConditionField;&#10;  USHORT             ActionSelector;&#10;  USHORT             ActionField;&#10;} NDIS_QOS_CLASSIFICATION_ELEMENT, *PNDIS_QOS_CLASSIFICATION_ELEMENT;">NDIS_QOS_CLASSIFICATION_ELEMENT</a></code>).</p>

<h3 id="firstclassificationelementoffset"><code>FirstClassificationElementOffset</code></h3>

<p>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> value that specifies the offset, in bytes, to the first element in an array of traffic classification elements that follow this structure. The offset is measured from the start of the <strong>NDIS_QOS_PARAMETERS</strong> structure up to the beginning of the first element. Each element in the array is an <a rel="noopener" target="_blank" href="ndis_qos_classification_element">NDIS_QOS_CLASSIFICATION_ELEMENT</a> structure.</p>

<p><strong>Note</strong> If <strong>NumClassificationElements</strong> is set to zero, this member is ignored.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>NDIS_QOS_PARAMETERS</strong> structure specifies the parameters that define how the network adapter prioritizes transmit, or <em>egress</em>, packets. This structure is used in the following OID requests:</p>

<ul>
<li>OID query request of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-operational-parameters">OID_QOS_OPERATIONAL_PARAMETERS</a>. This OID request returns the operational QoS parameters that are currently provisioned on the network adapter.</li>
<li>OID query request of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-remote-parameters">OID_QOS_REMOTE_PARAMETERS</a>. This OID request returns the remote QoS parameters that are currently provisioned on the network adapter.</li>
<li>OID method requests of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-parameters">OID_QOS_PARAMETERS</a>. This OID request provisions the network adapter with the local QoS parameters.</li>
</ul>

<p>The miniport driver also returns an <strong>NDIS_QOS_PARAMETERS</strong> structure in the following NDIS status indications:</p>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-qos-operational-parameters-change">NDIS_STATUS_QOS_OPERATIONAL_PARAMETERS_CHANGE</a>. This miniport driver issues this status indication when its operational QoS parameters change.</li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-qos-remote-parameters-change">NDIS_STATUS_QOS_REMOTE_PARAMETERS_CHANGE</a>. This miniport driver issues this status indication when its remote QoS parameters change.</li>
</ul>

<p>For more information about the types of NDIS QoS parameters, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/overview-of-ndis-qos-parameters">Overview of NDIS QoS Parameters</a>.</p>

<h3 id="overview-of-the-flags-member">Overview of the Flags Member</h3>

<p>The <strong>Flags</strong> member contains a bitwise <strong>OR</strong> of flags that specify the status of the NDIS QoS parameters for the network adapter.</p>

<p>The miniport driver sets the <strong>Flags</strong> member when it issues the following NDIS status indications:</p>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-qos-operational-parameters-change">NDIS_STATUS_QOS_OPERATIONAL_PARAMETERS_CHANGE</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-qos-remote-parameters-change">NDIS_STATUS_QOS_REMOTE_PARAMETERS_CHANGE</a></li>
</ul>

<p>The DCB component sets the <strong>Flags</strong> member when it issues an OID method request of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-parameters">OID_QOS_PARAMETERS</a>.</p>

<p><strong>Note</strong> Only the DCB component can issue the OID request. An overlying protocol or filter driver must not issue this OID.
For more information on the DCB component, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-qos-architecture-for-data-center-bridging">NDIS QoS Architecture for Data Center Bridging</a>.</p>

<p>The following flags are defined for the <strong>Flags</strong> member.</p>

<p><strong>Note</strong> NDIS guarantees that both the <strong>NDIS_QOS_PARAMETERS_ETS_CONFIGURED</strong> and <strong>NDIS_QOS_PARAMETERS_PFC_CONFIGURED</strong> flags are set or cleared together.</p>

<p>The <strong>NDIS_QOS_PARAMETERS_*Xxx*_CHANGED</strong> flags provide hints as to whether the corresponding group of parameters has changed from a previous <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-parameters">OID_QOS_PARAMETERS</a> method request or <strong>NDIS_QOS_PARAMETERS_*Xxx*_CHANGED</strong> status notification. When the miniport driver issues the <strong>NDIS_QOS_PARAMETERS_*Xxx*_CHANGED</strong> status notifications, it can optionally set these flags.</p>

<p><strong>Note</strong> If the <strong>NDIS_QOS_PARAMETERS_*Xxx*_CHANGED</strong> flags are not set, overlying drivers must not assume that the corresponding group of parameters are supported or enabled on the underlying network adapter.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="ndis_miniport_adapter_hardware_assist_attributes">NDIS_MINIPORT_ADAPTER_HARDWARE_ASSIST_ATTRIBUTES</a></p>

<p><a rel="noopener" target="_blank" href="ndis_object_header">NDIS_OBJECT_HEADER</a></p>

<p><a rel="noopener" target="_blank" href="ndis_qos_capabilities">NDIS_QOS_CAPABILITIES</a></p>

<p><a rel="noopener" target="_blank" href="ndis_qos_classification_element">NDIS_QOS_CLASSIFICATION_ELEMENT</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-qos-operational-parameters-change">NDIS_STATUS_QOS_OPERATIONAL_PARAMETERS_CHANGE</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-qos-remote-parameters-change">NDIS_STATUS_QOS_REMOTE_PARAMETERS_CHANGE</a></p>

<p><a rel="noopener" target="_blank" href="ndismsetminiportattributes">NdisMSetMiniportAttributes</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-current-capabilities">OID_QOS_CURRENT_CAPABILITIES</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-qos-hardware-capabilities">OID_QOS_HARDWARE_CAPABILITIES</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_qos_parameters">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddndis/ns-ntddndis-_ndis_qos_parameters.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
