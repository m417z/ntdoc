<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtGetNextProcess - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtGetNextProcess - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtGetNextProcess - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTPSAPI_H
//
// Processes
//
#if (PHNT_MODE != PHNT_MODE_KERNEL)

</span><span class="ntdoc-code-intro">/**
 * Retrieves a handle to the next process in the system.
 *
 * @param ProcessHandle An optional handle to a process. If this parameter is NULL, the function retrieves the first process in the system.
 * @param DesiredAccess The access rights desired for the new process handle.
 * @param HandleAttributes The attributes for the new process handle.
 * @param Flags Flags that modify the behavior of the function. This can be a combination of the following flags:
 * - \ref <a href="process_get_next_flags_previous_process" title="#define PROCESS_GET_NEXT_FLAGS_PREVIOUS_PROCESS 0x00000001">PROCESS_GET_NEXT_FLAGS_PREVIOUS_PROCESS</a> (0x00000001): Retrieve the previous process in the system.
 * @param NewProcessHandle A pointer to a variable that receives the handle to the next process.
 * @return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtGetNextProcess(
    _In_opt_ HANDLE ProcessHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> HandleAttributes,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags,
    _Out_ PHANDLE NewProcessHandle
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/c9581b28dfd0f1b96873700515ce0e8f7ed5e895/phnt/include/ntpsapi.h#L2159">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwGetNextProcess(
    _In_opt_ HANDLE ProcessHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> HandleAttributes,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags,
    _Out_ PHANDLE NewProcessHandle
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/c9581b28dfd0f1b96873700515ce0e8f7ed5e895/phnt/include/ntzwapi.h#L2042">View code on GitHub</a></span></code></pre></div>
</div>
<div class="ntdoc-description">
<p>This function allows iterating over processes on the system without incurring any race conditions inherent to enumerating or opening processes by ID. Call this function repeatedly to open processes one by one.</p>

<h1 id="parameters">Parameters</h1>

<ul>
<li><code>ProcessHandle</code> - a handle to the previous process to continue enumeration from or <code>NULL</code> to restart enumeration.  The handle doesn't need to grant any particular access.</li>
<li><code>DesiredAccess</code> - the process access mask expected on the opened handle.</li>
<li><code>HandleAttributes</code> - flags that control the property of the handle, such as its inheritance (<code><a href="obj_inherit" title="#define OBJ_INHERIT 0x00000002">OBJ_INHERIT</a></code>).</li>
<li><code>Flags</code> - the bit mask that controls the operation. See below for known values.</li>
<li><code>NewProcessHandle</code> - a pointer to a variable that receives a handle to the opened process.</li>
</ul>

<h1 id="known-flags">Known flags</h1>

<ul>
<li><code><a href="process_get_next_flags_previous_process" title="#define PROCESS_GET_NEXT_FLAGS_PREVIOUS_PROCESS 0x00000001">PROCESS_GET_NEXT_FLAGS_PREVIOUS_PROCESS</a></code> - reverses enumeration order by opening the previous process instead of the next one.</li>
</ul>

<h1 id="access-masks">Access masks</h1>

<p>For the list of process-specific access masks, see <code><a href="ntopenprocess" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenProcess(&#10;    _Out_ PHANDLE ProcessHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PCLIENT_ID ClientId&#10;    );">NtOpenProcess</a></code>.</p>

<h1 id="notable-return-values">Notable return values</h1>

<ul>
<li><code><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></code> - the function opened the next/previous process.</li>
<li><code>STATUS_NO_MORE_ENTRIES</code> - the function failed because there are no more accessible processes to enumerate.</li>
</ul>

<h1 id="remarks">Remarks</h1>

<p><code>NtGetNextProcess</code> automatically skips inaccessible processes. In other words, it only enumerates processes for which it can return handles with the specified desired access. However, if there are no processes that satisfy this criterion at the start of enumeration (when the input handle is <code>NULL</code>), the function returns the error accordingly (usually <code>STATUS_ACCESS_DENIED</code>) instead of <code>STATUS_NO_MORE_ENTRIES</code>.</p>

<p>To avoid retaining unused resources, call <code><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">NtClose</a></code> to close the returned handles when they are no longer required.</p>

<p>This function bypasses some access checks if the caller has the <code>SeDebugPrivilege</code> enabled.</p>

<h1 id="related-win32-api">Related Win32 API</h1>

<p>This functionality is not exposed in Win32 API.</p>

<h1 id="see-also">See also</h1>

<ul>
<li><code><a href="ntgetnextthread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtGetNextThread(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ HANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ ULONG HandleAttributes,&#10;    _In_ ULONG Flags,&#10;    _Out_ PHANDLE NewThreadHandle&#10;    );">NtGetNextThread</a></code></li>
<li><code><a href="ntopenprocess" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenProcess(&#10;    _Out_ PHANDLE ProcessHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PCLIENT_ID ClientId&#10;    );">NtOpenProcess</a></code></li>
<li><code><a href="ntopenthread" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenThread(&#10;    _Out_ PHANDLE ThreadHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PCLIENT_ID ClientId&#10;    );">NtOpenThread</a></code></li>
</ul>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntgetnextprocess.md">Edit description on GitHub</a>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
