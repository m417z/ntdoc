<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfMemoryCreatePreallocated - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfMemoryCreatePreallocated - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfMemoryCreatePreallocated - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfmemory.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> WdfMemoryCreatePreallocated(
  [in, optional] <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">PWDF_OBJECT_ATTRIBUTES</a> Attributes,
  [in]           __drv_aliasesMem PVOID Buffer,
  [in]           <a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a>                 BufferSize,
  [out]          WDFMEMORY              *Memory
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfmemory/nf-wdfmemory-wdfmemorycreatepreallocated">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfmemorycreatepreallocated.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfmemory-wdfmemorycreatepreallocated)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="wdfmemorycreatepreallocated-function">WdfMemoryCreatePreallocated function</h1>

<h2 id="description">Description</h2>

<p>[Applies to KMDF and UMDF]</p>

<p>The <strong>WdfMemoryCreatePreallocated</strong> method creates a framework memory object for a driver-supplied memory buffer.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="attributes-in-optional"><code>Attributes</code> [in, optional]</h3>

<p>A pointer to a <a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a> structure that contains object attributes for the new memory object. This parameter is optional and can be WDF_NO_OBJECT_ATTRIBUTES.</p>

<h3 id="buffer-in"><code>Buffer</code> [in]</h3>

<p>A pointer to a driver-supplied buffer.</p>

<h3 id="buffersize-in"><code>BufferSize</code> [in]</h3>

<p>The nonzero size, in bytes, of the buffer that <em>Buffer</em> points to.</p>

<h3 id="memory-out"><code>Memory</code> [out]</h3>

<p>A pointer to a location that receives a handle to the new memory object.</p>

<h2 id="return-value">Return value</h2>

<p><strong>WdfMemoryCreatePreallocated</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, this method might return one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>An invalid parameter was detected.</td>
</tr>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>There was insufficient memory.</td>
</tr>
</tbody>
</table>

<p>For a list of other return values that the <strong>WdfMemoryCreatePreallocated</strong> method might return, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/framework-object-creation-errors">Framework Object Creation Errors</a>.</p>

<p>This method also might return other <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS values</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>WdfMemoryCreatePreallocated</strong> method creates a framework memory object for a buffer that the driver has previously allocated or obtained.</p>

<p>Your driver can call <strong>WdfMemoryCreatePreallocated</strong> if you need to create memory objects that represent pre-existing memory buffers. For example, the driver might receive a driver-defined structure within a buffer for an I/O request that contains an internal I/O control code. The driver can call <strong>WdfMemoryCreatePreallocated</strong> to create a memory object so that the driver can pass the structure to an I/O target.</p>

<p>After a driver has called <strong>WdfMemoryCreatePreallocated</strong>, the driver can call <a href="wdfmemoryassignbuffer" title="NTSTATUS WdfMemoryAssignBuffer(&#10;  [in] WDFMEMORY Memory,&#10;  [in] PVOID     Buffer,&#10;  [in] size_t    BufferSize&#10;);">WdfMemoryAssignBuffer</a> to assign a different buffer to the memory object that <strong>WdfMemoryCreatePreallocated</strong> created.</p>

<p>The default parent object for each memory object is the framework driver object that represents the driver that called <strong>WdfMemoryCreatePreallocated</strong>. If your driver creates a memory object that it uses with a specific device object, request object, or other framework object, it should set the memory object's parent appropriately. The memory object will be deleted when the parent object is deleted. If you do not change the default parent object, the memory object will remain in memory until the I/O manager unloads your driver.</p>

<p>A driver can also delete a memory object by calling <a href="wdfobjectdelete" title="VOID WdfObjectDelete(&#10;  [in] WDFOBJECT Object&#10;);">WdfObjectDelete</a>.</p>

<p>When the framework memory object that <strong>WdfMemoryCreatePreallocated</strong> created is deleted, the framework does not deallocate the pre-existing buffer. Likewise, a call to <a href="wdfmemoryassignbuffer" title="NTSTATUS WdfMemoryAssignBuffer(&#10;  [in] WDFMEMORY Memory,&#10;  [in] PVOID     Buffer,&#10;  [in] size_t    BufferSize&#10;);">WdfMemoryAssignBuffer</a> does not deallocate the previously assigned buffer.</p>

<p>For more information about framework memory objects, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-memory-buffers">Using Memory Buffers</a>.</p>

<h4 id="examples">Examples</h4>

<p>The following code example allocates a buffer and then creates a framework memory object for the buffer.</p>

<div class="codehilite">
<pre><span></span><code><span class="n">PVOID</span><span class="w">  </span><span class="n">pBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="n"><a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a></span><span class="w">  </span><span class="n">attributes</span><span class="p">;</span>
<span class="n">WDFMEMORY</span><span class="w">  </span><span class="n">memHandle</span><span class="p">;</span>

<span class="n">pBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a></span><span class="p">(</span>
<span class="w">                                </span><span class="n">NonPagedPool</span><span class="p">,</span>
<span class="w">                                </span><span class="n">MY_BUFFER_SIZE</span><span class="p">,</span>
<span class="w">                                </span><span class="n">MY_DRIVER_TAG</span>
<span class="w">                                </span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pBuffer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">){</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">Error</span><span class="p">;</span>
<span class="p">}</span>
<span class="n"><a href="wdf_object_attributes_init" title="VOID WDF_OBJECT_ATTRIBUTES_INIT(&#10;  [out] PWDF_OBJECT_ATTRIBUTES Attributes&#10;);">WDF_OBJECT_ATTRIBUTES_INIT</a></span><span class="p">(</span><span class="o">&amp;</span><span class="n">attributes</span><span class="p">);</span>
<span class="n">attributes</span><span class="p">.</span><span class="n">ParentObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestHandle</span><span class="p">;</span>

<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WdfMemoryCreatePreallocated</span><span class="p">(</span>
<span class="w">                                     </span><span class="o">&amp;</span><span class="n">attributes</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">pBuffer</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">MY_BUFFER_SIZE</span><span class="p">,</span>
<span class="w">                                     </span><span class="o">&amp;</span><span class="n">memHandle</span>
<span class="w">                                     </span><span class="p">);</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a></p>

<p><a href="wdf_object_attributes" title="typedef struct _WDF_OBJECT_ATTRIBUTES {&#10;  ULONG                          Size;&#10;  PFN_WDF_OBJECT_CONTEXT_CLEANUP EvtCleanupCallback;&#10;  PFN_WDF_OBJECT_CONTEXT_DESTROY EvtDestroyCallback;&#10;  WDF_EXECUTION_LEVEL            ExecutionLevel;&#10;  WDF_SYNCHRONIZATION_SCOPE      SynchronizationScope;&#10;  WDFOBJECT                      ParentObject;&#10;  size_t                         ContextSizeOverride;&#10;  PCWDF_OBJECT_CONTEXT_TYPE_INFO ContextTypeInfo;&#10;} WDF_OBJECT_ATTRIBUTES, *PWDF_OBJECT_ATTRIBUTES;">WDF_OBJECT_ATTRIBUTES</a></p>

<p><a href="wdf_object_attributes_init" title="VOID WDF_OBJECT_ATTRIBUTES_INIT(&#10;  [out] PWDF_OBJECT_ATTRIBUTES Attributes&#10;);">WDF_OBJECT_ATTRIBUTES_INIT</a></p>

<p><a href="wdfmemoryassignbuffer" title="NTSTATUS WdfMemoryAssignBuffer(&#10;  [in] WDFMEMORY Memory,&#10;  [in] PVOID     Buffer,&#10;  [in] size_t    BufferSize&#10;);">WdfMemoryAssignBuffer</a></p>

<p><a href="wdfmemorycreate" title="NTSTATUS WdfMemoryCreate(&#10;  [in, optional]  PWDF_OBJECT_ATTRIBUTES Attributes,&#10;  [in]            POOL_TYPE              PoolType,&#10;  [in, optional]  ULONG                  PoolTag,&#10;  [in]            size_t                 BufferSize,&#10;  [out]           WDFMEMORY              *Memory,&#10;  [out, optional] PVOID                  *Buffer&#10;);">WdfMemoryCreate</a></p>

<p><a href="wdfmemorycreatefromlookaside" title="NTSTATUS WdfMemoryCreateFromLookaside(&#10;  [in]  WDFLOOKASIDE Lookaside,&#10;  [out] WDFMEMORY    *Memory&#10;);">WdfMemoryCreateFromLookaside</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfmemory/nf-wdfmemory-wdfmemorycreatepreallocated">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfmemory/nf-wdfmemory-wdfmemorycreatepreallocated.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
