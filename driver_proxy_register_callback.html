<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DRIVER_PROXY_REGISTER_CALLBACK - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DRIVER_PROXY_REGISTER_CALLBACK - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DRIVER_PROXY_REGISTER_CALLBACK - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DRIVER_PROXY_REGISTER_CALLBACK DriverProxyRegisterCallback;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DriverProxyRegisterCallback(
  <a href="driver_proxy_register_callback_phase" title="typedef enum _DRIVER_PROXY_REGISTER_CALLBACK_PHASE {&#10;  DriverProxyRegisterCallbackPreProcess,&#10;  DriverProxyRegisterCallbackProxyStalled,&#10;  DriverProxyRegisterCallbackPostProcess,&#10;  DriverProxyRegisterCallbackMax&#10;} DRIVER_PROXY_REGISTER_CALLBACK_PHASE, *PDRIVER_PROXY_REGISTER_CALLBACK_PHASE;">DRIVER_PROXY_REGISTER_CALLBACK_PHASE</a> Phase,
  PVOID Context
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_proxy_register_callback">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/driver_proxy_register_callback.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-driver_proxy_register_callback)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>DRIVER_PROXY_REGISTER_CALLBACK</strong> callback defines a routine that is invoked at different phases during DriverProxy endpoint registration and hot-swap operations.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="phase"><code>Phase</code></h3>

<p>[in] A <strong><a href="driver_proxy_register_callback_phase" title="typedef enum _DRIVER_PROXY_REGISTER_CALLBACK_PHASE {&#10;  DriverProxyRegisterCallbackPreProcess,&#10;  DriverProxyRegisterCallbackProxyStalled,&#10;  DriverProxyRegisterCallbackPostProcess,&#10;  DriverProxyRegisterCallbackMax&#10;} DRIVER_PROXY_REGISTER_CALLBACK_PHASE, *PDRIVER_PROXY_REGISTER_CALLBACK_PHASE;">DRIVER_PROXY_REGISTER_CALLBACK_PHASE</a></strong> value that indicates which phase of the registration process is currently executing.</p>

<h3 id="context"><code>Context</code></h3>

<p>[in, optional] A pointer to driver-defined context information that was passed to <strong><a href="ioregisterdriverproxyendpoints" title="NTSTATUS IoRegisterDriverProxyEndpoints(&#10;  PDRIVER_PROXY_EXTENSION            DriverProxyExtension,&#10;  PDRIVER_PROXY_ENDPOINT_INFORMATION EndpointInfo,&#10;  ULONG                              Count,&#10;  PDRIVER_PROXY_REGISTER_CALLBACK    PhasedCallback,&#10;  PVOID                              Context&#10;);">IoRegisterDriverProxyEndpoints</a></strong>. This parameter can be NULL if no context was provided.</p>

<h2 id="return-value">Return value</h2>

<p><strong>DRIVER_PROXY_REGISTER_CALLBACK</strong> returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The callback completed successfully. The endpoint registration process will continue to the next phase.</td>
</tr>
<tr>
  <td><strong>Other <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> values</strong></td>
  <td>The callback encountered an error. The entire endpoint registration operation will fail and any partial changes will be rolled back.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>This callback allows drivers to perform custom operations at specific points during the endpoint registration process, enabling coordination with the hot-swap mechanism.</p>

<p>This callback is invoked by <strong><a href="ioregisterdriverproxyendpoints" title="NTSTATUS IoRegisterDriverProxyEndpoints(&#10;  PDRIVER_PROXY_EXTENSION            DriverProxyExtension,&#10;  PDRIVER_PROXY_ENDPOINT_INFORMATION EndpointInfo,&#10;  ULONG                              Count,&#10;  PDRIVER_PROXY_REGISTER_CALLBACK    PhasedCallback,&#10;  PVOID                              Context&#10;);">IoRegisterDriverProxyEndpoints</a></strong> during endpoint registration and hot-swap operations. The callback runs at PASSIVE_LEVEL and provides drivers with the opportunity to coordinate with the DriverProxy system during critical phases of the hot-swap process.</p>

<p>The callback is invoked in a specific sequence during endpoint registration:</p>

<ol>
<li><p><strong>Pre-processing phase</strong>: Called before any endpoint function switching begins. Drivers can use this phase to prepare for the upcoming change, such as:</p>

<ul>
<li>Acquiring driver-specific locks</li>
<li>Saving current state</li>
<li>Notifying other driver components</li>
<li>Preparing resources needed during the switch</li>
</ul></li>
<li><p><strong>Proxy stalled phase</strong>: Called while all calls to registered endpoints are blocked. During this phase, the DriverProxy system holds the rundown lock and no new calls to endpoint functions will proceed. This is the safest time to perform operations that require exclusive access to resources that might be accessed by endpoint functions, such as:</p>

<ul>
<li>Updating shared data structures</li>
<li>Reconfiguring hardware</li>
<li>Modifying global driver state</li>
</ul></li>
<li><p><strong>Post-processing phase</strong>: Called after endpoint function switching is complete and normal operation has resumed. Drivers can use this phase for cleanup operations, such as:</p>

<ul>
<li>Releasing driver-specific locks</li>
<li>Updating internal state</li>
<li>Notifying other components of completion</li>
<li>Logging or performance tracking</li>
</ul></li>
</ol>

<p>The callback must return <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> for the registration to continue. Any failure will cause the entire operation to fail and roll back.</p>

<p>During the <strong>DriverProxyRegisterCallbackProxyStalled</strong> phase, all endpoint calls are blocked, so the callback should perform operations quickly to minimize system disruption.</p>

<p>The callback should not perform operations that might call back into the same DriverProxy extension, as this could cause deadlocks.</p>

<p>The callback is optional and can be NULL if no driver-specific coordination is needed during endpoint registration.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="ioregisterdriverproxyendpoints" title="NTSTATUS IoRegisterDriverProxyEndpoints(&#10;  PDRIVER_PROXY_EXTENSION            DriverProxyExtension,&#10;  PDRIVER_PROXY_ENDPOINT_INFORMATION EndpointInfo,&#10;  ULONG                              Count,&#10;  PDRIVER_PROXY_REGISTER_CALLBACK    PhasedCallback,&#10;  PVOID                              Context&#10;);">IoRegisterDriverProxyEndpoints</a></strong></p>

<p><strong><a href="driver_proxy_register_callback_phase" title="typedef enum _DRIVER_PROXY_REGISTER_CALLBACK_PHASE {&#10;  DriverProxyRegisterCallbackPreProcess,&#10;  DriverProxyRegisterCallbackProxyStalled,&#10;  DriverProxyRegisterCallbackPostProcess,&#10;  DriverProxyRegisterCallbackMax&#10;} DRIVER_PROXY_REGISTER_CALLBACK_PHASE, *PDRIVER_PROXY_REGISTER_CALLBACK_PHASE;">DRIVER_PROXY_REGISTER_CALLBACK_PHASE</a></strong></p>

<p><strong><a href="driver_proxy_endpoint_information" title="typedef struct _DRIVER_PROXY_ENDPOINT_INFORMATION {&#10;  DRIVER_PROXY_ENDPOINT_FUNCTION_ID Id;&#10;  PDRIVER_PROXY_ENDPOINT_FUNCTION   EndpointFunction;&#10;  ULONG                             ParameterCount;&#10;} DRIVER_PROXY_ENDPOINT_INFORMATION, *PDRIVER_PROXY_ENDPOINT_INFORMATION;">DRIVER_PROXY_ENDPOINT_INFORMATION</a></strong></p>

<p><strong><a href="iocreatedriverproxyextension" title="NTSTATUS IoCreateDriverProxyExtension(&#10;  PDRIVER_OBJECT                        OwningDriverObject,&#10;  DRIVER_PROXY_EXTENSION_CREATION_FLAGS Flags,&#10;  PDRIVER_PROXY_EXTENSION               *DriverProxyExtension&#10;);">IoCreateDriverProxyExtension</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-driver_proxy_register_callback">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-driver_proxy_register_callback.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
