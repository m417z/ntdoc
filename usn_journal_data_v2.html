<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="USN_JOURNAL_DATA_V2 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>USN_JOURNAL_DATA_V2 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            USN_JOURNAL_DATA_V2 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct {
  <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a> UsnJournalID;
  USN       FirstUsn;
  USN       NextUsn;
  USN       LowestValidUsn;
  USN       MaxUsn;
  <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a> MaximumSize;
  <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a> AllocationDelta;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>    MinSupportedMajorVersion;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>    MaxSupportedMajorVersion;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     Flags;
  <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a> RangeTrackChunkSize;
  <a href="longlong" title="typedef __int64 LONGLONG;">LONGLONG</a>  RangeTrackFileSizeThreshold;
} USN_JOURNAL_DATA_V2, *PUSN_JOURNAL_DATA_V2;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-usn_journal_data_v2">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct {
  <a href="dwordlong" title="typedef unsigned __int64 DWORDLONG;">DWORDLONG</a> UsnJournalID;
  USN       FirstUsn;
  USN       NextUsn;
  USN       LowestValidUsn;
  USN       MaxUsn;
  <a href="dwordlong" title="typedef unsigned __int64 DWORDLONG;">DWORDLONG</a> MaximumSize;
  <a href="dwordlong" title="typedef unsigned __int64 DWORDLONG;">DWORDLONG</a> AllocationDelta;
  <a href="word" title="typedef unsigned short WORD;">WORD</a>      MinSupportedMajorVersion;
  <a href="word" title="typedef unsigned short WORD;">WORD</a>      MaxSupportedMajorVersion;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>     Flags;
  <a href="dwordlong" title="typedef unsigned __int64 DWORDLONG;">DWORDLONG</a> RangeTrackChunkSize;
  <a href="longlong" title="typedef __int64 LONGLONG;">LONGLONG</a>  RangeTrackFileSizeThreshold;
} USN_JOURNAL_DATA_V2, *PUSN_JOURNAL_DATA_V2;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-usn_journal_data_v2">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/usn_journal_data_v2.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntifs-usn_journal_data_v2)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>USN_JOURNAL_DATA_V2</strong> structure represents an update sequence number (USN) change journal, its records, and its capacity. This structure is the output buffer for the <strong><a href="fsctl_query_usn_journal" title="// CTL_CODE(0x0009, 0x03d, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_QUERY_USN_JOURNAL 0x000900F4">FSCTL_QUERY_USN_JOURNAL</a></strong> control code.</p>
<h2>Members</h2>
<h3><code>UsnJournalID</code></h3>
<p>The current journal identifier. A journal is assigned a new identifier on creation and can be stamped with a new identifier in the course of its existence. The NTFS file system uses this identifier for an integrity check.</p>
<h3><code>FirstUsn</code></h3>
<p>The number of first record that can be read from the journal.</p>
<h3><code>NextUsn</code></h3>
<p>The number of next record to be written to the journal.</p>
<h3><code>LowestValidUsn</code></h3>
<p>The first record that was written into the journal for this journal instance. Enumerating the files or directories on a volume can return a USN lower than this value (in other words, a <strong>FirstUsn</strong> member value less than the <strong>LowestValidUsn</strong> member value). If it does, the journal has been stamped with a new identifier since the last USN was written. In this case, <strong>LowestValidUsn</strong> may indicate a discontinuity in the journal, in which changes to some or all files or directories on the volume may have occurred that are not recorded in the change journal.</p>
<h3><code>MaxUsn</code></h3>
<p>The largest USN that the change journal supports. An administrator must delete the change journal as the value of <strong>NextUsn</strong> approaches this value.</p>
<h3><code>MaximumSize</code></h3>
<p>The target maximum size for the change journal, in bytes. The change journal can grow larger than this value, but it is then truncated at the next NTFS file system checkpoint to less than this value.</p>
<h3><code>AllocationDelta</code></h3>
<p>The number of bytes of disk memory added to the end and removed from the beginning of the change journal each time memory is allocated or deallocated. In other words, allocation and deallocation take place in units of this size. An integer multiple of a cluster size is a reasonable value for this member.</p>
<h3><code>MinSupportedMajorVersion</code></h3>
<p>The minimum major version of the USN Journal that is supported by the system. This field helps ensure that the journal data being processed isn't from an unsupported older version.</p>
<h3><code>MaxSupportedMajorVersion</code></h3>
<p>The maximum major version of the USN Journal that is supported by the system. This field helps ensure that the journal data being processed isn't from a newer version that the system doesn't support.</p>
<h3><code>Flags</code></h3>
<p>Flags that indicate whether range tracking is turned on. The following are the possible values for the Flags member.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000000</td>
<td>Range tracking is not turned on for the volume.</td>
</tr>
<tr>
<td>FLAG_USN_TRACK_MODIFIED_RANGES_ENABLE (0x01)</td>
<td>Range tracking is turned on for the volume.</td>
</tr>
</tbody>
</table>
<h3><code>RangeTrackChunkSize</code></h3>
<p>The granularity of tracked ranges. Valid only when you also set the <strong>Flags</strong> member to FLAG_USN_TRACK_MODIFIED_RANGES_ENABLE.</p>
<h3><code>RangeTrackFileSizeThreshold</code></h3>
<p>File size threshold to start tracking range for files with equal or larger size. Valid only when you also set the <strong>Flags</strong> member to FLAG_USN_TRACK_MODIFIED_RANGES_ENABLE.</p>
<h2>See also</h2>
<p><strong><a href="fsctl_query_usn_journal" title="// CTL_CODE(0x0009, 0x03d, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_QUERY_USN_JOURNAL 0x000900F4">FSCTL_QUERY_USN_JOURNAL</a></strong></p>
<p><strong><a href="usn_journal_data_v0" title="typedef struct {&#10;  ULONGLONG UsnJournalID;&#10;  USN       FirstUsn;&#10;  USN       NextUsn;&#10;  USN       LowestValidUsn;&#10;  USN       MaxUsn;&#10;  ULONGLONG MaximumSize;&#10;  ULONGLONG AllocationDelta;&#10;} USN_JOURNAL_DATA_V0, *PUSN_JOURNAL_DATA_V0;">USN_JOURNAL_DATA_V0</a></strong></p>
<p><strong><a href="usn_journal_data_v1" title="typedef struct {&#10;  ULONGLONG UsnJournalID;&#10;  USN       FirstUsn;&#10;  USN       NextUsn;&#10;  USN       LowestValidUsn;&#10;  USN       MaxUsn;&#10;  ULONGLONG MaximumSize;&#10;  ULONGLONG AllocationDelta;&#10;  USHORT    MinSupportedMajorVersion;&#10;  USHORT    MaxSupportedMajorVersion;&#10;} USN_JOURNAL_DATA_V1, *PUSN_JOURNAL_DATA_V1;">USN_JOURNAL_DATA_V1</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-usn_journal_data_v2">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/ns-ntifs-usn_journal_data_v2.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (ns-winioctl-usn_journal_data_v2)</h1>
</div>
<div class="ntdoc-description">
<h1>USN_JOURNAL_DATA_V2 structure</h1>
<h2>Description</h2>
<p>Represents an update sequence number (USN) change journal, its records, and its capacity. This structure is the output buffer for the <a href="fsctl_query_usn_journal" title="// CTL_CODE(0x0009, 0x03d, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_QUERY_USN_JOURNAL 0x000900F4">FSCTL_QUERY_USN_JOURNAL</a> control code.</p>
<h2>Members</h2>
<h3><code>UsnJournalID</code></h3>
<p>The current journal identifier. A journal is assigned a new identifier on creation and can be stamped with
a new identifier in the course of its existence. The NTFS file system uses this identifier for an integrity
check.</p>
<h3><code>FirstUsn</code></h3>
<p>The number of first record that can be read from the journal.</p>
<h3><code>NextUsn</code></h3>
<p>The number of next record to be written to the journal.</p>
<h3><code>LowestValidUsn</code></h3>
<p>The first record that was written into the journal for this journal instance. Enumerating the files or
directories on a volume can return a USN lower than this value (in other words, a
<strong>FirstUsn</strong> member value less than the <strong>LowestValidUsn</strong> member
value). If it does, the journal has been stamped with a new identifier since the last USN was written. In this
case, <strong>LowestValidUsn</strong> may indicate a discontinuity in the journal, in which changes to
some or all files or directories on the volume may have occurred that are not recorded in the change
journal.</p>
<h3><code>MaxUsn</code></h3>
<p>The largest USN that the change journal supports. An administrator must delete the change journal as the
value of <strong>NextUsn</strong> approaches this value.</p>
<h3><code>MaximumSize</code></h3>
<p>The target maximum size for the change journal, in bytes. The change journal can grow larger than this
value, but it is then truncated at the next NTFS file system checkpoint to less than this value.</p>
<h3><code>AllocationDelta</code></h3>
<p>The number of bytes of disk memory added to the end and removed from the beginning of the change journal
each time memory is allocated or deallocated. In other words, allocation and deallocation take place in units of
this size. An integer multiple of a cluster size is a reasonable value for this member.</p>
<h3><code>MinSupportedMajorVersion</code></h3>
<p>The minimum version of the USN change journal that the file system supports.</p>
<h3><code>MaxSupportedMajorVersion</code></h3>
<p>The maximum version of the USN change journal that the file system supports.</p>
<h3><code>Flags</code></h3>
<p>Whether or not range tracking is turned on. The following are the possible values for the <strong>Flags</strong> member.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000000</td>
<td>Range tracking is not turned on for the volume.</td>
</tr>
<tr>
<td><strong>FLAG_USN_TRACK_MODIFIED_RANGES_ENABLE</strong><!-- raw HTML omitted --><!-- raw HTML omitted -->0x00000001</td>
<td>Range tracking is turned on for the volume.</td>
</tr>
</tbody>
</table>
<h3><code>RangeTrackChunkSize</code></h3>
<p>The granularity of tracked ranges. Valid only when you also set the <strong>Flags</strong> member to <strong>FLAG_USN_TRACK_MODIFIED_RANGES_ENABLE</strong>.</p>
<h3><code>RangeTrackFileSizeThreshold</code></h3>
<p>File size threshold to start tracking range for files with equal or larger size. Valid only when you also set the <strong>Flags</strong> member to <strong>FLAG_USN_TRACK_MODIFIED_RANGES_ENABLE</strong>.</p>
<h2>See also</h2>
<p><a href="fsctl_query_usn_journal" title="// CTL_CODE(0x0009, 0x03d, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_QUERY_USN_JOURNAL 0x000900F4">FSCTL_QUERY_USN_JOURNAL</a></p>
<p><a href="usn_journal_data_v0" title="typedef struct {&#10;  ULONGLONG UsnJournalID;&#10;  USN       FirstUsn;&#10;  USN       NextUsn;&#10;  USN       LowestValidUsn;&#10;  USN       MaxUsn;&#10;  ULONGLONG MaximumSize;&#10;  ULONGLONG AllocationDelta;&#10;} USN_JOURNAL_DATA_V0, *PUSN_JOURNAL_DATA_V0;">USN_JOURNAL_DATA_V0</a></p>
<p><a href="https://learn.microsoft.com/previous-versions/windows/desktop/legacy/hh802707(v=vs.85)">USN_JOURNAL_DATA_V1</a></p>
<p><a href="https://learn.microsoft.com/windows/desktop/FileIO/volume-management-structures">Volume Management Structures</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-usn_journal_data_v2">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winioctl/ns-winioctl-usn_journal_data_v2.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
