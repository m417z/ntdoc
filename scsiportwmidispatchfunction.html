<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ScsiPortWmiDispatchFunction - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ScsiPortWmiDispatchFunction - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ScsiPortWmiDispatchFunction - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// scsiwmi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">BOOLEAN ScsiPortWmiDispatchFunction(
  [in] <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">PSCSI_WMILIB_CONTEXT</a>     WmiLibInfo,
  [in] <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                    MinorFunction,
  [in] PVOID                    DeviceContext,
  [in] <a href="scsiwmi_request_context" title="typedef struct {&#10;  PVOID  UserContext;&#10;  ULONG  BufferSize;&#10;  PUCHAR Buffer;&#10;  UCHAR  MinorFunction;&#10;  UCHAR  ReturnStatus;&#10;  ULONG  ReturnSize;&#10;} SCSIWMI_REQUEST_CONTEXT, *PSCSIWMI_REQUEST_CONTEXT;">PSCSIWMI_REQUEST_CONTEXT</a> RequestContext,
  [in] PVOID                    DataPath,
  [in] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                    BufferSize,
  [in] PVOID                    Buffer
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/scsiwmi/nf-scsiwmi-scsiportwmidispatchfunction">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/scsiportwmidispatchfunction.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-scsiwmi-scsiportwmidispatchfunction)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="scsiportwmidispatchfunction-function">ScsiPortWmiDispatchFunction function</h1>

<h2 id="description">Description</h2>

<p>The <strong>ScsiPortWmiDispatchFunction</strong> routine is a dispatch routine for miniport drivers that support WMI.</p>

<p><strong>Note</strong> The SCSI port driver and SCSI miniport driver models may be altered or unavailable in the future. Instead, we recommend using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-driver">Storport driver</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-miniport-drivers">Storport miniport</a> driver models.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="wmilibinfo-in"><code>WmiLibInfo</code> [in]</h3>

<p>Pointer to a <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a> structure that contains registration information for a miniport driver's data blocks and event blocks and defines entry points for the miniport driver's WMI library callback routines.</p>

<h3 id="minorfunction-in"><code>MinorFunction</code> [in]</h3>

<p>Indicates the WMI action to perform. The miniport driver sets <em>MinorFunction</em> to <strong>Srb->WmiSubFunction</strong> from the input SRB.</p>

<h3 id="devicecontext-in"><code>DeviceContext</code> [in]</h3>

<p>Pointer to a miniport driver-defined context value. The port driver will pass <em>DeviceContext</em> to the miniport driver's <em>HwScsiWmiXxx</em> callback routine. This value would typically point to a HW_DEVICE_EXTENSION structure.</p>

<h3 id="requestcontext-in"><code>RequestContext</code> [in]</h3>

<p>Pointer to a <a href="scsiwmi_request_context" title="typedef struct {&#10;  PVOID  UserContext;&#10;  ULONG  BufferSize;&#10;  PUCHAR Buffer;&#10;  UCHAR  MinorFunction;&#10;  UCHAR  ReturnStatus;&#10;  ULONG  ReturnSize;&#10;} SCSIWMI_REQUEST_CONTEXT, *PSCSIWMI_REQUEST_CONTEXT;">SCSIWMI_REQUEST_CONTEXT</a> structure that contains context information for the WMI SRB. If the SRB can pend, the miniport driver must allocate this structure from the SRB extension because the request context must remain valid until after <strong><a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a></strong> returns with the final SRB return status and buffer size. <strong>ScsiPortWmiDispatchFunction</strong> will pass <em>RequestContext</em> to the miniport driver's callback routine that processes this request.</p>

<h3 id="datapath-in"><code>DataPath</code> [in]</h3>

<p>Pointer to a GUID that represents the data block associated with the request. The miniport driver sets <em>DataPath</em> to <strong>Srb->DataPath</strong> from the input SRB.</p>

<h3 id="buffersize-in"><code>BufferSize</code> [in]</h3>

<p>Specifies the size in bytes of the data buffer. The miniport driver sets <em>BufferSize</em> to <strong>Srb->DataTransferLength</strong> from the input SRB.</p>

<h3 id="buffer-in"><code>Buffer</code> [in]</h3>

<p>Pointer to the data buffer. The miniport driver sets <em>Buffer</em> to <strong>Srb->DataBuffer</strong> from the input SRB.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ScsiPortWmiDispatchFunction</strong> returns <strong>TRUE</strong> if the request is pending, or <strong>FALSE</strong> if the request was completed.</p>

<h2 id="remarks">Remarks</h2>

<p>When a miniport driver receives an SRB in which the <strong>Function</strong> member is set to SRB_FUNCTION_WMI, it calls <strong>ScsiPortWmiDispatchFunction</strong> with request parameters, including a pointer to an initialized <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a> structure. This structure contains information about the miniport driver's data blocks and event blocks and defines entry points for the miniport driver's <em>HwScsiWmiXxx</em> callback routines.</p>

<p><strong>ScsiPortWmiDispatchFunction</strong> confirms that the SRB is a WMI request and determines whether the block specified by the request is valid for the miniport driver. If these conditions are met, <strong>ScsiPortWmiDispatchFunction</strong> processes the SRB by calling the appropriate <em>HwScsiWmiXxx</em> entry point in the miniport driver's <a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a> structure. If the miniport driver does not define an entry point for an optional <em>HwScsiWmiXxx</em> routine, the port driver handles the request.</p>

<p>In either case, after <strong>ScsiPortWmiDispatchFunction</strong> returns, the miniport driver should do the following for requests that it does not pend:</p>

<ul>
<li>Set <strong>Srb->DataTransferLength</strong> to the value returned by <strong><a href="scsiportwmigetreturnsize" title="void ScsiPortWmiGetReturnSize(&#10;  RequestContext&#10;);">ScsiPortWmiGetReturnSize</a></strong></li>
<li>Set <strong>Srb->SrbStatus</strong> to the value returned by <strong><a href="scsiportwmigetreturnstatus" title="void ScsiPortWmiGetReturnStatus(&#10;  RequestContext&#10;);">ScsiPortWmiGetReturnStatus</a></strong></li>
<li>Call <strong><a href="scsiportnotification" title="SCSIPORT_API VOID ScsiPortNotification(&#10;  SCSI_NOTIFICATION_TYPE NotificationType,&#10;  PVOID                  HwDeviceExtension,&#10;  ...                    &#10;);">ScsiPortNotification</a></strong> with <strong>RequestComplete</strong> and again with <strong>NextRequest</strong></li>
</ul>

<h2 id="see-also">See also</h2>

<p><a href="scsiwmi_request_context" title="typedef struct {&#10;  PVOID  UserContext;&#10;  ULONG  BufferSize;&#10;  PUCHAR Buffer;&#10;  UCHAR  MinorFunction;&#10;  UCHAR  ReturnStatus;&#10;  ULONG  ReturnSize;&#10;} SCSIWMI_REQUEST_CONTEXT, *PSCSIWMI_REQUEST_CONTEXT;">SCSIWMI_REQUEST_CONTEXT</a></p>

<p><a href="scsi_wmilib_context" title="typedef struct _SCSIWMILIB_CONTEXT {&#10;  ULONG                     GuidCount;&#10;  PSCSIWMIGUIDREGINFO       GuidList;&#10;  PSCSIWMI_QUERY_REGINFO    QueryWmiRegInfo;&#10;  PSCSIWMI_QUERY_DATABLOCK  QueryWmiDataBlock;&#10;  PSCSIWMI_SET_DATABLOCK    SetWmiDataBlock;&#10;  PSCSIWMI_SET_DATAITEM     SetWmiDataItem;&#10;  PSCSIWMI_EXECUTE_METHOD   ExecuteWmiMethod;&#10;  PSCSIWMI_FUNCTION_CONTROL WmiFunctionControl;&#10;} SCSI_WMILIB_CONTEXT, *PSCSI_WMILIB_CONTEXT;">SCSI_WMILIB_CONTEXT</a></p>

<p><a href="scsiportnotification" title="SCSIPORT_API VOID ScsiPortNotification(&#10;  SCSI_NOTIFICATION_TYPE NotificationType,&#10;  PVOID                  HwDeviceExtension,&#10;  ...                    &#10;);">ScsiPortNotification</a></p>

<p><a href="scsiportwmigetreturnsize" title="void ScsiPortWmiGetReturnSize(&#10;  RequestContext&#10;);">ScsiPortWmiGetReturnSize</a></p>

<p><a href="scsiportwmigetreturnstatus" title="void ScsiPortWmiGetReturnStatus(&#10;  RequestContext&#10;);">ScsiPortWmiGetReturnStatus</a></p>

<p><a href="scsiportwmipostprocess" title="VOID ScsiPortWmiPostProcess(&#10;  [in] PSCSIWMI_REQUEST_CONTEXT RequestContext,&#10;  [in] UCHAR                    SrbStatus,&#10;  [in] ULONG                    BufferUsed&#10;);">ScsiPortWmiPostProcess</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/scsiwmi/nf-scsiwmi-scsiportwmidispatchfunction">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/scsiwmi/nf-scsiwmi-scsiportwmidispatchfunction.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
