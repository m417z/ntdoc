<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PROTOCOL_CL_REGISTER_SAP_COMPLETE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PROTOCOL_CL_REGISTER_SAP_COMPLETE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PROTOCOL_CL_REGISTER_SAP_COMPLETE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PROTOCOL_CL_REGISTER_SAP_COMPLETE ProtocolClRegisterSapComplete;

VOID ProtocolClRegisterSapComplete(
  [in] NDIS_STATUS Status,
  [in] NDIS_HANDLE ProtocolSapContext,
  [in] PCO_SAP Sap,
  [in] NDIS_HANDLE NdisSapHandle
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_register_sap_complete">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/protocol_cl_register_sap_complete.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-protocol_cl_register_sap_complete)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="protocol_cl_register_sap_complete-callback-function">PROTOCOL_CL_REGISTER_SAP_COMPLETE callback function</h1>

<h2 id="description">Description</h2>

<p>A connection-oriented NDIS client that accepts incoming calls must have
a <em>ProtocolClRegisterSapComplete</em> function to complete the asynchronous operations that it initiates
with
<a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a>. Otherwise, such a
protocol driver's registered
<em>ProtocolClRegisterSapComplete</em> function can simply return control.</p>

<p><strong>Note</strong> You must declare the function by using the <strong>PROTOCOL_CL_REGISTER_SAP_COMPLETE</strong> type.
For more information, see the following Examples section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="status-in"><code>Status</code> [in]</h3>

<p>Specifies the final status of the client's call to
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong>, which can be one of the following:</p>

<h4 id="ndis_status_success">NDIS_STATUS_SUCCESS</h4>

<p>The SAP has been registered both with NDIS and the call manager, which will subsequently call
<a href="ndiscmdispatchincomingcall" title="NDIS_STATUS NdisCmDispatchIncomingCall(&#10;  [in] NDIS_HANDLE         NdisSapHandle,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisCmDispatchIncomingCall</a> whenever it receives an incoming call offer directed to the given
SAP, thereby causing NDIS to call the client's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_call">ProtocolClIncomingCall</a> function.</p>

<h4 id="ndis_status_resources">NDIS_STATUS_RESOURCES</h4>

<p>NDIS or the call manager could not allocate and/or initialize necessary resources to register
and maintain the SAP.</p>

<h4 id="ndis_status_invalid_data">NDIS_STATUS_INVALID_DATA</h4>

<p>The client supplied an invalid specification at
<em>Sap</em> to NDIS, which it forwarded to the call manager's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_reg_sap">ProtocolCmRegisterSap</a> function
for validation.</p>

<h4 id="ndis_status_xxx">NDIS_STATUS_XXX</h4>

<p>The call manager encountered an error in attempting to register the given SAP and NDIS
propagated this CM-determined failure status to the client.</p>

<h3 id="protocolsapcontext-in"><code>ProtocolSapContext</code> [in]</h3>

<p>Specifies the handle to the client's per-SAP context area, which the client originally supplied to
NDIS when it called
<a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a>. If the registration
is successful, NDIS retains this context handle and uses it subsequently in calls to the client's
<em>ProtocolClIncomingCall</em> function pertaining to this SAP.</p>

<h3 id="sap-in"><code>Sap</code> [in]</h3>

<p>Pointer to the client-allocated buffer containing the specification for the SAP to be opened. The
client originally passed this pointer to
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong>.</p>

<h3 id="ndissaphandle-in"><code>NdisSapHandle</code> [in]</h3>

<p>If
<em>Status</em> is NDIS_STATUS_SUCCESS, specifies an NDIS-supplied valid handle to this registered SAP,
effectively an association established with NDIS between the client and a particular call manager for
the client-specified SAP. Otherwise, this parameter is <strong>NULL</strong>. The client must save a valid handle,
preferably in its
<em>ProtocolSapContext</em> area, for an eventual call to
<a href="ndisclderegistersap" title="NDIS_STATUS NdisClDeregisterSap(&#10;  [in] NDIS_HANDLE NdisSapHandle&#10;);">NdisClDeregisterSap</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>NDIS calls
<em>ProtocolClRegisterSapComplete</em> to indicate that the client's previous call to
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong> has been processed by NDIS and, if NDIS did not fail the call, by the call
manager with which the client shares the
<em>NdisAfHandle</em> that it passed to
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong>.</p>

<p>To receive incoming calls through a connection-oriented NIC, a client's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_af_register_notify">ProtocolCoAfRegisterNotify</a> or
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_open_af_complete_ex">ProtocolClOpenAfCompleteEx</a> function usually registers one or more SAPs with the call manager.</p>

<p>To register each SAP, the client calls
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong>, passing in the
<em>NdisAfHandle</em> that identifies the call manager from which the client wants to receive notifications
of incoming calls, and NDIS returns the client an
<em>NdisSapHandle</em> to the registered SAP if the client's call to
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong> succeeds.
<em>ProtocolClRegisterSapComplete</em> must save each valid
<em>NdisSapHandle</em>, usually in the client's per-SAP
<em>ProtocolSapContext</em> area so it can release the SAP later with
<a href="ndisclderegistersap" title="NDIS_STATUS NdisClDeregisterSap(&#10;  [in] NDIS_HANDLE NdisSapHandle&#10;);">NdisClDeregisterSap</a>.</p>

<p>The format of a SAP is specific to the call manager. If the call manager does not recognize the SAP
that the client is attempting to register or if the specified SAP is already in use, the call manager can
fail the SAP registration.
<em>ProtocolClRegisterSapComplete</em> should check the input
<em>Status</em> for NDIS_STATUS_SUCCESS before proceeding further. If the attempt to register the SAP failed,
<em>ProtocolClRegisterSapComplete</em> can either release the per-SAP context area and buffer at
<em>Sap</em> that the client allocated or prepare them for reuse in another call to
<strong><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></strong>.</p>

<p>A client can receive incoming calls on a SAP even while SAP registration is still pending, that is,
before its
<em>ProtocolClRegisterSapComplete</em> function is called.</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>ProtocolClRegisterSapComplete</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>ProtocolClRegisterSapComplete</em> function that is named "MyClRegisterSapComplete", use the <strong>PROTOCOL_CL_REGISTER_SAP_COMPLETE</strong> type as shown in this code example:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>PROTOCOL_CL_REGISTER_SAP_COMPLETE MyClRegisterSapComplete;
</code></pre>

<p>Then, implement your function as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>_Use_decl_annotations_
VOID
 MyClRegisterSapComplete(
    NDIS_STATUS  Status,
    NDIS_HANDLE  ProtocolSapContext,
    PCO_SAP  Sap,
    NDIS_HANDLE  NdisSapHandle
    )
  {...}
</code></pre>

<p>The <strong>PROTOCOL_CL_REGISTER_SAP_COMPLETE</strong> function type is defined in the Ndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the <em>Use_decl_annotations</em> annotation to your function definition. The <em>Use_decl_annotations</em> annotation ensures that the annotations that are applied to the <strong>PROTOCOL_CL_REGISTER_SAP_COMPLETE</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about <em>Use_decl_annotations</em>, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="ndisclderegistersap" title="NDIS_STATUS NdisClDeregisterSap(&#10;  [in] NDIS_HANDLE NdisSapHandle&#10;);">NdisClDeregisterSap</a></p>

<p><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></p>

<p><a href="ndiscmdispatchincomingcall" title="NDIS_STATUS NdisCmDispatchIncomingCall(&#10;  [in] NDIS_HANDLE         NdisSapHandle,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisCmDispatchIncomingCall</a></p>

<p><a href="ndiscmregistersapcomplete" title="VOID NdisCmRegisterSapComplete(&#10;  [in] NDIS_STATUS Status,&#10;  [in] NDIS_HANDLE NdisSapHandle,&#10;  [in] NDIS_HANDLE CallMgrSapContext&#10;);">NdisCmRegisterSapComplete</a></p>

<p><a href="ndisfreememory" title="VOID NdisFreeMemory(&#10;  [in] PVOID VirtualAddress,&#10;  [in] UINT  Length,&#10;  [in] UINT  MemoryFlags&#10;);">NdisFreeMemory</a></p>

<p><a href="ndisfreetonpagedlookasidelist" title="void NdisFreeToNPagedLookasideList(&#10;  _L,&#10;  _E&#10;);">NdisFreeToNPagedLookasideList</a></p>

<p><a href="ndismcmdispatchincomingcall" title="void NdisMCmDispatchIncomingCall(&#10;  _SH_,&#10;  _VH_,&#10;  _CP_&#10;);">NdisMCmDispatchIncomingCall</a></p>

<p><a href="ndismcmregistersapcomplete" title="void NdisMCmRegisterSapComplete(&#10;  _S_,&#10;  _H_,&#10;  _C_&#10;);">NdisMCmRegisterSapComplete</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_call">ProtocolClIncomingCall</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_open_af_complete_ex">ProtocolClOpenAfCompleteEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_reg_sap">ProtocolCmRegisterSap</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_af_register_notify">ProtocolCoAfRegisterNotify</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_register_sap_complete">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-protocol_cl_register_sap_complete.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
