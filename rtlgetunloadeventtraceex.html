<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlGetUnloadEventTraceEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlGetUnloadEventTraceEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlGetUnloadEventTraceEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTRTL_H

</span><span class="ntdoc-code-intro">/**
 * The RtlGetUnloadEventTraceEx routine retrieves the size and location of the dynamically unloaded module list for the current process.
 *
 * \param ElementSize A pointer to a variable that contains the size of an element in the list.
 * \param ElementCount A pointer to a variable that contains the number of elements in the list.
 * \param EventTrace A pointer to an array of <a href="rtl_unload_event_trace" title="typedef struct _RTL_UNLOAD_EVENT_TRACE&#10;{&#10;    PVOID BaseAddress;   // Base address of dll&#10;    SIZE_T SizeOfImage;  // Size of image&#10;    ULONG Sequence;      // Sequence number for this event&#10;    ULONG TimeDateStamp; // Time and date of image&#10;    ULONG CheckSum;      // Image checksum&#10;    WCHAR ImageName[32]; // Image name&#10;    ULONG Version[2];&#10;} RTL_UNLOAD_EVENT_TRACE, *PRTL_UNLOAD_EVENT_TRACE;">RTL_UNLOAD_EVENT_TRACE</a> structures.
 * \return A pointer to an array of unload events.
 * \sa https://learn.microsoft.com/en-us/windows/win32/devnotes/rtlgetunloadeventtraceex
 */
</span><span class="ntdoc-code-body">NTSYSAPI
<a href="rtl_unload_event_trace" title="typedef struct _RTL_UNLOAD_EVENT_TRACE&#10;{&#10;    PVOID BaseAddress;   // Base address of dll&#10;    SIZE_T SizeOfImage;  // Size of image&#10;    ULONG Sequence;      // Sequence number for this event&#10;    ULONG TimeDateStamp; // Time and date of image&#10;    ULONG CheckSum;      // Image checksum&#10;    WCHAR ImageName[32]; // Image name&#10;    ULONG Version[2];&#10;} RTL_UNLOAD_EVENT_TRACE, *PRTL_UNLOAD_EVENT_TRACE;">PRTL_UNLOAD_EVENT_TRACE</a>
NTAPI
RtlGetUnloadEventTraceEx(
    _Out_ PULONG *ElementSize,
    _Out_ PULONG *ElementCount,
    _Out_ PVOID *EventTrace // works across all processes
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/78124af1f54187762af94ebc9aab9a9818a53adf/phnt/include/ntrtl.h#L10793">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header"></span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID WINAPI RtlGetUnloadEventTraceEx(
  _Out_ PULONG *ElementSize,
  _Out_ PULONG *ElementCount,
  _Out_ PVOID  *EventTrace
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/rtlgetunloadeventtraceex">View the official Win32 development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows/win32/devnotes/rtlgetunloadeventtraceex">documented in Windows SDK</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlgetunloadeventtraceex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 development documentation (rtlgetunloadeventtraceex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rtlgetunloadeventtraceex-function">RtlGetUnloadEventTraceEx function</h1>

<p>Retrieves the size and location of the dynamically unloaded module list for the current process.</p>

<h2 id="parameters">Parameters</h2>

<p><em>ElementSize</em> [out]</p>

<p>A pointer to a variable that contains the size of an element in the list.</p>

<p><em>ElementCount</em> [out]</p>

<p>A pointer to a variable that contains the number of elements in the list.</p>

<p><em>EventTrace</em> [out]</p>

<p>A pointer to an array of <strong><a href="rtl_unload_event_trace" title="typedef struct _RTL_UNLOAD_EVENT_TRACE&#10;{&#10;    PVOID BaseAddress;   // Base address of dll&#10;    SIZE_T SizeOfImage;  // Size of image&#10;    ULONG Sequence;      // Sequence number for this event&#10;    ULONG TimeDateStamp; // Time and date of image&#10;    ULONG CheckSum;      // Image checksum&#10;    WCHAR ImageName[32]; // Image name&#10;    ULONG Version[2];&#10;} RTL_UNLOAD_EVENT_TRACE, *PRTL_UNLOAD_EVENT_TRACE;">RTL_UNLOAD_EVENT_TRACE</a></strong> structures. For more information, see Remarks.</p>

<h2 id="return-value">Return value</h2>

<p>This function does not return a value.</p>

<h2 id="remarks">Remarks</h2>

<p>The loader stores unloaded event information in locations that can be read across processes by taking advantage of the fact that Ntdll.dll is loaded at the same base address in all processes. When a debugger needs to query unloaded module information, it calls this function to determine the address at which the variables reside, then queries the virtual memory in the target process at those addresses to read the actual values.</p>

<p>Each element in the list is defined as follows.</p>

<p><!-- CODE_MARKER --></p>

<pre><code>typedef <a href="rtl_unload_event_trace" title="typedef struct _RTL_UNLOAD_EVENT_TRACE&#10;{&#10;    PVOID BaseAddress;   // Base address of dll&#10;    SIZE_T SizeOfImage;  // Size of image&#10;    ULONG Sequence;      // Sequence number for this event&#10;    ULONG TimeDateStamp; // Time and date of image&#10;    ULONG CheckSum;      // Image checksum&#10;    WCHAR ImageName[32]; // Image name&#10;    ULONG Version[2];&#10;} RTL_UNLOAD_EVENT_TRACE, *PRTL_UNLOAD_EVENT_TRACE;">struct _RTL_UNLOAD_EVENT_TRACE</a> {
    PVOID BaseAddress;   // Base address of dll
    <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> SizeOfImage;  // Size of image
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Sequence;      // Sequence number for this event
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TimeDateStamp; // Time and date of image
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> CheckSum;      // Image checksum
    WCHAR ImageName[32]; // Image name
} <a href="rtl_unload_event_trace" title="typedef struct _RTL_UNLOAD_EVENT_TRACE&#10;{&#10;    PVOID BaseAddress;   // Base address of dll&#10;    SIZE_T SizeOfImage;  // Size of image&#10;    ULONG Sequence;      // Sequence number for this event&#10;    ULONG TimeDateStamp; // Time and date of image&#10;    ULONG CheckSum;      // Image checksum&#10;    WCHAR ImageName[32]; // Image name&#10;    ULONG Version[2];&#10;} RTL_UNLOAD_EVENT_TRACE, *PRTL_UNLOAD_EVENT_TRACE;">RTL_UNLOAD_EVENT_TRACE</a>, *<a href="rtl_unload_event_trace" title="typedef struct _RTL_UNLOAD_EVENT_TRACE&#10;{&#10;    PVOID BaseAddress;   // Base address of dll&#10;    SIZE_T SizeOfImage;  // Size of image&#10;    ULONG Sequence;      // Sequence number for this event&#10;    ULONG TimeDateStamp; // Time and date of image&#10;    ULONG CheckSum;      // Image checksum&#10;    WCHAR ImageName[32]; // Image name&#10;    ULONG Version[2];&#10;} RTL_UNLOAD_EVENT_TRACE, *PRTL_UNLOAD_EVENT_TRACE;">PRTL_UNLOAD_EVENT_TRACE</a>;
</code></pre>

<p>This function has no associated header file. The associated import library, Ntdll.lib, is available in the Windows Driver Kit (WDK). You can also call this function using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress"><strong>GetProcAddress</strong></a> functions.</p>

<h2 id="requirements">Requirements</h2>

<table>
<thead>
<tr>
  <th>Requirement</th>
  <th>Value</th>
</tr>
</thead>
<tbody>
<tr>
  <td>DLL<br></td>
  <td>Ntdll.dll</td>
</tr>
</tbody>
</table>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/devnotes/rtlgetunloadeventtraceex">View the official Win32 development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/win32/blob/docs/desktop-src/DevNotes/rtlgetunloadeventtraceex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
