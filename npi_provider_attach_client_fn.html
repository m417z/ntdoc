<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NPI_PROVIDER_ATTACH_CLIENT_FN - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NPI_PROVIDER_ATTACH_CLIENT_FN - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NPI_PROVIDER_ATTACH_CLIENT_FN - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// netioddk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NPI_PROVIDER_ATTACH_CLIENT_FN NpiProviderAttachClientFn;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NpiProviderAttachClientFn(
  [in]  HANDLE NmrBindingHandle,
  [in]  PVOID ProviderContext,
  [in]  PNPI_REGISTRATION_INSTANCE ClientRegistrationInstance,
  [in]  PVOID ClientBindingContext,
  [in]  const VOID *ClientDispatch,
  [out] PVOID *ProviderBindingContext,
  [out] const VOID **ProviderDispatch
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netioddk/nc-netioddk-npi_provider_attach_client_fn">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/npi_provider_attach_client_fn.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-netioddk-npi_provider_attach_client_fn)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="npi_provider_attach_client_fn-callback-function">NPI_PROVIDER_ATTACH_CLIENT_FN callback function</h1>

<h2 id="description">Description</h2>

<p>A provider module's
<em>ProviderAttachClient</em> callback function attaches the provider module to a client module.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="nmrbindinghandle-in"><code>NmrBindingHandle</code> [in]</h3>

<p>A handle used by the NMR to represent the binding between the client module and the provider
module.</p>

<h3 id="providercontext-in"><code>ProviderContext</code> [in]</h3>

<p>A pointer to the provider module's registration context. The provider module passes this pointer
to the NMR when it calls the
<a href="nmrregisterprovider" title="NTSTATUS NmrRegisterProvider(&#10;  [in]  PNPI_PROVIDER_CHARACTERISTICS ProviderCharacteristics,&#10;  [in]  __drv_aliasesMem PVOID        ProviderContext,&#10;  [out] PHANDLE                       NmrProviderHandle&#10;);">NmrRegisterProvider</a> function to
register itself with the NMR.</p>

<h3 id="clientregistrationinstance-in"><code>ClientRegistrationInstance</code> [in]</h3>

<p>A pointer to an
<a href="npi_registration_instance" title="typedef struct _NPI_REGISTRATION_INSTANCE {&#10;  USHORT        Version;&#10;  USHORT        Size;&#10;  PNPIID        NpiId;&#10;  PNPI_MODULEID ModuleId;&#10;  ULONG         Number;&#10;  const VOID    *NpiSpecificCharacteristics;&#10;} NPI_REGISTRATION_INSTANCE;">NPI_REGISTRATION_INSTANCE</a> structure. This structure contains the client module's registration
data.</p>

<h3 id="clientbindingcontext-in"><code>ClientBindingContext</code> [in]</h3>

<p>A pointer to the client module's context for the binding between the client module and the
provider module. The client module uses this context to keep track of the state of the binding. The
contents of the client module's binding context are opaque to the provider module. The provider module
passes this pointer to the client module whenever it calls any of the client module's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-programming-interface">NPI</a> callback functions that
require the client module's binding context.</p>

<h3 id="clientdispatch-in"><code>ClientDispatch</code> [in]</h3>

<p>A pointer to a constant structure that contains the dispatch table of
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-programming-interface">NPI</a> callback functions for the
client module. The contents of the structure are
NPI-specific. If the
NPI does not define a client
dispatch table structure, then this pointer is <strong>NULL</strong>.</p>

<h3 id="providerbindingcontext-out"><code>ProviderBindingContext</code> [out]</h3>

<p>A pointer to a variable into which the provider module will store a pointer to its context for the
binding between the client module and the provider module. The provider module uses this context to keep
track of the state of the binding. The contents of the provider module's binding context are opaque to
the client module. The client module passes this pointer to the provider module whenever it calls one of
the provider module's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-programming-interface">NPI</a> functions that require the
provider module's binding context. The provider module must make sure that this context remains valid
and resident in memory as long as the client module is attached to the provider module.</p>

<h3 id="providerdispatch-out"><code>ProviderDispatch</code> [out]</h3>

<p>A pointer to a variable into which the provider module will store a pointer to a constant
structure that contains the dispatch table of
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-programming-interface">NPI</a> functions for the provider
module. The provider module must make sure that this structure remains valid and resident in memory as
long as the client module is attached to the provider module. The contents of the structure are
NPI-specific.</p>

<h2 id="return-value">Return value</h2>

<p>A provider module's
<em>ProviderAttachClient</em> callback function returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The provider module successfully attached to the client module.</td>
</tr>
<tr>
  <td><strong>STATUS_NOINTERFACE</strong></td>
  <td>The provider module did not attach to the client module.</td>
</tr>
<tr>
  <td><strong>Other status codes</strong></td>
  <td>An error occurred.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The NMR calls a provider module's
<em>ProviderAttachClient</em> callback function whenever a client module calls the
<a href="nmrclientattachprovider" title="NTSTATUS NmrClientAttachProvider(&#10;  [in]  HANDLE                 NmrBindingHandle,&#10;  [in]  __drv_aliasesMem PVOID ClientBindingContext,&#10;  [in]  const VOID             *ClientDispatch,&#10;  [out] PVOID                  *ProviderBindingContext,&#10;  [out] const VOID             **ProviderDispatch&#10;);">NmrClientAttachProvider</a> function
with a handle that represents a binding between the client module and the provider module.</p>

<p>A provider module can examine the client module's registration data. This data is in the structure
pointed to by the
<em>ClientRegistrationInstance</em> parameter. The provider module uses this data to determine whether it
will attach to the client module:</p>

<ul>
<li>If the provider module determines that it will attach to the client module, then the
<em>ProviderAttachClient</em> callback function must do the following:
<ol>
<li>Save the pointers passed in the
<em>ClientBindingContext</em> and
<em>ClientDispatch</em> parameters so that the provider module can make calls to the client module's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-programming-interface">NPI</a> functions.</li>
<li>Save the handle passed in the
<em>NmrBindingHandle</em> parameter. The provider module passes this handle as a parameter to the
<a href="nmrproviderdetachclientcomplete" title="VOID NmrProviderDetachClientComplete(&#10;  [in] HANDLE NmrBindingHandle&#10;);">NmrProviderDetachClientComplete</a> function when it detaches from the client module.</li>
<li>Set the
<em>ProviderBindingContext</em> parameter to point to the provider module's binding context structure for
the binding between the client module and the provider module.</li>
<li>Set the
<em>ProviderDispatch</em> parameter to point to a structure that contains the provider module's dispatch
table of
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/network-programming-interface">NPI</a> functions.</li>
<li>Return <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>.</li>
</ol></li>
<li>If the provider module determines that it will not attach to the client module, then the
<em>ProviderAttachClient</em> callback function must return STATUS_NOINTERFACE.</li>
</ul>

<p>If the provider module attaches to the client module and it dynamically allocated memory for its
binding context, it should free that allocated memory when the NMR calls the provider module's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netioddk/nc-netioddk-npi_provider_cleanup_binding_context_fn">ProviderCleanupBindingContext</a> callback function after the client module and provider module are
detached from each other.</p>

<p>The NMR calls a provider module's
<em>ProviderAttachClient</em> callback function at IRQL = PASSIVE_LEVEL.</p>

<h2 id="see-also">See also</h2>

<p><a href="npi_provider_characteristics" title="typedef struct _NPI_PROVIDER_CHARACTERISTICS {&#10;  USHORT                                   Version;&#10;  USHORT                                   Length;&#10;  PNPI_PROVIDER_ATTACH_CLIENT_FN           ProviderAttachClient;&#10;  PNPI_PROVIDER_DETACH_CLIENT_FN           ProviderDetachClient;&#10;  PNPI_PROVIDER_CLEANUP_BINDING_CONTEXT_FN ProviderCleanupBindingContext;&#10;  NPI_REGISTRATION_INSTANCE                ProviderRegistrationInstance;&#10;} NPI_PROVIDER_CHARACTERISTICS;">NPI_PROVIDER_CHARACTERISTICS</a></p>

<p><a href="npi_registration_instance" title="typedef struct _NPI_REGISTRATION_INSTANCE {&#10;  USHORT        Version;&#10;  USHORT        Size;&#10;  PNPIID        NpiId;&#10;  PNPI_MODULEID ModuleId;&#10;  ULONG         Number;&#10;  const VOID    *NpiSpecificCharacteristics;&#10;} NPI_REGISTRATION_INSTANCE;">NPI_REGISTRATION_INSTANCE</a></p>

<p><a href="nmrclientattachprovider" title="NTSTATUS NmrClientAttachProvider(&#10;  [in]  HANDLE                 NmrBindingHandle,&#10;  [in]  __drv_aliasesMem PVOID ClientBindingContext,&#10;  [in]  const VOID             *ClientDispatch,&#10;  [out] PVOID                  *ProviderBindingContext,&#10;  [out] const VOID             **ProviderDispatch&#10;);">NmrClientAttachProvider</a></p>

<p><a href="nmrproviderdetachclientcomplete" title="VOID NmrProviderDetachClientComplete(&#10;  [in] HANDLE NmrBindingHandle&#10;);">NmrProviderDetachClientComplete</a></p>

<p><a href="nmrregisterprovider" title="NTSTATUS NmrRegisterProvider(&#10;  [in]  PNPI_PROVIDER_CHARACTERISTICS ProviderCharacteristics,&#10;  [in]  __drv_aliasesMem PVOID        ProviderContext,&#10;  [out] PHANDLE                       NmrProviderHandle&#10;);">NmrRegisterProvider</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netioddk/nc-netioddk-npi_provider_cleanup_binding_context_fn">ProviderCleanupBindingContext</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netioddk/nc-netioddk-npi_provider_detach_client_fn">ProviderDetachClient</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netioddk/nc-netioddk-npi_provider_attach_client_fn">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/netioddk/nc-netioddk-npi_provider_attach_client_fn.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
