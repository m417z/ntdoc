<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_NFCSE_HCE_REMOTE_RECV - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_NFCSE_HCE_REMOTE_RECV - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_NFCSE_HCE_REMOTE_RECV - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// nfcsedev.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0022, 0x250, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_NFCSE_HCE_REMOTE_RECV 0x00220940</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/nfcsedev/ni-nfcsedev-ioctl_nfcse_hce_remote_recv">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_nfcse_hce_remote_recv.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-nfcsedev-ioctl_nfcse_hce_remote_recv)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_nfcse_hce_remote_recv-ioctl">IOCTL_NFCSE_HCE_REMOTE_RECV IOCTL</h1>

<h2 id="description">Description</h2>

<p>Either returns the next data buffer available, or if there are no more buffered data, the request shall stay pending until an APDU buffer is available for reading. The data buffer shall then be returned to the caller. Note that the caller must allocate an output buffer large enough to hold the largest APDU that has been received + 4 bytes overhead.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>None</p>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>None</p>

<h3 id="output-buffer">Output buffer</h3>

<p>A <strong><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></strong> indicating the size of the <a rel="noopener" target="_blank" href="secure_element_hce_data_packet">SECURE_ELEMENT_HCE_DATA_PACKET</a> structure plus its payload, immediately followed by the <strong><a href="secure_element_hce_data_packet" title="typedef struct _SECURE_ELEMENT_HCE_DATA_PACKET {&#10;  USHORT bConnectionId;&#10;  USHORT cbPayload;&#10;  BYTE   pbPayload[ANYSIZE_ARRAY];&#10;} SECURE_ELEMENT_HCE_DATA_PACKET, *PSECURE_ELEMENT_HCE_DATA_PACKET;">SECURE_ELEMENT_HCE_DATA_PACKET</a></strong> structure itself.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p><strong>Irp->IoStatus.Status</strong> is set to <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> if the request is successful. Possible error codes are:</p>

<table>
<thead>
<tr>
  <th>Return Code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_BUFFER_OVERFLOW</strong></td>
  <td>The buffer supplied was too small to receive the notification, the first <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> will contain the expected buffer size.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>If the input buffer is non-zero.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_DEVICE_STATE</strong></td>
  <td>If the IOCTL is sent on a handle other than with the relative name 'SEManage'.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The following are requirements that the driver must adhere to.</p>

<ul>
<li>This IOCTL is sent on an existing connection after HCE Activated event is triggered.</li>
<li>The driver must support CancelIo on this pended IOCTL.</li>
<li>The driver must maintain a “Received” queue of the received APDU for the current connection.</li>
<li>When this IOCTL is received in the driver:
<ul>
<li>If the “Received” queue is empty, then the driver MUST pend the IOCTL for later completion.</li>
<li>If the “Received” queue is non-empty, then the driver MUST de-queue one APDU, copy the APDU buffer to the IOCTL’s output buffer, and complete the IOCTL with <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> immediately.</li>
</ul></li>
<li>If the driver completes this IOCTL with <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, the first <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> [4 bytes] of the output buffer MUST contain the size of the <a href="secure_element_hce_data_packet" title="typedef struct _SECURE_ELEMENT_HCE_DATA_PACKET {&#10;  USHORT bConnectionId;&#10;  USHORT cbPayload;&#10;  BYTE   pbPayload[ANYSIZE_ARRAY];&#10;} SECURE_ELEMENT_HCE_DATA_PACKET, *PSECURE_ELEMENT_HCE_DATA_PACKET;">SECURE_ELEMENT_HCE_DATA_PACKET</a> structure plus its payload.</li>
<li>If a received APDU data is too large to be copied into this IOCTL's output buffer, the driver MUST copy the required buffer size into the first 4 bytes of the output buffer, set the IOCTL's information field to sizeof(<a href="dword" title="typedef unsigned long DWORD;">DWORD</a>), and complete the IOCTL with STATUS_BUFFER_OVERFLOW. The APDU data must be left in the "Received" queue.</li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/nfcsedev/ni-nfcsedev-ioctl_nfcse_hce_remote_recv">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/nfcsedev/ni-nfcsedev-ioctl_nfcse_hce_remote_recv.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
