<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="StorPortAllocateDmaMemory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>StorPortAllocateDmaMemory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            StorPortAllocateDmaMemory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// storport.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> StorPortAllocateDmaMemory(
  [in]           PVOID               HwDeviceExtension,
  [in]           <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>              NumberOfBytes,
  [in]           <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a>    LowestAcceptableAddress,
  [in]           <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a>    HighestAcceptableAddress,
  [in, optional] <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a>    BoundaryAddressMultiple,
  [in]           <a href="memory_caching_type" title="typedef enum _MEMORY_CACHING_TYPE {&#10;  MmNonCached,&#10;  MmCached,&#10;  MmWriteCombined,&#10;  MmHardwareCoherentCached,&#10;  MmNonCachedUnordered,&#10;  MmUSWCCached,&#10;  MmMaximumCacheType,&#10;  MmNotMapped&#10;} MEMORY_CACHING_TYPE;">MEMORY_CACHING_TYPE</a> CacheType,
  [in]           NODE_REQUIREMENT    PreferredNode,
  [out]          PVOID               *BufferPointer,
  [out]          <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PPHYSICAL_ADDRESS</a>   PhysicalAddress
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nf-storport-storportallocatedmamemory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/storportallocatedmamemory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-storport-storportallocatedmamemory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="storportallocatedmamemory-function">StorPortAllocateDmaMemory function</h1>

<h2 id="description">Description</h2>

<p>This function is the extended version of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nf-storport-storportallocatecontiguousmemoryspecifycachenode">StorPortAllocateContiguousMemorySpecifyCacheNode function</a>. It allocates a range of physically contiguous noncached, nonpaged memory, and returns the physical address of the allocated buffer.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hwdeviceextension-in"><code>HwDeviceExtension</code> [in]</h3>

<p>A pointer to the hardware device extension for the host bus adapter (HBA).</p>

<h3 id="numberofbytes-in"><code>NumberOfBytes</code> [in]</h3>

<p>The number of bytes to allocate.</p>

<h3 id="lowestacceptableaddress-in"><code>LowestAcceptableAddress</code> [in]</h3>

<p>The lowest physical address that is valid for the allocation. For example, if the device can only reference physical memory in the 8 MB to 16 MB range, this value would be set to 0x800000 (8 MB).</p>

<h3 id="highestacceptableaddress-in"><code>HighestAcceptableAddress</code> [in]</h3>

<p>The highest physical address that is valid for the allocation. For example, if the device can only reference physical memory below 16 MB, this value would be set to 0xFFFFFF (16 MB - 1).</p>

<h3 id="boundaryaddressmultiple-in-optional"><code>BoundaryAddressMultiple</code> [in, optional]</h3>

<p>The physical address multiple that this allocation must not cross.</p>

<h3 id="cachetype-in"><code>CacheType</code> [in]</h3>

<p>The desired cache type for the mapping.</p>

<h3 id="preferrednode-in"><code>PreferredNode</code> [in]</h3>

<p>The preferred node from which the allocation should be made if pages are available on that node.</p>

<h3 id="bufferpointer-out"><code>BufferPointer</code> [out]</h3>

<p>The variable that receives the starting address of the allocated memory block. Upon return from this routine, if this variable is zero, a contiguous range could not be found to satisfy the request. If this variable is not NULL, it contains a pointer (for example, a virtual address in the nonpaged portion of the system) to the allocated physically contiguous memory.</p>

<h3 id="physicaladdress-out"><code>PhysicalAddress</code> [out]</h3>

<p>Physical address of the allocated memory block.</p>

<h2 id="return-value">Return value</h2>

<p>This function returns a STOR_STATUS code.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STOR_STATUS_NOT_IMPLEMENTED</td>
  <td>This function is not implemented on the active operating system.</td>
</tr>
<tr>
  <td>STOR_STATUS_SUCCESS</td>
  <td>The operation was successful.</td>
</tr>
<tr>
  <td>STOR_STATUS_INSUFFICIENT_RESOURCES</td>
  <td>The operation failed to allocate the requested memory because of insufficient resources.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>If the request fails, BufferPointer will be set to NULL.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="storportfreedmamemory" title="ULONG StorPortFreeDmaMemory(&#10;  [in]     PVOID               HwDeviceExtension,&#10;  [in]     PVOID               BaseAddress,&#10;  [in]     SIZE_T              NumberOfBytes,&#10;  [in]     MEMORY_CACHING_TYPE CacheType,&#10;  [in_opt] PHYSICAL_ADDRESS    PhysicalAddress&#10;);">StorPortFreeDmaMemory</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/storport/nf-storport-storportallocatedmamemory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/storport/nf-storport-storportallocatedmamemory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
