<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ehstorioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x002d, 0x504, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS 0x002D1410</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_device_enumerate_pdos">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_ehstor_device_enumerate_pdos.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ehstorioctl-ioctl_ehstor_device_enumerate_pdos)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_ehstor_device_enumerate_pdos-ioctl">IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS IOCTL</h1>

<h2 id="description">Description</h2>

<p>This IOCTL returns a result set containing the enumeration of all active storage Physical Device Objects (PDOs) associated with the given Addressable Command Target (ACT). The client may first probe for the required buffer size by issuing this IOCTL in the following manner:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>DeviceIoControl(
    hDevice,
    IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS,
    &amp;pdoType,
    sizeof(<a href="pdo_type" title="typedef enum _PDO_TYPE {&#10;  PDO_TYPE_UNDEFINED,&#10;  PDO_TYPE_DISK,&#10;  PDO_TYPE_CONTROL,&#10;  PDO_TYPE_SILO,&#10;  PDO_TYPE_THIS&#10;} PDO_TYPE;">PDO_TYPE</a>),
    NULL,
    0,
    &amp;dwBytesRequired,
    NULL );
</code></pre>

<p>With the output buffer parameter set to <strong>NULL</strong>, the I/O manager clears the <a href="irp_input_operation" title="#define IRP_INPUT_OPERATION 0x00000040">IRP_INPUT_OPERATION</a> bit in the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> flags. Upon detecting this, the storage silo driver can safely set IoStatus.Information to the required buffer size, thus indicating it to the client.</p>

<p>This only works because STATUS_BUFFER_OVERFLOW (0x80000005) is an <a href="nt_warning" title="#define NT_WARNING(Status) ((((ULONG)(Status)) &gt;&gt; 30) == 2)">NT_WARNING</a>() value for which I/O manager copies IoStatus.Information into the lpBytesReturned parameter, returning that value to the client.</p>

<p>Caution is required here because IOCTL_EHSTOR_DEVICE_ENUMERATE_PDOS is defined with METHOD_BUFFERED, therefore I/O manager will attempt to copy this number of bytes into the output buffer.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>The input buffer at Irp->AssociatedIrp.SystemBuffer must contain a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> value as defined in <a href="pdo_type" title="typedef enum _PDO_TYPE {&#10;  PDO_TYPE_UNDEFINED,&#10;  PDO_TYPE_DISK,&#10;  PDO_TYPE_CONTROL,&#10;  PDO_TYPE_SILO,&#10;  PDO_TYPE_THIS&#10;} PDO_TYPE;">PDO_TYPE</a>,</p>

<p>where either all of the PDOs, just the disk PDO, just the control PDO or all silo PDOs are enumerated respectively according to the provided <a href="pdo_type" title="typedef enum _PDO_TYPE {&#10;  PDO_TYPE_UNDEFINED,&#10;  PDO_TYPE_DISK,&#10;  PDO_TYPE_CONTROL,&#10;  PDO_TYPE_SILO,&#10;  PDO_TYPE_THIS&#10;} PDO_TYPE;">PDO_TYPE</a> input value.</p>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>The length of a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>Irp->AssociatedIrp.SystemBuffer points to the buffer that will receive the PDO enumeration results. If the client supplied a non-<strong>NULL</strong> buffer with the issued IOCTL, then the driver fills it with the result set only if the Parameters.DeviceIoControl.The return value is <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the buffer size is sufficient and the results have been copied to the buffer. Otherwise STATUS_INVALID_BUFFER_SIZE is returned and the output buffer is unmodified.</p>

<p>The returned enumeration buffer contains a result set structured according to the following rules. The leading structure in the buffer, <a href="enum_pdo_results" title="typedef struct _ENUM_PDO_RESULTS {&#10;  ULONG          cEntries;&#10;  ENUM_PDO_ENTRY rgEntries[ANYSIZE_ARRAY];&#10;} ENUM_PDO_RESULTS, *PENUM_PDO_RESULTS;">ENUM_PDO_RESULTS</a>, consists of a structure count and an array of <a href="enum_pdo_entry" title="typedef struct _ENUM_PDO_ENTRY {&#10;  UCHAR type;&#10;  UCHAR state;&#10;  UCHAR capabilities;&#10;  ULONG ulSTID;&#10;  UCHAR bSpecificationMajor;&#10;  UCHAR bSpecificationMinor;&#10;  UCHAR bImplementationMajor;&#10;  UCHAR bImplementationMinor;&#10;  WCHAR *wszDeviceInstancePath[(2  MAX_PATH)+ 1];&#10;} ENUM_PDO_ENTRY, *PENUM_PDO_ENTRY;">ENUM_PDO_ENTRY</a> structures.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p>OutputBufferLength indicates a buffer size of sufficient length to include the entire result set.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p>One of the following values may be returned in the Status field:</p>

<p><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> - The output buffer contains the enumeration of the requested PDOs.</p>

<p>STATUS_BUFFER_OVERFLOW - The Information field is set to the required buffer size to contain the entire enumeration result set output.</p>

<p>STATUS_INVALID_BUFFER_SIZE - The output buffer length supplied is insufficient to contain the entire enumeration result set output.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_device_enumerate_pdos">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_device_enumerate_pdos.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
