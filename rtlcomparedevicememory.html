<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlCompareDeviceMemory - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlCompareDeviceMemory - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlCompareDeviceMemory - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> RtlCompareDeviceMemory(
  [in] const VOID *Source1,
  [in] const VOID *Source2,
  [in] <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>     Length
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlcomparedevicememory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlcomparedevicememory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-rtlcomparedevicememory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>RtlCompareDeviceMemory</strong> function compares two blocks of device memory and returns the number of bytes that match until the first difference. This function is safe for use on device memory because it uses byte-level accesses that are guaranteed to be performed as specified.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="source1-in"><code>Source1</code> [in]</h3>

<p>A pointer to the first block of memory to compare.</p>

<h3 id="source2-in"><code>Source2</code> [in]</h3>

<p>A pointer to the second block of memory to compare.</p>

<h3 id="length-in"><code>Length</code> [in]</h3>

<p>The number of bytes to compare.</p>

<h2 id="return-value">Return value</h2>

<p><strong>RtlCompareDeviceMemory</strong> returns the number of bytes in the two blocks that match. If all bytes match up to the specified <strong>Length</strong> value, the <strong>Length</strong> value is returned.</p>

<h2 id="remarks">Remarks</h2>

<ul>
<li><p>The function isn't recognized as a compiler intrinsic so the compiler will never optimize away the call (either entirely or replace the call with an equivalent sequence of instructions). This differs from <strong><a href="rtlcomparememory" title="_Check_return_&#10;NTSYSAPI&#10;SIZE_T&#10;NTAPI&#10;RtlCompareMemory(&#10;    _In_ const VOID* Source1,&#10;    _In_ const VOID* Source2,&#10;    _In_ SIZE_T Length&#10;    );">RtlCompareMemory</a></strong> which is subject to various compiler optimizations.</p></li>
<li><p>The function uses byte-level accesses to ensure proper handling of device memory that may have side effects or special access requirements.</p></li>
<li><p>The routine starts by comparing the first byte in the first block to the first byte in the second block, and continues to compare successive bytes in the two blocks while the bytes match. The routine stops comparing bytes when it encounters the first pair of bytes that are not equal, or when the number of matching bytes equals the <strong>Length</strong> parameter value, whichever occurs first.</p></li>
<li><p>The function might perform unaligned memory accesses if the platform allows for it.</p></li>
</ul>

<p>This function works on all versions of Windows, not just the latest. You need to consume the latest WDK to get the function declaration from the wdm.h header. You also need the library (volatileaccessk.lib) from the latest WDK. However, the resulting driver will run fine on older versions of Windows.</p>

<h3 id="example">Example</h3>

<div class="codehilite">
<pre><span></span><code><span class="n"><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></span><span class="w"> </span><span class="n">DeviceBuffer1</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="n"><a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a></span><span class="w"> </span><span class="n">DeviceBuffer2</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

<span class="c1">// Read data from device memory into buffers</span>
<span class="n">ReadFromDevice</span><span class="p">(</span><span class="n">DeviceBuffer1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">DeviceBuffer1</span><span class="p">));</span>
<span class="n">ReadFromDevice</span><span class="p">(</span><span class="n">DeviceBuffer2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">DeviceBuffer2</span><span class="p">));</span>

<span class="c1">// Compare the device memory buffers</span>
<span class="kt"><a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a></span><span class="w"> </span><span class="n">matchingBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RtlCompareDeviceMemory</span><span class="p">(</span><span class="n">DeviceBuffer1</span><span class="p">,</span><span class="w"> </span><span class="n">DeviceBuffer2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">DeviceBuffer1</span><span class="p">));</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">matchingBytes</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">DeviceBuffer1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// All bytes matched</span>
<span class="w">    </span><span class="n"><a href="dbgprint" title="NTSYSAPI&#10;ULONG&#10;STDAPIVCALLTYPE&#10;DbgPrint(&#10;    _In_z_ _Printf_format_string_ PCCH Format,&#10;    ...&#10;    );">DbgPrint</a></span><span class="p">(</span><span class="s">&quot;Device buffers are identical</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Difference found at byte offset &#39;matchingBytes&#39;</span>
<span class="w">    </span><span class="n"><a href="dbgprint" title="NTSYSAPI&#10;ULONG&#10;STDAPIVCALLTYPE&#10;DbgPrint(&#10;    _In_z_ _Printf_format_string_ PCCH Format,&#10;    ...&#10;    );">DbgPrint</a></span><span class="p">(</span><span class="s">&quot;Device buffers differ starting at byte %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">matchingBytes</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><strong><a href="rtlcomparememory" title="_Check_return_&#10;NTSYSAPI&#10;SIZE_T&#10;NTAPI&#10;RtlCompareMemory(&#10;    _In_ const VOID* Source1,&#10;    _In_ const VOID* Source2,&#10;    _In_ SIZE_T Length&#10;    );">RtlCompareMemory</a></strong></p>

<p><strong><a href="rtlfillvolatilememory" title="volatile void * RtlFillVolatileMemory(&#10;  [out] volatile void *Destination,&#10;  [in]  size_t        Length,&#10;  [in]  int           Fill&#10;);">RtlFillVolatileMemory</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlcomparedevicememory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-rtlcomparedevicememory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
