<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ClfsCreateMarshallingArea - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ClfsCreateMarshallingArea - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ClfsCreateMarshallingArea - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">CLFSUSER_API <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ClfsCreateMarshallingArea(
  [in]           PLOG_FILE_OBJECT   plfoLog,
  [in]           <a href="pool_type" title="typedef enum _POOL_TYPE {&#10;    NonPagedPool,&#10;    NonPagedPoolExecute = NonPagedPool,&#10;    PagedPool,&#10;    NonPagedPoolMustSucceed = NonPagedPool + 2,&#10;    DontUseThisType,&#10;    NonPagedPoolCacheAligned = NonPagedPool + 4,&#10;    PagedPoolCacheAligned,&#10;    NonPagedPoolCacheAlignedMustS = NonPagedPool + 6,&#10;    MaxPoolType,&#10;    NonPagedPoolBase = 0,&#10;    NonPagedPoolBaseMustSucceed = NonPagedPoolBase + 2,&#10;    NonPagedPoolBaseCacheAligned = NonPagedPoolBase + 4,&#10;    NonPagedPoolBaseCacheAlignedMustS = NonPagedPoolBase + 6,&#10;    NonPagedPoolSession = 32,&#10;    PagedPoolSession = NonPagedPoolSession + 1,&#10;    NonPagedPoolMustSucceedSession = PagedPoolSession + 1,&#10;    DontUseThisTypeSession = NonPagedPoolMustSucceedSession + 1,&#10;    NonPagedPoolCacheAlignedSession = DontUseThisTypeSession + 1,&#10;    PagedPoolCacheAlignedSession = NonPagedPoolCacheAlignedSession + 1,&#10;...">POOL_TYPE</a>          ePoolType,
  [in, optional] PALLOCATE_FUNCTION pfnAllocBuffer,
  [in, optional] <a href="pfree_function" title="typedef VOID ( *FreeCallback)(&#10;  _In_ PVOID Buffer&#10;);">PFREE_FUNCTION</a>     pfnFreeBuffer,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              cbMarshallingBuffer,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              cMaxWriteBuffers,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              cMaxReadBuffers,
  [out]          PVOID              *ppvMarshalContext
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-clfscreatemarshallingarea">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/clfscreatemarshallingarea.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-clfscreatemarshallingarea)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>ClfsCreateMarshallingArea</strong> routine creates a marshalling area for a CLFS stream and returns a pointer to an opaque context that represents the new marshalling area.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="plfolog-in"><code>plfoLog</code> [in]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_file_object"><strong>LOG_FILE_OBJECT</strong></a> structure that represents a CLFS stream. The caller previously obtained this pointer by calling <a href="clfscreatelogfile" title="CLFSUSER_API NTSTATUS ClfsCreateLogFile(&#10;  [out]          PPLOG_FILE_OBJECT    pplfoLog,&#10;  [in]           PUNICODE_STRING      puszLogFileName,&#10;  [in]           ACCESS_MASK          fDesiredAccess,&#10;  [in]           ULONG                dwShareMode,&#10;  [in, optional] PSECURITY_DESCRIPTOR psdLogFile,&#10;  [in]           ULONG                fCreateDisposition,&#10;  [in]           ULONG                fCreateOptions,&#10;  [in]           ULONG                fFlagsAndAttributes,&#10;  [in]           ULONG                fLogOptionFlag,&#10;  [in, optional] PVOID                pvContext,&#10;  [in]           ULONG                cbContext&#10;);">ClfsCreateLogFile</a>.</p>

<h3 id="epooltype-in"><code>ePoolType</code> [in]</h3>

<p>A <a href="pool_type" title="typedef enum _POOL_TYPE {&#10;    NonPagedPool,&#10;    NonPagedPoolExecute = NonPagedPool,&#10;    PagedPool,&#10;    NonPagedPoolMustSucceed = NonPagedPool + 2,&#10;    DontUseThisType,&#10;    NonPagedPoolCacheAligned = NonPagedPool + 4,&#10;    PagedPoolCacheAligned,&#10;    NonPagedPoolCacheAlignedMustS = NonPagedPool + 6,&#10;    MaxPoolType,&#10;    NonPagedPoolBase = 0,&#10;    NonPagedPoolBaseMustSucceed = NonPagedPoolBase + 2,&#10;    NonPagedPoolBaseCacheAligned = NonPagedPoolBase + 4,&#10;    NonPagedPoolBaseCacheAlignedMustS = NonPagedPoolBase + 6,&#10;    NonPagedPoolSession = 32,&#10;    PagedPoolSession = NonPagedPoolSession + 1,&#10;    NonPagedPoolMustSucceedSession = PagedPoolSession + 1,&#10;    DontUseThisTypeSession = NonPagedPoolMustSucceedSession + 1,&#10;    NonPagedPoolCacheAlignedSession = DontUseThisTypeSession + 1,&#10;    PagedPoolCacheAlignedSession = NonPagedPoolCacheAlignedSession + 1,&#10;...">POOL_TYPE</a> value that specifies the type of memory (paged, non-paged, for example) that the new marshalling area will use for its log I/O blocks.</p>

<h3 id="pfnallocbuffer-in-optional"><code>pfnAllocBuffer</code> [in, optional]</h3>

<p>Either <strong>NULL</strong> or a pointer to a caller-supplied function that allocates a log I/O block for the marshalling area. The allocation function has the following prototype:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">PVOID</span>
<span class="p">(</span><span class="o">*</span><span class="n">PALLOCATE_FUNCTION</span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="pool_type" title="typedef enum _POOL_TYPE {&#10;    NonPagedPool,&#10;    NonPagedPoolExecute = NonPagedPool,&#10;    PagedPool,&#10;    NonPagedPoolMustSucceed = NonPagedPool + 2,&#10;    DontUseThisType,&#10;    NonPagedPoolCacheAligned = NonPagedPool + 4,&#10;    PagedPoolCacheAligned,&#10;    NonPagedPoolCacheAlignedMustS = NonPagedPool + 6,&#10;    MaxPoolType,&#10;    NonPagedPoolBase = 0,&#10;    NonPagedPoolBaseMustSucceed = NonPagedPoolBase + 2,&#10;    NonPagedPoolBaseCacheAligned = NonPagedPoolBase + 4,&#10;    NonPagedPoolBaseCacheAlignedMustS = NonPagedPoolBase + 6,&#10;    NonPagedPoolSession = 32,&#10;    PagedPoolSession = NonPagedPoolSession + 1,&#10;    NonPagedPoolMustSucceedSession = PagedPoolSession + 1,&#10;    DontUseThisTypeSession = NonPagedPoolMustSucceedSession + 1,&#10;    NonPagedPoolCacheAlignedSession = DontUseThisTypeSession + 1,&#10;    PagedPoolCacheAlignedSession = NonPagedPoolCacheAlignedSession + 1,&#10;...">POOL_TYPE</a></span><span class="w"> </span><span class="n">PoolType</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a></span><span class="w"> </span><span class="n">NumberOfBytes</span><span class="p">,</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n"><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></span><span class="w"> </span><span class="n">Tag</span>
<span class="w">    </span><span class="p">);</span>
</code></pre>
</div>

<p>The return value of the allocation function is a pointer to the newly allocated log I/O block.</p>

<h3 id="pfnfreebuffer-in-optional"><code>pfnFreeBuffer</code> [in, optional]</h3>

<p>Either <strong>NULL</strong> or a pointer to a caller-supplied function that frees a log I/O block that was previously allocated by <em>pfnAllocBuffer</em>. The function has the following prototype:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">VOID</span>
<span class="p">(</span><span class="o">*</span><span class="n"><a href="pfree_function" title="typedef VOID ( *FreeCallback)(&#10;  _In_ PVOID Buffer&#10;);">PFREE_FUNCTION</a></span><span class="p">)</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">IN</span><span class="w"> </span><span class="n">PVOID</span><span class="w"> </span><span class="n">Buffer</span>
<span class="w">    </span><span class="p">);</span>
</code></pre>
</div>

<h3 id="cbmarshallingbuffer-in"><code>cbMarshallingBuffer</code> [in]</h3>

<p>The size, in bytes, of the individual log I/O blocks that the new marshalling area uses. This must be a multiple of the sector size on the stable storage medium. The sector size is the <em>lpBytesPerSector</em> value returned from <strong>GetDiskFreeSpace</strong>.</p>

<h3 id="cmaxwritebuffers-in"><code>cMaxWriteBuffers</code> [in]</h3>

<p>The maximum number of I/O blocks that can be allocated at one time for write operations. This parameter affects the frequency of data flushes. If you do not need to control the frequency of data flushes, set this parameter to INFINITE.</p>

<h3 id="cmaxreadbuffers-in"><code>cMaxReadBuffers</code> [in]</h3>

<p>The maximum number of log I/O blocks that can be allocated at one time for read operations.</p>

<h3 id="ppvmarshalcontext-out"><code>ppvMarshalContext</code> [out]</h3>

<p>A pointer to a variable that receives a pointer to an opaque context that represents the new marshalling area.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ClfsCreateMarshallingArea</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if it succeeds; otherwise, it returns one of the error codes defined in Ntstatus.h.</p>

<h2 id="remarks">Remarks</h2>

<p>The <em>pfnAllocBuffer</em> and <em>pfnFreeBuffer</em> parameters must both point to caller-allocated functions, or they must both be <strong>NULL</strong>. If they are both <strong>NULL</strong>, CLFS provides default functions for allocating and freeing log I/O blocks.</p>

<p>Before calling <strong>ClfsCreateMarshallingArea</strong>, you must add at least two containers to the underlying log by calling <a href="clfsaddlogcontainer" title="CLFSUSER_API NTSTATUS ClfsAddLogContainer(&#10;  [in] PLOG_FILE_OBJECT plfoLog,&#10;  [in] PULONGLONG       pcbContainer,&#10;  [in] PUNICODE_STRING  puszContainerPath&#10;);">ClfsAddLogContainer</a> or <a href="clfsaddlogcontainerset" title="CLFSUSER_API NTSTATUS ClfsAddLogContainerSet(&#10;  [in]           PLOG_FILE_OBJECT plfoLog,&#10;  [in]           USHORT           cContainers,&#10;  [in, optional] PULONGLONG       pcbContainer,&#10;  [in]           PUNICODE_STRING  rguszContainerPath&#10;);">ClfsAddLogContainerSet</a>.</p>

<p>For an explanation of CLFS concepts and terminology, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-common-log-file-system">Common Log File System</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="clfsaddlogcontainer" title="CLFSUSER_API NTSTATUS ClfsAddLogContainer(&#10;  [in] PLOG_FILE_OBJECT plfoLog,&#10;  [in] PULONGLONG       pcbContainer,&#10;  [in] PUNICODE_STRING  puszContainerPath&#10;);">ClfsAddLogContainer</a></p>

<p><a href="clfsaddlogcontainerset" title="CLFSUSER_API NTSTATUS ClfsAddLogContainerSet(&#10;  [in]           PLOG_FILE_OBJECT plfoLog,&#10;  [in]           USHORT           cContainers,&#10;  [in, optional] PULONGLONG       pcbContainer,&#10;  [in]           PUNICODE_STRING  rguszContainerPath&#10;);">ClfsAddLogContainerSet</a></p>

<p><a href="clfscreatelogfile" title="CLFSUSER_API NTSTATUS ClfsCreateLogFile(&#10;  [out]          PPLOG_FILE_OBJECT    pplfoLog,&#10;  [in]           PUNICODE_STRING      puszLogFileName,&#10;  [in]           ACCESS_MASK          fDesiredAccess,&#10;  [in]           ULONG                dwShareMode,&#10;  [in, optional] PSECURITY_DESCRIPTOR psdLogFile,&#10;  [in]           ULONG                fCreateDisposition,&#10;  [in]           ULONG                fCreateOptions,&#10;  [in]           ULONG                fFlagsAndAttributes,&#10;  [in]           ULONG                fLogOptionFlag,&#10;  [in, optional] PVOID                pvContext,&#10;  [in]           ULONG                cbContext&#10;);">ClfsCreateLogFile</a></p>

<p><a href="clfsdeletemarshallingarea" title="CLFSUSER_API NTSTATUS ClfsDeleteMarshallingArea(&#10;  [in] PVOID pvMarshalContext&#10;);">ClfsDeleteMarshallingArea</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_file_object"><strong>LOG_FILE_OBJECT</strong></a></p>

<p><a href="pool_type" title="typedef enum _POOL_TYPE {&#10;    NonPagedPool,&#10;    NonPagedPoolExecute = NonPagedPool,&#10;    PagedPool,&#10;    NonPagedPoolMustSucceed = NonPagedPool + 2,&#10;    DontUseThisType,&#10;    NonPagedPoolCacheAligned = NonPagedPool + 4,&#10;    PagedPoolCacheAligned,&#10;    NonPagedPoolCacheAlignedMustS = NonPagedPool + 6,&#10;    MaxPoolType,&#10;    NonPagedPoolBase = 0,&#10;    NonPagedPoolBaseMustSucceed = NonPagedPoolBase + 2,&#10;    NonPagedPoolBaseCacheAligned = NonPagedPoolBase + 4,&#10;    NonPagedPoolBaseCacheAlignedMustS = NonPagedPoolBase + 6,&#10;    NonPagedPoolSession = 32,&#10;    PagedPoolSession = NonPagedPoolSession + 1,&#10;    NonPagedPoolMustSucceedSession = PagedPoolSession + 1,&#10;    DontUseThisTypeSession = NonPagedPoolMustSucceedSession + 1,&#10;    NonPagedPoolCacheAlignedSession = DontUseThisTypeSession + 1,&#10;    PagedPoolCacheAlignedSession = NonPagedPoolCacheAlignedSession + 1,&#10;...">POOL_TYPE</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-clfscreatemarshallingarea">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-clfscreatemarshallingarea.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
