<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IRP - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IRP - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IRP - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _IRP {
  <a href="cshort" title="typedef short CSHORT;">CSHORT</a>                    Type;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>                    Size;
  <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">PMDL</a>                      MdlAddress;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                     Flags;
  union {
    struct _IRP     *MasterIrp;
    __volatile <a href="long" title="typedef long LONG;">LONG</a> IrpCount;
    PVOID           SystemBuffer;
  } AssociatedIrp;
  <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a>                ThreadListEntry;
  <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">IO_STATUS_BLOCK</a>           IoStatus;
  KPROCESSOR_MODE           RequestorMode;
  BOOLEAN                   PendingReturned;
  <a href="char" title="typedef char CHAR;">CHAR</a>                      StackCount;
  <a href="char" title="typedef char CHAR;">CHAR</a>                      CurrentLocation;
  BOOLEAN                   Cancel;
  <a href="kirql" title="typedef UCHAR KIRQL, *PKIRQL;">KIRQL</a>                     CancelIrql;
  <a href="cchar" title="typedef char CCHAR;">CCHAR</a>                     ApcEnvironment;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                     AllocationFlags;
  union {
    <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">PIO_STATUS_BLOCK</a> UserIosb;
    PVOID            IoRingContext;
  };
  PKEVENT                   UserEvent;
  union {
    struct {
      union {
        <a href="pio_apc_routine" title="typedef IO_APC_ROUTINE* PIO_APC_ROUTINE;">PIO_APC_ROUTINE</a> UserApcRoutine;
        PVOID           IssuingProcess;
      };
      union {
        PVOID                 UserApcContext;
#if ...
        _IORING_OBJECT        *IoRing;
#else
        struct _IORING_OBJECT *IoRing;
#endif
      };
    } AsynchronousParameters;
    LARGE_INTEGER AllocationSize;
  } Overlay;
  __volatile PDRIVER_CANCEL CancelRoutine;
  PVOID                     UserBuffer;
  union {
    struct {
      union {
        KDEVICE_QUEUE_ENTRY DeviceQueueEntry;
        struct {
          PVOID DriverContext[4];
        };
      };
      PETHREAD     Thread;
      PCHAR        AuxiliaryBuffer;
      struct {
        <a href="list_entry" title="typedef struct _LIST_ENTRY LIST_ENTRY, *PLIST_ENTRY;">LIST_ENTRY</a> ListEntry;
        union {
          <a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">struct _IO_STACK_LOCATION</a> *CurrentStackLocation;
          <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                     PacketType;
        };
      };
      <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a> OriginalFileObject;
    } Overlay;
    KAPC  Apc;
    PVOID CompletionKey;
  } Tail;
} IRP;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_irp">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/irp.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-wdm-_irp)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_IRP structure</h1>
<h2>Description</h2>
<p>The <strong>IRP</strong> structure is a partially opaque structure that represents an <em>I/O request packet</em>. Undocumented members of the <strong>IRP</strong> structure are reserved, used only by the I/O manager or in some cases, by file system drivers (FSDs).</p>
<h2>Members</h2>
<h3><code>Type</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Size</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>MdlAddress</code></h3>
<p>Pointer to an <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a> describing a user buffer, if the driver is using direct I/O, and the IRP major function code is one of the following:</p>
<ul>
<li>
<strong><a href="irp_mj_read" title="#define IRP_MJ_READ 0x03">IRP_MJ_READ</a></strong>
</li>
</ul>
<p>The <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a> describes an empty buffer that the device or driver fills in.</p>
<ul>
<li>
<strong><a href="irp_mj_write" title="#define IRP_MJ_WRITE 0x04">IRP_MJ_WRITE</a></strong>
</li>
</ul>
<p>The <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a> describes a buffer that contains data for the device or driver.</p>
<ul>
<li>
<strong><a href="irp_mj_device_control" title="#define IRP_MJ_DEVICE_CONTROL 0x0e">IRP_MJ_DEVICE_CONTROL</a></strong> or <strong><a href="irp_mj_internal_device_control" title="#define IRP_MJ_INTERNAL_DEVICE_CONTROL 0x0f">IRP_MJ_INTERNAL_DEVICE_CONTROL</a></strong>
</li>
</ul>
<p>If the IOCTL code specifies the METHOD_IN_DIRECT transfer type, the <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a> describes a buffer that contains data for the device or driver.</p>
<p>If the IOCTL code specifies the METHOD_OUT_DIRECT transfer type, the <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a> describes an empty buffer that the device or driver fills in.</p>
<p>For more information about the buffers that are associated with METHOD_IN_DIRECT and METHOD_OUT_DIRECT transfer types in IOCTL codes, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/buffer-descriptions-for-i-o-control-codes">Buffer Descriptions for I/O Control Codes</a>.</p>
<p>If the driver is not using direct I/O, this pointer is <strong>NULL</strong>.</p>
<h3><code>Flags</code></h3>
<p>File system drivers use this field, which is read-only for all drivers. Network and, possibly, highest-level device drivers also might read this field. This field is set either to zero or to the bitwise-OR of one or more of the following system-defined flag bits:</p>
<ul>
<li>
<a href="irp_nocache" title="#define IRP_NOCACHE 0x00000001">IRP_NOCACHE</a>
</li>
<li>
<a href="irp_paging_io" title="#define IRP_PAGING_IO 0x00000002">IRP_PAGING_IO</a>
</li>
<li>
<a href="irp_mount_completion" title="#define IRP_MOUNT_COMPLETION 0x00000002">IRP_MOUNT_COMPLETION</a>
</li>
<li>
<a href="irp_synchronous_api" title="#define IRP_SYNCHRONOUS_API 0x00000004">IRP_SYNCHRONOUS_API</a>
</li>
<li>
<a href="irp_associated_irp" title="#define IRP_ASSOCIATED_IRP 0x00000008">IRP_ASSOCIATED_IRP</a>
</li>
<li>
<a href="irp_buffered_io" title="#define IRP_BUFFERED_IO 0x00000010">IRP_BUFFERED_IO</a>
</li>
<li>
<a href="irp_deallocate_buffer" title="#define IRP_DEALLOCATE_BUFFER 0x00000020">IRP_DEALLOCATE_BUFFER</a>
</li>
<li>
<a href="irp_input_operation" title="#define IRP_INPUT_OPERATION 0x00000040">IRP_INPUT_OPERATION</a>
</li>
<li>
<a href="irp_synchronous_paging_io" title="#define IRP_SYNCHRONOUS_PAGING_IO 0x00000040">IRP_SYNCHRONOUS_PAGING_IO</a>
</li>
<li>
<a href="irp_create_operation" title="#define IRP_CREATE_OPERATION 0x00000080">IRP_CREATE_OPERATION</a>
</li>
<li>
<a href="irp_read_operation" title="#define IRP_READ_OPERATION 0x00000100">IRP_READ_OPERATION</a>
</li>
<li>
<a href="irp_write_operation" title="#define IRP_WRITE_OPERATION 0x00000200">IRP_WRITE_OPERATION</a>
</li>
<li>
<a href="irp_close_operation" title="#define IRP_CLOSE_OPERATION 0x00000400">IRP_CLOSE_OPERATION</a>
</li>
<li>
<a href="irp_defer_io_completion" title="#define IRP_DEFER_IO_COMPLETION 0x00000800">IRP_DEFER_IO_COMPLETION</a>
</li>
<li>
<a href="irp_ob_query_name" title="#define IRP_OB_QUERY_NAME 0x00001000">IRP_OB_QUERY_NAME</a>
</li>
<li>
<a href="irp_hold_device_queue" title="#define IRP_HOLD_DEVICE_QUEUE 0x00002000">IRP_HOLD_DEVICE_QUEUE</a>
</li>
<li>
<a href="irp_um_driver_initiated_io" title="#define IRP_UM_DRIVER_INITIATED_IO 0x00400000">IRP_UM_DRIVER_INITIATED_IO</a>
</li>
</ul>
<h3><code>AssociatedIrp</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>AssociatedIrp.MasterIrp</code></h3>
<p>Pointer to the master IRP in an IRP that was created by a highest-level driver's call to <a href="iomakeassociatedirp" title="PIRP IoMakeAssociatedIrp(&#10;  [in] PIRP  Irp,&#10;  [in] CCHAR StackSize&#10;);">IoMakeAssociatedIrp</a>.</p>
<h3><code>AssociatedIrp.IrpCount</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>AssociatedIrp.SystemBuffer</code></h3>
<p>Pointer to a system-space buffer.</p>
<p>If the driver is using buffered I/O, the buffer's purpose is determined by the IRP major function code, as follows:</p>
<ul>
<li>
<strong>SystemBuffer.<a href="irp_mj_read" title="#define IRP_MJ_READ 0x03">IRP_MJ_READ</a></strong>
</li>
</ul>
<p>The buffer receives data from the device or driver. The buffer's length is specified by <strong>Parameters.Read.Length</strong> in the driver's <a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a> structure.</p>
<ul>
<li>
<strong>SystemBuffer.<a href="irp_mj_write" title="#define IRP_MJ_WRITE 0x04">IRP_MJ_WRITE</a></strong>
</li>
</ul>
<p>The buffer supplies data for the device or driver. The buffer's length is specified by <strong>Parameters.Write.Length</strong> in the driver's <strong><a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a></strong> structure.</p>
<ul>
<li>
<strong>SystemBuffer.<a href="irp_mj_device_control" title="#define IRP_MJ_DEVICE_CONTROL 0x0e">IRP_MJ_DEVICE_CONTROL</a></strong> or <strong><a href="irp_mj_internal_device_control" title="#define IRP_MJ_INTERNAL_DEVICE_CONTROL 0x0f">IRP_MJ_INTERNAL_DEVICE_CONTROL</a></strong>
</li>
</ul>
<p>The buffer represents both the input and output buffers that are supplied to <strong>DeviceIoControl</strong> and <strong><a href="iobuilddeviceiocontrolrequest" title="__drv_aliasesMem PIRP IoBuildDeviceIoControlRequest(&#10;  [in]            ULONG            IoControlCode,&#10;  [in]            PDEVICE_OBJECT   DeviceObject,&#10;  [in, optional]  PVOID            InputBuffer,&#10;  [in]            ULONG            InputBufferLength,&#10;  [out, optional] PVOID            OutputBuffer,&#10;  [in]            ULONG            OutputBufferLength,&#10;  [in]            BOOLEAN          InternalDeviceIoControl,&#10;  [in, optional]  PKEVENT          Event,&#10;  [out]           PIO_STATUS_BLOCK IoStatusBlock&#10;);">IoBuildDeviceIoControlRequest</a></strong>. Output data overwrites input data.</p>
<p>For input, the buffer's length is specified by <strong>Parameters.DeviceIoControl.InputBufferLength</strong> in the driver's <strong><a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a></strong> structure.</p>
<p>For output, the buffer's length is specified by <strong>Parameters.DeviceIoControl.OutputBufferLength</strong> in the driver's <strong><a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a></strong> structure.</p>
<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/buffer-descriptions-for-i-o-control-codes">Buffer Descriptions for I/O Control Codes</a>.</p>
<p>The buffer represents the input buffer that is supplied to <strong>DeviceIoControl</strong> and <strong><a href="iobuilddeviceiocontrolrequest" title="__drv_aliasesMem PIRP IoBuildDeviceIoControlRequest(&#10;  [in]            ULONG            IoControlCode,&#10;  [in]            PDEVICE_OBJECT   DeviceObject,&#10;  [in, optional]  PVOID            InputBuffer,&#10;  [in]            ULONG            InputBufferLength,&#10;  [out, optional] PVOID            OutputBuffer,&#10;  [in]            ULONG            OutputBufferLength,&#10;  [in]            BOOLEAN          InternalDeviceIoControl,&#10;  [in, optional]  PKEVENT          Event,&#10;  [out]           PIO_STATUS_BLOCK IoStatusBlock&#10;);">IoBuildDeviceIoControlRequest</a></strong>.</p>
<p>The buffer's length is specified by <strong>Parameters.DeviceIoControl.InputBufferLength</strong> in the driver's <strong><a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a></strong> structure.</p>
<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/buffer-descriptions-for-i-o-control-codes">Buffer Descriptions for I/O Control Codes</a>.</p>
<p>If the driver is using direct I/O, the buffer's purpose is determined by the IRP major function code, as follows:</p>
<h3><code>ThreadListEntry</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>IoStatus</code></h3>
<p>Contains the <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">IO_STATUS_BLOCK</a> structure in which a driver stores status and information before calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-iocompleterequest">IoCompleteRequest</a>.</p>
<h3><code>RequestorMode</code></h3>
<p>Indicates the execution mode of the original requester of the operation, one of <strong>UserMode</strong> or <strong>KernelMode</strong>.</p>
<h3><code>PendingReturned</code></h3>
<p>If set to <strong>TRUE</strong>, a driver has marked the IRP pending. Each <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-io_completion_routine">IoCompletion</a> routine should check the value of this flag. If the flag is <strong>TRUE</strong>, and if the IoCompletion routine will not return STATUS_MORE_PROCESSING_REQUIRED, the routine should call <a href="iomarkirppending" title="VOID IoMarkIrpPending(&#10;  [in, out] PIRP Irp&#10;);">IoMarkIrpPending</a> to propagate the pending status to drivers above it in the device stack.</p>
<h3><code>StackCount</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>CurrentLocation</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Cancel</code></h3>
<p>If set to <strong>TRUE</strong>, the IRP either is or should be canceled.</p>
<h3><code>CancelIrql</code></h3>
<p>Contains the IRQL at which a driver is running when <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff548196(v=vs.85)">IoAcquireCancelSpinLock</a> is called.</p>
<h3><code>ApcEnvironment</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>AllocationFlags</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>UserIosb</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>IoRingContext</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>UserEvent</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay.AsynchronousParameters</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay.AsynchronousParameters.UserApcRoutine</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay.AsynchronousParameters.IssuingProcess</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay.AsynchronousParameters.UserApcContext</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay.AsynchronousParameters.IoRing</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Overlay.AllocationSize</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>CancelRoutine</code></h3>
<p>Contains the entry point for a driver-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/printerextension/nf-printerextension-iprinterextensionrequest-cancel">Cancel</a> routine to be called if the IRP is canceled. <strong>NULL</strong> indicates that the IRP is not currently cancelable.</p>
<h3><code>UserBuffer</code></h3>
<p>Contains the address of an output buffer if both of the following conditions apply:</p>
<ul>
<li>
<p>The major function code in the I/O stack location is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-device-control">IRP_MJ_DEVICE_CONTROL</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mj-internal-device-control">IRP_MJ_INTERNAL_DEVICE_CONTROL</a>.</p>
</li>
<li>
<p>The I/O control code was defined with METHOD_NEITHER or METHOD_BUFFERED.</p>
</li>
</ul>
<p>For METHOD_BUFFERED, the driver should use the buffer pointed to by <strong>Irp-&gt;AssociatedIrp.SystemBuffer</strong> as the output buffer. When the driver completes the request, the I/O manager copies the contents of this buffer to the output buffer that is pointed to by <strong>Irp-&gt;UserBuffer</strong>. The driver should not write directly to the buffer pointed to by <strong>Irp-&gt;UserBuffer</strong>. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/buffer-descriptions-for-i-o-control-codes">Buffer Descriptions for I/O Control Codes</a>.</p>
<h3><code>Tail</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.Overlay</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.Overlay.DeviceQueueEntry</code></h3>
<p>If IRPs are queued in the device queue associated with the driver's device object, this field links IRPs in the device queue. These links can be used only while the driver is processing the IRP.</p>
<h3><code>Tail.Overlay.DriverContext</code></h3>
<p>If IRPs are not queued in the device queue associated with the driver's device object, this field can be used by the driver to store up to four pointers. This field can be used only while the driver owns the IRP.</p>
<h3><code>Tail.Overlay.Thread</code></h3>
<p>A pointer to the caller's thread control block (TCB). For requests that originate in user-mode, the I/O manager always sets this field to point to the TCB of the thread that issued the request.</p>
<h3><code>Tail.Overlay.AuxiliaryBuffer</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.Overlay.ListEntry</code></h3>
<p>If a driver manages its own internal queues of IRPs, it uses this field to link one IRP to the next. These links can be used only while the driver is holding the IRP in its queue or is processing the IRP.</p>
<h3><code>Tail.Overlay.CurrentStackLocation</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.Overlay.PacketType</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.Overlay.OriginalFileObject</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.Apc</code></h3>
<p>Reserved for internal system use.</p>
<h3><code>Tail.CompletionKey</code></h3>
<p>Reserved for internal system use.</p>
<h2>Remarks</h2>
<p>Undocumented members of the IRP structure are reserved, used only by the I/O manager or in some cases, by file system drivers (FSDs).</p>
<p>An IRP is the basic I/O manager structure used to communicate with drivers and to allow drivers to communicate with each other. A packet consists of two different parts:</p>
<ul>
<li>
<p><em>Header</em>, or <em>fixed part of the packet</em>— This is used by the I/O manager to store information about the original request, such as the caller's device-independent parameters, the address of the device object upon which a file is open, and so on. It is also used by drivers to store information such as the final status of the request.</p>
</li>
<li>
<p><em>I/O stack locations</em> — Following the header is a set of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/i-o-stack-locations">I/O stack locations</a>, one per driver in the chain of layered drivers for which the request is bound. Each stack location contains the parameters, function codes, and context used by the corresponding driver to determine what it is supposed to be doing. For more information, see the <a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a> structure.</p>
</li>
</ul>
<p>While a higher-level driver might check the value of the <strong>Cancel</strong> Boolean in an IRP, that driver cannot assume the IRP will be completed with STATUS_CANCELLED by a lower-level driver even if the value is <strong>TRUE</strong>.</p>
<h2>See also</h2>
<ul>
<li>
<a href="io_stack_location" title="typedef struct _IO_STACK_LOCATION {&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  UCHAR                  Flags;&#10;  UCHAR                  Control;&#10;  union {&#10;    struct {&#10;      PIO_SECURITY_CONTEXT     SecurityContext;&#10;      ULONG                    Options;&#10;      USHORT POINTER_ALIGNMENT FileAttributes;&#10;      USHORT                   ShareAccess;&#10;      ULONG POINTER_ALIGNMENT  EaLength;&#10;    } Create;&#10;    struct {&#10;      PIO_SECURITY_CONTEXT          SecurityContext;&#10;      ULONG                         Options;&#10;      USHORT POINTER_ALIGNMENT      Reserved;&#10;      USHORT                        ShareAccess;&#10;      PNAMED_PIPE_CREATE_PARAMETERS Parameters;&#10;    } CreatePipe;&#10;...">IO_STACK_LOCATION</a>
</li>
<li>
<a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">IO_STATUS_BLOCK</a>
</li>
<li>
<a href="iocreatedevice" title="NTSTATUS IoCreateDevice(&#10;  [in]           PDRIVER_OBJECT  DriverObject,&#10;  [in]           ULONG           DeviceExtensionSize,&#10;  [in, optional] PUNICODE_STRING DeviceName,&#10;  [in]           DEVICE_TYPE     DeviceType,&#10;  [in]           ULONG           DeviceCharacteristics,&#10;  [in]           BOOLEAN         Exclusive,&#10;  [out]          PDEVICE_OBJECT  *DeviceObject&#10;);">IoCreateDevice</a>
</li>
<li>
<a href="iogetcurrentirpstacklocation" title="__drv_aliasesMem PIO_STACK_LOCATION IoGetCurrentIrpStackLocation(&#10;  [in] PIRP Irp&#10;);">IoGetCurrentIrpStackLocation</a>
</li>
<li>
<a href="iogetnextirpstacklocation" title="__drv_aliasesMem PIO_STACK_LOCATION IoGetNextIrpStackLocation(&#10;  [in] PIRP Irp&#10;);">IoGetNextIrpStackLocation</a>
</li>
<li>
<a href="iosetcancelroutine" title="PDRIVER_CANCEL IoSetCancelRoutine(&#10;  [in] PIRP           Irp,&#10;  [in] PDRIVER_CANCEL CancelRoutine&#10;);">IoSetCancelRoutine</a>
</li>
<li>
<a href="iosetnextirpstacklocation" title="VOID IoSetNextIrpStackLocation(&#10;  [in, out] PIRP Irp&#10;);">IoSetNextIrpStackLocation</a>
</li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_irp">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/ns-wdm-_irp.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
