<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PCAM_PROCESS_PACKET_ROUTINE_EX - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PCAM_PROCESS_PACKET_ROUTINE_EX - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PCAM_PROCESS_PACKET_ROUTINE_EX - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// usbcamdi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PCAM_PROCESS_PACKET_ROUTINE_EX PcamProcessPacketRoutineEx;

<a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PcamProcessPacketRoutineEx(
  <a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a> BusDeviceObject,
  PVOID DeviceContext,
  PVOID CurrentFrameContext,
  <a href="usbd_iso_packet_descriptor" title="typedef struct _USBD_ISO_PACKET_DESCRIPTOR {&#10;  ULONG       Offset;&#10;  ULONG       Length;&#10;  USBD_STATUS Status;&#10;} USBD_ISO_PACKET_DESCRIPTOR, *PUSBD_ISO_PACKET_DESCRIPTOR;">PUSBD_ISO_PACKET_DESCRIPTOR</a> SyncPacket,
  PVOID SyncBuffer,
  <a href="usbd_iso_packet_descriptor" title="typedef struct _USBD_ISO_PACKET_DESCRIPTOR {&#10;  ULONG       Offset;&#10;  ULONG       Length;&#10;  USBD_STATUS Status;&#10;} USBD_ISO_PACKET_DESCRIPTOR, *PUSBD_ISO_PACKET_DESCRIPTOR;">PUSBD_ISO_PACKET_DESCRIPTOR</a> DataPacket,
  PVOID DataBuffer,
  PBOOLEAN FrameComplete,
  PULONG PacketFlag,
  PULONG ValidDataOffset
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbcamdi/nc-usbcamdi-pcam_process_packet_routine_ex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pcam_process_packet_routine_ex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-usbcamdi-pcam_process_packet_routine_ex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>A camera minidriver's <strong>CamProcessUSBPacketEx</strong> callback function processes a USB packet.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="busdeviceobject"><code>BusDeviceObject</code></h3>

<p>Pointer to the camera minidriver's device object created by the USB hub.</p>

<h3 id="devicecontext"><code>DeviceContext</code></h3>

<p>Pointer to the camera minidriver's device context.</p>

<h3 id="currentframecontext"><code>CurrentFrameContext</code></h3>

<p>Pointer to the camera minidriver's frame context.</p>

<h3 id="syncpacket"><code>SyncPacket</code></h3>

<p>Pointer to a <strong><a href="usbd_iso_packet_descriptor" title="typedef struct _USBD_ISO_PACKET_DESCRIPTOR {&#10;  ULONG       Offset;&#10;  ULONG       Length;&#10;  USBD_STATUS Status;&#10;} USBD_ISO_PACKET_DESCRIPTOR, *PUSBD_ISO_PACKET_DESCRIPTOR;">USBD_ISO_PACKET_DESCRIPTOR</a></strong> structure from the sync pipe. This value is <strong>NULL</strong> if the interface has only one pipe.</p>

<h3 id="syncbuffer"><code>SyncBuffer</code></h3>

<p>Pointer to the data for the <em>SyncPacket</em>.</p>

<h3 id="datapacket"><code>DataPacket</code></h3>

<p>Specifies the isochronous packet descriptor from data pipe.</p>

<h3 id="databuffer"><code>DataBuffer</code></h3>

<p>Pointer to <em>DataPacket.</em></p>

<h3 id="framecomplete"><code>FrameComplete</code></h3>

<p>Pointer to a BOOLEAN value that the camera minidriver sets to indicate whether this is the first data packet for a new video frame.</p>

<h3 id="packetflag"><code>PacketFlag</code></h3>

<p>Pointer to a value that the minidriver sets to indicate the contents of the current frame. It should be set to one of the following values:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>USBCAMD_PROCESSPACKETEX_DropFrame</td>
  <td>The current frame is unsalvageable. The read <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> should be recycled.</td>
</tr>
<tr>
  <td>USBCAMD_PROCESSPACKETEX_NextFrameIsStill</td>
  <td>The frame is a still image.</td>
</tr>
<tr>
  <td>USBCAMD_PROCESSPACKETEX_CurrentFrameIsStill</td>
  <td>The current frame is for the still pin.</td>
</tr>
</tbody>
</table>

<h3 id="validdataoffset"><code>ValidDataOffset</code></h3>

<p>Pointer to a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> value that indicates an offset from the beginning of the packet. USBCAMD should start the copy from this offset. This eliminates the extra buffer copy in the case of an in-band signal. If the camera is not using in-band signaling, <em>ValidDataOffset</em> should be set to zero.</p>

<h2 id="return-value">Return value</h2>

<p>This function returns the number of bytes that should be copied.</p>

<h2 id="remarks">Remarks</h2>

<p>The minidriver should complete its <strong>CamProcessUSBPacketEx</strong> function as quickly as possible. Image processing should be deferred to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbcamdi/nc-usbcamdi-pcam_process_raw_frame_routine_ex">CamProcessRawVideoFrameEx</a> function.</p>

<p>This callback function is used with isochronous pipes only (video or still streaming).</p>

<p>The original USBCAMD does not call <strong>CamProcessUSBPacketEx</strong>.</p>

<p>This function is optional.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbcamdi/nc-usbcamdi-pcam_process_raw_frame_routine_ex">CamProcessRawVideoFrameEx</a></p>

<p><strong><a href="usbd_iso_packet_descriptor" title="typedef struct _USBD_ISO_PACKET_DESCRIPTOR {&#10;  ULONG       Offset;&#10;  ULONG       Length;&#10;  USBD_STATUS Status;&#10;} USBD_ISO_PACKET_DESCRIPTOR, *PUSBD_ISO_PACKET_DESCRIPTOR;">USBD_ISO_PACKET_DESCRIPTOR</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/usbcamdi/nc-usbcamdi-pcam_process_packet_routine_ex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/usbcamdi/nc-usbcamdi-pcam_process_packet_routine_ex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
