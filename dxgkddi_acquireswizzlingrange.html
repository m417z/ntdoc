<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_ACQUIRESWIZZLINGRANGE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_ACQUIRESWIZZLINGRANGE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_ACQUIRESWIZZLINGRANGE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKDDI_ACQUIRESWIZZLINGRANGE DxgkddiAcquireswizzlingrange;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiAcquireswizzlingrange(
  [in]     IN_CONST_HANDLE hAdapter,
  [in/out] INOUT_PDXGKARG_ACQUIRESWIZZLINGRANGE pAcquireSwizzlingRange
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_acquireswizzlingrange">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_acquireswizzlingrange.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dkmddi-dxgkddi_acquireswizzlingrange)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgkddi_acquireswizzlingrange-callback-function">DXGKDDI_ACQUIRESWIZZLINGRANGE callback function</h1>

<h2 id="description">Description</h2>

<p>The <em>DxgkDdiAcquireSwizzlingRange</em> function makes an allocation accessible through the central processing unit (CPU) aperture for the given segment.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="hadapter-in"><code>hAdapter</code> [in]</h3>

<p>A handle to a context block that is associated with a display adapter. The display miniport driver previously provided this handle to the Microsoft DirectX graphics kernel subsystem in the <em>MiniportDeviceContext</em> output parameter of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_add_device">DxgkDdiAddDevice</a> function.</p>

<h3 id="pacquireswizzlingrange-inout"><code>pAcquireSwizzlingRange</code> [in/out]</h3>

<p>A pointer to a <a href="dxgkarg_acquireswizzlingrange" title="typedef struct _DXGKARG_ACQUIRESWIZZLINGRANGE {&#10;  [in]     HANDLE           hAllocation;&#10;  [in]     UINT             PrivateDriverData;&#10;  [in]     UINT             RangeId;&#10;  [in]     UINT             SegmentId;&#10;  [in]     SIZE_T           RangeSize;&#10;  [in/out] PHYSICAL_ADDRESS CPUTranslatedAddress;&#10;} DXGKARG_ACQUIRESWIZZLINGRANGE;">DXGKARG_ACQUIRESWIZZLINGRANGE</a> structure that contains information for making an allocation accessible through the CPU aperture.</p>

<h2 id="return-value">Return value</h2>

<p><em>DxgkDdiAcquireSwizzlingRange</em> returns one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></td>
  <td><em>DxgkDdiAcquireSwizzlingRange</em> successfully made the allocation accessible.</td>
</tr>
<tr>
  <td>STATUS_GRAPHICS_UNSWIZZLING_APERTURE_UNSUPPORTED</td>
  <td><em>DxgkDdiAcquireSwizzlingRange</em> could not program the swizzling range for the allocation. The video memory manager fails to acquire the swizzling range without making further attempts.</td>
</tr>
<tr>
  <td>STATUS_GRAPHICS_UNSWIZZLING_APERTURE_UNAVAILABLE</td>
  <td><em>DxgkDdiAcquireSwizzlingRange</em> could not program the swizzling range for the allocation because another swizzling range is currently using the graphics processing unit (GPU) resources that are required. The video memory manager attempts to release a range that is currently in use and then attempts to set up the swizzling range again.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The <em>DxgkDdiAcquireSwizzlingRange</em> function is called after the user-mode display driver requests a virtual address that references the bits of an allocation (that is, after the user-mode display driver calls the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a> function with the <strong>AcquireAperture</strong> bit-field flag set in the <strong>Flags</strong> member of the <a href="d3dddicb_lock" title="typedef struct _D3DDDICB_LOCK {&#10;  [in/out] D3DKMT_HANDLE          hAllocation;&#10;  [in]     UINT                   PrivateDriverData;&#10;  [in]     UINT                   NumPages;&#10;  [in]     const UINT             *pPages;&#10;  [out]    VOID                   *pData;&#10;  [in]     D3DDDICB_LOCKFLAGS     Flags;&#10;           D3DGPU_VIRTUAL_ADDRESS GpuVirtualAddress;&#10;} D3DDDICB_LOCK;">D3DDDICB_LOCK</a> structure and while the allocation is currently located in a CPU-accessible memory segment). If the <strong>AcquireAperture</strong> bit-field flag is not set in the call to <strong>pfnLockCb</strong>, <em>DxgkDdiAcquireSwizzlingRange</em> is not called, and the allocation must be in a format that the user-mode display driver or an application can process.</p>

<p>When <em>DxgkDdiAcquireSwizzlingRange</em> is called, the display miniport driver must make the specified allocation (that is, the <strong>hAllocation</strong> member of the <a href="dxgkarg_acquireswizzlingrange" title="typedef struct _DXGKARG_ACQUIRESWIZZLINGRANGE {&#10;  [in]     HANDLE           hAllocation;&#10;  [in]     UINT             PrivateDriverData;&#10;  [in]     UINT             RangeId;&#10;  [in]     UINT             SegmentId;&#10;  [in]     SIZE_T           RangeSize;&#10;  [in/out] PHYSICAL_ADDRESS CPUTranslatedAddress;&#10;} DXGKARG_ACQUIRESWIZZLINGRANGE;">DXGKARG_ACQUIRESWIZZLINGRANGE</a> structure that the <em>pAcquireSwizzlingRange</em> parameter points to) accessible through the CPU aperture for the specified segment (that is, the <strong>SegmentId</strong> member of <a href="dxgkarg_acquireswizzlingrange" title="typedef struct _DXGKARG_ACQUIRESWIZZLINGRANGE {&#10;  [in]     HANDLE           hAllocation;&#10;  [in]     UINT             PrivateDriverData;&#10;  [in]     UINT             RangeId;&#10;  [in]     UINT             SegmentId;&#10;  [in]     SIZE_T           RangeSize;&#10;  [in/out] PHYSICAL_ADDRESS CPUTranslatedAddress;&#10;} DXGKARG_ACQUIRESWIZZLINGRANGE;">DXGKARG_ACQUIRESWIZZLINGRANGE</a>). The allocation must appear exactly as it appears in computer memory after an unswizzling eviction.</p>

<p>Not all of the requests by the user-mode display driver are accessible to the display miniport driver. Swizzling ranges that the video memory manager acquired are cached based on the allocation that they are associated with and the specified private data. On the first request by the user-mode display driver to access an allocation, the display miniport driver's <em>DxgkDdiAcquireSwizzlingRange</em> function is called to make the allocation accessible. On subsequent requests with matching private data, the previously setup mapping is used to access the allocation.</p>

<p>The video memory manager calls the display miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_releaseswizzlingrange">DxgkDdiReleaseSwizzlingRange</a> function to release a swizzling range when an allocation is evicted or destroyed, or when another allocation requires an aperture. An allocation can be associated with any number of swizzling ranges (for example, one aperture per MIP level).</p>

<p>The number of swizzling ranges that an adapter supports is exposed by the driver in the <strong>NumberOfSwizzlingRanges</strong> member of the <a href="dxgk_drivercaps" title="typedef struct _DXGK_DRIVERCAPS {&#10;  [out] PHYSICAL_ADDRESS                   HighestAcceptableAddress;&#10;  [out] UINT                               MaxAllocationListSlotId;&#10;  [out] SIZE_T                             ApertureSegmentCommitLimit;&#10;  [out] UINT                               MaxPointerWidth;&#10;  [out] UINT                               MaxPointerHeight;&#10;  [out] DXGK_POINTERFLAGS                  PointerCaps;&#10;  [out] UINT                               InterruptMessageNumber;&#10;  [out] UINT                               NumberOfSwizzlingRanges;&#10;  [out] UINT                               MaxOverlays;&#10;  union {&#10;    [out] DXGK_GAMMARAMPCAPS      GammaRampCaps;&#10;    [out] DXGK_COLORTRANSFORMCAPS ColorTransformCaps;&#10;  };&#10;  [out] DXGK_PRESENTATIONCAPS              PresentationCaps;&#10;  [out] UINT                               MaxQueuedFlipOnVSync;&#10;  [out] DXGK_FLIPCAPS                      FlipCaps;&#10;  [out] DXGK_VIDSCHCAPS                    SchedulingCaps;&#10;  [out] DXGK_VIDMMCAPS                     MemoryManagementCaps;&#10;  [out] DXGK_GPUENGINETOPOLOGY             GpuEngineTopology;&#10;...">DXGK_DRIVERCAPS</a> structure when the driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo">DxgkDdiQueryAdapterInfo</a> function is called. All ranges are equal (that is, any range can unswizzle or untile any type of swizzling or tiling). The video memory manager arbitrates the available swizzling ranges among all of the applications that require them.</p>

<p>The driver must use memory-mapped I/O (MMIO) to set up a swizzling range. These swizzling-range accesses must not interfere with the execution of the GPU (that is, the GPU must not be idle when <em>DxgkDdiAcquireSwizzlingRange</em> is called).</p>

<p>All calls to <em>DxgkDdiAcquireSwizzlingRange</em> are serialized among themselves but not with any other DDI function.</p>

<p>If the GPU supports swizzling ranges that redirect CPU accesses to non-CPU-accessible memory segments or system memory, the user-mode display driver can set the combination of <strong>AcquireAperture</strong> and <strong>UseAlternateVA</strong> bit-field flags in the <strong>Flags</strong> member of the <a href="d3dddicb_lock" title="typedef struct _D3DDDICB_LOCK {&#10;  [in/out] D3DKMT_HANDLE          hAllocation;&#10;  [in]     UINT                   PrivateDriverData;&#10;  [in]     UINT                   NumPages;&#10;  [in]     const UINT             *pPages;&#10;  [out]    VOID                   *pData;&#10;  [in]     D3DDDICB_LOCKFLAGS     Flags;&#10;           D3DGPU_VIRTUAL_ADDRESS GpuVirtualAddress;&#10;} D3DDDICB_LOCK;">D3DDDICB_LOCK</a> structure in a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a> function to lock the allocation. In this situation, the video memory manager calls the display miniport driver's <em>DxgkDdiAcquireSwizzlingRange</em> function to acquire a swizzling range for the allocation even though the allocation is located in a non-CPU-accessible memory segment or an aperture segment. Swizzling ranges are associated with some GPU resources (for example, PCI aperture ranges) that the driver manages and are not accessible to or accounted for by the video memory manager.</p>

<p>A call to <em>DxgkDdiAcquireSwizzlingRange</em> to acquire a swizzling range might fail because a driver-managed resource ran out. Although the swizzling range itself is free, it might not be usable because of the missing resource. The driver can indicate that a swizzling range is unavailable to the video memory manager by returning STATUS_GRAPHICS_UNSWIZZLING_APERTURE_UNAVAILABLE from <em>DxgkDdiAcquireSwizzlingRange</em>. The video memory manager next attempts to release a swizzling range that is currently in use and then calls the driver's <em>DxgkDdiAcquireSwizzlingRange</em> function again to set up the new swizzling range. If all of the swizzling ranges are released and the driver still fails with STATUS_GRAPHICS_UNSWIZZLING_APERTURE_UNAVAILABLE, the video memory manager fails to acquire a swizzling range for the allocation.</p>

<p><em>DxgkDdiAcquireSwizzlingRange</em> should be made pageable.</p>

<h2 id="see-also">See also</h2>

<p><a href="d3dddicb_lock" title="typedef struct _D3DDDICB_LOCK {&#10;  [in/out] D3DKMT_HANDLE          hAllocation;&#10;  [in]     UINT                   PrivateDriverData;&#10;  [in]     UINT                   NumPages;&#10;  [in]     const UINT             *pPages;&#10;  [out]    VOID                   *pData;&#10;  [in]     D3DDDICB_LOCKFLAGS     Flags;&#10;           D3DGPU_VIRTUAL_ADDRESS GpuVirtualAddress;&#10;} D3DDDICB_LOCK;">D3DDDICB_LOCK</a></p>

<p><a href="dxgkarg_acquireswizzlingrange" title="typedef struct _DXGKARG_ACQUIRESWIZZLINGRANGE {&#10;  [in]     HANDLE           hAllocation;&#10;  [in]     UINT             PrivateDriverData;&#10;  [in]     UINT             RangeId;&#10;  [in]     UINT             SegmentId;&#10;  [in]     SIZE_T           RangeSize;&#10;  [in/out] PHYSICAL_ADDRESS CPUTranslatedAddress;&#10;} DXGKARG_ACQUIRESWIZZLINGRANGE;">DXGKARG_ACQUIRESWIZZLINGRANGE</a></p>

<p><a href="dxgk_drivercaps" title="typedef struct _DXGK_DRIVERCAPS {&#10;  [out] PHYSICAL_ADDRESS                   HighestAcceptableAddress;&#10;  [out] UINT                               MaxAllocationListSlotId;&#10;  [out] SIZE_T                             ApertureSegmentCommitLimit;&#10;  [out] UINT                               MaxPointerWidth;&#10;  [out] UINT                               MaxPointerHeight;&#10;  [out] DXGK_POINTERFLAGS                  PointerCaps;&#10;  [out] UINT                               InterruptMessageNumber;&#10;  [out] UINT                               NumberOfSwizzlingRanges;&#10;  [out] UINT                               MaxOverlays;&#10;  union {&#10;    [out] DXGK_GAMMARAMPCAPS      GammaRampCaps;&#10;    [out] DXGK_COLORTRANSFORMCAPS ColorTransformCaps;&#10;  };&#10;  [out] DXGK_PRESENTATIONCAPS              PresentationCaps;&#10;  [out] UINT                               MaxQueuedFlipOnVSync;&#10;  [out] DXGK_FLIPCAPS                      FlipCaps;&#10;  [out] DXGK_VIDSCHCAPS                    SchedulingCaps;&#10;  [out] DXGK_VIDMMCAPS                     MemoryManagementCaps;&#10;  [out] DXGK_GPUENGINETOPOLOGY             GpuEngineTopology;&#10;...">DXGK_DRIVERCAPS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/dispmprt/nc-dispmprt-dxgkddi_add_device">DxgkDdiAddDevice</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createallocation">DxgkDdiCreateAllocation</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo">DxgkDdiQueryAdapterInfo</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_releaseswizzlingrange">DxgkDdiReleaseSwizzlingRange</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb">pfnLockCb</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_acquireswizzlingrange">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/nc-d3dkmddi-dxgkddi_acquireswizzlingrange.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
