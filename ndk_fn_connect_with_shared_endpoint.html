<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDK_FN_CONNECT_WITH_SHARED_ENDPOINT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDK_FN_CONNECT_WITH_SHARED_ENDPOINT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDK_FN_CONNECT_WITH_SHARED_ENDPOINT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndkpi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDK_FN_CONNECT_WITH_SHARED_ENDPOINT NdkFnConnectWithSharedEndpoint;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> NdkFnConnectWithSharedEndpoint(
  [in]                                      <a href="ndk_connector" title="typedef struct _NDK_CONNECTOR {&#10;  NDK_OBJECT_HEADER            Header;&#10;  const NDK_CONNECTOR_DISPATCH *Dispatch;&#10;} NDK_CONNECTOR;">NDK_CONNECTOR</a> *pNdkConnector,
  [in]                                      <a href="ndk_qp" title="typedef struct _NDK_QP {&#10;  NDK_OBJECT_HEADER     Header;&#10;  const NDK_QP_DISPATCH *Dispatch;&#10;} NDK_QP;">NDK_QP</a> *pNdkQp,
  [in]                                      <a href="ndk_shared_endpoint" title="typedef struct _NDK_SHARED_ENDPOINT {&#10;  NDK_OBJECT_HEADER                  Header;&#10;  const NDK_SHARED_ENDPOINT_DISPATCH *Dispatch;&#10;} NDK_SHARED_ENDPOINT;">NDK_SHARED_ENDPOINT</a> *pNdkSharedEndpoint,
                                            const PSOCKADDR pDestAddress,
  [in]                                      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> DestAddressLength,
  [in]                                      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> InboundReadLimit,
  [in]                                      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> OutboundReadLimit,
  [_In_reads_bytes_opt_(PrivateDataLength)] const PVOID pPrivateData,
  [in]                                      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PrivateDataLength,
  [in]                                      <a href="ndk_fn_request_completion" title="NDK_FN_REQUEST_COMPLETION NdkFnRequestCompletion;&#10;&#10;VOID NdkFnRequestCompletion(&#10;  [in, optional] PVOID Context,&#10;  [in]           NTSTATUS Status&#10;)&#10;{...}">NDK_FN_REQUEST_COMPLETION</a> RequestCompletion,
  [in, optional]                            PVOID RequestContext
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndkpi/nc-ndkpi-ndk_fn_connect_with_shared_endpoint">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndk_fn_connect_with_shared_endpoint.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndkpi-ndk_fn_connect_with_shared_endpoint)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndk_fn_connect_with_shared_endpoint-callback-function">NDK_FN_CONNECT_WITH_SHARED_ENDPOINT callback function</h1>

<h2 id="description">Description</h2>

<p>The <em>NdkConnectWithSharedEndpoint</em> (<em>NDK_FN_CONNECT_WITH_SHARED_ENDPOINT</em>) function initiates an NDK connect request from a shared local address to a remote address.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="pndkconnector-in"><code>pNdkConnector</code> [in]</h3>

<p>A pointer to an NDK connector object (<a href="ndk_connector" title="typedef struct _NDK_CONNECTOR {&#10;  NDK_OBJECT_HEADER            Header;&#10;  const NDK_CONNECTOR_DISPATCH *Dispatch;&#10;} NDK_CONNECTOR;">NDK_CONNECTOR</a>).</p>

<h3 id="pndkqp-in"><code>pNdkQp</code> [in]</h3>

<p>A pointer to an NDK queue pair (QP) object (<a href="ndk_qp" title="typedef struct _NDK_QP {&#10;  NDK_OBJECT_HEADER     Header;&#10;  const NDK_QP_DISPATCH *Dispatch;&#10;} NDK_QP;">NDK_QP</a>) to be associated with the connection.</p>

<h3 id="pndksharedendpoint-in"><code>pNdkSharedEndpoint</code> [in]</h3>

<p>A pointer to an NDK shared endpoint object (<a href="ndk_shared_endpoint" title="typedef struct _NDK_SHARED_ENDPOINT {&#10;  NDK_OBJECT_HEADER                  Header;&#10;  const NDK_SHARED_ENDPOINT_DISPATCH *Dispatch;&#10;} NDK_SHARED_ENDPOINT;">NDK_SHARED_ENDPOINT</a>) that determines the local address for the connection.</p>

<h3 id="pdestaddress"><code>pDestAddress</code></h3>

<p>A destination address. For AF_INET or AF_INET6 <em>pDestAddress</em> is the destination IP address and the destination ND port.</p>

<h3 id="destaddresslength-in"><code>DestAddressLength</code> [in]</h3>

<p>The size, in bytes, of destination address data at the <em>pDestAddress.</em> parameter.</p>

<h3 id="inboundreadlimit-in"><code>InboundReadLimit</code> [in]</h3>

<p>The consumer-supplied maximum number of incoming in-progress read operations to allow on the QP. If the underlying provider has a lower <strong>MaxInboundReadLimit</strong> value in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ndkinfo/ns-ndkinfo-ndk_adapter_info">NDK_ADAPTER_INFO</a> structure, then the provider will cap the consumer-supplied value to the provider maximum. If the peer has a lower <em>OutboundReadLimit</em> value, then the provider will use that value as the effective <em>InboundReadLimit</em>. The consumer can retrieve the effective <em>InboundReadLimit</em> by calling the <em>NdkGetConnectionData</em> function (<a href="ndk_fn_get_connection_data" title="NDK_FN_GET_CONNECTION_DATA NdkFnGetConnectionData;&#10;&#10;NTSTATUS NdkFnGetConnectionData(&#10;  [in]            NDK_CONNECTOR *pNdkConnector,&#10;  [out, optional] ULONG *pInboundReadLimit,&#10;  [out, optional] ULONG *pOutboundReadLimit,&#10;                  PVOID pPrivateData,&#10;                  ULONG *pPrivateDataLength&#10;)&#10;{...}">NDK_FN_GET_CONNECTION_DATA</a>).</p>

<h3 id="outboundreadlimit-in"><code>OutboundReadLimit</code> [in]</h3>

<p>The consumer-supplied maximum number of outgoing in-progress read operations to allow on the QP. If the underlying provider has a lower <strong>MaxOutboundReadLimit</strong> value in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ndkinfo/ns-ndkinfo-ndk_adapter_info">NDK_ADAPTER_INFO</a> structure, then the provider will cap the consumer supplied value to the provider maximum. If the peer has a lower <em>InboundReadLimit</em>, then the provider will use that value as the effective <em>OutboundReadLimit</em>. The consumer can retrieve the effective <em>OutboundReadLimit</em> by calling the <em>NdkGetConnectionData</em> function (<a href="ndk_fn_get_connection_data" title="NDK_FN_GET_CONNECTION_DATA NdkFnGetConnectionData;&#10;&#10;NTSTATUS NdkFnGetConnectionData(&#10;  [in]            NDK_CONNECTOR *pNdkConnector,&#10;  [out, optional] ULONG *pInboundReadLimit,&#10;  [out, optional] ULONG *pOutboundReadLimit,&#10;                  PVOID pPrivateData,&#10;                  ULONG *pPrivateDataLength&#10;)&#10;{...}">NDK_FN_GET_CONNECTION_DATA</a>).</p>

<h3 id="pprivatedata-_in_reads_bytes_opt_privatedatalength"><code>pPrivateData</code> [_In_reads_bytes_opt_(PrivateDataLength)]</h3>

<p>A pointer to private data that is sent with the connect request.</p>

<h3 id="privatedatalength-in"><code>PrivateDataLength</code> [in]</h3>

<p>The length, in bytes, of the private data that is provided in the <em>pPrivateData</em> parameter.</p>

<h3 id="requestcompletion-in"><code>RequestCompletion</code> [in]</h3>

<p>A pointer to a request completion callback routine <em>NdkRequestCompletion</em> (<a href="ndk_fn_request_completion" title="NDK_FN_REQUEST_COMPLETION NdkFnRequestCompletion;&#10;&#10;VOID NdkFnRequestCompletion(&#10;  [in, optional] PVOID Context,&#10;  [in]           NTSTATUS Status&#10;)&#10;{...}">NDK_FN_REQUEST_COMPLETION</a>).</p>

<h3 id="requestcontext-in-optional"><code>RequestContext</code> [in, optional]</h3>

<p>A context value to pass to the <em>Context</em> parameter of the callback function that is specified in the <em>RequestCompletion</em> parameter.</p>

<h2 id="return-value">Return value</h2>

<p>The
<em>NdkConnectWithSharedEndpoint</em> function returns one of the following <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> codes.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>The connect request was completed successfully.</td>
</tr>
<tr>
  <td><strong>STATUS_PENDING</strong></td>
  <td>The operation is pending and will be completed later. The driver will call the specified <em>RequestCompletion</em> (<a href="ndk_fn_request_completion" title="NDK_FN_REQUEST_COMPLETION NdkFnRequestCompletion;&#10;&#10;VOID NdkFnRequestCompletion(&#10;  [in, optional] PVOID Context,&#10;  [in]           NTSTATUS Status&#10;)&#10;{...}">NDK_FN_REQUEST_COMPLETION</a>) function to complete the pending operation.</td>
</tr>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>The request failed due to insufficient resources. &lt;br&gt;&lt;br&gt;<strong>Important</strong> The request can fail inline as well as asynchronously with this status code.</td>
</tr>
<tr>
  <td><strong>STATUS_NETWORK_UNREACHABLE</strong></td>
  <td>The request failed because the remote network was not reachable. The connection attempt may be retried. &lt;br&gt;&lt;br&gt;<strong>Important</strong> The request can fail inline as well as asynchronously with this status code.</td>
</tr>
<tr>
  <td><strong>STATUS_HOST_UNREACHABLE</strong></td>
  <td>The request failed because the remote system was not reachable. The connection attempt may be retried. &lt;br&gt;&lt;br&gt;<strong>Important</strong> The request can fail inline as well as asynchronously with this status code.</td>
</tr>
<tr>
  <td><strong>STATUS_CONNECTION_REFUSED</strong></td>
  <td>The request failed because the remote system refused the connection request. This can be due to lack of listener, backlog limits, or the peer actively rejecting the connection request. The connection attempt may be retried. &lt;br&gt;&lt;br&gt;<strong>Important</strong> The request can fail inline as well as asynchronously with this status code.</td>
</tr>
<tr>
  <td><strong>STATUS_IO_TIMEOUT</strong></td>
  <td>The request failed because the connection request timed out. The connection attempt may be retried. Timeout values are selected by Network Direct providers to match their respective network characteristics.&lt;br&gt;&lt;br&gt;<strong>Important</strong> The request can fail inline as well as asynchronously with this status code.</td>
</tr>
<tr>
  <td><strong>STATUS_ADDRESS_ALREADY_EXISTS</strong></td>
  <td>The request failed because a connection with the combination of local address, local port, remote address, and remote port already exists. &lt;br&gt;&lt;br&gt;<strong>Important</strong> The request can fail inline as well as asynchronously with this status code.</td>
</tr>
<tr>
  <td><strong>Other status codes</strong></td>
  <td>An error occurred.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p><em>NdkConnectWithSharedEndpoint</em> initiates a connect request from a shared local address to a specific remote address. <em>NdkConnectWithSharedEndpoint</em> allows an NDK consumer to use the same local address (for example, 10.1.1.1:9999) for many outgoing connections when the destination addresses for the connections are different.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndkpi-object-lifetime-requirements">NDKPI Object Lifetime Requirements</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ndkinfo/ns-ndkinfo-ndk_adapter_info">NDK_ADAPTER_INFO</a></p>

<p><a href="ndk_connector" title="typedef struct _NDK_CONNECTOR {&#10;  NDK_OBJECT_HEADER            Header;&#10;  const NDK_CONNECTOR_DISPATCH *Dispatch;&#10;} NDK_CONNECTOR;">NDK_CONNECTOR</a></p>

<p><a href="ndk_connector_dispatch" title="typedef struct _NDK_CONNECTOR_DISPATCH {&#10;  NDK_FN_CLOSE_OBJECT                 NdkCloseConnector;&#10;  NDK_FN_QUERY_EXTENSION_INTERFACE    NdkQueryExtension;&#10;  NDK_FN_CONNECT                      NdkConnect;&#10;  NDK_FN_CONNECT_WITH_SHARED_ENDPOINT NdkConnectWithSharedEndpoint;&#10;  NDK_FN_COMPLETE_CONNECT             NdkCompleteConnect;&#10;  NDK_FN_ACCEPT                       NdkAccept;&#10;  NDK_FN_REJECT                       NdkReject;&#10;  NDK_FN_GET_CONNECTION_DATA          NdkGetConnectionData;&#10;  NDK_FN_GET_LOCAL_ADDRESS            NdkGetLocalAddress;&#10;  NDK_FN_GET_PEER_ADDRESS             NdkGetPeerAddress;&#10;  NDK_FN_DISCONNECT                   NdkDisconnect;&#10;  NDK_FN_COMPLETE_CONNECT_EX          NdkCompleteConnectEx;&#10;  NDK_FN_ACCEPT_EX                    NdkAcceptEx;&#10;} NDK_CONNECTOR_DISPATCH;">NDK_CONNECTOR_DISPATCH</a></p>

<p><a href="ndk_fn_get_connection_data" title="NDK_FN_GET_CONNECTION_DATA NdkFnGetConnectionData;&#10;&#10;NTSTATUS NdkFnGetConnectionData(&#10;  [in]            NDK_CONNECTOR *pNdkConnector,&#10;  [out, optional] ULONG *pInboundReadLimit,&#10;  [out, optional] ULONG *pOutboundReadLimit,&#10;                  PVOID pPrivateData,&#10;                  ULONG *pPrivateDataLength&#10;)&#10;{...}">NDK_FN_GET_CONNECTION_DATA</a></p>

<p><a href="ndk_fn_request_completion" title="NDK_FN_REQUEST_COMPLETION NdkFnRequestCompletion;&#10;&#10;VOID NdkFnRequestCompletion(&#10;  [in, optional] PVOID Context,&#10;  [in]           NTSTATUS Status&#10;)&#10;{...}">NDK_FN_REQUEST_COMPLETION</a></p>

<p><a href="ndk_qp" title="typedef struct _NDK_QP {&#10;  NDK_OBJECT_HEADER     Header;&#10;  const NDK_QP_DISPATCH *Dispatch;&#10;} NDK_QP;">NDK_QP</a></p>

<p><a href="ndk_shared_endpoint" title="typedef struct _NDK_SHARED_ENDPOINT {&#10;  NDK_OBJECT_HEADER                  Header;&#10;  const NDK_SHARED_ENDPOINT_DISPATCH *Dispatch;&#10;} NDK_SHARED_ENDPOINT;">NDK_SHARED_ENDPOINT</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndkpi/nc-ndkpi-ndk_fn_connect_with_shared_endpoint">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndkpi/nc-ndkpi-ndk_fn_connect_with_shared_endpoint.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
