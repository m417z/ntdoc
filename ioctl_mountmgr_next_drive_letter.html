<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_MOUNTMGR_NEXT_DRIVE_LETTER - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_MOUNTMGR_NEXT_DRIVE_LETTER - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_MOUNTMGR_NEXT_DRIVE_LETTER - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTIOAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">#define IOCTL_MOUNTMGR_NEXT_DRIVE_LETTER            <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(<a href="mountmgrcontroltype" title="#define MOUNTMGRCONTROLTYPE 0x0000006D // &#x27;m&#x27;">MOUNTMGRCONTROLTYPE</a>, 4, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/b281a48adceb1d88b4db663cbaf84ab06cc7074d/phnt/include/ntioapi.h#L3240">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// mountmgr.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x006d, 0x004, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
#define IOCTL_MOUNTMGR_NEXT_DRIVE_LETTER 0x006DC010</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mountmgr/ni-mountmgr-ioctl_mountmgr_next_drive_letter">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This IOCTL is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/mountmgr/ni-mountmgr-ioctl_mountmgr_next_drive_letter">documented in Windows Driver Kit</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_mountmgr_next_drive_letter.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-mountmgr-ioctl_mountmgr_next_drive_letter)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>This IOCTL checks to see if the given volume has a drive letter. If it already has a drive letter, or if the volume has a special mount manager database entry indicating that it does not require a drive letter, this routine returns the current drive letter (if there is one) and does nothing. If the given volume does not have a drive letter and does not have a special mount manager database entry indicating that it does not require a drive letter, the next available drive letter is assigned to the volume. If the volume's nonpersistent device name begins with "\Device\Floppy", the mount manager will check for available drive letters starting with the letter "A." If the volume name begins with "\Device\CdRom" the mount manager will check for available drive letters starting with drive letter "D." In all other cases, the mount manager starts with drive letter "C."</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/irp-mj-device-control">IRP_MJ_DEVICE_CONTROL</a></p>

<h3 id="input-buffer">Input buffer</h3>

<p>The mount manager client initializes the <strong><a href="mountmgr_drive_letter_target" title="typedef struct _MOUNTMGR_DRIVE_LETTER_TARGET&#10;{&#10;    USHORT DeviceNameLength;&#10;    _Field_size_bytes_(DeviceNameLength) WCHAR DeviceName[1];&#10;} MOUNTMGR_DRIVE_LETTER_TARGET, *PMOUNTMGR_DRIVE_LETTER_TARGET;">MOUNTMGR_DRIVE_LETTER_TARGET</a></strong> structure at the beginning of the buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong>. The client must insert the name of the target volume at the address pointed to by the <strong>DeviceName[]</strong> member of this structure. The target volume name is the name of the nonpersistent device object associated with the volume (for example, "\Device\HarddiskVolume1").</p>

<h3 id="input-buffer-length">Input buffer length</h3>

<p><strong>Parameters.DeviceIoControl.InputBufferLength</strong> in the I/O stack location of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the size, in bytes, of the input buffer, which must be greater than or equal to <code>sizeof(<a href="mountmgr_drive_letter_target" title="typedef struct _MOUNTMGR_DRIVE_LETTER_TARGET&#10;{&#10;    USHORT DeviceNameLength;&#10;    _Field_size_bytes_(DeviceNameLength) WCHAR DeviceName[1];&#10;} MOUNTMGR_DRIVE_LETTER_TARGET, *PMOUNTMGR_DRIVE_LETTER_TARGET;">MOUNTMGR_DRIVE_LETTER_TARGET</a>)</code>.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>The mount manager inserts either the current drive letter or the newly assigned drive letter (see previous discussion) in the <strong><a href="mountmgr_drive_letter_information" title="typedef struct _MOUNTMGR_DRIVE_LETTER_INFORMATION&#10;{&#10;    BOOLEAN DriveLetterWasAssigned;&#10;    UCHAR CurrentDriveLetter;&#10;} MOUNTMGR_DRIVE_LETTER_INFORMATION, *PMOUNTMGR_DRIVE_LETTER_INFORMATION;">MOUNTMGR_DRIVE_LETTER_INFORMATION</a></strong> structure at the beginning of the buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong>.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p><strong>Parameters.DeviceIoControl.OutputBufferLength</strong> in the I/O stack location of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the size, in bytes, of the output buffer, which must be greater than or equal to <code>sizeof(<a href="mountmgr_drive_letter_information" title="typedef struct _MOUNTMGR_DRIVE_LETTER_INFORMATION&#10;{&#10;    BOOLEAN DriveLetterWasAssigned;&#10;    UCHAR CurrentDriveLetter;&#10;} MOUNTMGR_DRIVE_LETTER_INFORMATION, *PMOUNTMGR_DRIVE_LETTER_INFORMATION;">MOUNTMGR_DRIVE_LETTER_INFORMATION</a>)</code>.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<p>N/A</p>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<p>N/A</p>

<h3 id="status-block">Status block</h3>

<p>If the operation is successful , the <strong>Status</strong> field is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>.</p>

<p>If <strong>InputBufferLength</strong> is less than <code>sizeof(<a href="mountmgr_drive_letter_target" title="typedef struct _MOUNTMGR_DRIVE_LETTER_TARGET&#10;{&#10;    USHORT DeviceNameLength;&#10;    _Field_size_bytes_(DeviceNameLength) WCHAR DeviceName[1];&#10;} MOUNTMGR_DRIVE_LETTER_TARGET, *PMOUNTMGR_DRIVE_LETTER_TARGET;">MOUNTMGR_DRIVE_LETTER_TARGET</a>)</code> or if <strong>OutputBufferLength</strong> is less than <code>sizeof(<a href="mountmgr_drive_letter_information" title="typedef struct _MOUNTMGR_DRIVE_LETTER_INFORMATION&#10;{&#10;    BOOLEAN DriveLetterWasAssigned;&#10;    UCHAR CurrentDriveLetter;&#10;} MOUNTMGR_DRIVE_LETTER_INFORMATION, *PMOUNTMGR_DRIVE_LETTER_INFORMATION;">MOUNTMGR_DRIVE_LETTER_INFORMATION</a>)</code>, the <strong>Status</strong> field is set to STATUS_INVALID_PARAMETER.</p>

<h2 id="remarks">Remarks</h2>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/supporting-mount-manager-requests-in-a-storage-class-driver">Supporting Mount Manager Requests in a Storage Class Driver</a>.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="mountmgr_drive_letter_target" title="typedef struct _MOUNTMGR_DRIVE_LETTER_TARGET&#10;{&#10;    USHORT DeviceNameLength;&#10;    _Field_size_bytes_(DeviceNameLength) WCHAR DeviceName[1];&#10;} MOUNTMGR_DRIVE_LETTER_TARGET, *PMOUNTMGR_DRIVE_LETTER_TARGET;">MOUNTMGR_DRIVE_LETTER_TARGET</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/mountmgr/ni-mountmgr-ioctl_mountmgr_next_drive_letter">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/mountmgr/ni-mountmgr-ioctl_mountmgr_next_drive_letter.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
