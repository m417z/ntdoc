<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_DISK_PERFORMANCE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_DISK_PERFORMANCE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_DISK_PERFORMANCE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntdddisk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0007, 0x008, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_DISK_PERFORMANCE 0x00070020</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntdddisk/ni-ntdddisk-ioctl_disk_performance">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0007, 0x008, METHOD_BUFFERED, FILE_ANY_ACCESS)
#define IOCTL_DISK_PERFORMANCE 0x00070020</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-ioctl_disk_performance">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_disk_performance.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ntdddisk-ioctl_disk_performance)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>IOCTL_DISK_PERFORMANCE IOCTL</h1>
<h2>Description</h2>
<p>Increments a reference counter that enables the collection of disk performance statistics, such as the numbers of bytes read and written since the driver last processed this request, for a corresponding disk monitoring application. In Microsoft Windows 2000 this IOCTL is handled by the filter driver diskperf. In Windows XP and later operating systems, the partition manager handles this request for disks and <em>ftdisk.sys</em> and <em>dmio.sys</em> handle this request for volumes.</p>
<h2>Parameters</h2>
<h3>Major code</h3>
<h3>Input buffer</h3>
<p>None.</p>
<h3>Input buffer length</h3>
<p>None.</p>
<h3>Output buffer</h3>
<p>The driver returns the <a href="disk_performance" title="typedef struct _DISK_PERFORMANCE {&#10;  LARGE_INTEGER BytesRead;&#10;  LARGE_INTEGER BytesWritten;&#10;  LARGE_INTEGER ReadTime;&#10;  LARGE_INTEGER WriteTime;&#10;  LARGE_INTEGER IdleTime;&#10;  ULONG         ReadCount;&#10;  ULONG         WriteCount;&#10;  ULONG         QueueDepth;&#10;  ULONG         SplitCount;&#10;  LARGE_INTEGER QueryTime;&#10;  ULONG         StorageDeviceNumber;&#10;  WCHAR         StorageManagerName[8];&#10;} DISK_PERFORMANCE, *PDISK_PERFORMANCE;">DISK_PERFORMANCE</a> data in the buffer at <strong>Irp-&gt;AssociatedIrp.SystemBuffer</strong>.</p>
<h3>Output buffer length</h3>
<p><strong>Parameters.DeviceIoControl.OutputBufferLength</strong> in the I/O stack location of the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> indicates the size, in bytes, of the buffer, which must be at least <strong>sizeof</strong>(<a href="disk_performance" title="typedef struct _DISK_PERFORMANCE {&#10;  LARGE_INTEGER BytesRead;&#10;  LARGE_INTEGER BytesWritten;&#10;  LARGE_INTEGER ReadTime;&#10;  LARGE_INTEGER WriteTime;&#10;  LARGE_INTEGER IdleTime;&#10;  ULONG         ReadCount;&#10;  ULONG         WriteCount;&#10;  ULONG         QueueDepth;&#10;  ULONG         SplitCount;&#10;  LARGE_INTEGER QueryTime;&#10;  ULONG         StorageDeviceNumber;&#10;  WCHAR         StorageManagerName[8];&#10;} DISK_PERFORMANCE, *PDISK_PERFORMANCE;">DISK_PERFORMANCE</a>).</p>
<h3>Input/output buffer</h3>
<h3>Input/output buffer length</h3>
<h3>Status block</h3>
<p>The <strong>Information</strong> field is set to <strong>sizeof</strong>(<a href="disk_performance" title="typedef struct _DISK_PERFORMANCE {&#10;  LARGE_INTEGER BytesRead;&#10;  LARGE_INTEGER BytesWritten;&#10;  LARGE_INTEGER ReadTime;&#10;  LARGE_INTEGER WriteTime;&#10;  LARGE_INTEGER IdleTime;&#10;  ULONG         ReadCount;&#10;  ULONG         WriteCount;&#10;  ULONG         QueueDepth;&#10;  ULONG         SplitCount;&#10;  LARGE_INTEGER QueryTime;&#10;  ULONG         StorageDeviceNumber;&#10;  WCHAR         StorageManagerName[8];&#10;} DISK_PERFORMANCE, *PDISK_PERFORMANCE;">DISK_PERFORMANCE</a>) when the <strong>Status</strong> field is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>. Otherwise, the <strong>Status</strong> field can be set to STATUS_INVALID_PARAMETER or STATUS_BUFFER_TOO_SMALL.</p>
<h2>See also</h2>
<p><a href="ioctl_disk_performance_off" title="// CTL_CODE(0x0007, 0x018, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_DISK_PERFORMANCE_OFF 0x00070060">IOCTL_DISK_PERFORMANCE_OFF</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntdddisk/ni-ntdddisk-ioctl_disk_performance">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntdddisk/ni-ntdddisk-ioctl_disk_performance.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (ni-winioctl-ioctl_disk_performance)</h1>
</div>
<div class="ntdoc-description">
<h1>IOCTL_DISK_PERFORMANCE IOCTL</h1>
<h2>Description</h2>
<p>Enables performance counters that provide disk performance information.</p>
<p>To perform this operation, call the <a href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function with the following parameters.</p>
<pre lang="cpp"><code>BOOL DeviceIoControl(
  (HANDLE) hDevice,             // handle to device
  IOCTL_DISK_PERFORMANCE,       // dwIoControlCode
  NULL,                         // lpInBuffer
  0,                            // nInBufferSize
  (LPVOID) lpOutBuffer,         // output buffer
  (<a href="dword" title="typedef unsigned long DWORD;">DWORD</a>) nOutBufferSize,       // size of output buffer
  (LPDWORD) lpBytesReturned,    // number of bytes returned
  (LPOVERLAPPED) lpOverlapped   // OVERLAPPED structure
);
</code></pre>
<h2>Parameters</h2>
<h3>Input buffer</h3>
<h3>Input buffer length</h3>
<h3>Output buffer</h3>
<h3>Output buffer length</h3>
<h3>Input/output buffer</h3>
<h3>Input/output buffer length</h3>
<h3>Status block</h3>
<p>Irp-&gt;IoStatus.Status is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the request is successful.</p>
<p>Otherwise, Status to the appropriate error condition as a <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> code.</p>
<p>For more information, see <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS Values</a>.</p>
<h2>Remarks</h2>
<p>To disable the performance counters enabled by this control code, use the <a href="ioctl_disk_performance_off" title="// CTL_CODE(0x0007, 0x018, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_DISK_PERFORMANCE_OFF 0x00070060">IOCTL_DISK_PERFORMANCE_OFF</a> control code.</p>
<h2>See also</h2>
<ul>
<li><a href="disk_performance" title="typedef struct _DISK_PERFORMANCE {&#10;  LARGE_INTEGER BytesRead;&#10;  LARGE_INTEGER BytesWritten;&#10;  LARGE_INTEGER ReadTime;&#10;  LARGE_INTEGER WriteTime;&#10;  LARGE_INTEGER IdleTime;&#10;  ULONG         ReadCount;&#10;  ULONG         WriteCount;&#10;  ULONG         QueueDepth;&#10;  ULONG         SplitCount;&#10;  LARGE_INTEGER QueryTime;&#10;  ULONG         StorageDeviceNumber;&#10;  WCHAR         StorageManagerName[8];&#10;} DISK_PERFORMANCE, *PDISK_PERFORMANCE;">DISK_PERFORMANCE</a></li>
<li><a href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol">DeviceIoControl</a></li>
<li><a href="https://learn.microsoft.com/windows/desktop/FileIO/disk-management-control-codes">Disk Management Control Codes</a></li>
<li><a href="ioctl_disk_performance_off" title="// CTL_CODE(0x0007, 0x018, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_DISK_PERFORMANCE_OFF 0x00070060">IOCTL_DISK_PERFORMANCE_OFF</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-ioctl_disk_performance">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winioctl/ni-winioctl-ioctl_disk_performance.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
