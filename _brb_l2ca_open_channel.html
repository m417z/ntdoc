<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="_BRB_L2CA_OPEN_CHANNEL - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>_BRB_L2CA_OPEN_CHANNEL - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            _BRB_L2CA_OPEN_CHANNEL - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// bthddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">struct _BRB_L2CA_OPEN_CHANNEL {
  <a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a>                     Hdr;
  L2CAP_CHANNEL_HANDLE           ChannelHandle;
  union {
    struct {
      <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a> Response;
      <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a> ResponseStatus;
    };
    <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a> Psm;
  };
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                          ChannelFlags;
  BTH_ADDR                       BtAddress;
  struct {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                    Flags;
    <a href="l2cap_config_value_range" title="typedef struct _L2CAP_CONFIG_VALUE_RANGE {&#10;  USHORT Min;&#10;  USHORT Preferred;&#10;  USHORT Max;&#10;} L2CAP_CONFIG_VALUE_RANGE, *PL2CAP_CONFIG_VALUE_RANGE;">L2CAP_CONFIG_VALUE_RANGE</a> Mtu;
    <a href="l2cap_config_value_range" title="typedef struct _L2CAP_CONFIG_VALUE_RANGE {&#10;  USHORT Min;&#10;  USHORT Preferred;&#10;  USHORT Max;&#10;} L2CAP_CONFIG_VALUE_RANGE, *PL2CAP_CONFIG_VALUE_RANGE;">L2CAP_CONFIG_VALUE_RANGE</a> FlushTO;
    <a href="l2cap_flowspec" title="typedef struct _L2CAP_FLOWSPEC {&#10;  UCHAR Flags;&#10;  UCHAR ServiceType;&#10;  ULONG TokenRate;&#10;  ULONG TokenBucketSize;&#10;  ULONG PeakBandwidth;&#10;  ULONG Latency;&#10;  ULONG DelayVariation;&#10;} L2CAP_FLOWSPEC, *PL2CAP_FLOWSPEC;">L2CAP_FLOWSPEC</a>           Flow;
    <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>                   LinkTO;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                    NumExtraOptions;
    <a href="l2cap_config_option" title="typedef struct _L2CAP_CONFIG_OPTION {&#10;  CO_HEADER Header;&#10;  VOID      *DynamicBuffer;&#10;  UCHAR     FixedBuffer[4];&#10;  USHORT    Flags;&#10;} L2CAP_CONFIG_OPTION, *PL2CAP_CONFIG_OPTION;">PL2CAP_CONFIG_OPTION</a>     ExtraOptions;
    struct {
      <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a> ServiceType;
      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Latency;
    } LocalQos;
  } ConfigOut;
  struct {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                    Flags;
    <a href="l2cap_config_value_range" title="typedef struct _L2CAP_CONFIG_VALUE_RANGE {&#10;  USHORT Min;&#10;  USHORT Preferred;&#10;  USHORT Max;&#10;} L2CAP_CONFIG_VALUE_RANGE, *PL2CAP_CONFIG_VALUE_RANGE;">L2CAP_CONFIG_VALUE_RANGE</a> Mtu;
    <a href="l2cap_config_range" title="typedef struct _L2CAP_CONFIG_RANGE {&#10;  USHORT Min;&#10;  USHORT Max;&#10;} L2CAP_CONFIG_RANGE, *PL2CAP_CONFIG_RANGE;">L2CAP_CONFIG_RANGE</a>       FlushTO;
  } ConfigIn;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                          CallbackFlags;
  <a href="pfnbthport_indication_callback" title="PFNBTHPORT_INDICATION_CALLBACK PfnbthportIndicationCallback;&#10;&#10;void PfnbthportIndicationCallback(&#10;  [in] PVOID Context,&#10;  [in] INDICATION_CODE Indication,&#10;  [in] PINDICATION_PARAMETERS Parameters&#10;)&#10;{...}">PFNBTHPORT_INDICATION_CALLBACK</a> Callback;
  PVOID                          CallbackContext;
  PVOID                          ReferenceObject;
  <a href="channel_config_results" title="typedef struct _CHANNEL_CONFIG_RESULTS {&#10;  CHANNEL_CONFIG_PARAMETERS Params;&#10;  ULONG                     ExtraOptionsBufferSize;&#10;} CHANNEL_CONFIG_RESULTS, *PCHANNEL_CONFIG_RESULTS;">CHANNEL_CONFIG_RESULTS</a>         OutResults;
  <a href="channel_config_results" title="typedef struct _CHANNEL_CONFIG_RESULTS {&#10;  CHANNEL_CONFIG_PARAMETERS Params;&#10;  ULONG                     ExtraOptionsBufferSize;&#10;} CHANNEL_CONFIG_RESULTS, *PCHANNEL_CONFIG_RESULTS;">CHANNEL_CONFIG_RESULTS</a>         InResults;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                          IncomingQueueDepth;
};</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/ns-bthddi-_brb_l2ca_open_channel">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/_brb_l2ca_open_channel.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-bthddi-_brb_l2ca_open_channel)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_brb_l2ca_open_channel-structure">_BRB_L2CA_OPEN_CHANNEL structure</h1>

<h2 id="description">Description</h2>

<p>The _BRB_L2CA_OPEN_CHANNEL structure describes a L2CAP channel to open to a remote device, or a response from the profile driver accepting or rejecting an incoming L2CAP connection request that was initiated by a remote device.</p>

<h2 id="members">Members</h2>

<h3 id="hdr"><code>Hdr</code></h3>

<p>A <a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a> structure that contains information about the current <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>.</p>

<h3 id="channelhandle"><code>ChannelHandle</code></h3>

<p>Handle used to identify the connection upon a successful connect. When sending a <strong>BRB_L2CA_OPEN_CHANNEL</strong>, this will be filled in when the <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> completes. When sending a <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong>, this must be filled in by the server before sending down the <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>. The value assigned should be <code><a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">INDICATION_PARAMETERS</a>::ConnectionHandle</code> which was passed in during IndicationRemoteConnect.</p>

<h3 id="response"><code>Response</code></h3>

<p>Used only with <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong>. One of the CONNECT_RSP_RESULT_Xxx values is used.</p>

<p>If the <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> returns with a status of STATUS_REQUEST_NOT_ACCEPTED, then <em>Response</em> will contain the negative response from the remote host.</p>

<h3 id="responsestatus"><code>ResponseStatus</code></h3>

<p>If <em>Response</em> is equal to CONNECT_RSP_RESULT_PENDING, then this field is valid. One of the CONNECT_RSP_STATUS_XXX values is used.</p>

<h3 id="psm"><code>Psm</code></h3>

<p>The Protocol/Service Multiplexer (PSM) that the channel uses to connect to the remote device. When used with a <strong>BRB_L2CA_OPEN_CHANNEL</strong> request, this member is set as an input field. When used with a <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> request, this member is used as an output field.</p>

<h3 id="channelflags"><code>ChannelFlags</code></h3>

<p>Flags that specify the requirements for the channel to be opened. Valid flag values are listed in the following table:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CF_LINK_AUTHENTICATED</td>
  <td>The link must be authenticated.</td>
</tr>
<tr>
  <td>CF_LINK_ENCRYPTED</td>
  <td>The link must be encrypted. Setting this flag also sets the CF_LINK_AUTHENTICATED flag.</td>
</tr>
<tr>
  <td>CF_LINK_SUPPRESS_PIN</td>
  <td>The profile driver indicates its preference that users not be prompted for a PIN.</td>
</tr>
</tbody>
</table>

<h3 id="btaddress"><code>BtAddress</code></h3>

<p>The Bluetooth address of the device for which the connection is intended.</p>

<h3 id="configout"><code>ConfigOut</code></h3>

<p>The substructure that contains parameter settings for a <strong>BRB_L2CA_OPEN_CHANNEL</strong> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> sent to a remote device.</p>

<h3 id="configoutflags"><code>ConfigOut.Flags</code></h3>

<p>Flags that specify the requirements for the channel to be opened. Valid flag values are listed in the following table:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CF_LINK_AUTHENTICATED</td>
  <td>The link must be authenticated.</td>
</tr>
<tr>
  <td>CF_LINK_ENCRYPTED</td>
  <td>The link must be encrypted. Setting this flag also sets the CF_LINK_AUTHENTICATED flag.</td>
</tr>
<tr>
  <td>CF_LINK_SUPPRESS_PIN</td>
  <td>The profile driver indicates its preference that users not be prompted for a PIN.</td>
</tr>
</tbody>
</table>

<h3 id="configoutmtu"><code>ConfigOut.Mtu</code></h3>

<p>The range of message transfer units (MTUs) that is used to negotiate the size of the outbound half of channel.</p>

<h3 id="configoutflushto"><code>ConfigOut.FlushTO</code></h3>

<p>The range of possible values to be used for the flush timeout for the outbound half of the channel.</p>

<h3 id="configoutflow"><code>ConfigOut.Flow</code></h3>

<p>Reserved for future use. Do not use.</p>

<h3 id="configoutlinkto"><code>ConfigOut.LinkTO</code></h3>

<p>The Link Manager link timeout.</p>

<h3 id="configoutnumextraoptions"><code>ConfigOut.NumExtraOptions</code></h3>

<p>The number of array items that are contained in the <strong>ExtraOptions</strong> member. This value should be zero for most clients.</p>

<h3 id="configoutextraoptions"><code>ConfigOut.ExtraOptions</code></h3>

<p>The number of array items that are contained in the <strong>ExtraOptions</strong> member. This value should be zero for most clients.</p>

<h3 id="configoutlocalqos"><code>ConfigOut.LocalQos</code></h3>

<p>Reserved for future use. Do not use.</p>

<h3 id="configoutlocalqosservicetype"><code>ConfigOut.LocalQos.ServiceType</code></h3>

<p>Reserved for future use. Do not use.</p>

<h3 id="configoutlocalqoslatency"><code>ConfigOut.LocalQos.Latency</code></h3>

<p>Reserved for future use. Do not use.</p>

<h3 id="configin"><code>ConfigIn</code></h3>

<p>The substructure that contains parameter settings to validate incoming <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> BRBs that are sent from a remote device.</p>

<h3 id="configinflags"><code>ConfigIn.Flags</code></h3>

<p>Flags that specify the requirements for the channel to be opened. Valid flag values are listed in the following table:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CF_LINK_AUTHENTICATED</td>
  <td>The link must be authenticated.</td>
</tr>
<tr>
  <td>CF_LINK_ENCRYPTED</td>
  <td>The link must be encrypted. Setting this flag also sets the CF_LINK_AUTHENTICATED flag.</td>
</tr>
<tr>
  <td>CF_LINK_SUPPRESS_PIN</td>
  <td>The profile driver indicates its preference that users not be prompted for a PIN.</td>
</tr>
</tbody>
</table>

<h3 id="configinmtu"><code>ConfigIn.Mtu</code></h3>

<p>The range of message transfer units (MTUs) that is used to negotiate the size of the outbound half of channel.</p>

<h3 id="configinflushto"><code>ConfigIn.FlushTO</code></h3>

<p>The range of possible values to be used for the flush timeout for the outbound half of the channel.</p>

<h3 id="callbackflags"><code>CallbackFlags</code></h3>

<p>A flag that specifies which events should generate a callback routine to notify the profile driver that the event has occurred. Valid flag values are contained in the following table.</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CALLBACK_CONFIG_EXTRA_IN</td>
  <td>If set, the callback routine will be called when the configuration request for the remote device contains extra options. If not set, the extra configuration options will be rejected as unknown options. This flag is used with BRB_L2CA_OPEN_CHANNEL_RESPONSE BRBs.</td>
</tr>
<tr>
  <td>CALLBACK_CONFIG_EXTRA_OUT</td>
  <td>If set, the callback routine will be called when the remote device rejects an extra configuration option from a BRB_L2CA_OPEN_CHANNEL request. If not set and the remote device rejects the configuration request due to an extra option, the connection will be closed.</td>
</tr>
<tr>
  <td>CALLBACK_CONFIG_QOS</td>
  <td>If set, the callback routine will be called when a remote device sends a configuration request that contains a QOS value. If this flag is not set and the remote device either sends QOS parameters in a configuration request or rejects the profile driver's requested QOS parameters, the connection is disconnected.</td>
</tr>
<tr>
  <td>CALLBACK_DISCONNECT</td>
  <td>If set, the callback routine will be called when a remote device disconnects from the L2CAP channel.</td>
</tr>
<tr>
  <td>CALLBACK_RECV_PACKET</td>
  <td>If set, the callback routine will be called when the profile driver receives an incoming L2CAP packet.</td>
</tr>
</tbody>
</table>

<h3 id="callback"><code>Callback</code></h3>

<p>The <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/nc-bthddi-pfnbthport_indication_callback">L2CAP Callback Function</a> implemented by the profile driver, that the Bluetooth driver stack should call to notify the profile driver about any changes to the L2CAP connection.</p>

<h3 id="callbackcontext"><code>CallbackContext</code></h3>

<p>The context to pass to the callback function specified in the <strong>Callback</strong> member. The profile driver defines this value.</p>

<h3 id="referenceobject"><code>ReferenceObject</code></h3>

<p>A pointer to an object to pass to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obfreferenceobject">ObReferenceObject</a> and <a href="obdereferenceobject" title="void ObDereferenceObject(&#10;  [in] a&#10;);">ObDereferenceObject</a> for which to maintain a reference count of.</p>

<h3 id="outresults"><code>OutResults</code></h3>

<p>A <a href="channel_config_results" title="typedef struct _CHANNEL_CONFIG_RESULTS {&#10;  CHANNEL_CONFIG_PARAMETERS Params;&#10;  ULONG                     ExtraOptionsBufferSize;&#10;} CHANNEL_CONFIG_RESULTS, *PCHANNEL_CONFIG_RESULTS;">CHANNEL_CONFIG_RESULTS</a> structure that contains configuration parameters for the outbound request.</p>

<h3 id="inresults"><code>InResults</code></h3>

<p>A <a href="channel_config_results" title="typedef struct _CHANNEL_CONFIG_RESULTS {&#10;  CHANNEL_CONFIG_PARAMETERS Params;&#10;  ULONG                     ExtraOptionsBufferSize;&#10;} CHANNEL_CONFIG_RESULTS, *PCHANNEL_CONFIG_RESULTS;">CHANNEL_CONFIG_RESULTS</a> structure that contains configuration parameters for the inbound request.</p>

<h3 id="incomingqueuedepth"><code>IncomingQueueDepth</code></h3>

<p>Specifies the incoming queue length in message transfer units (MTUs).</p>

<h4 id="response-2">Response</h4>

<p>This member is used as an input parameter for a <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> request and an output parameter for the <strong>BRB_L2CA_OPEN_CHANNEL</strong> request.</p>

<p>For a <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> request, this member holds a flag that indicates the profile driver's response to the remote device. Valid flag values are contained in the following table.</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CONNECT_RSP_RESULT_NO_RESOURCES</td>
  <td>The profile driver refused the connection due to a lack of resources.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_PENDING</td>
  <td>The profile driver is currently busy and cannot accept the connection. Try again later.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_PSM_NEG</td>
  <td>The profile driver refused the connection because the PSM is not supported.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_SECURITY_BLOCK</td>
  <td>The profile driver refused the connection for security reasons.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_SUCCESS</td>
  <td>The profile driver accepted the connection.</td>
</tr>
</tbody>
</table>

<p>For the <strong>BRB_L2CA_OPEN_CHANNEL</strong> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>, this member contains the response from the remote device to which the profile driver attempted to connect. Valid flag values are contained in the following table.</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>CONNECT_RSP_RESULT_NO_RESOURCES</td>
  <td>The remote device refused the connection due to a lack of resources.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_PSM_NEG</td>
  <td>The remote device refused the connection.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_SECURITY_BLOCK</td>
  <td>The remote device refused the connection for security reasons.</td>
</tr>
<tr>
  <td>CONNECT_RSP_RESULT_SUCCESS</td>
  <td>The remote device accepted the connection.</td>
</tr>
</tbody>
</table>

<h4 id="responsestatus-2">ResponseStatus</h4>

<p>If during a call to the <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> the <em>Response</em> member is set to <code>CONNECT_RSP_RESULT_PENDING</code>, this member is valid and contains one of the following values:</p>

<ul>
<li>CONNECT_RSP_STATUS_AUTHENTICATION_PENDING</li>
<li>CONNECT_RSP_STATUS_AUTHORIZATION_PENDING</li>
<li>CONNECT_RSP_STATUS_NO_INFORMATION</li>
</ul>

<h2 id="remarks">Remarks</h2>

<p>To open a L2CAP channel, profile drivers should <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536657(v=vs.85)">build and send</a> a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536615(v=vs.85)">BRB_L2CA_OPEN_CHANNEL</a> request.</p>

<p>Profile drivers that act as clients specify a destination address, a PSM, and a variety of configuration parameters.</p>

<p>If the <strong>BRB_L2CA_OPEN_CHANNEL</strong> request completes successfully, a variety of information about the newly created connection is available in the <strong>OutResults</strong> and <strong>InResults</strong> members. <strong>OutResults</strong> specifies the parameters for the outbound half of the channel, and <strong>InResults</strong> specifies the parameters for the inbound half of the channel.</p>

<p>Several of the configuration parameters passed in this structure, such as the <strong>Mtu</strong> member, are ranges used for negotiation with the remote radio. Clients should provide as wide a range as possible to increase the chances of successful channel negotiation. Specifying a minimum MTU size greater than the basic Bluetooth minimum MTU size should only be done when absolutely necessary. If negotiation fails, the connection will fail.</p>

<p>Profile drivers must allocate the memory to store the array that is stored in the <strong>ExtraOptions</strong> member and should not free this memory until the callback function defined in the <strong>Callback</strong> member returns with an <strong>IndicationFreeExtraOptions</strong> notification <a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a> value passed in its <em>Indication</em> parameter.</p>

<p>The <strong>IncomingQueueDepth</strong> member of the _BRB_L2CA_OPEN_CHANNEL structure specifies the maximum number of MTUs that the Bluetooth driver stack will receive and queue on the connection before it begins to discard them. Setting this value to a very small number increases the chances of data loss, while setting it to a very large number can increase memory usage. Setting this member to 10 is an effective compromise.</p>

<p>To accept or reject an incoming L2CAP connection request initiated by a remote device, profile drivers should <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536657(v=vs.85)">build and send</a> a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)"> BRB_L2CA_OPEN_CHANNEL_RESPONSE</a> request.</p>

<p>A profile driver should build and send a <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> request when the Bluetooth driver stack calls the profile driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/nc-bthddi-pfnbthport_indication_callback">L2CAP Callback Function</a> and passes <strong>IndicationRemoteConnect</strong> in the callback function's <em>Indication</em> parameter.</p>

<p>Based on the value of the <strong>Response</strong> member of this structure, the Bluetooth driver stack will then accept or reject the connection request.</p>

<p>The profile driver specifies whether the connection should be accepted by storing an appropriate value in the <strong>Response</strong> member of this structure.</p>

<p>Upon receiving the CONNECT_RSP_RESULT_PENDING response, the connecting client should reset its connection timer and wait for an updated connection response message. Profile drivers calling the <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> where the <strong>Response</strong> member is set to CONNECT_RSP_RESULT_PENDING should promptly issue an additional <strong>BRB_L2CA_OPEN_CHANNEL_RESPONSE</strong> <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> with an updated connection value. The updated value can be any of the status codes described in the <strong>Response</strong> member, including resending a CONNECT_RSP_RESULT_PENDING value.</p>

<p>Profile drivers must allocate the memory to store the array that is stored in the <strong>ExtraOptions</strong> member and should not free this memory until the callback function that is defined in the <strong>Callback</strong> member returns with an <strong>IndicationFreeExtraOptions</strong> notification <strong><a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a></strong> value passed in its <em>Indication</em> parameter.</p>

<h2 id="see-also">See also</h2>

<p><a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536615(v=vs.85)">BRB_L2CA_OPEN_CHANNEL</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)">BRB_L2CA_OPEN_CHANNEL_RESPONSE</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536618(v=vs.85)">BRB_L2CA_REGISTER_SERVER</a></p>

<p><a href="channel_config_results" title="typedef struct _CHANNEL_CONFIG_RESULTS {&#10;  CHANNEL_CONFIG_PARAMETERS Params;&#10;  ULONG                     ExtraOptionsBufferSize;&#10;} CHANNEL_CONFIG_RESULTS, *PCHANNEL_CONFIG_RESULTS;">CHANNEL_CONFIG_RESULTS</a></p>

<p><a href="indication_code" title="typedef enum _INDICATION_CODE {&#10;  IndicationAddReference,&#10;  IndicationReleaseReference,&#10;  IndicationRemoteConnect,&#10;  IndicationRemoteDisconnect,&#10;  IndicationRemoteConfigRequest,&#10;  IndicationRemoteConfigResponse,&#10;  IndicationFreeExtraOptions,&#10;  IndicationRecvPacket,&#10;  IndicationPairDevice,&#10;  IndicationUnpairDevice,&#10;  IndicationUnpersonalizeDevice,&#10;  IndicationRemoteConnectLE&#10;} INDICATION_CODE, *PINDICATION_CODE;">INDICATION_CODE</a></p>

<p><a href="indication_parameters" title="typedef struct _INDICATION_PARAMETERS {&#10;  L2CAP_CHANNEL_HANDLE ConnectionHandle;&#10;  IN BTH_ADDR          BtAddress;&#10;  union {&#10;    struct {&#10;      struct {&#10;        OUT USHORT PSM;&#10;      } Request;&#10;    } Connect;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS ResponseParams;&#10;      USHORT                    Response;&#10;    } ConfigRequest;&#10;    struct {&#10;      CHANNEL_CONFIG_PARAMETERS CurrentParams;&#10;      CHANNEL_CONFIG_PARAMETERS RequestedParams;&#10;      CHANNEL_CONFIG_PARAMETERS RejectedParams;&#10;      PCO_TYPE                  UnknownTypes;&#10;...">INDICATION_PARAMETERS</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/nc-bthddi-pfnbthport_indication_callback">L2CAP Callback Function</a></p>

<p><a href="l2cap_config_option" title="typedef struct _L2CAP_CONFIG_OPTION {&#10;  CO_HEADER Header;&#10;  VOID      *DynamicBuffer;&#10;  UCHAR     FixedBuffer[4];&#10;  USHORT    Flags;&#10;} L2CAP_CONFIG_OPTION, *PL2CAP_CONFIG_OPTION;">L2CAP_CONFIG_OPTION</a></p>

<p><a href="obdereferenceobject" title="void ObDereferenceObject(&#10;  [in] a&#10;);">ObDereferenceObject</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-obfreferenceobject">ObReferenceObject</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/ns-bthddi-_brb_l2ca_open_channel">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/bthddi/ns-bthddi-_brb_l2ca_open_channel.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
