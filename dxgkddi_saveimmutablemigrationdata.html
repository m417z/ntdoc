<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_SAVEIMMUTABLEMIGRATIONDATA - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_SAVEIMMUTABLEMIGRATIONDATA - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_SAVEIMMUTABLEMIGRATIONDATA - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">DXGKDDI_SAVEIMMUTABLEMIGRATIONDATA DxgkddiSaveimmutablemigrationdata;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiSaveimmutablemigrationdata(
  IN_CONST_HANDLE hAdapter,
  INOUT_PDXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA pArgs
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_saveimmutablemigrationdata">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_saveimmutablemigrationdata.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dkmddi-dxgkddi_saveimmutablemigrationdata)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>KMD's <strong>DxgkDdiSaveImmutableMigrationData</strong> function saves immutable data for a live migration that is about to start.</p>
<h2>Parameters</h2>
<h3><code>hAdapter</code></h3>
<p>[in] A handle to a context block associated with a display adapter. The display miniport driver previously provided this handle to <em>Dxgkrnl</em> in the <strong>MiniportDeviceContext</strong> output parameter of the <strong><a href="dxgkddi_add_device" title="DXGKDDI_ADD_DEVICE DxgkddiAddDevice;&#10;&#10;NTSTATUS DxgkddiAddDevice(&#10;  [in]  IN_CONST_PDEVICE_OBJECT PhysicalDeviceObject,&#10;  [out] OUT_PPVOID MiniportDeviceContext&#10;)&#10;{...}">DXGKDDI_ADD_DEVICE</a></strong> function.</p>
<h3><code>pArgs</code></h3>
<p>[in/out] Pointer to a <strong><a href="dxgkarg_gpup_save_immutable_migration_data" title="typedef struct _DXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA {&#10;  UINT   vfIndex;&#10;  UINT64 *DataSize;&#10;  BYTE   *Data;&#10;} DXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA;">DXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA</a></strong> structure for information related to the call.</p>
<h2>Return value</h2>
<p><strong>DxgkDdiSaveImmutableMigrationData</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call is successful. Otherwise, it returns an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> code.</p>
<h2>Remarks</h2>
<p>After calling KMD's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_preparelivemigration"><strong>DxgkDdiPrepareLiveMigration</strong></a> function, <em>Dxgkrnl</em> then calls<strong>DxgkDdiSaveImmutableMigrationData</strong> to gather information about the device to restore on the target side. This point is also an opportunity for the system to validate the configuration of the remote, so <strong>DxgkDdiSaveImmutableMigrationData</strong> should package up enough information to validate any hardware, firmware, or driver validation data that can detect the capability to move the VF over to the target configuration.</p>
<p>The driver should store data about the VF that won't change while it is alive that the target's KMD can use to help initialize the new VF. This data doesn't need to include the vGPU creation parameters, as those will be transferred in lower levels and used to create the vGPU using the normal DDI. This can include all data that is immutably tied to the VF, and doesn't all need to be restored on the target side. Data can be sent purely for validation purposes, which is a critical part of this interface.</p>
<p><strong>DxgkDdiSaveImmutableMigrationData</strong> is called in the classic dynamic buffer pattern:</p>
<ul>
<li>On the first call, <strong>DataSize</strong> is set to 0 and <strong>Data</strong> to NULL. KMD should change <strong>DataSize</strong> to the total number of bytes it needs to store the immutable data.</li>
<li><em>Dxgkrnl</em> creates a buffer of <strong>DataSize</strong> bytes and makes a second call with <strong>DataSize</strong> set to the value returned by KMD and <strong>Data</strong> pointing to the allocated buffer. <em>Dxgkrnl</em> controls the lifetime of this allocated memory after the call.</li>
</ul>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_savemutablemigrationdata"><strong>DxgkDdiSaveMutableMigrationData</strong></a> is called at the end of a live migration to collect mutable data.</p>
<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/live-migration-on-gpup-devices">Live migration on GPU-P devices</a>.</p>
<h2>See also</h2>
<p><strong><a href="dxgkarg_gpup_save_immutable_migration_data" title="typedef struct _DXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA {&#10;  UINT   vfIndex;&#10;  UINT64 *DataSize;&#10;  BYTE   *Data;&#10;} DXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA;">DXGKARG_GPUP_SAVE_IMMUTABLE_MIGRATION_DATA</a></strong></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_preparelivemigration"><strong>DxgkDdiPrepareLiveMigration</strong></a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_savemutablemigrationdata"><strong>DxgkDdiSaveMutableMigrationData</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_saveimmutablemigrationdata">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/nc-d3dkmddi-dxgkddi_saveimmutablemigrationdata.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
