<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PROTOCOL_CL_INCOMING_CALL - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PROTOCOL_CL_INCOMING_CALL - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PROTOCOL_CL_INCOMING_CALL - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">PROTOCOL_CL_INCOMING_CALL ProtocolClIncomingCall;

NDIS_STATUS ProtocolClIncomingCall(
  [in]      NDIS_HANDLE ProtocolSapContext,
  [in]      NDIS_HANDLE ProtocolVcContext,
  [in, out] PCO_CALL_PARAMETERS CallParameters
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_call">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/protocol_cl_incoming_call.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-protocol_cl_incoming_call)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="protocol_cl_incoming_call-callback-function">PROTOCOL_CL_INCOMING_CALL callback function</h1>

<h2 id="description">Description</h2>

<p>The
<em>ProtocolClIncomingCall</em> function is used by connection-oriented clients that accept incoming calls.
Such clients must have
<em>ProtocolClIncomingCall</em> functions. Otherwise, such a protocol driver's registered
<em>ProtocolClIncomingCall</em> function can simply return NDIS_STATUS_NOT_SUPPORTED.</p>

<p><strong>Note</strong> You must declare the function by using the <strong>PROTOCOL_CL_INCOMING_CALL</strong> type.
For more information, see the following Examples section.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="protocolsapcontext-in"><code>ProtocolSapContext</code> [in]</h3>

<p>Specifies the handle that the client originally supplied when it registered the SAP, which the
call manager matched to this incoming call offer.</p>

<h3 id="protocolvccontext-in"><code>ProtocolVcContext</code> [in]</h3>

<p>Specifies the handle to the client's per-VC context area, previously returned to NDIS by its
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_create_vc">ProtocolCoCreateVc</a> function.</p>

<h3 id="callparameters-in-out"><code>CallParameters</code> [in, out]</h3>

<p>Pointer to a buffer, formatted as a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff545384(v=vs.85)">CO_CALL_PARAMETERS</a> structure, that contains
the call parameters for this offered call.</p>

<h2 id="return-value">Return value</h2>

<p><em>ProtocolClIncomingCall</em> can return one of the following status codes:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NDIS_STATUS_SUCCESS</strong></td>
  <td>The client accepted the incoming call offer.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_PENDING</strong></td>
  <td>The client is handling this request asynchronously, and it will call the <a href="ndisclincomingcallcomplete" title="VOID NdisClIncomingCallComplete(&#10;  [in] NDIS_STATUS         Status,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisClIncomingCallComplete</a> function when the close operation is complete.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_<em>XXX</em></strong></td>
  <td>The client rejected the incoming call offer for some driver-determined reason.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A call to
<em>ProtocolClIncomingCall</em> indicates that the call manager has received a request over the network from
a signaling peer to establish a connection with this client. That is, the request to set up such a
connection was directed to a SAP previously registered with the call manager by this client.</p>

<p>Depending on the signaling protocol supported by the call manager,
<em>ProtocolClIncomingCall</em> can modify the traffic parameters as part of the process of negotiating
acceptance of an incoming call offer and/or, if the call manager supports QoS, the quality of service
specification at
<em>CallParameters</em> . The client should copy any information it will need subsequently from this
buffered structure if it accepts the offered call.</p>

<p>Assuming the call manager finds the client's modifications, if any, acceptable, NDIS next calls the
client's
<em>ProtocolClIncomingCallConnected</em> function when it becomes possible for transfers to occur on the
active VC representing the connection to the client on the remote node that originally initiated the call
offer. If the client returns modified call parameters that are unacceptable, the call manager can tear
down the VC it created for this offer, thereby causing calls to the client's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_close_call">ProtocolClIncomingCloseCall</a> and then
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_delete_vc">ProtocolCoDeleteVc</a> functions
instead.</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>ProtocolClIncomingCall</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>ProtocolClIncomingCall</em> function that is named "MyClIncomingCall", use the <strong>PROTOCOL_CL_INCOMING_CALL</strong> type as shown in this code example:</p>

<pre><code>PROTOCOL_CL_INCOMING_CALL MyClIncomingCall;
</code></pre>

<p>Then, implement your function as follows:</p>

<pre><code>_Use_decl_annotations_
NDIS_STATUS
 MyClIncomingCall(
    NDIS_HANDLE  ProtocolSapContext,
    NDIS_HANDLE  ProtocolVcContext,
    PCO_CALL_PARAMETERS  CallParameters
    )
  {...}
</code></pre>

<p>The <strong>PROTOCOL_CL_INCOMING_CALL</strong> function type is defined in the Ndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the <em>Use_decl_annotations</em> annotation to your function definition. The <em>Use_decl_annotations</em> annotation ensures that the annotations that are applied to the <strong>PROTOCOL_CL_INCOMING_CALL</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about <em>Use_decl_annotations</em>, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff545384(v=vs.85)">CO_CALL_PARAMETERS</a></p>

<p><a href="ndisclincomingcallcomplete" title="VOID NdisClIncomingCallComplete(&#10;  [in] NDIS_STATUS         Status,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisClIncomingCallComplete</a></p>

<p><a href="ndisclregistersap" title="NDIS_STATUS NdisClRegisterSap(&#10;  [in]  NDIS_HANDLE  NdisAfHandle,&#10;  [in]  NDIS_HANDLE  ProtocolSapContext,&#10;  [in]  PCO_SAP      Sap,&#10;  [out] PNDIS_HANDLE NdisSapHandle&#10;);">NdisClRegisterSap</a></p>

<p><a href="ndiscmdispatchincomingcall" title="NDIS_STATUS NdisCmDispatchIncomingCall(&#10;  [in] NDIS_HANDLE         NdisSapHandle,&#10;  [in] NDIS_HANDLE         NdisVcHandle,&#10;  [in] PCO_CALL_PARAMETERS CallParameters&#10;);">NdisCmDispatchIncomingCall</a></p>

<p><a href="ndismcmdispatchincomingcall" title="void NdisMCmDispatchIncomingCall(&#10;  _SH_,&#10;  _VH_,&#10;  _CP_&#10;);">NdisMCmDispatchIncomingCall</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_call_connected">ProtocolClCallConnected</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_close_call">ProtocolClIncomingCloseCall</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_create_vc">ProtocolCoCreateVc</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_delete_vc">ProtocolCoDeleteVc</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cl_incoming_call">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-protocol_cl_incoming_call.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
