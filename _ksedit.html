<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="_KsEdit - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>_KsEdit - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            _KsEdit - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">KSDDKAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> _KsEdit(
  [in]      KSOBJECT_BAG ObjectBag,
  [in, out] PVOID        *PointerToPointerToItem,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>        NewSize,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>        OldSize,
  [in]      <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>        Tag
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-_ksedit">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/_ksedit.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ks-_ksedit)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ksedit-function">_KsEdit function</h1>

<h2 id="description">Description</h2>

<p>The <strong>KsEdit</strong> function guarantees that a given item is dynamically allocated and associated with an AVStream object through the object bag.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="objectbag-in"><code>ObjectBag</code> [in]</h3>

<p>The KSOBJECT_BAG (equivalent to type PVOID) to use in the check. If the item is not contained within the object bag, <strong>KsEdit</strong> dynamically allocates sufficient memory for the item, copies the old contents, and places the newly allocated memory in this object bag.</p>

<h3 id="pointertopointertoitem-in-out"><code>PointerToPointerToItem</code> [in, out]</h3>

<p>A pointer to a pointer to the item being edited.</p>

<h3 id="newsize-in"><code>NewSize</code> [in]</h3>

<p>The number of bytes to allocate for the item.</p>

<h3 id="oldsize-in"><code>OldSize</code> [in]</h3>

<p>The number of bytes the item currently takes up.</p>

<h3 id="tag-in"><code>Tag</code> [in]</h3>

<p>Contains the pool tag to use for the allocations. Drivers normally specify the pool tag as a string of up to four characters, delimited by single quotation marks. The string is usually specified in reversed order. The ASCII value of each character in the tag must be between 0 and 127.</p>

<h2 id="return-value">Return value</h2>

<p>Returns success or STATUS_INSUFFICIENT_RESOURCES.</p>

<h2 id="remarks">Remarks</h2>

<p>Note that <strong>KsEdit</strong> and <strong>KsEditSized</strong> are macros created to make <strong>_KsEdit</strong> easier to use. While <strong>_KsEdit</strong> allows you to resize an item, <strong>KsEdit</strong> does not. The macro <strong>KsEdit</strong> calls <strong>_KsEdit</strong>, specifying <strong>sizeof</strong>(** <em>PointerToPointerToItem</em>) as both sizes.</p>

<p>For example, consider a pin that needs to modify its allocator framing on creation. Because the descriptor is statically coded and new pins may use it, the solution is to modify the pin descriptor as follows:</p>

<div class="codehilite">
<pre><span></span><code><span class="n">KsEdit</span><span class="p">(</span><span class="n">Pin</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Descriptor</span><span class="p">,</span><span class="w"> </span><span class="n">Tag</span><span class="p">);</span>
<span class="n">Pin</span><span class="o">-&gt;</span><span class="n">Descriptor</span><span class="o">-&gt;</span><span class="n">AllocatorFraming</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NewAllocatorFraming</span><span class="p">;</span>
</code></pre>
</div>

<p>The call to <strong>KsEdit</strong> guarantees that <em>Pin->Descriptor</em> is dynamic memory that is associated with <em>Pin</em>. Note that arbitrary modification of descriptors and other AVStream structures can cause undesirable results. Minidrivers should exercise caution when using <strong>KsEdit</strong> on AVStream structures.</p>

<p><strong>KsEditSized</strong> calls <strong>_KsEdit</strong> with the same parameters it receives, except that <em>Object</em> is replaced by <em>Object->Bag</em> and the pointer is typecast to PVOID.</p>

<p>Note that when calling <strong>_KsEdit</strong>, a caller must hold the mutex associated with the bag. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/object-bags">Object Bags</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/mutexes-in-avstream">Mutexes in AVStream</a>.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-_ksedit">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/nf-ks-_ksedit.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
