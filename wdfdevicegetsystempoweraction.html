<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfDeviceGetSystemPowerAction - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfDeviceGetSystemPowerAction - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfDeviceGetSystemPowerAction - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfdevice.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="power_action" title="typedef enum  {&#10;  PowerActionNone           = 0,&#10;  PowerActionReserved       = ( PowerActionNone + 1 ),&#10;  PowerActionSleep          = ( PowerActionReserved + 1 ),&#10;  PowerActionHibernate      = ( PowerActionSleep + 1 ),&#10;  PowerActionShutdown       = ( PowerActionHibernate + 1 ),&#10;  PowerActionShutdownReset  = ( PowerActionShutdown + 1 ),&#10;  PowerActionShutdownOff    = ( PowerActionShutdownReset + 1 ),&#10;  PowerActionWarmEject      = ( PowerActionShutdownOff + 1 )&#10;} POWER_ACTION, *PPOWER_ACTION;">POWER_ACTION</a> WdfDeviceGetSystemPowerAction(
  [in] WDFDEVICE Device
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nf-wdfdevice-wdfdevicegetsystempoweraction">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfdevicegetsystempoweraction.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfdevice-wdfdevicegetsystempoweraction)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="wdfdevicegetsystempoweraction-function">WdfDeviceGetSystemPowerAction function</h1>

<h2 id="description">Description</h2>

<p>[Applies to KMDF and UMDF]</p>

<p>The <strong>WdfDeviceGetSystemPowerAction</strong> method returns the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/system-power-actions">system power action</a>, if any, that is currently occurring for the computer.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="device-in"><code>Device</code> [in]</h3>

<p>A handle to a framework device object.</p>

<h2 id="return-value">Return value</h2>

<p><strong>WdfDeviceGetSystemPowerAction</strong> returns a <a href="power_action" title="typedef enum  {&#10;  PowerActionNone           = 0,&#10;  PowerActionReserved       = ( PowerActionNone + 1 ),&#10;  PowerActionSleep          = ( PowerActionReserved + 1 ),&#10;  PowerActionHibernate      = ( PowerActionSleep + 1 ),&#10;  PowerActionShutdown       = ( PowerActionHibernate + 1 ),&#10;  PowerActionShutdownReset  = ( PowerActionShutdown + 1 ),&#10;  PowerActionShutdownOff    = ( PowerActionShutdownReset + 1 ),&#10;  PowerActionWarmEject      = ( PowerActionShutdownOff + 1 )&#10;} POWER_ACTION, *PPOWER_ACTION;">POWER_ACTION</a>-typed enumerator value. The value indicates the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/system-power-actions">system power action</a> that is currently occurring for the computer. For more information, see the following Remarks section. The <a href="power_action" title="typedef enum  {&#10;  PowerActionNone           = 0,&#10;  PowerActionReserved       = ( PowerActionNone + 1 ),&#10;  PowerActionSleep          = ( PowerActionReserved + 1 ),&#10;  PowerActionHibernate      = ( PowerActionSleep + 1 ),&#10;  PowerActionShutdown       = ( PowerActionHibernate + 1 ),&#10;  PowerActionShutdownReset  = ( PowerActionShutdown + 1 ),&#10;  PowerActionShutdownOff    = ( PowerActionShutdownReset + 1 ),&#10;  PowerActionWarmEject      = ( PowerActionShutdownOff + 1 )&#10;} POWER_ACTION, *PPOWER_ACTION;">POWER_ACTION</a> enumeration is defined in <em>wdm.h</em>.</p>

<p>A bug check occurs if the driver supplies an invalid object handle.</p>

<h2 id="remarks">Remarks</h2>

<p>Starting in WDF version 1.31/2.31 (referred to as "v31"), <strong>WdfDeviceGetSystemPowerAction</strong> has been updated to more accurately report system power action when the device is the power policy owner. Drivers need to be recompiled with v31 or later to get the following new behavior:</p>

<ul>
<li>If the device enters or exits D0 due to S0 Idle (see <strong><a href="wdfdeviceassigns0idlesettings" title="NTSTATUS WdfDeviceAssignS0IdleSettings(&#10;  [in] WDFDEVICE                              Device,&#10;  [in] PWDF_DEVICE_POWER_POLICY_IDLE_SETTINGS Settings&#10;);">WdfDeviceAssignS0IdleSettings</a></strong>) while an unrelated system power transition is in progress, <strong>WdfDeviceGetSystemPowerAction</strong> might return <strong>PowerActionSleep</strong>. This is fixed in v31 and now it returns <strong>PowerActionNone</strong>.</li>
<li><p>When the system wakes up from Hybrid Sleep (sleep with a hibernation file), before v31, <strong>WdfDeviceGetSystemPowerAction</strong> always returned <strong>PowerActionHibernate</strong>. This is fixed in v31 and now it returns:</p>

<ul>
<li><strong>PowerActionSleep</strong> if it wakes without power loss, which means the system remained in S3</li>
<li><strong>PowerActionHibernate</strong> if it wakes after power loss, which means the system resumed from the hibernation file</li>
</ul></li>
</ul>

<p>The <strong>WdfDeviceGetSystemPowerAction</strong> method enables a driver to determine whether a device's power transition is occurring because the device is idle (or waking up), or because the entire computer is entering (or leaving) a low-power state.</p>

<p>The driver must call <strong>WdfDeviceGetSystemPowerAction</strong> only from the event callback functions that the framework calls when the device is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/a-device-enters-a-low-power-state">entering a low-power state</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/a-device-returns-to-its-working-state">returning to its working state</a>.</p>

<p>The value that <strong>WdfDeviceGetSystemPowerAction</strong> returns depends on the following situations:</p>

<ul>
<li>If the computer is entering a low-power state when the driver calls <strong>WdfDeviceGetSystemPowerAction</strong>, the method returns the reason that the computer is entering the low-power state. For example, the method returns <strong>PowerActionSleep</strong> if the computer is entering its S1, S2, or S3 low-power state.</li>
<li>If the computer is returning to its working (S0) state from a low-power state when the driver calls <strong>WdfDeviceGetSystemPowerAction</strong>, the method returns the reason that the computer entered the low-power state. For example, the method returns <strong>PowerActionSleep</strong> if the computer is leaving its S1, S2, or S3 low-power state.</li>
<li>If the computer is powering up (after having been turned off) when the driver calls <strong>WdfDeviceGetSystemPowerAction</strong>, the method returns <strong>PowerActionNone</strong>.</li>
<li>If the device is entering a low-power idle state or returning to its working (D0) state when the driver calls <strong>WdfDeviceGetSystemPowerAction</strong>, while the rest of the system remains at its working (S0) state, the method returns <strong>PowerActionNone</strong>.</li>
<li>If the computer and the device are both in their working states when the driver calls <strong>WdfDeviceGetSystemPowerAction</strong>, the method returns <strong>PowerActionNone</strong>.</li>
</ul>

<p>For more information about low-power states, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/a-device-enters-a-low-power-state">A Device Enters a Low-Power State</a>.</p>

<h4 id="examples">Examples</h4>

<p>The following code example obtains the power transition activity that is currently occurring for the computer.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n"><a href="power_action" title="typedef enum  {&#10;  PowerActionNone           = 0,&#10;  PowerActionReserved       = ( PowerActionNone + 1 ),&#10;  PowerActionSleep          = ( PowerActionReserved + 1 ),&#10;  PowerActionHibernate      = ( PowerActionSleep + 1 ),&#10;  PowerActionShutdown       = ( PowerActionHibernate + 1 ),&#10;  PowerActionShutdownReset  = ( PowerActionShutdown + 1 ),&#10;  PowerActionShutdownOff    = ( PowerActionShutdownReset + 1 ),&#10;  PowerActionWarmEject      = ( PowerActionShutdownOff + 1 )&#10;} POWER_ACTION, *PPOWER_ACTION;">POWER_ACTION</a></span><span class="w"> </span><span class="n">SysPowerAction</span><span class="p">;</span>

<span class="n">SysPowerAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WdfDeviceGetSystemPowerAction</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</code></pre>
</div>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nf-wdfdevice-wdfdevicegetsystempoweraction">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfdevice/nf-wdfdevice-wdfdevicegetsystempoweraction.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
