<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="InitializePrintMonitor2 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>InitializePrintMonitor2 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            InitializePrintMonitor2 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winsplp.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">LPMONITOR2 InitializePrintMonitor2(
  [in]  <a href="monitorinit" title="typedef struct _MONITORINIT {&#10;  DWORD       cbSize;&#10;  HANDLE      hSpooler;&#10;  HKEYMONITOR hckRegistryRoot;&#10;  PMONITORREG pMonitorReg;&#10;  BOOL        bLocal;&#10;  LPCWSTR     pszServerName;&#10;} MONITORINIT, *PMONITORINIT;">PMONITORINIT</a> pMonitorInit,
  [out] PHANDLE      phMonitor
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/nf-winsplp-initializeprintmonitor2">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/initializeprintmonitor2.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-winsplp-initializeprintmonitor2)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="initializeprintmonitor2-function">InitializePrintMonitor2 function</h1>

<h2 id="description">Description</h2>

<p>A print monitor's <strong>InitializePrintMonitor2</strong> function initializes a print monitor for use with clustered print servers.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="pmonitorinit-in"><code>pMonitorInit</code> [in]</h3>

<p>Caller-supplied pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/ns-winsplp-_monitorinit">MONITORINIT</a> structure.</p>

<h3 id="phmonitor-out"><code>phMonitor</code> [out]</h3>

<p>Caller-supplied location in which the function returns a monitor handle.</p>

<h2 id="return-value">Return value</h2>

<p>If the operation succeeds, the function should return a pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/ns-winsplp-_monitor2">MONITOR2</a> structure. Otherwise the function should call SetLastError (described in the Microsoft Windows SDK documentation) to set an error code, and return <strong>NULL</strong>.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>InitializePrintMonitor2</strong> function must be exported by <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/print/language-monitors">language monitors</a> and by port monitor server DLLs. The function is called immediately after the monitor DLL is loaded, and is not called again until the DLL is reloaded. Its purposes are to allow the monitor to initialize itself, and to provide the spooler with pointers to internal monitor functions. Function pointers are contained in a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/ns-winsplp-_monitor2">MONITOR2</a> structure.</p>

<p>The <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/ns-winsplp-_monitor2">MONITOR2</a> structure is larger in Windows XP than it was in Windows 2000. In order to ensure that a monitor developed with the Windows XP Driver Development Kit (DDK) will install on Windows XP and Windows 2000, the monitor must do the following:</p>

<ul>
<li>Perform a run-time check to determine which operating system version the monitor is running on.</li>
<li>If the monitor is running on Windows 2000, it must set the <strong>cbSize</strong> member of the <a href="monitor2" title="typedef struct _MONITOR2 {&#10;  DWORD  cbSize;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,DWORD Level,LPBYTE pPorts,DWORD cbBuf,LPDWORD pcbNeeded,LPDWORD pcReturned)  *pfnEnumPorts;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,PHANDLE pHandle)  *pfnOpenPort;&#10;  BOOL()(HANDLE hMonitor,HANDLE hMonitorPort,LPWSTR pPortName,LPWSTR pPrinterName,PHANDLE pHandle,_MONITOR2 *pMonitor2)  * pfnOpenPortEx;&#10;  BOOL( )(HANDLE hPort,LPWSTR pPrinterName,DWORD JobId,DWORD Level,LPBYTE pDocInfo)  *pfnStartDocPort;&#10;  BOOL( )(HANDLE hPort,LPBYTE pBuffer,DWORD cbBuf,LPDWORD pcbWritten)  *pfnWritePort;&#10;  BOOL( )(HANDLE hPort,LPBYTE pBuffer,DWORD cbBuffer,LPDWORD pcbRead)  *pfnReadPort;&#10;  BOOL( )(HANDLE hPort)  *pfnEndDocPort;&#10;  BOOL( )(HANDLE hPort)  *pfnClosePort;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,HWND hWnd,LPWSTR pMonitorName)  *pfnAddPort;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,DWORD Level,LPBYTE lpBuffer,LPWSTR lpMonitorName)  *pfnAddPortEx;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,HWND hWnd,LPWSTR pPortName)  *pfnConfigurePort;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,HWND hWnd,LPWSTR pPortName)  *pfnDeletePort;&#10;  BOOL( )(HANDLE hPort,DWORD ControlID,LPWSTR pValueName,LPWSTR lpInBuffer,DWORD cbInBuffer,LPWSTR lpOutBuffer,DWORD cbOutBuffer,LPDWORD lpcbReturned)  *pfnGetPrinterDataFromPort;&#10;  BOOL( )(HANDLE hPort,LPCOMMTIMEOUTS lpCTO,DWORD reserved)  *pfnSetPortTimeOuts;&#10;  BOOL( )(HANDLE hMonitor,LPCWSTR pszObject,ACCESS_MASK GrantedAccess,PHANDLE phXcv)  *pfnXcvOpenPort;&#10;  DWORD( )(HANDLE hXcv,LPCWSTR pszDataName,PBYTE pInputData,DWORD cbInputData,PBYTE pOutputData,DWORD cbOutputData,PDWORD pcbOutputNeeded) *pfnXcvDataPort;&#10;  BOOL( )(HANDLE hXcv)  *pfnXcvClosePort;&#10;  VOID( )(HANDLE hMonitor)  *pfnShutdown;&#10;...">MONITOR2</a> structure to MONITOR2_SIZE_WIN2K (defined in Winsplp.h), the size appropriate for Windows 2000 version of this structure.</li>
</ul>

<p>The following function determines whether the current operating system version is Windows 2000.</p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOL</span><span class="w">  </span><span class="nf">Is_Win2000</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">OSVERSIONINFOEX</span><span class="w"> </span><span class="n">osvi</span><span class="p">;</span>
<span class="w">  </span><span class="n"><a href="dwordlong" title="typedef unsigned __int64 DWORDLONG;">DWORDLONG</a></span><span class="w"> </span><span class="n">dwlConditionMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Initialize the OSVERSIONINFOEX structure.</span>

<span class="w">  </span><span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">osvi</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">OSVERSIONINFOEX</span><span class="p">));</span>
<span class="w">  </span><span class="n">osvi</span><span class="p">.</span><span class="n">dwOSVersionInfoSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">OSVERSIONINFOEX</span><span class="p">);</span>
<span class="w">  </span><span class="n">osvi</span><span class="p">.</span><span class="n">dwMajorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="n">osvi</span><span class="p">.</span><span class="n">dwMinorVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Initialize the condition mask.</span>
<span class="w">  </span><span class="n">VER_SET_CONDITION</span><span class="p">(</span><span class="w"> </span><span class="n">dwlConditionMask</span><span class="p">,</span><span class="w"> </span><span class="n">VER_MAJORVERSION</span><span class="p">,</span><span class="w"> </span><span class="n">VER_EQUAL</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">VER_SET_CONDITION</span><span class="p">(</span><span class="w"> </span><span class="n">dwlConditionMask</span><span class="p">,</span><span class="w"> </span><span class="n">VER_MINORVERSION</span><span class="p">,</span><span class="w"> </span><span class="n">VER_EQUAL</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Perform the test.</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">VerifyVersionInfo</span><span class="p">(</span>
<span class="w">      </span><span class="o">&amp;</span><span class="n">osvi</span><span class="p">,</span>
<span class="w">      </span><span class="n">VER_MAJORVERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">VER_MINORVERSION</span><span class="p">,</span>
<span class="w">      </span><span class="n">dwlConditionMask</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>For a monitor that is loading on Windows 2000, the following code sets the <a href="monitor2" title="typedef struct _MONITOR2 {&#10;  DWORD  cbSize;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,DWORD Level,LPBYTE pPorts,DWORD cbBuf,LPDWORD pcbNeeded,LPDWORD pcReturned)  *pfnEnumPorts;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,PHANDLE pHandle)  *pfnOpenPort;&#10;  BOOL()(HANDLE hMonitor,HANDLE hMonitorPort,LPWSTR pPortName,LPWSTR pPrinterName,PHANDLE pHandle,_MONITOR2 *pMonitor2)  * pfnOpenPortEx;&#10;  BOOL( )(HANDLE hPort,LPWSTR pPrinterName,DWORD JobId,DWORD Level,LPBYTE pDocInfo)  *pfnStartDocPort;&#10;  BOOL( )(HANDLE hPort,LPBYTE pBuffer,DWORD cbBuf,LPDWORD pcbWritten)  *pfnWritePort;&#10;  BOOL( )(HANDLE hPort,LPBYTE pBuffer,DWORD cbBuffer,LPDWORD pcbRead)  *pfnReadPort;&#10;  BOOL( )(HANDLE hPort)  *pfnEndDocPort;&#10;  BOOL( )(HANDLE hPort)  *pfnClosePort;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,HWND hWnd,LPWSTR pMonitorName)  *pfnAddPort;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,DWORD Level,LPBYTE lpBuffer,LPWSTR lpMonitorName)  *pfnAddPortEx;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,HWND hWnd,LPWSTR pPortName)  *pfnConfigurePort;&#10;  BOOL( )(HANDLE hMonitor,LPWSTR pName,HWND hWnd,LPWSTR pPortName)  *pfnDeletePort;&#10;  BOOL( )(HANDLE hPort,DWORD ControlID,LPWSTR pValueName,LPWSTR lpInBuffer,DWORD cbInBuffer,LPWSTR lpOutBuffer,DWORD cbOutBuffer,LPDWORD lpcbReturned)  *pfnGetPrinterDataFromPort;&#10;  BOOL( )(HANDLE hPort,LPCOMMTIMEOUTS lpCTO,DWORD reserved)  *pfnSetPortTimeOuts;&#10;  BOOL( )(HANDLE hMonitor,LPCWSTR pszObject,ACCESS_MASK GrantedAccess,PHANDLE phXcv)  *pfnXcvOpenPort;&#10;  DWORD( )(HANDLE hXcv,LPCWSTR pszDataName,PBYTE pInputData,DWORD cbInputData,PBYTE pOutputData,DWORD cbOutputData,PDWORD pcbOutputNeeded) *pfnXcvDataPort;&#10;  BOOL( )(HANDLE hXcv)  *pfnXcvClosePort;&#10;  VOID( )(HANDLE hMonitor)  *pfnShutdown;&#10;...">MONITOR2</a> structure's <strong>cbSize</strong> member appropriately.</p>

<div class="codehilite">
<pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Is_Win2000</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">Monitor2</span><span class="p">.</span><span class="n">cbSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MONITOR2_SIZE_WIN2K</span><span class="p">;</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/ns-winsplp-_monitorinit">MONITORINIT</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/winsplp/nf-winsplp-initializeprintmonitor2">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/winsplp/nf-winsplp-initializeprintmonitor2.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
