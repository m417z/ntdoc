<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="SCSI_ADAPTER_BUS_INFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>SCSI_ADAPTER_BUS_INFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            SCSI_ADAPTER_BUS_INFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddscsi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _SCSI_ADAPTER_BUS_INFO {
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>         NumberOfBuses;
  <a href="scsi_bus_data" title="typedef struct _SCSI_BUS_DATA {&#10;  UCHAR NumberOfLogicalUnits;&#10;  UCHAR InitiatorBusId;&#10;  ULONG InquiryDataOffset;&#10;} SCSI_BUS_DATA, *PSCSI_BUS_DATA;">SCSI_BUS_DATA</a> BusData[1];
} SCSI_ADAPTER_BUS_INFO, *PSCSI_ADAPTER_BUS_INFO;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_scsi_adapter_bus_info">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/scsi_adapter_bus_info.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddscsi-_scsi_adapter_bus_info)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_scsi_adapter_bus_info-structure">_SCSI_ADAPTER_BUS_INFO structure</h1>

<h2 id="description">Description</h2>

<p>The SCSI_ADAPTER_BUS_INFO structure is used in conjunction with the <a href="ioctl_scsi_get_inquiry_data" title="// CTL_CODE(0x0004, 0x403, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_SCSI_GET_INQUIRY_DATA 0x0004100C">IOCTL_SCSI_GET_INQUIRY_DATA</a> request to retrieve the SCSI inquiry data for all devices on a given SCSI bus.</p>

<p><strong>Note</strong> The SCSI port driver and SCSI miniport driver models may be altered or unavailable in the future. Instead, we recommend using the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-driver-overview">Storport driver</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/storport-miniport-drivers">Storport miniport</a> driver models.</p>

<h2 id="members">Members</h2>

<h3 id="numberofbuses"><code>NumberOfBuses</code></h3>

<p>Contains the number of buses on the adapter for which inquiry data is being reported.</p>

<h3 id="busdata"><code>BusData</code></h3>

<p>Contains a variable length array of <a href="scsi_bus_data" title="typedef struct _SCSI_BUS_DATA {&#10;  UCHAR NumberOfLogicalUnits;&#10;  UCHAR InitiatorBusId;&#10;  ULONG InquiryDataOffset;&#10;} SCSI_BUS_DATA, *PSCSI_BUS_DATA;">SCSI_BUS_DATA</a> structures that hold the inquiry data.</p>

<h2 id="remarks">Remarks</h2>

<p>SCSI_ADAPTER_BUS_INFO is a header structure that describes the layout of the output buffer of the <a href="ioctl_scsi_get_inquiry_data" title="// CTL_CODE(0x0004, 0x403, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_SCSI_GET_INQUIRY_DATA 0x0004100C">IOCTL_SCSI_GET_INQUIRY_DATA</a> request. This request returns SCSI inquiry data for all of the logical units on all of the buses associated with a particular SCSI host bus adapter (HBA). The <strong>BusData</strong> member of SCSI_ADAPTER_BUS_INFO contains a variable length array of <a href="scsi_bus_data" title="typedef struct _SCSI_BUS_DATA {&#10;  UCHAR NumberOfLogicalUnits;&#10;  UCHAR InitiatorBusId;&#10;  ULONG InquiryDataOffset;&#10;} SCSI_BUS_DATA, *PSCSI_BUS_DATA;">SCSI_BUS_DATA</a> structures. This array has one element for each SCSI bus on the adapter, so its size is equal to the number of buses indicated in the <strong>NumberOfBuses</strong> member of SCSI_ADAPTER_BUS_INFO.</p>

<p>In most cases, <strong>NumberOfBuses</strong> will have a value of 1. Early SCSI buses were limited to 36 targets (rather than the current limit of 128), so some vendors manufactured HBAs with several buses, in order to increase the maximum number of targets. To support these older HBAs, Windows provides a mechanism for retrieving inquiry data from HBAs with multiple buses. For adapters with a single bus, <strong>NumberOfBuses</strong> will be one, and the <strong>BusData</strong> member of SCSI_ADAPTER_BUS_INFO will have only one element, but HBAs with multiple buses will generate data for multiple <a href="scsi_bus_data" title="typedef struct _SCSI_BUS_DATA {&#10;  UCHAR NumberOfLogicalUnits;&#10;  UCHAR InitiatorBusId;&#10;  ULONG InquiryDataOffset;&#10;} SCSI_BUS_DATA, *PSCSI_BUS_DATA;">SCSI_BUS_DATA</a> structures, and <strong>NumberOfBuses</strong> will be greater than 1.</p>

<p>Immediately following the array in <strong>BusData</strong> is the inquiry data for all of the devices on all the buses that belong to the HBA. The <strong>InquiryDataOffset</strong> member of each <a href="scsi_bus_data" title="typedef struct _SCSI_BUS_DATA {&#10;  UCHAR NumberOfLogicalUnits;&#10;  UCHAR InitiatorBusId;&#10;  ULONG InquiryDataOffset;&#10;} SCSI_BUS_DATA, *PSCSI_BUS_DATA;">SCSI_BUS_DATA</a> structure provides an offset to the inquiry data for the corresponding SCSI bus.</p>

<p>The inquiry data for each SCSI bus includes information about all of the logical units on that bus. Each logical unit's inquiry data is formatted in a structure of type <a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">SCSI_INQUIRY_DATA</a>, and all of the <a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">SCSI_INQUIRY_DATA</a> structures for a particular bus are linked together by the <strong>NextInquiryDataOffset</strong> member. There will be a separate list for each SCSI bus, and the <strong>NextInquiryDataOffset</strong> member of the last structure in each list contains a value of zero.</p>

<p>The following pseudocode example illustrates how to step through the SCSI buses on an HBA, and the logical units for each bus, reading and printing the inquiry data for each logical unit:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>VOID
PrintInquiryData(PCHAR  DataBuffer)
{
    PSCSI_ADAPTER_BUS_INFO  adapterInfo;
    <a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">PSCSI_INQUIRY_DATA</a> inquiryData;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> i, j;

    adapterInfo = (PSCSI_ADAPTER_BUS_INFO) DataBuffer;
    for (i = 0; i &lt; adapterInfo-&gt;NumberOfBuses; i++) {
       inquiryData = (<a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">PSCSI_INQUIRY_DATA</a>) (DataBuffer +
          adapterInfo-&gt;BusData[i].InquiryDataOffset);
       while (adapterInfo-&gt;BusData[i].InquiryDataOffset) {
          printf(" %d   %d  %3d    %s    %.28s ",
             i,
             inquiryData-&gt;TargetId,
             inquiryData-&gt;Lun,
             (inquiryData-&gt;DeviceClaimed) ? "Y" : "N",
             &amp;inquiryData-&gt;InquiryData[8]);
          for (j = 0; j &lt; 8; j++) {
             printf("%02X ", inquiryData-&gt;InquiryData[j]);
          }
          printf("\n");
          if (inquiryData-&gt;NextInquiryDataOffset == 0) {
             break;
          }
          inquiryData = (<a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">PSCSI_INQUIRY_DATA</a>) (DataBuffer +
             inquiryData-&gt;NextInquiryDataOffset);
       }
    }
    printf("\n\n");
}
</code></pre>

<p>You must use <strong>NextInquiryDataOffset</strong> member to locate the inquiry data for next logical unit. Do not try to do this by pointer arithmetic. The positioning of each <a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">SCSI_INQUIRY_DATA</a> structure is potentially different for each HBA miniport driver, because it depends on data alignment requirements.</p>

<h2 id="see-also">See also</h2>

<p><a href="ioctl_scsi_get_inquiry_data" title="// CTL_CODE(0x0004, 0x403, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_SCSI_GET_INQUIRY_DATA 0x0004100C">IOCTL_SCSI_GET_INQUIRY_DATA</a></p>

<p><a href="scsi_bus_data" title="typedef struct _SCSI_BUS_DATA {&#10;  UCHAR NumberOfLogicalUnits;&#10;  UCHAR InitiatorBusId;&#10;  ULONG InquiryDataOffset;&#10;} SCSI_BUS_DATA, *PSCSI_BUS_DATA;">SCSI_BUS_DATA</a></p>

<p><a href="scsi_inquiry_data" title="typedef struct _SCSI_INQUIRY_DATA {&#10;  UCHAR   PathId;&#10;  UCHAR   TargetId;&#10;  UCHAR   Lun;&#10;  BOOLEAN DeviceClaimed;&#10;  ULONG   InquiryDataLength;&#10;  ULONG   NextInquiryDataOffset;&#10;  UCHAR   InquiryData[1];&#10;} SCSI_INQUIRY_DATA, *PSCSI_INQUIRY_DATA;">SCSI_INQUIRY_DATA</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_scsi_adapter_bus_info">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddscsi/ns-ntddscsi-_scsi_adapter_bus_info.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
