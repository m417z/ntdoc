<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DKMT_CREATE_DOORBELL - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DKMT_CREATE_DOORBELL - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DKMT_CREATE_DOORBELL - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmthk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _D3DKMT_CREATE_DOORBELL {
  D3DKMT_HANDLE                hHwQueue;
  D3DKMT_HANDLE                hRingBuffer;
  D3DKMT_HANDLE                hRingBufferControl;
  <a href="d3dkmt_create_doorbell_flags" title="typedef struct _D3DKMT_CREATE_DOORBELL_FLAGS {&#10;  union {&#10;    struct {&#10;      UINT RequireSecondaryCpuVA : 1;&#10;      UINT ResizeRingBufferOperation : 1;&#10;      UINT Reserved : 30;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DKMT_CREATE_DOORBELL_FLAGS;">D3DKMT_CREATE_DOORBELL_FLAGS</a> Flags;
  <a href="uint" title="typedef unsigned int UINT;">UINT</a>                         PrivateDriverDataSize;
  VOID                         *PrivateDriverData;
  VOID                         *DoorbellCPUVirtualAddress;
  VOID                         *DoorbellSecondaryCPUVirtualAddress;
  VOID                         *DoorbellStatusCPUVirtualAddress;
  VOID                         *HwQueueProgressFenceLastQueuedValueCPUVirtualAddress;
  D3DKMT_HANDLE                hDoorbell;
} D3DKMT_CREATE_DOORBELL;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dkmt_create_doorbell.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dkmthk-d3dkmt_create_doorbell)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>D3DKMT_CREATE_DOORBELL</strong> structure contains parameters for <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtcreatedoorbell"><strong>D3DKMTCreateDoorbell</strong></a>.</p>

<h2 id="members">Members</h2>

<h3 id="hhwqueue"><code>hHwQueue</code></h3>

<p>[in] UMD handle of the hardware queue object created in a prior call to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtcreatehwqueue"><strong>D3DKMTCreateHwQueue</strong></a>. This handle identifies the hardware queue for which a doorbell needs to be assigned.</p>

<h3 id="hringbuffer"><code>hRingBuffer</code></h3>

<p>[in] UMD handle to a ring buffer allocation that UMD <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtcreateallocation">previously created</a>. The allocation must be GPU visible and already resident. <em>Dxgkrnl</em> passes along the GPU virtual address (VA) and size of this allocation to KMD in a corresponding <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createdoorbell"><strong>DxgkDdiCreateDoorbell</strong></a> call. The <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell_flags"><strong>ResizeRingBufferOperation</strong></a> flag is a hint from UMD to KMD that a doorbell is being recreated for this hardware queue with a new, resized ring buffer.</p>

<h3 id="hringbuffercontrol"><code>hRingBufferControl</code></h3>

<p>[in/optional] UMD handle to a ring buffer control allocation <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtcreateallocation">previously created</a> by UMD. UMD and KMD can use this allocation as a control area to store ring buffer read/write pointer locations if required. The allocation must be GPU visible and already resident when UMD calls <strong><a href="d3dkmtcreatedoorbell" title="NTSTATUS D3DKMTCreateDoorbell(&#10;  D3DKMT_CREATE_DOORBELL *unnamedParam1&#10;);">D3DKMTCreateDoorbell</a></strong>. <em>Dxgkrnl</em> passes along the GPU VA and size of this allocation to KMD in a corresponding <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createdoorbell"><strong>DxgkDdiCreateDoorbell</strong></a> call.</p>

<h3 id="flags"><code>Flags</code></h3>

<p>[in/optional] A bit field of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell_flags"><strong>D3DKMT_CREATE_DOORBELL_FLAGS</strong></a> values specifying the doorbell creation flags.</p>

<h3 id="privatedriverdatasize"><code>PrivateDriverDataSize</code></h3>

<p>[in] Size of the private driver data that <strong>pPrivateDriverData</strong> points to, in bytes.</p>

<h3 id="privatedriverdata"><code>PrivateDriverData</code></h3>

<p>[in/out] Pointer to a buffer that is private to the driver. The size of this buffer is specified by <strong>PrivateDriverDataSize</strong>. The maximum buffer size allowed is D3DDDI_DOORBELL_PRIVATEDATA_MAX_BYTES_WDDM3_1 bytes.</p>

<h3 id="doorbellcpuvirtualaddress"><code>DoorbellCPUVirtualAddress</code></h3>

<p>[out] Pointer to the CPU VA (both read/write) reserved by the OS for this doorbell. UMD will write a specific value to this address, effectively "ringing the doorbell" to notify the GPU scheduler of a new work submission on the hardware queue. This address remains constant over the lifetime of the doorbell, even if the underlying physical doorbell gets disconnected. The UMD should always use this address to write/read to this doorbell.</p>

<h3 id="doorbellsecondarycpuvirtualaddress"><code>DoorbellSecondaryCPUVirtualAddress</code></h3>

<p>[out/optional] Pointer to a secondary CPU VA (both read/write) reserved by the OS for this doorbell.</p>

<p>On hardware that implements a secondary doorbell location the UMD sets the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell_flags"><strong>RequireSecondaryCpuVA</strong></a> flag. For such devices, the OS will reserve another CPU VA for this doorbell. Over the lifetime of the doorbell, this address will remain constant even if the underlying physical doorbell gets disconnected.</p>

<h3 id="doorbellstatuscpuvirtualaddress"><code>DoorbellStatusCPUVirtualAddress</code></h3>

<p>[out] Pointer to the CPU VA of the doorbell status. The value at this address indicates to the UMD whether the doorbell assigned to this hardware queue is currently connected. Each time the UMD submits new work to the queue and rings the doorbell, it must check this value to determine whether the doorbell ring succeeded. If the ring failed, UMD must call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtconnectdoorbell"><strong>D3DKMTConnectDoorbell</strong></a> to reconnect the doorbell and then try submitting the work again.</p>

<p>The OS allocates and writes this 64-bit doorbell status memory, maps it into the processâ€™s address space, and gives its user-mode CPU VA to the UMD to read from. Hence, UMD should read the 64-bit value stored in this address to obtain the doorbell status. The value of this address can be one of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dukmdt/ne-d3dukmdt-d3dddi_doorbellstatus"><strong>D3DDDI_DOORBELL_STATUS</strong></a> enum values.</p>

<p>This address remains constant over the lifetime of the doorbell, even if the underlying physical doorbell gets disconnected. The UMD should always use this address to read the doorbell's status.</p>

<p>Only the OS writes to and updates this status memory:</p>

<ul>
<li>On successful return from <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_connectdoorbell"><strong>DxgkDdiConnectDoorbell</strong></a>, the OS writes the status as D3DDDI_DOORBELL_STATUS_CONNECTED.</li>
<li>If the OS disconnects the doorbell as part of suspending the hardware queue or powering down the GPU, it calls KMD's <strong>DxgkDdiDisconnectDoorbell</strong> and then writes the status as D3DDDI_DOORBELL_STATUS_DISCONNECTED_RETRY.</li>
<li>If the KMD wants to disconnect the doorbell for any reason, it calls the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkcb_disconnectdoorbell"><strong>DxgkDisconnectDoorbellCB</strong></a> callback to inform the OS. KMD provides D3DDDI_DOORBELL_STATUS as the status, which the OS writes to this status page.</li>
<li>In GPU lost or stopped scenarios, the OS writes D3DDDI_DOORBELL_STATUS_DISCONNECTED_ABORT as the status.</li>
</ul>

<h3 id="hwqueueprogressfencelastqueuedvaluecpuvirtualaddress"><code>HwQueueProgressFenceLastQueuedValueCPUVirtualAddress</code></h3>

<p>[out] CPU VA of the location where the UMD will write the newly queued progress fence value every time a new command buffer is appended to the ring buffer.</p>

<h3 id="hdoorbell"><code>hDoorbell</code></h3>

<p>[out] Runtime handle to the newly created doorbell object.</p>

<h2 id="remarks">Remarks</h2>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/user-mode-work-submission">User-mode work submission</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell_flags"><strong>D3DKMT_CREATE_DOORBELL_FLAGS</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtconnectdoorbell"><strong>D3DKMTConnectDoorbell</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtcreateallocation"><strong>D3DKMTCreateAllocation</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/nf-d3dkmthk-d3dkmtcreatedoorbell"><strong>D3DKMTCreateDoorbell</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_connectdoorbell"><strong>DxgkDdiConnectDoorbell</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_createdoorbell"><strong>DxgkDdiCreateDoorbell</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmthk/ns-d3dkmthk-d3dkmt_create_doorbell.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
