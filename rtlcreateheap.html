<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RtlCreateHeap - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RtlCreateHeap - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RtlCreateHeap - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTRTL_H

</span><span class="ntdoc-code-intro">/**
 * The RtlCreateHeap routine creates a heap object that can be used by the calling process. This routine reserves
 * space in the virtual address space of the process and allocates physical storage for a specified initial portion of this block.
 *
 * \param Flags Flags specifying optional attributes of the heap.
 * \param HeapBase If HeapBase is a non-NULL value, it specifies the base address for a block of caller-allocated memory to use for the heap.
 * \param ReserveSize If ReserveSize is a nonzero value, it specifies the initial amount of memory, in bytes, to reserve for the heap.
 * \param CommitSize If CommitSize is a nonzero value, it specifies the initial amount of memory, in bytes, to commit for the heap.
 * \param Lock Pointer to an opaque structure to be used as the heap lock.
 * \param Parameters Pointer to a <a href="rtl_heap_parameters" title="typedef struct _RTL_HEAP_PARAMETERS&#10;{&#10;    ULONG Length;&#10;    SIZE_T SegmentReserve;&#10;    SIZE_T SegmentCommit;&#10;    SIZE_T DeCommitFreeBlockThreshold;&#10;    SIZE_T DeCommitTotalFreeThreshold;&#10;    SIZE_T MaximumAllocationSize;&#10;    SIZE_T VirtualMemoryThreshold;&#10;    SIZE_T InitialCommit;&#10;    SIZE_T InitialReserve;&#10;    PRTL_HEAP_COMMIT_ROUTINE CommitRoutine;&#10;    SIZE_T Reserved[2];&#10;} RTL_HEAP_PARAMETERS, *PRTL_HEAP_PARAMETERS;">RTL_HEAP_PARAMETERS</a> structure that contains parameters to be applied when creating the heap.
 * \return RtlCreateHeap returns a handle to be used in accessing the created heap.
 * \remarks https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcreateheap
 */
</span><span class="ntdoc-code-body">_Success_(return != 0)
_Must_inspect_result_
_Ret_maybenull_
NTSYSAPI
HANDLE
NTAPI
RtlCreateHeap(
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags,
    _In_opt_ PVOID HeapBase,
    _In_opt_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> ReserveSize,
    _In_opt_ <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> CommitSize,
    _In_opt_ PVOID Lock,
    _When_((Flags &amp; <a href="heap_create_segment_heap" title="#define HEAP_CREATE_SEGMENT_HEAP 0x00000100">HEAP_CREATE_SEGMENT_HEAP</a>) != 0, _In_reads_bytes_opt_(sizeof(<a href="rtl_segment_heap_parameters" title="typedef struct _RTL_SEGMENT_HEAP_PARAMETERS&#10;{&#10;    USHORT Version;&#10;    USHORT Size;&#10;    ULONG Flags;&#10;    RTL_SEGMENT_HEAP_MEMORY_SOURCE MemorySource;&#10;    SIZE_T Reserved[4];&#10;} RTL_SEGMENT_HEAP_PARAMETERS, *PRTL_SEGMENT_HEAP_PARAMETERS;">RTL_SEGMENT_HEAP_PARAMETERS</a>)))
    _When_((Flags &amp; <a href="heap_create_segment_heap" title="#define HEAP_CREATE_SEGMENT_HEAP 0x00000100">HEAP_CREATE_SEGMENT_HEAP</a>) == 0, _In_reads_bytes_opt_(sizeof(<a href="rtl_heap_parameters" title="typedef struct _RTL_HEAP_PARAMETERS&#10;{&#10;    ULONG Length;&#10;    SIZE_T SegmentReserve;&#10;    SIZE_T SegmentCommit;&#10;    SIZE_T DeCommitFreeBlockThreshold;&#10;    SIZE_T DeCommitTotalFreeThreshold;&#10;    SIZE_T MaximumAllocationSize;&#10;    SIZE_T VirtualMemoryThreshold;&#10;    SIZE_T InitialCommit;&#10;    SIZE_T InitialReserve;&#10;    PRTL_HEAP_COMMIT_ROUTINE CommitRoutine;&#10;    SIZE_T Reserved[2];&#10;} RTL_HEAP_PARAMETERS, *PRTL_HEAP_PARAMETERS;">RTL_HEAP_PARAMETERS</a>)))
    _In_opt_ PVOID Parameters
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/3d935379c6ac1f147cc4e3b25bed778f0d140c69/phnt/include/ntrtl.h#L6046">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI PVOID RtlCreateHeap(
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                Flags,
  [in, optional] PVOID                HeapBase,
  [in, optional] <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>               ReserveSize,
  [in, optional] <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>               CommitSize,
  [in, optional] PVOID                Lock,
  [in, optional] <a href="rtl_heap_parameters" title="typedef struct _RTL_HEAP_PARAMETERS&#10;{&#10;    ULONG Length;&#10;    SIZE_T SegmentReserve;&#10;    SIZE_T SegmentCommit;&#10;    SIZE_T DeCommitFreeBlockThreshold;&#10;    SIZE_T DeCommitTotalFreeThreshold;&#10;    SIZE_T MaximumAllocationSize;&#10;    SIZE_T VirtualMemoryThreshold;&#10;    SIZE_T InitialCommit;&#10;    SIZE_T InitialReserve;&#10;    PRTL_HEAP_COMMIT_ROUTINE CommitRoutine;&#10;    SIZE_T Reserved[2];&#10;} RTL_HEAP_PARAMETERS, *PRTL_HEAP_PARAMETERS;">PRTL_HEAP_PARAMETERS</a> Parameters
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcreateheap">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rtlcreateheap.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-rtlcreateheap)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rtlcreateheap-function">RtlCreateHeap function</h1>

<h2 id="description">Description</h2>

<p>The <strong>RtlCreateHeap</strong> routine creates a heap object that can be used by the calling process. This routine reserves space in the virtual address space of the process and allocates physical storage for a specified initial portion of this block.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="flags-in"><code>Flags</code> [in]</h3>

<p>Flags specifying optional attributes of the heap. These options affect subsequent access to the new heap through calls to the heap functions (<strong><a href="rtlallocateheap" title="_Success_(return != 0)&#10;_Must_inspect_result_&#10;_Ret_maybenull_&#10;_Post_writable_byte_size_(Size)&#10;__drv_allocatesMem(Mem)&#10;NTSYSAPI&#10;DECLSPEC_ALLOCATOR&#10;DECLSPEC_NOALIAS&#10;DECLSPEC_RESTRICT&#10;PVOID&#10;NTAPI&#10;RtlAllocateHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _In_ SIZE_T Size&#10;    );">RtlAllocateHeap</a></strong> and <strong><a href="rtlfreeheap" title="_Success_(return != 0)&#10;NTSYSAPI&#10;LOGICAL&#10;NTAPI&#10;RtlFreeHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _Frees_ptr_opt_ _Post_invalid_ PVOID BaseAddress&#10;    );">RtlFreeHeap</a></strong>).</p>

<p>Callers should set this parameter to zero if no optional attributes are requested.</p>

<p>This parameter can be one or more of the following values.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>HEAP_GENERATE_EXCEPTIONS</td>
  <td>Specifies that the system will indicate a heap failure by raising an exception, such as STATUS_NO_MEMORY, instead of returning NULL.</td>
</tr>
<tr>
  <td>HEAP_GROWABLE</td>
  <td>Specifies that the heap is growable. Must be specified if <strong>HeapBase</strong> is NULL.</td>
</tr>
<tr>
  <td>HEAP_NO_SERIALIZE</td>
  <td>Specifies that mutual exclusion will not be used when the heap functions allocate and free memory from this heap. The default, when HEAP_NO_SERIALIZE is not specified, is to serialize access to the heap. Serialization of heap access allows two or more threads to simultaneously allocate and free memory from the same heap.</td>
</tr>
</tbody>
</table>

<h3 id="heapbase-in-optional"><code>HeapBase</code> [in, optional]</h3>

<p>Specifies one of two actions:</p>

<p>If <strong>HeapBase</strong> is a non-NULL value, it specifies the base address for a block of caller-allocated memory to use for the heap.</p>

<p>If <strong>HeapBase</strong> is NULL, <strong>RtlCreateHeap</strong> allocates system memory for the heap from the process's virtual address space.</p>

<h3 id="reservesize-in-optional"><code>ReserveSize</code> [in, optional]</h3>

<p>If <strong>ReserveSize</strong> is a nonzero value, it specifies the initial amount of memory, in bytes, to reserve for the heap. <strong>RtlCreateHeap</strong> rounds <strong>ReserveSize</strong> up to the next page boundary, and then reserves a block of that size for the heap.</p>

<p>This parameter is optional and can be zero. The following table summarizes the interaction of the <strong>ReserveSize</strong> and <strong>CommitSize</strong> parameters.</p>

<table>
<thead>
<tr>
  <th>Values</th>
  <th>Result</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>ReserveSize</strong> zero, <strong>CommitSize</strong> zero</td>
  <td>64 pages are initially reserved for the heap. One page is initially committed.</td>
</tr>
<tr>
  <td><strong>ReserveSize</strong> zero, <strong>CommitSize</strong> nonzero</td>
  <td><strong>RtlCreateHeap</strong> sets <strong>ReserveSize</strong> to be equal to <strong>CommitSize</strong>, and then rounds <strong>ReserveSize</strong> up to the nearest multiple of (<a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> * 16).</td>
</tr>
<tr>
  <td><strong>ReserveSize</strong> nonzero, <strong>CommitSize</strong> zero</td>
  <td>One page is initially committed for the heap.</td>
</tr>
<tr>
  <td><strong>ReserveSize</strong> nonzero, <strong>CommitSize</strong> nonzero</td>
  <td>If <strong>CommitSize</strong> is greater than <strong>ReserveSize</strong>, <strong>RtlCreateHeap</strong> reduces <strong>CommitSize</strong> to <strong>ReserveSize</strong>.</td>
</tr>
</tbody>
</table>

<h3 id="commitsize-in-optional"><code>CommitSize</code> [in, optional]</h3>

<p>If <strong>CommitSize</strong> is a nonzero value, it specifies the initial amount of memory, in bytes, to commit for the heap. <strong>RtlCreateHeap</strong> rounds <strong>CommitSize</strong> up to the next page boundary, and then commits a block of that size in the process's virtual address space for the heap.</p>

<p>This parameter is optional and can be zero.</p>

<h3 id="lock-in-optional"><code>Lock</code> [in, optional]</h3>

<p>Pointer to an opaque ERESOURCE structure to be used as a resource lock. This parameter is optional and can be NULL. When provided by the caller, the structure must be allocated from nonpaged pool and initialized by calling <strong><a href="exinitializeresourcelite" title="NTSTATUS ExInitializeResourceLite(&#10;  [out] PERESOURCE Resource&#10;);">ExInitializeResourceLite</a></strong> or <strong><a href="exreinitializeresourcelite" title="NTSTATUS ExReinitializeResourceLite(&#10;  [in, out] PERESOURCE Resource&#10;);">ExReinitializeResourceLite</a></strong>. If the HEAP_NO_SERIALIZE flag is set, this parameter must be NULL.</p>

<h3 id="parameters-in-optional"><code>Parameters</code> [in, optional]</h3>

<p>Pointer to a <strong><a href="rtl_heap_parameters" title="typedef struct _RTL_HEAP_PARAMETERS&#10;{&#10;    ULONG Length;&#10;    SIZE_T SegmentReserve;&#10;    SIZE_T SegmentCommit;&#10;    SIZE_T DeCommitFreeBlockThreshold;&#10;    SIZE_T DeCommitTotalFreeThreshold;&#10;    SIZE_T MaximumAllocationSize;&#10;    SIZE_T VirtualMemoryThreshold;&#10;    SIZE_T InitialCommit;&#10;    SIZE_T InitialReserve;&#10;    PRTL_HEAP_COMMIT_ROUTINE CommitRoutine;&#10;    SIZE_T Reserved[2];&#10;} RTL_HEAP_PARAMETERS, *PRTL_HEAP_PARAMETERS;">RTL_HEAP_PARAMETERS</a></strong> structure that contains parameters to be applied when creating the heap. This parameter is optional and can be NULL.</p>

<h2 id="return-value">Return value</h2>

<p>On success, <strong>RtlCreateHeap</strong> returns a handle to be used in accessing the created heap. If <strong>RtlCreateHeap</strong> fails for any reason, it returns NULL. Reason for failure include:</p>

<ul>
<li>Invalid parameter combinations (or example, incompatible flags)</li>
<li>Memory allocation failures</li>
<li>Virtual memory query failures</li>
<li>Lock initialization failures</li>
<li>Heap segment initialization failures</li>
<li>Process heap list insertion failures</li>
</ul>

<h2 id="remarks">Remarks</h2>

<p><strong>RtlCreateHeap</strong> creates a private heap object from which the calling process can allocate memory blocks by calling <strong><a href="rtlallocateheap" title="_Success_(return != 0)&#10;_Must_inspect_result_&#10;_Ret_maybenull_&#10;_Post_writable_byte_size_(Size)&#10;__drv_allocatesMem(Mem)&#10;NTSYSAPI&#10;DECLSPEC_ALLOCATOR&#10;DECLSPEC_NOALIAS&#10;DECLSPEC_RESTRICT&#10;PVOID&#10;NTAPI&#10;RtlAllocateHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _In_ SIZE_T Size&#10;    );">RtlAllocateHeap</a></strong>. The initial commit size determines the number of pages that are initially allocated for the heap. The initial reserve size determines the number of pages that are initially reserved for the heap. Pages that are reserved but uncommitted create a block in the process's virtual address space into which the heap can expand.</p>

<p>If allocation requests made by <strong><a href="rtlallocateheap" title="_Success_(return != 0)&#10;_Must_inspect_result_&#10;_Ret_maybenull_&#10;_Post_writable_byte_size_(Size)&#10;__drv_allocatesMem(Mem)&#10;NTSYSAPI&#10;DECLSPEC_ALLOCATOR&#10;DECLSPEC_NOALIAS&#10;DECLSPEC_RESTRICT&#10;PVOID&#10;NTAPI&#10;RtlAllocateHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _In_ SIZE_T Size&#10;    );">RtlAllocateHeap</a></strong> exceed the heap's initial commit size, the system commits additional pages of physical storage for the heap, up to the heap's maximum size. If the heap is nongrowable, its maximum size is limited to its initial reserve size.</p>

<p>If the heap is growable, its size is limited only by available memory. If requests by <strong><a href="rtlallocateheap" title="_Success_(return != 0)&#10;_Must_inspect_result_&#10;_Ret_maybenull_&#10;_Post_writable_byte_size_(Size)&#10;__drv_allocatesMem(Mem)&#10;NTSYSAPI&#10;DECLSPEC_ALLOCATOR&#10;DECLSPEC_NOALIAS&#10;DECLSPEC_RESTRICT&#10;PVOID&#10;NTAPI&#10;RtlAllocateHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _In_ SIZE_T Size&#10;    );">RtlAllocateHeap</a></strong> exceed the current size of committed pages, the system calls <strong><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">ZwAllocateVirtualMemory</a></strong> to obtain the memory needed, assuming that the physical storage is available.</p>

<p>In addition, if the heap is nongrowable, an absolute limitation arises: the maximum size of a memory block in the heap is 0x7F000 bytes. The virtual memory threshold of the heap is equal to the maximum heap block size or the value of the <strong>VirtualMemoryThreshold</strong> member of the <strong>Parameters</strong> structure, whichever is less. The heap also may need to pad the request size for metadata and alignment purposes so requests to allocate blocks within 4096 Bytes (1 Page) of the <strong>VirtualMemoryThreshold</strong> may fail even if the maximum size of the heap is large enough to contain the block. (For more information about <strong>VirtualMemoryThreshold</strong>, see the members of the <strong>Parameters</strong> parameter to <strong>RtlCreateHeap</strong>.)</p>

<p>If the heap is growable, requests to allocate blocks larger than the heap's virtual memory threshold do not automatically fail; the system calls <strong><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">ZwAllocateVirtualMemory</a></strong> to obtain the memory needed for such large blocks.</p>

<p>The memory of a private heap object is accessible only to the process that created it.</p>

<p>The system uses memory from the private heap to store heap support structures, so not all of the specified heap size is available to the process. For example, if <strong><a href="rtlallocateheap" title="_Success_(return != 0)&#10;_Must_inspect_result_&#10;_Ret_maybenull_&#10;_Post_writable_byte_size_(Size)&#10;__drv_allocatesMem(Mem)&#10;NTSYSAPI&#10;DECLSPEC_ALLOCATOR&#10;DECLSPEC_NOALIAS&#10;DECLSPEC_RESTRICT&#10;PVOID&#10;NTAPI&#10;RtlAllocateHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _In_ SIZE_T Size&#10;    );">RtlAllocateHeap</a></strong> requests 64 kilobytes (K) from a heap with a maximum size of 64K, the request may fail because of system overhead.</p>

<p>If HEAP_NO_SERIALIZE is not specified (the simple default), the heap will serialize access within the calling process. Serialization ensures mutual exclusion when two or more threads attempt to simultaneously allocate or free blocks from the same heap. There is a small performance cost to serialization, but it must be used whenever multiple threads allocate and free memory from the same heap.</p>

<p>Setting HEAP_NO_SERIALIZE eliminates mutual exclusion on the heap. Without serialization, two or more threads that use the same heap handle might attempt to allocate or free memory simultaneously, likely causing corruption in the heap. Therefore, HEAP_NO_SERIALIZE can safely be used only in the following situations:</p>

<ul>
<li><p>The process has only one thread.</p></li>
<li><p>The process has multiple threads, but only one thread calls the heap functions for a specific heap.</p></li>
<li><p>The process has multiple threads, and the application provides its own mechanism for mutual exclusion to a specific heap.</p></li>
</ul>

<blockquote>
  <p>[!NOTE]
  To guard against an access violation, use structured exception handling to protect any code that writes to or reads from a heap. For more information about structured exception handling with memory accesses, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/handling-exceptions">Handling Exceptions**</a>.</p>
</blockquote>

<h2 id="see-also">See also</h2>

<p><strong><a href="rtlallocateheap" title="_Success_(return != 0)&#10;_Must_inspect_result_&#10;_Ret_maybenull_&#10;_Post_writable_byte_size_(Size)&#10;__drv_allocatesMem(Mem)&#10;NTSYSAPI&#10;DECLSPEC_ALLOCATOR&#10;DECLSPEC_NOALIAS&#10;DECLSPEC_RESTRICT&#10;PVOID&#10;NTAPI&#10;RtlAllocateHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _In_ SIZE_T Size&#10;    );">RtlAllocateHeap</a></strong></p>

<p><strong><a href="rtldestroyheap" title="_Success_(return == 0)&#10;NTSYSAPI&#10;PVOID&#10;NTAPI&#10;RtlDestroyHeap(&#10;    _In_ _Post_invalid_ HANDLE HeapHandle&#10;    );">RtlDestroyHeap</a></strong></p>

<p><strong><a href="rtlfreeheap" title="_Success_(return != 0)&#10;NTSYSAPI&#10;LOGICAL&#10;NTAPI&#10;RtlFreeHeap(&#10;    _In_ HANDLE HeapHandle,&#10;    _In_opt_ ULONG Flags,&#10;    _Frees_ptr_opt_ _Post_invalid_ PVOID BaseAddress&#10;    );">RtlFreeHeap</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcreateheap">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-rtlcreateheap.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcreateheap">documented in Windows Driver Kit</a>.</p>

<hr />

<h3>Flags</h3>

<p>Flags are defined in <strong>&lt;WinNT.h&gt;</strong>. Can be one of following:</p>

<ul>
<li><code>HEAP_NO_SERIALIZE</code></li>
<li><code>HEAP_GROWABLE</code></li>
<li><code>HEAP_GENERATE_EXCEPTIONS</code></li>
<li><code>HEAP_ZERO_MEMORY</code></li>
<li><code>HEAP_REALLOC_IN_PLACE_ONLY</code></li>
<li><code>HEAP_TAIL_CHECKING_ENABLED</code></li>
<li><code>HEAP_FREE_CHECKING_ENABLED</code></li>
<li><code>HEAP_DISABLE_COALESCE_ON_FREE</code></li>
<li><code>HEAP_CREATE_ALIGN_16</code></li>
<li><code>HEAP_CREATE_ENABLE_TRACING</code></li>
</ul>

<h3>Base</h3>

<p>Base address, where heap should be created. If memory was previously allocated at this address, heap is created at the nearest possible virtual address.</p>

<h3>Reserve</h3>

<p>How much bytes should be reserved. See <code><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtAllocateVirtualMemory</a></code>.</p>

<h3>Commit</h3>

<p>How many bytes should be committed. If <code>Reserve</code> is greater than zero, <code>Commit</code> must be less or equal to <code>Reserve</code>.</p>

<h3>Lock</h3>

<p>If set, heap will be locked. See <code><a href="rtllockheap" title="NTSYSAPI&#10;BOOLEAN&#10;NTAPI&#10;RtlLockHeap(&#10;    _In_ HANDLE HeapHandle&#10;    );">RtlLockHeap</a></code> / <code><a href="rtlunlockheap" title="NTSYSAPI&#10;BOOLEAN&#10;NTAPI&#10;RtlUnlockHeap(&#10;    _In_ HANDLE HeapHandle&#10;    );">RtlUnlockHeap</a></code>.</p>

<h3>RtlHeapParams</h3>

<p>Pointer to <code>RTL_HEAP_DEFINITION</code> structure. On <em>NT 4.0</em> all bytes of this (except length field) are set to zero.</p>

<h1>Documented by</h1>

<ul>
<li>Tomasz Nowak</li>
<li>ReactOS</li>
</ul>

<h1>See also</h1>

<ul>
<li><code><a href="ntallocatevirtualmemory" title="_Must_inspect_result_&#10;_When_(return == 0, __drv_allocatesMem(mem))&#10;NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtAllocateVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*RegionSize) _Writable_bytes_(*RegionSize) _Post_readable_byte_size_(*RegionSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtAllocateVirtualMemory</a></code></li>
<li><code><a href="ntlockvirtualmemory" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtLockVirtualMemory(&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ PVOID *BaseAddress,&#10;    _Inout_ PSIZE_T RegionSize,&#10;    _In_ ULONG MapType&#10;    );">NtLockVirtualMemory</a></code></li>
<li><code>RTL_HEAP_DEFINITION</code></li>
<li><code><a href="rtldestroyheap" title="_Success_(return == 0)&#10;NTSYSAPI&#10;PVOID&#10;NTAPI&#10;RtlDestroyHeap(&#10;    _In_ _Post_invalid_ HANDLE HeapHandle&#10;    );">RtlDestroyHeap</a></code></li>
<li><code><a href="rtllockheap" title="NTSYSAPI&#10;BOOLEAN&#10;NTAPI&#10;RtlLockHeap(&#10;    _In_ HANDLE HeapHandle&#10;    );">RtlLockHeap</a></code></li>
<li><code><a href="rtlunlockheap" title="NTSYSAPI&#10;BOOLEAN&#10;NTAPI&#10;RtlUnlockHeap(&#10;    _In_ HANDLE HeapHandle&#10;    );">RtlUnlockHeap</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/rtlcreateheap.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
