<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisMRegisterScatterGatherDma - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisMRegisterScatterGatherDma - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisMRegisterScatterGatherDma - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NDIS_STATUS NdisMRegisterScatterGatherDma(
  [in]      NDIS_HANDLE              MiniportAdapterHandle,
  [in, out] PNDIS_SG_DMA_DESCRIPTION DmaDescription,
  [out]     PNDIS_HANDLE             NdisMiniportDmaHandle
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismregisterscattergatherdma">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndismregisterscattergatherdma.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndismregisterscattergatherdma)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndismregisterscattergatherdma-function">NdisMRegisterScatterGatherDma function</h1>

<h2 id="description">Description</h2>

<blockquote>
  <p>[!CAUTION]
  For ARM and ARM64 processors, we strongly recommend that NDIS driver writers use WDF DMA or WDM DMA instead of NDIS Scatter/Gather DMA.</p>
  
  <p>For more information about WDF DMA, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/handling-dma-operations-in-kmdf-drivers">Handling DMA Operations in KMDF Drivers</a>.</p>
  
  <p>For more information about WDM DMA, see the DMA-related child topics of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/managing-input-output-for-drivers">Managing Input/Output for Drivers</a>.</p>
</blockquote>

<p>Bus master miniport drivers call the
<strong>NdisMRegisterScatterGatherDma</strong> function from
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a> to initialize a
scatter/gather DMA channel.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="miniportadapterhandle-in"><code>MiniportAdapterHandle</code> [in]</h3>

<p>The miniport handle that NDIS passed to
<em>MiniportInitializeEx</em>.</p>

<h3 id="dmadescription-in-out"><code>DmaDescription</code> [in, out]</h3>

<p>A pointer to an NDIS_SG_DMA_DESCRIPTION structure. This structure describes the scatter/gather DMA
properties of the miniport driver. The structure is defined as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>typedef struct _NDIS_SG_DMA_DESCRIPTION {
  <a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a>  Header;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  Flags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  MaximumPhysicalMapping;
  MINIPORT_PROCESS_SG_LIST_HANDLER  ProcessSGListHandler;
  MINIPORT_ALLOCATE_SHARED_MEM_COMPLETE_HANDLER  SharedMemAllocateCompleteHandler;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  ScatterGatherListSize;
} NDIS_SG_DMA_DESCRIPTION, *PNDIS_SG_DMA_DESCRIPTION;

</code></pre>

<p>This structure includes the following members:</p>

<h4 id="header">Header</h4>

<p>The
<a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a> structure for the
NDIS_SG_DMA_DESCRIPTION structure. Set the
<strong>Type</strong> member of the structure that
<strong>Header</strong> specifies to NDIS_OBJECT_TYPE_SG_DMA_DESCRIPTION, the
<strong>Revision</strong> member to NDIS_SG_DMA_DESCRIPTION_REVISION_1, and the
<strong>Size</strong> member to NDIS_SIZEOF_SG_DMA_DESCRIPTION_REVISION_1.</p>

<h4 id="flags">Flags</h4>

<p>A set of bit flags that define scatter/gather characteristics. Set this member to the bitwise OR
of all the required flags.</p>

<p>The NDIS_SG_DMA_64_BIT_ADDRESS flag specifies that the NIC can use 64-bit addressing for DMA
operations. Otherwise, the NIC uses 32-bit addressing.</p>

<p>Set this member to zero if 64-bit addressing is not required.</p>

<h4 id="maximumphysicalmapping">MaximumPhysicalMapping</h4>

<p>The maximum number of bytes that the NIC can transfer in a single DMA operation. NDIS provides
this value to the hardware abstraction layer (HAL) when allocating a DMA channel, and HAL uses this
value to determine the maximum number of map registers to reserve for the NIC.</p>

<h4 id="processsglisthandler">ProcessSGListHandler</h4>

<p>The
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_process_sg_list">MiniportProcessSGList</a> function
that NDIS calls when HAL is done building the scatter/gather list.</p>

<h4 id="sharedmemallocatecompletehandler">SharedMemAllocateCompleteHandler</h4>

<p>The
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_allocate_shared_mem_complete">MiniportSharedMemoryAllocateComplete</a> function for miniport drivers that call
<a href="ndismallocatesharedmemoryasyncex" title="NDIS_STATUS NdisMAllocateSharedMemoryAsyncEx(&#10;  [in] NDIS_HANDLE MiniportDmaHandle,&#10;  [in] ULONG       Length,&#10;  [in] BOOLEAN     Cached,&#10;  [in] PVOID       Context&#10;);">NdisMAllocateSharedMemoryAsyncEx</a>. This field is optional and it should be <strong>NULL</strong> if the miniport
driver does not call
<strong><a href="ndismallocatesharedmemoryasyncex" title="NDIS_STATUS NdisMAllocateSharedMemoryAsyncEx(&#10;  [in] NDIS_HANDLE MiniportDmaHandle,&#10;  [in] ULONG       Length,&#10;  [in] BOOLEAN     Cached,&#10;  [in] PVOID       Context&#10;);">NdisMAllocateSharedMemoryAsyncEx</a></strong>.</p>

<h4 id="scattergatherlistsize">ScatterGatherListSize</h4>

<p>The size, in bytes, of the memory that is required to hold a scatter/gather list. NDIS sets this
value before it returns from
<strong>NdisMRegisterScatterGatherDma</strong>. Miniport drivers should use this size to preallocate memory for
each scatter/gather list.</p>

<h3 id="ndisminiportdmahandle-out"><code>NdisMiniportDmaHandle</code> [out]</h3>

<p>A pointer to a variable that the caller supplies and that NDIS fills with a handle. The handle
identifies a context area that NDIS uses to manage this DMA resource. The miniport driver passes this
handle to NDIS in subsequent calls to NDIS that involve this DMA resource.</p>

<h2 id="return-value">Return value</h2>

<p><strong>NdisMRegisterScatterGatherDma</strong> returns one of the following:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NDIS_STATUS_SUCCESS</strong></td>
  <td><strong>NdisMRegisterScatterGatherDma</strong> successfully allocated resources for bus-master DMA operations.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_RESOURCES</strong></td>
  <td><strong>NdisMRegisterScatterGatherDma</strong> failed due to insufficient resources.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_NOT_SUPPORTED</strong></td>
  <td><strong>NdisMRegisterScatterGatherDma</strong> failed because the miniport did not specify that it supports NDIS 6.0 or later versions, or because the miniport driver did not specify that its NIC is a bus-master DMA device. A miniport driver specifies its NDIS version when it calls <a href="ndismregisterminiportdriver" title="NDIS_STATUS NdisMRegisterMiniportDriver(&#10;  [in]           PDRIVER_OBJECT                        DriverObject,&#10;  [in]           PUNICODE_STRING                       RegistryPath,&#10;  [in, optional] NDIS_HANDLE                           MiniportDriverContext,&#10;  [in]           PNDIS_MINIPORT_DRIVER_CHARACTERISTICS MiniportDriverCharacteristics,&#10;  [out]          PNDIS_HANDLE                          NdisMiniportDriverHandle&#10;);">NdisMRegisterMiniportDriver</a>. A miniport driver specifies that it supports bus-master DMA devices when it calls <a href="ndismsetminiportattributes" title="NDIS_STATUS NdisMSetMiniportAttributes(&#10;       NDIS_HANDLE                       NdisMiniportHandle,&#10;  [in] PNDIS_MINIPORT_ADAPTER_ATTRIBUTES MiniportAttributes&#10;);">NdisMSetMiniportAttributes</a>.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_BAD_VERSION</strong></td>
  <td>The current version of NDIS does not support the version specified in the <strong>Revision</strong> member of the <strong>Header</strong> structure of <em>DmaDescription</em> .</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>An NDIS bus-master miniport driver calls
<strong>NdisMRegisterScatterGatherDma</strong> within its
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a> function to
initialize resources for scatter/gather DMA operations. The
<em>DmaDescription</em> parameter that the miniport driver passes to
<strong>NdisMRegisterScatterGatherDma</strong> contains the information that NDIS uses to initialize the
scatter/gather DMA resources. After
<strong>NdisMRegisterScatterGatherDma</strong> returns, the
<strong>ScatterGatherListSize</strong> member of
<em>DmaDescription</em> contains a buffer size that should be sufficient to hold a scatter/gather list.
Miniport drivers should use this size to preallocate the memory for scatter/gather lists.</p>

<p>The
<strong>ProcessSGListHandler</strong> member in the
<em>DmaDescription</em> parameter defines the entry point in the miniport driver for the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_process_sg_list">MiniportProcessSGList</a> function.
When a miniport driver calls
<a href="ndismallocatenetbuffersglist" title="NDIS_STATUS NdisMAllocateNetBufferSGList(&#10;  [in]           NDIS_HANDLE NdisMiniportDmaHandle,&#10;  [in]           PNET_BUFFER NetBuffer,&#10;  [in]           PVOID       Context,&#10;  [in]           ULONG       Flags,&#10;  [in, optional] PVOID       ScatterGatherListBuffer,&#10;  [in]           ULONG       ScatterGatherListBufferSize&#10;);">NdisMAllocateNetBufferSGList</a>, NDIS calls HAL to provide the scatter/gather list to the miniport
driver. HAL calls
<em>MiniportProcessSGList</em> after HAL finishes building the scatter/gather list. NDIS can call
<em>MiniportProcessSGList</em> outside the context of the call to
<strong><a href="ndismallocatenetbuffersglist" title="NDIS_STATUS NdisMAllocateNetBufferSGList(&#10;  [in]           NDIS_HANDLE NdisMiniportDmaHandle,&#10;  [in]           PNET_BUFFER NetBuffer,&#10;  [in]           PVOID       Context,&#10;  [in]           ULONG       Flags,&#10;  [in, optional] PVOID       ScatterGatherListBuffer,&#10;  [in]           ULONG       ScatterGatherListBufferSize&#10;);">NdisMAllocateNetBufferSGList</a></strong>.</p>

<p><strong>NdisMRegisterScatterGatherDma</strong> returns a pointer to a context area that is opaque to the miniport
driver. The miniport driver must use this handle in subsequent calls to NDIS scatter/gather DMA
functions.</p>

<p>Bus-master miniport drivers call
<a href="ndismallocatesharedmemoryasyncex" title="NDIS_STATUS NdisMAllocateSharedMemoryAsyncEx(&#10;  [in] NDIS_HANDLE MiniportDmaHandle,&#10;  [in] ULONG       Length,&#10;  [in] BOOLEAN     Cached,&#10;  [in] PVOID       Context&#10;);">NdisMAllocateSharedMemoryAsyncEx</a> to dynamically allocate shared memory for data transfer
operations. This call is required when high network traffic causes the miniport driver to run low on the
shared memory space that the driver allocated during initialization. If
<strong><a href="ndismallocatesharedmemoryasyncex" title="NDIS_STATUS NdisMAllocateSharedMemoryAsyncEx(&#10;  [in] NDIS_HANDLE MiniportDmaHandle,&#10;  [in] ULONG       Length,&#10;  [in] BOOLEAN     Cached,&#10;  [in] PVOID       Context&#10;);">NdisMAllocateSharedMemoryAsyncEx</a></strong> returns NDIS_STATUS_PENDING, NDIS calls the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_allocate_shared_mem_complete">MiniportSharedMemoryAllocateComplete</a> function to complete the operation at a later time. Miniport
drivers specify the entry point for the
<em>MiniportSharedMemoryAllocateComplete</em> function in the
<strong>SharedMemAllocateCompleteHandler</strong> member of the
<em>DmaDescription</em> parameter.</p>

<p>Miniport drivers call the
<a href="ndismderegisterscattergatherdma" title="VOID NdisMDeregisterScatterGatherDma(&#10;  [in] NDIS_HANDLE NdisMiniportDmaHandle&#10;);">NdisMDeregisterScatterGatherDma</a> function to deallocate the DMA resources that
<strong>NdisMRegisterScatterGatherDma</strong> allocated.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_process_sg_list">MiniportProcessSGList</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_allocate_shared_mem_complete">MiniportSharedMemoryAllocateComplete</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-scatter-gather-dma">NDIS Scatter/Gather DMA</a></p>

<p><a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a></p>

<p><a href="ndismallocatenetbuffersglist" title="NDIS_STATUS NdisMAllocateNetBufferSGList(&#10;  [in]           NDIS_HANDLE NdisMiniportDmaHandle,&#10;  [in]           PNET_BUFFER NetBuffer,&#10;  [in]           PVOID       Context,&#10;  [in]           ULONG       Flags,&#10;  [in, optional] PVOID       ScatterGatherListBuffer,&#10;  [in]           ULONG       ScatterGatherListBufferSize&#10;);">NdisMAllocateNetBufferSGList</a></p>

<p><a href="ndismallocatesharedmemoryasyncex" title="NDIS_STATUS NdisMAllocateSharedMemoryAsyncEx(&#10;  [in] NDIS_HANDLE MiniportDmaHandle,&#10;  [in] ULONG       Length,&#10;  [in] BOOLEAN     Cached,&#10;  [in] PVOID       Context&#10;);">NdisMAllocateSharedMemoryAsyncEx</a></p>

<p><a href="ndismderegisterscattergatherdma" title="VOID NdisMDeregisterScatterGatherDma(&#10;  [in] NDIS_HANDLE NdisMiniportDmaHandle&#10;);">NdisMDeregisterScatterGatherDma</a></p>

<p><a href="ndismregisterminiportdriver" title="NDIS_STATUS NdisMRegisterMiniportDriver(&#10;  [in]           PDRIVER_OBJECT                        DriverObject,&#10;  [in]           PUNICODE_STRING                       RegistryPath,&#10;  [in, optional] NDIS_HANDLE                           MiniportDriverContext,&#10;  [in]           PNDIS_MINIPORT_DRIVER_CHARACTERISTICS MiniportDriverCharacteristics,&#10;  [out]          PNDIS_HANDLE                          NdisMiniportDriverHandle&#10;);">NdisMRegisterMiniportDriver</a></p>

<p><a href="ndismsetminiportattributes" title="NDIS_STATUS NdisMSetMiniportAttributes(&#10;       NDIS_HANDLE                       NdisMiniportHandle,&#10;  [in] PNDIS_MINIPORT_ADAPTER_ATTRIBUTES MiniportAttributes&#10;);">NdisMSetMiniportAttributes</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismregisterscattergatherdma">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndismregisterscattergatherdma.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
