<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KS_VBI_FRAME_INFO - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KS_VBI_FRAME_INFO - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KS_VBI_FRAME_INFO - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ksmedia.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct tagKS_VBI_FRAME_INFO {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                  ExtendedHeaderSize;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>                  dwFrameFlags;
  <a href="longlong" title="typedef __int64 LONGLONG;">LONGLONG</a>               PictureNumber;
  <a href="longlong" title="typedef __int64 LONGLONG;">LONGLONG</a>               DropCount;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>                  dwSamplingFrequency;
  <a href="ks_tvtuner_change_info" title="typedef struct tagKS_TVTUNER_CHANGE_INFO {&#10;  DWORD dwFlags;&#10;  DWORD dwCountryCode;&#10;  DWORD dwAnalogVideoStandard;&#10;  DWORD dwChannel;&#10;} KS_TVTUNER_CHANGE_INFO, *PKS_TVTUNER_CHANGE_INFO;">KS_TVTUNER_CHANGE_INFO</a> TvTunerChangeInfo;
  <a href="ks_vbiinfoheader" title="typedef struct tagKS_VBIINFOHEADER {&#10;  ULONG StartLine;&#10;  ULONG EndLine;&#10;  ULONG SamplingFrequency;&#10;  ULONG MinLineStartTime;&#10;  ULONG MaxLineStartTime;&#10;  ULONG ActualLineStartTime;&#10;  ULONG ActualLineEndTime;&#10;  ULONG VideoStandard;&#10;  ULONG SamplesPerLine;&#10;  ULONG StrideInBytes;&#10;  ULONG BufferSize;&#10;} KS_VBIINFOHEADER, *PKS_VBIINFOHEADER;">KS_VBIINFOHEADER</a>       VBIInfoHeader;
} KS_VBI_FRAME_INFO, *PKS_VBI_FRAME_INFO;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-tagks_vbi_frame_info">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ks_vbi_frame_info.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ksmedia-tagks_vbi_frame_info)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>KS_VBI_FRAME_INFO</strong> structure extends the <strong><a href="ksstream_header" title="typedef struct {&#10;  ULONG    Size;&#10;  ULONG    TypeSpecificFlags;&#10;  KSTIME   PresentationTime;&#10;  LONGLONG Duration;&#10;  ULONG    FrameExtent;&#10;  ULONG    DataUsed;&#10;  PVOID    Data;&#10;  ULONG    OptionsFlags;&#10;  ULONG    Reserved;&#10;} KSSTREAM_HEADER, *PKSSTREAM_HEADER;">KSSTREAM_HEADER</a></strong> structure for vertical blanking interval (VBI) streams.</p>

<h2 id="members">Members</h2>

<h3 id="extendedheadersize"><code>ExtendedHeaderSize</code></h3>

<p>Specifies the size of this structure.</p>

<h3 id="dwframeflags"><code>dwFrameFlags</code></h3>

<p>Specifies flags indicating additional information about the frame captured. During capture, the minidriver sets this member to one of the following values that are defined in <em>ksmedia.h</em>:</p>

<table>
<thead>
<tr>
  <th>Flag</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>KS_VBI_FLAG_FIELD1</td>
  <td>Indicates the first field of a two-field sequence</td>
</tr>
<tr>
  <td>KS_VBI_FLAG_FIELD2</td>
  <td>Indicates the second field of a two-field sequence</td>
</tr>
<tr>
  <td>KS_VBI_FLAG_MV_PRESENT</td>
  <td>Indicates Macrovision protection scheme</td>
</tr>
<tr>
  <td>KS_VBI_FLAG_MV_HARDWARE</td>
  <td>Indicates Macrovision hardware support</td>
</tr>
<tr>
  <td>KS_VBI_FLAG_MV_DETECTED</td>
  <td>Indicates Macrovision detected</td>
</tr>
<tr>
  <td>KS_VBI_FLAG_TVTUNER_CHANGE</td>
  <td>Indicates that the <strong>TvTunerChangeInfo</strong> member structure contains valid data</td>
</tr>
<tr>
  <td>KS_VBI_FLAG_VBIINFOHEADER_CHANGE</td>
  <td>Indicates that the <strong>VBIInfoHeader</strong> member structure contains valid data</td>
</tr>
</tbody>
</table>

<h3 id="picturenumber"><code>PictureNumber</code></h3>

<p>Specifies a count representing the current picture number. Initialize or update this value on transition into KSSTATE_ACQUIRE.</p>

<h3 id="dropcount"><code>DropCount</code></h3>

<p>Specifies the number of pictures that were not captured. When capturing video, the minidriver sets this member. This counter should be incremented whenever a frame should have been captured but was not; this condition usually arises when no buffers were available during capture. Initialize or update this value on transition into KSSTATE_ACQUIRE.</p>

<h3 id="dwsamplingfrequency"><code>dwSamplingFrequency</code></h3>

<p>Specifies the sampling frequency in hertz (Hz).</p>

<h3 id="tvtunerchangeinfo"><code>TvTunerChangeInfo</code></h3>

<p>Specifies information about the current VBI data source, including country/region code, analog video standard, and channel. This member is only valid if <strong>dwFrameFlags</strong> specifies the KS_VBI_FLAG_TVTUNER_CHANGE flag.</p>

<h3 id="vbiinfoheader"><code>VBIInfoHeader</code></h3>

<p>Specifies information about the current VBI data source, including start line, end line, sampling frequency, and video standard. This member is only valid if <strong>dwFrameFlags</strong> specifies the KS_VBI_FLAG_VBIINFOHEADER_CHANGE flag.</p>

<h2 id="remarks">Remarks</h2>

<p>The KS_VBI_FRAME_INFO structure provides a way to return information about a captured frame, as well as providing tuning information to VBI decoders.</p>

<p>The <strong>PictureNumber</strong> member count represents the count of the current picture based on the format used to open the stream. This count is calculated in one of two ways, depending on the device:</p>

<ol>
<li><p>Measure the time since the stream was started and divide by the frame duration. This method is appropriate for devices that do not provide their own clock. For example: <em>PictureNumber = (CurrentStreamTime âˆ’ StartStreamTime) / FrameDuration</em></p></li>
<li><p>Add together the count of frames captured and the count of frames dropped. This method is appropriate for devices that provide their own clock. For example: <em>PictureNumber = FramesCaptured + FramesDropped</em></p></li>
</ol>

<p>When calculating the <strong>PictureNumber</strong> and <strong>DropCount</strong>, it is important to use the frame duration specified when the stream was opened, which may not necessarily match the rate at which the device is actually producing images. For example, a USB camera may only produce images at 7.5 fps, but a client could open the stream at 8 fps. In this case, all calculations should use the 8 fps number. For more information about updating <strong>PictureNumber</strong> and <strong>DropCount</strong> see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/capturing-video">Capturing Video</a>.</p>

<p>The <strong>dwSamplingFrequency</strong> member is not used by Microsoft VBI codecs, but may be used by other WDM codecs. It must be the same as the <strong>VBIInfoHeader</strong>.<em>SamplingFrequency</em> member. A minidriver indicates a change in sampling frequency by setting the KS_VBI_FLAG_VBIINFOHEADER_CHANGE bit in the <strong>dwFrameFlags</strong> member, and filling in all members, including <strong>dwSamplingFrequency</strong>, in the <strong>VBIInfoHeader</strong> structure.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="ksstream_header" title="typedef struct {&#10;  ULONG    Size;&#10;  ULONG    TypeSpecificFlags;&#10;  KSTIME   PresentationTime;&#10;  LONGLONG Duration;&#10;  ULONG    FrameExtent;&#10;  ULONG    DataUsed;&#10;  PVOID    Data;&#10;  ULONG    OptionsFlags;&#10;  ULONG    Reserved;&#10;} KSSTREAM_HEADER, *PKSSTREAM_HEADER;">KSSTREAM_HEADER</a></strong></p>

<p><strong><a href="ks_tvtuner_change_info" title="typedef struct tagKS_TVTUNER_CHANGE_INFO {&#10;  DWORD dwFlags;&#10;  DWORD dwCountryCode;&#10;  DWORD dwAnalogVideoStandard;&#10;  DWORD dwChannel;&#10;} KS_TVTUNER_CHANGE_INFO, *PKS_TVTUNER_CHANGE_INFO;">KS_TVTUNER_CHANGE_INFO</a></strong></p>

<p><strong><a href="ks_vbiinfoheader" title="typedef struct tagKS_VBIINFOHEADER {&#10;  ULONG StartLine;&#10;  ULONG EndLine;&#10;  ULONG SamplingFrequency;&#10;  ULONG MinLineStartTime;&#10;  ULONG MaxLineStartTime;&#10;  ULONG ActualLineStartTime;&#10;  ULONG ActualLineEndTime;&#10;  ULONG VideoStandard;&#10;  ULONG SamplesPerLine;&#10;  ULONG StrideInBytes;&#10;  ULONG BufferSize;&#10;} KS_VBIINFOHEADER, *PKS_VBIINFOHEADER;">KS_VBIINFOHEADER</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-tagks_vbi_frame_info">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ksmedia/ns-ksmedia-tagks_vbi_frame_info.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
