<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// netreceivescaling.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES EvtNetAdapterReceiveScalingSetIndirectionEntries;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> EvtNetAdapterReceiveScalingSetIndirectionEntries(
  [_In_]    NETADAPTER Adapter,
  [_Inout_] <a href="net_adapter_receive_scaling_indirection_entries" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES {&#10;  NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY *Entries;&#10;  SIZE_T                                        Length;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</a> *IndirectionEntries
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netreceivescaling/nc-netreceivescaling-evt_net_adapter_receive_scaling_set_indirection_entries">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/evt_net_adapter_receive_scaling_set_indirection_entries.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-netreceivescaling-evt_net_adapter_receive_scaling_set_indirection_entries)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="evt_net_adapter_receive_scaling_set_indirection_entries-callback-function">EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES callback function</h1>

<h2 id="description">Description</h2>

<p>The <em>EvtNetAdapterReceiveScalingSetIndirectionEntries</em> callback function is implemented by the client driver to perform moves of receive side scaling (RSS) indirection table entries to new receive queues.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="adapter-_in_"><code>Adapter</code> [<em>In</em>]</h3>

<p>The NETADAPTER object the client driver obtained in a previous call to <strong><a href="netadaptercreate" title="NTSTATUS NetAdapterCreate(&#10;  [_In_]     NETADAPTER_INIT       *AdapterInit,&#10;  [_In_opt_] WDF_OBJECT_ATTRIBUTES *AdapterAttributes,&#10;  [_Out_]    NETADAPTER            *Adapter&#10;);">NetAdapterCreate</a></strong>.</p>

<h3 id="indirectionentries-_inout_"><code>IndirectionEntries</code> [<em>Inout</em>]</h3>

<p>A pointer to a <strong><a href="net_adapter_receive_scaling_indirection_entries" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES {&#10;  NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY *Entries;&#10;  SIZE_T                                        Length;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</a></strong> structure that represents the indirection table.</p>

<h2 id="return-value">Return value</h2>

<p>Returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the move operations were successful. Otherwise, returns an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> error code.</p>

<h2 id="prototype">Prototype</h2>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="c1">//Declaration</span>

<span class="n">EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES</span><span class="w"> </span><span class="n">EvtNetAdapterReceiveScalingSetIndirectionEntries</span><span class="p">;</span>

<span class="c1">// Definition</span>

<span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span><span class="w"> </span><span class="nf">EvtNetAdapterReceiveScalingSetIndirectionEntries</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">_In_</span><span class="w">    </span><span class="n">NETADAPTER</span><span class="w">                                          </span><span class="n">Adapter</span><span class="p">,</span>
<span class="w">    </span><span class="n">_Inout_</span><span class="w"> </span><span class="n"><a href="net_adapter_receive_scaling_indirection_entries" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES {&#10;  NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY *Entries;&#10;  SIZE_T                                        Length;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</a></span><span class="w"> </span><span class="o">*</span><span class="w">   </span><span class="n">IndirectionEntries</span>
<span class="p">)</span>
<span class="p">{...}</span>

<span class="k">typedef</span><span class="w"> </span><span class="n">EVT_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES</span><span class="w"> </span><span class="o">*</span><span class="n">PFN_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES</span>
</code></pre>
</div>

<h2 id="remarks">Remarks</h2>

<p>Register your implementation of this callback function by setting the appropriate member of the <strong><a href="net_adapter_receive_scaling_capabilities" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_CAPABILITIES {&#10;  ULONG                                                   Size;&#10;  SIZE_T                                                  NumberOfQueues;&#10;  SIZE_T                                                  IndirectionTableSize;&#10;  SIZE_T                                                  UnhashedTargetIndex;&#10;  NET_ADAPTER_RECEIVE_SCALING_UNHASHED_TARGET_TYPE        UnhashedTargetType;&#10;  NET_ADAPTER_RECEIVE_SCALING_HASH_TYPE                   ReceiveScalingHashTypes;&#10;  NET_ADAPTER_RECEIVE_SCALING_PROTOCOL_TYPE               ReceiveScalingProtocolTypes;&#10;  struct {&#10;    NET_ADAPTER_RECEIVE_SCALING_ENCAPSULATION_TYPE Outer;&#10;    NET_ADAPTER_RECEIVE_SCALING_ENCAPSULATION_TYPE Inner;&#10;  } ReceiveScalingEncapsulationTypes;&#10;  _RECEIEVE_SCALING_ENCAPSULATION                         _RECEIEVE_SCALING_ENCAPSULATION;&#10;  BOOLEAN                                                 SynchronizeSetIndirectionEntries;&#10;  PFN_NET_ADAPTER_RECEIVE_SCALING_ENABLE                  EvtAdapterReceiveScalingEnable;&#10;  PFN_NET_ADAPTER_RECEIVE_SCALING_DISABLE                 EvtAdapterReceiveScalingDisable;&#10;  PFN_NET_ADAPTER_RECEIVE_SCALING_SET_HASH_SECRET_KEY     EvtAdapterReceiveScalingSetHashSecretKey;&#10;  PFN_NET_ADAPTER_RECEIVE_SCALING_SET_INDIRECTION_ENTRIES EvtAdapterReceiveScalingSetIndirectionEntries;&#10;} NET_ADAPTER_RECEIVE_SCALING_CAPABILITIES;">NET_ADAPTER_RECEIVE_SCALING_CAPABILITIES</a></strong> structure and then calling <strong><a href="netadaptersetreceivescalingcapabilities" title="void NetAdapterSetReceiveScalingCapabilities(&#10;  [_In_] NETADAPTER                                     Adapter,&#10;  [_In_] const NET_ADAPTER_RECEIVE_SCALING_CAPABILITIES *Capabilities&#10;);">NetAdapterSetReceiveScalingCapabilities</a></strong>. Client drivers typically call <strong><a href="netadaptersetreceivescalingcapabilities" title="void NetAdapterSetReceiveScalingCapabilities(&#10;  [_In_] NETADAPTER                                     Adapter,&#10;  [_In_] const NET_ADAPTER_RECEIVE_SCALING_CAPABILITIES *Capabilities&#10;);">NetAdapterSetReceiveScalingCapabilities</a></strong> when starting a net adapter, before calling <strong><a href="netadapterstart" title="NTSTATUS NetAdapterStart(&#10;  [_In_] NETADAPTER Adapter&#10;);">NetAdapterStart</a></strong>.</p>

<p>When a protocol driver needs to rebalance processor workload in RSS, it first calculates a new mapping for each indirection table entry to a new processor. Then the protocol passes this information to NetAdapterCx, which internally maps processor numbers to NIC receive queue IDs. NetAdapterCx stores the new indirection table, with entries mapped to receive queue IDs, in a <strong><a href="net_adapter_receive_scaling_indirection_entries" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES {&#10;  NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY *Entries;&#10;  SIZE_T                                        Length;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</a></strong> structure and passes this structure to the NIC client driver when it invokes the driver's <em>EvtNetAdapterReceiveScalingSetIndirectionEntries</em> callback function.</p>

<p>In this callback, client drivers move each entry in their NIC's indirection table to the specified receive queue. Each <strong><a href="net_adapter_receive_scaling_indirection_entry" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY {&#10;  NETPACKETQUEUE PacketQueue;&#10;  NTSTATUS       Status;&#10;  UINT32         Index;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY</a></strong> structure in the <strong><a href="net_adapter_receive_scaling_indirection_entries" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES {&#10;  NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY *Entries;&#10;  SIZE_T                                        Length;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</a></strong> array contains the hash index for that entry in the table, the new receive queue to which to assign the entry, and a status field indicating if that individual move succeeded or not.</p>

<p>The function of assigning index entries to hardware receive queues depends on the design of each NIC. For example, some NIC client drivers might assign their own IDs to each receive queue that are different from the NetAdapterCx-assigned IDs, so they would have to first translate the provided queue IDs to their own queue IDs before reassigning indirection table entries. Other NICs might have a compressed indirection table that differs in size from the system-maintained indirection table, so client drivers of those NICs would need to calculate the correct index into their hardware's indirection table when assigning entries. For a code sample of this second example, see the <a rel="noopener" target="_blank" href="https://github.com/Microsoft/NetAdapter-Cx-Driver-Samples/tree/master/RtEthSample">Realtek Github sample driver</a>.</p>

<h3 id="example">Example</h3>

<p>This simple example assumes a 1:1 ratio of receive queues to processors, so the NIC's indirection table is the same size as the system's indirection table.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span>
<span class="nf">MyEvtNetAdapterReceiveScalingSetIndirectionEntries</span><span class="p">(</span>
<span class="w">    </span><span class="n">_In_</span><span class="w">    </span><span class="n">NETADAPTER</span><span class="w">                                          </span><span class="n">Adapter</span><span class="p">,</span>
<span class="w">    </span><span class="n">_Inout_</span><span class="w"> </span><span class="n">PNET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</span><span class="w">    </span><span class="n">IndirectionEntries</span>
<span class="p">)</span>
<span class="p">{</span>

<span class="w">    </span><span class="c1">// Get the adapter&#39;s context to retrieve the address of the hardware indirection table</span>
<span class="w">    </span><span class="n">PMY_NET_ADAPTER_CONTEXT</span><span class="w"> </span><span class="n">adapterContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMyAdapterContext</span><span class="p">(</span><span class="n">Adapter</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Assign each indirection table entry to the specified receive queue</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt"><a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a></span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">IndirectionEntries</span><span class="o">-&gt;</span><span class="n">Count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Get the queue ID from its context</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n"><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></span><span class="w"> </span><span class="n">queueId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMyRxQueueContext</span><span class="p">(</span><span class="n">IndirectionEntries</span><span class="o">-&gt;</span><span class="n">Entries</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Queue</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">QueueId</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Get the hash index for this entry</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n"><a href="uint32" title="typedef unsigned int UINT32;">UINT32</a></span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IndirectionEntries</span><span class="o">-&gt;</span><span class="n">Entries</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Index</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Assign the new queue ID for this index in the indirection table and record success</span>
<span class="w">        </span><span class="n">IndirectionEntries</span><span class="o">-&gt;</span><span class="n">Entries</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MySetIndirectionTableEntry</span><span class="p">(</span><span class="n">adapterContext</span><span class="o">-&gt;</span><span class="n">HardwareInfo</span><span class="o">-&gt;</span><span class="n">RssIndirectionTable</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
<span class="w">    </span><span class="n">queueId</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n"><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><strong><a href="net_adapter_receive_scaling_indirection_entries" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES {&#10;  NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY *Entries;&#10;  SIZE_T                                        Length;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRIES</a></strong></p>

<p><strong><a href="net_adapter_receive_scaling_indirection_entry" title="typedef struct _NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY {&#10;  NETPACKETQUEUE PacketQueue;&#10;  NTSTATUS       Status;&#10;  UINT32         Index;&#10;} NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY;">NET_ADAPTER_RECEIVE_SCALING_INDIRECTION_ENTRY</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/netcx/netadaptercx-receive-side-scaling-rss-">NetAdapterCx Receive Side Scaling</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/netreceivescaling/nc-netreceivescaling-evt_net_adapter_receive_scaling_set_indirection_entries">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/netreceivescaling/nc-netreceivescaling-evt_net_adapter_receive_scaling_set_indirection_entries.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
