<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="D3DHAL_DP2DRAWTRIPATCH - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>D3DHAL_DP2DRAWTRIPATCH - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            D3DHAL_DP2DRAWTRIPATCH - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dhal.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _D3DHAL_DP2DRAWTRIPATCH {
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> Handle;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> Flags;
} D3DHAL_DP2DRAWTRIPATCH;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/ns-d3dhal-_d3dhal_dp2drawtripatch">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/d3dhal_dp2drawtripatch.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dhal-_d3dhal_dp2drawtripatch)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_d3dhal_dp2drawtripatch-structure">_D3DHAL_DP2DRAWTRIPATCH structure</h1>

<h2 id="description">Description</h2>

<p>DirectX 8.0 and later versions only.</p>

<p>D3DHAL_DRAWTRIPATCH is parsed from the command buffer by the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb">D3dDrawPrimitives2</a> callback when the <a href="lpd3dhal_dp2command" title="typedef struct _D3DHAL_DP2COMMAND {&#10;  BYTE  bCommand;&#10;  BYTE  bReserved;&#10;  union {&#10;    WORD wPrimitiveCount;&#10;    WORD wStateCount;&#10;  };&#10;} D3DHAL_DP2COMMAND, *LPD3DHAL_DP2COMMAND;">D3DHAL_DP2COMMAND</a> structure's <strong>bCommand</strong> member is set to D3DDP2OP_DRAWTRIPATCH, and is used to render a triangular patch.</p>

<h2 id="members">Members</h2>

<h3 id="handle"><code>Handle</code></h3>

<p>Specifies the handle associated with the surface.</p>

<h3 id="flags"><code>Flags</code></h3>

<p>Specifies what, if any, additional information follows the D3DHAL_DP2DRAWTRIPATCH data structure in the DP2 stream.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>Handle</strong> member is used to associate the surface with a handle, so that the next time this surface is drawn there is no need to respecify the D3DTRIPATCH_INFO data structure for this patch. This makes it possible for the driver to precompute and cache forward difference coefficients and/or any other information, which in turn allows subsequent D3DDP2OP_DRAWTRIPATCH tokens using the same handle to execute more efficiently. D3DTRIPATCH_INFO is described in the latest DirectX SDK documentation.</p>

<p>The actual value of <strong>Handle</strong> is determined by the application and is not under runtime control. Therefore, the driver should be prepared to cope with any value specifiable by a <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>. The special handle value of zero means that the patch is dynamic and there is no point precomputing or caching information for this patch. A subzero value for <strong>Handle</strong> means the patch is static (or updated with low frequency) and precomputation and caching are possible.</p>

<p>The <strong>Flags</strong> member is used to communicate what, if any, additional information follows the D3DHAL_DP2DRAWTRIPATCH data structure in the DP2 stream. If RTPATCHFLAG_HASSEGS is specified then three floating-point values follow D3DHAL_DP2DRAWTRIPATCH in the DP2 stream. These floats give the segment counts for each of the three edges of the triangular patch and override the value of the render state D3DRS_PATCHSEGMENTS. If RTPATCHFLAG_HASINFO is specified then a D3DTRIPATCH_INFO data structure follows in the DP2 stream. If both flags are specified the three floats specifying segment counts follow D3DHAL_DP2DRAWTRIPATCH and the D3DTRIPATCH_INFO structure follows the floating-point values.</p>

<p>There are four scenarios a driver must handle when processing D3DDP2OP_DRAWTRIPATCH.</p>

<p>If <strong>Handle</strong> is zero, then the patch is dynamic and no precomputation or caching should be performed. In this case, a D3DTRIPATCH_INFO follows D3DHAL_DP2DRAWTRIPATCH in the DP2 stream (and the flag RTPATCHFLAG_HASINFO is set to indicate the presence of the D3DTRIPATCH_INFO data structure). Optionally, RTPATCHFLAG_HASSEGS may also be set to indicate the presence of the segment information. However, if this is omitted, the value of the render state D3DRS_PATCHSEGMENTS should be used instead.</p>

<p>If <strong>Handle</strong> is subzero and the handle value has not been specified by an earlier D3DDP2OP_DRAWTRIPATCH, this indicates that a new cacheable patch is being drawn. The driver should allocate memory to store cached data and add this data to its patch handle table. Because this patch has not been seen before, the RTPATCHFLAG_HASINFO flag should be set and a D3DTRIPATCH_INFO structure should follow in the DP2 stream. The runtime does not guarantee this, however, and the driver should verify the presence of the patch information by testing the flag. If no information is specified, this token should be ignored and no handle should be allocated in the driver's patch handle table. Optionally, RTPATCHFLAG_HASSEGS may also be set to indicate the presence of the segment information. However, if this is omitted, the value of the render state D3DRS_PATCHSEGMENTS should be used instead.</p>

<p>If <strong>Handle</strong> is subzero, the handle value has been specified by an earlier D3DDP2OP_DRAWTRIPATCH token, and the <strong>Flags</strong> field contains RTPATCHFLAG_HASINFO, then the definition for the patch is being updated. A D3DTRIPATCH_INFO data structure follows in the DP2 stream and the driver should use that to recompute and recache patch information. Optionally, RTPATCHFLAG_HASSEGS may also be set to indicate the presence of the segment information. However, if this is omitted, the value of the render state D3DRS_PATCHSEGMENTS should be used instead.</p>

<p>If <strong>Handle</strong> is subzero, the handle value has been specified by an earlier D3DDP2OP_DRAWTRIPATCH token, and the <strong>Flags</strong> field does not contain RTPATCHFLAG_HASINFO, then the cached information should be used for drawing the patch. In this case, the current vertex streams are ignored; the cached information should be used instead. However, it is still possible in this case for a new segment information to be specified. Therefore, the driver should check for the flag RTPATCHFLAG_HASSEGS and handle specified segment information even if using a cached patch.</p>

<p>The driver receives notification that cached patch information is be released via the render state D3DRS_DELETERTPATCH. The value of this render state is the patch to be deleted.</p>

<h2 id="see-also">See also</h2>

<p>D3DDP2OP_DRAWTRIPATCH</p>

<p><a href="lpd3dhal_dp2command" title="typedef struct _D3DHAL_DP2COMMAND {&#10;  BYTE  bCommand;&#10;  BYTE  bReserved;&#10;  union {&#10;    WORD wPrimitiveCount;&#10;    WORD wStateCount;&#10;  };&#10;} D3DHAL_DP2COMMAND, *LPD3DHAL_DP2COMMAND;">D3DHAL_DP2COMMAND</a></p>

<p><a href="d3dhal_dp2drawrectpatch" title="typedef struct _D3DHAL_DP2DRAWRECTPATCH {&#10;  DWORD Handle;&#10;  DWORD Flags;&#10;} D3DHAL_DP2DRAWRECTPATCH;">D3DHAL_DP2DRAWRECTPATCH</a></p>

<p>D3DRS_DELETERTPATCH</p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/nc-d3dhal-lpd3dhal_drawprimitives2cb">D3dDrawPrimitives2</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dhal/ns-d3dhal-_d3dhal_dp2drawtripatch">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dhal/ns-d3dhal-_d3dhal_dp2drawtripatch.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
