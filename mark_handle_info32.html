<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="MARK_HANDLE_INFO32 - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MARK_HANDLE_INFO32 - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            MARK_HANDLE_INFO32 - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _MARK_HANDLE_INFO32 {
  union {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> UsnSourceInfo;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> CopyNumber;
  } DUMMYUNIONNAME;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  UsnSourceInfo;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> VolumeHandle;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>  HandleInfo;
} MARK_HANDLE_INFO32, *PMARK_HANDLE_INFO32;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-mark_handle_info32">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _MARK_HANDLE_INFO32 {
  union {
    <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> UsnSourceInfo;
    <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> CopyNumber;
  } DUMMYUNIONNAME;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>  UsnSourceInfo;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> VolumeHandle;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>  HandleInfo;
} MARK_HANDLE_INFO32, *PMARK_HANDLE_INFO32;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-mark_handle_info32">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/mark_handle_info32.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntifs-mark_handle_info32)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>Version of <strong><a href="mark_handle_info" title="typedef struct _MARK_HANDLE_INFO {&#10;  union {&#10;    ULONG UsnSourceInfo;&#10;    ULONG CopyNumber;&#10;  } DUMMYUNIONNAME;&#10;  ULONG  UsnSourceInfo;&#10;  HANDLE VolumeHandle;&#10;  ULONG  HandleInfo;&#10;} MARK_HANDLE_INFO, *PMARK_HANDLE_INFO;">MARK_HANDLE_INFO</a></strong> structure used for <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/why-thunking-is-necessary">thunking</a>. See <strong><a href="mark_handle_info" title="typedef struct _MARK_HANDLE_INFO {&#10;  union {&#10;    ULONG UsnSourceInfo;&#10;    ULONG CopyNumber;&#10;  } DUMMYUNIONNAME;&#10;  ULONG  UsnSourceInfo;&#10;  HANDLE VolumeHandle;&#10;  ULONG  HandleInfo;&#10;} MARK_HANDLE_INFO, *PMARK_HANDLE_INFO;">MARK_HANDLE_INFO</a></strong> for member descriptions and details.</p>

<h2 id="members">Members</h2>

<h3 id="dummyunionname"><code>DUMMYUNIONNAME</code></h3>

<h3 id="dummyunionnameusnsourceinfo"><code>DUMMYUNIONNAME.UsnSourceInfo</code></h3>

<h3 id="dummyunionnamecopynumber"><code>DUMMYUNIONNAME.CopyNumber</code></h3>

<h3 id="usnsourceinfo"><code>UsnSourceInfo</code></h3>

<h3 id="volumehandle"><code>VolumeHandle</code></h3>

<h3 id="handleinfo"><code>HandleInfo</code></h3>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-mark_handle_info32">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/ns-ntifs-mark_handle_info32.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (ns-winioctl-mark_handle_info32)</h1>
</div>
<div class="ntdoc-description">
<h1>MARK_HANDLE_INFO32 structure</h1>

<h2>Description</h2>

<p>Contains information that is used to mark a specified file or directory, and its update sequence number (USN) change journal record with data about changes. This is only defined for 64-bit code and exists to interpret <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-mark_handle_info">MARK_HANDLE_INFO structures</a> sent by 32-bit code. It is used by the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ni-winioctl-fsctl_mark_handle">FSCTL_MARK_HANDLE IOCTL</a> control code.</p>

<h2>Members</h2>

<h3><code>DUMMYUNIONNAME</code></h3>

<h3><code>UsnSourceInfo</code></h3>

<p>The type of changes being made.</p>

<p>The operation does not modify the file or directory externally from the point of view of the application that created it.</p>

<p>When a thread writes a new USN record, the source information flags in the prior record continues to be present only if the thread also sets those flags. Therefore, the source information structure allows applications to filter out USN records that are set only by a known source, such as an antivirus filter.</p>

<p>The following values are defined.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>USN_SOURCE_DATA_MANAGEMENT</strong>&lt;br&gt;&lt;br&gt;0x00000001</td>
  <td>The operation provides information about a change to the file or directory made by the operating system.&lt;br&gt;&lt;br&gt;A typical use is when Remote Storage moves data from external to local storage. Remote Storage is the hierarchical storage management software. Such a move usually at a minimum adds the <strong>USN_REASON_DATA_OVERWRITE</strong> flag to a USN record. However, the data has not changed from the user point of view. By noting <strong>USN_SOURCE_DATA_MANAGEMENT</strong> in the <strong>SourceInfo</strong> member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/winioctl/ns-winioctl-usn_record_v2">USN_RECORD</a> structure that holds the record, you can determine that although a write operation is performed on the item, data has not changed.</td>
</tr>
<tr>
  <td><strong>USN_SOURCE_AUXILIARY_DATA</strong>&lt;br&gt;&lt;br&gt;0x00000002</td>
  <td>The operation adds a private data stream to a file or directory.&lt;br&gt;&lt;br&gt;An example might be a virus detector adding checksum information. As the virus detector modifies the item, the system generates USN records. <strong>USN_SOURCE_AUXILIARY_DATA</strong> indicates that the modifications did not change the application data.</td>
</tr>
<tr>
  <td><strong>USN_SOURCE_REPLICATION_MANAGEMENT</strong>&lt;br&gt;&lt;br&gt;0x00000004</td>
  <td>The operation creates or updates the contents of a replicated file.&lt;br&gt;&lt;br&gt;For example, the file replication service sets this flag when it creates or updates a file in a replicated directory.</td>
</tr>
</tbody>
</table>

<h3><code>CopyNumber</code></h3>

<h3><code>VolumeHandle</code></h3>

<p>The volume handle to the volume where the file or directory resides. For more information on obtaining a
volume handle, see the Remarks section.</p>

<p>This handle is required to check the privileges for this operation.</p>

<p>The caller must have the <strong>SE_MANAGE_VOLUME_NAME</strong> privilege. For more information,
see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/SecAuthZ/privileges">Privileges</a>.</p>

<h3><code>HandleInfo</code></h3>

<p>The flag that specifies additional information about the file or directory identified by the handle value
in the <strong>VolumeHandle</strong> member.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>MARK_HANDLE_PROTECT_CLUSTERS</strong>&lt;br&gt;&lt;br&gt;0x00000001</td>
  <td>The file is marked as unable to be defragmented until the handle is closed.</td>
</tr>
<tr>
  <td><strong>MARK_HANDLE_TXF_SYSTEM_LOG</strong>&lt;br&gt;&lt;br&gt;0x00000004</td>
  <td>The file is marked as unable to be defragmented until the handle is closed.</td>
</tr>
<tr>
  <td><strong>MARK_HANDLE_NOT_TXF_SYSTEM_LOG</strong>&lt;br&gt;&lt;br&gt;0x00000008</td>
  <td>The file is marked as unable to be defragmented until the handle is closed.</td>
</tr>
<tr>
  <td><strong>MARK_HANDLE_REALTIME</strong>&lt;br&gt;&lt;br&gt;0x00000020</td>
  <td>The file is marked for real-time read behavior regardless of the actual file type. Files marked with this flag must be opened for <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/FileIO/file-buffering">unbuffered I/O</a>.</td>
</tr>
<tr>
  <td><strong>MARK_HANDLE_NOT_REALTIME</strong>&lt;br&gt;&lt;br&gt;0x00000040</td>
  <td>The file previously marked for real-time read behavior using the <strong>MARK_HANDLE_REALTIME</strong> flag can be unmarked using this flag, removing the real-time behavior. Files marked with this flag must be opened for <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/FileIO/file-buffering">unbuffered I/O</a>.</td>
</tr>
</tbody>
</table>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-mark_handle_info32">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winioctl/ns-winioctl-mark_handle_info32.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
