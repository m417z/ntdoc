<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="CcInitializeCacheMap - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>CcInitializeCacheMap - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            CcInitializeCacheMap - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID CcInitializeCacheMap(
  [in] <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a>             FileObject,
  [in] <a href="cc_file_sizes" title="typedef struct _CC_FILE_SIZES {&#10;  LARGE_INTEGER AllocationSize;&#10;  LARGE_INTEGER FileSize;&#10;  LARGE_INTEGER ValidDataLength;&#10;} CC_FILE_SIZES, *PCC_FILE_SIZES;">PCC_FILE_SIZES</a>           FileSizes,
  [in] BOOLEAN                  PinAccess,
  [in] PCACHE_MANAGER_CALLBACKS Callbacks,
  [in] PVOID                    LazyWriteContext
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ccinitializecachemap">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ccinitializecachemap.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-ccinitializecachemap)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ccinitializecachemap-function">CcInitializeCacheMap function</h1>

<h2 id="description">Description</h2>

<p>File systems call the <strong>CcInitializeCacheMap</strong> routine to cache a file.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="fileobject-in"><code>FileObject</code> [in]</h3>

<p>Pointer to a file object for the file.</p>

<h3 id="filesizes-in"><code>FileSizes</code> [in]</h3>

<p>Pointer to a <a href="cc_file_sizes" title="typedef struct _CC_FILE_SIZES {&#10;  LARGE_INTEGER AllocationSize;&#10;  LARGE_INTEGER FileSize;&#10;  LARGE_INTEGER ValidDataLength;&#10;} CC_FILE_SIZES, *PCC_FILE_SIZES;">CC_FILE_SIZES</a> structure containing <strong>AllocationSize</strong>, <strong>FileSize</strong>, and <strong>ValidDataLength</strong> for the file. This structure is defined as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>typedef <a href="cc_file_sizes" title="typedef struct _CC_FILE_SIZES {&#10;  LARGE_INTEGER AllocationSize;&#10;  LARGE_INTEGER FileSize;&#10;  LARGE_INTEGER ValidDataLength;&#10;} CC_FILE_SIZES, *PCC_FILE_SIZES;">struct _CC_FILE_SIZES</a> {
    LARGE_INTEGER AllocationSize;
    LARGE_INTEGER FileSize;
    LARGE_INTEGER ValidDataLength;
} <a href="cc_file_sizes" title="typedef struct _CC_FILE_SIZES {&#10;  LARGE_INTEGER AllocationSize;&#10;  LARGE_INTEGER FileSize;&#10;  LARGE_INTEGER ValidDataLength;&#10;} CC_FILE_SIZES, *PCC_FILE_SIZES;">CC_FILE_SIZES</a>, *<a href="cc_file_sizes" title="typedef struct _CC_FILE_SIZES {&#10;  LARGE_INTEGER AllocationSize;&#10;  LARGE_INTEGER FileSize;&#10;  LARGE_INTEGER ValidDataLength;&#10;} CC_FILE_SIZES, *PCC_FILE_SIZES;">PCC_FILE_SIZES</a>;
</code></pre>

<table>
<thead>
<tr>
  <th>Member</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>AllocationSize</strong></td>
  <td>New section object size for the file. Ignored if less than or equal to the current section size.</td>
</tr>
<tr>
  <td><strong>FileSize</strong></td>
  <td>New file size for the file.</td>
</tr>
<tr>
  <td><strong>ValidDataLength</strong></td>
  <td>New valid data length for the file.</td>
</tr>
</tbody>
</table>

<h3 id="pinaccess-in"><code>PinAccess</code> [in]</h3>

<p>Set to <strong>TRUE</strong> if <strong>CcPin</strong><em>Xxx</em> routines will be used on the file.</p>

<h3 id="callbacks-in"><code>Callbacks</code> [in]</h3>

<p>Pointer to a structure allocated from nonpaged pool, containing entry points of caller-supplied read-ahead and write-behind callback routines.This structure and its members are defined as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>typedef struct _CACHE_MANAGER_CALLBACKS {
    PACQUIRE_FOR_LAZY_WRITE AcquireForLazyWrite;
    PRELEASE_FROM_LAZY_WRITE ReleaseFromLazyWrite;
    PACQUIRE_FOR_READ_AHEAD AcquireForReadAhead;
    PRELEASE_FROM_READ_AHEAD ReleaseFromReadAhead;
} CACHE_MANAGER_CALLBACKS, *PCACHE_MANAGER_CALLBACKS;
typedef
BOOLEAN (*PACQUIRE_FOR_LAZY_WRITE) (
             IN PVOID Context,
             IN BOOLEAN Wait
             );
typedef
VOID (*PRELEASE_FROM_LAZY_WRITE) (
             IN PVOID Context
             );
typedef
BOOLEAN (*PACQUIRE_FOR_READ_AHEAD) (
             IN PVOID Context,
             IN BOOLEAN Wait
             );
typedef
VOID (*PRELEASE_FROM_READ_AHEAD) (
             IN PVOID Context
             );
</code></pre>

<h3 id="lazywritecontext-in"><code>LazyWriteContext</code> [in]</h3>

<p>Pointer to context information to be passed to the callback routines specified in <em>Callbacks</em>.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>CcInitializeCacheMap</strong> creates the data structures required for file data caching.</p>

<p>If any failure occurs, <strong>CcInitializeCacheMap</strong> raises a status exception for that particular failure. For example, if a pool allocation failure occurs, <strong>CcInitializeCacheMap</strong> raises a STATUS_INSUFFICIENT_RESOURCES exception. Therefore, to gain control if a failure occurs, the driver should wrap the call to <strong>CcInitializeCacheMap</strong> in a <strong>try-except</strong> or <strong>try-finally</strong> statement.</p>

<p>File systems must call <strong>CcInitializeCacheMap</strong> to cache a file before using any other cache manager routines on the file, unless the file was created with data caching disabled. In most file systems, file caching is enabled by default, but can be disabled by setting the <a href="file_no_intermediate_buffering" title="#define FILE_NO_INTERMEDIATE_BUFFERING 0x00000008">FILE_NO_INTERMEDIATE_BUFFERING</a> flag to <strong>TRUE</strong> in the file create options.</p>

<p>After calling <strong>CcInitializeCacheMap</strong>, the file system can call <a href="ccsetadditionalcacheattributes" title="VOID CcSetAdditionalCacheAttributes(&#10;  [in] PFILE_OBJECT FileObject,&#10;  [in] BOOLEAN      DisableReadAhead,&#10;  [in] BOOLEAN      DisableWriteBehind&#10;);">CcSetAdditionalCacheAttributes</a> to disable read-ahead or write-behind, if desired.</p>

<p>When closing a file, every file system that supports file caching must call <a href="ccuninitializecachemap" title="BOOLEAN CcUninitializeCacheMap(&#10;  [in]           PFILE_OBJECT              FileObject,&#10;  [in, optional] PLARGE_INTEGER            TruncateSize,&#10;                 PCACHE_UNINITIALIZE_EVENT UninitializeEvent&#10;);">CcUninitializeCacheMap</a> on that file, whether the file is cached or not. Even if the file was created with caching disabled, the file system still must call <strong><a href="ccuninitializecachemap" title="BOOLEAN CcUninitializeCacheMap(&#10;  [in]           PFILE_OBJECT              FileObject,&#10;  [in, optional] PLARGE_INTEGER            TruncateSize,&#10;                 PCACHE_UNINITIALIZE_EVENT UninitializeEvent&#10;);">CcUninitializeCacheMap</a></strong>.</p>

<p>The <strong>CcIsFileCached</strong> macro determines whether a file is cached or not.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOLEAN</span><span class="w"> </span><span class="nf">CcIsFileCached</span><span class="p">(</span>
<span class="w">  </span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="n"><a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a></span><span class="w"> </span><span class="n">FileObject</span>
<span class="p">);</span>
</code></pre>
</div>

<p>Parameters</p>

<p><em>FileObject[in]</em> [in]</p>

<p>Pointer to a file object for the file.</p>

<p>Return value</p>

<p>Returns <strong>TRUE</strong> if the file is cached, <strong>FALSE</strong> otherwise.</p>

<p><strong>Note</strong> Because multiple file objects can refer to the same file (that is, data stream), it is possible for the <strong>CcIsFileCached</strong> macro to return <strong>TRUE</strong> given a non-cached file object if another cached file object refers to the same data stream. In other words, if there is a set of file objects that refer to the same data stream and if at least one of the file objects in the set is cached, <strong>CcIsFileCached</strong> will return <strong>TRUE</strong> for all file objects in the set.</p>

<h2 id="see-also">See also</h2>

<p><a href="ccsetadditionalcacheattributes" title="VOID CcSetAdditionalCacheAttributes(&#10;  [in] PFILE_OBJECT FileObject,&#10;  [in] BOOLEAN      DisableReadAhead,&#10;  [in] BOOLEAN      DisableWriteBehind&#10;);">CcSetAdditionalCacheAttributes</a></p>

<p><a href="ccuninitializecachemap" title="BOOLEAN CcUninitializeCacheMap(&#10;  [in]           PFILE_OBJECT              FileObject,&#10;  [in, optional] PLARGE_INTEGER            TruncateSize,&#10;                 PCACHE_UNINITIALIZE_EVENT UninitializeEvent&#10;);">CcUninitializeCacheMap</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ccinitializecachemap">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-ccinitializecachemap.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
