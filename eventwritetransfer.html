<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="EventWriteTransfer - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EventWriteTransfer - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            EventWriteTransfer - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// evntprov.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> EVNTAPI EventWriteTransfer(
  [in]           <a href="reghandle" title="typedef ULONGLONG REGHANDLE, *PREGHANDLE;">REGHANDLE</a>              RegHandle,
  [in]           <a href="pcevent_descriptor" title="typedef const EVENT_DESCRIPTOR* PCEVENT_DESCRIPTOR;">PCEVENT_DESCRIPTOR</a>     EventDescriptor,
  [in, optional] LPCGUID                ActivityId,
  [in, optional] LPCGUID                RelatedActivityId,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                  UserDataCount,
  [in, optional] <a href="event_data_descriptor" title="typedef struct _EVENT_DATA_DESCRIPTOR EVENT_DATA_DESCRIPTOR, *PEVENT_DATA_DESCRIPTOR;">PEVENT_DATA_DESCRIPTOR</a> UserData
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwritetransfer">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/eventwritetransfer.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (nf-evntprov-eventwritetransfer)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="eventwritetransfer-function">EventWriteTransfer function</h1>

<h2 id="description">Description</h2>

<p>Writes an ETW event with an activity ID and an optional related activity ID.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="reghandle-in"><code>RegHandle</code> [in]</h3>

<p>Registration handle of the provider. The handle comes from
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventregister">EventRegister</a>. The
generated event will use the ProviderId associated with the handle.</p>

<h3 id="eventdescriptor-in"><code>EventDescriptor</code> [in]</h3>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/ns-evntprov-event_descriptor">EVENT_DESCRIPTOR</a>
with event information (metadata) including ID, Version, Level, Keyword,
Channel, Opcode, and Task.</p>

<blockquote>
  <p>[!Important]
  ProviderId, Level and Keyword are the primary means for
  filtering events. Other kinds of filtering are possible but have much higher
  overhead. Always assign a nonzero level and keyword to every event.</p>
</blockquote>

<h3 id="activityid-in-optional"><code>ActivityId</code> [in, optional]</h3>

<p>An optional pointer to a 128-bit activity ID for this event. If this is
non-NULL, <strong>EventWriteTransfer</strong> will use the specified value for the event's
activity ID. If this is NULL, <strong>EventWriteTransfer</strong> will use the current
thread's activity ID.</p>

<p><a href="trace" title="VOID Trace(&#10;  LPCTSTR Format,&#10;  ...     &#10;);">Trace</a> processing tools can use the event's activity ID to organize events into
groups called activities. For additional information about the activity ID, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventactivityidcontrol">EventActivityIdControl</a>.</p>

<h3 id="relatedactivityid-in-optional"><code>RelatedActivityId</code> [in, optional]</h3>

<p>An optional pointer to a 128-bit activity ID that is the parent of this event's
activity. If this is non-NULL, <strong>EventWriteTransfer</strong> will use the specified
value for the event's related activity ID. If this is NULL, the event will not
have a related activity ID. The related activity ID is usually set on the
activity's START event (the first event of the activity, logged with Opcode =
START).</p>

<p><a href="trace" title="VOID Trace(&#10;  LPCTSTR Format,&#10;  ...     &#10;);">Trace</a> processing tools can use the event's related activity ID to determine the
relationship between activities, e.g. the related activity is the parent of the
newly-started activity. For additional information about the related activity
ID, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventactivityidcontrol">EventActivityIdControl</a>.</p>

<h3 id="userdatacount-in"><code>UserDataCount</code> [in]</h3>

<p>Number of
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/ns-evntprov-event_data_descriptor">EVENT_DATA_DESCRIPTOR</a>
structures in _UserData_. The maximum number is 128.</p>

<h3 id="userdata-in-optional"><code>UserData</code> [in, optional]</h3>

<p>An array of _UserDataCount_
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/ns-evntprov-event_data_descriptor">EVENT_DATA_DESCRIPTOR</a>
structures that describe the data to be included in the event. _UserData_ may be
<strong>NULL</strong> if _UserDataCount_ is zero.</p>

<p>Each <strong><a href="event_data_descriptor" title="typedef struct _EVENT_DATA_DESCRIPTOR EVENT_DATA_DESCRIPTOR, *PEVENT_DATA_DESCRIPTOR;">EVENT_DATA_DESCRIPTOR</a></strong> describes one block of memory to be included in
the event. The specified blocks will be concatenated in order with no padding or
alignment to form the event content. If using manifest-based decoding, the event
content must match the layout specified in the template associated with the
event in the manifest.</p>

<h2 id="return-value">Return value</h2>

<p>Returns <strong>ERROR_SUCCESS</strong> if successful or an error code. Possible error codes
include the following:</p>

<ul>
<li><strong>ERROR_INVALID_PARAMETER</strong>: One or more of the parameters is not valid.</li>
<li><strong>ERROR_INVALID_HANDLE</strong>: The registration handle of the provider is not
valid.</li>
<li><strong>ERROR_ARITHMETIC_OVERFLOW</strong>: The event size is larger than the allowed
maximum (64KB - header).</li>
<li><strong>ERROR_MORE_DATA</strong>: The session buffer size is too small for the event.</li>
<li><strong>ERROR_NOT_ENOUGH_MEMORY</strong>: Occurs when filled buffers are trying to flush to
disk, but disk IOs are not happening fast enough. This happens when the disk
is slow and event traffic is heavy. Eventually, there are no more free (empty)
buffers and the event is dropped.</li>
<li><strong>STATUS_LOG_FILE_FULL</strong>: The real-time playback file is full. Events are not
logged to the session until a real-time consumer consumes the events from the
playback file.</li>
</ul>

<p>The error code is primarily intended for use in debugging and diagnostic
scenarios. Most production code should continue to run and continue to report
events even if an ETW event could not be written, so release builds should
usually ignore the error code.</p>

<h2 id="remarks">Remarks</h2>

<p>Most event providers will not call <strong>EventWriteTransfer</strong> directly. Instead,
most event providers are implemented using an ETW framework that wraps the calls
to <strong>EventRegister</strong>, <strong>EventWriteTransfer</strong>, and <strong>EventUnregister</strong>. For
example, you might
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/etw/writing-manifest-based-events">write an event manifest</a> and
then use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/wes/message-compiler--mc-exe-">Message Compiler</a> to
generate C/C++ code for the events, or you might use
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/tracelogging/trace-logging-portal">TraceLogging</a> to avoid the
need for a manifest.</p>

<p><strong>EventWriteTransfer</strong> will route the event to the appropriate trace sessions
based on the ProviderId (determined from the _RegHandle_), Level, Keyword, and
other event characteristics. If no trace sessions are recording this event, this
function will do nothing and return <strong>ERROR_SUCCESS</strong>.</p>

<p>To reduce the performance impact of events that are not recorded by any trace
session, you can call
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventenabled">EventEnabled</a> to
determine whether any trace session is recording your event before preparing the
data and calling <strong>EventWriteTransfer</strong>.</p>

<p><strong>EventWriteTransfer</strong> is equivalent to
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwriteex">EventWriteEx</a> with 0 for
_Filter_ and 0 for _Flags_.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventactivityidcontrol">EventActivityIdControl</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventregister">EventRegister</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/evntprov/nf-evntprov-eventwrite">EventWrite</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwriteex">EventWriteEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/ETW/writing-manifest-based-events">Writing Manifest-based Events</a>.</p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/evntprov/nf-evntprov-eventwritetransfer">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/evntprov/nf-evntprov-eventwritetransfer.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
