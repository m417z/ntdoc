<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IoEnumerateDeviceObjectList - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IoEnumerateDeviceObjectList - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IoEnumerateDeviceObjectList - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> IoEnumerateDeviceObjectList(
  [in]  <a href="driver_object" title="typedef struct _DRIVER_OBJECT {&#10;  CSHORT             Type;&#10;  CSHORT             Size;&#10;  PDEVICE_OBJECT     DeviceObject;&#10;  ULONG              Flags;&#10;  PVOID              DriverStart;&#10;  ULONG              DriverSize;&#10;  PVOID              DriverSection;&#10;  PDRIVER_EXTENSION  DriverExtension;&#10;  UNICODE_STRING     DriverName;&#10;  PUNICODE_STRING    HardwareDatabase;&#10;  PFAST_IO_DISPATCH  FastIoDispatch;&#10;  PDRIVER_INITIALIZE DriverInit;&#10;  PDRIVER_STARTIO    DriverStartIo;&#10;  PDRIVER_UNLOAD     DriverUnload;&#10;  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + 1];&#10;} DRIVER_OBJECT, *PDRIVER_OBJECT;">PDRIVER_OBJECT</a> DriverObject,
  [out] <a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a> *DeviceObjectList,
  [in]  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>          DeviceObjectListSize,
  [out] PULONG         ActualNumberDeviceObjects
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ioenumeratedeviceobjectlist">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioenumeratedeviceobjectlist.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-ioenumeratedeviceobjectlist)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioenumeratedeviceobjectlist-function">IoEnumerateDeviceObjectList function</h1>

<h2 id="description">Description</h2>

<p>The <strong>IoEnumerateDeviceObjectList</strong> routine enumerates a driver's device object list.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="driverobject-in"><code>DriverObject</code> [in]</h3>

<p>A pointer to the driver object for the driver.</p>

<h3 id="deviceobjectlist-out"><code>DeviceObjectList</code> [out]</h3>

<p>A pointer to a caller-allocated array that receives the device object pointers. This array must be allocated from nonpaged pool. This parameter can be NULL. See Remarks.</p>

<h3 id="deviceobjectlistsize-in"><code>DeviceObjectListSize</code> [in]</h3>

<p>Size, in bytes, of the <strong>DeviceObjectList</strong> array. This parameter can be zero. See Remarks.</p>

<h3 id="actualnumberdeviceobjects-out"><code>ActualNumberDeviceObjects</code> [out]</h3>

<p>Actual number of device objects found in the driver object's device object list. Note that if the array at <strong>DeviceObjectList</strong> is too small, the number of device object pointers that are copied into the array will be less than <strong>ActualNumberDeviceObjects</strong>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>IoEnumerateDeviceObjectList</strong> returns an <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> code such as one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></td>
  <td>The call to <strong>IoEnumerateDeviceObjectList</strong> completed successfully.</td>
</tr>
<tr>
  <td>STATUS_BUFFER_TOO_SMALL</td>
  <td>The array at <strong>DeviceObjectList</strong> is too small to hold the entire device object list. In this case, <strong>IoEnumerateDeviceObjectList</strong> copies as many device object pointers into the array as possible.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A file system filter driver calls <strong>IoEnumerateDeviceObjectList</strong> to enumerate:</p>

<ul>
<li><p>The device objects it has created. This is commonly done when the driver is preparing to unload. Note that a filter driver cannot safely be unloaded from a running system. For more information, see <strong><a href="ntunloaddriver" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnloadDriver(&#10;    _In_ PCUNICODE_STRING DriverServiceName&#10;    );">ZwUnloadDriver</a></strong>.</p></li>
<li><p>The device objects created by the base file system, so the filter knows the number of volumes to which it can attach.</p></li>
</ul>

<p><strong>IoEnumerateDeviceObjectList</strong> returns all device objects created by the filter driver. This includes control device objects (CDOs) as well as volume device objects (VDOs). The two types of device objects can be distinguished by the fact that, by convention, CDOs are named and VDOs are not.</p>

<p>In the latter case, the filter driver typically calls <strong>IoEnumerateDeviceObjectList</strong> twice: once to get the number of device objects in the list, and once to get the device object list itself. In the first call, the caller should set the <strong>DeviceObjectList</strong> parameter to NULL and <strong>DeviceObjectListSize</strong> to zero. In the second call, <strong>DeviceObjectList</strong> should contain a pointer to an appropriately-sized pointer array, and <strong>DeviceObjectListSize</strong> should contain the size, in bytes, of that array.</p>

<p><strong>IoEnumerateDeviceObjectList</strong> increments the reference count on every device object in the list pointed to by <strong>DeviceObjectList</strong>. Thus every successful call to <strong>IoEnumerateDeviceObjectList</strong> must be matched by a subsequent call to <strong><a href="obdereferenceobject" title="void ObDereferenceObject(&#10;  [in] a&#10;);">ObDereferenceObject</a></strong> for each device object in the list. Failure to do so prevents the system from freeing or deleting these device objects because of an outstanding reference count.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="exallocatepool2" title="DECLSPEC_RESTRICT PVOID ExAllocatePool2(&#10;  POOL_FLAGS Flags,&#10;  SIZE_T     NumberOfBytes,&#10;  ULONG      Tag&#10;);">ExAllocatePool2</a></strong></p>

<p><strong><a href="exallocatepool3" title="DECLSPEC_RESTRICT PVOID ExAllocatePool3(&#10;  POOL_FLAGS                Flags,&#10;  SIZE_T                    NumberOfBytes,&#10;  ULONG                     Tag,&#10;  PCPOOL_EXTENDED_PARAMETER ExtendedParameters,&#10;  ULONG                     ExtendedParametersCount&#10;);">ExAllocatePool3</a></strong></p>

<p><strong><a href="iogetattacheddevice" title="PDEVICE_OBJECT IoGetAttachedDevice(&#10;  [in] PDEVICE_OBJECT DeviceObject&#10;);">IoGetAttachedDevice</a></strong></p>

<p><strong><a href="iogetattacheddevicereference" title="PDEVICE_OBJECT IoGetAttachedDeviceReference(&#10;  [in] PDEVICE_OBJECT DeviceObject&#10;);">IoGetAttachedDeviceReference</a></strong></p>

<p><strong><a href="iogetlowerdeviceobject" title="PDEVICE_OBJECT IoGetLowerDeviceObject(&#10;  [in] PDEVICE_OBJECT DeviceObject&#10;);">IoGetLowerDeviceObject</a></strong></p>

<p><strong><a href="obdereferenceobject" title="void ObDereferenceObject(&#10;  [in] a&#10;);">ObDereferenceObject</a></strong></p>

<p><strong><a href="ntunloaddriver" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnloadDriver(&#10;    _In_ PCUNICODE_STRING DriverServiceName&#10;    );">ZwUnloadDriver</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ioenumeratedeviceobjectlist">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-ioenumeratedeviceobjectlist.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
