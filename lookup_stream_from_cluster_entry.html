<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="LOOKUP_STREAM_FROM_CLUSTER_ENTRY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>LOOKUP_STREAM_FROM_CLUSTER_ENTRY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            LOOKUP_STREAM_FROM_CLUSTER_ENTRY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// winioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _LOOKUP_STREAM_FROM_CLUSTER_ENTRY {
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>         OffsetToNext;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>         Flags;
  LARGE_INTEGER Reserved;
  LARGE_INTEGER Cluster;
  WCHAR         FileName[1];
} LOOKUP_STREAM_FROM_CLUSTER_ENTRY, *PLOOKUP_STREAM_FROM_CLUSTER_ENTRY;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-lookup_stream_from_cluster_entry">View the official Win32 API reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/lookup_stream_from_cluster_entry.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 API reference (ns-winioctl-lookup_stream_from_cluster_entry)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="lookup_stream_from_cluster_entry-structure">LOOKUP_STREAM_FROM_CLUSTER_ENTRY structure</h1>

<h2 id="description">Description</h2>

<p>Returned from the
<a href="fsctl_lookup_stream_from_cluster" title="// CTL_CODE(0x0009, 0x07f, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_LOOKUP_STREAM_FROM_CLUSTER 0x000901FC">FSCTL_LOOKUP_STREAM_FROM_CLUSTER</a> control
code. Zero or more of these structures follow the
<a href="lookup_stream_from_cluster_output" title="typedef struct _LOOKUP_STREAM_FROM_CLUSTER_OUTPUT {&#10;  DWORD Offset;&#10;  DWORD NumberOfMatches;&#10;  DWORD BufferSizeRequired;&#10;} LOOKUP_STREAM_FROM_CLUSTER_OUTPUT, *PLOOKUP_STREAM_FROM_CLUSTER_OUTPUT;">LOOKUP_STREAM_FROM_CLUSTER_OUTPUT</a>
structure in the output buffer returned.</p>

<h2 id="members">Members</h2>

<h3 id="offsettonext"><code>OffsetToNext</code></h3>

<p>Offset in bytes from the beginning of this structure to the next
<strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY</strong>
structure returned. If there are no more entries, this value is zero.</p>

<h3 id="flags"><code>Flags</code></h3>

<p>Flags describing characteristics about this stream. The value will consist of one or more of these values.
At least one of the <strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_ATTRIBUTE_*</strong> values that fall
within the <strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_ATTRIBUTE_MASK</strong> (0xff000000) will be set;
one or more of the other flag values may be set.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_FLAG_PAGE_FILE</strong><br><br>0x00000001</td>
  <td>The stream is part of the system pagefile.</td>
</tr>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_FLAG_DENY_DEFRAG_SET</strong><br><br>0x00000002</td>
  <td>The stream is locked from defragmentation. The <strong>HandleInfo</strong> member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-mark_handle_info">MARK_HANDLE_INFO structure</a> for this stream has the <strong>MARK_HANDLE_PROTECT_CLUSTERS</strong> flag set.</td>
</tr>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_FLAG_FS_SYSTEM_FILE</strong><br><br>0x00000004</td>
  <td>The stream is part of a file that is internal to the filesystem.</td>
</tr>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_FLAG_TXF_SYSTEM_FILE</strong><br><br>0x00000008</td>
  <td>The stream is part of a file that is internal to TxF.</td>
</tr>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_ATTRIBUTE_DATA</strong><br><br>0x01000000</td>
  <td>The stream is part of a $DATA attribute for the file (data stream).</td>
</tr>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_ATTRIBUTE_INDEX</strong><br><br>0x02000000</td>
  <td>The stream is part of the $INDEX_ALLOCATION attribute for the file.</td>
</tr>
<tr>
  <td><strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_ATTRIBUTE_SYSTEM</strong><br><br>0x03000000</td>
  <td>The stream is part of another attribute for the file.</td>
</tr>
</tbody>
</table>

<h3 id="reserved"><code>Reserved</code></h3>

<p>This value is reserved and is currently zero.</p>

<h3 id="cluster"><code>Cluster</code></h3>

<p>This is the cluster that this entry refers to. It will be one of the clusters passed in the input
structure.</p>

<h3 id="filename"><code>FileName</code></h3>

<p>A <strong>NULL</strong>-terminated Unicode string containing the path of the object relative to
the root of the volume. This string will refer to the attribute or stream represented by the cluster. This
string is not limited by <strong>MAX_PATH</strong> and may be up to 32,768 characters (65,536 bytes) in
length. Not all of the filenames returned can be opened; some are internal to NTFS and always opened
exclusively. The string returned includes the full path including filename, stream name, and attribute type name
in the form
"<em>full</em>*path<em>*to</em>*file<em>*filename.ext</em>:<em>streamname</em>:<em>typename</em>".</p>

<h2 id="remarks">Remarks</h2>

<p>The name in the <strong>FileName</strong> member can be very long and in a format not recognized by
a customer with the stream name and attribute type name following the filename. While it's appropriate to log the
entire filename for diagnostic purposes, if it is to be presented to an end-user it should be reformatted to be
more understandable (for example, remove the attribute type name and if the <strong>Flags</strong>
member has any flag other than <strong>LOOKUP_STREAM_FROM_CLUSTER_ENTRY_ATTRIBUTE_DATA</strong> set then
an appropriate message should be displayed.</p>

<h2 id="see-also">See also</h2>

<p><a href="fsctl_lookup_stream_from_cluster" title="// CTL_CODE(0x0009, 0x07f, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define FSCTL_LOOKUP_STREAM_FROM_CLUSTER 0x000901FC">FSCTL_LOOKUP_STREAM_FROM_CLUSTER</a></p>

<p><a href="lookup_stream_from_cluster_output" title="typedef struct _LOOKUP_STREAM_FROM_CLUSTER_OUTPUT {&#10;  DWORD Offset;&#10;  DWORD NumberOfMatches;&#10;  DWORD BufferSizeRequired;&#10;} LOOKUP_STREAM_FROM_CLUSTER_OUTPUT, *PLOOKUP_STREAM_FROM_CLUSTER_OUTPUT;">LOOKUP_STREAM_FROM_CLUSTER_OUTPUT</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/FileIO/volume-management-structures">Volume Management Structures</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/api/winioctl/ns-winioctl-lookup_stream_from_cluster_entry">View the official Win32 API reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/sdk-api/blob/docs/sdk-api-src/content/winioctl/ns-winioctl-lookup_stream_from_cluster_entry.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
