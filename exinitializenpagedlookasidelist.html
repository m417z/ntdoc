<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="ExInitializeNPagedLookasideList - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ExInitializeNPagedLookasideList - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            ExInitializeNPagedLookasideList - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID ExInitializeNPagedLookasideList(
  [out]          PNPAGED_LOOKASIDE_LIST Lookaside,
  [in, optional] PALLOCATE_FUNCTION     Allocate,
  [in, optional] <a href="pfree_function" title="typedef VOID ( *FreeCallback)(&#10;  _In_ PVOID Buffer&#10;);">PFREE_FUNCTION</a>         Free,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                  Flags,
  [in]           <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a>                 Size,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                  Tag,
  [in]           <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>                 Depth
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exinitializenpagedlookasidelist">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/exinitializenpagedlookasidelist.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-exinitializenpagedlookasidelist)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>ExInitializeNPagedLookasideList</strong> routine initializes a lookaside list for nonpaged entries of the specified size.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="lookaside-out"><code>Lookaside</code> [out]</h3>

<p>A pointer to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">NPAGED_LOOKASIDE_LIST</a> structure to initialize. The caller must use nonpaged system space for the structure. On 64-bit platforms, this structure must be 16-byte aligned.</p>

<h3 id="allocate-in-optional"><code>Allocate</code> [in, optional]</h3>

<p>A pointer to either a caller-supplied function for allocating an entry when the lookaside list is empty, or to <strong>NULL</strong>. If non-<strong>NULL</strong>, the pointer is to a function with the prototype:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">PVOID</span><span class="w"> </span><span class="nf">XxxAllocate</span><span class="p">(</span>
<span class="w">  </span><span class="n">__in</span><span class="w"> </span><span class="n"><a href="pool_type" title="typedef enum _POOL_TYPE {&#10;    NonPagedPool,&#10;    NonPagedPoolExecute = NonPagedPool,&#10;    PagedPool,&#10;    NonPagedPoolMustSucceed = NonPagedPool + 2,&#10;    DontUseThisType,&#10;    NonPagedPoolCacheAligned = NonPagedPool + 4,&#10;    PagedPoolCacheAligned,&#10;    NonPagedPoolCacheAlignedMustS = NonPagedPool + 6,&#10;    MaxPoolType,&#10;    NonPagedPoolBase = 0,&#10;    NonPagedPoolBaseMustSucceed = NonPagedPoolBase + 2,&#10;    NonPagedPoolBaseCacheAligned = NonPagedPoolBase + 4,&#10;    NonPagedPoolBaseCacheAlignedMustS = NonPagedPoolBase + 6,&#10;    NonPagedPoolSession = 32,&#10;    PagedPoolSession = NonPagedPoolSession + 1,&#10;    NonPagedPoolMustSucceedSession = PagedPoolSession + 1,&#10;    DontUseThisTypeSession = NonPagedPoolMustSucceedSession + 1,&#10;    NonPagedPoolCacheAlignedSession = DontUseThisTypeSession + 1,&#10;    PagedPoolCacheAlignedSession = NonPagedPoolCacheAlignedSession + 1,&#10;...">POOL_TYPE</a></span><span class="w">  </span><span class="n">PoolType</span><span class="p">,</span><span class="w">           </span><span class="c1">// NonPagedPool</span>
<span class="w">  </span><span class="n">__in</span><span class="w"> </span><span class="n"><a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a></span><span class="w">  </span><span class="n">NumberOfBytes</span><span class="p">,</span><span class="w">         </span><span class="c1">// value of Size</span>
<span class="w">  </span><span class="n">__in</span><span class="w"> </span><span class="n"><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></span><span class="w">  </span><span class="n">Tag</span><span class="w">                     </span><span class="c1">// value of Tag</span>
<span class="p">);</span>
</code></pre>
</div>

<p>If the <em>Allocate</em> parameter is <strong>NULL</strong>, subsequent calls to <a href="exallocatefromnpagedlookasidelist" title="PVOID ExAllocateFromNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside&#10;);">ExAllocateFromNPagedLookasideList</a> automatically allocate entries whenever the lookaside list is empty.</p>

<h3 id="free-in-optional"><code>Free</code> [in, optional]</h3>

<p>A pointer to either a caller-supplied function for freeing an entry whenever the lookaside list is full, or to <strong>NULL</strong>. If non-<strong>NULL</strong>, the pointer is to a function with the prototype:</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">VOID</span><span class="w"> </span><span class="nf">XxxFree</span><span class="p">(</span>
<span class="w">  </span><span class="n">__in</span><span class="w"> </span><span class="n">PVOID</span><span class="w">  </span><span class="n">Buffer</span>
<span class="p">);</span>
</code></pre>
</div>

<p>If the <em>Free</em> parameter is <strong>NULL</strong>, subsequent calls to <a href="exfreetonpagedlookasidelist" title="VOID ExFreeToNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside,&#10;  [in]      PVOID                  Entry&#10;);">ExFreeToNPagedLookasideList</a> automatically release the given entry back to nonpaged pool whenever the list is full, that is, currently holding the system-determined maximum number of entries.</p>

<h3 id="flags-in"><code>Flags</code> [in]</h3>

<p>Starting in Windows 8, this parameter specifies an optional flag value to modify the default behavior of the <strong>ExInitializeNPagedLookasideList</strong> routine. Compatible flag bits include the following.</p>

<table>
<thead>
<tr>
  <th>Flag bit</th>
  <th>Meaning</th>
  <th>Value</th>
</tr>
</thead>
<tbody>
<tr>
  <td>POOL_RAISE_IF_ALLOCATION_FAILURE</td>
  <td>If the allocation fails, raise an exception.</td>
  <td>16</td>
</tr>
<tr>
  <td>POOL_NX_ALLOCATION</td>
  <td>Allocate non-executable memory.</td>
  <td>512</td>
</tr>
</tbody>
</table>

<p>Before Windows 8, this parameter is not used and must be zero.</p>

<h3 id="size-in"><code>Size</code> [in]</h3>

<p>Specifies the size, in bytes, for each nonpaged entry to be allocated subsequently. This parameter must not be less than the required minimum size, LOOKASIDE_MINIMUM_BLOCK_SIZE, which is defined in the Wdm.h header file.</p>

<h3 id="tag-in"><code>Tag</code> [in]</h3>

<p>Specifies the pool tag to use when allocating lookaside list entries. For more information about pool tags, see the <em>Tag</em> parameter of <a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a>.</p>

<h3 id="depth-in"><code>Depth</code> [in]</h3>

<p>Reserved. Must be zero.</p>

<h2 id="remarks">Remarks</h2>

<p>After calling <strong>ExInitializeNPagedLookasideList</strong>, memory blocks of the caller-specified <em>Size</em> can be allocated from and freed to the lookaside list with calls to <a href="exallocatefromnpagedlookasidelist" title="PVOID ExAllocateFromNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside&#10;);">ExAllocateFromNPagedLookasideList</a> and <a href="exfreetonpagedlookasidelist" title="VOID ExFreeToNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside,&#10;  [in]      PVOID                  Entry&#10;);">ExFreeToNPagedLookasideList</a>, respectively. Such dynamically allocated and freed entries can be any data structure or fixed-size buffer that the caller uses while the system is running, particularly if the caller cannot predetermine how many such entries will be in use at any given moment. The layout and contents of each fixed-size entry are caller-determined.</p>

<p><strong>ExInitializeNPagedLookasideList</strong> initializes the system state to track usage of the given lookaside list, as follows:</p>

<ul>
<li><p>Zero-initializes the counters to be maintained for entries.</p></li>
<li><p>Stores the entry points of the caller-supplied *<strong>Xxx*Allocate</strong> and *<strong>Xxx*Free</strong> routines, if any, or sets these entry points to <a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a> and <a href="exfreepool" title="void ExFreePool(&#10;  a&#10;);">ExFreePool</a>, respectively.</p></li>
<li><p>Initializes a system spin lock to control allocations from and frees to the lookaside list in a multiprocessor-safe manner if necessary.</p></li>
<li><p>Stores the caller-supplied entry <em>Size</em> and list <em>Tag</em>.</p></li>
<li><p>Sets up the system-determined limits (minimum and maximum) on the number of entries to be held in the lookaside list, which can be adjusted subsequently if system-wide demand for entries is higher or lower than anticipated.</p></li>
<li><p>Sets up the system-determined flags, which control the type of memory from which entries will be allocated subsequently.</p></li>
</ul>

<p>The system maintains a set of all lookaside lists currently in use. As demand for lookaside list entries and on available nonpaged memory varies while the system runs, the system adjusts its limits for the number of entries to be held in each nonpaged lookaside list dynamically.</p>

<p>Drivers must always explicitly free any lookaside lists they create before unloading. To do otherwise is a serious programming error. Use <a href="exdeletenpagedlookasidelist" title="VOID ExDeleteNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside&#10;);">ExDeleteNPagedLookasideList</a> to free the list.</p>

<p><strong>ExInitializeNPagedLookasideList</strong> sets up the opaque list head at the caller-supplied location but preallocates no memory for list entries. Subsequently, the initial entries are allocated dynamically as calls to <strong><a href="exallocatefromnpagedlookasidelist" title="PVOID ExAllocateFromNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside&#10;);">ExAllocateFromNPagedLookasideList</a></strong> occur, and these initial entries are held in the lookaside list as reciprocal calls to <strong><a href="exfreetonpagedlookasidelist" title="VOID ExFreeToNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside,&#10;  [in]      PVOID                  Entry&#10;);">ExFreeToNPagedLookasideList</a></strong> occur. Entries collect in the given lookaside list until the system-determined maximum is reached, whereupon any additional entries are returned to nonpaged pool as they are freed. If the list becomes empty, allocate requests are satisfied by the *<strong>Xxx*Allocate</strong> function specified at list initialization or by <a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a>.</p>

<p>It is more efficient to pass <strong>NULL</strong> pointers for the <em>Allocate</em> and <em>Free</em> parameters of <strong>ExInitializeNPagedLookasideList</strong> whenever the user of a lookaside list does nothing more than allocate and release fixed-size entries. However, any component that uses a lookaside list might supply these functions to do additional caller-determined processing, such as tracking its own dynamic memory usage by maintaining state about the number of entries it allocates and frees.</p>

<p>If the caller of <strong>ExInitializeNPagedLookasideList</strong> supplies an *<strong>Xxx*Allocate</strong> function, that routine must allocate entries for the lookaside list using the given input parameters when it calls <strong><a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a>.</strong></p>

<p>Starting with Windows Vista, a similar routine, <a href="exinitializelookasidelistex" title="NTSTATUS ExInitializeLookasideListEx(&#10;  [out]          PLOOKASIDE_LIST_EX    Lookaside,&#10;  [in, optional] PALLOCATE_FUNCTION_EX Allocate,&#10;  [in, optional] PFREE_FUNCTION_EX     Free,&#10;  [in]           POOL_TYPE             PoolType,&#10;  [in]           ULONG                 Flags,&#10;  [in]           SIZE_T                Size,&#10;  [in]           ULONG                 Tag,&#10;  [in]           USHORT                Depth&#10;);">ExInitializeLookasideListEx</a>, initializes a lookaside list that is described by a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">LOOKASIDE_LIST_EX</a> structure. Unlike the *<strong>Xxx*Allocate</strong> and *<strong>Xxx*Free</strong> routines for a lookaside list that uses an <strong>NPAGED_LOOKASIDE_LIST</strong> structure, the allocation and deallocation routines for a lookaside list that uses the <strong>LOOKASIDE_LIST_EX</strong> structure receive a context pointer as an input parameter. These routines can use this context to store private data for the lookaside list. If your driver is intended to run only in Windows Vista and later versions of Windows, consider using <strong><a href="exinitializelookasidelistex" title="NTSTATUS ExInitializeLookasideListEx(&#10;  [out]          PLOOKASIDE_LIST_EX    Lookaside,&#10;  [in, optional] PALLOCATE_FUNCTION_EX Allocate,&#10;  [in, optional] PFREE_FUNCTION_EX     Free,&#10;  [in]           POOL_TYPE             PoolType,&#10;  [in]           ULONG                 Flags,&#10;  [in]           SIZE_T                Size,&#10;  [in]           ULONG                 Tag,&#10;  [in]           USHORT                Depth&#10;);">ExInitializeLookasideListEx</a></strong> instead of <strong>ExInitializeNPagedLookasideList</strong>. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-lookaside-lists">Using Lookaside Lists</a>.</p>

<p>Callers of <strong>ExInitializeNPagedLookasideList</strong> can be running at IRQL &lt;= DISPATCH_LEVEL, but are typically running at IRQL = PASSIVE_LEVEL.</p>

<h2 id="see-also">See also</h2>

<p><a href="exallocatefromnpagedlookasidelist" title="PVOID ExAllocateFromNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside&#10;);">ExAllocateFromNPagedLookasideList</a></p>

<p><a href="exallocatepoolwithtag" title="PVOID ExAllocatePoolWithTag(&#10;  [in] __drv_strictTypeMatch(__drv_typeExpr)POOL_TYPE PoolType,&#10;  [in] SIZE_T                                         NumberOfBytes,&#10;  [in] ULONG                                          Tag&#10;);">ExAllocatePoolWithTag</a></p>

<p><a href="exdeletenpagedlookasidelist" title="VOID ExDeleteNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside&#10;);">ExDeleteNPagedLookasideList</a></p>

<p><a href="exfreepool" title="void ExFreePool(&#10;  a&#10;);">ExFreePool</a></p>

<p><a href="exfreetonpagedlookasidelist" title="VOID ExFreeToNPagedLookasideList(&#10;  [in, out] PNPAGED_LOOKASIDE_LIST Lookaside,&#10;  [in]      PVOID                  Entry&#10;);">ExFreeToNPagedLookasideList</a></p>

<p><a href="exinitializelookasidelistex" title="NTSTATUS ExInitializeLookasideListEx(&#10;  [out]          PLOOKASIDE_LIST_EX    Lookaside,&#10;  [in, optional] PALLOCATE_FUNCTION_EX Allocate,&#10;  [in, optional] PFREE_FUNCTION_EX     Free,&#10;  [in]           POOL_TYPE             PoolType,&#10;  [in]           ULONG                 Flags,&#10;  [in]           SIZE_T                Size,&#10;  [in]           ULONG                 Tag,&#10;  [in]           USHORT                Depth&#10;);">ExInitializeLookasideListEx</a></p>

<p><a href="exinitializepagedlookasidelist" title="VOID ExInitializePagedLookasideList(&#10;  [out]          PPAGED_LOOKASIDE_LIST Lookaside,&#10;  [in, optional] PALLOCATE_FUNCTION    Allocate,&#10;  [in, optional] PFREE_FUNCTION        Free,&#10;  [in]           ULONG                 Flags,&#10;  [in]           SIZE_T                Size,&#10;  [in]           ULONG                 Tag,&#10;  [in]           USHORT                Depth&#10;);">ExInitializePagedLookasideList</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">LOOKASIDE_LIST_EX</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/eprocess">NPAGED_LOOKASIDE_LIST</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-exinitializenpagedlookasidelist">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-exinitializenpagedlookasidelist.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
