<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="PoFxRegisterComponentPerfStates - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>PoFxRegisterComponentPerfStates - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            PoFxRegisterComponentPerfStates - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> PoFxRegisterComponentPerfStates(
  [in]  POHANDLE                             Handle,
  [in]  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                                Component,
  [in]  <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a>                            Flags,
  [in]  PPO_FX_COMPONENT_PERF_STATE_CALLBACK ComponentPerfStateCallback,
  [in]  <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PPO_FX_COMPONENT_PERF_INFO</a>           InputStateInfo,
  [out] <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PPO_FX_COMPONENT_PERF_INFO</a>           *OutputStateInfo
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-pofxregistercomponentperfstates">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/pofxregistercomponentperfstates.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-pofxregistercomponentperfstates)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="pofxregistercomponentperfstates-function">PoFxRegisterComponentPerfStates function</h1>

<h2 id="description">Description</h2>

<p>The <strong>PoFxRegisterComponentPerfStates</strong> routine registers a device component for performance state management by the power management framework (PoFx).</p>

<h2 id="parameters">Parameters</h2>

<h3 id="handle-in"><code>Handle</code> [in]</h3>

<p>A handle that represents the registration of the device with PoFx. The device driver previously received this handle from the <a href="pofxregisterdevice" title="NTSTATUS PoFxRegisterDevice(&#10;  [in]  PDEVICE_OBJECT Pdo,&#10;  [in]  PPO_FX_DEVICE  Device,&#10;  [out] POHANDLE       *Handle&#10;);">PoFxRegisterDevice</a> routine.</p>

<h3 id="component-in"><code>Component</code> [in]</h3>

<p>The index that identifies the component whose performance states will be managed. This parameter is an index into the <strong>Components</strong> array in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/ns-wdm-_po_fx_device_v1">PO_FX_DEVICE</a> structure that the device driver used to register the device with PoFx. If the <strong>Components</strong> array contains N elements, component indexes range from 0 to N–1.</p>

<h3 id="flags-in"><code>Flags</code> [in]</h3>

<p>The flags that modify the behavior of the performance state registration. Set this member to zero or to one of the following flag <strong>PO_FX_FLAG_PERF_*XXX</strong>* bits:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>PO_FX_FLAG_PERF_PEP_OPTIONAL</strong><br><br>0x1</td>
  <td>Indicates that the driver can change performance states without assistance from the platform extension plug-in (PEP), or that the driver is registering performance states with PoFx for logging purposes only. If this flag is set, the <strong>PoFxRegisterComponentPerfStates</strong> call will still succeeded if the PEP does not support performance states for the component.</td>
</tr>
<tr>
  <td><strong>PO_FX_FLAG_PERF_QUERY_ON_F0</strong><br><br>0x2</td>
  <td>For some devices, the PEP may need to a place a performance state set for a component into a certain performance state (known as a <em>nominal performance state</em>) when it idles the component. Drivers set this flag if the component contains nominal performance states, in which case PoFx will query the PEP to determine the current performance state when the component transitions to F0.</td>
</tr>
<tr>
  <td><strong>PO_FX_FLAG_PERF_QUERY_ON_ALL_IDLE_STATES</strong><br><br>0x4</td>
  <td>For some devices, the PEP may need to a place a performance state set for a component into a certain performance state (known as a <em>nominal performance state</em>) when it transitions the component between idle states. Drivers set this flag if this component contains nominal performance states, in which case PoFx will query the PEP to determine the current performance state when the component transitions between idle states.</td>
</tr>
</tbody>
</table>

<h3 id="componentperfstatecallback-in"><code>ComponentPerfStateCallback</code> [in]</h3>

<p>A pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-po_fx_component_perf_state_callback">ComponentPerfStateCallback</a> routine. This routine is called when PoFx has completed logging and notifying the PEP about a performance state transition that is initiated by the driver’s call to <a href="pofxissuecomponentperfstatechange" title="VOID PoFxIssueComponentPerfStateChange(&#10;  [in] POHANDLE                 Handle,&#10;  [in] ULONG                    Flags,&#10;  [in] ULONG                    Component,&#10;  [in] PPO_FX_PERF_STATE_CHANGE PerfChange,&#10;  [in] PVOID                    Context&#10;);">PoFxIssueComponentPerfStateChange</a> or <a href="pofxissuecomponentperfstatechangemultiple" title="VOID PoFxIssueComponentPerfStateChangeMultiple(&#10;  [in] POHANDLE                   Handle,&#10;  [in] ULONG                      Flags,&#10;  [in] ULONG                      Component,&#10;  [in] ULONG                      PerfChangesCount,&#10;  [in] PO_FX_PERF_STATE_CHANGE [] PerfChanges,&#10;  [in] PVOID                      Context&#10;);">PoFxIssueComponentPerfStateChangeMultiple</a>. This callback may be the same for all components and all devices; PoFx provides the device handle and component index in each completion call.</p>

<h3 id="inputstateinfo-in"><code>InputStateInfo</code> [in]</h3>

<p>If the driver provides performance state info, this parameter contains a pointer to a driver allocated <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PO_FX_COMPONENT_PERF_INFO</a> structure that provides performance state information to PoFx. If the driver requires performance state information from the PEP, this parameter must be set to NULL.</p>

<h3 id="outputstateinfo-out"><code>OutputStateInfo</code> [out]</h3>

<p>If the driver requires performance state information from the PEP, after a successful registration this parameter contains a pointer to a <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PO_FX_COMPONENT_PERF_INFO</a> structure that provides performance state information defined by the PEP. If the driver provides performance state info, this parameter must be set to NULL.</p>

<p>The memory allocated for this parameter is managed by PoFx, and the driver should not free this memory when the device is removed. The lifetime of this memory is guaranteed to exceed the lifetime of the PoFx component that contains these performance state sets.</p>

<h2 id="return-value">Return value</h2>

<p><strong>PoFxRegisterComponentPerfStates</strong> returns <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> if PoFx accepts the device's registration of performance states. If any of the necessary information is not provided or incorrect, registration will fail with a return code other than <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong>. Possible error return values include the following status codes.</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><em>*<strong>STATUS_NOT_IMPLEMENTED</strong></em>*</td>
  <td>The <em>Flags</em> parameter does not include the <strong>PO_FX_FLAG_PERF_PEP_OPTIONAL</strong> flag and the PEP is not able to provide performance state management for this device.</td>
</tr>
<tr>
  <td><em>*<strong>STATUS_INVALID_PARAMETER</strong></em>*</td>
  <td>Both <em>InputStateInfo</em> and <em>OutputStateInfo</em> are NULL or both of these parameters are not NULL, or there are no performance state sets in the <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PO_FX_COMPONENT_PERF_INFO</a> structure that was assigned to the <em>InputStateInfo</em> parameter.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>Note that PoFx performs a deep-copy of the device's structures into its memory.</p>

<p>Either the driver or the platform extension plug-in (PEP) may provide information about the performance states supported by each component:</p>

<ul>
<li>If the driver provides performance state information, the driver must set the <em>InputStateInfo</em> parameter to a pointer to a <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PO_FX_COMPONENT_PERF_INFO</a> structure that contains the performance state information. Otherwise, the driver must set this parameter to NULL.</li>
<li>If the PEP provides performance state information, the driver must set the <em>OutputStateInfo</em> parameter to a valid pointer to a <a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PO_FX_COMPONENT_PERF_INFO</a> structure that receives the performance state information. Otherwise, the driver must set this parameter to NULL.</li>
</ul>

<p>If the PEP does not support performance states, the driver may register for performance state support with PoFx for logging purposes only.</p>

<p>If the driver registers for performance state support for logging purposes only, or if the driver can function correctly with or without PEP support for performance state management, the driver must set the <strong>PO_FX_FLAG_PERF_PEP_OPTIONAL</strong> flag in the <em>Flags</em> parameter. If the flag is set, the registration call will succeed even if the PEP does not provide support for performance states.</p>

<p>If the driver requires the PEP to provide performance state information, the driver cannot set the <strong>PO_FX_FLAG_PERF_PEP_OPTIONAL</strong> flag in the <em>Flags</em> parameter.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-po_fx_component_perf_state_callback">ComponentPerfStateCallback</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/component-level-performance-management">Device Performance State Management</a></p>

<p><a href="po_fx_component_perf_info" title="typedef struct _PO_FX_COMPONENT_PERF_INFO {&#10;  ULONG                    PerfStateSetsCount;&#10;  PO_FX_COMPONENT_PERF_SET PerfStateSets[ANYSIZE_ARRAY];&#10;} PO_FX_COMPONENT_PERF_INFO, *PPO_FX_COMPONENT_PERF_INFO;">PO_FX_COMPONENT_PERF_INFO</a></p>

<p><a href="pofxregisterdevice" title="NTSTATUS PoFxRegisterDevice(&#10;  [in]  PDEVICE_OBJECT Pdo,&#10;  [in]  PPO_FX_DEVICE  Device,&#10;  [out] POHANDLE       *Handle&#10;);">PoFxRegisterDevice</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-pofxregistercomponentperfstates">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-pofxregistercomponentperfstates.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
