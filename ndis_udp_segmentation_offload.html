<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NDIS_UDP_SEGMENTATION_OFFLOAD - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NDIS_UDP_SEGMENTATION_OFFLOAD - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NDIS_UDP_SEGMENTATION_OFFLOAD - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NDIS_UDP_SEGMENTATION_OFFLOAD {
  struct {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Encapsulation;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MaxOffLoadSize;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MinSegmentCount : 6;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> SubMssFinalSegmentSupported : 1;
#if ...
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved : 25;
#else
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved : 26;
#endif
  } IPv4;
  struct {
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Encapsulation;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MaxOffLoadSize;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> MinSegmentCount : 6;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> SubMssFinalSegmentSupported : 1;
#if ...
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved1 : 25;
#else
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved1 : 26;
#endif
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> IpExtensionHeadersSupported : 2;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Reserved2 : 30;
  } IPv6;
} NDIS_UDP_SEGMENTATION_OFFLOAD, *PNDIS_UDP_SEGMENTATION_OFFLOAD;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_udp_segmentation_offload">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndis_udp_segmentation_offload.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddndis-_ndis_udp_segmentation_offload)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_NDIS_UDP_SEGMENTATION_OFFLOAD structure</h1>

<h2>Description</h2>

<p>The <strong>NDIS_UDP_SEGMENTATION_OFFLOAD</strong> structure provides UDP Segmentation Offload (USO) information in the <strong><a href="ndis_offload" title="typedef struct _NDIS_OFFLOAD {&#10;  NDIS_OBJECT_HEADER                       Header;&#10;  NDIS_TCP_IP_CHECKSUM_OFFLOAD             Checksum;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V1           LsoV1;&#10;  NDIS_IPSEC_OFFLOAD_V1                    IPsecV1;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V2           LsoV2;&#10;  ULONG                                    Flags;&#10;  NDIS_IPSEC_OFFLOAD_V2                    IPsecV2;&#10;  NDIS_TCP_RECV_SEG_COALESCE_OFFLOAD       Rsc;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD    EncapsulatedPacketTaskOffloadGre;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_V2 EncapsulatedPacketTaskOffloadVxlan;&#10;  UCHAR                                    EncapsulationTypes;&#10;  NDIS_RFC6877_464XLAT_OFFLOAD             Rfc6877Xlat;&#10;  NDIS_UDP_SEGMENTATION_OFFLOAD            UdpSegmentation;&#10;  NDIS_UDP_RSC_OFFLOAD                     UdpRsc;&#10;} NDIS_OFFLOAD, *PNDIS_OFFLOAD;">NDIS_OFFLOAD</a></strong> structure.</p>

<h2>Members</h2>

<h3><code>IPv4</code></h3>

<p>A structure within <strong>NDIS_UDP_SEGMENTATION_OFFLOAD</strong> that specifies IPv4 information, containing the following members:</p>

<h3><code>IPv4.Encapsulation</code></h3>

<p>Encapsulation settings for IPv4. For more information about this member, see the following Remarks section.</p>

<h3><code>IPv4.MaxOffLoadSize</code></h3>

<p>The maximum bytes of user data that the transport can pass to the miniport driver in a single packet. The transport will not pass a packet to the miniport driver that contains more user data bytes than <strong>MaxOffLoadSize</strong> specifies. If such a packet must be transmitted, the transport itself segments the packet into smaller packets.</p>

<h3><code>IPv4.MinSegmentCount</code></h3>

<p>The minimum number of segments that a large UDP packet must be divisible by before the transport can offload it to the hardware for segmentation. The transport will not offload a large packet to the miniport driver for segmentation unless the miniport driver can create at least as many segments as <strong>MinSegmentCount</strong> specifies from the packet. If a large UDP packet does not meet the minimum-segment requirement, the TCP/IP transport itself segments the packet into smaller packets.</p>

<h3><code>IPv4.SubMssFinalSegmentSupported</code></h3>

<p>A <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> value that specifies whether all segments that a miniport driver derives from a large UDP packet must be the same maximum segment size (MSS) or not. If the miniport driver does not set the <strong>SubMssFinalSegmentSupported</strong> capability, then each large UDP packet offloaded by the transport must have <strong>Length % MSS == 0</strong>. That is, the large packet is divisible into <strong>N</strong> packets with each packet segment containing exactly <strong>MSS</strong> user bytes. If the miniport driver sets the <strong>SubMssFinalSegmentSupported</strong> capability, then this packet length divisibility condition on the transport does not apply. In other words, the final segment can be less than <strong>MSS</strong>.</p>

<p>The driver should set the value of <strong>SubMssFinalSegmentSupported</strong> to <strong>NDIS_OFFLOAD_SUPPORTED</strong> if the miniport is capable of segmenting UDP sends where the total length of the large packet has a non-zero remainder when divided by <strong>MSS</strong>. When miniport driver support is indicated via this flag, the protocol driver is permitted to issue large UDP sends where the UDP payload length of the final segmented packet is less than <strong>MSS</strong>.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/udp-segmentation-offload-uso-">UDP Segmentation Offload (USO)</a>.</p>

<h3><code>IPv4.Reserved</code></h3>

<p>Reserved. Miniport drivers must not read or write to this field.</p>

<h3><code>IPv6</code></h3>

<p>A structure within <strong>NDIS_UDP_SEGMENTATION_OFFLOAD</strong> that specifies IPv6 information, containing the following members:</p>

<h3><code>IPv6.Encapsulation</code></h3>

<p>Encapsulation settings for IPv6. For more information about this member, see the following Remarks section.</p>

<h3><code>IPv6.MaxOffLoadSize</code></h3>

<p>The maximum bytes of user data that the transport can pass to the miniport driver in a single packet. The transport will not pass a packet to the miniport driver that contains more user data bytes than <strong>MaxOffLoadSize</strong> specifies. If such a packet must be transmitted, the transport itself segments the packet into smaller packets.</p>

<h3><code>IPv6.MinSegmentCount</code></h3>

<p>The minimum number of segments that a large UDP packet must be divisible by before the transport can offload it to the hardware for segmentation. The transport will not offload a large packet to the miniport driver for segmentation unless the miniport driver can create at least as many segments as <strong>MinSegmentCount</strong> specifies from the packet. If a large UDP packet does not meet the minimum-segment requirement, the TCP/IP transport itself segments the packet into smaller packets.</p>

<h3><code>IPv6.SubMssFinalSegmentSupported</code></h3>

<p>A <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> value that specifies whether all segments that a miniport driver derives from a large UDP packet must be the same maximum segment size (MSS) or not. If the miniport driver does not set the <strong>SubMssFinalSegmentSupported</strong> capability, then each large UDP packet offloaded by the transport must have <strong>Length % MSS == 0</strong>. That is, the large packet is divisible into <strong>N</strong> packets with each packet segment containing exactly <strong>MSS</strong> user bytes. If the miniport driver sets the <strong>SubMssFinalSegmentSupported</strong> capability, then this packet length divisibility condition on the transport does not apply. In other words, the final segment can be less than <strong>MSS</strong>.</p>

<p>The driver should set the value of <strong>SubMssFinalSegmentSupported</strong> to <strong>NDIS_OFFLOAD_SUPPORTED</strong> if the miniport is capable of segmenting UDP sends where the total length of the large packet has a non-zero remainder when divided by <strong>MSS</strong>. When miniport driver support is indicated via this flag, the protocol driver is permitted to issue large UDP sends where the UDP payload length of the final segmented packet is less than <strong>MSS</strong>.</p>

<p>For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/udp-segmentation-offload-uso-">UDP Segmentation Offload (USO)</a>.</p>

<h3><code>IPv6.Reserved1</code></h3>

<p>Reserved. Miniport drivers must not read or write to this field.</p>

<h3><code>IPv6.IpExtensionHeadersSupported</code></h3>

<p>A <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> value that a miniport driver sets to indicate that the miniport adapter can segment a large UDP packet whose IP header contains IPv6 extension headers.</p>

<h3><code>IPv6.Reserved2</code></h3>

<p>Reserved. Miniport drivers must not read or write to this field.</p>

<h2>Remarks</h2>

<p>Miniport drivers should set the values of this structure's fields and encapsulation requirements similarly to the <strong><a href="ndis_tcp_large_send_offload_v2" title="typedef struct _NDIS_TCP_LARGE_SEND_OFFLOAD_V2 {&#10;  struct {&#10;    ULONG Encapsulation;&#10;    ULONG MaxOffLoadSize;&#10;    ULONG MinSegmentCount;&#10;  } IPv4;&#10;  struct {&#10;    ULONG Encapsulation;&#10;    ULONG MaxOffLoadSize;&#10;    ULONG MinSegmentCount;&#10;    ULONG IpExtensionHeadersSupported : 2;&#10;    ULONG TcpOptionsSupported : 2;&#10;  } IPv6;&#10;} NDIS_TCP_LARGE_SEND_OFFLOAD_V2, *PNDIS_TCP_LARGE_SEND_OFFLOAD_V2;">NDIS_TCP_LARGE_SEND_OFFLOAD_V2</a></strong> structure.</p>

<p>The <strong>NDIS_UDP_SEGMENTATION_OFFLOAD</strong> structure is used in the <strong>UdpSegmentation</strong> member of the <strong><a href="ndis_offload" title="typedef struct _NDIS_OFFLOAD {&#10;  NDIS_OBJECT_HEADER                       Header;&#10;  NDIS_TCP_IP_CHECKSUM_OFFLOAD             Checksum;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V1           LsoV1;&#10;  NDIS_IPSEC_OFFLOAD_V1                    IPsecV1;&#10;  NDIS_TCP_LARGE_SEND_OFFLOAD_V2           LsoV2;&#10;  ULONG                                    Flags;&#10;  NDIS_IPSEC_OFFLOAD_V2                    IPsecV2;&#10;  NDIS_TCP_RECV_SEG_COALESCE_OFFLOAD       Rsc;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD    EncapsulatedPacketTaskOffloadGre;&#10;  NDIS_ENCAPSULATED_PACKET_TASK_OFFLOAD_V2 EncapsulatedPacketTaskOffloadVxlan;&#10;  UCHAR                                    EncapsulationTypes;&#10;  NDIS_RFC6877_464XLAT_OFFLOAD             Rfc6877Xlat;&#10;  NDIS_UDP_SEGMENTATION_OFFLOAD            UdpSegmentation;&#10;  NDIS_UDP_RSC_OFFLOAD                     UdpRsc;&#10;} NDIS_OFFLOAD, *PNDIS_OFFLOAD;">NDIS_OFFLOAD</a></strong> structure. <strong>NDIS_UDP_SEGMENTATION_OFFLOAD</strong> specifies current or supported services that a miniport adapter provides for segmenting large UDP packets into smaller packets.</p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/content/ntddndis/ns-ntddndis-_ndis_offload"><strong>NDIS_OFFLOAD</strong></a> is used in the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/content/ndis/ns-ndis-_ndis_miniport_adapter_offload_attributes"><strong>NDIS_MINIPORT_ADAPTER_OFFLOAD_ATTRIBUTES</strong></a> structure, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/content/ndis/ns-ndis-_ndis_bind_parameters"><strong>NDIS_BIND_PARAMETERS</strong></a> structure, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/content/ndis/ns-ndis-_ndis_filter_attach_parameters"><strong>NDIS_FILTER_ATTACH_PARAMETERS</strong></a> structure, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-tcp-offload-current-config">OID_TCP_OFFLOAD_CURRENT_CONFIG</a> OID, and the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-task-offload-current-config">NDIS_STATUS_TASK_OFFLOAD_CURRENT_CONFIG</a> status indication.</p>

<p>For <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-tcp-offload-current-config">OID_TCP_OFFLOAD_CURRENT_CONFIG</a>, the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/content/ntddndis/ns-ntddndis-_ndis_offload"><strong>NDIS_OFFLOAD</strong></a> structure specifies the task offload capabilities that a miniport adapter supports. If the current offloads capabilities change, a miniport driver reports the new capabilities in an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-task-offload-current-config">NDIS_STATUS_TASK_OFFLOAD_CURRENT_CONFIG</a> status indication.</p>

<p>The <strong>Encapsulation</strong> members of <strong>NDIS_UDP_SEGMENTATION_OFFLOAD</strong> define the UDP encapsulation settings for the miniport adapter.</p>

<p>In response to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-tcp-offload-current-config">OID_TCP_OFFLOAD_CURRENT_CONFIG</a> query request, NDIS provides a bitwise OR of the encapsulation flags, which indicate the supported encapsulation settings, in each of the <strong>Encapsulation</strong> members. Miniport drivers must provide Ethernet encapsulation (NDIS_ENCAPSULATION_IEEE_802_3). The other types of encapsulation are optional.</p>

<p>For an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-task-offload-current-config">NDIS_STATUS_TASK_OFFLOAD_CURRENT_CONFIG</a> status indication, the miniport driver provides a bitwise OR of the encapsulation flags, which indicate the current capabilities, in each of the <strong>Encapsulation</strong> members.</p>

<p>The following flags are defined for the <strong>Encapsulation</strong> members:</p>

<p>NDIS_ENCAPSULATION_NOT_SUPPORTED
Specifies that no encapsulation offload is supported.</p>

<p>NDIS_ENCAPSULATION_NULL
Specifies NULL encapsulation.</p>

<p>NDIS_ENCAPSULATION_IEEE_802_3
Specifies IEEE 802.3 encapsulation.</p>

<p>NDIS_ENCAPSULATION_IEEE_802_3_P_AND_Q
Specifies IEEE 802.3p and IEEE 802.3q encapsulation.</p>

<p>NDIS_ENCAPSULATION_IEEE_802_3_P_AND_Q_IN_OOB
Specifies that IEEE 802.3p and IEEE 802.3q encapsulation settings are specified in the NetBufferListInfo member of each <a href="net_buffer_list" title="typedef struct _NET_BUFFER_LIST {&#10;  union {&#10;    struct {&#10;      NET_BUFFER_LIST *Next;&#10;      NET_BUFFER      *FirstNetBuffer;&#10;    };&#10;    SLIST_HEADER           Link;&#10;    NET_BUFFER_LIST_HEADER NetBufferListHeader;&#10;  };&#10;  NET_BUFFER_LIST_CONTEXT *Context;&#10;  NET_BUFFER_LIST         *ParentNetBufferList;&#10;  NDIS_HANDLE             NdisPoolHandle;&#10;  PVOID                   NdisReserved[2];&#10;  PVOID                   ProtocolReserved[4];&#10;  PVOID                   MiniportReserved[2];&#10;  PVOID                   Scratch;&#10;  NDIS_HANDLE             SourceHandle;&#10;  ULONG                   NblFlags;&#10;  LONG                    ChildRefCount;&#10;  ULONG                   Flags;&#10;...">NET_BUFFER_LIST</a> structure.</p>

<p>NDIS_ENCAPSULATION_IEEE_LLC_SNAP_ROUTED
Specifies logical link control (LLC) encapsulation for routed protocols, as described in RFC 1483. This flag is also used to indicate Ethernet LLC/SNAP encapsulation.</p>

<h2>See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/udp-segmentation-offload-uso-">UDP Segmentation Offload (USO)</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddndis/ns-ntddndis-_ndis_udp_segmentation_offload">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddndis/ns-ntddndis-_ndis_udp_segmentation_offload.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
