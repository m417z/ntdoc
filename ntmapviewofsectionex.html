<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtMapViewOfSectionEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtMapViewOfSectionEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtMapViewOfSectionEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTMMAPI_H
#if (PHNT_MODE != PHNT_MODE_KERNEL)
#if (PHNT_VERSION &gt;= PHNT_WINDOWS_10_RS5)

</span><span class="ntdoc-code-intro">/**
 * The NtMapViewOfSectionEx routine maps a view of a section into the virtual address space of a subject process.
 *
 * \param SectionHandle A handle to an existing section object.
 * \param ProcessHandle A handle to the object that represents the process that the view should be mapped into. The handle must have been opened with <a href="process_vm_operation" title="#define PROCESS_VM_OPERATION 0x0008">PROCESS_VM_OPERATION</a> access.
 * \param BaseAddress A pointer to a variable that receives the base address of the view. If the value is not NULL, the view is allocated starting at the specified virtual address rounded down to the next 64-kilobyte address boundary.
 * \param SectionOffset A pointer to a variable that receives the offset, in bytes, from the beginning of the section to the view.
 * \param ViewSize A pointer to a variable that specifies the size of the view in bytes. If the initial value is zero, <a href="ntmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMapViewOfSection(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _In_ SIZE_T CommitSize,&#10;    _Inout_opt_ PLARGE_INTEGER SectionOffset,&#10;    _Inout_ PSIZE_T ViewSize,&#10;    _In_ SECTION_INHERIT InheritDisposition,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">NtMapViewOfSection</a> maps a view of the section that starts at SectionOffset and continues to the end of the section.
 * \param AllocationType Specifies the type of allocation to be performed for the specified region of pages. The valid flags are <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a>, <a href="mem_top_down" title="#define MEM_TOP_DOWN 0x00100000">MEM_TOP_DOWN</a>, <a href="mem_large_pages" title="#define MEM_LARGE_PAGES 0x20000000">MEM_LARGE_PAGES</a>, <a href="mem_different_image_base_ok" title="#define MEM_DIFFERENT_IMAGE_BASE_OK 0x00800000">MEM_DIFFERENT_IMAGE_BASE_OK</a> and <a href="mem_replace_placeholder" title="#define MEM_REPLACE_PLACEHOLDER 0x00004000">MEM_REPLACE_PLACEHOLDER</a>. Although <a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a> is not allowed, it is implied unless <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a> is specified.
 * \param PageProtection Specifies the page protection to be applied to the mapped view. Not used with <a href="sec_image" title="#define SEC_IMAGE 0x01000000">SEC_IMAGE</a>, must be set to <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a> for <a href="sec_image_no_execute" title="#define SEC_IMAGE_NO_EXECUTE (SEC_IMAGE | SEC_NOCACHE)">SEC_IMAGE_NO_EXECUTE</a>. For non-image sections, the value must be compatible with the section&#x27;s page protection from <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">NtCreateSection</a>.
 * \param ExtendedParameters An optional pointer to one or more extended parameters of type <a href="mem_extended_parameter" title="typedef struct MEM_EXTENDED_PARAMETER {&#10;  struct {&#10;    ULONG64 Type : MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;    ULONG64 Reserved : 64 - MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;  } DUMMYSTRUCTNAME;&#10;  union {&#10;    ULONG64 ULong64;&#10;    PVOID   Pointer;&#10;    SIZE_T  Size;&#10;    HANDLE  Handle;&#10;    ULONG   ULong;&#10;  } DUMMYUNIONNAME;&#10;} MEM_EXTENDED_PARAMETER, *PMEM_EXTENDED_PARAMETER;">MEM_EXTENDED_PARAMETER</a>.
 * \param ExtendedParameterCount Specifies the number of elements in the ExtendedParameters array.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsectionex
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtMapViewOfSectionEx(
    _In_ HANDLE SectionHandle,
    _In_ HANDLE ProcessHandle,
    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,
    _Inout_opt_ PLARGE_INTEGER SectionOffset,
    _Inout_ PSIZE_T ViewSize,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationType,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PageProtection,
    _Inout_updates_opt_(ExtendedParameterCount) <a href="mem_extended_parameter" title="typedef struct MEM_EXTENDED_PARAMETER {&#10;  struct {&#10;    ULONG64 Type : MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;    ULONG64 Reserved : 64 - MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;  } DUMMYSTRUCTNAME;&#10;  union {&#10;    ULONG64 ULong64;&#10;    PVOID   Pointer;&#10;    SIZE_T  Size;&#10;    HANDLE  Handle;&#10;    ULONG   ULong;&#10;  } DUMMYUNIONNAME;&#10;} MEM_EXTENDED_PARAMETER, *PMEM_EXTENDED_PARAMETER;">PMEM_EXTENDED_PARAMETER</a> ExtendedParameters,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ExtendedParameterCount
    );
</span><span class="ntdoc-code-footer">
#endif
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/d9393a49b3707fc786047a2ca5ae4afefd760b30/phnt/include/ntmmapi.h#L1353">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwMapViewOfSectionEx(
    _In_ HANDLE SectionHandle,
    _In_ HANDLE ProcessHandle,
    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,
    _Inout_opt_ PLARGE_INTEGER SectionOffset,
    _Inout_ PSIZE_T ViewSize,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> AllocationType,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> PageProtection,
    _Inout_updates_opt_(ExtendedParameterCount) <a href="mem_extended_parameter" title="typedef struct MEM_EXTENDED_PARAMETER {&#10;  struct {&#10;    ULONG64 Type : MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;    ULONG64 Reserved : 64 - MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;  } DUMMYSTRUCTNAME;&#10;  union {&#10;    ULONG64 ULong64;&#10;    PVOID   Pointer;&#10;    SIZE_T  Size;&#10;    HANDLE  Handle;&#10;    ULONG   ULong;&#10;  } DUMMYUNIONNAME;&#10;} MEM_EXTENDED_PARAMETER, *PMEM_EXTENDED_PARAMETER;">PMEM_EXTENDED_PARAMETER</a> ExtendedParameters,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> ExtendedParameterCount
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/d9393a49b3707fc786047a2ca5ae4afefd760b30/phnt/include/ntzwapi.h#L2393">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwMapViewOfSectionEx(
  [in]                HANDLE                  SectionHandle,
  [in]                HANDLE                  ProcessHandle,
  [in, out]           PVOID                   *BaseAddress,
  [in, out, optional] PLARGE_INTEGER          SectionOffset,
  [in, out]           PSIZE_T                 ViewSize,
  [in]                <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                   AllocationType,
  [in]                <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                   PageProtection,
  [in, out, optional] <a href="mem_extended_parameter" title="typedef struct MEM_EXTENDED_PARAMETER {&#10;  struct {&#10;    ULONG64 Type : MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;    ULONG64 Reserved : 64 - MEM_EXTENDED_PARAMETER_TYPE_BITS;&#10;  } DUMMYSTRUCTNAME;&#10;  union {&#10;    ULONG64 ULong64;&#10;    PVOID   Pointer;&#10;    SIZE_T  Size;&#10;    HANDLE  Handle;&#10;    ULONG   ULong;&#10;  } DUMMYUNIONNAME;&#10;} MEM_EXTENDED_PARAMETER, *PMEM_EXTENDED_PARAMETER;">PMEM_EXTENDED_PARAMETER</a> ExtendedParameters,
  [in]                <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                   ExtendedParameterCount
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsectionex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntmapviewofsectionex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwmapviewofsectionex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2>Description</h2>
<p>The <strong>ZwMapViewOfSectionEx</strong> routine maps a view of a section into the virtual address space of a subject process.</p>
<h2>Parameters</h2>
<h3><code>SectionHandle</code> [in]</h3>
<p>Handle to a section object. This handle is created by a successful call to <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a> or <a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenSection</a>.</p>
<h3><code>ProcessHandle</code> [in]</h3>
<p>Handle to the object that represents the process that the view should be mapped into. Use the <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/zwcurrentprocess">ZwCurrentProcess</a> macro to specify the current process. The handle must have been opened with <a href="https://learn.microsoft.com/windows/win32/procthread/process-security-and-access-rights"><strong>PROCESS_VM_OPERATION</strong></a> access.</p>
<h3><code>BaseAddress</code> [in, out]</h3>
<p>Pointer to a variable that receives the base address of the view. If the value of this parameter is not <strong>NULL</strong>, the view is allocated starting at the specified virtual address rounded down to the next 64-kilobyte address boundary.</p>
<h3><code>SectionOffset</code> [in, out, optional]</h3>
<p>A pointer to a variable that receives the offset, in bytes, from the beginning of the section to the view. If this pointer is not <strong>NULL</strong>, the offset is rounded down to the next allocation-granularity size boundary.</p>
<h3><code>ViewSize</code> [in, out]</h3>
<p>A pointer to a <a href="size_t-2" title="typedef ULONG_PTR SIZE_T;">SIZE_T</a> variable. If the initial value of this variable is zero, <strong>ZwMapViewOfSectionEx</strong> maps a view of the section that starts at <em>SectionOffset</em> and continues to the end of the section. Otherwise, the initial value specifies the view's size, in bytes. <strong>ZwMapViewOfSectionEx</strong> always rounds this value up to the nearest multiple of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> before mapping the view.</p>
<p>On return, the value receives the actual size, in bytes, of the view.</p>
<h3><code>AllocationType</code> [in]</h3>
<p>Specifies a set of flags that describes the type of allocation to be performed for the specified region of pages. The valid flags are <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a>, <a href="mem_top_down" title="#define MEM_TOP_DOWN 0x00100000">MEM_TOP_DOWN</a>, <a href="mem_large_pages" title="#define MEM_LARGE_PAGES 0x20000000">MEM_LARGE_PAGES</a>, <a href="mem_different_image_base_ok" title="#define MEM_DIFFERENT_IMAGE_BASE_OK 0x00800000">MEM_DIFFERENT_IMAGE_BASE_OK</a> and <a href="mem_replace_placeholder" title="#define MEM_REPLACE_PLACEHOLDER 0x00004000">MEM_REPLACE_PLACEHOLDER</a>. Although <a href="mem_commit" title="#define MEM_COMMIT 0x00001000">MEM_COMMIT</a> is not allowed, it is implied unless <a href="mem_reserve" title="#define MEM_RESERVE 0x00002000">MEM_RESERVE</a> is specified. For more information about the MEM_<em>XXX</em> flags, see the description of the <a href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc</a> and <a href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile3">MapViewOfFile3</a> routines.</p>
<h3><code>PageProtection</code> [in]</h3>
<p>Specifies the <a href="https://learn.microsoft.com/windows/win32/Memory/memory-protection-constants">page protection</a> to be applied to the mapped view.</p>
<p>For section objects created with the <a href="sec_image" title="#define SEC_IMAGE 0x01000000">SEC_IMAGE</a> attribute, the PageProtection parameter has no effect, and can be set to any valid value such as <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a>.</p>
<p>For section objects created with the <a href="sec_image_no_execute" title="#define SEC_IMAGE_NO_EXECUTE (SEC_IMAGE | SEC_NOCACHE)">SEC_IMAGE_NO_EXECUTE</a> attribute, the PageProtection value must be set to <a href="page_readonly" title="#define PAGE_READONLY 0x02 // Enables read-only access to the committed region of pages. An attempt to write or execute the committed region results in an access violation.">PAGE_READONLY</a>.</p>
<p>For non-image sections, the value of the PageProtection parameter must be compatible with the section's page protection that was specified when <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a> was called.</p>
<p><strong>ZwMapViewOfSectionEx</strong> always sets the cache type of the mapped pages to match the cache type supplied when the section object was created. For example, if <a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a> was called with the <a href="sec_nocache" title="#define SEC_NOCACHE 0x10000000">SEC_NOCACHE</a> flag, <strong>ZwMapViewOfSectionEx</strong> will map the pages uncached, regardless of whether the PageProtection parameter includes the <a href="page_nocache" title="#define PAGE_NOCACHE 0x200 // Sets all pages to be non-cachable. Applications should not use this attribute. Using interlocked functions with memory that is mapped with SEC_NOCACHE can result in an EXCEPTION_ILLEGAL_INSTRUCTION exception.">PAGE_NOCACHE</a> flag or not.</p>
<h3><code>ExtendedParameters</code> [in, out, optional]</h3>
<p>An optional pointer to one or more extended parameters of type <a href="https://learn.microsoft.com/windows/win32/api/winnt/ns-winnt-mem_extended_parameter">MEM_EXTENDED_PARAMETER</a>. For more information about extended parameters, see the description of the <a href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile3">MapViewOfFile3</a> routine.</p>
<h3><code>ExtendedParameterCount</code> [in]</h3>
<p>Specifies the number of elements in the ExtendedParameters array.</p>
<h2>Return value</h2>
<p><strong>ZwMapViewOfSectionEx</strong> returns an <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value. Possible return values include the following:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
<td>The routine successfully performed the requested operation.</td>
</tr>
<tr>
<td><strong>STATUS_CONFLICTING_ADDRESSES</strong></td>
<td>The specified address range conflicts with a range that is already reserved.</td>
</tr>
<tr>
<td><strong>STATUS_INVALID_PAGE_PROTECTION</strong></td>
<td>The value specified for the <em>PageProtection</em> parameter is invalid.</td>
</tr>
<tr>
<td><strong>STATUS_SECTION_PROTECTION</strong></td>
<td>The value specified for the <em>PageProtection</em> parameter is incompatible with the page protection specified when the section was created.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>Several different views of a section can be concurrently mapped into the virtual address space of one or more processes.</p>
<p>Do not use <strong>ZwMapViewOfSectionEx</strong> to map a memory range from <strong>\Device\PhysicalMemory</strong> into user mode, unless your driver has directly allocated the memory range through <a href="mmallocatepagesformdlex" title="PMDL MmAllocatePagesForMdlEx(&#10;  [in] PHYSICAL_ADDRESS    LowAddress,&#10;  [in] PHYSICAL_ADDRESS    HighAddress,&#10;  [in] PHYSICAL_ADDRESS    SkipBytes,&#10;  [in] SIZE_T              TotalBytes,&#10;  [in] MEMORY_CACHING_TYPE CacheType,&#10;  [in] ULONG               Flags&#10;);">MmAllocatePagesForMdlEx</a> or another method guaranteeing that no other system component has mapped the same memory range with a different <a href="memory_caching_type" title="typedef enum _MEMORY_CACHING_TYPE {&#10;  MmNonCached,&#10;  MmCached,&#10;  MmWriteCombined,&#10;  MmHardwareCoherentCached,&#10;  MmNonCachedUnordered,&#10;  MmUSWCCached,&#10;  MmMaximumCacheType,&#10;  MmNotMapped&#10;} MEMORY_CACHING_TYPE;">MEMORY_CACHING_TYPE</a> value.</p>
<p>User applications cannot access <strong>\Device\PhysicalMemory</strong> directly starting with Windows Server 2003 with Service Pack 1 (SP1) and can access it only if the driver passes a handle to the application.</p>
<p>For more information about section objects, see <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/section-objects-and-views">Section Objects and Views</a>.</p>
<p>If the call to this function occurs in user mode, you should use the name &quot;<strong>NtMapViewOfSectionEx</strong>&quot; instead of &quot;<strong>ZwMapViewOfSectionEx</strong>&quot;.</p>
<p>For calls from kernel-mode drivers, the <strong>Nt<em>Xxx</em></strong> and <strong>Zw<em>Xxx</em></strong> versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt<em>Xxx</em></strong> and <strong>Zw<em>Xxx</em></strong> versions of a routine, see <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>
<h2>See also</h2>
<p><a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a></p>
<p><a href="ntcreatesection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ PLARGE_INTEGER MaximumSize,&#10;    _In_ ULONG SectionPageProtection,&#10;    _In_ ULONG AllocationAttributes,&#10;    _In_opt_ HANDLE FileHandle&#10;    );">ZwCreateSection</a></p>
<p><a href="ntopensection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenSection(&#10;    _Out_ PHANDLE SectionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenSection</a></p>
<p><a href="ntmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMapViewOfSection(&#10;    _In_ HANDLE SectionHandle,&#10;    _In_ HANDLE ProcessHandle,&#10;    _Inout_ _At_(*BaseAddress, _Readable_bytes_(*ViewSize) _Writable_bytes_(*ViewSize) _Post_readable_byte_size_(*ViewSize)) PVOID *BaseAddress,&#10;    _In_ ULONG_PTR ZeroBits,&#10;    _In_ SIZE_T CommitSize,&#10;    _Inout_opt_ PLARGE_INTEGER SectionOffset,&#10;    _Inout_ PSIZE_T ViewSize,&#10;    _In_ SECTION_INHERIT InheritDisposition,&#10;    _In_ ULONG AllocationType,&#10;    _In_ ULONG PageProtection&#10;    );">ZwMapViewOfSection</a></p>
<p><a href="ntunmapviewofsection" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtUnmapViewOfSection(&#10;    _In_ HANDLE ProcessHandle,&#10;    _In_opt_ PVOID BaseAddress&#10;    );">ZwUnmapViewOfSection</a></p>
<p><a href="https://learn.microsoft.com/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile3">MapViewOfFile3</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmapviewofsectionex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwmapviewofsectionex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
