<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtOpenKeyTransactedEx - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtOpenKeyTransactedEx - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtOpenKeyTransactedEx - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTREGAPI_H

</span><span class="ntdoc-code-intro language-cpp">/**
 * Opens an existing registry key in a transaction with extended options.
 *
 * \param[out] KeyHandle A pointer to a handle that receives the key handle.
 * \param[in] DesiredAccess The access mask that specifies the desired access rights.
 * \param[in] ObjectAttributes A pointer to an <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a> structure that specifies the object attributes.
 * \param[in] OpenOptions The options to use when opening the key.
 * \param[in] TransactionHandle A handle to the transaction.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 */
</span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtOpenKeyTransactedEx(
    _Out_ PHANDLE KeyHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_ <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> OpenOptions,
    _In_ HANDLE TransactionHandle
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/163d205482d654b16259e736b1d199685b2cc090/phnt/include/ntregapi.h#L807">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwOpenKeyTransactedEx(
    _Out_ PHANDLE KeyHandle,
    _In_ ACCESS_MASK DesiredAccess,
    _In_ <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> OpenOptions,
    _In_ HANDLE TransactionHandle
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/163d205482d654b16259e736b1d199685b2cc090/phnt/include/ntzwapi.h#L2616">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// wdm.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwOpenKeyTransactedEx(
  [out] PHANDLE            KeyHandle,
  [in]  ACCESS_MASK        DesiredAccess,
  [in]  <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">POBJECT_ATTRIBUTES</a> ObjectAttributes,
  [in]  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              OpenOptions,
  [in]  HANDLE             TransactionHandle
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwopenkeytransactedex">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwopenkeytransactedex">documented in Windows Driver Kit</a>.</p>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntopenkeytransactedex.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwopenkeytransactedex)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>ZwOpenKeyTransactedEx function</h1>
<h2>Description</h2>
<p>The <strong>ZwOpenKeyTransactedEx</strong> routine opens an existing registry key and associates the key with a transaction.</p>
<h2>Parameters</h2>
<h3><code>KeyHandle</code> [out]</h3>
<p>A pointer to a HANDLE variable into which the routine writes the handle to the key.</p>
<h3><code>DesiredAccess</code> [in]</h3>
<p>Specifies the type of access to the key that the caller requests. This parameter is an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a> value. For more information, see the description of the <em>DesiredAccess</em> parameter of the <a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a> routine.</p>
<h3><code>ObjectAttributes</code> [in]</h3>
<p>A pointer to the object attributes of the key being opened. This parameter points to an <a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a> structure that must have been previously initialized by the <a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a> routine. The caller must specify the name of the registry key as the <em>ObjectName</em> parameter in the call to <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong>. If the caller is not running in a system thread context, it must set the <a href="obj_kernel_handle" title="#define OBJ_KERNEL_HANDLE 0x00000200L">OBJ_KERNEL_HANDLE</a> attribute when it calls <strong><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></strong>.</p>
<h3><code>OpenOptions</code> [in]</h3>
<p>Specifies the options to apply when opening the key. Set this parameter to zero or to the bitwise OR of one or more of the following REG_OPTION_<em>XXX</em> flag bits.</p>
<table>
<thead>
<tr>
<th><em>OpenOptions</em> flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="reg_option_open_link" title="#define REG_OPTION_OPEN_LINK (0x00000008L) // Open symbolic link">REG_OPTION_OPEN_LINK</a></td>
<td>The key is a symbolic link. This flag is not used by device and intermediate drivers.</td>
</tr>
<tr>
<td><a href="reg_option_backup_restore" title="#define REG_OPTION_BACKUP_RESTORE (0x00000004L) // open for backup or restore special access rules privilege required">REG_OPTION_BACKUP_RESTORE</a></td>
<td>The key should be opened with special privileges that allow backup and restore operations. This flag is not used by device and intermediate drivers.</td>
</tr>
</tbody>
</table>
<h3><code>TransactionHandle</code> [in]</h3>
<p>A handle to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/transaction-objects">transaction object</a>. To obtain this handle, you can call the <a href="ntcreatetransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateTransaction(&#10;    _Out_ PHANDLE TransactionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ LPGUID Uow,&#10;    _In_opt_ HANDLE TmHandle,&#10;    _In_opt_ ULONG CreateOptions,&#10;    _In_opt_ ULONG IsolationLevel,&#10;    _In_opt_ ULONG IsolationFlags,&#10;    _In_opt_ PLARGE_INTEGER Timeout,&#10;    _In_opt_ PCUNICODE_STRING Description&#10;    );">ZwCreateTransaction</a> routine. Or, if you have a pointer to a transaction object, you can supply the pointer to the <a href="obopenobjectbypointer" title="NTSTATUS ObOpenObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ULONG           HandleAttributes,&#10;  [in, optional] PACCESS_STATE   PassedAccessState,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode,&#10;  [out]          PHANDLE         Handle&#10;);">ObOpenObjectByPointer</a> routine to obtain the corresponding transaction handle.</p>
<h2>Return value</h2>
<p><strong>ZwOpenKeyTransactedEx</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the call successfully opens the key. Possible error return values include the following:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>STATUS_INVALID_PARAMETER</strong></td>
<td>The <em>ObjectAttributes</em> parameter is <strong>NULL</strong> or points to invalid information.</td>
</tr>
<tr>
<td><strong>STATUS_INVALID_PARAMETER_4</strong></td>
<td>The <em>OpenOptions</em> parameter value specifies invalid options.</td>
</tr>
<tr>
<td><strong>STATUS_OBJECT_PATH_SYNTAX_BAD</strong></td>
<td>The registry path in the object attributes is invalid.</td>
</tr>
<tr>
<td><strong>STATUS_OBJECT_NAME_NOT_FOUND</strong></td>
<td>The registry path in the object attributes was not found.</td>
</tr>
<tr>
<td><strong>STATUS_ACCESS_DENIED</strong></td>
<td>The caller did not have the required access rights to open a handle for the named registry key.</td>
</tr>
<tr>
<td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
<td>A memory allocation operation failed.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>This routine provides a handle with which the caller can access a registry key. Additionally, this routine associates the key with an active transaction.</p>
<p>After the handle that is pointed to by <em>KeyHandle</em> is no longer being used, the driver must call the <a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a> routine to close it.</p>
<p>If the specified key does not exist in the registry, <strong>ZwOpenKeyTransactedEx</strong> returns an error status value and does not supply a key handle. Unlike the <a href="ntcreatekeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _In_ HANDLE TransactionHandle,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKeyTransacted</a> routine, the <strong>ZwOpenKeyTransactedEx</strong> routine does not create the specified key if the key does not exist. Both <strong><a href="ntcreatekeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _In_ HANDLE TransactionHandle,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKeyTransacted</a></strong> and <strong>ZwOpenKeyTransactedEx</strong> associate a registry key with a transaction.</p>
<p>The <a href="ntopenkeyex" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKeyEx(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ ULONG OpenOptions&#10;    );">ZwOpenKeyEx</a> routine is similar to <strong>ZwOpenKeyTransactedEx</strong>, but does not associate a key with a transaction.</p>
<p>The <a href="ntopenkeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE TransactionHandle&#10;    );">ZwOpenKeyTransacted</a> routine is similar to <strong>ZwOpenKeyTransactedEx</strong> but does not accept an <em>OpenOptions</em> parameter. The <em>OpenOptions</em> parameter of <strong>ZwOpenKeyTransactedEx</strong> enables the caller to open a key that is a symbolic link, or to open a key for backup and restore operations. A call to <strong>ZwOpenKeyTransactedEx</strong> with <em>OpenOptions</em> parameter set to zero is equivalent to a call to <strong><a href="ntopenkeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE TransactionHandle&#10;    );">ZwOpenKeyTransacted</a></strong>.</p>
<p>After a kernel-mode driver obtains a handle to a transaction (for example, by calling <strong><a href="ntcreatetransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateTransaction(&#10;    _Out_ PHANDLE TransactionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ LPGUID Uow,&#10;    _In_opt_ HANDLE TmHandle,&#10;    _In_opt_ ULONG CreateOptions,&#10;    _In_opt_ ULONG IsolationLevel,&#10;    _In_opt_ ULONG IsolationFlags,&#10;    _In_opt_ PLARGE_INTEGER Timeout,&#10;    _In_opt_ PCUNICODE_STRING Description&#10;    );">ZwCreateTransaction</a></strong>), the driver can perform a series of registry operations that are part of this transaction. The driver can close the transaction either by committing to the changes that were made in the transaction or by rolling back the transaction.</p>
<p>After the driver successfully completes all registry operations that are part of a transaction, it can call the <a href="ntcommittransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCommitTransaction(&#10;    _In_ HANDLE TransactionHandle,&#10;    _In_ BOOLEAN Wait&#10;    );">ZwCommitTransaction</a> routine to commit to the changes. The driver can call the <a href="ntrollbacktransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRollbackTransaction(&#10;    _In_ HANDLE TransactionHandle,&#10;    _In_ BOOLEAN Wait&#10;    );">ZwRollbackTransaction</a> routine to roll back the transaction.</p>
<p>During a transaction, a registry operation is part of the transaction if the system call that performs the operation meets either of the following conditions:</p>
<ul>
<li>The call specifies, as an input parameter, the transaction handle. For example, calls to <strong><a href="ntcreatekeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _In_ HANDLE TransactionHandle,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKeyTransacted</a></strong> and <strong>ZwOpenKeyTransactedEx</strong> can associate one or more keys with the transaction.</li>
<li>The call specifies, as an input parameter, a registry key handle that was obtained by a call to <strong><a href="ntcreatekeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _In_ HANDLE TransactionHandle,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKeyTransacted</a></strong> or <strong>ZwOpenKeyTransactedEx</strong> to which the transaction handle was supplied. For example, a call to the <a href="ntsetvaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ PCUNICODE_STRING ValueName,&#10;    _In_opt_ ULONG TitleIndex,&#10;    _In_ ULONG Type,&#10;    _In_reads_bytes_opt_(DataSize) PVOID Data,&#10;    _In_ ULONG DataSize&#10;    );">ZwSetValueKey</a> routine can use a key handle that was obtained in this way to set the value of a registry key as part of a transaction.</li>
</ul>
<p>For more information about kernel-mode transactions, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-kernel-transaction-manager">Using Kernel Transaction Manager</a>.</p>
<p><strong>ZwOpenKeyTransactedEx</strong> ignores the security information in the structure that the <em>ObjectAttributes</em> parameter points to.</p>
<p>If the kernel-mode caller is not running in a system thread context, it must ensure that any handles it creates are kernel handles. Otherwise, the handle can be accessed by the process in whose context the driver is running. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/object-handles">Object Handles</a>.</p>
<p>For more information about how to work with registry keys in kernel mode, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-the-registry-in-a-driver">Using the Registry in a Driver</a>.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/access-mask">ACCESS_MASK</a></p>
<p><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></p>
<p><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></p>
<p><a href="obopenobjectbypointer" title="NTSTATUS ObOpenObjectByPointer(&#10;  [in]           PVOID           Object,&#10;  [in]           ULONG           HandleAttributes,&#10;  [in, optional] PACCESS_STATE   PassedAccessState,&#10;  [in]           ACCESS_MASK     DesiredAccess,&#10;  [in, optional] POBJECT_TYPE    ObjectType,&#10;  [in]           KPROCESSOR_MODE AccessMode,&#10;  [out]          PHANDLE         Handle&#10;);">ObOpenObjectByPointer</a></p>
<p><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a></p>
<p><a href="ntcommittransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCommitTransaction(&#10;    _In_ HANDLE TransactionHandle,&#10;    _In_ BOOLEAN Wait&#10;    );">ZwCommitTransaction</a></p>
<p><a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a></p>
<p><a href="ntcreatekeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _In_ HANDLE TransactionHandle,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKeyTransacted</a></p>
<p><a href="ntcreatetransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateTransaction(&#10;    _Out_ PHANDLE TransactionHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_opt_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_opt_ LPGUID Uow,&#10;    _In_opt_ HANDLE TmHandle,&#10;    _In_opt_ ULONG CreateOptions,&#10;    _In_opt_ ULONG IsolationLevel,&#10;    _In_opt_ ULONG IsolationFlags,&#10;    _In_opt_ PLARGE_INTEGER Timeout,&#10;    _In_opt_ PCUNICODE_STRING Description&#10;    );">ZwCreateTransaction</a></p>
<p><a href="ntopenkeyex" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKeyEx(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ ULONG OpenOptions&#10;    );">ZwOpenKeyEx</a></p>
<p><a href="ntopenkeytransacted" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKeyTransacted(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _In_ HANDLE TransactionHandle&#10;    );">ZwOpenKeyTransacted</a></p>
<p><a href="ntrollbacktransaction" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtRollbackTransaction(&#10;    _In_ HANDLE TransactionHandle,&#10;    _In_ BOOLEAN Wait&#10;    );">ZwRollbackTransaction</a></p>
<p><a href="ntsetvaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ PCUNICODE_STRING ValueName,&#10;    _In_opt_ ULONG TitleIndex,&#10;    _In_ ULONG Type,&#10;    _In_reads_bytes_opt_(DataSize) PVOID Data,&#10;    _In_ ULONG DataSize&#10;    );">ZwSetValueKey</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwopenkeytransactedex">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwopenkeytransactedex.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
