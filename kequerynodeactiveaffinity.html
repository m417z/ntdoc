<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KeQueryNodeActiveAffinity - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KeQueryNodeActiveAffinity - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KeQueryNodeActiveAffinity - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID KeQueryNodeActiveAffinity(
  [in]            <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>          NodeNumber,
  [out, optional] <a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">PGROUP_AFFINITY</a> Affinity,
  [out, optional] PUSHORT         Count
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerynodeactiveaffinity">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/kequerynodeactiveaffinity.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-kequerynodeactiveaffinity)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>KeQueryNodeActiveAffinity</strong> routine gets the current processor affinity of a specified node in a multiprocessor system that has a non-uniform memory access (NUMA) architecture.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="nodenumber-in"><code>NodeNumber</code> [in]</h3>

<p>The node number. If a multiprocessor system contains <em>n</em> nodes, the nodes are numbered from 0 to <em>n</em>-1. To obtain the highest node number (<em>n</em>-1) in the system, call the <a href="kequeryhighestnodenumber" title="USHORT KeQueryHighestNodeNumber();">KeQueryHighestNodeNumber</a> routine.</p>

<h3 id="affinity-out-optional"><code>Affinity</code> [out, optional]</h3>

<p>A pointer to a caller-allocated buffer into which the routine writes a <strong><a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">GROUP_AFFINITY</a></strong> structure. This structure contains the group number of the group that contains the node that is identified by <em>NodeNumber</em>, and an affinity mask that indicates which logical processors in the node are active. You can set this parameter to <strong>NULL</strong> if you do not need this information.</p>

<p>Starting in Windows Server 2022, a node can span more than one group. This happens when a node contains more than 64 processors. In this case, the OS assigns a primary group for each NUMA node. The primary group is always the one containing the most processors. In this case, the group affinity structure returned is for the node's primary group. For more info about this change in behavior, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/procthread/numa-support">NUMA Support</a>. If your code runs on systems with more than 64 processors per NUMA node, consider instead using <strong><a href="kequerynodeactiveaffinity2" title="NTSTATUS KeQueryNodeActiveAffinity2(&#10;  [in]  USHORT          NodeNumber,&#10;  [out] PGROUP_AFFINITY GroupAffinities,&#10;  [in]  USHORT          GroupAffinitiesCount,&#10;  [out] PUSHORT         GroupAffinitiesRequired&#10;);">KeQueryNodeActiveAffinity2</a></strong>.</p>

<h3 id="count-out-optional"><code>Count</code> [out, optional]</h3>

<p>A pointer to a location into which the routine writes the number of active processors that are represented in the node affinity mask that is pointed to by <em>Affinity</em>. You can set this parameter to <strong>NULL</strong> if you do not need this information.</p>

<p>Starting in Windows Server 2022, count returned is for the node's primary group. See more info about primary groups above.</p>

<h2 id="remarks">Remarks</h2>

<p>The caller-allocated buffer that is pointed to by the <em>Affinity</em> parameter must be large enough to contain a <strong><a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">GROUP_AFFINITY</a></strong> structure. The <strong>Mask</strong> member of this structure contains an affinity mask that indicates which processors are active. If a processor is active, the corresponding bit in the mask is one. All other bits are zero.</p>

<p>In a NUMA multiprocessor architecture, a node is a collection of processors that share fast access to a region of memory. Memory access is non-uniform because a processor can access the memory in its node faster than it can access the memory in other nodes.</p>

<p>The number of processors in a node cannot exceed the number of bits in the affinity mask in the structure that is pointed to by <em>Affinity</em>. The affinity mask also determines the maximum number of processors in a group.</p>

<p>In Windows 10, version 2004 and earlier versions, if during system initialization, Windows encounters a NUMA hardware node that contains more logical processors than will fit into a group, Windows splits the node into smaller, logical nodes. Each of these nodes does not exceed the maximum group size. The <em>NodeNumber</em> parameter identifies a logical node. To obtain the maximum number of processors per group, call the <a href="kequerymaximumprocessorcountex" title="ULONG KeQueryMaximumProcessorCountEx(&#10;  [in] USHORT GroupNumber&#10;);">KeQueryMaximumProcessorCountEx</a> routine.</p>

<h2 id="see-also">See also</h2>

<p><a href="kequerynodeactiveaffinity2" title="NTSTATUS KeQueryNodeActiveAffinity2(&#10;  [in]  USHORT          NodeNumber,&#10;  [out] PGROUP_AFFINITY GroupAffinities,&#10;  [in]  USHORT          GroupAffinitiesCount,&#10;  [out] PUSHORT         GroupAffinitiesRequired&#10;);">KeQueryNodeActiveAffinity2</a></p>

<p><a href="kequerylogicalprocessorrelationship" title="NTSTATUS KeQueryLogicalProcessorRelationship(&#10;  [in, optional]  PPROCESSOR_NUMBER                        ProcessorNumber,&#10;  [in]            LOGICAL_PROCESSOR_RELATIONSHIP           RelationshipType,&#10;  [out, optional] PSYSTEM_LOGICAL_PROCESSOR_INFORMATION_EX Information,&#10;  [in, out]       PULONG                                   Length&#10;);">KeQueryLogicalProcessorRelationship</a></p>

<p><strong><a href="group_affinity" title="typedef struct _GROUP_AFFINITY {&#10;  KAFFINITY Mask;&#10;  USHORT    Group;&#10;  USHORT    Reserved[3];&#10;} GROUP_AFFINITY, *PGROUP_AFFINITY;">GROUP_AFFINITY</a></strong></p>

<p><a href="kequeryhighestnodenumber" title="USHORT KeQueryHighestNodeNumber();">KeQueryHighestNodeNumber</a></p>

<p><a href="kequeryhighestnodenumber" title="USHORT KeQueryHighestNodeNumber();">KeQueryHighestNodeNumber</a></p>

<p><a href="kequerymaximumprocessorcountex" title="ULONG KeQueryMaximumProcessorCountEx(&#10;  [in] USHORT GroupNumber&#10;);">KeQueryMaximumProcessorCountEx</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerynodeactiveaffinity">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-kequerynodeactiveaffinity.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
