<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="VideoPortGetDeviceBase - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>VideoPortGetDeviceBase - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            VideoPortGetDeviceBase - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// video.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VIDEOPORT_DEPRECATED VIDEOPORT_API PVOID VideoPortGetDeviceBase(
  PVOID            HwDeviceExtension,
  <a href="physical_address" title="typedef LARGE_INTEGER PHYSICAL_ADDRESS, *PPHYSICAL_ADDRESS;">PHYSICAL_ADDRESS</a> IoAddress,
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>            NumberOfUchars,
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>            InIoSpace
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nf-video-videoportgetdevicebase">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/videoportgetdevicebase.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-video-videoportgetdevicebase)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>VideoPortGetDeviceBase function</h1>
<h2>Description</h2>
<p>The <strong>VideoPortGetDeviceBase</strong> function maps a range of bus-relative device memory or I/O addresses into system space.</p>
<h2>Parameters</h2>
<h3><code>HwDeviceExtension</code></h3>
<p>Pointer to the miniport driver's device extension.</p>
<h3><code>IoAddress</code></h3>
<p>The base physical address of the range to map. You get this bus-relative value by calling <a href="videoportgetdevicedata" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortGetDeviceData(&#10;  PVOID                          HwDeviceExtension,&#10;  VIDEO_DEVICE_DATA_TYPE         DeviceDataType,&#10;  PMINIPORT_QUERY_DEVICE_ROUTINE CallbackRoutine,&#10;  PVOID                          Context&#10;);">VideoPortGetDeviceData</a>, <a href="videoportgetregistryparameters" title="VIDEOPORT_API VP_STATUS VideoPortGetRegistryParameters(&#10;       PVOID                          HwDeviceExtension,&#10;  [in] PWSTR                          ParameterName,&#10;       UCHAR                          IsParameterFileName,&#10;       PMINIPORT_GET_REGISTRY_ROUTINE GetRegistryRoutine,&#10;       PVOID                          Context&#10;);">VideoPortGetRegistryParameters</a>, or <a href="videoportgetaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortGetAccessRanges(&#10;  PVOID                   HwDeviceExtension,&#10;  ULONG                   NumRequestedResources,&#10;  PIO_RESOURCE_DESCRIPTOR RequestedResources,&#10;  ULONG                   NumAccessRanges,&#10;  PVIDEO_ACCESS_RANGE     AccessRanges,&#10;  PVOID                   VendorId,&#10;  PVOID                   DeviceId,&#10;  PULONG                  Slot&#10;);">VideoPortGetAccessRanges</a>. Otherwise, this value is a driver-supplied, default base address for the device memory or I/O ports.</p>
<p>You must have successfully claimed the range described by <em>IoAddress</em> and <em>NumberOfUchars</em> in the registry through a preceding call to <a href="videoportverifyaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortVerifyAccessRanges(&#10;                 PVOID               HwDeviceExtension,&#10;                 ULONG               NumAccessRanges,&#10;  [in, optional] PVIDEO_ACCESS_RANGE AccessRanges&#10;);">VideoPortVerifyAccessRanges</a> or <strong><a href="videoportgetaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortGetAccessRanges(&#10;  PVOID                   HwDeviceExtension,&#10;  ULONG                   NumRequestedResources,&#10;  PIO_RESOURCE_DESCRIPTOR RequestedResources,&#10;  ULONG                   NumAccessRanges,&#10;  PVIDEO_ACCESS_RANGE     AccessRanges,&#10;  PVOID                   VendorId,&#10;  PVOID                   DeviceId,&#10;  PULONG                  Slot&#10;);">VideoPortGetAccessRanges</a></strong>.</p>
<h3><code>NumberOfUchars</code></h3>
<p>The number of bytes, starting at <em>IoAddress</em>, to map.</p>
<h3><code>InIoSpace</code></h3>
<p>The location of the <em>IoAddress</em> range. This parameter can be one of the following flags or an ORed, compatible combination of these flags.</p>
<table>
<thead>
<tr>
<th style="text-align:left;"><strong>Flag</strong></th>
<th style="text-align:left;"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">VIDEO_MEMORY_SPACE_DENSE</td>
<td style="text-align:left;">Obsolete.</td>
</tr>
<tr>
<td style="text-align:left;">VIDEO_MEMORY_SPACE_IO</td>
<td style="text-align:left;">The address range is in I/O space, not in memory space.</td>
</tr>
<tr>
<td style="text-align:left;">VIDEO_MEMORY_SPACE_MEMORY</td>
<td style="text-align:left;">The address range is in memory space, not in I/O space.</td>
</tr>
<tr>
<td style="text-align:left;">VIDEO_MEMORY_SPACE_P6CACHE</td>
<td style="text-align:left;">The processor aggregates a sequence of write operations, sends them to a cache line, and later flushes the cache. This flag is meaningful only when VIDEO_MEMORY_SPACE_IO is not set. Designates the video memory as write-combined (WC). For information about WC caching, see the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/design/dn642116(v=vs.85)">Write-Combining Memory in Video Miniport Drivers</a> website article.</td>
</tr>
</tbody>
</table>
<h2>Return value</h2>
<p>If successful, <strong>VideoPortGetDeviceBase</strong> returns the base virtual address of the mapping. If the specified bus-relative range cannot be mapped, <strong>VideoPortGetDeviceBase</strong> returns <strong>NULL</strong>.</p>
<h2>Remarks</h2>
<p>You can pass the mapped virtual addresses to the <strong>VideoPortRead</strong><em>Xxx</em>, <strong>VideoPortWrite</strong><em>Xxx</em>, and <strong>VideoPort</strong><em>Xxx</em><strong>Memory</strong> functions, except for <a href="videoportmapmemory" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortMapMemory(&#10;  PVOID            HwDeviceExtension,&#10;  PHYSICAL_ADDRESS PhysicalAddress,&#10;  PULONG           Length,&#10;  PULONG           InIoSpace,&#10;  PVOID            *VirtualAddress&#10;);">VideoPortMapMemory</a> and <a href="videoportunmapmemory" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortUnmapMemory(&#10;  PVOID  HwDeviceExtension,&#10;  PVOID  VirtualAddress,&#10;  HANDLE ProcessHandle&#10;);">VideoPortUnmapMemory</a>.</p>
<p>You must call <strong>VideoPortGetDeviceBase</strong> from the miniport driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_query_device_routine">HwVidQueryDeviceCallback</a>, or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_get_registry_routine">HwVidQueryNamedValueCallback</a> function.</p>
<p>Before <em>HwVidFindAdapter</em> returns control, you should store both the mapped base address returned by <strong>VideoPortGetDeviceBase</strong> and the length of the mapped access range in the adapter's device extension (pointed to by <em>HwDeviceExtension</em>) for later use.</p>
<p>Access to the mapped address space must follow these rules:</p>
<ul>
<li>
If <em>InIoSpace</em> is VIDEO_MEMORY_SPACE_IO, which indicates that the address is in I/O space, the virtual address that this function returns should be passed to the <strong>VideoPortReadPort</strong><em>Xxx</em>, <strong>VideoPortWritePort</strong><em>Xxx</em>, <strong>VideoPortReadPortBuffer</strong><em>Xxx</em>, and <strong>VideoPortWritePortBuffer</strong><em>Xxx</em> functions, where <em>Xxx</em> is <strong>Uchar</strong>, <strong>Ushort</strong>, or <strong>Ulong</strong>.
</li>
<li>
If <em>InIoSpace</em> is VIDEO_MEMORY_SPACE_MEMORY, which indicates that the address is not in I/O space but in memory space, the virtual address that this function returns should be passed to the <strong>VideoPortReadRegister</strong><em>Xxx</em>, <strong>VideoPortWriteRegister</strong><em>Xxx</em>, <strong>VideoPortReadRegisterBuffer</strong><em>Xxx</em>, and <strong>VideoPortWriteRegisterBuffer</strong><em>Xxx</em> functions, where <em>Xxx</em> is <strong>Uchar</strong>, <strong>Ushort</strong>, or <strong>Ulong</strong>.
</li>
<li>
The driver must not access addresses that are outside the range delimited by <em>NumberOfUchars</em>.
</li>
</ul>
<p><strong>VideoPortGetDeviceBase</strong> and <a href="videoportmapmemory" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortMapMemory(&#10;  PVOID            HwDeviceExtension,&#10;  PHYSICAL_ADDRESS PhysicalAddress,&#10;  PULONG           Length,&#10;  PULONG           InIoSpace,&#10;  PVOID            *VirtualAddress&#10;);">VideoPortMapMemory</a> can both be called by the video miniport driver to map video memory into a virtual address space. If you call both of these functions to map the same physical addresses, or if you call one of the functions more than once to map the same physical addresses, you might have more than one virtual-address range that maps to the same physical-address range. In that case, you must set the VIDEO_MEMORY_SPACE_P6CACHE flag of the <em>InIoSpace</em> parameter to the same value in all of those calls.</p>
<p>Every universal memory architecture (UMA) display device uses a frame buffer that is located in main memory rather than on a PCI bus. In this case, do not call <strong><a href="videoportmapmemory" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortMapMemory(&#10;  PVOID            HwDeviceExtension,&#10;  PHYSICAL_ADDRESS PhysicalAddress,&#10;  PULONG           Length,&#10;  PULONG           InIoSpace,&#10;  PVOID            *VirtualAddress&#10;);">VideoPortMapMemory</a></strong> to map the frame buffer. To map a UMA frame buffer into system space, call <a href="mmmapiospace" title="PVOID MmMapIoSpace(&#10;  [in] PHYSICAL_ADDRESS    PhysicalAddress,&#10;  [in] SIZE_T              NumberOfBytes,&#10;  [in] MEMORY_CACHING_TYPE CacheType&#10;);">MmMapIoSpace</a>.</p>
<p>If a miniport driver does not support an adapter that it has mapped a logical range for, it must perform two steps before it returns control to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver">DriverEntry</a> function: call <a href="videoportfreedevicebase" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VOID VideoPortFreeDeviceBase(&#10;  PVOID HwDeviceExtension,&#10;  PVOID MappedAddress&#10;);">VideoPortFreeDeviceBase</a> to unmap the previously mapped range from system space, and call <a href="videoportgetaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortGetAccessRanges(&#10;  PVOID                   HwDeviceExtension,&#10;  ULONG                   NumRequestedResources,&#10;  PIO_RESOURCE_DESCRIPTOR RequestedResources,&#10;  ULONG                   NumAccessRanges,&#10;  PVIDEO_ACCESS_RANGE     AccessRanges,&#10;  PVOID                   VendorId,&#10;  PVOID                   DeviceId,&#10;  PULONG                  Slot&#10;);">VideoPortGetAccessRanges</a> or <a href="videoportverifyaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortVerifyAccessRanges(&#10;                 PVOID               HwDeviceExtension,&#10;                 ULONG               NumAccessRanges,&#10;  [in, optional] PVIDEO_ACCESS_RANGE AccessRanges&#10;);">VideoPortVerifyAccessRanges</a> to release its claims on the range in the registry.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pvideo_hw_find_adapter">HwVidFindAdapter</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_query_device_routine">HwVidQueryDeviceCallback</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nc-video-pminiport_get_registry_routine">HwVidQueryNamedValueCallback</a></p>
<p><a href="videoportcomparememory" title="VIDEOPORT_API ULONG VideoPortCompareMemory(&#10;  PVOID  Source1,&#10;  PVOID  Source2,&#10;  SIZE_T Length&#10;);">VideoPortCompareMemory</a></p>
<p><a href="videoportfreedevicebase" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VOID VideoPortFreeDeviceBase(&#10;  PVOID HwDeviceExtension,&#10;  PVOID MappedAddress&#10;);">VideoPortFreeDeviceBase</a></p>
<p><a href="videoportgetaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortGetAccessRanges(&#10;  PVOID                   HwDeviceExtension,&#10;  ULONG                   NumRequestedResources,&#10;  PIO_RESOURCE_DESCRIPTOR RequestedResources,&#10;  ULONG                   NumAccessRanges,&#10;  PVIDEO_ACCESS_RANGE     AccessRanges,&#10;  PVOID                   VendorId,&#10;  PVOID                   DeviceId,&#10;  PULONG                  Slot&#10;);">VideoPortGetAccessRanges</a></p>
<p><a href="videoportgetdevicedata" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortGetDeviceData(&#10;  PVOID                          HwDeviceExtension,&#10;  VIDEO_DEVICE_DATA_TYPE         DeviceDataType,&#10;  PMINIPORT_QUERY_DEVICE_ROUTINE CallbackRoutine,&#10;  PVOID                          Context&#10;);">VideoPortGetDeviceData</a></p>
<p><a href="videoportgetregistryparameters" title="VIDEOPORT_API VP_STATUS VideoPortGetRegistryParameters(&#10;       PVOID                          HwDeviceExtension,&#10;  [in] PWSTR                          ParameterName,&#10;       UCHAR                          IsParameterFileName,&#10;       PMINIPORT_GET_REGISTRY_ROUTINE GetRegistryRoutine,&#10;       PVOID                          Context&#10;);">VideoPortGetRegistryParameters</a></p>
<p><a href="videoportmovememory" title="VIDEOPORT_API VOID VideoPortMoveMemory(&#10;  [in, out] PVOID Destination,&#10;  [in, out] PVOID Source,&#10;            ULONG Length&#10;);">VideoPortMoveMemory</a></p>
<p><a href="videoportverifyaccessranges" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VP_STATUS VideoPortVerifyAccessRanges(&#10;                 PVOID               HwDeviceExtension,&#10;                 ULONG               NumAccessRanges,&#10;  [in, optional] PVIDEO_ACCESS_RANGE AccessRanges&#10;);">VideoPortVerifyAccessRanges</a></p>
<p><a href="videoportzerodevicememory" title="VIDEOPORT_DEPRECATED VIDEOPORT_API VOID VideoPortZeroDeviceMemory(&#10;  [out] PVOID Destination,&#10;        ULONG Length&#10;);">VideoPortZeroDeviceMemory</a></p>
<p><a href="videoportzeromemory" title="VIDEOPORT_API VOID VideoPortZeroMemory(&#10;  [out] PVOID Destination,&#10;        ULONG Length&#10;);">VideoPortZeroMemory</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/video/nf-video-videoportgetdevicebase">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/video/nf-video-videoportgetdevicebase.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
