<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="MINIPORT_RESET - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MINIPORT_RESET - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            MINIPORT_RESET - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">MINIPORT_RESET MiniportReset;

NDIS_STATUS MiniportReset(
  [in]  NDIS_HANDLE MiniportAdapterContext,
  [out] PBOOLEAN AddressingReset
)
{...}</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_reset">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/miniport_reset.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-ndis-miniport_reset)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="miniport_reset-callback-function">MINIPORT_RESET callback function</h1>

<h2 id="description">Description</h2>

<blockquote>
  <p>[!WARNING]
  The <em>MiniportResetEx</em> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_check_for_hang"><em>MiniportCheckForHangEx</em></a> callback functions are discouraged for all NDIS 6.83 and later drivers. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/miniport-adapter-check-for-hang-and-reset-operations#check-for-hang-and-reset-operations-in-ndis-683-and-later">Check-for-Hang and Reset operations in NDIS 6.83 and later</a>.</p>
</blockquote>

<p>NDIS calls an NDIS miniport driver's
<em>MiniportResetEx</em> function to initiate a reset of a network interface card (NIC). For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/miniport-adapter-check-for-hang-and-reset-operations">Miniport Adapter Check-for-Hang and Reset Operations</a> and <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/hardware-reset">Miniport Driver Hardware Reset</a>.</p>

<p><strong>Note</strong> An NDIS miniport driver may declare this function by using the <strong>MINIPORT_RESET</strong> type.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="miniportadaptercontext-in"><code>MiniportAdapterContext</code> [in]</h3>

<p>A handle to a context area that the miniport driver allocated in its
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a> function.
The miniport driver uses this context area to maintain state information for a miniport adapter.</p>

<h3 id="addressingreset-out"><code>AddressingReset</code> [out]</h3>

<p>A pointer to a Boolean variable. The miniport driver sets this variable to <strong>TRUE</strong> if NDIS should call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_oid_request">MiniportOidRequest</a> function to
restore addressing and other configuration settings to the current values. For more information, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff546572(v=vs.85)">Hardware Reset</a>.</p>

<h2 id="return-value">Return value</h2>

<p><em>MiniportResetEx</em> can return one of the following status values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>NDIS_STATUS_SUCCESS</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_reset">MiniportResetEx</a> successfully reset the miniport adapter to an operational state.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_PENDING</strong></td>
  <td>The driver will complete the reset operation asynchronously by calling the <a href="ndismresetcomplete" title="void NdisMResetComplete(&#10;  _M,&#10;  _S,&#10;  _A&#10;);">NdisMResetComplete</a> function when the operation is done.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_RESET_IN_PROGRESS</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_reset">MiniportResetEx</a> determined that the miniport adapter was currently being reset, so this call is superfluous.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_SOFT_ERRORS</strong></td>
  <td><em>MiniportResetEx</em> successfully reset the miniport adapter but a recoverable error occurred during the operation. <em>MiniportResetEx</em> should have called the <a href="ndiswriteerrorlogentry" title="VOID NdisWriteErrorLogEntry(&#10;  [in] NDIS_HANDLE     NdisAdapterHandle,&#10;  [in] NDIS_ERROR_CODE ErrorCode,&#10;  [in] ULONG           NumberOfErrorValues,&#10;       ...             &#10;);">NdisWriteErrorLogEntry</a> function with more information about the error.</td>
</tr>
<tr>
  <td><strong>NDIS_STATUS_HARD_ERRORS</strong></td>
  <td><em>MiniportResetEx</em> tried to reset the miniport adapter but an unrecoverable error occurred during the operation. <em>MiniportResetEx</em> should have called <strong><a href="ndiswriteerrorlogentry" title="VOID NdisWriteErrorLogEntry(&#10;  [in] NDIS_HANDLE     NdisAdapterHandle,&#10;  [in] NDIS_ERROR_CODE ErrorCode,&#10;  [in] ULONG           NumberOfErrorValues,&#10;       ...             &#10;);">NdisWriteErrorLogEntry</a></strong> with more information about the error.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>A driver specifies the
<em>MiniportResetEx</em> entry point when it calls the
<a href="ndismregisterminiportdriver" title="NDIS_STATUS NdisMRegisterMiniportDriver(&#10;  [in]           PDRIVER_OBJECT                        DriverObject,&#10;  [in]           PUNICODE_STRING                       RegistryPath,&#10;  [in, optional] NDIS_HANDLE                           MiniportDriverContext,&#10;  [in]           PNDIS_MINIPORT_DRIVER_CHARACTERISTICS MiniportDriverCharacteristics,&#10;  [out]          PNDIS_HANDLE                          NdisMiniportDriverHandle&#10;);">NdisMRegisterMiniportDriver</a> function.</p>

<p><em>MiniportResetEx</em> is not required for intermediate drivers.</p>

<p><em>MiniportResetEx</em> can reset the parameters of the miniport adapter. If a reset causes a change in the
miniport adapter's station address, the miniport driver automatically restores the prior value of the
station address after the reset is complete. Any multicast or functional addressing masks, reset by the
hardware, do not have to be reset in this function.</p>

<p>If a reset operation changes other information, such as multicast or functional addressing
information,
<em>MiniportResetEx</em> must set the variable at
<em>AddressingReset</em> to <strong>TRUE</strong> before it returns. This causes NDIS to call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_oid_request">MiniportOidRequest</a> function to
restore the information. NDIS also restores the Wake on the LAN (WoL) pattern list by calling
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/oid-pnp-add-wake-up-pattern">OID_PNP_ADD_WAKE_UP_PATTERN</a>. The
driver should free the WoL pattern list from its adapter context because the hardware list is already
reset.</p>

<p>NDIS will not abort any pending OID requests or send requests. If the driver can safely complete
pending OID or send requests after a reset, the driver can hold pending OID or send requests until after
the reset operation is complete. Otherwise, the driver should complete the pending OID or send requests
by calling the
<a href="ndismoidrequestcomplete" title="VOID NdisMOidRequestComplete(&#10;  [in] NDIS_HANDLE       MiniportAdapterHandle,&#10;  [in] PNDIS_OID_REQUEST OidRequest,&#10;  [in] NDIS_STATUS       Status&#10;);">NdisMOidRequestComplete</a> or
<a href="ndismsendnetbufferlistscomplete" title="VOID NdisMSendNetBufferListsComplete(&#10;  [in] NDIS_HANDLE      MiniportAdapterHandle,&#10;       PNET_BUFFER_LIST NetBufferList,&#10;  [in] ULONG            SendCompleteFlags&#10;);">NdisMSendNetBufferListsComplete</a> functions respectively before
<em>MiniportResetEx</em> returns.</p>

<p><strong>Note</strong> Starting with NDIS 6.30, the miniport driver must not hold pending OID or send requests until after
the reset operation is complete. Instead, the driver must complete these pending requests
by calling the
<a href="ndismoidrequestcomplete" title="VOID NdisMOidRequestComplete(&#10;  [in] NDIS_HANDLE       MiniportAdapterHandle,&#10;  [in] PNDIS_OID_REQUEST OidRequest,&#10;  [in] NDIS_STATUS       Status&#10;);">NdisMOidRequestComplete</a> or
<a href="ndismsendnetbufferlistscomplete" title="VOID NdisMSendNetBufferListsComplete(&#10;  [in] NDIS_HANDLE      MiniportAdapterHandle,&#10;       PNET_BUFFER_LIST NetBufferList,&#10;  [in] ULONG            SendCompleteFlags&#10;);">NdisMSendNetBufferListsComplete</a> functions respectively before
the reset operation is complete. If the driver completes the reset operation asynchronously, it must complete pending OID and send requests before the driver calls <a href="ndismresetcomplete" title="void NdisMResetComplete(&#10;  _M,&#10;  _S,&#10;  _A&#10;);">NdisMResetComplete</a>.</p>

<p>A miniport driver should not call the
<a href="ndismindicatestatusex" title="VOID NdisMIndicateStatusEx(&#10;  [in] NDIS_HANDLE             MiniportAdapterHandle,&#10;  [in] PNDIS_STATUS_INDICATION StatusIndication&#10;);">NdisMIndicateStatusEx</a> function to
signal the start and finish of each reset operation. NDIS notifies bound protocol drivers when a reset
begins and ends.</p>

<p>If
<em>MiniportResetEx</em> must wait for state changes in the miniport adapter during reset operations, it can
call the
<a href="ndisstallexecution" title="void NdisStallExecution(&#10;  MicroSecondsToStall&#10;);">NdisStallExecution</a> function. However, a
<em>MiniportResetEx</em> function must not call
<strong><a href="ndisstallexecution" title="void NdisStallExecution(&#10;  MicroSecondsToStall&#10;);">NdisStallExecution</a></strong> with a time interval larger than 50 microseconds. If the driver must wait longer
than 50 microseconds (or if would poll), it should set a timer instead and return
NDIS_STATUS_PENDING.</p>

<p>If
<em>MiniportResetEx</em> returns NDIS_STATUS_PENDING, the driver must complete the reset by calling the
<a href="ndismresetcomplete" title="void NdisMResetComplete(&#10;  _M,&#10;  _S,&#10;  _A&#10;);">NdisMResetComplete</a> function.</p>

<p>If a miniport adapter is in the
<strong>MediaConnectStateConnected</strong> state and its state changes because of a reset, including a change to
the
<strong>MediaConnectStateUnknown</strong> state, the miniport driver must report the state change with an
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-link-state">NDIS_STATUS_LINK_STATE</a> status
indication. The miniport driver must also indicate a
<strong>MediaConnectStateConnected</strong> status indication when the link is reestablished after the reset.</p>

<p><em>MiniportResetEx</em> can be preempted by an interrupt.</p>

<p>NDIS calls the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_check_for_hang">MiniportCheckForHangEx</a> function
periodically to determine whether it should call
<em>MiniportResetEx</em>. The default time-out for calling
<em>MiniportCheckForHangEx</em> is 2 seconds. If this default is too short, a miniport driver can set a larger <strong>CheckForHangTimeInSeconds</strong> value when calling the
<a href="ndismsetminiportattributes" title="NDIS_STATUS NdisMSetMiniportAttributes(&#10;       NDIS_HANDLE                       NdisMiniportHandle,&#10;  [in] PNDIS_MINIPORT_ADAPTER_ATTRIBUTES MiniportAttributes&#10;);">NdisMSetMiniportAttributes</a> function during initialization. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/miniport-adapter-check-for-hang-and-reset-operations">Miniport Adapter Check-for-Hang and Reset Operations</a>.</p>

<p>NDIS cannot determine whether a NIC has stopped responding for receive operations. To handle this kind
of failure, the
<em>MiniportCheckForHangEx</em> function can monitor receive operations and, if necessary, return <strong>TRUE</strong> to
force a reset. A miniport can also request a reset by calling <a href="ndismresetminiport" title="VOID NdisMResetMiniport(&#10;  [in] NDIS_HANDLE MiniportAdapterHandle&#10;);">NdisMResetMiniport</a>.</p>

<p>NDIS calls
<em>MiniportResetEx</em> at IRQL &lt;= DISPATCH_LEVEL.</p>

<h3 id="examples">Examples</h3>

<p>To define a <em>MiniportResetEx</em> function, you must first provide a function declaration that identifies the type of function you're defining. Windows provides a set of function types for drivers. Declaring a function using the function types helps <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/code-analysis-for-drivers">Code Analysis for Drivers</a>, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/static-driver-verifier">Static Driver Verifier</a> (SDV), and other verification tools find errors, and it's a requirement for writing drivers for the Windows operating system.</p>

<p>For example, to define a <em>MiniportResetEx</em> function that is named "MyResetEx", use the <strong>MINIPORT_RESET</strong> type as shown in this code example:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>MINIPORT_RESET MyResetEx;
</code></pre>

<p>Then, implement your function as follows:</p>

<p><!-- CODE_MARKER --></p>

<pre><code>_Use_decl_annotations_
NDIS_STATUS
 MyResetEx(
    NDIS_HANDLE  MiniportAdapterContext,
    PBOOLEAN  AddressingReset
    )
  {...}
</code></pre>

<p>The <strong>MINIPORT_RESET</strong> function type is defined in the Ndis.h header file. To more accurately identify errors when you run the code analysis tools, be sure to add the _Use_decl_annotations_ annotation to your function definition. The _Use_decl_annotations_ annotation ensures that the annotations that are applied to the <strong>MINIPORT_RESET</strong> function type in the header file are used. For more information about the requirements for function declarations, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/declaring-functions-by-using-function-role-types-for-ndis-drivers">Declaring Functions by Using Function Role Types for NDIS Drivers</a>.</p>

<p>For information about _Use_decl_annotations_, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/visualstudio/code-quality/annotating-function-behavior">Annotating Function Behavior</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/miniport-adapter-check-for-hang-and-reset-operations">Miniport Adapter Check-for-Hang and Reset Operations</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/hardware-reset">Miniport Driver Hardware Reset</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_check_for_hang">MiniportCheckForHangEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_oid_request">MiniportOidRequest</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/ndis-status-link-state">NDIS_STATUS_LINK_STATE</a></p>

<p><a href="ndismindicatestatusex" title="VOID NdisMIndicateStatusEx(&#10;  [in] NDIS_HANDLE             MiniportAdapterHandle,&#10;  [in] PNDIS_STATUS_INDICATION StatusIndication&#10;);">NdisMIndicateStatusEx</a></p>

<p><a href="ndismoidrequestcomplete" title="VOID NdisMOidRequestComplete(&#10;  [in] NDIS_HANDLE       MiniportAdapterHandle,&#10;  [in] PNDIS_OID_REQUEST OidRequest,&#10;  [in] NDIS_STATUS       Status&#10;);">NdisMOidRequestComplete</a></p>

<p><a href="ndismregisterminiportdriver" title="NDIS_STATUS NdisMRegisterMiniportDriver(&#10;  [in]           PDRIVER_OBJECT                        DriverObject,&#10;  [in]           PUNICODE_STRING                       RegistryPath,&#10;  [in, optional] NDIS_HANDLE                           MiniportDriverContext,&#10;  [in]           PNDIS_MINIPORT_DRIVER_CHARACTERISTICS MiniportDriverCharacteristics,&#10;  [out]          PNDIS_HANDLE                          NdisMiniportDriverHandle&#10;);">NdisMRegisterMiniportDriver</a></p>

<p><a href="ndismresetcomplete" title="void NdisMResetComplete(&#10;  _M,&#10;  _S,&#10;  _A&#10;);">NdisMResetComplete</a></p>

<p><a href="ndismresetminiport" title="VOID NdisMResetMiniport(&#10;  [in] NDIS_HANDLE MiniportAdapterHandle&#10;);">NdisMResetMiniport</a></p>

<p><a href="ndismsendnetbufferlistscomplete" title="VOID NdisMSendNetBufferListsComplete(&#10;  [in] NDIS_HANDLE      MiniportAdapterHandle,&#10;       PNET_BUFFER_LIST NetBufferList,&#10;  [in] ULONG            SendCompleteFlags&#10;);">NdisMSendNetBufferListsComplete</a></p>

<p><a href="ndismsetminiportattributes" title="NDIS_STATUS NdisMSetMiniportAttributes(&#10;       NDIS_HANDLE                       NdisMiniportHandle,&#10;  [in] PNDIS_MINIPORT_ADAPTER_ATTRIBUTES MiniportAttributes&#10;);">NdisMSetMiniportAttributes</a></p>

<p><a href="ndisstallexecution" title="void NdisStallExecution(&#10;  MicroSecondsToStall&#10;);">NdisStallExecution</a></p>

<p><a href="ndiswriteerrorlogentry" title="VOID NdisWriteErrorLogEntry(&#10;  [in] NDIS_HANDLE     NdisAdapterHandle,&#10;  [in] NDIS_ERROR_CODE ErrorCode,&#10;  [in] ULONG           NumberOfErrorValues,&#10;       ...             &#10;);">NdisWriteErrorLogEntry</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_reset">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nc-ndis-miniport_reset.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
