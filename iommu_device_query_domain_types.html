<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOMMU_DEVICE_QUERY_DOMAIN_TYPES - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOMMU_DEVICE_QUERY_DOMAIN_TYPES - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOMMU_DEVICE_QUERY_DOMAIN_TYPES - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">IOMMU_DEVICE_QUERY_DOMAIN_TYPES IommuDeviceQueryDomainTypes;

VOID IommuDeviceQueryDomainTypes(
  PIOMMU_DMA_DEVICE DmaDevice,
  PULONG AvailableDomains
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-iommu_device_query_domain_types">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/iommu_device_query_domain_types.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-wdm-iommu_device_query_domain_types)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>Queries for the available types of domains that an <strong>IOMMU_DMA_DEVICE</strong> is allowed to attach to, depending on environment factors, such as platform and DMA Guard Policy.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="dmadevice"><code>DmaDevice</code></h3>

<p>[*In*] A pointer to an opaque token representing the <strong>IOMMU_DMA_DEVICE</strong>.</p>

<h3 id="availabledomains"><code>AvailableDomains</code></h3>

<p>[*Out*] Returns the current domain types that are available to be created and attached to. Each set bit represents an available domain type: <code>(1 &lt;&lt; <a href="iommu_dma_domain_type" title="typedef enum _IOMMU_DMA_DOMAIN_TYPE {&#10;  DomainTypeTranslate,&#10;  DomainTypePassThrough,&#10;  DomainTypeUnmanaged,&#10;  DomainTypeTranslateS1,&#10;  DomainTypeMax&#10;} IOMMU_DMA_DOMAIN_TYPE, *PIOMMU_DMA_DOMAIN_TYPE;">IOMMU_DMA_DOMAIN_TYPE</a>)</code>. See <strong><a href="iommu_dma_domain_type" title="typedef enum _IOMMU_DMA_DOMAIN_TYPE {&#10;  DomainTypeTranslate,&#10;  DomainTypePassThrough,&#10;  DomainTypeUnmanaged,&#10;  DomainTypeTranslateS1,&#10;  DomainTypeMax&#10;} IOMMU_DMA_DOMAIN_TYPE, *PIOMMU_DMA_DOMAIN_TYPE;">IOMMU_DMA_DOMAIN_TYPE</a></strong>.</p>

<h2 id="remarks">Remarks</h2>

<p>This can be used as a hint as to whether <strong><a href="iommu_domain_attach_device_ex" title="IOMMU_DOMAIN_ATTACH_DEVICE_EX IommuDomainAttachDeviceEx;&#10;&#10;NTSTATUS IommuDomainAttachDeviceEx(&#10;  PIOMMU_DMA_DOMAIN Domain,&#10;  PIOMMU_DMA_DEVICE DmaDevice&#10;)&#10;{...}">IOMMU_DOMAIN_ATTACH_DEVICE_EX</a></strong> will succeed.</p>

<p>If a device is not behind a DMA remapping compatible IOMMU, then no remapping domain will be available.</p>

<p>If DMA Guard is enabled, then passthrough domains may be available based on policy, i.e. whether the device is opted into DMA remapping, is connected externally, the screen lock state, etc.. If DMA Guard blocking is active, then passthrough domains will not be available and <code>AvailableDomains &amp; (1 &lt;&lt; DomainTypePassThrough)</code> will result in 0.</p>

<p>To be notified of when domain types are available, consider using <strong><a href="iommu_register_interface_state_change_callback" title="IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK IommuRegisterInterfaceStateChangeCallback;&#10;&#10;NTSTATUS IommuRegisterInterfaceStateChangeCallback(&#10;  PIOMMU_INTERFACE_STATE_CHANGE_CALLBACK StateChangeCallback,&#10;  PVOID Context,&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  PIOMMU_INTERFACE_STATE_CHANGE_FIELDS StateFields&#10;)&#10;{...}">IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK</a></strong> to register a notification callback whenever the available domain types change.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="iommu_dma_domain_type" title="typedef enum _IOMMU_DMA_DOMAIN_TYPE {&#10;  DomainTypeTranslate,&#10;  DomainTypePassThrough,&#10;  DomainTypeUnmanaged,&#10;  DomainTypeTranslateS1,&#10;  DomainTypeMax&#10;} IOMMU_DMA_DOMAIN_TYPE, *PIOMMU_DMA_DOMAIN_TYPE;">IOMMU_DMA_DOMAIN_TYPE</a></strong></p>

<p><strong><a href="iommu_domain_attach_device_ex" title="IOMMU_DOMAIN_ATTACH_DEVICE_EX IommuDomainAttachDeviceEx;&#10;&#10;NTSTATUS IommuDomainAttachDeviceEx(&#10;  PIOMMU_DMA_DOMAIN Domain,&#10;  PIOMMU_DMA_DEVICE DmaDevice&#10;)&#10;{...}">IOMMU_DOMAIN_ATTACH_DEVICE_EX</a></strong></p>

<p><strong><a href="iommu_register_interface_state_change_callback" title="IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK IommuRegisterInterfaceStateChangeCallback;&#10;&#10;NTSTATUS IommuRegisterInterfaceStateChangeCallback(&#10;  PIOMMU_INTERFACE_STATE_CHANGE_CALLBACK StateChangeCallback,&#10;  PVOID Context,&#10;  PIOMMU_DMA_DEVICE DmaDevice,&#10;  PIOMMU_INTERFACE_STATE_CHANGE_FIELDS StateFields&#10;)&#10;{...}">IOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK</a></strong></p>

<p><strong><a href="dma_iommu_interface_v2" title="typedef struct _DMA_IOMMU_INTERFACE_V2 {&#10;  PIOMMU_DOMAIN_CREATE_EX                           CreateDomainEx;&#10;  PIOMMU_DOMAIN_DELETE                              DeleteDomain;&#10;  PIOMMU_DOMAIN_ATTACH_DEVICE_EX                    AttachDeviceEx;&#10;  PIOMMU_DOMAIN_DETACH_DEVICE_EX                    DetachDeviceEx;&#10;  PIOMMU_FLUSH_DOMAIN                               FlushDomain;&#10;  PIOMMU_FLUSH_DOMAIN_VA_LIST                       FlushDomainByVaList;&#10;  PIOMMU_QUERY_INPUT_MAPPINGS                       QueryInputMappings;&#10;  PIOMMU_MAP_LOGICAL_RANGE_EX                       MapLogicalRangeEx;&#10;  PIOMMU_UNMAP_LOGICAL_RANGE                        UnmapLogicalRange;&#10;  PIOMMU_MAP_IDENTITY_RANGE_EX                      MapIdentityRangeEx;&#10;  PIOMMU_UNMAP_IDENTITY_RANGE_EX                    UnmapIdentityRangeEx;&#10;  PIOMMU_SET_DEVICE_FAULT_REPORTING_EX              SetDeviceFaultReportingEx;&#10;  PIOMMU_DOMAIN_CONFIGURE                           ConfigureDomain;&#10;  PIOMMU_DEVICE_QUERY_DOMAIN_TYPES                  QueryAvailableDomainTypes;&#10;  PIOMMU_REGISTER_INTERFACE_STATE_CHANGE_CALLBACK   RegisterInterfaceStateChangeCallback;&#10;  PIOMMU_UNREGISTER_INTERFACE_STATE_CHANGE_CALLBACK UnregisterInterfaceStateChangeCallback;&#10;  PIOMMU_RESERVE_LOGICAL_ADDRESS_RANGE              ReserveLogicalAddressRange;&#10;  PIOMMU_FREE_RESERVED_LOGICAL_ADDRESS_RANGE        FreeReservedLogicalAddressRange;&#10;  PIOMMU_MAP_RESERVED_LOGICAL_RANGE                 MapReservedLogicalRange;&#10;...">DMA_IOMMU_INTERFACE_V2</a></strong></p>

<p><strong><a href="dma_iommu_interface_ex" title="typedef struct _DMA_IOMMU_INTERFACE_EX {&#10;  SIZE_T Size;&#10;  ULONG  Version;&#10;  union {&#10;    DMA_IOMMU_INTERFACE_V1 V1;&#10;    DMA_IOMMU_INTERFACE_V2 V2;&#10;    DMA_IOMMU_INTERFACE_V3 V3;&#10;  };&#10;} DMA_IOMMU_INTERFACE_EX, *PDMA_IOMMU_INTERFACE_EX;">DMA_IOMMU_INTERFACE_EX</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nc-wdm-iommu_device_query_domain_types">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nc-wdm-iommu_device_query_domain_types.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
