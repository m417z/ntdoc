<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RxDriverEntry - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RxDriverEntry - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RxDriverEntry - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// rxprocs.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RxDriverEntry(
  [in] IN <a href="driver_object" title="typedef struct _DRIVER_OBJECT {&#10;  CSHORT             Type;&#10;  CSHORT             Size;&#10;  PDEVICE_OBJECT     DeviceObject;&#10;  ULONG              Flags;&#10;  PVOID              DriverStart;&#10;  ULONG              DriverSize;&#10;  PVOID              DriverSection;&#10;  PDRIVER_EXTENSION  DriverExtension;&#10;  UNICODE_STRING     DriverName;&#10;  PUNICODE_STRING    HardwareDatabase;&#10;  PFAST_IO_DISPATCH  FastIoDispatch;&#10;  PDRIVER_INITIALIZE DriverInit;&#10;  PDRIVER_STARTIO    DriverStartIo;&#10;  PDRIVER_UNLOAD     DriverUnload;&#10;  PDRIVER_DISPATCH   MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + 1];&#10;} DRIVER_OBJECT, *PDRIVER_OBJECT;">PDRIVER_OBJECT</a>  DriverObject,
  [in] IN <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> RegistryPath
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/rxprocs/nf-rxprocs-rxdriverentry">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rxdriverentry.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-rxprocs-rxdriverentry)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>RxDriverEntry function</h1>
<h2>Description</h2>
<p><strong>RxDriverEntry</strong> is called by a monolithic network mini-redirector driver from its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver"><strong>DriverEntry</strong></a> routine to initialize the RDBSS static library.</p>
<p>For non-monolithic drivers, this initialization routine is equivalent to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver"><strong>DriverEntry</strong></a> routine of the RDBSS.SYS device driver.</p>
<h2>Parameters</h2>
<h3><code>DriverObject</code> [in]</h3>
<p>A pointer to the driver object of the network mini-redirector driver. Each driver receives a pointer to its driver object in a parameter to its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver"><strong>DriverEntry</strong></a> routine. This driver object will be used to create the device object for the network mini-redirector driver.</p>
<h3><code>RegistryPath</code> [in]</h3>
<p>A pointer to a Unicode string containing the registry path to where driver parameters and other configuration data are stored. This registry path is normally located under a services entry for the specific network mini-redirector located under the <em>HKLM\System\CurrentControlSet\Services</em> key.</p>
<h2>Return value</h2>
<p><strong>RxDriverEntry</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success or one of the following error values on failure:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>RXINIT_START</td>
<td>The initialization of RDBSS was started, but an error occurred. This error code is an internal RDBSS enum with a value of 5.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>A monolithic network mini-redirector driver which is linked statically with RDBSSLIB.LIB must call <strong>RxDriverEntry</strong> from its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver"><strong>DriverEntry</strong></a> routine to initialize the copy of the RDBSSLIB library linked with the driver. <strong>RxDriverEntry</strong> must be called by a monolithic network mini-redirector driver before any other RDBSS routines are called.</p>
<p>After calling <strong>RxDriverEntry</strong> to initialize the copy of the RDBSS library near the start of its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver"><strong>DriverEntry</strong></a> routine, the network mini-redirector driver would usually call <strong><a href="rxregisterminirdr" title="NTSTATUS RxRegisterMinirdr(&#10;  [out]     OUT PRDBSS_DEVICE_OBJECT *DeviceObject,&#10;  [in, out] IN OUT PDRIVER_OBJECT    DriverObject,&#10;  [in]      IN PMINIRDR_DISPATCH     MrdrDispatch,&#10;  [in]      IN ULONG                 Controls,&#10;  [in]      IN PUNICODE_STRING       DeviceName,&#10;  [in]      IN ULONG                 DeviceExtensionSize,&#10;  [in]      IN DEVICE_TYPE           DeviceType,&#10;  [in]      IN ULONG                 DeviceCharacteristics&#10;);">RxRegisterMinirdr</a></strong> later in its <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> routine to register with RDBSS.</p>
<p>If the <strong>RxDriverEntry</strong> call is successful, internal global RDBBS data structures are initialized. Various spinlocks and mutexes are created to protect these data structures. One of these data structures is the RDBSS_DATA structure which is the top structure in the RDBSS-memory data structure. The <strong>DriverObject</strong> parameter is stored in the <strong>DriverObject</strong> member of the RDBSS_DATA structure. <strong>RxDriverEntry</strong> also initializes tracing, logging, and debugging if this is enabled (a checked build, for example).</p>
<p><strong>RxDriverEntry</strong> will also try to open the registry path passed as the <strong>RegistryPath</strong> parameter, treating this object as a case-insensitive string. If this registry key can be successfully opened, then an attempt will be made to open a Parameters registry key below this entry.</p>
<p><strong>RxDriverEntry</strong> will also attempt to open the <em>HKLM\System\CurrentControlSet\Services\LanmanWorkStation\Parameters</em> registry key.</p>
<p>If this key can be opened, then an attempt will be made to read some values under this key depending on the version of the operating system.</p>
<p>On Windows XP and later, <strong>RxDriverEntry</strong> will attempt to open the <em>DisableByteRangeLockingOnReadOnlyFiles</em> value under the <em>LanmanWorkStation\Parameters</em> key.</p>
<p>This value is a <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> that is treated as a boolean and stored as the boolean value for DisableByteRangeLockingOnReadOnlyFiles, an RDBSS variable for handling byte range locking on read only files. This variable affects how RDBSS handles a new SRV_OPEN request by the network mini-redirector on an FCB and decides whether it can be collapsed onto an existing SRV_OPEN if the attributes are compatible. If a network mini-redirector driver wants to change this behavior, the driver should set the value of DisableByteRangeLockingOnReadOnlyFiles to the appropriate value after the <strong>RxDriverEntry</strong> routine has returned. The RDBSSLIB.LIB static library exposes DisableByteRangeLockingOnReadOnlyFiles as an external variable.</p>
<p>On Windows 2000 and Windows XP, <strong>RxDriverEntry</strong> will attempt to open the <em>ReadAheadGranularity</em> value under the <em>LanmanWorkStation\Parameters</em> key.</p>
<p>This value is a <a href="dword" title="typedef unsigned long DWORD;">DWORD</a> that is treated as a number and stored as the value for an internal RDBSS option on the number of <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> pages for read ahead used by the Cache Manager. Any registry value greater than 16 is treated as if this value were limited to 16 (the maximum value currently allowed). This internal option is stored as the number of pages times the <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> on the processor (a maximum of 0x10000 or 64K for a 4K <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a>, for example). On Windows 2000 and Windows XP, RDBSS calls <strong><a href="ccsetreadaheadgranularity" title="VOID CcSetReadAheadGranularity(&#10;  [in] PFILE_OBJECT FileObject,&#10;  [in] ULONG        Granularity&#10;);">CcSetReadAheadGranularity</a></strong> with this option for various create, read, and write operations. If a network mini-redirector driver wants to change this behavior, the driver should set the value of ReadAheadGranularity to the appropriate value after the <strong>RxDriverEntry</strong> routine has returned. The RDBSSLIB.LIB static library exposes ReadAheadGranularity as an external variable.</p>
<p>On X86 systems, 64K is the largest write that will be issued by the Memory Manager when issuing a paging write (flushes of the cache will be paging writes through the Memory Manager). For remote file systems, 64K is not the best choice. The most data that can be transferred in a single TDI network request would be less than 64K because of overhead for protocol information.</p>
<p>On Windows Server 2003, a registry value to set ReadAheadGranularity is not exposed and RDBSS defaults to 32K (8 4K <a href="page_size" title="#define PAGE_SIZE 0x1000">PAGE_SIZE</a> pages). This is the same default value adopted for local files systems.</p>
<p><strong>RxDriverEntry</strong> retrieves a pointer to the kernel process that is running by calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/mm-bad-pointer#psgetcurrentprocess">PsGetCurrentProcess</a> and stores this value in an internal RDBSS data structure. This kernel process is sometimes called the file system process.</p>
<p><strong>RxDriverEntry</strong> then copies a pointer to the <strong><a href="rxfsddispatch" title="NTSTATUS RxFsdDispatch(&#10;  [in] IN PRDBSS_DEVICE_OBJECT RxDeviceObject,&#10;  [in] IN PIRP                 Irp&#10;);">RxFsdDispatch</a></strong> routine over all of the entries in the driver dispatch table. So if a monolithic network mini-redirector driver needs to receive specific IRPs for special processing before the RDBSS library, then a copy of its original driver dispatch table should be saved before calling <strong>RxDriverEntry</strong> and any routine pointers restored after the call to <strong>RxDriverEntry</strong> has returned. Note that RDBSS will also copy <strong><a href="rxfsddispatch" title="NTSTATUS RxFsdDispatch(&#10;  [in] IN PRDBSS_DEVICE_OBJECT RxDeviceObject,&#10;  [in] IN PIRP                 Irp&#10;);">RxFsdDispatch</a></strong> to all the driver dispatch table entries when <strong><a href="rxregisterminirdr" title="NTSTATUS RxRegisterMinirdr(&#10;  [out]     OUT PRDBSS_DEVICE_OBJECT *DeviceObject,&#10;  [in, out] IN OUT PDRIVER_OBJECT    DriverObject,&#10;  [in]      IN PMINIRDR_DISPATCH     MrdrDispatch,&#10;  [in]      IN ULONG                 Controls,&#10;  [in]      IN PUNICODE_STRING       DeviceName,&#10;  [in]      IN ULONG                 DeviceExtensionSize,&#10;  [in]      IN DEVICE_TYPE           DeviceType,&#10;  [in]      IN ULONG                 DeviceCharacteristics&#10;);">RxRegisterMinirdr</a></strong> is called unless an option is set to prevent this behavior.</p>
<p>For a non-monolithic network mini-redirector driver (the Microsoft SMB redirector), the RDBSS.SYS device driver is initialized in its own <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/storage/driverentry-of-ide-controller-minidriver"><strong>DriverEntry</strong></a> routine when loaded which internally calls <strong>RxDriverEntry</strong>. On a monolithic driver, the <strong>RxDriverEntry</strong> routine is exported from the RDBSSLIB.LIB static library and must be called explicitly by the network mini-redirector.</p>
<h2>See also</h2>
<p><strong><a href="ccsetreadaheadgranularity" title="VOID CcSetReadAheadGranularity(&#10;  [in] PFILE_OBJECT FileObject,&#10;  [in] ULONG        Granularity&#10;);">CcSetReadAheadGranularity</a></strong></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddk/nf-ntddk-psgetcurrentprocessid"><strong>PsGetCurrentProcess</strong></a></p>
<p><strong><a href="rxregisterminirdr" title="NTSTATUS RxRegisterMinirdr(&#10;  [out]     OUT PRDBSS_DEVICE_OBJECT *DeviceObject,&#10;  [in, out] IN OUT PDRIVER_OBJECT    DriverObject,&#10;  [in]      IN PMINIRDR_DISPATCH     MrdrDispatch,&#10;  [in]      IN ULONG                 Controls,&#10;  [in]      IN PUNICODE_STRING       DeviceName,&#10;  [in]      IN ULONG                 DeviceExtensionSize,&#10;  [in]      IN DEVICE_TYPE           DeviceType,&#10;  [in]      IN ULONG                 DeviceCharacteristics&#10;);">RxRegisterMinirdr</a></strong></p>
<p><strong><a href="rxsetdomainformailslotbroadcast" title="NTSTATUS RxSetDomainForMailslotBroadcast(&#10;  [in] IN PUNICODE_STRING DomainName&#10;);">RxSetDomainForMailslotBroadcast</a></strong></p>
<p><strong><a href="rxstartminirdr" title="NTSTATUS RxStartMinirdr(&#10;  [in]  IN PRX_CONTEXT RxContext,&#10;  [out] OUT PBOOLEAN   PostToFsp&#10;);">RxStartMinirdr</a></strong></p>
<p><strong><a href="rxstopminirdr" title="NTSTATUS RxStopMinirdr(&#10;  [in]  IN PRX_CONTEXT RxContext,&#10;  [out] OUT PBOOLEAN   PostToFsp&#10;);">RxStopMinirdr</a></strong></p>
<p><strong><a href="rxunregisterminirdr" title="VOID RxUnregisterMinirdr(&#10;  [in] IN PRDBSS_DEVICE_OBJECT RxDeviceObject&#10;);">RxUnregisterMinirdr</a></strong></p>
<p><strong><a href="rxpunregisterminirdr" title="VOID RxpUnregisterMinirdr(&#10;  [in] IN PRDBSS_DEVICE_OBJECT RxDeviceObject&#10;);">RxpUnregisterMinirdr</a></strong></p>
<p><strong><a href="__rxfillandinstallfastiodispatch" title="VOID __RxFillAndInstallFastIoDispatch(&#10;  [in]      IN PRDBSS_DEVICE_OBJECT  RxDeviceObject,&#10;  [in, out] IN OUT PFAST_IO_DISPATCH FastIoDispatch,&#10;  [in]      IN ULONG                 FastIoDispatchSize&#10;);">__RxFillAndInstallFastIoDispatch</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/rxprocs/nf-rxprocs-rxdriverentry">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/rxprocs/nf-rxprocs-rxdriverentry.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
