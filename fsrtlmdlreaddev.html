<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FsRtlMdlReadDev - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FsRtlMdlReadDev - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FsRtlMdlReadDev - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">BOOLEAN FsRtlMdlReadDev(
  [in]             <a href="file_object" title="typedef struct _FILE_OBJECT {&#10;  CSHORT                                Type;&#10;  CSHORT                                Size;&#10;  PDEVICE_OBJECT                        DeviceObject;&#10;  PVPB                                  Vpb;&#10;  PVOID                                 FsContext;&#10;  PVOID                                 FsContext2;&#10;  PSECTION_OBJECT_POINTERS              SectionObjectPointer;&#10;  PVOID                                 PrivateCacheMap;&#10;  NTSTATUS                              FinalStatus;&#10;  struct _FILE_OBJECT                   *RelatedFileObject;&#10;  BOOLEAN                               LockOperation;&#10;  BOOLEAN                               DeletePending;&#10;  BOOLEAN                               ReadAccess;&#10;  BOOLEAN                               WriteAccess;&#10;  BOOLEAN                               DeleteAccess;&#10;  BOOLEAN                               SharedRead;&#10;  BOOLEAN                               SharedWrite;&#10;  BOOLEAN                               SharedDelete;&#10;  ULONG                                 Flags;&#10;...">PFILE_OBJECT</a>     FileObject,
  [in]             PLARGE_INTEGER   FileOffset,
  [in]             <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>            Length,
  [in]             <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>            LockKey,
  [out]            <a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">PMDL</a>             *MdlChain,
  [out]            <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">PIO_STATUS_BLOCK</a> IoStatus,
  [ in, optional ] <a href="device_object" title="typedef struct _DEVICE_OBJECT {&#10;  CSHORT                   Type;&#10;  USHORT                   Size;&#10;  LONG                     ReferenceCount;&#10;  struct _DRIVER_OBJECT    *DriverObject;&#10;  struct _DEVICE_OBJECT    *NextDevice;&#10;  struct _DEVICE_OBJECT    *AttachedDevice;&#10;  struct _IRP              *CurrentIrp;&#10;  PIO_TIMER                Timer;&#10;  ULONG                    Flags;&#10;  ULONG                    Characteristics;&#10;  __volatile PVPB          Vpb;&#10;  PVOID                    DeviceExtension;&#10;  DEVICE_TYPE              DeviceType;&#10;  CCHAR                    StackSize;&#10;  union {&#10;    LIST_ENTRY         ListEntry;&#10;    WAIT_CONTEXT_BLOCK Wcb;&#10;  } Queue;&#10;  ULONG                    AlignmentRequirement;&#10;...">PDEVICE_OBJECT</a>   DeviceObject
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlmdlreaddev">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fsrtlmdlreaddev.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlmdlreaddev)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fsrtlmdlreaddev-function">FsRtlMdlReadDev function</h1>

<h2 id="description">Description</h2>

<p>The <strong>FsRtlMdlReadDev</strong> routine returns a memory descriptor list (<a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a>) that points directly to the specified byte range in the file cache.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="fileobject-in"><code>FileObject</code> [in]</h3>

<p>A pointer to a file object for the cached file.</p>

<h3 id="fileoffset-in"><code>FileOffset</code> [in]</h3>

<p>A pointer to a variable that specifies the starting byte offset within the cached file that holds the data.</p>

<h3 id="length-in"><code>Length</code> [in]</h3>

<p>The length in bytes of the data to read from the cache.</p>

<h3 id="lockkey-in"><code>LockKey</code> [in]</h3>

<p>A value that is associated with the byte range to lock. If the range to lock overlaps another range that is already locked with a nonexclusive lock, or if the range to read is a subrange of another range that is already locked non-exclusively, the value in this parameter must be the key for that nonexclusive lock The lock must be held by the parent process of the calling thread. Otherwise, this parameter has no effect.</p>

<h3 id="mdlchain-out"><code>MdlChain</code> [out]</h3>

<p>On output, a pointer to a linked list of memory descriptor lists (MDLs).</p>

<h3 id="iostatus-out"><code>IoStatus</code> [out]</h3>

<p>A pointer to an <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">IO_STATUS_BLOCK</a> structure that, on output, contains the status of the transfer. If the operation succeeds, <em>IoStatus.Status</em> is set to <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>. Otherwise, it is set to an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> error code. <em>IoStatus.Information</em> is set to the actual number of bytes that the routine successfully locked.</p>

<h3 id="deviceobject-in-optional"><code>DeviceObject</code> [ in, optional ]</h3>

<p>A pointer to a device object on which the file is opened.</p>

<h2 id="return-value">Return value</h2>

<p>The <strong>FsRtlMdlReadDev</strong> routine returns <strong>TRUE</strong> if the operation succeeds and <strong>FALSE</strong> if the operation fails.</p>

<h2 id="remarks">Remarks</h2>

<p>The <strong>FsRtlMdlReadDev</strong> routine bypasses the usual <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> mechanism and returns a linked list of memory descriptor lists (<a href="mdl" title="typedef struct _MDL {&#10;  struct _MDL      *Next;&#10;  CSHORT           Size;&#10;  CSHORT           MdlFlags;&#10;  struct _EPROCESS *Process;&#10;  PVOID            MappedSystemVa;&#10;  PVOID            StartVa;&#10;  ULONG            ByteCount;&#10;  ULONG            ByteOffset;&#10;} MDL, *PMDL;">MDL</a>) that the caller can use to directly access the cached file data. This operation does not copy or buffer data and therefore is much faster than a normal read.</p>

<p>The routine is similar to <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff539159(v=vs.85)">CcMdlRead</a> and <a href="fltfastiomdlread" title="BOOLEAN FLTAPI FltFastIoMdlRead(&#10;        PFLT_INSTANCE    InitiatingInstance,&#10;  [in]  PFILE_OBJECT     FileObject,&#10;  [in]  PLARGE_INTEGER   FileOffset,&#10;  [in]  ULONG            Length,&#10;  [in]  ULONG            LockKey,&#10;  [out] PMDL             *MdlChain,&#10;  [out] PIO_STATUS_BLOCK IoStatus&#10;);">FltFastIoMdlRead</a>. <strong><a href="fltfastiomdlread" title="BOOLEAN FLTAPI FltFastIoMdlRead(&#10;        PFLT_INSTANCE    InitiatingInstance,&#10;  [in]  PFILE_OBJECT     FileObject,&#10;  [in]  PLARGE_INTEGER   FileOffset,&#10;  [in]  ULONG            Length,&#10;  [in]  ULONG            LockKey,&#10;  [out] PMDL             *MdlChain,&#10;  [out] PIO_STATUS_BLOCK IoStatus&#10;);">FltFastIoMdlRead</a></strong>, <strong>CcMdlRead</strong>, and <strong>FsRtlMdlReadDev</strong> lock the pages that contain the cached file data to prevent the system from swapping these pages to the page file. The pages remain locked in memory until the caller invokes the <a href="fsrtlmdlreadcompletedev" title="BOOLEAN FsRtlMdlReadCompleteDev(&#10;  [in]             PFILE_OBJECT   FileObject,&#10;  [in]             PMDL           MdlChain,&#10;  [ in, optional ] PDEVICE_OBJECT DeviceObject&#10;);">FsRtlMdlReadCompleteDev</a> routine.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff539159(v=vs.85)">CcMdlRead</a></p>

<p><a href="fsrtlmdlreadcompletedev" title="BOOLEAN FsRtlMdlReadCompleteDev(&#10;  [in]             PFILE_OBJECT   FileObject,&#10;  [in]             PMDL           MdlChain,&#10;  [ in, optional ] PDEVICE_OBJECT DeviceObject&#10;);">FsRtlMdlReadCompleteDev</a></p>

<p><a href="fsrtlmdlreadex" title="NTSTATUS FsRtlMdlReadEx(&#10;  [in]  PFILE_OBJECT     FileObject,&#10;  [in]  PLARGE_INTEGER   FileOffset,&#10;  [in]  ULONG            Length,&#10;  [in]  ULONG            LockKey,&#10;  [out] PMDL             *MdlChain,&#10;  [out] PIO_STATUS_BLOCK IoStatus&#10;);">FsRtlMdlReadEx</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlmdlreaddev">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-_fsrtl_advanced_fcb_header-fsrtlmdlreaddev.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
