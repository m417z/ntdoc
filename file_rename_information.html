<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FILE_RENAME_INFORMATION - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FILE_RENAME_INFORMATION - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FILE_RENAME_INFORMATION - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTIOAPI_H

</span><span class="ntdoc-code-intro">/**
 * The FILE_RENAME_INFORMATION structure is used to rename a file.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_file_rename_information
 */
</span><span class="ntdoc-code-body">typedef struct _FILE_RENAME_INFORMATION
{
    BOOLEAN ReplaceIfExists;
    HANDLE RootDirectory;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FileNameLength;
    _Field_size_bytes_(FileNameLength) WCHAR FileName[1];
} FILE_RENAME_INFORMATION, *PFILE_RENAME_INFORMATION;
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/d9393a49b3707fc786047a2ca5ae4afefd760b30/phnt/include/ntioapi.h#L611">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _FILE_RENAME_INFORMATION {
#if (_WIN32_WINNT &gt;= _WIN32_WINNT_WIN10_RS1)
    union {
        BOOLEAN ReplaceIfExists;  // FileRenameInformation
        <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags;              // FileRenameInformationEx
    } DUMMYUNIONNAME;
#else
    BOOLEAN ReplaceIfExists;
#endif
    HANDLE RootDirectory;
    <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FileNameLength;
    WCHAR FileName[1];
} FILE_RENAME_INFORMATION, *PFILE_RENAME_INFORMATION;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_file_rename_information">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/file_rename_information.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntifs-_file_rename_information)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>FILE_RENAME_INFORMATION structure</h1>
<h2>Description</h2>
<p>The <strong>FILE_RENAME_INFORMATION</strong> structure is used to rename a file.</p>
<h2>Members</h2>
<h3><code>DUMMYUNIONNAME</code></h3>
<h3><code>DUMMYUNIONNAME.ReplaceIfExists</code></h3>
<p>Set to TRUE to specify that if a file with the given name already exists, it should be replaced with the given file. Set to FALSE if the rename operation should fail if a file with the given name already exists.</p>
<h3><code>DUMMYUNIONNAME.Flags</code></h3>
<p>Flags for the rename operation. This field is only applicable when used with the <strong>FileRenameInformationEx</strong> information class.</p>
<p>Here are the possible values:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><a href="file_rename_replace_if_exists" title="#define FILE_RENAME_REPLACE_IF_EXISTS 0x00000001 // since REDSTONE">FILE_RENAME_REPLACE_IF_EXISTS</a></strong> (0x00000001)</td>
<td>If a file with the given name already exists, it should be replaced with the given file. Equivalent to the ReplaceIfExists field used with the FileRenameInformation information class.</td>
</tr>
<tr>
<td><strong><a href="file_rename_posix_semantics" title="#define FILE_RENAME_POSIX_SEMANTICS 0x00000002">FILE_RENAME_POSIX_SEMANTICS</a></strong> (0x00000002)</td>
<td>If <a href="file_rename_replace_if_exists" title="#define FILE_RENAME_REPLACE_IF_EXISTS 0x00000001 // since REDSTONE">FILE_RENAME_REPLACE_IF_EXISTS</a> is also specified, allow replacing a file even if there are existing handles to it. Existing handles to the replaced file continue to be valid for operations such as read and write. Any subsequent opens of the target name will open the renamed file, not the replaced file.</td>
</tr>
<tr>
<td><strong><a href="file_rename_suppress_pin_state_inheritance" title="#define FILE_RENAME_SUPPRESS_PIN_STATE_INHERITANCE 0x00000004 // since REDSTONE3">FILE_RENAME_SUPPRESS_PIN_STATE_INHERITANCE</a></strong> (0x00000004)</td>
<td>When renaming a file to a new directory, suppress any inheritance rules related to the FILE_ATTRIBUTE_PINNED and FILE_ATTRIBUTE_UNPINNED attributes of the file.</td>
</tr>
<tr>
<td><strong><a href="file_rename_suppress_storage_reserve_inheritance" title="#define FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE 0x00000008 // since REDSTONE5">FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE</a></strong> (0x00000008)</td>
<td>When renaming a file to a new directory, suppress any inheritance rules related to the storage reserve ID property of the file.</td>
</tr>
<tr>
<td><strong><a href="file_rename_no_increase_available_space" title="#define FILE_RENAME_NO_INCREASE_AVAILABLE_SPACE 0x00000010">FILE_RENAME_NO_INCREASE_AVAILABLE_SPACE</a></strong> (0x00000010)</td>
<td>If <a href="file_rename_suppress_storage_reserve_inheritance" title="#define FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE 0x00000008 // since REDSTONE5">FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE</a> is not also specified, when renaming a file to a new directory, automatically resize affected storage reserve areas as needed to prevent the user visible free space on the volume from increasing. Requires manage volume access.</td>
</tr>
<tr>
<td><strong><a href="file_rename_no_decrease_available_space" title="#define FILE_RENAME_NO_DECREASE_AVAILABLE_SPACE 0x00000020">FILE_RENAME_NO_DECREASE_AVAILABLE_SPACE</a></strong> (0x00000020)</td>
<td>If <a href="file_rename_suppress_storage_reserve_inheritance" title="#define FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE 0x00000008 // since REDSTONE5">FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE</a> is not also specified, when renaming a file to a new directory, automatically resize affected storage reserve areas as needed to prevent the user visible free space on the volume from decreasing. Requires manage volume access.</td>
</tr>
<tr>
<td><strong><a href="file_rename_preserve_available_space" title="#define FILE_RENAME_PRESERVE_AVAILABLE_SPACE 0x00000030">FILE_RENAME_PRESERVE_AVAILABLE_SPACE</a></strong> (0x00000030)</td>
<td>Equivalent to specifying both <a href="file_rename_no_increase_available_space" title="#define FILE_RENAME_NO_INCREASE_AVAILABLE_SPACE 0x00000010">FILE_RENAME_NO_INCREASE_AVAILABLE_SPACE</a> and <a href="file_rename_no_decrease_available_space" title="#define FILE_RENAME_NO_DECREASE_AVAILABLE_SPACE 0x00000020">FILE_RENAME_NO_DECREASE_AVAILABLE_SPACE</a>.</td>
</tr>
<tr>
<td><strong><a href="file_rename_ignore_readonly_attribute" title="#define FILE_RENAME_IGNORE_READONLY_ATTRIBUTE 0x00000040">FILE_RENAME_IGNORE_READONLY_ATTRIBUTE</a></strong> (0x00000040)</td>
<td>If <a href="file_rename_replace_if_exists" title="#define FILE_RENAME_REPLACE_IF_EXISTS 0x00000001 // since REDSTONE">FILE_RENAME_REPLACE_IF_EXISTS</a> is also specified, allow replacing a file even if it is read-only. Requires WRITE_ATTRIBUTES access to the replaced file.</td>
</tr>
<tr>
<td><strong><a href="file_rename_force_resize_target_sr" title="#define FILE_RENAME_FORCE_RESIZE_TARGET_SR 0x00000080 // since 19H1">FILE_RENAME_FORCE_RESIZE_TARGET_SR</a></strong> (0x00000080)</td>
<td>If <a href="file_rename_suppress_storage_reserve_inheritance" title="#define FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE 0x00000008 // since REDSTONE5">FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE</a> is not also specified, when renaming a file to a new directory that is part of a different storage reserve area, always grow the target directory's storage reserve area by the full size of the file being renamed. Requires manage volume access.</td>
</tr>
<tr>
<td><strong><a href="file_rename_force_resize_source_sr" title="#define FILE_RENAME_FORCE_RESIZE_SOURCE_SR 0x00000100">FILE_RENAME_FORCE_RESIZE_SOURCE_SR</a></strong> (0x00000100)</td>
<td>If <a href="file_rename_suppress_storage_reserve_inheritance" title="#define FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE 0x00000008 // since REDSTONE5">FILE_RENAME_SUPPRESS_STORAGE_RESERVE_INHERITANCE</a> is not also specified, when renaming a file to a new directory that is part of a different storage reserve area, always shrink the source directory's storage reserve area by the full size of the file being renamed. Requires manage volume access.</td>
</tr>
<tr>
<td><strong><a href="file_rename_force_resize_sr" title="#define FILE_RENAME_FORCE_RESIZE_SR 0x00000180">FILE_RENAME_FORCE_RESIZE_SR</a></strong> (0x00000180)</td>
<td>Equivalent to specifying both <a href="file_rename_force_resize_target_sr" title="#define FILE_RENAME_FORCE_RESIZE_TARGET_SR 0x00000080 // since 19H1">FILE_RENAME_FORCE_RESIZE_TARGET_SR</a> and <a href="file_rename_force_resize_source_sr" title="#define FILE_RENAME_FORCE_RESIZE_SOURCE_SR 0x00000100">FILE_RENAME_FORCE_RESIZE_SOURCE_SR</a>.</td>
</tr>
</tbody>
</table>
<h3><code>ReplaceIfExists</code></h3>
<p>Set to TRUE to specify that if a file with the given name already exists, it should be replaced with the given file. Set to FALSE if the rename operation should fail if a file with the given name already exists.</p>
<h3><code>RootDirectory</code></h3>
<p>A handle that <strong>IopOpenLinkOrRenameTarget</strong> uses to open the target directory.</p>
<p>If the file is not being moved to a different directory, or if the <strong>FileName</strong> member contains the full pathname, this member is NULL. Otherwise, it is a handle for the root directory under which the file will reside after it is renamed.</p>
<p>To perform two open operations that won't cause a sharing conflict, you can open <strong>RootDirectory</strong> by requesting traverse | read-attribute. <strong>IopOpenLinkOrRenameTarget</strong> can then perform a relative open by requesting FILE_WRITE_DATA | SYNCHRONIZE. These two opens would not cause sharing conflict.</p>
<h3><code>FileNameLength</code></h3>
<p>Length, in bytes, of the new name for the file.</p>
<h3><code>FileName</code></h3>
<p>The first character of a wide-character string containing the new name for the file. This is followed in memory by the remainder of the string. If the <strong>RootDirectory</strong> member is NULL, and the file is being moved to a different directory, this member specifies the full pathname to be assigned to the file. Otherwise, it specifies only the file name or a relative pathname.</p>
<h2>Syntax</h2>
<pre><code>typedef struct _FILE_RENAME_INFORMATION {
#if (_WIN32_WINNT &gt;= _WIN32_WINNT_WIN10_RS1)
union {
BOOLEAN ReplaceIfExists;  // FileRenameInformation
<a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags;              // FileRenameInformationEx
} DUMMYUNIONNAME;
#else
BOOLEAN ReplaceIfExists;
#endif
HANDLE RootDirectory;
<a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> FileNameLength;
WCHAR FileName[1];
} FILE_RENAME_INFORMATION, *PFILE_RENAME_INFORMATION;
</code></pre>
<h2>Remarks</h2>
<p>The <strong>FILE_RENAME_INFORMATION</strong> structure is used to rename a file. This operation can be performed in either of the following ways:</p>
<ul>
<li>

</li>
<li>

</li>
</ul>
<p>File system minifilters must use <strong><a href="fltsetinformationfile" title="NTSTATUS FLTAPI FltSetInformationFile(&#10;  [in] PFLT_INSTANCE          Instance,&#10;  [in] PFILE_OBJECT           FileObject,&#10;  [in] PVOID                  FileInformation,&#10;  [in] ULONG                  Length,&#10;  [in] FILE_INFORMATION_CLASS FileInformationClass&#10;);">FltSetInformationFile</a></strong>, not <strong><a href="ntsetinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_reads_bytes_(Length) PVOID FileInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FILE_INFORMATION_CLASS FileInformationClass&#10;    );">ZwSetInformationFile</a></strong>, to rename a file.</p>
<p>Renaming a file requires DELETE access to the file so that the directory entry can be removed from the current parent directory, as well as the appropriate access to create the new entry in the new parent directory file.</p>
<p>The file name string in the <strong>FileName</strong> member must be specified in one of the following forms.</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<p>General rules for rename operations:</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<p>Special rules for renaming open files:</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<p>Special rules for renaming NTFS data streams:</p>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<p>The size of the <strong>FileInformation</strong> buffer passed to <strong><a href="ntsetinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_reads_bytes_(Length) PVOID FileInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FILE_INFORMATION_CLASS FileInformationClass&#10;    );">ZwSetInformationFile</a></strong> or <strong><a href="fltsetinformationfile" title="NTSTATUS FLTAPI FltSetInformationFile(&#10;  [in] PFLT_INSTANCE          Instance,&#10;  [in] PFILE_OBJECT           FileObject,&#10;  [in] PVOID                  FileInformation,&#10;  [in] ULONG                  Length,&#10;  [in] FILE_INFORMATION_CLASS FileInformationClass&#10;);">FltSetInformationFile</a></strong> must be &gt;= <strong>sizeof</strong>(FILE_RENAME_INFORMATION) plus the size in bytes of the <strong>FileName</strong> string.</p>
<h2>See also</h2>
<p><strong><a href="fltsetinformationfile" title="NTSTATUS FLTAPI FltSetInformationFile(&#10;  [in] PFLT_INSTANCE          Instance,&#10;  [in] PFILE_OBJECT           FileObject,&#10;  [in] PVOID                  FileInformation,&#10;  [in] ULONG                  Length,&#10;  [in] FILE_INFORMATION_CLASS FileInformationClass&#10;);">FltSetInformationFile</a></strong></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ifs/irp-mj-set-information"><strong>IRP_MJ_SET_INFORMATION</strong></a></p>
<p><strong><a href="ntsetinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_reads_bytes_(Length) PVOID FileInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FILE_INFORMATION_CLASS FileInformationClass&#10;    );">ZwSetInformationFile</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_file_rename_information">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/ns-ntifs-_file_rename_information.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This structure is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/ns-ntifs-_file_rename_information">documented in Windows Driver Kit</a>.</p>
<hr />
<p>Structure <code>FILE_RENAME_INFORMATION</code> is used as input buffer for function <code><a href="ntsetinformationfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetInformationFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_reads_bytes_(Length) PVOID FileInformation,&#10;    _In_ ULONG Length,&#10;    _In_ FILE_INFORMATION_CLASS FileInformationClass&#10;    );">NtSetInformationFile</a></code>, called with <code>FileRenameInformation</code> information class. Using this structure caller can rename file, or move it into other directory.</p>
<h3>ReplaceIfExists</h3>
<p>If set, and file with the same name as destination exist, it will be replaced. If no, <code>STATUS_OBJECT_NAME_COLLISION</code> is returned.</p>
<h3>RootDirectory</h3>
<p>Optional <code>HANDLE</code> to parent directory for destination file.</p>
<h3>FileNameLength</h3>
<p>Length of <code>FileName</code> array, in bytes.</p>
<h3>FileName[1]</h3>
<p>UNICODE string specifying destination file name. If <code>RootDirectory</code> is <em>NULL</em>, it must contains full system path, or only destination file name for in-place rename operation.</p>
<h1>Documented by</h1>
<ul>
<li>

</li>
<li>

</li>
</ul>
<h1>See also</h1>
<ul>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
<li>

</li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/file_rename_information.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
