<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KSFILTERFACTORY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KSFILTERFACTORY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KSFILTERFACTORY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _KSFILTERFACTORY {
  const <a href="ksfilter_descriptor" title="typedef struct _KSFILTER_DESCRIPTOR {&#10;  const KSFILTER_DISPATCH     *Dispatch;&#10;  const KSAUTOMATION_TABLE    *AutomationTable;&#10;  ULONG                       Version;&#10;  ULONG                       Flags;&#10;  const GUID                  *ReferenceGuid;&#10;  ULONG                       PinDescriptorsCount;&#10;  ULONG                       PinDescriptorSize;&#10;  const KSPIN_DESCRIPTOR_EX   *PinDescriptors;&#10;  ULONG                       CategoriesCount;&#10;  const GUID                  *Categories;&#10;  ULONG                       NodeDescriptorsCount;&#10;  ULONG                       NodeDescriptorSize;&#10;  const KSNODE_DESCRIPTOR     *NodeDescriptors;&#10;  ULONG                       ConnectionsCount;&#10;  const KSTOPOLOGY_CONNECTION *Connections;&#10;  const KSCOMPONENTID         *ComponentId;&#10;} KSFILTER_DESCRIPTOR, *PKSFILTER_DESCRIPTOR;">KSFILTER_DESCRIPTOR</a> *FilterDescriptor;
  KSOBJECT_BAG              Bag;
  PVOID                     Context;
} KSFILTERFACTORY, *PKSFILTERFACTORY;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/ns-ks-_ksfilterfactory">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ksfilterfactory.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ks-_ksfilterfactory)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_ksfilterfactory-structure">_KSFILTERFACTORY structure</h1>

<h2 id="description">Description</h2>

<p>The KSFILTERFACTORY structure represents a filter factory.</p>

<h2 id="members">Members</h2>

<h3 id="filterdescriptor"><code>FilterDescriptor</code></h3>

<p>A pointer to a <a href="ksfilter_descriptor" title="typedef struct _KSFILTER_DESCRIPTOR {&#10;  const KSFILTER_DISPATCH     *Dispatch;&#10;  const KSAUTOMATION_TABLE    *AutomationTable;&#10;  ULONG                       Version;&#10;  ULONG                       Flags;&#10;  const GUID                  *ReferenceGuid;&#10;  ULONG                       PinDescriptorsCount;&#10;  ULONG                       PinDescriptorSize;&#10;  const KSPIN_DESCRIPTOR_EX   *PinDescriptors;&#10;  ULONG                       CategoriesCount;&#10;  const GUID                  *Categories;&#10;  ULONG                       NodeDescriptorsCount;&#10;  ULONG                       NodeDescriptorSize;&#10;  const KSNODE_DESCRIPTOR     *NodeDescriptors;&#10;  ULONG                       ConnectionsCount;&#10;  const KSTOPOLOGY_CONNECTION *Connections;&#10;  const KSCOMPONENTID         *ComponentId;&#10;} KSFILTER_DESCRIPTOR, *PKSFILTER_DESCRIPTOR;">KSFILTER_DESCRIPTOR</a> structure that describes the characteristics of filters created by this factory.</p>

<h3 id="bag"><code>Bag</code></h3>

<p>This member specifies the KSOBJECT_BAG (equivalent to type PVOID) associated with this filter factory. Object bags are structures used to associate dynamic memory with a specific AVStream object. Anything in the filter factory object bag is automatically cleaned up when the filter factory is deleted. See the conceptual section on <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/object-bags">Object Bags</a> for more information.</p>

<h3 id="context"><code>Context</code></h3>

<p>A pointer to a memory address that the client may use to associate context information with the filter factory. AVStream does not use this member in any way. Note that any dynamic memory associated with the filter factory should be placed in the object bag with <strong><a href="ksadditemtoobjectbag" title="KSDDKAPI NTSTATUS KsAddItemToObjectBag(&#10;  [in]           KSOBJECT_BAG           ObjectBag,&#10;  [in]           __drv_aliasesMem PVOID Item,&#10;  [in, optional] PFNKSFREE              Free&#10;);">KsAddItemToObjectBag</a></strong>. <strong>Context</strong> is initialized to the value of the <strong>Context</strong> member of the parent <a href="ksdevice" title="typedef struct _KSDEVICE {&#10;  const KSDEVICE_DESCRIPTOR *Descriptor;&#10;  KSOBJECT_BAG              Bag;&#10;  PVOID                     Context;&#10;  PDEVICE_OBJECT            FunctionalDeviceObject;&#10;  PDEVICE_OBJECT            PhysicalDeviceObject;&#10;  PDEVICE_OBJECT            NextDeviceObject;&#10;  BOOLEAN                   Started;&#10;  SYSTEM_POWER_STATE        SystemPowerState;&#10;  DEVICE_POWER_STATE        DevicePowerState;&#10;} KSDEVICE, *PKSDEVICE;">KSDEVICE</a> at the time the factory is created. See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/avstream-object-hierarchy">AVStream Object Hierarchy</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>A filter factory explicitly represents a device's ability to instantiate a given type of filter as described by a filter descriptor.</p>

<p>Drivers for hardware typically use this structure to manage a particular function of the hardware that is exposed as a type of filter. Software filters generally do not need to manage the device at this level.</p>

<p>Filter factory objects are created in two ways. They can be created during the AddDevice processing as indicated by the device descriptor's list of filter descriptors. They can also be created explicitly by the client in a call to <a href="kscreatefilterfactory" title="KSDDKAPI NTSTATUS KsCreateFilterFactory(&#10;  [in]            PDEVICE_OBJECT            DeviceObject,&#10;  [in]            const KSFILTER_DESCRIPTOR *Descriptor,&#10;  [in, optional]  PWSTR                     RefString,&#10;  [in, optional]  PSECURITY_DESCRIPTOR      SecurityDescriptor,&#10;  [in]            ULONG                     CreateItemFlags,&#10;  [in, optional]  PFNKSFILTERFACTORYPOWER   SleepCallback,&#10;  [in, optional]  PFNKSFILTERFACTORYPOWER   WakeCallback,&#10;  [out, optional] PKSFILTERFACTORY          *FilterFactory&#10;);">KsCreateFilterFactory</a>. The client may create filter factories at any time, but this is typically done during the processing of the PnP start <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> when an evaluation of assigned resources indicates what types of filters must be exposed by the device.</p>

<p>For the purposes of synchronization, the lifetime of filter factories created implicitly is defined as the interval starting when the client's device create dispatch function is (or would be) called and ending after the client's device PnP remove dispatch function is (or would be) called. The lifetime of filter factories created explicitly by calling <a href="kscreatefilterfactory" title="KSDDKAPI NTSTATUS KsCreateFilterFactory(&#10;  [in]            PDEVICE_OBJECT            DeviceObject,&#10;  [in]            const KSFILTER_DESCRIPTOR *Descriptor,&#10;  [in, optional]  PWSTR                     RefString,&#10;  [in, optional]  PSECURITY_DESCRIPTOR      SecurityDescriptor,&#10;  [in]            ULONG                     CreateItemFlags,&#10;  [in, optional]  PFNKSFILTERFACTORYPOWER   SleepCallback,&#10;  [in, optional]  PFNKSFILTERFACTORYPOWER   WakeCallback,&#10;  [out, optional] PKSFILTERFACTORY          *FilterFactory&#10;);">KsCreateFilterFactory</a> starts immediately after that call returns.</p>

<p>Also see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/object-bags">Object Bags</a>.</p>

<h2 id="see-also">See also</h2>

<p><a href="ksfilter_descriptor" title="typedef struct _KSFILTER_DESCRIPTOR {&#10;  const KSFILTER_DISPATCH     *Dispatch;&#10;  const KSAUTOMATION_TABLE    *AutomationTable;&#10;  ULONG                       Version;&#10;  ULONG                       Flags;&#10;  const GUID                  *ReferenceGuid;&#10;  ULONG                       PinDescriptorsCount;&#10;  ULONG                       PinDescriptorSize;&#10;  const KSPIN_DESCRIPTOR_EX   *PinDescriptors;&#10;  ULONG                       CategoriesCount;&#10;  const GUID                  *Categories;&#10;  ULONG                       NodeDescriptorsCount;&#10;  ULONG                       NodeDescriptorSize;&#10;  const KSNODE_DESCRIPTOR     *NodeDescriptors;&#10;  ULONG                       ConnectionsCount;&#10;  const KSTOPOLOGY_CONNECTION *Connections;&#10;  const KSCOMPONENTID         *ComponentId;&#10;} KSFILTER_DESCRIPTOR, *PKSFILTER_DESCRIPTOR;">KSFILTER_DESCRIPTOR</a></p>

<p><a href="ksadditemtoobjectbag" title="KSDDKAPI NTSTATUS KsAddItemToObjectBag(&#10;  [in]           KSOBJECT_BAG           ObjectBag,&#10;  [in]           __drv_aliasesMem PVOID Item,&#10;  [in, optional] PFNKSFREE              Free&#10;);">KsAddItemToObjectBag</a></p>

<p><a href="kscreatefilterfactory" title="KSDDKAPI NTSTATUS KsCreateFilterFactory(&#10;  [in]            PDEVICE_OBJECT            DeviceObject,&#10;  [in]            const KSFILTER_DESCRIPTOR *Descriptor,&#10;  [in, optional]  PWSTR                     RefString,&#10;  [in, optional]  PSECURITY_DESCRIPTOR      SecurityDescriptor,&#10;  [in]            ULONG                     CreateItemFlags,&#10;  [in, optional]  PFNKSFILTERFACTORYPOWER   SleepCallback,&#10;  [in, optional]  PFNKSFILTERFACTORYPOWER   WakeCallback,&#10;  [out, optional] PKSFILTERFACTORY          *FilterFactory&#10;);">KsCreateFilterFactory</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/ns-ks-_ksfilterfactory">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/ns-ks-_ksfilterfactory.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
