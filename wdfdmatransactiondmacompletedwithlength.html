<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfDmaTransactionDmaCompletedWithLength - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfDmaTransactionDmaCompletedWithLength - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfDmaTransactionDmaCompletedWithLength - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfdmatransaction.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">BOOLEAN WdfDmaTransactionDmaCompletedWithLength(
  [in]  WDFDMATRANSACTION DmaTransaction,
  [in]  <a href="size_t" title="typedef unsigned __int64 size_t;">size_t</a>            TransferredLength,
  [out] <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>          *Status
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdmatransaction/nf-wdfdmatransaction-wdfdmatransactiondmacompletedwithlength">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfdmatransactiondmacompletedwithlength.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfdmatransaction-wdfdmatransactiondmacompletedwithlength)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="wdfdmatransactiondmacompletedwithlength-function">WdfDmaTransactionDmaCompletedWithLength function</h1>

<h2 id="description">Description</h2>

<p>[Applies to KMDF only]</p>

<p>The <strong>WdfDmaTransactionDmaCompletedWithLength</strong> method notifies the framework that a device's DMA transfer operation is complete and supplies the length of the completed transfer.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="dmatransaction-in"><code>DmaTransaction</code> [in]</h3>

<p>A handle to a DMA transaction object that the driver obtained from a previous call to <a href="wdfdmatransactioncreate" title="NTSTATUS WdfDmaTransactionCreate(&#10;  [in]           WDFDMAENABLER          DmaEnabler,&#10;  [in, optional] PWDF_OBJECT_ATTRIBUTES Attributes,&#10;  [out]          WDFDMATRANSACTION      *DmaTransaction&#10;);">WdfDmaTransactionCreate</a>.</p>

<h3 id="transferredlength-in"><code>TransferredLength</code> [in]</h3>

<p>The number of bytes that the device transferred in the current DMA transfer.</p>

<h3 id="status-out"><code>Status</code> [out]</h3>

<p>A pointer to a location that receives the status of the DMA transfer. For more information, see the Remarks section for <a href="wdfdmatransactiondmacompleted" title="BOOLEAN WdfDmaTransactionDmaCompleted(&#10;  [in]  WDFDMATRANSACTION DmaTransaction,&#10;  [out] NTSTATUS          *Status&#10;);">WdfDmaTransactionDmaCompleted</a>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>WdfDmaTransactionDmaCompletedWithLength</strong> returns <strong>FALSE</strong> and <em>Status</em> receives STATUS_MORE_PROCESSING_REQUIRED if additional transfers are needed to complete the DMA transaction. The method returns <strong>TRUE</strong> if no additional transfers are required.</p>

<p>A bug check occurs if the driver supplies an invalid object handle.</p>

<h2 id="remarks">Remarks</h2>

<p>When your driver calls the <strong>WdfDmaTransactionDmaCompletedWithLength</strong> method, the framework ends the current transfer and, if necessary, starts a new one.</p>

<p>The <strong>WdfDmaTransactionDmaCompletedWithLength</strong> method behaves the same as <a href="wdfdmatransactiondmacompleted" title="BOOLEAN WdfDmaTransactionDmaCompleted(&#10;  [in]  WDFDMATRANSACTION DmaTransaction,&#10;  [out] NTSTATUS          *Status&#10;);">WdfDmaTransactionDmaCompleted</a>, except that drivers call <strong>WdfDmaTransactionDmaCompletedWithLength</strong> for devices that report the number of bytes that were transferred. The framework uses the reported byte count to determine the beginning of the next DMA transfer for the specified DMA transaction, if multiple transfers are needed to complete the transaction.</p>

<p>For more information about completing DMA transfers, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/completing-a-dma-transfer">Completing a DMA Transfer</a>.</p>

<h4 id="examples">Examples</h4>

<p>The following code example is from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/sample-kmdf-drivers">PLX9x5x</a> sample driver. This example calls <a href="wdfdmatransactiongetcurrentdmatransferlength" title="size_t WdfDmaTransactionGetCurrentDmaTransferLength(&#10;  [in] WDFDMATRANSACTION DmaTransaction&#10;);">WdfDmaTransactionGetCurrentDmaTransferLength</a> to determine the current transfer's original length, and then it calculates the actual transfer length. Next, the example calls <strong>WdfDmaTransactionDmaCompletedWithLength</strong> to report the actual transfer length to the framework. If the current transfer is the last one for the transaction, the example calls a private routine that completes the I/O request.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOLEAN</span><span class="w">  </span><span class="n">hasTransitioned</span><span class="p">;</span>
<span class="n">PDMA_TRANSFER_ELEMENT</span><span class="w">  </span><span class="n">dteVA</span><span class="p">;</span>
<span class="n"><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></span><span class="w">  </span><span class="n">length</span><span class="p">;</span>
<span class="c1">//</span>
<span class="c1">// Use &quot;DMA Clear-Count Mode&quot; to get the complementary</span>
<span class="c1">// transferred byte count.</span>
<span class="c1">//</span>
<span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="wdfdmatransactiongetcurrentdmatransferlength" title="size_t WdfDmaTransactionGetCurrentDmaTransferLength(&#10;  [in] WDFDMATRANSACTION DmaTransaction&#10;);">WdfDmaTransactionGetCurrentDmaTransferLength</a></span><span class="p">(</span><span class="n">dmaTransaction</span><span class="p">);</span>
<span class="n">dteVA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PDMA_TRANSFER_ELEMENT</span><span class="p">)</span><span class="w"> </span><span class="n">devExt</span><span class="o">-&gt;</span><span class="n">ReadCommonBufferBase</span><span class="p">;</span>
<span class="k">while</span><span class="p">(</span><span class="n">dteVA</span><span class="o">-&gt;</span><span class="n">DescPtr</span><span class="p">.</span><span class="n">LastElement</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FALSE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">length</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">dteVA</span><span class="o">-&gt;</span><span class="n">TransferSize</span><span class="p">;</span>
<span class="w">    </span><span class="n">dteVA</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">length</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">dteVA</span><span class="o">-&gt;</span><span class="n">TransferSize</span><span class="p">;</span>
<span class="c1">//</span>
<span class="c1">// Indicate that this DMA operation has completed.</span>
<span class="c1">//</span>
<span class="n">hasTransitioned</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">WdfDmaTransactionDmaCompletedWithLength</span><span class="p">(</span>
<span class="w">                                            </span><span class="n">dmaTransaction</span><span class="p">,</span>
<span class="w">                                            </span><span class="n">length</span><span class="p">,</span>
<span class="w">                                            </span><span class="o">&amp;</span><span class="n">status</span>
<span class="w">                                            </span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hasTransitioned</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Complete this DMA transaction.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">devExt</span><span class="o">-&gt;</span><span class="n">CurrentReadDmaTransaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">PLxReadRequestComplete</span><span class="p">(</span>
<span class="w">                           </span><span class="n">dmaTransaction</span><span class="p">,</span>
<span class="w">                           </span><span class="n">status</span>
<span class="w">                           </span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a href="wdfdmatransactioncreate" title="NTSTATUS WdfDmaTransactionCreate(&#10;  [in]           WDFDMAENABLER          DmaEnabler,&#10;  [in, optional] PWDF_OBJECT_ATTRIBUTES Attributes,&#10;  [out]          WDFDMATRANSACTION      *DmaTransaction&#10;);">WdfDmaTransactionCreate</a></p>

<p><a href="wdfdmatransactiondmacompleted" title="BOOLEAN WdfDmaTransactionDmaCompleted(&#10;  [in]  WDFDMATRANSACTION DmaTransaction,&#10;  [out] NTSTATUS          *Status&#10;);">WdfDmaTransactionDmaCompleted</a></p>

<p><a href="wdfdmatransactiongetcurrentdmatransferlength" title="size_t WdfDmaTransactionGetCurrentDmaTransferLength(&#10;  [in] WDFDMATRANSACTION DmaTransaction&#10;);">WdfDmaTransactionGetCurrentDmaTransferLength</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdmatransaction/nf-wdfdmatransaction-wdfdmatransactiondmacompletedwithlength">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfdmatransaction/nf-wdfdmatransaction-wdfdmatransactiondmacompletedwithlength.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
