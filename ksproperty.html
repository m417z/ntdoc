<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KSPROPERTY - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KSPROPERTY - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KSPROPERTY - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ks.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">struct KSPROPERTY {
  GUID Set;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Id;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Flags;
};</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/ksproperty-structure">View the official Windows hardware development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ksproperty.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows hardware development documentation (ksproperty-structure)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ksproperty-structure">KSPROPERTY structure</h1>

<p>The <strong>KSPROPERTY</strong> structure specifies a single kernel streaming property within a property set.</p>

<p>The <strong><a href="ksevent" title="struct KSEVENT {&#10;  GUID Set;&#10;  ULONG Id;&#10;  ULONG Flags;&#10;};">KSEVENT</a></strong>, <strong><a href="ksmethod" title="struct KSMETHOD {&#10;  GUID Set;&#10;  ULONG Id;&#10;  ULONG Flags;&#10;};">KSMETHOD</a></strong>, and <strong>KSPROPERTY</strong> structures are aliases for the <strong><a href="ksidentifier" title="typedef struct {&#10;  union {&#10;    struct {&#10;      GUID  Set;&#10;      ULONG Id;&#10;      ULONG Flags;&#10;    } _IDENTIFIER;&#10;    struct {&#10;      GUID  Set;&#10;      ULONG Id;&#10;      ULONG Flags;&#10;    };&#10;    LONGLONG Alignment;&#10;  };&#10;} KSIDENTIFIER, *PKSIDENTIFIER;">KSIDENTIFIER</a></strong> structure. As such, their definitions are identical.</p>

<h2 id="members">Members</h2>

<p><code>Set</code></p>

<p>Specifies a GUID that identifies a kernel streaming property set. For more information about property set GUIDs, see the <strong>Remarks</strong> section below.</p>

<p><code>Id</code></p>

<p>Specifies the member of the property set.</p>

<p><code>Flags</code></p>

<p>Specifies the request type. If you are writing a stream class minidriver, also see <strong><a href="ksproperty_item" title="typedef struct {&#10;  ULONG                   PropertyId;&#10;  union {&#10;    PFNKSHANDLER GetPropertyHandler;&#10;    BOOLEAN      GetSupported;&#10;  };&#10;  ULONG                   MinProperty;&#10;  ULONG                   MinData;&#10;  union {&#10;    PFNKSHANDLER SetPropertyHandler;&#10;    BOOLEAN      SetSupported;&#10;  };&#10;  const KSPROPERTY_VALUES *Values;&#10;  ULONG                   RelationsCount;&#10;  const KSPROPERTY        *Relations;&#10;  PFNKSHANDLER            SupportHandler;&#10;  ULONG                   SerializedSize;&#10;} KSPROPERTY_ITEM, *PKSPROPERTY_ITEM;">KSPROPERTY_ITEM</a></strong> for class-specific flag information.</p>

<p><em>Flags</em> should be one of the values listed in the following table. Some of the flags may be combined using a bitwise OR operation.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>KSPROPERTY_TYPE_GET</td>
  <td>Retrieves the value of the specified property item.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_SET</td>
  <td>Sets the value of the specified property item.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_SETSUPPORT</td>
  <td>Queries if the driver supports this property set.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_BASICSUPPORT</td>
  <td>Queries the request types that the driver handles for this property item. Returns <em>KSPROPERTY_TYPE_GET</em> or <em>KSPROPERTY_TYPE_SET</em> or both. All property sets must support this flag.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_DEFAULTVALUES</td>
  <td>Queries the default values for the specified property item. Returns a structure of type <strong><a href="ksproperty_values" title="typedef struct {&#10;  KSIDENTIFIER                 PropTypeSet;&#10;  ULONG                        MembersListCount;&#10;  const KSPROPERTY_MEMBERSLIST *MembersList;&#10;} KSPROPERTY_VALUES, *PKSPROPERTY_VALUES;">KSPROPERTY_VALUES</a></strong>.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_RELATIONS</td>
  <td>Queries all properties with dependencies on the current setting of this property. Specifies that the property relations list is to be returned, or the amount of buffer room required by such a list if the return buffer is the size of a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>. Each element is on <strong><a href="file_quad_alignment" title="#define FILE_QUAD_ALIGNMENT 0x00000007">FILE_QUAD_ALIGNMENT</a></strong>, preceded by a <strong><a href="ksmultiple_item" title="typedef struct {&#10;  ULONG Size;&#10;  ULONG Count;&#10;} KSMULTIPLE_ITEM, *PKSMULTIPLE_ITEM;">KSMULTIPLE_ITEM</a></strong> structure. This is not valid when querying support of the property set in general. All property sets must support this flag.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_SERIALIZESET</td>
  <td>Serialize the property set, using the standard <strong><a href="ksproperty_serialhdr" title="typedef struct {&#10;  GUID  PropertySet;&#10;  ULONG Count;&#10;} KSPROPERTY_SERIALHDR, *PKSPROPERTY_SERIALHDR;">KSPROPERTY_SERIALHDR</a></strong> and <strong><a href="ksproperty_serial" title="typedef struct {&#10;  KSIDENTIFIER PropTypeSet;&#10;  ULONG        Id;&#10;  ULONG        PropertyLength;&#10;} KSPROPERTY_SERIAL, *PKSPROPERTY_SERIAL;">KSPROPERTY_SERIAL</a></strong> structures.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_UNSERIALIZESET</td>
  <td>Unserialize the property set, using the standard <strong><a href="ksproperty_serialhdr" title="typedef struct {&#10;  GUID  PropertySet;&#10;  ULONG Count;&#10;} KSPROPERTY_SERIALHDR, *PKSPROPERTY_SERIALHDR;">KSPROPERTY_SERIALHDR</a></strong> and <strong><a href="ksproperty_serial" title="typedef struct {&#10;  KSIDENTIFIER PropTypeSet;&#10;  ULONG        Id;&#10;  ULONG        PropertyLength;&#10;} KSPROPERTY_SERIAL, *PKSPROPERTY_SERIAL;">KSPROPERTY_SERIAL</a></strong> structures.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_SERIALIZESIZE</td>
  <td>Returns a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> specifying size of the property data when serialized as part of a <em>KSPROPERTY_TYPE_SERIALIZESET</em> request. A size of zero indicates that a property does not need to be serialized.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_SERIALIZERAW</td>
  <td>Specifies that the properties in this set should be serialized by the property set support handler, if one exists. If not, the call fails. The serialization format is private. This operation must be the inverse of <em>KSPROPERTY_TYPE_UNSERIALIZERAW</em>.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_TOPOLOGY</td>
  <td>Property passed is of type <strong><a href="ksp_node" title="typedef struct {&#10;  KSPROPERTY Property;&#10;  ULONG      NodeId;&#10;  ULONG      Reserved;&#10;} KSP_NODE, *PKSP_NODE;">KSP_NODE</a></strong>, where NodeId indicates the numeric ID of the topology node. Do not set this flag on its own; instead, OR it with other flags in this table.</td>
</tr>
<tr>
  <td>KSPROPERTY_TYPE_UNSERIALIZERAW</td>
  <td>Specifies that the provided buffer contains a group of properties that belong to this set that should be unserialized by the property set support handler, if one exists. If not, the call fails. The serialization format is private. This operation must be the inverse of <em>KSPROPERTY_TYPE_SERIALIZERAW</em>.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The size of the output buffer passed determines what data is returned from a KSPROPERTY_TYPE_BASICSUPPORT request. If the output buffer is the size of a <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>, only the access flags are returned. If the output buffer is the size of the <strong><a href="ksproperty_description" title="typedef struct {&#10;  ULONG        AccessFlags;&#10;  ULONG        DescriptionSize;&#10;  KSIDENTIFIER PropTypeSet;&#10;  ULONG        MembersListCount;&#10;  ULONG        Reserved;&#10;} KSPROPERTY_DESCRIPTION, *PKSPROPERTY_DESCRIPTION;">KSPROPERTY_DESCRIPTION</a></strong> structure, the structure is filled with the access flags, the inclusive size of the entire values information, the property value type information, and the number of member lists that correspond to the structure.</p>

<p>For a KSPROPERTY_TYPE_RELATIONS request, data returned also depends on the size of the output buffer. If the output buffer size is zero, the size required to return the related properties is returned in <strong>BytesReturned</strong> with a warning status of STATUS_BUFFER_OVERFLOW. If the buffer is the size of a <strong><a href="ksmultiple_item" title="typedef struct {&#10;  ULONG Size;&#10;  ULONG Count;&#10;} KSMULTIPLE_ITEM, *PKSMULTIPLE_ITEM;">KSMULTIPLE_ITEM</a></strong> structure, both the byte size and count of relations is returned. Otherwise, the buffer is expected to be long enough to return the <a href="ksmultiple_item" title="typedef struct {&#10;  ULONG Size;&#10;  ULONG Count;&#10;} KSMULTIPLE_ITEM, *PKSMULTIPLE_ITEM;">KSMULTIPLE_ITEM</a> structure and all related property identifiers, which is returned as a list of <strong><a href="ksidentifier" title="typedef struct {&#10;  union {&#10;    struct {&#10;      GUID  Set;&#10;      ULONG Id;&#10;      ULONG Flags;&#10;    } _IDENTIFIER;&#10;    struct {&#10;      GUID  Set;&#10;      ULONG Id;&#10;      ULONG Flags;&#10;    };&#10;    LONGLONG Alignment;&#10;  };&#10;} KSIDENTIFIER, *PKSIDENTIFIER;">KSIDENTIFIER</a></strong> structures.</p>

<p><em>KSPROPERTY_TYPE_SERIALIZESET</em> and <em>KSPROPERTY_TYPE_UNSERIALIZESET</em> requests allow interaction with multiple properties with a single call from the client. If the kernel streaming handler is being used to process property requests, these are broken up into multiple calls by the <strong><a href="kspropertyhandler" title="KSDDKAPI NTSTATUS KsPropertyHandler(&#10;  [in] PIRP                 Irp,&#10;  [in] ULONG                PropertySetsCount,&#10;  [in] const KSPROPERTY_SET *PropertySet&#10;);">KsPropertyHandler</a></strong> function. When using this handler, the property set definition controls which properties are to be serialized.</p>

<p>For serialization requests, the <strong>SerializedSize</strong> member of the relevant <strong><a href="ksproperty_item" title="typedef struct {&#10;  ULONG                   PropertyId;&#10;  union {&#10;    PFNKSHANDLER GetPropertyHandler;&#10;    BOOLEAN      GetSupported;&#10;  };&#10;  ULONG                   MinProperty;&#10;  ULONG                   MinData;&#10;  union {&#10;    PFNKSHANDLER SetPropertyHandler;&#10;    BOOLEAN      SetSupported;&#10;  };&#10;  const KSPROPERTY_VALUES *Values;&#10;  ULONG                   RelationsCount;&#10;  const KSPROPERTY        *Relations;&#10;  PFNKSHANDLER            SupportHandler;&#10;  ULONG                   SerializedSize;&#10;} KSPROPERTY_ITEM, *PKSPROPERTY_ITEM;">KSPROPERTY_ITEM</a></strong> structure is checked for a nonzero value that indicates the size, in bytes, of the property. If the value of the SerializedSize member is 1, it is unknown and must be queried (all unknown properties begin with a <a href="ksmultiple_item" title="typedef struct {&#10;  ULONG Size;&#10;  ULONG Count;&#10;} KSMULTIPLE_ITEM, *PKSMULTIPLE_ITEM;">KSMULTIPLE_ITEM</a> structure that can be queried separately). To query for the total size a serialization would take, the client passes a zero length buffer in the call to <strong>DeviceIoControl</strong>. <strong>BytesReturned</strong> then returns the size, in bytes, that the buffer must be to serialize the set, and a warning status of STATUS_BUFFER_OVERFLOW. A buffer allocated that size can then be filled with the serialized data.</p>

<p>The format of the serialization buffer is a <strong><a href="ksproperty_serialhdr" title="typedef struct {&#10;  GUID  PropertySet;&#10;  ULONG Count;&#10;} KSPROPERTY_SERIALHDR, *PKSPROPERTY_SERIALHDR;">KSPROPERTY_SERIALHDR</a></strong>, followed by serialized properties. Each property that follows contains a header (<strong><a href="ksproperty_serial" title="typedef struct {&#10;  KSIDENTIFIER PropTypeSet;&#10;  ULONG        Id;&#10;  ULONG        PropertyLength;&#10;} KSPROPERTY_SERIAL, *PKSPROPERTY_SERIAL;">KSPROPERTY_SERIAL</a></strong>), followed by the property data, with the start of each property on <strong><a href="file_long_alignment" title="#define FILE_LONG_ALIGNMENT 0x00000003">FILE_LONG_ALIGNMENT</a></strong>. Note that the serial header structure is defined to be on <strong><a href="file_long_alignment" title="#define FILE_LONG_ALIGNMENT 0x00000003">FILE_LONG_ALIGNMENT</a></strong>.</p>

<p><em>KSPROPERTY_TYPE_SERIALIZERAW</em> and <em>KSPROPERTY_TYPE_UNSERIALIZERAW</em> are supported if a property item handler exists. The <strong><a href="kspropertyhandler" title="KSDDKAPI NTSTATUS KsPropertyHandler(&#10;  [in] PIRP                 Irp,&#10;  [in] ULONG                PropertySetsCount,&#10;  [in] const KSPROPERTY_SET *PropertySet&#10;);">KsPropertyHandler</a></strong> function invokes the handler provided by the minidriver. The buffer size required for serialization can also be queried by passing a zero-length buffer to a serialize raw request. Because handlers are attached to property items rather than the property set, a specific item within the property set must be specified in the <strong>Property</strong> parameter. This handler may deal with multiple properties within the set.</p>

<p>Microsoft provides several system-defined property set GUIDs. Minidrivers specify one of these GUIDs in the <strong>Set</strong> member. Kernel streaming property sets typically begin with either a <em>KSPROPSETID</em> or a <em>PROPSETID</em> prefix. Kernel streaming property sets are defined in <em>ks.h</em>, <em>ksmedia.h</em>, <em>bdamedia.h</em>, and possibly other header files.</p>

<p>For more information about kernel streaming events, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/ks-properties--events--and-methods">KS Properties, Events, and Methods</a>.</p>

<h2 id="requirements">Requirements</h2>

<p><strong>Header:</strong> ks.h (include Ks.h)</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="ksevent" title="struct KSEVENT {&#10;  GUID Set;&#10;  ULONG Id;&#10;  ULONG Flags;&#10;};">KSEVENT</a></strong></p>

<p><strong><a href="ksmethod" title="struct KSMETHOD {&#10;  GUID Set;&#10;  ULONG Id;&#10;  ULONG Flags;&#10;};">KSMETHOD</a></strong></p>

<p><strong><a href="ksidentifier" title="typedef struct {&#10;  union {&#10;    struct {&#10;      GUID  Set;&#10;      ULONG Id;&#10;      ULONG Flags;&#10;    } _IDENTIFIER;&#10;    struct {&#10;      GUID  Set;&#10;      ULONG Id;&#10;      ULONG Flags;&#10;    };&#10;    LONGLONG Alignment;&#10;  };&#10;} KSIDENTIFIER, *PKSIDENTIFIER;">KSIDENTIFIER</a></strong></p>

<p><strong><a href="ksmethod_item" title="typedef struct {&#10;  ULONG        MethodId;&#10;  union {&#10;    PFNKSHANDLER MethodHandler;&#10;    BOOLEAN      MethodSupported;&#10;  };&#10;  ULONG        MinMethod;&#10;  ULONG        MinData;&#10;  PFNKSHANDLER SupportHandler;&#10;  ULONG        Flags;&#10;} KSMETHOD_ITEM, *PKSMETHOD_ITEM;">KSMETHOD_ITEM</a></strong></p>

<p><strong><a href="kse_node" title="typedef struct {&#10;  KSEVENT Event;&#10;  ULONG   NodeId;&#10;  ULONG   Reserved;&#10;} KSE_NODE, *PKSE_NODE;">KSE_NODE</a></strong></p>

<p><strong><a href="ksproperty_description" title="typedef struct {&#10;  ULONG        AccessFlags;&#10;  ULONG        DescriptionSize;&#10;  KSIDENTIFIER PropTypeSet;&#10;  ULONG        MembersListCount;&#10;  ULONG        Reserved;&#10;} KSPROPERTY_DESCRIPTION, *PKSPROPERTY_DESCRIPTION;">KSPROPERTY_DESCRIPTION</a></strong></p>

<p><strong><a href="ksproperty_item" title="typedef struct {&#10;  ULONG                   PropertyId;&#10;  union {&#10;    PFNKSHANDLER GetPropertyHandler;&#10;    BOOLEAN      GetSupported;&#10;  };&#10;  ULONG                   MinProperty;&#10;  ULONG                   MinData;&#10;  union {&#10;    PFNKSHANDLER SetPropertyHandler;&#10;    BOOLEAN      SetSupported;&#10;  };&#10;  const KSPROPERTY_VALUES *Values;&#10;  ULONG                   RelationsCount;&#10;  const KSPROPERTY        *Relations;&#10;  PFNKSHANDLER            SupportHandler;&#10;  ULONG                   SerializedSize;&#10;} KSPROPERTY_ITEM, *PKSPROPERTY_ITEM;">KSPROPERTY_ITEM</a></strong></p>

<p><strong><a href="ksmultiple_item" title="typedef struct {&#10;  ULONG Size;&#10;  ULONG Count;&#10;} KSMULTIPLE_ITEM, *PKSMULTIPLE_ITEM;">KSMULTIPLE_ITEM</a></strong></p>

<p><strong><a href="kspropertyhandler" title="KSDDKAPI NTSTATUS KsPropertyHandler(&#10;  [in] PIRP                 Irp,&#10;  [in] ULONG                PropertySetsCount,&#10;  [in] const KSPROPERTY_SET *PropertySet&#10;);">KsPropertyHandler</a></strong></p>

<p><strong><a href="ksproperty_serialhdr" title="typedef struct {&#10;  GUID  PropertySet;&#10;  ULONG Count;&#10;} KSPROPERTY_SERIALHDR, *PKSPROPERTY_SERIALHDR;">KSPROPERTY_SERIALHDR</a></strong></p>

<p><strong><a href="ksproperty_serial" title="typedef struct {&#10;  KSIDENTIFIER PropTypeSet;&#10;  ULONG        Id;&#10;  ULONG        PropertyLength;&#10;} KSPROPERTY_SERIAL, *PKSPROPERTY_SERIAL;">KSPROPERTY_SERIAL</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/ksproperty-structure">View the official Windows hardware development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs/blob/staging/windows-driver-docs-pr/stream/ksproperty-structure.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
