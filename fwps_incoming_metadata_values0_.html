<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="FWPS_INCOMING_METADATA_VALUES0_ - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FWPS_INCOMING_METADATA_VALUES0_ - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            FWPS_INCOMING_METADATA_VALUES0_ - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// fwpsk.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct FWPS_INCOMING_METADATA_VALUES0_ {
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          currentMetadataValues;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          flags;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          reserved;
  FWPS_DISCARD_METADATA0          discardMetadata;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          flowHandle;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          ipHeaderSize;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          transportHeaderSize;
  FWP_BYTE_BLOB                   *processPath;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          token;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          processId;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          sourceInterfaceIndex;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          destinationInterfaceIndex;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                           compartmentId;
  FWPS_INBOUND_FRAGMENT_METADATA0 fragmentMetadata;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                           pathMtu;
  HANDLE                          completionHandle;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          transportEndpointHandle;
  SCOPE_ID                        remoteScopeId;
  WSACMSGHDR                      *controlData;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                           controlDataLength;
  FWP_DIRECTION                   packetDirection;
  PVOID                           headerIncludeHeader;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                           headerIncludeHeaderLength;
  IP_ADDRESS_PREFIX               destinationPrefix;
  <a href="uint16" title="typedef unsigned short UINT16;">UINT16</a>                          frameLength;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          parentEndpointHandle;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          icmpIdAndSequence;
  <a href="dword" title="typedef unsigned long DWORD;">DWORD</a>                           localRedirectTargetPID;
  SOCKADDR                        *originalDestination;
  HANDLE                          redirectRecords;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          currentL2MetadataValues;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          l2Flags;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          ethernetMacHeaderSize;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          wiFiOperationMode;
  NDIS_SWITCH_PORT_ID             vSwitchSourcePortId;
  NDIS_SWITCH_NIC_INDEX           vSwitchSourceNicIndex;
  NDIS_SWITCH_PORT_ID             vSwitchDestinationPortId;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          padding0;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>                          padding1;
  <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a>                          padding2;
  HANDLE                          vSwitchPacketContext;
  PVOID                           subProcessTag;
  <a href="uint64" title="typedef unsigned __int64 UINT64;">UINT64</a>                          reserved1;
} FWPS_INCOMING_METADATA_VALUES0;</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fwpsk/ns-fwpsk-fwps_incoming_metadata_values0_">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/fwps_incoming_metadata_values0_.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-fwpsk-fwps_incoming_metadata_values0_)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="fwps_incoming_metadata_values0_-structure">FWPS_INCOMING_METADATA_VALUES0_ structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>FWPS_INCOMING_METADATA_VALUES0</strong> structure defines metadata values that the filter engine passes to a callout's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function.</p>

<blockquote>
  <p>[!NOTE]
  <strong>FWPS_INCOMING_METADATA_VALUES0</strong> is a specific version of <strong>FWPS_INCOMING_METADATA_VALUES</strong>. See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/FWP/wfp-version-independent-names-and-targeting-specific-versions-of-windows">WFP Version-Independent Names and Targeting Specific Versions of Windows</a> for more information.</p>
</blockquote>

<h2 id="members">Members</h2>

<h3 id="currentmetadatavalues"><code>currentMetadataValues</code></h3>

<p>A <a href="uint32" title="typedef unsigned int UINT32;">UINT32</a> value that contains a bitwise OR of a combination of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/network/metadata-field-identifiers">Metadata Field Identifiers</a> that specify which metadata values are set in the structure.</p>

<h3 id="flags"><code>flags</code></h3>

<p>Used internally by the filter engine. Callout drivers should ignore this member.</p>

<h3 id="reserved"><code>reserved</code></h3>

<p>Reserved for system use. Callout drivers should ignore this member.</p>

<h3 id="discardmetadata"><code>discardMetadata</code></h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_discard_metadata0">FWPS_DISCARD_METADATA0</a> structure that describes the reason why the data was discarded. This member contains valid data only if the FWPS_METADATA_FIELD_DISCARD_REASON flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="flowhandle"><code>flowHandle</code></h3>

<p>A handle for the data flow. This member contains valid data only if the FWPS_METADATA_FIELD_FLOW_HANDLE flag is set in the <code>currentMetadataValues</code> member.</p>

<h3 id="ipheadersize"><code>ipHeaderSize</code></h3>

<p>The offset, in bytes, of the IP header.</p>

<p>On inbound paths, <strong>ipHeaderSize</strong>, when used in conjunction with the <strong>transportHeaderSize</strong> member, specifies the number of bytes to retreat from the data offset location to the beginning of the IP header.</p>

<p>On the following inbound ICMP error layers, <strong>ipHeaderSize</strong> alone specifies the total number of bytes to retreat from the data offset to the beginning of the IP header:</p>

<p>FWPS_LAYER_INBOUND_ICMP_ERROR_V4</p>

<p>FWPS_LAYER_INBOUND_ICMP_ERROR_V6</p>

<p>FWPS_LAYER_INBOUND_ICMP_ERROR_V4_DISCARD</p>

<p>FWPS_LAYER_INBOUND_ICMP_ERROR_V6_DISCARD</p>

<p>On outbound paths, if <code>ipHeaderSize</code> is greater than zero, it specifies the number of bytes to advance from the data offset location to the end of the IP header.</p>

<p>This member is not applicable to the outbound path at the following layers:</p>

<p>FWPS_LAYER_DATAGRAM_DATA_V4</p>

<p>FWPS_LAYER_DATAGRAM_DATA_V6</p>

<p>FWPS_LAYER_DATAGRAM_DATA_V4_DISCARD</p>

<p>FWPS_LAYER_DATAGRAM_DATA_V6_DISCARD</p>

<p>This member contains valid data only if the FWPS_METADATA_FIELD_IP_HEADER_SIZE flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="transportheadersize"><code>transportHeaderSize</code></h3>

<p>The offset or size, in bytes, of the transport header.</p>

<p>On inbound paths, <strong>transportHeaderSize</strong> specifies the number of bytes to retreat from the data offset location to the end of the transport header.</p>

<p>On the following inbound ICMP error layers, <strong>transportHeaderSize</strong> specifies the size of the ICMP header:</p>

<ul>
<li>FWPS_LAYER_INBOUND_ICMP_ERROR_V4</li>
<li>FWPS_LAYER_INBOUND_ICMP_ERROR_V6</li>
<li>FWPS_LAYER_INBOUND_ICMP_ERROR_V4_DISCARD</li>
<li>FWPS_LAYER_INBOUND_ICMP_ERROR_V6_DISCARD</li>
</ul>

<p>On outbound paths, <strong>transportHeaderSize</strong> specifies the number of bytes to advance from the data offset location to the end of the transport header.</p>

<p>This member contains valid data only if the FWPS_METADATA_FIELD_TRANSPORT_HEADER_SIZE flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="processpath"><code>processPath</code></h3>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff552427(v=vs.85)">FWP_BYTE_BLOB</a> structure that contains the full path to the process that owns the endpoint. This member contains valid data only if the FWPS_METADATA_FIELD_PROCESS_PATH flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="token"><code>token</code></h3>

<p>A handle for the token used to validate the permissions for the user. This member contains valid data only if the FWPS_METADATA_FIELD_TOKEN flag is set in the <code>currentMetadataValues</code> member.</p>

<h3 id="processid"><code>processId</code></h3>

<p>The process ID for the process that owns the endpoint. This member contains valid data only if the FWPS_METADATA_FIELD_PROCESS_ID flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="sourceinterfaceindex"><code>sourceInterfaceIndex</code></h3>

<p>The index of the network interface where an incoming packet was received. This member contains valid data only if the FWPS_METADATA_FIELD_SOURCE_INTERFACE_INDEX flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="destinationinterfaceindex"><code>destinationInterfaceIndex</code></h3>

<p>The index of the network interface where an outgoing packet is to be sent. This member contains valid data only if the FWPS_METADATA_FIELD_DESTINATION_INTERFACE_INDEX flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="compartmentid"><code>compartmentId</code></h3>

<p>The identifier of the routing compartment in which the packet either was received or is being sent. Any modified packets should be injected back into the same routing compartment that is indicated for the original packet. This member contains valid data only if the FWPS_METADATA_FIELD_COMPARTMENT_ID flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="fragmentmetadata"><code>fragmentMetadata</code></h3>

<p>An <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_inbound_fragment_metadata0">FWPS_INBOUND_FRAGMENT_METADATA0</a> structure that describes the fragment data for a received packet fragment. This member contains valid data only if the FWPS_METADATA_FIELD_FRAGMENT_DATA flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="pathmtu"><code>pathMtu</code></h3>

<p>The path maximum transmission unit (path MTU) for an outbound packet. This value indicates the largest physical packet size, in bytes, that a network can transmit without fragmentation, This member contains valid data only if the FWPS_METADATA_FIELD_PATH_MTU flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="completionhandle"><code>completionHandle</code></h3>

<p>A completion handle that is required to pend the current filtering operation. This member contains valid data only if the FWPS_METADATA_FIELD_COMPLETION_HANDLE flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="transportendpointhandle"><code>transportEndpointHandle</code></h3>

<p>An endpoint handle that indicates the end of the packet to be injected into the outbound transport layer. This member contains valid data only if the FWPS_METADATA_FIELD_TRANSPORT_ENDPOINT_HANDLE flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="remotescopeid"><code>remoteScopeId</code></h3>

<p>The remote scope identifier to be used in outbound transport layer injection. This member contains valid data only if the FWPS_METADATA_FIELD_REMOTE_SCOPE_ID flag is set in the <strong>currentMetadataValues</strong> member.</p>

<h3 id="controldata"><code>controlData</code></h3>

<p>An optional socket control data object. This member contains valid data only if the FWPS_METADATA_FIELD_TRANSPORT_CONTROL_DATA flag is set in the <strong>currentMetadataValues</strong> member. For information about the WSACMSGHDR type, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ws2def/ns-ws2def-wsacmsghdr">CMSGHDR</a>.</p>

<h3 id="controldatalength"><code>controlDataLength</code></h3>

<p>The length, in bytes, of the <strong>controlData</strong> member.</p>

<h3 id="packetdirection"><code>packetDirection</code></h3>

<p>The direction of network traffic (inbound or outbound) as specified by one of the constant values of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff552433(v=vs.85)">FWP_DIRECTION</a>. This member is set at the application layer enforcement (ALE) connect or receive/accept layers during a reauthorization classify operation. For more information, see the Remarks section.</p>

<blockquote>
  <p>[!NOTE]
  This member contains valid data only if the FWPS_METADATA_FIELD_PACKET_DIRECTION flag is set in the <strong>currentMetadataValues</strong> member.</p>
</blockquote>

<h3 id="headerincludeheader"><code>headerIncludeHeader</code></h3>

<p>A pointer to the IP header if the packet is sent from a raw socket.</p>

<h3 id="headerincludeheaderlength"><code>headerIncludeHeaderLength</code></h3>

<p>The length, in bytes, of the IP header that is pointed to by <strong>headerIncludeHeader</strong>.</p>

<h3 id="destinationprefix"><code>destinationPrefix</code></h3>

<p>The destination prefix.</p>

<h3 id="framelength"><code>frameLength</code></h3>

<p>The frame length.</p>

<h3 id="parentendpointhandle"><code>parentEndpointHandle</code></h3>

<p>The handle of the endpoint's parent.</p>

<h3 id="icmpidandsequence"><code>icmpIdAndSequence</code></h3>

<p>The ICMP identifier and sequence.</p>

<h3 id="localredirecttargetpid"><code>localRedirectTargetPID</code></h3>

<p>The PID of the process that is responsible for a redirected connection.</p>

<h3 id="originaldestination"><code>originalDestination</code></h3>

<p>The original destination of a redirected connection.</p>

<h3 id="redirectrecords"><code>redirectRecords</code></h3>

<p>A redirect records handle that can be passed to the <a rel="noopener" target="_blank" href="fwpsqueryconnectionredirectstate0">FwpsQueryConnectionRedirectState0</a> function to get the redirect state.</p>

<h3 id="currentl2metadatavalues"><code>currentL2MetadataValues</code></h3>

<p>A bitmask that contains flags that specify which layer 2 values are set. One or more values can be combined with a bitwise OR.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>FWPS_L2_METADATA_FIELD_ETHERNET_MAC_HEADER_SIZE</strong></td>
  <td>The value of the <strong>ethernetMacHeaderSize</strong> member indicates the size of the MAC header.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_METADATA_FIELD_WIFI_OPERATION_MODE</strong></td>
  <td>The value of the <strong>wiFiOperationMode</strong> member indicates current Native 802.11 operation mode.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_METADATA_FIELD_VSWITCH_SOURCE_PORT_ID</strong></td>
  <td>The value of the <strong>vSwitchSourcePortId</strong> member indicates the identifier for the source port on the virtual switch.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_METADATA_FIELD_VSWITCH_SOURCE_NIC_INDEX</strong></td>
  <td>The value of the <strong>vSwitchSourceNicIndex</strong> member indicates the index for the source NIC on the virtual switch.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_METADATA_FIELD_VSWITCH_PACKET_CONTEXT</strong></td>
  <td>The value of the <strong>vSwitchPacketContext</strong> member indicates a HANDLE to the virtual switch packet context.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_METADATA_FIELD_VSWITCH_DESTINATION_PORT_ID</strong></td>
  <td>The value of the <strong>vSwitchDestinationPortId</strong> member indicates the identifier for the destination port on the virtual switch.</td>
</tr>
</tbody>
</table>

<h3 id="l2flags"><code>l2Flags</code></h3>

<p>A bitmask containing layer 2 flags that can be combined with a bitwise OR.</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>FWPS_L2_INCOMING_FLAG_IS_RAW_IPV4_FRAMING</strong></td>
  <td>Indicates raw IP4 framing.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_INCOMING_FLAG_IS_RAW_IPV6_FRAMING</strong></td>
  <td>Indicates raw IP6 framing.</td>
</tr>
<tr>
  <td><strong>FWPS_L2_INCOMING_FLAG_RECLASSIFY_MULTI_DESTINATION</strong></td>
  <td>This flag indicates that an NBL that was seen once at ingress has been distributed into multiple NBLs, each of which is destined to a different VM, and the first NBL of this distribution has already been indicated to your callout driver.<br><br>The first NBL of the distributed group will not have this flag set. All subsequent NBLs for the group will have this flag set.<br><br>For the purpose of injecting, your callout driver should clone the NBL, block and absorb the original packet, and clear the FWPS_RIGHT_ACTION_WRITE flag for the first indication. Then modify the clone and inject it into the ingress path.<br><br>For all subsequent indications, you should block and absorb the original packet and clear the FWPS_RIGHT_ACTION_WRITE flag for the clone. When the injected clone comes out of ingress, it will then be redistributed again, and all indications will have an injection state of FWPS_PACKET_INJECTED_BY_SELF or FWPS_PACKET_PREVIOUSLY_INJECTED_BY_SELF.</td>
</tr>
</tbody>
</table>

<h3 id="ethernetmacheadersize"><code>ethernetMacHeaderSize</code></h3>

<p>The size, in bytes, of the MAC header if the FWPS_L2_METADATA_FIELD_802_3_MAC_HEADER_SIZE flag is set. This flag is set for the inbound 802.3 layer only.</p>

<h3 id="wifioperationmode"><code>wiFiOperationMode</code></h3>

<p>The current Native 802.11 operation mode if the FWPS_L2_METADATA_FIELD_802_11_OPERATION_MODE flag is set. For more information, see <a rel="noopener" target="_blank" href="dot11_current_operation_mode">DOT11_CURRENT_OPERATION_MODE</a>.</p>

<h3 id="vswitchsourceportid"><code>vSwitchSourcePortId</code></h3>

<p>A unique identifier for the source port on the virtual switch.</p>

<h3 id="vswitchsourcenicindex"><code>vSwitchSourceNicIndex</code></h3>

<p>A index for the source NIC on the virtual switch.</p>

<h3 id="vswitchdestinationportid"><code>vSwitchDestinationPortId</code></h3>

<p>A unique identifier for the destination port on the virtual switch.</p>

<h3 id="padding0"><code>padding0</code></h3>

<p>Reserved.</p>

<h3 id="padding1"><code>padding1</code></h3>

<p>Reserved.</p>

<h3 id="padding2"><code>padding2</code></h3>

<p>Reserved.</p>

<h3 id="vswitchpacketcontext"><code>vSwitchPacketContext</code></h3>

<p>A handle to the virtual switch packet context.</p>

<h3 id="subprocesstag"><code>subProcessTag</code></h3>

<p>Reserved.</p>

<h3 id="reserved1"><code>reserved1</code></h3>

<p>Reserved.</p>

<h2 id="remarks">Remarks</h2>

<p>The filter engine passes a pointer to an FWPS_INCOMING_METADATA_VALUES0 structure to a callout's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a> callout function. The metadata values contained in the structure are not processed by the filter engine but are supplied to a callout's <em>classifyFn</em> callout function to provide additional information.</p>

<p>A callout driver can use the following macro to test if a specific metadata value is present in an FWPS_INCOMING_METADATA_VALUES0 structure:</p>

<div class="codehilite">
<pre><span></span><code><span class="n">FWPS_IS_METADATA_FIELD_PRESENT</span><span class="p">(</span><span class="n">metadataValues</span><span class="p">,</span><span class="w"> </span><span class="n">metadataField</span><span class="p">)</span>
</code></pre>
</div>

<p>If the FWPS_METADATA_FIELD_PACKET_DIRECTION metadata value is present in an FWPS_INCOMING_METADATA_VALUES0 structure, the **packetDirection** member specifies whether the packet was inbound or outbound during a reauthorization classify operation. Otherwise, the FWPS_METADATA_FIELD_PACKET_DIRECTION metadata value is not present.</p>

<p>The callout driver must follow these guidelines when it inspects the packet:</p>

<ul>
<li>At the ALE connect or receive/accept layers, the callout driver should not assume that the packet contains a valid IP header if <strong>packetDirection</strong> is set to <strong>FWP_DIRECTION_OUTBOUND</strong> and the FWPS_METADATA_FIELD_PACKET_DIRECTION metadata value is present.</li>
<li>At the ALE connect layer, if the FWPS_METADATA_FIELD_PACKET_DIRECTION metadata value is not present, the callout driver should assume a packet direction of FWP_DIRECTION_OUTBOUND.</li>
<li>At the ALE receive/accept layer, if the FWPS_METADATA_FIELD_PACKET_DIRECTION metadata value is not present, the callout driver should assume a packet direction of FWP_DIRECTION_INBOUND.</li>
</ul>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ws2def/ns-ws2def-wsacmsghdr">CMSGHDR</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_discard_metadata0">FWPS_DISCARD_METADATA0</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/fwpstypes/ns-fwpstypes-fwps_inbound_fragment_metadata0">FWPS_INBOUND_FRAGMENT_METADATA0</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff552427(v=vs.85)">FWP_BYTE_BLOB</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff552433(v=vs.85)">FWP_DIRECTION</a></li>
<li><a rel="noopener" target="_blank" href="fwpsqueryconnectionredirectstate0">FwpsQueryConnectionRedirectState0</a></li>
<li><a rel="noopener" target="_blank" href="net_buffer_list">NET_BUFFER_LIST</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/_netvista/">classifyFn</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/fwpsk/ns-fwpsk-fwps_incoming_metadata_values0_">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/fwpsk/ns-fwpsk-fwps_incoming_metadata_values0_.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
