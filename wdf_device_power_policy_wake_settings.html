<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfdevice.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                                 Size;
  <a href="device_power_state" title="typedef enum _DEVICE_POWER_STATE {&#10;  PowerDeviceUnspecified,&#10;  PowerDeviceD0,&#10;  PowerDeviceD1,&#10;  PowerDeviceD2,&#10;  PowerDeviceD3,&#10;  PowerDeviceMaximum&#10;} DEVICE_POWER_STATE, *PDEVICE_POWER_STATE;">DEVICE_POWER_STATE</a>                    DxState;
  <a href="wdf_power_policy_sx_wake_user_control" title="typedef enum _WDF_POWER_POLICY_SX_WAKE_USER_CONTROL {&#10;  WakeUserControlInvalid = 0,&#10;  WakeDoNotAllowUserControl,&#10;  WakeAllowUserControl&#10;} WDF_POWER_POLICY_SX_WAKE_USER_CONTROL;">WDF_POWER_POLICY_SX_WAKE_USER_CONTROL</a> UserControlOfWakeSettings;
  <a href="wdf_tri_state" title="typedef enum _WDF_TRI_STATE {&#10;  WdfFalse = FALSE,&#10;  WdfTrue = TRUE,&#10;  WdfUseDefault = 2&#10;} WDF_TRI_STATE, *PWDF_TRI_STATE;">WDF_TRI_STATE</a>                         Enabled;
  BOOLEAN                               ArmForWakeIfChildrenAreArmedForWake;
  BOOLEAN                               IndicateChildWakeOnParentWake;
} WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS, *PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/ns-wdfdevice-_wdf_device_power_policy_wake_settings">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdf_device_power_policy_wake_settings.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-wdfdevice-_wdf_device_power_policy_wake_settings)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS structure</h1>
<h2>Description</h2>
<p>[Applies to KMDF and UMDF]</p>
<p>The <strong>WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS</strong> structure contains driver-supplied information about a device's ability to wake itself and the system, when both are in a low-power state.</p>
<h2>Members</h2>
<h3><code>Size</code></h3>
<p>The size, in bytes, of this structure.</p>
<h3><code>DxState</code></h3>
<p>A <a href="device_power_state" title="typedef enum _DEVICE_POWER_STATE {&#10;  PowerDeviceUnspecified,&#10;  PowerDeviceD0,&#10;  PowerDeviceD1,&#10;  PowerDeviceD2,&#10;  PowerDeviceD3,&#10;  PowerDeviceMaximum&#10;} DEVICE_POWER_STATE, *PDEVICE_POWER_STATE;">DEVICE_POWER_STATE</a>-typed enumerator that identifies the low <a href="https://learn.microsoft.com/windows-hardware/drivers/kernel/device-power-states">device power state</a> that the device will enter when the system power state drops to a wakeable low-power state. The value of <strong>DxState</strong> cannot be <strong>PowerDeviceD0</strong>. <strong><a href="device_power_state" title="typedef enum _DEVICE_POWER_STATE {&#10;  PowerDeviceUnspecified,&#10;  PowerDeviceD0,&#10;  PowerDeviceD1,&#10;  PowerDeviceD2,&#10;  PowerDeviceD3,&#10;  PowerDeviceMaximum&#10;} DEVICE_POWER_STATE, *PDEVICE_POWER_STATE;">DEVICE_POWER_STATE</a></strong> values are defined in <em>wdm.h</em>.</p>
<h3><code>UserControlOfWakeSettings</code></h3>
<p>A <a href="wdf_power_policy_sx_wake_user_control" title="typedef enum _WDF_POWER_POLICY_SX_WAKE_USER_CONTROL {&#10;  WakeUserControlInvalid = 0,&#10;  WakeDoNotAllowUserControl,&#10;  WakeAllowUserControl&#10;} WDF_POWER_POLICY_SX_WAKE_USER_CONTROL;">WDF_POWER_POLICY_SX_WAKE_USER_CONTROL</a>-typed enumerator that indicates whether users have the ability to modify the device's wake settings.</p>
<h3><code>Enabled</code></h3>
<p>A <a href="wdf_tri_state" title="typedef enum _WDF_TRI_STATE {&#10;  WdfFalse = FALSE,&#10;  WdfTrue = TRUE,&#10;  WdfUseDefault = 2&#10;} WDF_TRI_STATE, *PWDF_TRI_STATE;">WDF_TRI_STATE</a>-typed enumerator that indicates whether the device can wake the system (that is, restore the system to S0) when the system is in a low-power state. This member can have one of the following values:</p>
<p><strong>WdfTrue</strong> - Waking the system is enabled.</p>
<p><strong>WdfFalse</strong> - Waking the system is disabled.</p>
<p><strong>WdfUseDefault</strong> - Waking the system is initially enabled by default; but if the <strong>UserControlOfWakeSettings</strong> member is set to <strong>WakeAllowUserControl</strong>, the <a href="https://learn.microsoft.com/windows-hardware/drivers/wdf/user-control-of-device-idle-and-wake-behavior">user's setting or driver's INF file</a> overrides the initial value.</p>
<p>If waking the system is enabled and the system is about to enter a low-power state, the framework calls the driver's <a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_arm_wake_from_sx">EvtDeviceArmWakeFromSx</a> or <a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_arm_wake_from_sx_with_reason">EvtDeviceArmWakeFromSxWithReason</a> callback function before the device enters a low-power state.</p>
<h3><code>ArmForWakeIfChildrenAreArmedForWake</code></h3>
<p>A Boolean value that, if set to <strong>TRUE</strong>, indicates that a parent device's ability to wake itself and the system should be enabled when this ability is enabled for the device's child devices. For more information, see the following Remarks section. This member is available in version 1.7 and later versions of KMDF.</p>
<h3><code>IndicateChildWakeOnParentWake</code></h3>
<p>A Boolean value that, if set to <strong>TRUE</strong>, indicates that the framework will provide wake-up status to child devices if a parent device detects a wake-up signal. For more information, see the following Remarks section. This member is available in version 1.7 and later versions of KMDF.</p>
<h2>Remarks</h2>
<p>The <strong>WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS</strong> structure is used as input to <a href="wdfdeviceassignsxwakesettings" title="NTSTATUS WdfDeviceAssignSxWakeSettings(&#10;  [in] WDFDEVICE                              Device,&#10;  [in] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WdfDeviceAssignSxWakeSettings</a>.</p>
<p>To initialize its <strong>WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS</strong> structure, your driver should call <a href="wdf_device_power_policy_wake_settings_init" title="VOID WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS_INIT(&#10;  [out] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS_INIT</a>.</p>
<p>The first time a driver calls <a href="wdfdeviceassignsxwakesettings" title="NTSTATUS WdfDeviceAssignSxWakeSettings(&#10;  [in] WDFDEVICE                              Device,&#10;  [in] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WdfDeviceAssignSxWakeSettings</a>, the following actions occur:</p>
<ul>
<li>The framework stores the values of all <strong>WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS</strong> structure members.</li>
<li>If the <strong>UserControlOfWakeSettings</strong> member is set to <strong>WakeAllowUserControl</strong> and if the <strong>Enabled</strong> member is set to <strong>WdfUseDefault</strong>, the framework reads the registry to find out if the user has enabled waking the system.</li>
</ul>
<p>During subsequent calls to <a href="wdfdeviceassignsxwakesettings" title="NTSTATUS WdfDeviceAssignSxWakeSettings(&#10;  [in] WDFDEVICE                              Device,&#10;  [in] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WdfDeviceAssignSxWakeSettings</a>, the framework does not store the value of the <strong>UserControlOfWakeSettings</strong> member. In other words, the framework performs the following steps the first time the driver calls <strong><a href="wdfdeviceassignsxwakesettings" title="NTSTATUS WdfDeviceAssignSxWakeSettings(&#10;  [in] WDFDEVICE                              Device,&#10;  [in] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WdfDeviceAssignSxWakeSettings</a></strong> but not during later calls:</p>
<ul>
<li>Stores the value of the <strong>UserControlOfWakeSettings</strong> member.</li>
<li>Looks for a user setting in the registry, if the value of the <strong>Enabled</strong> member is <strong>WdfUseDefault</strong>.</li>
</ul>
<p>The following rules apply to the value that you specify for the <strong>DxState</strong> member:</p>
<ul>
<li>The value cannot be <strong>PowerDeviceD0</strong>.</li>
<li>If you specify <strong>PowerDeviceMaximum</strong>, the framework uses the value that the driver for the device's bus supplied in the <strong>DeviceWake</strong> member of its <a href="wdf_device_power_capabilities" title="typedef struct _WDF_DEVICE_POWER_CAPABILITIES {&#10;  ULONG              Size;&#10;  WDF_TRI_STATE      DeviceD1;&#10;  WDF_TRI_STATE      DeviceD2;&#10;  WDF_TRI_STATE      WakeFromD0;&#10;  WDF_TRI_STATE      WakeFromD1;&#10;  WDF_TRI_STATE      WakeFromD2;&#10;  WDF_TRI_STATE      WakeFromD3;&#10;  DEVICE_POWER_STATE DeviceState[PowerSystemMaximum];&#10;  DEVICE_POWER_STATE DeviceWake;&#10;  SYSTEM_POWER_STATE SystemWake;&#10;  ULONG              D1Latency;&#10;  ULONG              D2Latency;&#10;  ULONG              D3Latency;&#10;  DEVICE_POWER_STATE IdealDxStateForSx;&#10;} WDF_DEVICE_POWER_CAPABILITIES, *PWDF_DEVICE_POWER_CAPABILITIES;">WDF_DEVICE_POWER_CAPABILITIES</a> structure.</li>
<li>You cannot specify a device power state that is lower than the device power state in the <strong>DeviceWake</strong> member of the bus driver's <a href="wdf_device_power_capabilities" title="typedef struct _WDF_DEVICE_POWER_CAPABILITIES {&#10;  ULONG              Size;&#10;  WDF_TRI_STATE      DeviceD1;&#10;  WDF_TRI_STATE      DeviceD2;&#10;  WDF_TRI_STATE      WakeFromD0;&#10;  WDF_TRI_STATE      WakeFromD1;&#10;  WDF_TRI_STATE      WakeFromD2;&#10;  WDF_TRI_STATE      WakeFromD3;&#10;  DEVICE_POWER_STATE DeviceState[PowerSystemMaximum];&#10;  DEVICE_POWER_STATE DeviceWake;&#10;  SYSTEM_POWER_STATE SystemWake;&#10;  ULONG              D1Latency;&#10;  ULONG              D2Latency;&#10;  ULONG              D3Latency;&#10;  DEVICE_POWER_STATE IdealDxStateForSx;&#10;} WDF_DEVICE_POWER_CAPABILITIES, *PWDF_DEVICE_POWER_CAPABILITIES;">WDF_DEVICE_POWER_CAPABILITIES</a> structure. (In other words, if the bus driver's <strong>DeviceWake</strong> value is <strong>PowerDeviceD2</strong>, your function driver's <strong>DxState</strong> value cannot be <strong>PowerDeviceD3</strong>.)</li>
</ul>
<p>For information about registry entries that control a device's wake capabilities, see <a href="https://learn.microsoft.com/windows-hardware/drivers/wdf/user-control-of-device-idle-and-wake-behavior">User Control of Device Idle and Wake Behavior</a>.</p>
<p>If the device that the <strong>WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS</strong> structure describes is a parent device, the driver for the parent device can use the <strong>ArmForWakeIfChildrenAreArmedForWake</strong> and <strong>IndicateChildWakeOnParentWake</strong> members as follows:</p>
<ul>
<li>
<p>If the driver sets the <strong>ArmForWakeIfChildrenAreArmedForWake</strong> member to <strong>TRUE</strong>, the framework calls the driver's <a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_arm_wake_from_sx">EvtDeviceArmWakeFromSx</a> or <a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_arm_wake_from_sx_with_reason">EvtDeviceArmWakeFromSxWithReason</a> callback function when a child device's wake ability is enabled, even if the parent device's wake ability is not enabled.</p>
<p>To reduce power consumption, you might not want to enable your device's wake ability unless a child device that also supports a wake ability is plugged in. If your driver sets the <strong>ArmForWakeIfChildrenAreArmedForWake</strong> member to <strong>TRUE</strong>, the <strong>Enabled</strong> member's values have the following meanings:</p>
<ul>
<li>If <strong>Enabled</strong> is <strong>WdfFalse</strong>, the framework enables your driver's wake ability only if a child device's wake ability is enabled.</li>
<li>If <strong>Enabled</strong> is <strong>WdfTrue</strong>, the framework always enables your driver's wake ability, whether your device has wake-enabled child devices or not.</li>
<li>If <strong>Enabled</strong> is <strong>WdfUseDefault</strong> and <strong>UserControlOfWakeSettings</strong> is <strong>WakeAllowUserControl</strong>, users can control whether your device is always wake-enabled or if it is wake-enabled only when your device has child devices that are wake-enabled.</li>
</ul>
</li>
<li>
<p>If the driver sets the <strong>IndicateChildWakeOnParentWake</strong> member to <strong>TRUE</strong>, the framework calls the <a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_wake_from_sx_triggered">EvtDeviceWakeFromSxTriggered</a> callback function in the parent device's driver and in the driver for each wake-enabled child device. If the driver sets this member to <strong>FALSE</strong>, the framework calls the <em>EvtDeviceWakeFromSxTriggered</em> callback function in the parent device's driver only. Your driver should set <strong>IndicateChildWakeOnParentWake</strong> to <strong>TRUE</strong> if the drivers for your device's children must examine hardware to determine why the system was awakened.</p>
</li>
</ul>
<p>For more information about how to support a device's wake ability, see <a href="https://learn.microsoft.com/windows-hardware/drivers/wdf/supporting-system-wake-up">Supporting System Wake-Up</a>.</p>
<h2>See also</h2>
<p><a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_arm_wake_from_sx">EvtDeviceArmWakeFromSx</a></p>
<p><a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_arm_wake_from_sx_with_reason">EvtDeviceArmWakeFromSxWithReason</a></p>
<p><a href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/nc-wdfdevice-evt_wdf_device_wake_from_sx_triggered">EvtDeviceWakeFromSxTriggered</a></p>
<p><a href="wdf_device_power_capabilities" title="typedef struct _WDF_DEVICE_POWER_CAPABILITIES {&#10;  ULONG              Size;&#10;  WDF_TRI_STATE      DeviceD1;&#10;  WDF_TRI_STATE      DeviceD2;&#10;  WDF_TRI_STATE      WakeFromD0;&#10;  WDF_TRI_STATE      WakeFromD1;&#10;  WDF_TRI_STATE      WakeFromD2;&#10;  WDF_TRI_STATE      WakeFromD3;&#10;  DEVICE_POWER_STATE DeviceState[PowerSystemMaximum];&#10;  DEVICE_POWER_STATE DeviceWake;&#10;  SYSTEM_POWER_STATE SystemWake;&#10;  ULONG              D1Latency;&#10;  ULONG              D2Latency;&#10;  ULONG              D3Latency;&#10;  DEVICE_POWER_STATE IdealDxStateForSx;&#10;} WDF_DEVICE_POWER_CAPABILITIES, *PWDF_DEVICE_POWER_CAPABILITIES;">WDF_DEVICE_POWER_CAPABILITIES</a></p>
<p><a href="wdf_device_power_policy_wake_settings_init" title="VOID WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS_INIT(&#10;  [out] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WDF_DEVICE_POWER_POLICY_WAKE_SETTINGS_INIT</a></p>
<p><a href="wdf_power_policy_sx_wake_user_control" title="typedef enum _WDF_POWER_POLICY_SX_WAKE_USER_CONTROL {&#10;  WakeUserControlInvalid = 0,&#10;  WakeDoNotAllowUserControl,&#10;  WakeAllowUserControl&#10;} WDF_POWER_POLICY_SX_WAKE_USER_CONTROL;">WDF_POWER_POLICY_SX_WAKE_USER_CONTROL</a></p>
<p><a href="wdfdeviceassignsxwakesettings" title="NTSTATUS WdfDeviceAssignSxWakeSettings(&#10;  [in] WDFDEVICE                              Device,&#10;  [in] PWDF_DEVICE_POWER_POLICY_WAKE_SETTINGS Settings&#10;);">WdfDeviceAssignSxWakeSettings</a></p>
<p><a href="wdfdeviceindicatewakestatus" title="NTSTATUS WdfDeviceIndicateWakeStatus(&#10;  [in] WDFDEVICE Device,&#10;  [in] NTSTATUS  WaitWakeStatus&#10;);">WdfDeviceIndicateWakeStatus</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfdevice/ns-wdfdevice-_wdf_device_power_policy_wake_settings">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfdevice/ns-wdfdevice-_wdf_device_power_policy_wake_settings.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
