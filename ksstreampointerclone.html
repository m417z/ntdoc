<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="KsStreamPointerClone - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>KsStreamPointerClone - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            KsStreamPointerClone - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ks.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">KSDDKAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> KsStreamPointerClone(
  [in]           <a href="ksstream_pointer" title="typedef struct _KSSTREAM_POINTER {&#10;  PVOID                    Context;&#10;  PKSPIN                   Pin;&#10;  PKSSTREAM_HEADER         StreamHeader;&#10;  PKSSTREAM_POINTER_OFFSET Offset;&#10;  KSSTREAM_POINTER_OFFSET  OffsetIn;&#10;  KSSTREAM_POINTER_OFFSET  OffsetOut;&#10;} KSSTREAM_POINTER, *PKSSTREAM_POINTER;">PKSSTREAM_POINTER</a>  StreamPointer,
  [in, optional] <a href="pfnksstreampointer" title="PFNKSSTREAMPOINTER Pfnksstreampointer;&#10;&#10;void Pfnksstreampointer(&#10;  [in] PKSSTREAM_POINTER StreamPointer&#10;)&#10;{...}">PFNKSSTREAMPOINTER</a> CancelCallback,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>              ContextSize,
  [out]          <a href="ksstream_pointer" title="typedef struct _KSSTREAM_POINTER {&#10;  PVOID                    Context;&#10;  PKSPIN                   Pin;&#10;  PKSSTREAM_HEADER         StreamHeader;&#10;  PKSSTREAM_POINTER_OFFSET Offset;&#10;  KSSTREAM_POINTER_OFFSET  OffsetIn;&#10;  KSSTREAM_POINTER_OFFSET  OffsetOut;&#10;} KSSTREAM_POINTER, *PKSSTREAM_POINTER;">PKSSTREAM_POINTER</a>  *CloneStreamPointer
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-ksstreampointerclone">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ksstreampointerclone.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ks-ksstreampointerclone)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>KsStreamPointerClone function</h1>
<h2>Description</h2>
<p>The <strong>KsStreamPointerClone</strong> function creates a clone of a given stream pointer.</p>
<h2>Parameters</h2>
<h3><code>StreamPointer</code> [in]</h3>
<p>A pointer to a <a href="ksstream_pointer" title="typedef struct _KSSTREAM_POINTER {&#10;  PVOID                    Context;&#10;  PKSPIN                   Pin;&#10;  PKSSTREAM_HEADER         StreamHeader;&#10;  PKSSTREAM_POINTER_OFFSET Offset;&#10;  KSSTREAM_POINTER_OFFSET  OffsetIn;&#10;  KSSTREAM_POINTER_OFFSET  OffsetOut;&#10;} KSSTREAM_POINTER, *PKSSTREAM_POINTER;">KSSTREAM_POINTER</a> structure representing the stream pointer that is to be cloned.</p>
<h3><code>CancelCallback</code> [in, optional]</h3>
<p>Optional. A pointer to a minidriver-supplied <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nc-ks-pfnksstreampointer">AVStrMiniCancelCallback</a> routine. AVStream calls this routine if the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> associated with <em>CloneStreamPointer</em> is canceled.</p>
<h3><code>ContextSize</code> [in]</h3>
<p>This parameter indicates how many bytes of minidriver context information the resulting clone stream pointer should have. If nonzero, the requested number of bytes are allocated immediately after the returned stream pointer, and the <em>Context</em> field of <em>CloneStreamPointer</em> points to the allocated memory.</p>
<h3><code>CloneStreamPointer</code> [out]</h3>
<p>A pointer to a pointer to a <a href="ksstream_pointer" title="typedef struct _KSSTREAM_POINTER {&#10;  PVOID                    Context;&#10;  PKSPIN                   Pin;&#10;  PKSSTREAM_HEADER         StreamHeader;&#10;  PKSSTREAM_POINTER_OFFSET Offset;&#10;  KSSTREAM_POINTER_OFFSET  OffsetIn;&#10;  KSSTREAM_POINTER_OFFSET  OffsetOut;&#10;} KSSTREAM_POINTER, *PKSSTREAM_POINTER;">KSSTREAM_POINTER</a> structure. Upon successful completion of the cloning operation, <em>CloneStreamPointer</em> contains a pointer to the address of the cloned stream pointer.</p>
<h2>Return value</h2>
<p><strong>KsStreamPointerClone</strong> returns either <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a>, indicating that the cloning operation completed normally, or an appropriate error code.</p>
<h2>Remarks</h2>
<p>The resulting clone initially refers to the same data frame as the original stream pointer and is in the same state (locked or unlocked). Adding a clone stream pointer referencing a data frame increments the reference count on that particular frame. Note that the frame in question, and therefore the <a href="irp" title="typedef struct _IRP {&#10;  CSHORT                    Type;&#10;  USHORT                    Size;&#10;  PMDL                      MdlAddress;&#10;  ULONG                     Flags;&#10;  union {&#10;    struct _IRP     *MasterIrp;&#10;    __volatile LONG IrpCount;&#10;    PVOID           SystemBuffer;&#10;  } AssociatedIrp;&#10;  LIST_ENTRY                ThreadListEntry;&#10;  IO_STATUS_BLOCK           IoStatus;&#10;  KPROCESSOR_MODE           RequestorMode;&#10;  BOOLEAN                   PendingReturned;&#10;  CHAR                      StackCount;&#10;  CHAR                      CurrentLocation;&#10;  BOOLEAN                   Cancel;&#10;  KIRQL                     CancelIrql;&#10;  CCHAR                     ApcEnvironment;&#10;  UCHAR                     AllocationFlags;&#10;...">IRP</a> to which the frame belongs, is not completed until the reference count drops to zero.</p>
<p>You can use the <em>ContextSize</em> parameter of this call to minimize allocation calls.</p>
<p>Also see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/stream/stream-pointers">Stream Pointers</a>.</p>
<h2>See also</h2>
<p><a href="ksstreampointeradvance" title="KSDDKAPI NTSTATUS KsStreamPointerAdvance(&#10;  [in] PKSSTREAM_POINTER StreamPointer&#10;);">KsStreamPointerAdvance</a></p>
<p><a href="ksstreampointeradvanceoffsets" title="KSDDKAPI NTSTATUS KsStreamPointerAdvanceOffsets(&#10;  [in] PKSSTREAM_POINTER StreamPointer,&#10;  [in] ULONG             InUsed,&#10;  [in] ULONG             OutUsed,&#10;  [in] BOOLEAN           Eject&#10;);">KsStreamPointerAdvanceOffsets</a></p>
<p><a href="ksstreampointeradvanceoffsetsandunlock" title="void KsStreamPointerAdvanceOffsetsAndUnlock(&#10;  [in] PKSSTREAM_POINTER StreamPointer,&#10;  [in] ULONG             InUsed,&#10;  [in] ULONG             OutUsed,&#10;  [in] BOOLEAN           Eject&#10;);">KsStreamPointerAdvanceOffsetsAndUnlock</a></p>
<p><a href="ksstreampointerdelete" title="void KsStreamPointerDelete(&#10;  [in] PKSSTREAM_POINTER StreamPointer&#10;);">KsStreamPointerDelete</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/devtest/ks-ksstreampointerlock">KsStreamPointerLock</a></p>
<p><a href="ksstreampointerunlock" title="void KsStreamPointerUnlock(&#10;  [in] PKSSTREAM_POINTER StreamPointer,&#10;  [in] BOOLEAN           Eject&#10;);">KsStreamPointerUnlock</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ks/nf-ks-ksstreampointerclone">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ks/nf-ks-ksstreampointerclone.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
