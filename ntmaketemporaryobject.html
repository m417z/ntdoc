<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtMakeTemporaryObject - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtMakeTemporaryObject - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtMakeTemporaryObject - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTOBAPI_H
//
// Objects, handles
//
#if (PHNT_MODE != PHNT_MODE_KERNEL)

</span><span class="ntdoc-code-intro language-cpp">/**
 * The NtMakeTemporaryObject routine changes the attributes of an object to make it temporary.
 *
 * \param Handle Handle to an object of any type.
 * \return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 * \sa https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmaketemporaryobject
 */
</span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtMakeTemporaryObject(
    _In_ HANDLE Handle
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/5bf185f38fde2fd76daccdbcbaa0ded0f287eecd/phnt/include/ntobapi.h#L264">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwMakeTemporaryObject(
    _In_ HANDLE Handle
    );
</span><span class="ntdoc-code-footer language-cpp">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/5bf185f38fde2fd76daccdbcbaa0ded0f287eecd/phnt/include/ntzwapi.h#L2319">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// wdm.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwMakeTemporaryObject(
  [in] HANDLE Handle
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmaketemporaryobject">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<p>Removes the permanent flag from the object, restoring its lifetime to be dependant on the number of handles. This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmaketemporaryobject">documented in Windows Driver Kit</a>.</p>
<h1>Parameters</h1>
<ul>
<li><code>Handle</code> - a handle to a kernel object. The handle must grant <code>DELETE</code> access.</li>
</ul>
<h1>Remarks</h1>
<p>This function undoes the effects of <code><a href="ntmakepermanentobject" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMakePermanentObject(&#10;    _In_ HANDLE Handle&#10;    );">NtMakePermanentObject</a></code> and specifying <code><a href="obj_permanent" title="#define OBJ_PERMANENT 0x00000010L">OBJ_PERMANENT</a></code> in <code><a href="object_attributes" title="typedef struct _OBJECT_ATTRIBUTES&#10;{&#10;    ULONG Length;&#10;    HANDLE RootDirectory;&#10;    PCUNICODE_STRING ObjectName;&#10;    ULONG Attributes;&#10;    PSECURITY_DESCRIPTOR SecurityDescriptor;&#10;    PSECURITY_QUALITY_OF_SERVICE SecurityQualityOfService;&#10;} OBJECT_ATTRIBUTES, *POBJECT_ATTRIBUTES;">OBJECT_ATTRIBUTES</a></code>.</p>
<h1>See also</h1>
<ul>
<li><code><a href="ntmakepermanentobject" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtMakePermanentObject(&#10;    _In_ HANDLE Handle&#10;    );">NtMakePermanentObject</a></code></li>
<li><code><a href="obj_permanent" title="#define OBJ_PERMANENT 0x00000010L">OBJ_PERMANENT</a></code></li>
<li><code><a href="object_basic_information" title="typedef struct _OBJECT_BASIC_INFORMATION&#10;{&#10;    ULONG Attributes;               // The attributes of the object include whether the object is permanent, can be inherited, and other characteristics.&#10;    ACCESS_MASK GrantedAccess;      // Specifies a mask that represents the granted access when the object was created.&#10;    ULONG HandleCount;              // The number of handles that are currently open for the object.&#10;    ULONG PointerCount;             // The number of references to the object from both handles and other references, such as those from the system.&#10;    ULONG PagedPoolCharge;          // The amount of paged pool memory that the object is using.&#10;    ULONG NonPagedPoolCharge;       // The amount of non-paged pool memory that the object is using.&#10;    ULONG Reserved[3];              // Reserved for future use.&#10;    ULONG NameInfoSize;             // The size of the name information for the object.&#10;    ULONG TypeInfoSize;             // The size of the type information for the object.&#10;    ULONG SecurityDescriptorSize;   // The size of the security descriptor for the object.&#10;    LARGE_INTEGER CreationTime;     // The time when a symbolic link was created. Not supported for other types of objects.&#10;} OBJECT_BASIC_INFORMATION, *POBJECT_BASIC_INFORMATION;">OBJECT_BASIC_INFORMATION</a></code></li>
<li><code><a href="ntqueryobject" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryObject(&#10;    _In_opt_ HANDLE Handle,&#10;    _In_ OBJECT_INFORMATION_CLASS ObjectInformationClass,&#10;    _Out_writes_bytes_opt_(ObjectInformationLength) PVOID ObjectInformation,&#10;    _In_ ULONG ObjectInformationLength,&#10;    _Out_opt_ PULONG ReturnLength&#10;    );">NtQueryObject</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntmaketemporaryobject.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwmaketemporaryobject)</h1>
</div>
<div class="ntdoc-description">
<h2>Description</h2>
<p>The <strong>ZwMakeTemporaryObject</strong> routine changes the attributes of an object to make it temporary.</p>
<h2>Parameters</h2>
<h3><code>Handle</code> [in]</h3>
<p>Handle to an object of any type.</p>
<h2>Return value</h2>
<p><strong>ZwMakeTemporaryObject</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success, or the appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> error code on failure.</p>
<h2>Remarks</h2>
<p><strong>ZwMakeTemporaryObject</strong> is a generic routine that operates on any type of object.</p>
<p>An object is permanent if it was created with the <a href="obj_permanent" title="#define OBJ_PERMANENT 0x00000010L">OBJ_PERMANENT</a> object attribute specified. (For more information about object attributes, see <a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a>.) A permanent object is created with a reference count of 1, so it is not deleted when a driver dereferences it.</p>
<p>An object is temporary if it is not permanent. <strong>ZwMakeTemporaryObject</strong> turns the specified object into a temporary object. If the object is already temporary, this routine does nothing.</p>
<p>A temporary object has a name only as long as its handle count is greater than zero. When the handle count reaches zero, the system deletes the object name and appropriately adjusts the object's pointer count.</p>
<p>If the call to this function occurs in user mode, you should use the name &quot;<strong>NtMakeTemporaryObject</strong>&quot; instead of &quot;<strong>ZwMakeTemporaryObject</strong>&quot;.</p>
<p>For calls from kernel-mode drivers, the <strong>Nt<em>Xxx</em></strong> and <strong>Zw<em>Xxx</em></strong> versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt<em>Xxx</em></strong> and <strong>Zw<em>Xxx</em></strong> versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>
<h2>See also</h2>
<p><a href="initializeobjectattributes" title="#define InitializeObjectAttributes(p, n, a, r, s) { \&#10;    (p)-&gt;Length = sizeof(OBJECT_ATTRIBUTES); \&#10;    (p)-&gt;RootDirectory = r; \&#10;    (p)-&gt;Attributes = a; \&#10;    (p)-&gt;ObjectName = n; \&#10;    (p)-&gt;SecurityDescriptor = s; \&#10;    (p)-&gt;SecurityQualityOfService = NULL; \&#10;    }">InitializeObjectAttributes</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a></p>
<p><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a></p>
<p><a href="ntcreatedirectoryobject" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateDirectoryObject(&#10;    _Out_ PHANDLE DirectoryHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwCreateDirectoryObject</a></p>
<p><a href="ntcreatefile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateFile(&#10;    _Out_ PHANDLE FileHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER AllocationSize,&#10;    _In_ ULONG FileAttributes,&#10;    _In_ ULONG ShareAccess,&#10;    _In_ ULONG CreateDisposition,&#10;    _In_ ULONG CreateOptions,&#10;    _In_reads_bytes_opt_(EaLength) PVOID EaBuffer,&#10;    _In_ ULONG EaLength&#10;    );">ZwCreateFile</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmaketemporaryobject">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwmaketemporaryobject.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwmaketemporaryobject">documented in Windows Driver Kit</a>.</p>
<hr />
<p><em>(Also available in Win2000 DDK)</em></p>
<p>Function clears object's <em>PERMANENT</em> flag, so it's live as long as the latest <code>HANDLE</code> is closed.</p>
<h3>ObjectHandle</h3>
<p><code>HANDLE</code> to object to make temporary.</p>
<h1>Documented by</h1>
<ul>
<li>Tomasz Nowak</li>
</ul>
<h1>See also</h1>
<ul>
<li><code><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">NtClose</a></code></li>
<li><code><a href="ntqueryobject" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryObject(&#10;    _In_opt_ HANDLE Handle,&#10;    _In_ OBJECT_INFORMATION_CLASS ObjectInformationClass,&#10;    _Out_writes_bytes_opt_(ObjectInformationLength) PVOID ObjectInformation,&#10;    _In_ ULONG ObjectInformationLength,&#10;    _Out_opt_ PULONG ReturnLength&#10;    );">NtQueryObject</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntmaketemporaryobject.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
