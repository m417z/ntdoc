<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGKDDI_SUSPENDCONTEXT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGKDDI_SUSPENDCONTEXT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGKDDI_SUSPENDCONTEXT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// d3dkmddi.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">DXGKDDI_SUSPENDCONTEXT DxgkddiSuspendcontext;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> DxgkddiSuspendcontext(
  IN_CONST_HANDLE hAdapter,
  IN_CONST_PDXGKARG_SUSPENDCONTEXT pSuspendContext
)
{...}</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_suspendcontext">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgkddi_suspendcontext.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-d3dkmddi-dxgkddi_suspendcontext)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>DXGKDDI_SUSPENDCONTEXT callback function</h1>
<h2>Description</h2>
<p><strong>DxgkddiSuspendContext</strong> instructs the GPU to suspend a context. If the GPU doesn’t acknowledge the suspend completion within the TDR (timeout detection and recovery) timeout, the OS will detect the engine timeout and perform an engine reset.</p>
<h2>Parameters</h2>
<h3><code>hAdapter</code></h3>
<p>[in] The hardware context to be preempted and marked as suspended. This type of preemption request doesn't have a grace period, and is expected to be honored by the GPU as soon as possible.</p>
<h3><code>pSuspendContext</code></h3>
<p>[in] Pointer to a <strong><a href="dxgkarg_suspendcontext" title="typedef struct _DXGKARG_SUSPENDCONTEXT {&#10;  HANDLE hContext;&#10;  UINT64 contextSuspendFence;&#10;} DXGKARG_SUSPENDCONTEXT;">DXGKARG_SUSPENDCONTEXT</a></strong> structure that contains additional arguments for this function.</p>
<h2>Return value</h2>
<p><strong>DxgkddiSuspendContext</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the context is already suspended at the time of this call. Otherwise, this value is set to STATUS_PENDING, and the suspend operation will be finished when <strong>contextSuspendFence</strong> is signaled via an interrupt.</p>
<h2>Remarks</h2>
<p>Register your implementation of this callback function by setting it in <strong><a href="driver_initialization_data" title="typedef struct _DRIVER_INITIALIZATION_DATA {&#10;  ULONG                                                   Version;&#10;  PDXGKDDI_ADD_DEVICE                                     DxgkDdiAddDevice;&#10;  PDXGKDDI_START_DEVICE                                   DxgkDdiStartDevice;&#10;  PDXGKDDI_STOP_DEVICE                                    DxgkDdiStopDevice;&#10;  PDXGKDDI_REMOVE_DEVICE                                  DxgkDdiRemoveDevice;&#10;  PDXGKDDI_DISPATCH_IO_REQUEST                            DxgkDdiDispatchIoRequest;&#10;  PDXGKDDI_INTERRUPT_ROUTINE                              DxgkDdiInterruptRoutine;&#10;  PDXGKDDI_DPC_ROUTINE                                    DxgkDdiDpcRoutine;&#10;  PDXGKDDI_QUERY_CHILD_RELATIONS                          DxgkDdiQueryChildRelations;&#10;  PDXGKDDI_QUERY_CHILD_STATUS                             DxgkDdiQueryChildStatus;&#10;  PDXGKDDI_QUERY_DEVICE_DESCRIPTOR                        DxgkDdiQueryDeviceDescriptor;&#10;  PDXGKDDI_SET_POWER_STATE                                DxgkDdiSetPowerState;&#10;  PDXGKDDI_NOTIFY_ACPI_EVENT                              DxgkDdiNotifyAcpiEvent;&#10;  PDXGKDDI_RESET_DEVICE                                   DxgkDdiResetDevice;&#10;  PDXGKDDI_UNLOAD                                         DxgkDdiUnload;&#10;  PDXGKDDI_QUERY_INTERFACE                                DxgkDdiQueryInterface;&#10;  PDXGKDDI_CONTROL_ETW_LOGGING                            DxgkDdiControlEtwLogging;&#10;  PDXGKDDI_QUERYADAPTERINFO                               DxgkDdiQueryAdapterInfo;&#10;  PDXGKDDI_CREATEDEVICE                                   DxgkDdiCreateDevice;&#10;...">DRIVER_INITIALIZATION_DATA</a></strong>.</p>
<p>Even though the round robin preemption can be initiated by the GPU, the OS still needs a way to preempt the context for other reasons; for example, if it needs to move its allocations around or perform a GPU power transition.</p>
<p>The context suspend value is necessary to handle cases when the OS suspends a context, doesn’t wait for the suspend acknowledgment, resumes, and suspends a context again. The suspend value will allow the OS to distinguish between the previous suspend acknowledgement and the latest one.</p>
<p>Once a context is suspended, it is assumed that all references to it are gone from the GPU, and the OS is free to destroy the context or move its memory around. Unlike WDDM 2.3 or earlier, no separate NULL context switch command (previously indicated by the <strong>ContextSwitch</strong> flag in <strong>DxgkDdiSubmitCommandVirtual</strong>) is present in WDDM 2.4 scheduling mode, because <strong>DxgkddiSuspendContext</strong> is supposed to do this work.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_resumecontext"><strong>DxgkddiResumeContext</strong></a></p>
<p><strong><a href="dxgkarg_suspendcontext" title="typedef struct _DXGKARG_SUSPENDCONTEXT {&#10;  HANDLE hContext;&#10;  UINT64 contextSuspendFence;&#10;} DXGKARG_SUSPENDCONTEXT;">DXGKARG_SUSPENDCONTEXT</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_suspendcontext">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/nc-d3dkmddi-dxgkddi_suspendcontext.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
