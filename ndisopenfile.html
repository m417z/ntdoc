<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisOpenFile - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisOpenFile - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisOpenFile - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndis.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">VOID NdisOpenFile(
  [out] PNDIS_STATUS          Status,
  [out] PNDIS_HANDLE          FileHandle,
  [out] PUINT                 FileLength,
  [in]  PNDIS_STRING          FileName,
  [in]  NDIS_PHYSICAL_ADDRESS HighestAcceptableAddress
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisopenfile">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndisopenfile.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndisopenfile)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ndisopenfile-function">NdisOpenFile function</h1>

<h2 id="description">Description</h2>

<p>The
<strong>NdisOpenFile</strong> function returns a handle for an opened file.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="status-out"><code>Status</code> [out]</h3>

<p>A pointer to a caller-supplied variable in which this function returns the status of the open file
operation, which can be one of the following:</p>

<h4 id="ndis_status_success">NDIS_STATUS_SUCCESS</h4>

<p>The handle at
<em>FileHandle</em> is valid for a subsequent call to
<strong><a href="ndismapfile" title="VOID NdisMapFile(&#10;  [out] PNDIS_STATUS Status,&#10;  [out] PVOID        *MappedBuffer,&#10;  [in]  NDIS_HANDLE  FileHandle&#10;);">NdisMapFile</a></strong>.</p>

<h4 id="ndis_status_file_not_found">NDIS_STATUS_FILE_NOT_FOUND</h4>

<p>The given string at
<em>FileName</em> did not specify a name found in the system object namespace.</p>

<h4 id="ndis_status_resources">NDIS_STATUS_RESOURCES</h4>

<p>NDIS could not allocate the resources it needed to open the file and allocate a buffer for the
file contents.</p>

<h4 id="ndis_status_error_reading_file">NDIS_STATUS_ERROR_READING_FILE</h4>

<p>The specified file's data could not be read into system memory for subsequent access by the
caller.</p>

<h3 id="filehandle-out"><code>FileHandle</code> [out]</h3>

<p>A pointer to a caller-supplied variable in which this function returns the handle of the opened
file if the call succeeds.</p>

<h3 id="filelength-out"><code>FileLength</code> [out]</h3>

<p>A pointer to a caller-supplied variable in which this function writes the number of bytes of data
in the opened file if the call succeeds.</p>

<h3 id="filename-in"><code>FileName</code> [in]</h3>

<p>A pointer to an NDIS_STRING type containing an initialized counted string, in the system-default
character set, naming the file to be opened. For Windows 2000 and later drivers, this string contains
Unicode characters. That is, for Windows 2000 and later, NDIS defines the NDIS_STRING type as a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ntdef/ns-ntdef-_unicode_string">UNICODE_STRING</a> type.</p>

<h3 id="highestacceptableaddress-in"><code>HighestAcceptableAddress</code> [in]</h3>

<p>The highest physical address in which the file data can be stored, or specifies -1 if the driver
places no restrictions.</p>

<h2 id="remarks">Remarks</h2>

<p><strong>NdisOpenFile</strong> opens a disk file, typically a file the driver will later download to program an
intelligent NIC.
<strong>NdisOpenFile</strong> also allocates storage to hold file contents for the driver's subsequent call to the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismapfile">NdisMapFile</a> function.</p>

<p>A miniport driver should call
<strong>NdisOpenFile</strong> only from the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a> function.</p>

<p>When
<strong>NdisOpenFile</strong> returns, the miniport driver can access file data by calling
<strong><a href="ndismapfile" title="VOID NdisMapFile(&#10;  [out] PNDIS_STATUS Status,&#10;  [out] PVOID        *MappedBuffer,&#10;  [in]  NDIS_HANDLE  FileHandle&#10;);">NdisMapFile</a></strong>. It can call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisunmapfile">NdisUnmapFile</a> function to page out the file
so it does not consume resources unnecessarily while the driver is not accessing the file data. When
finished using the file,
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a> must call the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisclosefile">NdisCloseFile</a> function.</p>

<blockquote>
  <p>[!NOTE]
   <strong>NdisOpenFile</strong>, <strong><a href="ndisclosefile" title="VOID NdisCloseFile(&#10;  [in] NDIS_HANDLE FileHandle&#10;);">NdisCloseFile</a></strong>, <strong><a href="ndismapfile" title="VOID NdisMapFile(&#10;  [out] PNDIS_STATUS Status,&#10;  [out] PVOID        *MappedBuffer,&#10;  [in]  NDIS_HANDLE  FileHandle&#10;);">NdisMapFile</a></strong> and <strong><a href="ndisunmapfile" title="VOID NdisUnmapFile(&#10;  [in] NDIS_HANDLE FileHandle&#10;);">NdisUnmapFile</a></strong> are not supported on ARM64. On ARM64, replace these functions with calls to <strong><a href="ntcreatefile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateFile(&#10;    _Out_ PHANDLE FileHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER AllocationSize,&#10;    _In_ ULONG FileAttributes,&#10;    _In_ ULONG ShareAccess,&#10;    _In_ ULONG CreateDisposition,&#10;    _In_ ULONG CreateOptions,&#10;    _In_reads_bytes_opt_(EaLength) PVOID EaBuffer,&#10;    _In_ ULONG EaLength&#10;    );">ZwCreateFile</a></strong>, <strong><a href="ntreadfile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtReadFile(&#10;    _In_ HANDLE FileHandle,&#10;    _In_opt_ HANDLE Event,&#10;    _In_opt_ PIO_APC_ROUTINE ApcRoutine,&#10;    _In_opt_ PVOID ApcContext,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _Out_writes_bytes_(Length) PVOID Buffer,&#10;    _In_ ULONG Length,&#10;    _In_opt_ PLARGE_INTEGER ByteOffset,&#10;    _In_opt_ PULONG Key&#10;    );">ZwReadFile</a></strong>, or other similar operations.</p>
</blockquote>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisclosefile">NdisCloseFile</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismapfile">NdisMapFile</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisunmapfile">NdisUnmapFile</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ntdef/ns-ntdef-_unicode_string">UNICODE_STRING</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndisopenfile">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndisopenfile.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
