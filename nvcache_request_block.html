<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NVCACHE_REQUEST_BLOCK - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NVCACHE_REQUEST_BLOCK - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NVCACHE_REQUEST_BLOCK - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntddscsi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _NVCACHE_REQUEST_BLOCK {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     NRBSize;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>    Function;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     NRBFlags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     NRBStatus;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     Count;
  <a href="ulonglong" title="typedef unsigned __int64 ULONGLONG;">ULONGLONG</a> LBA;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     DataBufSize;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     NVCacheStatus;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>     NVCacheSubStatus;
} NVCACHE_REQUEST_BLOCK, *PNVCACHE_REQUEST_BLOCK;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_nvcache_request_block">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/nvcache_request_block.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ntddscsi-_nvcache_request_block)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_NVCACHE_REQUEST_BLOCK structure</h1>

<h2>Description</h2>

<p>The <strong>NVCACHE_REQUEST_BLOCK</strong> structure is used in conjunction with the <strong><a href="ioctl_scsi_miniport" title="// CTL_CODE(0x0004, 0x402, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)&#10;#define IOCTL_SCSI_MINIPORT 0x0004D008">IOCTL_SCSI_MINIPORT</a></strong> request to manage hybrid-hard disk drive (H-HDD) devices (for example, Microsoft ReadyDrive technology). This topic defines the general structure for both input data and output data for a call made to the NV Cache Manager. A caller should fill all required fields before calling <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> or <strong><a href="iobuilddeviceiocontrolrequest" title="__drv_aliasesMem PIRP IoBuildDeviceIoControlRequest(&#10;  [in]            ULONG            IoControlCode,&#10;  [in]            PDEVICE_OBJECT   DeviceObject,&#10;  [in, optional]  PVOID            InputBuffer,&#10;  [in]            ULONG            InputBufferLength,&#10;  [out, optional] PVOID            OutputBuffer,&#10;  [in]            ULONG            OutputBufferLength,&#10;  [in]            BOOLEAN          InternalDeviceIoControl,&#10;  [in, optional]  PKEVENT          Event,&#10;  [out]           PIO_STATUS_BLOCK IoStatusBlock&#10;);">IoBuildDeviceIoControlRequest</a></strong>. The miniport driver must do the same after the requested function is completed, and before it returns.</p>

<h2>Members</h2>

<h3><code>NRBSize</code></h3>

<p>The <strong>sizeof</strong>(NVCACHE_REQUEST_BLOCK).</p>

<h3><code>Function</code></h3>

<p>Specifies the operation to be performed, which can be one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>NRB_FUNCTION_NVCACHE_INFO</td>
  <td>Get NV Cache Manager feature support information from the device. Upon the successful completion of this function, the required data fields are returned to the caller. The return data structure is <strong><a href="nv_feature_parameter" title="typedef struct _NV_FEATURE_PARAMETER {&#10;  USHORT NVPowerModeEnabled;&#10;  USHORT NVParameterReserv1;&#10;  USHORT NVCmdEnabled;&#10;  USHORT NVParameterReserv2;&#10;  USHORT NVPowerModeVer;&#10;  USHORT NVCmdVer;&#10;  ULONG  NVSize;&#10;  USHORT NVReadSpeed;&#10;  USHORT NVWrtSpeed;&#10;  ULONG  DeviceSpinUpTime;&#10;} NV_FEATURE_PARAMETER, *PNV_FEATURE_PARAMETER;">NV_FEATURE_PARAMETER</a></strong>.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_SPINDLE_STATUS</td>
  <td>Determine if the device is currently spinning up or spinning down. For an ATA device, a Check Power Mode command is required to obtain the device's spindle status. For a SCSI device, a Mode Sense command can be used to query the device's current power mode.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_NVCACHE_POWER_MODE_SET</td>
  <td>Turn on the NV Cache Manager power mode.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_NVCACHE_POWER_MODE_RESET</td>
  <td>Turn off the NV Cache Manager power mode.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_FLUSH_NVCACHE</td>
  <td>Flush the data that is currently pinned in NV cache memory to make the required NV cache memory space available.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_QUERY_PINNED_SET</td>
  <td>Get the Logical Block Address (LBA) ranges currently in the NV Cache Manager pinned set.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_QUERY_CACHE_MISS</td>
  <td>Request that the device report NV Cache Misses in LBA ranges in a single 512-byte block.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_ADD_LBAS_PINNED_SET</td>
  <td>Add the LBAs that are specified in the NV Cache Manager Set Data to the NV Cache Manager Pinned Set if they are not already.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_REMOVE_LBAS_PINNED_SET</td>
  <td>Remove the LBAs that are specified in the NV Cache Set Data from the NV Cache pinned set.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_QUERY_HYBRID_DISK_STATUS</td>
  <td>Reserved for future use.</td>
</tr>
<tr>
  <td>NRB_FUNCTION_PASS_HINT_PAYLOAD</td>
  <td>Pass IO hints to a SATA device.</td>
</tr>
</tbody>
</table>

<h3><code>NRBFlags</code></h3>

<p>Reserved for future use.</p>

<h3><code>NRBStatus</code></h3>

<p>Indicates the NV Cache Manager function request status from the driver. This can be one of the following values:</p>

<table>
<thead>
<tr>
  <th>Value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>NRB_SUCCESS</td>
  <td>No error.</td>
</tr>
<tr>
  <td>NRB_ILLEGAL_REQUEST</td>
  <td>Illegal request detected by the port driver.</td>
</tr>
<tr>
  <td>NRB_INVALID_PARAMETER</td>
  <td>Invalid parameter passed to the port driver.</td>
</tr>
<tr>
  <td>NRB_INPUT_DATA_OVERRUN</td>
  <td>Too much data provided to the port driver.</td>
</tr>
<tr>
  <td>NRB_INPUT_DATA_UNDERRUN</td>
  <td>Not enough data provided to the port driver.</td>
</tr>
<tr>
  <td>NRB_OUTPUT_DATA_OVERRUN</td>
  <td>Too much data returned from the port driver.</td>
</tr>
<tr>
  <td>NRB_OUTPUT_DATA_UNDERRUN</td>
  <td>Not enough data returned from the port driver.</td>
</tr>
</tbody>
</table>

<h3><code>Count</code></h3>

<p>Number of 512-byte blocks to be transferred with the specified function.</p>

<h3><code>LBA</code></h3>

<p>Starting LBA of the device for the specified function.</p>

<h3><code>DataBufSize</code></h3>

<p>Size of the data buffer, in bytes.</p>

<h3><code>NVCacheStatus</code></h3>

<p>Status returned from the device. For an ATA device, this value is the contents of the Status Register in its Task File. For a SCSI device, this value is the Sense Code returned from the device.</p>

<h3><code>NVCacheSubStatus</code></h3>

<p>The error code returned from the device. For an ATA device, this value is the contents of the Error Register in its Task File. For a SCSI device, this value is the Sense key returned from the device.</p>

<h2>Remarks</h2>

<p>For more information on function behavior, see section 7.20 of the ATA8-ACS specification.</p>

<h2>See also</h2>

<p><strong><a href="ioctl_scsi_miniport" title="// CTL_CODE(0x0004, 0x402, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)&#10;#define IOCTL_SCSI_MINIPORT 0x0004D008">IOCTL_SCSI_MINIPORT</a></strong></p>

<p><strong><a href="ioctl_scsi_miniport_nvcache" title="// CTL_CODE(0x001b, 0x180, METHOD_BUFFERED, FILE_ANY_ACCESS)&#10;#define IOCTL_SCSI_MINIPORT_NVCACHE 0x001B0600">IOCTL_SCSI_MINIPORT_NVCACHE</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntddscsi/ns-ntddscsi-_nvcache_request_block">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntddscsi/ns-ntddscsi-_nvcache_request_block.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
