<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WdfRequestForwardToParentDeviceIoQueue - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WdfRequestForwardToParentDeviceIoQueue - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WdfRequestForwardToParentDeviceIoQueue - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfrequest.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> WdfRequestForwardToParentDeviceIoQueue(
  [in] WDFREQUEST                   Request,
  [in] WDFQUEUE                     ParentDeviceQueue,
  [in] <a href="wdf_request_forward_options" title="typedef struct _WDF_REQUEST_FORWARD_OPTIONS {&#10;  ULONG Size;&#10;  ULONG Flags;&#10;} WDF_REQUEST_FORWARD_OPTIONS, *PWDF_REQUEST_FORWARD_OPTIONS;">PWDF_REQUEST_FORWARD_OPTIONS</a> ForwardOptions
);</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfrequest/nf-wdfrequest-wdfrequestforwardtoparentdeviceioqueue">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdfrequestforwardtoparentdeviceioqueue.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdfrequest-wdfrequestforwardtoparentdeviceioqueue)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="wdfrequestforwardtoparentdeviceioqueue-function">WdfRequestForwardToParentDeviceIoQueue function</h1>

<h2 id="description">Description</h2>

<p>[Applies to KMDF only]</p>

<p>The <strong>WdfRequestForwardToParentDeviceIoQueue</strong> method requeues an I/O request from a child device's I/O queue to a specified I/O queue of the child's parent device.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="request-in"><code>Request</code> [in]</h3>

<p>A handle to a framework request object.</p>

<h3 id="parentdevicequeue-in"><code>ParentDeviceQueue</code> [in]</h3>

<p>A handle to a framework queue object.</p>

<h3 id="forwardoptions-in"><code>ForwardOptions</code> [in]</h3>

<p>A pointer to a caller-allocated <a href="wdf_request_forward_options" title="typedef struct _WDF_REQUEST_FORWARD_OPTIONS {&#10;  ULONG Size;&#10;  ULONG Flags;&#10;} WDF_REQUEST_FORWARD_OPTIONS, *PWDF_REQUEST_FORWARD_OPTIONS;">WDF_REQUEST_FORWARD_OPTIONS</a> structure.</p>

<h2 id="return-value">Return value</h2>

<p><strong>WdfRequestForwardToParentDeviceIoQueue</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> if the operation succeeds. Otherwise, this method might return one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_INFO_LENGTH_MISMATCH</strong></td>
  <td>The size of the supplied <a href="wdf_request_forward_options" title="typedef struct _WDF_REQUEST_FORWARD_OPTIONS {&#10;  ULONG Size;&#10;  ULONG Flags;&#10;} WDF_REQUEST_FORWARD_OPTIONS, *PWDF_REQUEST_FORWARD_OPTIONS;">WDF_REQUEST_FORWARD_OPTIONS</a> structure is invalid.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>A member of the supplied <a href="wdf_request_forward_options" title="typedef struct _WDF_REQUEST_FORWARD_OPTIONS {&#10;  ULONG Size;&#10;  ULONG Flags;&#10;} WDF_REQUEST_FORWARD_OPTIONS, *PWDF_REQUEST_FORWARD_OPTIONS;">WDF_REQUEST_FORWARD_OPTIONS</a> structure contains an invalid value.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_DEVICE_REQUEST</strong></td>
  <td>This value is returned if one of the following occurs:&lt;br&gt;&lt;br&gt;* The driver did not obtain the I/O request from an I/O queue.&lt;br&gt;* The source and destination I/O queues are the same.&lt;br&gt;* The specified I/O queue does not belong to the parent device.&lt;br&gt;* The driver has enabled <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/guaranteeing-forward-progress-of-i-o-operations">guaranteed forward progress</a> and the specified I/O request is reserved for low-memory situations.&lt;br&gt;* The driver did not call <a href="wdfpdoinitallowforwardingrequesttoparent" title="VOID WdfPdoInitAllowForwardingRequestToParent(&#10;  [in] PWDFDEVICE_INIT DeviceInit&#10;);">WdfPdoInitAllowForwardingRequestToParent</a>.</td>
</tr>
<tr>
  <td><strong>STATUS_WDF_BUSY</strong></td>
  <td>The specified I/O queue is not accepting new requests.</td>
</tr>
</tbody>
</table>

<p>This method might also return other <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/ntstatus-values">NTSTATUS values</a>.</p>

<p>A bug check occurs if the driver supplies an invalid object handle.</p>

<h2 id="remarks">Remarks</h2>

<p>Before a driver can call <strong>WdfRequestForwardToParentDeviceIoQueue</strong>, it must call <a href="wdfpdoinitallowforwardingrequesttoparent" title="VOID WdfPdoInitAllowForwardingRequestToParent(&#10;  [in] PWDFDEVICE_INIT DeviceInit&#10;);">WdfPdoInitAllowForwardingRequestToParent</a>.</p>

<p>The driver must use the same <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/accessing-data-buffers-in-wdf-drivers">method to access data buffers</a> (buffered, direct, or neither) for both the parent device and the child device.</p>

<p>If your driver will call <strong>WdfRequestForwardToParentDeviceIoQueue</strong> to requeue an I/O request, the driver must not use the request object as the parent of other framework objects, such as timer objects or work item objects.</p>

<p>If your driver has called <a href="wdfdeviceinitsetrequestattributes" title="VOID WdfDeviceInitSetRequestAttributes(&#10;  [in] PWDFDEVICE_INIT        DeviceInit,&#10;  [in] PWDF_OBJECT_ATTRIBUTES RequestAttributes&#10;);">WdfDeviceInitSetRequestAttributes</a> to specify <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/framework-object-context-space">context space</a> for the <em>parent</em> device's request objects, the framework does not add this context space to request objects that the driver receives in a child device's queue. The driver can call <a href="wdfobjectallocatecontext" title="NTSTATUS WdfObjectAllocateContext(&#10;  [in]  WDFOBJECT              Handle,&#10;  [in]  PWDF_OBJECT_ATTRIBUTES ContextAttributes,&#10;  [out] PVOID                  *Context&#10;);">WdfObjectAllocateContext</a> to add the context space to a request object before the driver calls <strong>WdfRequestForwardToParentDeviceIoQueue</strong>. On the other hand, if the driver called <strong><a href="wdfdeviceinitsetrequestattributes" title="VOID WdfDeviceInitSetRequestAttributes(&#10;  [in] PWDFDEVICE_INIT        DeviceInit,&#10;  [in] PWDF_OBJECT_ATTRIBUTES RequestAttributes&#10;);">WdfDeviceInitSetRequestAttributes</a></strong> for the <em>child</em> device's request objects, and if the parent device's request objects use context space that is equal to or smaller than the child device's context space, the driver can use the request object's context space without calling <strong><a href="wdfobjectallocatecontext" title="NTSTATUS WdfObjectAllocateContext(&#10;  [in]  WDFOBJECT              Handle,&#10;  [in]  PWDF_OBJECT_ATTRIBUTES ContextAttributes,&#10;  [out] PVOID                  *Context&#10;);">WdfObjectAllocateContext</a></strong>.</p>

<p>Currently, the driver must use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfrequest/ne-wdfrequest-_wdf_request_forward_options_flags">send and forget option</a> for all requeued I/O requests. Therefore, be aware that by the time that the framework deletes a requeued request object, it might have already removed the child device that originally received the request object. Thus, the driver must not use the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfobject/nc-wdfobject-evt_wdf_object_context_cleanup">EvtCleanupCallback</a> or <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfobject/nc-wdfobject-evt_wdf_object_context_destroy">EvtDestroyCallback</a> function of a requeued request object to access child device resources, because the resources might be removed before the <em>EvtCleanupCallback</em> or <em>EvtDestroyCallback</em> function runs.</p>

<p>For more information about <strong>WdfRequestForwardToParentDeviceIoQueue</strong>, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/requeuing-i-o-requests">Requeuing I/O Requests</a>.</p>

<h4 id="examples">Examples</h4>

<p>The following code example first determines the parent device of a device that received an I/O request, and then it requeues the I/O request to the parent device's default I/O queue.</p>

<div class="codehilite">
<pre><span></span><code><span class="n">WDFDEVICE</span><span class="w"> </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">parentDevice</span><span class="p">;</span>
<span class="n"><a href="wdf_request_forward_options" title="typedef struct _WDF_REQUEST_FORWARD_OPTIONS {&#10;  ULONG Size;&#10;  ULONG Flags;&#10;} WDF_REQUEST_FORWARD_OPTIONS, *PWDF_REQUEST_FORWARD_OPTIONS;">WDF_REQUEST_FORWARD_OPTIONS</a></span><span class="w"> </span><span class="n">forwardOptions</span><span class="p">;</span>
<span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span><span class="w"> </span><span class="n">status</span><span class="p">;</span>

<span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="wdfioqueuegetdevice" title="WDFDEVICE WdfIoQueueGetDevice(&#10;  [in] WDFQUEUE Queue&#10;);">WdfIoQueueGetDevice</a></span><span class="p">(</span><span class="n"><a href="wdfrequestgetioqueue" title="WDFQUEUE WdfRequestGetIoQueue(&#10;  [in] WDFREQUEST Request&#10;);">WdfRequestGetIoQueue</a></span><span class="p">(</span><span class="n">Request</span><span class="p">));</span>
<span class="n">parentDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="wdfpdogetparent" title="WDFDEVICE WdfPdoGetParent(&#10;  [in] WDFDEVICE Device&#10;);">WdfPdoGetParent</a></span><span class="p">(</span><span class="n">device</span><span class="p">);</span>

<span class="n"><a href="wdf_request_forward_options_init" title="VOID WDF_REQUEST_FORWARD_OPTIONS_INIT(&#10;  [out] PWDF_REQUEST_FORWARD_OPTIONS ForwardOptions&#10;);">WDF_REQUEST_FORWARD_OPTIONS_INIT</a></span><span class="p">(</span><span class="o">&amp;</span><span class="n">forwardOptions</span><span class="p">);</span>
<span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WdfRequestForwardToParentDeviceIoQueue</span><span class="p">(</span>
<span class="w">             </span><span class="n">Request</span><span class="p">,</span>
<span class="w">             </span><span class="n"><a href="wdfdevicegetdefaultqueue" title="WDFQUEUE WdfDeviceGetDefaultQueue(&#10;  [in] WDFDEVICE Device&#10;);">WdfDeviceGetDefaultQueue</a></span><span class="p">(</span><span class="n">parentDevice</span><span class="p">),</span>
<span class="w">             </span><span class="o">&amp;</span><span class="n">forwardOptions</span>
<span class="w">             </span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n"><a href="nt_success" title="#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)">NT_SUCCESS</a></span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n"><a href="wdfrequestcomplete" title="VOID WdfRequestComplete(&#10;  [in] WDFREQUEST Request,&#10;  [in] NTSTATUS   Status&#10;);">WdfRequestComplete</a></span><span class="p">(</span>
<span class="w">                       </span><span class="n">Request</span><span class="p">,</span>
<span class="w">                       </span><span class="n">status</span>
<span class="w">                       </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</code></pre>
</div>

<h2 id="see-also">See also</h2>

<p><a href="wdfpdoinitallowforwardingrequesttoparent" title="VOID WdfPdoInitAllowForwardingRequestToParent(&#10;  [in] PWDFDEVICE_INIT DeviceInit&#10;);">WdfPdoInitAllowForwardingRequestToParent</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfrequest/nf-wdfrequest-wdfrequestforwardtoparentdeviceioqueue">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfrequest/nf-wdfrequest-wdfrequestforwardtoparentdeviceioqueue.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
