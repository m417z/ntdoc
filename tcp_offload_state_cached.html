<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="TCP_OFFLOAD_STATE_CACHED - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>TCP_OFFLOAD_STATE_CACHED - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            TCP_OFFLOAD_STATE_CACHED - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ndischimney.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _TCP_OFFLOAD_STATE_CACHED {
  <a href="offload_state_header" title="typedef struct _OFFLOAD_STATE_HEADER {&#10;  ULONG Length;&#10;  ULONG RecognizedOptions;&#10;} OFFLOAD_STATE_HEADER, *POFFLOAD_STATE_HEADER;">OFFLOAD_STATE_HEADER</a> Header;
  <a href="ushort" title="typedef unsigned short USHORT;">USHORT</a>               Flags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                InitialRcvWnd;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                RcvIndicationSize;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                KaProbeCount;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                KaTimeout;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                KaInterval;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                MaxRT;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                FlowLabel : 20;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                TtlOrHopLimit;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                TosOrTrafficClass;
  <a href="uchar" title="typedef unsigned char UCHAR;">UCHAR</a>                UserPriority : 3;
} TCP_OFFLOAD_STATE_CACHED, *PTCP_OFFLOAD_STATE_CACHED;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/ns-ndischimney-_tcp_offload_state_cached">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/tcp_offload_state_cached.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-ndischimney-_tcp_offload_state_cached)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_tcp_offload_state_cached-structure">_TCP_OFFLOAD_STATE_CACHED structure</h1>

<h2 id="description">Description</h2>

<p>[The TCP chimney offload feature is deprecated and should not be used.]</p>

<p>The TCP_OFFLOAD_STATE_CACHED structure contains the cached variables of a TCP connection state
object.</p>

<h2 id="members">Members</h2>

<h3 id="header"><code>Header</code></h3>

<p>An
<a href="offload_state_header" title="typedef struct _OFFLOAD_STATE_HEADER {&#10;  ULONG Length;&#10;  ULONG RecognizedOptions;&#10;} OFFLOAD_STATE_HEADER, *POFFLOAD_STATE_HEADER;">OFFLOAD_STATE_HEADER</a> structure. NDIS
sets the
<strong>Length</strong> member of
<strong>Header</strong> to the size, in bytes, of the TCP_OFFLOAD_STATE_CACHED structure. The
<strong>RecognizedOptions</strong> member of
<strong>Header</strong> is reserved.</p>

<h3 id="flags"><code>Flags</code></h3>

<p>A bitmask that can be set to zero or any of the following flags, combined with bitwise OR:</p>

<h4 id="tcp_flag_keep_alive_enabled">TCP_FLAG_KEEP_ALIVE_ENABLED</h4>

<p>The host stack sets this flag to enable the keepalive option on the connection. The host stack
clears this flag to disable the keepalive option on the connection. For more information about the
keepalive option, see RFC 1122.</p>

<h4 id="tcp_flag_nagling_enabled">TCP_FLAG_NAGLING_ENABLED</h4>

<p>The host stack sets this flag to enable the Nagle algorithm on the connection. The host stack
clears this flag to disable the Nagle algorithm on the connection. For more information about the
Nagle algorithm, see RFC 896.</p>

<h4 id="tcp_flag_keep_alive_restart">TCP_FLAG_KEEP_ALIVE_RESTART</h4>

<p>The host stack sets this flag to cause the offload target to reset its keepalive timer to
zero.</p>

<h4 id="tcp_flag_max_rt_restart">TCP_FLAG_MAX_RT_RESTART</h4>

<p>The host stack sets this flag to cause the offload target to reset the TotalRT variable in the
TCP delegated state for the connection to zero.</p>

<h4 id="tcp_flag_update_rcv_wnd">TCP_FLAG_UPDATE_RCV_WND</h4>

<p>The host stack sets this flag to indicate that the default receive window size (InitialRcvWnd in
the TCP_OFFLOAD_STATE_CACHED structure) has changed. If the value of InitialRcvWnd differs from the
offload target's current receive window size (RcvWnd in the <a href="tcp_offload_state_delegated" title="typedef struct _TCP_OFFLOAD_STATE_DELEGATED {&#10;  OFFLOAD_STATE_HEADER         Header;&#10;  TCP_OFFLOAD_CONNECTION_STATE State;&#10;  USHORT                       Flags;&#10;  ULONG                        RcvNxt;&#10;  ULONG                        RcvWnd;&#10;  ULONG                        SndUna;&#10;  ULONG                        SndNxt;&#10;  ULONG                        SndMax;&#10;  ULONG                        SndWnd;&#10;  ULONG                        MaxSndWnd;&#10;  ULONG                        SendWL1;&#10;  ULONG                        CWnd;&#10;  ULONG                        SsThresh;&#10;  USHORT                       SRtt;&#10;  USHORT                       RttVar;&#10;  ULONG                        TsRecent;&#10;  ULONG                        TsRecentAge;&#10;  ULONG                        TsTime;&#10;  ULONG                        TotalRT;&#10;...">TCP_OFFLOAD_STATE_DELEGATED</a> structure),
the offload target must advertise a new receive window size to the peer.</p>

<h3 id="initialrcvwnd"><code>InitialRcvWnd</code></h3>

<p>The default receive window (from socket option SO_RCVBUF).</p>

<h3 id="rcvindicationsize"><code>RcvIndicationSize</code></h3>

<p>When non-<strong>NULL</strong>, the optimum number of data bytes that the offload target should supply in a single
call to the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/nc-ndischimney-ndis_tcp_offload_receive_indicate">NdisTcpOffloadReceiveHandler</a> function. This number, which is typically between tens and hundreds
of bytes, is a suggestion--not a requirement. The offload target can indicate more or less than
<strong>RcvIndicationSize</strong> data bytes. However, for optimum performance, the offload target should indicate
<strong>RcvIndicationSize</strong> data bytes. For more information, see
<strong>NdisTcpOffloadReceiveHandler</strong>.</p>

<p>When <strong>NULL</strong>,
<strong>RcvIndicationSize</strong> is unspecified. In this case, the offload target should ignore
<strong>RcvIndicationSize</strong> and indicate as much data as possible in calls to the
<em>NdisTcpOffloadReceiveHandler</em> function.</p>

<h3 id="kaprobecount"><code>KaProbeCount</code></h3>

<p>The number of keepalive probes that the offload target should send to determine whether a TCP
connection is intact (see RFC 1122).</p>

<h3 id="katimeout"><code>KaTimeout</code></h3>

<p>This member specifies, in clock ticks, the timeout interval for inactivity before sending a
keepalive probe (see RFC 1122).</p>

<h3 id="kainterval"><code>KaInterval</code></h3>

<p>This member specifies, in clock ticks, the timeout after which to retransmit a keepalive frame if
no response is received to a keepalive probe (see RFC 1122).</p>

<h3 id="maxrt"><code>MaxRT</code></h3>

<p>This member specifies, in clock ticks, the maximum time that the offload target should spend
retransmitting a segment. If the value of
<strong>MaxRT</strong> is non-zero,
<strong>MaxRT</strong> overrides
<strong>TcpMaximumRetransmissions</strong> in the
<a href="ndis_tcp_connection_offload_parameters" title="typedef struct _NDIS_TCP_CONNECTION_OFFLOAD_PARAMETERS {&#10;  NDIS_OBJECT_HEADER         Header;&#10;  NDIS_OFFLOAD_ENCAPSULATION Encapsulation;&#10;  ULONG                      TicksPerSecond;&#10;  UCHAR                      TcpAckFrequency;&#10;  UCHAR                      TcpDelayedAckTicks;&#10;  UCHAR                      TcpMaximumRetransmissions;&#10;  UCHAR                      TcpDoubtReachabilityRetransmissions;&#10;  ULONG                      TcpSwsPreventionTicks;&#10;  ULONG                      TcpDuplicateAckThreshold;&#10;  ULONG                      TcpPushTicks;&#10;  ULONG                      NceStaleTicks;&#10;  ULONG                      CongestionAlgorithm;&#10;} NDIS_TCP_CONNECTION_OFFLOAD_PARAMETERS, *PNDIS_TCP_CONNECTION_OFFLOAD_PARAMETERS;">NDIS_TCP_CONNECTION_OFFLOAD_PARAMETERS</a> structure. The default value for is
<strong>MaxRT</strong> is zero, which means that
<strong>TcpMaximumRetransmissions</strong> sets the maximum number of times that the offload target should
retransmit a segment on a TCP connection. If the value of
<strong>MaxRT</strong> is FFFFFFFF (or -1), there is no limit on the maximum number of retransmissions. When
<strong>MaxRT</strong> is nonzero, the offload target should reset the
<strong>TotalRT</strong> variable in the TCP delegated state for the connection.
<strong>TotalRT</strong> indicates the total time, in clock ticks, that the offload target has spent retransmitting
the current TCP segment.</p>

<h3 id="flowlabel"><code>FlowLabel</code></h3>

<p>This member marks host-labeled packets for special handling by intervening routers--for example,
nondefault QoS or "real-time" service (see RFC 2460). This variable is set through a socket option and
can vary during the lifetime of the TCP connection. This variable is only meaningful if the TCP
connection is over IPv6.</p>

<h3 id="ttlorhoplimit"><code>TtlOrHopLimit</code></h3>

<p>If the TCP connection is over IPv4, then this member specifies the time to live (see RFC 791).
This variable is set through a socket option and can vary during the lifetime of the TCP connection.</p>

<p>If the TCP connection is over IPv6, then this member specifies the number of routers that the packet
can pass through (see RFC 2460). This variable is set through a socket option and can vary during the
lifetime of the TCP connection.</p>

<h3 id="tosortrafficclass"><code>TosOrTrafficClass</code></h3>

<p>If the TCP connection is over IPv4, then this member specifies the type of service for routing a
packet (see RFC 2474). This variable is set through a socket option and can vary during the lifetime of
the TCP connection.</p>

<p>If the TCP connection is over IPv6, then this member prioritizes values for packets according to
traffic types, indicating how willing the sender is to have the packets discarded (see RFC 2460). This
variable is set through a socket option and can vary during the lifetime of the TCP
connection.</p>

<h3 id="userpriority"><code>UserPriority</code></h3>

<p>A 3-bit priority value. If the offload target supports 802.1p packet information, it must insert
this priority value into the
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/network/ff564233(v=vs.85)">tag header</a> of all packets that it transmits
on the offloaded TCP connection. If the offload target does not support 802.1p packet information, it
should ignore
<strong>UserPriority</strong> . For more information about supporting 802.1p packet information, see
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/ns-ndischimney-_tcp_offload_state_cached">802.1Q
and 802.1p Processing on an Offloaded TCP Connection</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>Cached variables are owned and maintained by the host stack. An offload target must not change the
value of a cached variable unless requested to do so by the host stack. If the value of a cached variable
changes, the host stack requests an update of the variable, which causes NDIS to call the offload
target's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/nc-ndischimney-w_update_offload_handler">MiniportUpdateOffload</a> function.
When the host stack terminates the offload of one or more state objects by causing NDIS to call the
offload target's
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/nc-ndischimney-w_terminate_offload_handler">MiniportTerminateOffload</a> function, the offload target does not return the value of offloaded
constant variables to the host stack.</p>

<p>Note that if an offloaded TCP connection's TCP_FLAG_MAX_RT_RESTART flag is set, the offload target
must:</p>

<ul>
<li>Reset that connection's delegated KeepaliveProbeCount variable when the host stack updates that
connection's cached KaProbeCount variable.</li>
<li>Reset that connection's delegated KeepaliveTimeoutDelta variable when the host stack updates that
connection's cached KaTimeout and/or KaInterval variables.</li>
</ul>

<p>When passed to an offload target, a TCP_OFFLOAD_STATE_CACHED structure is associated with an
<a href="ndis_miniport_offload_block_list" title="typedef struct _NDIS_MINIPORT_OFFLOAD_BLOCK_LIST {&#10;  IN NDIS_OBJECT_HEADER                Header;&#10;  IN _NDIS_MINIPORT_OFFLOAD_BLOCK_LIST *NextBlock;&#10;#if ...&#10;  struct                               _NDIS_MINIPORT_OFFLOAD_BLOCK_LIST;&#10;  IN _NDIS_MINIPORT_OFFLOAD_BLOCK_LIST *DependentBlockList;&#10;#else&#10;  struct                               _NDIS_MINIPORT_OFFLOAD_BLOCK_LIST;&#10;#endif&#10;  OUT NDIS_STATUS                      Status;&#10;  IN PVOID                             NdisReserved[2];&#10;  IN OUT PVOID                         *MiniportOffloadContext;&#10;  IN NDIS_HANDLE                       NdisOffloadHandle;&#10;  IN PVOID                             ProtocolReserved[2];&#10;  IN PVOID                             MiniportReserved[2];&#10;  IN PVOID                             ImReserved[2];&#10;  IN PVOID                             Scratch[2];&#10;  IN PVOID                             SourceHandle;&#10;  IN NDIS_PORT_NUMBER                  PortNumber;&#10;  IN OUT PNET_BUFFER_LIST              NetBufferListChain;&#10;...">NDIS_MINIPORT_OFFLOAD_BLOCK_LIST</a> structure, which contains a header that is formatted as an
<a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a> structure. The
<strong>Revision</strong> member of the <a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a> structure, in this case, specifies the revision number of
the TCP_OFFLOAD_STATE_CACHED structure.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/nc-ndischimney-w_terminate_offload_handler">MiniportTerminateOffload</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/nc-ndischimney-w_update_offload_handler">MiniportUpdateOffload</a></p>

<p><a href="ndis_object_header" title="typedef struct _NDIS_OBJECT_HEADER {&#10;  UCHAR  Type;&#10;  UCHAR  Revision;&#10;  USHORT Size;&#10;} NDIS_OBJECT_HEADER, *PNDIS_OBJECT_HEADER;">NDIS_OBJECT_HEADER</a></p>

<p><a href="offload_state_header" title="typedef struct _OFFLOAD_STATE_HEADER {&#10;  ULONG Length;&#10;  ULONG RecognizedOptions;&#10;} OFFLOAD_STATE_HEADER, *POFFLOAD_STATE_HEADER;">OFFLOAD_STATE_HEADER</a></p>

<p><a href="tcp_offload_state_const" title="typedef struct _TCP_OFFLOAD_STATE_CONST {&#10;  OFFLOAD_STATE_HEADER Header;&#10;  USHORT               Flags;&#10;  USHORT               RemotePort;&#10;  USHORT               LocalPort;&#10;  UCHAR                SndWindScale : 4;&#10;  UCHAR                RcvWindScale : 4;&#10;  USHORT               RemoteMss;&#10;  ULONG                HashValue;&#10;} TCP_OFFLOAD_STATE_CONST, *PTCP_OFFLOAD_STATE_CONST;">TCP_OFFLOAD_STATE_CONST</a></p>

<p><a href="tcp_offload_state_delegated" title="typedef struct _TCP_OFFLOAD_STATE_DELEGATED {&#10;  OFFLOAD_STATE_HEADER         Header;&#10;  TCP_OFFLOAD_CONNECTION_STATE State;&#10;  USHORT                       Flags;&#10;  ULONG                        RcvNxt;&#10;  ULONG                        RcvWnd;&#10;  ULONG                        SndUna;&#10;  ULONG                        SndNxt;&#10;  ULONG                        SndMax;&#10;  ULONG                        SndWnd;&#10;  ULONG                        MaxSndWnd;&#10;  ULONG                        SendWL1;&#10;  ULONG                        CWnd;&#10;  ULONG                        SsThresh;&#10;  USHORT                       SRtt;&#10;  USHORT                       RttVar;&#10;  ULONG                        TsRecent;&#10;  ULONG                        TsRecentAge;&#10;  ULONG                        TsTime;&#10;  ULONG                        TotalRT;&#10;...">TCP_OFFLOAD_STATE_DELEGATED</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndischimney/ns-ndischimney-_tcp_offload_state_cached">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndischimney/ns-ndischimney-_tcp_offload_state_cached.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
