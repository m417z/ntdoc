<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtQueryEaFile - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtQueryEaFile - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtQueryEaFile - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTIOAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtQueryEaFile(
    _In_ HANDLE FileHandle,
    _Out_ <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">PIO_STATUS_BLOCK</a> IoStatusBlock,
    _Out_writes_bytes_(Length) PVOID Buffer,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Length,
    _In_ BOOLEAN ReturnSingleEntry,
    _In_reads_bytes_opt_(EaListLength) PVOID EaList,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> EaListLength,
    _In_opt_ PULONG EaIndex,
    _In_ BOOLEAN RestartScan
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/1958e4efdb339eb2f01732202252f3d4fc64ea95/phnt/include/ntioapi.h#L2157">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwQueryEaFile(
    _In_ HANDLE FileHandle,
    _Out_ <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">PIO_STATUS_BLOCK</a> IoStatusBlock,
    _Out_writes_bytes_(Length) PVOID Buffer,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Length,
    _In_ BOOLEAN ReturnSingleEntry,
    _In_reads_bytes_opt_(EaListLength) PVOID EaList,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> EaListLength,
    _In_opt_ PULONG EaIndex,
    _In_ BOOLEAN RestartScan
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/1958e4efdb339eb2f01732202252f3d4fc64ea95/phnt/include/ntzwapi.h#L3062">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ntifs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwQueryEaFile(
  [in]           HANDLE           FileHandle,
  [out]          <a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">PIO_STATUS_BLOCK</a> IoStatusBlock,
  [out]          PVOID            Buffer,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>            Length,
  [in]           BOOLEAN          ReturnSingleEntry,
  [in, optional] PVOID            EaList,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>            EaListLength,
  [in, optional] PULONG           EaIndex,
  [in]           BOOLEAN          RestartScan
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwqueryeafile">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntqueryeafile.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ntifs-zwqueryeafile)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="zwqueryeafile-function">ZwQueryEaFile function</h1>

<h2 id="description">Description</h2>

<p><strong>ZwQueryEaFile</strong> routine returns the extended attributes (EAs) associated with the specified file.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="filehandle-in"><code>FileHandle</code> [in]</h3>

<p>The handle for the file on which the operation is to be performed.</p>

<h3 id="iostatusblock-out"><code>IoStatusBlock</code> [out]</h3>

<p>A pointer to an <strong><a href="io_status_block" title="typedef struct _IO_STATUS_BLOCK&#10;{&#10;    union&#10;    {&#10;        NTSTATUS Status;&#10;        PVOID Pointer;&#10;    };&#10;    ULONG_PTR Information;&#10;} IO_STATUS_BLOCK, *PIO_STATUS_BLOCK;">IO_STATUS_BLOCK</a></strong> structure that receives the final completion status and other information about the requested operation.</p>

<h3 id="buffer-out"><code>Buffer</code> [out]</h3>

<p>A pointer to a caller-supplied <strong><a href="file_full_ea_information" title="typedef struct _FILE_FULL_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR Flags;&#10;    UCHAR EaNameLength;&#10;    USHORT EaValueLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;    // ...&#10;    // UCHAR EaValue[1]&#10;} FILE_FULL_EA_INFORMATION, *PFILE_FULL_EA_INFORMATION;">FILE_FULL_EA_INFORMATION</a></strong>-structured output buffer in which to return the file's EAs.</p>

<h3 id="length-in"><code>Length</code> [in]</h3>

<p>The length, in bytes, of the buffer that <strong>Buffer</strong> points to.</p>

<h3 id="returnsingleentry-in"><code>ReturnSingleEntry</code> [in]</h3>

<p>Set to TRUE if <strong>ZwQueryEaFile</strong> should return only the first entry that it finds.</p>

<h3 id="ealist-in-optional"><code>EaList</code> [in, optional]</h3>

<p>A pointer to a caller-supplied <strong><a href="file_get_ea_information" title="typedef struct _FILE_GET_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR EaNameLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;} FILE_GET_EA_INFORMATION, *PFILE_GET_EA_INFORMATION;">FILE_GET_EA_INFORMATION</a></strong>-structured input buffer that specifies the EAs to be queried. This parameter is optional and can be NULL.</p>

<h3 id="ealistlength-in"><code>EaListLength</code> [in]</h3>

<p>The length, in bytes, of the buffer that the <strong>EaList</strong> parameter points to.</p>

<h3 id="eaindex-in-optional"><code>EaIndex</code> [in, optional]</h3>

<p>The index of the entry at which scanning the file's EA list should begin. This parameter is ignored if <strong>EaList</strong> points to a nonempty list. This parameter is optional and can be NULL.</p>

<h3 id="restartscan-in"><code>RestartScan</code> [in]</h3>

<p>Set to TRUE if <strong>ZwQueryEaFile</strong> should begin the scan at the first entry in the file's EA list. If this parameter is set to FALSE, the routine resumes the scan from a previous call to <strong>ZwQueryEaFile</strong>.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ZwQueryEaFile</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> or an appropriate <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value such as the following:</p>

<table>
<thead>
<tr>
  <th>Return value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STATUS_EAS_NOT_SUPPORTED</td>
  <td>The file system doesn't support EAs. This is an error code.</td>
</tr>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td>There isn't enough memory available to complete the operation. This is an error code.</td>
</tr>
<tr>
  <td>STATUS_EA_LIST_INCONSISTENT</td>
  <td>The <strong>EaList</strong> parameter isn't formatted correctly. This is an error code.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The amount of information that <strong>ZwQueryEaFile</strong> returns is based on the size of the EAs and the size of the buffer that <strong>Buffer</strong> points to. That is, either all of the requested EAs are written to the buffer, or the buffer is filled with as many complete EAs if it's not large enough to contain all the EAs. Only complete EAs are written to the buffer; no partial EAs will ever be returned.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="file_full_ea_information" title="typedef struct _FILE_FULL_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR Flags;&#10;    UCHAR EaNameLength;&#10;    USHORT EaValueLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;    // ...&#10;    // UCHAR EaValue[1]&#10;} FILE_FULL_EA_INFORMATION, *PFILE_FULL_EA_INFORMATION;">FILE_FULL_EA_INFORMATION</a></strong></p>

<p><strong><a href="file_get_ea_information" title="typedef struct _FILE_GET_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR EaNameLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;} FILE_GET_EA_INFORMATION, *PFILE_GET_EA_INFORMATION;">FILE_GET_EA_INFORMATION</a></strong></p>

<p><strong><a href="ntseteafile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetEaFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_reads_bytes_(Length) PVOID Buffer,&#10;    _In_ ULONG Length&#10;    );">ZwSetEaFile</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwqueryeafile">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ntifs/nf-ntifs-zwqueryeafile.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-zwqueryeafile">documented in Windows Driver Kit</a>.</p>

<hr />

<p><code>NtQueryEaFile</code> is used to read <em>EA</em> from <em>NTFS</em> file. For more information about <em>EA</em> see <code><a href="file_full_ea_information" title="typedef struct _FILE_FULL_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR Flags;&#10;    UCHAR EaNameLength;&#10;    USHORT EaValueLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;    // ...&#10;    // UCHAR EaValue[1]&#10;} FILE_FULL_EA_INFORMATION, *PFILE_FULL_EA_INFORMATION;">FILE_FULL_EA_INFORMATION</a></code>.</p>

<h3>FileHandle</h3>

<p><code>HANDLE</code> to File Object opened with <code>FILE_READ_EA</code> access.</p>

<h3>IoStatusBlock</h3>

<p>IO result of call.</p>

<h3>Buffer</h3>

<p>Caller's allocated buffer for output data. See <code><a href="file_full_ea_information" title="typedef struct _FILE_FULL_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR Flags;&#10;    UCHAR EaNameLength;&#10;    USHORT EaValueLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;    // ...&#10;    // UCHAR EaValue[1]&#10;} FILE_FULL_EA_INFORMATION, *PFILE_FULL_EA_INFORMATION;">FILE_FULL_EA_INFORMATION</a></code> for detailed description of fields available in buffer.</p>

<h3>Length</h3>

<p>Length of buffer, in bytes.</p>

<h3>ReturnSingleEntry</h3>

<p>If set, only one entry is returned.</p>

<h3>EaList</h3>

<p>Optional list of <code><a href="file_get_ea_information" title="typedef struct _FILE_GET_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR EaNameLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;} FILE_GET_EA_INFORMATION, *PFILE_GET_EA_INFORMATION;">FILE_GET_EA_INFORMATION</a></code> structures containing names of <em>EA</em>.</p>

<h3>EaListLength</h3>

<p>Length of <code>EaList</code>, in bytes.</p>

<h3>EaIndex</h3>

<p>Pointer to <code><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></code> value contains 1-based index of queried attribute.</p>

<h3>RestartScan</h3>

<p>If set, result is the first queried <em>EA</em>.</p>

<h1>Documented by</h1>

<ul>
<li>Tomasz Nowak</li>
</ul>

<h1>See also</h1>

<ul>
<li><code><a href="file_full_ea_information" title="typedef struct _FILE_FULL_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR Flags;&#10;    UCHAR EaNameLength;&#10;    USHORT EaValueLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;    // ...&#10;    // UCHAR EaValue[1]&#10;} FILE_FULL_EA_INFORMATION, *PFILE_FULL_EA_INFORMATION;">FILE_FULL_EA_INFORMATION</a></code></li>
<li><code><a href="file_get_ea_information" title="typedef struct _FILE_GET_EA_INFORMATION&#10;{&#10;    ULONG NextEntryOffset;&#10;    UCHAR EaNameLength;&#10;    _Field_size_bytes_(EaNameLength) CHAR EaName[1];&#10;} FILE_GET_EA_INFORMATION, *PFILE_GET_EA_INFORMATION;">FILE_GET_EA_INFORMATION</a></code></li>
<li><code><a href="ntcreatefile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateFile(&#10;    _Out_ PHANDLE FileHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ PCOBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_opt_ PLARGE_INTEGER AllocationSize,&#10;    _In_ ULONG FileAttributes,&#10;    _In_ ULONG ShareAccess,&#10;    _In_ ULONG CreateDisposition,&#10;    _In_ ULONG CreateOptions,&#10;    _In_reads_bytes_opt_(EaLength) PVOID EaBuffer,&#10;    _In_ ULONG EaLength&#10;    );">NtCreateFile</a></code></li>
<li><code><a href="ntseteafile" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtSetEaFile(&#10;    _In_ HANDLE FileHandle,&#10;    _Out_ PIO_STATUS_BLOCK IoStatusBlock,&#10;    _In_reads_bytes_(Length) PVOID Buffer,&#10;    _In_ ULONG Length&#10;    );">NtSetEaFile</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntqueryeafile.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
