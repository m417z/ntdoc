<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="_BRB_L2CA_UPDATE_CHANNEL - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>_BRB_L2CA_UPDATE_CHANNEL - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            _BRB_L2CA_UPDATE_CHANNEL - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// bthddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">struct _BRB_L2CA_UPDATE_CHANNEL {
  <a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a>           Hdr;
  BTH_ADDR             BtAddress;
  L2CAP_CHANNEL_HANDLE ChannelHandle;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                NewChannelFlags;
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                FailedChannelFlags;
};</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/ns-bthddi-_brb_l2ca_update_channel">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/_brb_l2ca_update_channel.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-bthddi-_brb_l2ca_update_channel)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_brb_l2ca_update_channel-structure">_BRB_L2CA_UPDATE_CHANNEL structure</h1>

<h2 id="description">Description</h2>

<p>The _BRB_L2CA_UPDATE_CHANNEL structure describes an update to the link characteristics of an open
L2CAP channel to a remote device or to ascertain when certain channel attributes have changed.</p>

<h2 id="members">Members</h2>

<h3 id="hdr"><code>Hdr</code></h3>

<p>A
<a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a> structure that contains information
about the current <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a>.</p>

<h3 id="btaddress"><code>BtAddress</code></h3>

<p>The Bluetooth address of the remote device.</p>

<h3 id="channelhandle"><code>ChannelHandle</code></h3>

<p>The L2CAP channel handle that was returned by Bluetooth driver stack in response to an earlier
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536615(v=vs.85)">BRB_L2CA_OPEN_CHANNEL</a> or
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)">BRB_L2CA_OPEN_CHANNEL_RESPONSE</a> request.</p>

<h3 id="newchannelflags"><code>NewChannelFlags</code></h3>

<p>A combination of flag values that specify the updated requirements for the channel. This member
should be set to CF_ROLE_EITHER.</p>

<h3 id="failedchannelflags"><code>FailedChannelFlags</code></h3>

<p>The flag or flags in the
<strong>NewChannelFlags</strong> member that the Bluetooth driver stack was not able to honor. This member contains
information only if the <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> call failed.</p>

<h2 id="remarks">Remarks</h2>

<p>To retrieve the current settings of a L2CAP channel, profile drivers should
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536657(v=vs.85)">build and send</a> a
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536620(v=vs.85)">BRB_L2CA_UPDATE_CHANNEL</a> request.</p>

<p>The profile driver can then determine when certain channel attributes have changed. Additionally, if
the CF_LINK_PASSIVE_MODE flag is not set, the <a href="brb" title="typedef struct _BRB {&#10;  union {&#10;#if ...&#10;    _BRB_HEADER                             BrbHeader;&#10;#else&#10;    struct _BRB_HEADER                      BrbHeader;&#10;#endif&#10;#if ...&#10;    _BRB_GET_DEVICE_INTERFACE_STRING        BrbGetDeviceInterfaceString;&#10;#else&#10;    struct _BRB_GET_DEVICE_INTERFACE_STRING BrbGetDeviceInterfaceString;&#10;#endif&#10;#if ...&#10;    _BRB_GET_LOCAL_BD_ADDR                  BrbGetLocalBdAddress;&#10;#else&#10;    struct _BRB_GET_LOCAL_BD_ADDR           BrbGetLocalBdAddress;&#10;#endif&#10;#if ...&#10;    _BRB_ACL_GET_MODE                       BrbAclGetMode;&#10;#else&#10;...">BRB</a> will attempt to change the current channel settings to
the remote device.</p>

<p>The primary use of <strong>BRB_L2CA_UPDATE_CHANNEL</strong> is to determine when authentication or encryption has been
enabled for a connection.</p>

<p>In some cases, L2CAP connections can be established without the profile driver specifying that
authentication is required, but authentication will happen automatically due to choices made by the user.
In this case, a period of time passes between when the connection is established and when authentication
and encryption begin working. Calls to <strong>BRB_L2CA_UPDATE_CHANNEL</strong> are blocked until authentication and
encryption are complete.</p>

<p>By building and sending a <strong>BRB_L2CA_UPDATE_CHANNEL</strong> request, profile drivers can avoid using the
connection prior to authentication.</p>

<h2 id="see-also">See also</h2>

<p><a href="brb_header" title="typedef struct _BRB_HEADER {&#10;  LIST_ENTRY ListEntry;&#10;  ULONG      Length;&#10;  USHORT     Version;&#10;  USHORT     Type;&#10;  ULONG      BthportFlags;&#10;  NTSTATUS   Status;&#10;  BTHSTATUS  BtStatus;&#10;  PVOID      Context[BTHPORT_CONTEXT_SIZE];&#10;  PVOID      ClientContext[BTHPORT_CONTEXT_SIZE];&#10;  ULONG      Reserved[BTHPORT_RESERVED_FIELD_SIZE];&#10;} BRB_HEADER;">BRB_HEADER</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536615(v=vs.85)">BRB_L2CA_OPEN_CHANNEL</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536616(v=vs.85)">BRB_L2CA_OPEN_CHANNEL_RESPONSE</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/ff536620(v=vs.85)">BRB_L2CA_UPDATE_CHANNEL</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/bthddi/ns-bthddi-_brb_l2ca_update_channel">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/bthddi/ns-bthddi-_brb_l2ca_update_channel.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
