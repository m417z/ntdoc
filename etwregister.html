<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="EtwRegister - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EtwRegister - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            EtwRegister - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> EtwRegister(
  [in]           LPCGUID            ProviderId,
  [in, optional] PETWENABLECALLBACK EnableCallback,
  [in, optional] PVOID              CallbackContext,
  [out]          <a href="reghandle" title="typedef ULONGLONG REGHANDLE, *PREGHANDLE;">PREGHANDLE</a>         RegHandle
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-etwregister">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/etwregister.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-etwregister)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>EtwRegister function</h1>

<h2>Description</h2>

<p>The <strong>EtwRegister</strong> function registers the event provider and must be called before a provider can start tracing. The <strong>EtwRegister</strong> function is the kernel mode counterpart to the user-mode <strong>EventRegister</strong> function. The function can also provide a pointer to an optional callback function that can be used to provide additional event filtering capabilities.</p>

<h2>Parameters</h2>

<h3><code>ProviderId</code> [in]</h3>

<p>A pointer to the event provider GUID.</p>

<h3><code>EnableCallback</code> [in, optional]</h3>

<p>A pointer to an optional callback function. The callback function provides additional event filtering capabilities. The callback function is user-defined.</p>

<h3><code>CallbackContext</code> [in, optional]</h3>

<p>The function passes back the optional callback context when a callback is made. You can specify the optional context when you register a provider. The <em>CallbackContext</em> parameter supports the scenarios in which one callback is shared by multiple providers, as in a C++ class. The <em>CallbackContext</em> provides a way to distinguish the target provider instances for the enable callback.</p>

<h3><code>RegHandle</code> [out]</h3>

<p>A pointer to a variable that receives the provider registration handle if the function call is successful.</p>

<h2>Return value</h2>

<p>The <strong>EtwRegister</strong> function returns a status code from the following list:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong></td>
  <td>Indicates that event provider was successfully registered with ETW.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>Indicates that the parameter was not valid.</td>
</tr>
<tr>
  <td><strong>STATUS_Xxx</strong></td>
  <td>Indicates that the request failed for the reason specified by the <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> value. See Ntstatus.h for detailed information about the actual status return code.</td>
</tr>
</tbody>
</table>

<h2>Remarks</h2>

<p>Before a kernel-mode driver can trace events, the driver must register as an event provider using the <strong>EtwRegister</strong> function. When a kernel mode driver calls <strong>EtwRegister</strong>, the function returns a registration handle. This registration handle can be used to test whether a keyword or level is enabled for a specific provider and to call event tracing and logging functions. After tracing is complete, a driver must call the <strong><a href="etwunregister" title="NTSTATUS EtwUnregister(&#10;  [in] REGHANDLE RegHandle&#10;);">EtwUnregister</a></strong> function to unregister the provider. For every call to <strong>EtwRegister</strong> there must be a corresponding call to <strong><a href="etwunregister" title="NTSTATUS EtwUnregister(&#10;  [in] REGHANDLE RegHandle&#10;);">EtwUnregister</a></strong>. Failure to unregister the event provider can cause errors when the process is unloaded because the callback functions associated with the process are no longer valid. No tracing calls should be made that fall outside of the code bounded by the <strong>EtwRegister</strong> and <strong><a href="etwunregister" title="NTSTATUS EtwUnregister(&#10;  [in] REGHANDLE RegHandle&#10;);">EtwUnregister</a></strong> functions. For the best performance, you can call the <strong>EtwRegister</strong> function in your <strong><a href="driverentry" title="NTSTATUS DriverEntry(&#10;  [in] PDRIVER_OBJECT  DriverObject,&#10;  [in] PUNICODE_STRING RegistryPath&#10;);">DriverEntry</a></strong> routine and the <strong><a href="etwunregister" title="NTSTATUS EtwUnregister(&#10;  [in] REGHANDLE RegHandle&#10;);">EtwUnregister</a></strong> function in your <strong>DriverUnload</strong> routine.</p>

<p>Callers of <strong>EtwRegister</strong> must be running at IRQL = PASSIVE_LEVEL in the context of a system thread.</p>

<h2>See also</h2>

<p><a href="etwunregister" title="NTSTATUS EtwUnregister(&#10;  [in] REGHANDLE RegHandle&#10;);">EtwUnregister</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-etwregister">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-etwregister.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
