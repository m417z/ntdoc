<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// ehstorioctl.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x002d, 0x511, METHOD_BUFFERED, FILE_READ_ACCESS | FILE_WRITE_ACCESS)
#define IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE 0x002DD444</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_driver_update_lba_filter_table">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_ehstor_driver_update_lba_filter_table.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ni-ehstorioctl-ioctl_ehstor_driver_update_lba_filter_table)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_ehstor_driver_update_lba_filter_table-ioctl">IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE IOCTL</h1>

<h2 id="description">Description</h2>

<p>This IOCTL is used to inform the enhanced storage (EHSTOR) class driver of changes to the LBA filter table. Bands managed by the silo driver are composed of LBA ranges. The silo driver notifies the EHSTOR class driver of updates to the set of bands it controls with this IOCTL.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="major-code">Major code</h3>

<h3 id="input-buffer">Input buffer</h3>

<p>The input buffer at <strong>Irp->AssociatedIrp.SystemBuffer</strong> must contain a structure of type <a href="lba_filter_table" title="typedef struct _LBA_FILTER_TABLE {&#10;  ULONG   StructSize;&#10;  BOOLEAN GlobalReadLock;&#10;  LONG    Reserved1;&#10;  BOOLEAN GlobalWriteLock;&#10;  LONG    Reserved2;&#10;  ULONG   LbaFilterCount;&#10;  ULONG   LbaFilterSize;&#10;  ULONG   LbaFiltersOffset;&#10;} LBA_FILTER_TABLE, *PLBA_FILTER_TABLE;">LBA_FILTER_TABLE</a>. This structure contains the filter table and the total entries it contains. An array <a href="lba_filter_table_entry" title="typedef struct _LBA_FILTER_TABLE_ENTRY {&#10;  ULARGE_INTEGER StartLba;&#10;  ULARGE_INTEGER LbaCount;&#10;  BOOLEAN        ReadLock;&#10;  BOOLEAN        WriteLock;&#10;} LBA_FILTER_TABLE_ENTRY, *PLBA_FILTER_TABLE_ENTRY;">LBA_FILTER_TABLE_ENTRY</a> structure follows <strong><a href="lba_filter_table" title="typedef struct _LBA_FILTER_TABLE {&#10;  ULONG   StructSize;&#10;  BOOLEAN GlobalReadLock;&#10;  LONG    Reserved1;&#10;  BOOLEAN GlobalWriteLock;&#10;  LONG    Reserved2;&#10;  ULONG   LbaFilterCount;&#10;  ULONG   LbaFilterSize;&#10;  ULONG   LbaFiltersOffset;&#10;} LBA_FILTER_TABLE, *PLBA_FILTER_TABLE;">LBA_FILTER_TABLE</a></strong>.</p>

<h3 id="input-buffer-length">Input buffer length</h3>

<p>The length of the buffer.</p>

<h3 id="output-buffer">Output buffer</h3>

<p>None.</p>

<h3 id="output-buffer-length">Output buffer length</h3>

<p>None.</p>

<h3 id="inputoutput-buffer">Input/output buffer</h3>

<h3 id="inputoutput-buffer-length">Input/output buffer length</h3>

<h3 id="status-block">Status block</h3>

<p>One of the following values can be returned in the <strong>Status</strong> field.</p>

<table>
<thead>
<tr>
  <th>Status Value</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></td>
  <td>The LBA filter table was successfully updated.</td>
</tr>
<tr>
  <td>STATUS_INVALID_BUFFER_SIZE</td>
  <td>The input buffer length supplied is of incorrect size.</td>
</tr>
<tr>
  <td>STATUS_INVALID_PARAMETER</td>
  <td>The LBA filter count or an LBA range is specified incorrectly.</td>
</tr>
<tr>
  <td>STATUS_INSUFFICIENT_RESOURCES</td>
  <td>The IOCTL redirection list cannot be copied.</td>
</tr>
<tr>
  <td>STATUS_NOT_SUPPORTED</td>
  <td>The sending device is not a silo device or banding is not supported.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The LBA filters cannot overlap or be empty. The LBA filters do not have to be sorted in any way.</p>

<p>If an LBA range is being unlocked, an <strong>IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE</strong> request should be sent after the LBA range is unlocked on the storage device. Also,
if an LBA range is currently being locked, <strong>IOCTL_EHSTOR_DRIVER_UPDATE_LBA_FILTER_TABLE</strong> must be sent before the LBA range has been locked on the storage device.</p>

<h2 id="see-also">See also</h2>

<p><a href="lba_filter_table" title="typedef struct _LBA_FILTER_TABLE {&#10;  ULONG   StructSize;&#10;  BOOLEAN GlobalReadLock;&#10;  LONG    Reserved1;&#10;  BOOLEAN GlobalWriteLock;&#10;  LONG    Reserved2;&#10;  ULONG   LbaFilterCount;&#10;  ULONG   LbaFilterSize;&#10;  ULONG   LbaFiltersOffset;&#10;} LBA_FILTER_TABLE, *PLBA_FILTER_TABLE;">LBA_FILTER_TABLE</a></p>

<p><a href="lba_filter_table_entry" title="typedef struct _LBA_FILTER_TABLE_ENTRY {&#10;  ULARGE_INTEGER StartLba;&#10;  ULARGE_INTEGER LbaCount;&#10;  BOOLEAN        ReadLock;&#10;  BOOLEAN        WriteLock;&#10;} LBA_FILTER_TABLE_ENTRY, *PLBA_FILTER_TABLE_ENTRY;">LBA_FILTER_TABLE_ENTRY</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_driver_update_lba_filter_table">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ehstorioctl/ni-ehstorioctl-ioctl_ehstor_driver_update_lba_filter_table.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
