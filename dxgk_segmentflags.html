<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="DXGK_SEGMENTFLAGS - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>DXGK_SEGMENTFLAGS - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            DXGK_SEGMENTFLAGS - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// d3dkmddi.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _DXGK_SEGMENTFLAGS {
  union {
    struct {
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Aperture : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Agp : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> CpuVisible : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> UseBanking : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> CacheCoherent : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> PitchAlignment : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> PopulatedFromSystemMemory : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> PreservedDuringStandby : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> PreservedDuringHibernate : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> PartiallyPreservedDuringHibernate : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> DirectFlip : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Use64KBPages : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> ReservedSysMem : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> SupportsCpuHostAperture : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> SupportsCachedCpuHostAperture : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> ApplicationTarget : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> VprSupported : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> VprPreservedDuringStandby : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> EncryptedPagingSupported : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> LocalBudgetGroup : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> NonLocalBudgetGroup : 1;
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> PopulatedByReservedDDRByFirmware : 1;
#if ...
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Reserved : 10;
#elif
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Reserved : 11;
#elif
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Reserved : 21;
#else
      <a href="uint" title="typedef unsigned int UINT;">UINT</a> Reserved : 22;
#endif
    };
    <a href="uint" title="typedef unsigned int UINT;">UINT</a> Value;
  };
} DXGK_SEGMENTFLAGS;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_segmentflags">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/dxgk_segmentflags.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-d3dkmddi-_dxgk_segmentflags)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="dxgk_segmentflags-structure">DXGK_SEGMENTFLAGS structure</h1>

<h2 id="description">Description</h2>

<p>The <strong>DXGK_SEGMENTFLAGS</strong> structure identifies properties for a segment that the driver provides through a call to its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a> function.</p>

<h2 id="members">Members</h2>

<h3 id="aperture"><code>Aperture</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the segment is an aperture segment instead of a memory segment. An aperture segment does not have physical pages that can hold content for an allocation. When the video memory manager pages an allocation into a memory segment, the memory manager transfers the content of the allocation from the system memory backing store to the segment location. When the video memory manager pages an allocation into an aperture segment, the memory manager maps the physical pages of the allocation backing store into the segment.</p>

<p>If the driver specifies this member, it must also implement the map-aperture-segment and unmap-aperture-segment operation types for its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_buildpagingbuffer"><strong>DxgkDdiBuildPagingBuffer</strong></a> function.</p>

<p>Setting this member is equivalent to setting the first bit of the 32-bit <strong>Value</strong> member (0x00000001).</p>

<h3 id="agp"><code>Agp</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the segment is an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/display/agp-support">AGP**</a>-type aperture segment, which uses a portion of the AGP aperture that the chipset exposes. The video memory manager allocates the page for the underlying aperture and communicates with the graphic address remapping table (GART) driver to map and unmap memory for the aperture. Because only one AGP segment can exist, the driver should not specify the **Agp** bit-field flag with any other DXGK_SEGMENTFLAGS bit-field flags.</p>

<p>Setting this member is equivalent to setting the second bit of the 32-bit <strong>Value</strong> member (0x00000002).</p>

<h3 id="cpuvisible"><code>CpuVisible</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the memory segment is accessible to the CPU at the address that is specified by the <strong>CpuTranslatedAddress</strong> member of the <strong><a href="dxgk_segmentdescriptor" title="typedef struct _DXGK_SEGMENTDESCRIPTOR {&#10;  [out] PHYSICAL_ADDRESS  BaseAddress;&#10;  [out] PHYSICAL_ADDRESS  CpuTranslatedAddress;&#10;  [out] SIZE_T            Size;&#10;  [out] UINT              NbOfBanks;&#10;  [out] SIZE_T            *pBankRangeTable;&#10;  [out] SIZE_T            CommitLimit;&#10;  [out] DXGK_SEGMENTFLAGS Flags;&#10;} DXGK_SEGMENTDESCRIPTOR;">DXGK_SEGMENTDESCRIPTOR</a></strong> structure that describes the memory segment.</p>

<p>This member has no meaning for an aperture segment, including the AGP-type aperture segment. The only exception occurs when the user-mode display driver has not set up an alternate virtual address for a primary allocation (that is, when the driver has not set <strong>UseAlternateVA</strong> in the <strong>Flags</strong> member of the <strong><a href="d3dddicb_lockflags" title="typedef struct _D3DDDICB_LOCKFLAGS {&#10;  union {&#10;    struct {&#10;      UINT ReadOnly : 1;&#10;      UINT WriteOnly : 1;&#10;      UINT DonotWait : 1;&#10;      UINT IgnoreSync : 1;&#10;      UINT LockEntire : 1;&#10;      UINT DonotEvict : 1;&#10;      UINT AcquireAperture : 1;&#10;      UINT Discard : 1;&#10;      UINT NoExistingReference : 1;&#10;      UINT UseAlternateVA : 1;&#10;      UINT IgnoreReadSync : 1;&#10;      UINT Reserved : 21;&#10;    };&#10;    UINT Value;&#10;  };&#10;} D3DDDICB_LOCKFLAGS;">D3DDDICB_LOCKFLAGS</a></strong> structure during a call to the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dumddi/nc-d3dumddi-pfnd3dddi_lockcb"><strong>pfnLockCb</strong></a> function).</p>

<p>See Remarks for more info.</p>

<p>Setting this member is equivalent to setting the third bit of the 32-bit <strong>Value</strong> member (0x00000004).</p>

<h3 id="usebanking"><code>UseBanking</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the segment is divided into banks that the driver uses to provide hints to the video memory manager about the placement of allocations within the segment. The driver should also specify valid bank information in the <strong>NbOfBanks</strong> and <strong>pBankRangeTable</strong> members of the <strong><a href="dxgk_segmentdescriptor" title="typedef struct _DXGK_SEGMENTDESCRIPTOR {&#10;  [out] PHYSICAL_ADDRESS  BaseAddress;&#10;  [out] PHYSICAL_ADDRESS  CpuTranslatedAddress;&#10;  [out] SIZE_T            Size;&#10;  [out] UINT              NbOfBanks;&#10;  [out] SIZE_T            *pBankRangeTable;&#10;  [out] SIZE_T            CommitLimit;&#10;  [out] DXGK_SEGMENTFLAGS Flags;&#10;} DXGK_SEGMENTDESCRIPTOR;">DXGK_SEGMENTDESCRIPTOR</a></strong> structure that describes the segment.</p>

<p>Setting this member is equivalent to setting the fourth bit of the 32-bit <strong>Value</strong> member (0x00000008).</p>

<h3 id="cachecoherent"><code>CacheCoherent</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the aperture segment can maintain cache coherency with cacheable pages that are mapped into the aperture. This member can be set only with setting the <strong>Aperture</strong> member (that is, <strong>CacheCoherent</strong> has no meaning for a memory segment).</p>

<p>Setting this member is equivalent to setting the fifth bit of the 32-bit <strong>Value</strong> member (0x00000010).</p>

<h3 id="pitchalignment"><code>PitchAlignment</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether an allocation that is mapped into the segment must be pitch aligned. For this type of segment, the video memory manager uses the <strong>Size</strong> member of the <strong><a href="dxgk_allocationinfo" title="typedef struct _DXGK_ALLOCATIONINFO {&#10;  VOID                       *pPrivateDriverData;&#10;  UINT                       PrivateDriverDataSize;&#10;  union {&#10;    UINT Alignment;&#10;    struct {&#10;      UINT16 MinimumPageSize;&#10;      UINT16 RecommendedPageSize;&#10;    };&#10;  };&#10;  SIZE_T                     Size;&#10;  SIZE_T                     PitchAlignedSize;&#10;  DXGK_SEGMENTBANKPREFERENCE HintedBank;&#10;  DXGK_SEGMENTPREFERENCE     PreferredSegment;&#10;  union {&#10;    UINT SupportedReadSegmentSet;&#10;    UINT MmuSet;&#10;  };&#10;  UINT                       SupportedWriteSegmentSet;&#10;  UINT                       EvictionSegmentSet;&#10;...">DXGK_ALLOCATIONINFO</a></strong> structure for the allocation to allocate a backing store for the allocation. However, the video memory manager uses the <strong>PitchAlignedSize</strong> member of <a href="dxgk_allocationinfo" title="typedef struct _DXGK_ALLOCATIONINFO {&#10;  VOID                       *pPrivateDriverData;&#10;  UINT                       PrivateDriverDataSize;&#10;  union {&#10;    UINT Alignment;&#10;    struct {&#10;      UINT16 MinimumPageSize;&#10;      UINT16 RecommendedPageSize;&#10;    };&#10;  };&#10;  SIZE_T                     Size;&#10;  SIZE_T                     PitchAlignedSize;&#10;  DXGK_SEGMENTBANKPREFERENCE HintedBank;&#10;  DXGK_SEGMENTPREFERENCE     PreferredSegment;&#10;  union {&#10;    UINT SupportedReadSegmentSet;&#10;    UINT MmuSet;&#10;  };&#10;  UINT                       SupportedWriteSegmentSet;&#10;  UINT                       EvictionSegmentSet;&#10;...">DXGK_ALLOCATIONINFO</a> to allocate resources for the segment. An allocation that is targeted for this type of segment typically has a different size for the backing store and for the segment. When the backing-store size does not match the segment size, the driver must determine how to correctly move the data in the allocation. This type of segment cannot be used for eviction.</p>

<p>Setting this member is equivalent to setting the sixth bit of the 32-bit <strong>Value</strong> member (0x00000020).</p>

<h3 id="populatedfromsystemmemory"><code>PopulatedFromSystemMemory</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the memory segment is actually populated from system memory that the driver allocated during initialization. If the memory segment is populated from system memory that the BIOS reserved and is not accessible to the operating system (that is, the operating system does not count this system memory when the operating system reports total amount of system memory), the driver should not set this flag. This flag is invalid and ignored on aperture segments.</p>

<p>Setting this member is equivalent to setting the seventh bit of the 32-bit <strong>Value</strong> member (0x00000040).</p>

<h3 id="preservedduringstandby"><code>PreservedDuringStandby</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the segment is preserved in a transition to a standby system power state.</p>

<p>For more information on power transition options, see Remarks.</p>

<p>Setting this member is equivalent to setting the eighth bit of the 32-bit <strong>Value</strong> member (0x00000080).</p>

<p>Supported starting with Windows 8.</p>

<h3 id="preservedduringhibernate"><code>PreservedDuringHibernate</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the segment is preserved in a transition to a hibernate system power state. Do not set this flag unless the <strong>PreservedDuringStandby</strong> member is also set. For more information on power transition options, see Remarks.</p>

<p>Setting this member is equivalent to setting the ninth bit of the 32-bit <strong>Value</strong> member (0x00000100).</p>

<p>Supported starting with Windows 8.</p>

<h3 id="partiallypreservedduringhibernate"><code>PartiallyPreservedDuringHibernate</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether the segment is partially preserved in a transition to a hibernate system power state. Do not set this flag unless the <strong>PreservedDuringStandby</strong> member is also set. For more information on power transition options, see Remarks.</p>

<p>Setting this member is equivalent to setting the tenth bit of the 32-bit <strong>Value</strong> member (0x00000200).</p>

<p>Supported starting with Windows 8.</p>

<h3 id="directflip"><code>DirectFlip</code></h3>

<p>[out] A <a href="uint" title="typedef unsigned int UINT;">UINT</a> value that specifies whether a segment supports Direct Flip allocations. In this case, the driver must ensure that Direct Flip allocations can be pinned and scanned out from this segment.</p>

<p>Setting this member is equivalent to setting the eleventh bit of the 32-bit <strong>Value</strong> member (0x00000400).</p>

<p>Supported starting with Windows 8.</p>

<h3 id="use64kbpages"><code>Use64KBPages</code></h3>

<p>[out] When set, the GPU memory segment supports 64 KB pages. Otherwise, 4 KB pages are supported. When the driver sets the cap and an allocation can be paged-in to the segment, the allocation alignment, returned by the kernel mode driver from <strong><a href="dxgk_allocationinfo" title="typedef struct _DXGK_ALLOCATIONINFO {&#10;  VOID                       *pPrivateDriverData;&#10;  UINT                       PrivateDriverDataSize;&#10;  union {&#10;    UINT Alignment;&#10;    struct {&#10;      UINT16 MinimumPageSize;&#10;      UINT16 RecommendedPageSize;&#10;    };&#10;  };&#10;  SIZE_T                     Size;&#10;  SIZE_T                     PitchAlignedSize;&#10;  DXGK_SEGMENTBANKPREFERENCE HintedBank;&#10;  DXGK_SEGMENTPREFERENCE     PreferredSegment;&#10;  union {&#10;    UINT SupportedReadSegmentSet;&#10;    UINT MmuSet;&#10;  };&#10;  UINT                       SupportedWriteSegmentSet;&#10;  UINT                       EvictionSegmentSet;&#10;...">DXGK_ALLOCATIONINFO</a></strong>, must be multiple a of 64 KB.</p>

<p>Supported starting with Windows 10.</p>

<h3 id="reservedsysmem"><code>ReservedSysMem</code></h3>

<p>[out] Reserved for system use and should not be set by the kernel mode driver.</p>

<p>Supported starting with Windows 10.</p>

<h3 id="supportscpuhostaperture"><code>SupportsCpuHostAperture</code></h3>

<p>[out] When set, the segment can be mapped through the CPU host aperture. This flag cannot be used in combination with the <strong>CpuVisible</strong> flag.</p>

<p>Supported starting with Windows 10.</p>

<h3 id="supportscachedcpuhostaperture"><code>SupportsCachedCpuHostAperture</code></h3>

<p>[out] When set, this indicates that the hardware supports CPU cache coherent CPU host aperture. Additionally, the <strong>SupportsCpuHostAperture</strong> flag must be set. The flag is typically set by the software GPU emulation drivers.</p>

<p>Supported starting with Windows 10.</p>

<h3 id="applicationtarget"><code>ApplicationTarget</code></h3>

<p>[out] When set, it indicates that this segment should be targeted by application budgets.</p>

<p>Supported starting with Windows 10.</p>

<h3 id="vprsupported"><code>VprSupported</code></h3>

<p>[out] When set, indicates that Video Protected Region (VPR) is supported.</p>

<h3 id="vprpreservedduringstandby"><code>VprPreservedDuringStandby</code></h3>

<p>[out] When set, indicates that content of VPRs is preserved during standby.</p>

<h3 id="encryptedpagingsupported"><code>EncryptedPagingSupported</code></h3>

<p>[out] When set, indicates that hardware-protected allocations are encrypted during paging.</p>

<h3 id="localbudgetgroup"><code>LocalBudgetGroup</code></h3>

<p>[out] When set, indicates that this segment counts against the local memory segment budget group.</p>

<h3 id="nonlocalbudgetgroup"><code>NonLocalBudgetGroup</code></h3>

<p>[out] When set, indicates that this segment counts against the non-local memory segment budget group.</p>

<h3 id="populatedbyreservedddrbyfirmware"><code>PopulatedByReservedDDRByFirmware</code></h3>

<p>[out] When set, indicates that this segment is populated from reserved system DDR memory by firmware. Available starting with Windows Server 2022 (WDDM 2.9).</p>

<h3 id="reserved"><code>Reserved</code></h3>

<p>[out] This member is reserved and should be set to zero.</p>

<h3 id="value"><code>Value</code></h3>

<p>[out] A member in the union that DXGK_SEGMENTFLAGS contains that can hold a 32-bit value that identifies properties of the segment.</p>

<h2 id="remarks">Remarks</h2>

<p>The driver can specify properties of the segment by setting bits in the 32-bit <strong>Value</strong> member or by setting individual members of the structure in the union that DXGK_SEGMENTFLAGS contains.</p>

<p>Note that for an AGP-type aperture segment, the driver must exclusively set the <strong>Agp</strong> member of the structure in the union that DXGK_SEGMENTFLAGS contains. Although the AGP-type aperture segment is an aperture and visible to the CPU, if any other members are set, the adapter fails to initialize.</p>

<p>In the special case where the allocation uses an aperture segment on a shared primary allocation (<strong><a href="dxgkarg_getstandardallocationdriverdata" title="typedef struct _DXGKARG_GETSTANDARDALLOCATIONDRIVERDATA {&#10;  D3DKMDT_STANDARDALLOCATION_TYPE StandardAllocationType;&#10;  union {&#10;    D3DKMDT_SHAREDPRIMARYSURFACEDATA *pCreateSharedPrimarySurfaceData;&#10;    D3DKMDT_SHADOWSURFACEDATA        *pCreateShadowSurfaceData;&#10;    D3DKMDT_STAGINGSURFACEDATA       *pCreateStagingSurfaceData;&#10;    D3DKMDT_GDISURFACEDATA           *pCreateGdiSurfaceData;&#10;    D3DKMDT_VIRTUALGPUSURFACEDATA    *pCreateVirtualGpuSurfaceData;&#10;    D3DKMDT_FENCESTORAGESURFACEDATA  *pCreateFenceStorageData;&#10;  };&#10;  VOID                            *pAllocationPrivateDriverData;&#10;  UINT                            AllocationPrivateDriverDataSize;&#10;  VOID                            *pResourcePrivateDriverData;&#10;  UINT                            ResourcePrivateDriverDataSize;&#10;  UINT                            PhysicalAdapterIndex;&#10;} DXGKARG_GETSTANDARDALLOCATIONDRIVERDATA;">DXGKARG_GETSTANDARDALLOCATIONDRIVERDATA</a></strong>.<strong>StandardAllocationType</strong> is <strong>D3DKMDT_STANDARDALLOCATION_SHAREDPRIMARYSURFACE</strong>), and <strong><a href="dxgk_allocationinfoflags" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS {&#10;  union {&#10;    struct {&#10;      UINT CpuVisible : 1;&#10;      UINT PermanentSysMem : 1;&#10;      UINT Cached : 1;&#10;      UINT Protected : 1;&#10;      UINT ExistingSysMem : 1;&#10;      UINT ExistingKernelSysMem : 1;&#10;      UINT FromEndOfSegment : 1;&#10;      UINT Swizzled : 1;&#10;      UINT Overlay : 1;&#10;      UINT Capture : 1;&#10;      UINT UseAlternateVA : 1;&#10;      UINT SynchronousPaging : 1;&#10;      UINT LinkMirrored : 1;&#10;      UINT LinkInstanced : 1;&#10;      UINT HistoryBuffer : 1;&#10;      UINT AccessedPhysically : 1;&#10;      UINT ExplicitResidencyNotification : 1;&#10;...">DXGK_ALLOCATIONINFOFLAGS</a></strong>.<strong>UseAlternateVA</strong> is not set, the driver should use a section-backed primary allocation (<strong><a href="dxgk_vidmmcaps" title="typedef struct _DXGK_VIDMMCAPS {&#10;  union {&#10;    struct {&#10;      UINT OutOfOrderLock : 1;&#10;      UINT DedicatedPagingEngine : 1;&#10;      UINT PagingEngineCanSwizzle : 1;&#10;      UINT SectionBackedPrimary : 1;&#10;      UINT CrossAdapterResource : 1;&#10;      UINT VirtualAddressingSupported : 1;&#10;      UINT GpuMmuSupported : 1;&#10;      UINT IoMmuSupported : 1;&#10;      UINT ReplicateGdiContent : 1;&#10;      UINT NonCpuVisiblePrimary : 1;&#10;      UINT ParavirtualizationSupported : 1;&#10;      UINT IoMmuSecureModeSupported : 1;&#10;      UINT DisableSelfRefreshVRAMInS3 : 1;&#10;      UINT IoMmuSecureModeRequired : 1;&#10;      UINT MapAperture2Supported : 1;&#10;      UINT CrossAdapterResourceTexture : 1;&#10;      UINT CrossAdapterResourceScanout : 1;&#10;...">DXGK_VIDMMCAPS</a></strong>.<strong>SectionBackedPrimary</strong> is set) when the driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a> function is called. By using a section-backed primary you can avoid the limitations of <strong>CpuVisible</strong> for the aperture segment.</p>

<p>You can avoid the limitations of <strong>CpuVisible</strong> for an aperture segment by using a shared, section-backed primary allocation. In this case, use an aperture segment on a shared primary allocation (<strong><a href="dxgkarg_getstandardallocationdriverdata" title="typedef struct _DXGKARG_GETSTANDARDALLOCATIONDRIVERDATA {&#10;  D3DKMDT_STANDARDALLOCATION_TYPE StandardAllocationType;&#10;  union {&#10;    D3DKMDT_SHAREDPRIMARYSURFACEDATA *pCreateSharedPrimarySurfaceData;&#10;    D3DKMDT_SHADOWSURFACEDATA        *pCreateShadowSurfaceData;&#10;    D3DKMDT_STAGINGSURFACEDATA       *pCreateStagingSurfaceData;&#10;    D3DKMDT_GDISURFACEDATA           *pCreateGdiSurfaceData;&#10;    D3DKMDT_VIRTUALGPUSURFACEDATA    *pCreateVirtualGpuSurfaceData;&#10;    D3DKMDT_FENCESTORAGESURFACEDATA  *pCreateFenceStorageData;&#10;  };&#10;  VOID                            *pAllocationPrivateDriverData;&#10;  UINT                            AllocationPrivateDriverDataSize;&#10;  VOID                            *pResourcePrivateDriverData;&#10;  UINT                            ResourcePrivateDriverDataSize;&#10;  UINT                            PhysicalAdapterIndex;&#10;} DXGKARG_GETSTANDARDALLOCATIONDRIVERDATA;">DXGKARG_GETSTANDARDALLOCATIONDRIVERDATA</a></strong>.<strong>StandardAllocationType</strong> is <strong>D3DKMDT_STANDARDALLOCATION_SHAREDPRIMARYSURFACE</strong>), do not set <strong><a href="dxgk_allocationinfoflags" title="typedef struct _DXGK_ALLOCATIONINFOFLAGS {&#10;  union {&#10;    struct {&#10;      UINT CpuVisible : 1;&#10;      UINT PermanentSysMem : 1;&#10;      UINT Cached : 1;&#10;      UINT Protected : 1;&#10;      UINT ExistingSysMem : 1;&#10;      UINT ExistingKernelSysMem : 1;&#10;      UINT FromEndOfSegment : 1;&#10;      UINT Swizzled : 1;&#10;      UINT Overlay : 1;&#10;      UINT Capture : 1;&#10;      UINT UseAlternateVA : 1;&#10;      UINT SynchronousPaging : 1;&#10;      UINT LinkMirrored : 1;&#10;      UINT LinkInstanced : 1;&#10;      UINT HistoryBuffer : 1;&#10;      UINT AccessedPhysically : 1;&#10;      UINT ExplicitResidencyNotification : 1;&#10;...">DXGK_ALLOCATIONINFOFLAGS</a></strong>.<strong>UseAlternateVA</strong>, and use a section-backed primary allocation (set <strong><a href="dxgk_vidmmcaps" title="typedef struct _DXGK_VIDMMCAPS {&#10;  union {&#10;    struct {&#10;      UINT OutOfOrderLock : 1;&#10;      UINT DedicatedPagingEngine : 1;&#10;      UINT PagingEngineCanSwizzle : 1;&#10;      UINT SectionBackedPrimary : 1;&#10;      UINT CrossAdapterResource : 1;&#10;      UINT VirtualAddressingSupported : 1;&#10;      UINT GpuMmuSupported : 1;&#10;      UINT IoMmuSupported : 1;&#10;      UINT ReplicateGdiContent : 1;&#10;      UINT NonCpuVisiblePrimary : 1;&#10;      UINT ParavirtualizationSupported : 1;&#10;      UINT IoMmuSecureModeSupported : 1;&#10;      UINT DisableSelfRefreshVRAMInS3 : 1;&#10;      UINT IoMmuSecureModeRequired : 1;&#10;      UINT MapAperture2Supported : 1;&#10;      UINT CrossAdapterResourceTexture : 1;&#10;      UINT CrossAdapterResourceScanout : 1;&#10;...">DXGK_VIDMMCAPS</a></strong>.<strong>SectionBackedPrimary</strong>) when the driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a> function is called.</p>

<h3 id="optimized-standby-settings">Optimized standby settings</h3>

<p>The combination of values for the <strong>PreservedDuringStandby</strong>, <strong>PreservedDuringHibernate</strong>, and <strong>PartiallyPreservedDuringHibernate</strong> members determines whether a segment is purged of its content when the system enters a low-power (standby) system state, as follows.</p>

<table>
<thead>
<tr>
  <th>Preserved During Standby</th>
  <th>Preserved During Hibernate</th>
  <th>Partially Preserved During Hibernate</th>
  <th>Standby State</th>
  <th>Hibernate State</th>
</tr>
</thead>
<tbody>
<tr>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>invalid</td>
  <td>invalid</td>
</tr>
<tr>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>not purged</td>
  <td>not purged</td>
</tr>
<tr>
  <td>1</td>
  <td>0</td>
  <td>1</td>
  <td>not purged</td>
  <td>partially purged</td>
</tr>
<tr>
  <td>1</td>
  <td>0</td>
  <td>0</td>
  <td>not purged</td>
  <td>purged</td>
</tr>
<tr>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>invalid</td>
  <td>invalid</td>
</tr>
<tr>
  <td>0</td>
  <td>1</td>
  <td>0</td>
  <td>invalid</td>
  <td>invalid</td>
</tr>
<tr>
  <td>0</td>
  <td>0</td>
  <td>1</td>
  <td>invalid</td>
  <td>invalid</td>
</tr>
<tr>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>purged</td>
  <td>purged</td>
</tr>
</tbody>
</table>

<p>The operating system does not recognize combinations in this table that are marked "invalid".</p>

<p>If the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/customize/power-settings/sleep-settings-hybrid-sleep">hybrid sleep</a> mode is enabled, the system acts as if it is hibernating: it purges segments that are not preserved during hibernate, even if it is going into a low-power state.</p>

<h2 id="see-also">See also</h2>

<p><strong><a href="dxgkarg_queryadapterinfo" title="typedef struct _DXGKARG_QUERYADAPTERINFO {&#10;  [in]  DXGK_QUERYADAPTERINFOTYPE  Type;&#10;  [in]  VOID                       *pInputData;&#10;  [in]  UINT                       InputDataSize;&#10;  [out] VOID                       *pOutputData;&#10;  [in]  UINT                       OutputDataSize;&#10;  [in]  DXGK_QUERYADAPTERINFOFLAGS Flags;&#10;  [in]  HANDLE                     hKmdProcessHandle;&#10;} DXGKARG_QUERYADAPTERINFO;">DXGKARG_QUERYADAPTERINFO</a></strong></p>

<p><strong><a href="dxgk_allocationinfo" title="typedef struct _DXGK_ALLOCATIONINFO {&#10;  VOID                       *pPrivateDriverData;&#10;  UINT                       PrivateDriverDataSize;&#10;  union {&#10;    UINT Alignment;&#10;    struct {&#10;      UINT16 MinimumPageSize;&#10;      UINT16 RecommendedPageSize;&#10;    };&#10;  };&#10;  SIZE_T                     Size;&#10;  SIZE_T                     PitchAlignedSize;&#10;  DXGK_SEGMENTBANKPREFERENCE HintedBank;&#10;  DXGK_SEGMENTPREFERENCE     PreferredSegment;&#10;  union {&#10;    UINT SupportedReadSegmentSet;&#10;    UINT MmuSet;&#10;  };&#10;  UINT                       SupportedWriteSegmentSet;&#10;  UINT                       EvictionSegmentSet;&#10;...">DXGK_ALLOCATIONINFO</a></strong></p>

<p><strong><a href="dxgk_querysegmentin" title="typedef struct _DXGK_QUERYSEGMENTIN {&#10;  [in] PHYSICAL_ADDRESS  AgpApertureBase;&#10;  [in] LARGE_INTEGER     AgpApertureSize;&#10;  [in] DXGK_SEGMENTFLAGS AgpFlags;&#10;} DXGK_QUERYSEGMENTIN;">DXGK_QUERYSEGMENTIN</a></strong></p>

<p><strong><a href="dxgk_segmentdescriptor" title="typedef struct _DXGK_SEGMENTDESCRIPTOR {&#10;  [out] PHYSICAL_ADDRESS  BaseAddress;&#10;  [out] PHYSICAL_ADDRESS  CpuTranslatedAddress;&#10;  [out] SIZE_T            Size;&#10;  [out] UINT              NbOfBanks;&#10;  [out] SIZE_T            *pBankRangeTable;&#10;  [out] SIZE_T            CommitLimit;&#10;  [out] DXGK_SEGMENTFLAGS Flags;&#10;} DXGK_SEGMENTDESCRIPTOR;">DXGK_SEGMENTDESCRIPTOR</a></strong></p>

<p><strong><a href="dxgk_segmentdescriptor3" title="typedef struct _DXGK_SEGMENTDESCRIPTOR3 {&#10;  [out] DXGK_SEGMENTFLAGS Flags;&#10;  [out] PHYSICAL_ADDRESS  BaseAddress;&#10;  [out] PHYSICAL_ADDRESS  CpuTranslatedAddress;&#10;  [out] SIZE_T            Size;&#10;  [out] UINT              NbOfBanks;&#10;  [out] SIZE_T            *pBankRangeTable;&#10;  [out] SIZE_T            CommitLimit;&#10;        SIZE_T            SystemMemoryEndAddress;&#10;        SIZE_T            Reserved;&#10;} DXGK_SEGMENTDESCRIPTOR3;">DXGK_SEGMENTDESCRIPTOR3</a></strong></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_buildpagingbuffer"><strong>DxgkDdiBuildPagingBuffer</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/nc-d3dkmddi-dxgkddi_queryadapterinfo"><strong>DxgkDdiQueryAdapterInfo</strong></a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/d3dkmddi/ns-d3dkmddi-_dxgk_segmentflags">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/d3dkmddi/ns-d3dkmddi-_dxgk_segmentflags.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
