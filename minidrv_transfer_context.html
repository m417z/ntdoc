<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="MINIDRV_TRANSFER_CONTEXT - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MINIDRV_TRANSFER_CONTEXT - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            MINIDRV_TRANSFER_CONTEXT - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wiamindr_lh.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _MINIDRV_TRANSFER_CONTEXT {
  <a href="long" title="typedef long LONG;">LONG</a>                lSize;
  <a href="long" title="typedef long LONG;">LONG</a>                lWidthInPixels;
  <a href="long" title="typedef long LONG;">LONG</a>                lLines;
  <a href="long" title="typedef long LONG;">LONG</a>                lDepth;
  <a href="long" title="typedef long LONG;">LONG</a>                lXRes;
  <a href="long" title="typedef long LONG;">LONG</a>                lYRes;
  <a href="long" title="typedef long LONG;">LONG</a>                lCompression;
  GUID                guidFormatID;
  <a href="long" title="typedef long LONG;">LONG</a>                tymed;
  <a href="long_ptr" title="typedef [public] __int3264 LONG_PTR;">LONG_PTR</a>            hFile;
  <a href="long" title="typedef long LONG;">LONG</a>                cbOffset;
  <a href="long" title="typedef long LONG;">LONG</a>                lBufferSize;
  <a href="long" title="typedef long LONG;">LONG</a>                lActiveBuffer;
  <a href="long" title="typedef long LONG;">LONG</a>                lNumBuffers;
  <a href="byte" title="typedef unsigned char BYTE;">BYTE</a>                *pBaseBuffer;
  <a href="byte" title="typedef unsigned char BYTE;">BYTE</a>                *pTransferBuffer;
  BOOL                bTransferDataCB;
  BOOL                bClassDrvAllocBuf;
  <a href="long_ptr" title="typedef [public] __int3264 LONG_PTR;">LONG_PTR</a>            lClientAddress;
  IWiaMiniDrvCallBack *pIWiaMiniDrvCallBack;
  <a href="long" title="typedef long LONG;">LONG</a>                lImageSize;
  <a href="long" title="typedef long LONG;">LONG</a>                lHeaderSize;
  <a href="long" title="typedef long LONG;">LONG</a>                lItemSize;
  <a href="long" title="typedef long LONG;">LONG</a>                cbWidthInBytes;
  <a href="long" title="typedef long LONG;">LONG</a>                lPage;
  <a href="long" title="typedef long LONG;">LONG</a>                lCurIfdOffset;
  <a href="long" title="typedef long LONG;">LONG</a>                lPrevIfdOffset;
} MINIDRV_TRANSFER_CONTEXT, *PMINIDRV_TRANSFER_CONTEXT;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamindr_lh/ns-wiamindr_lh-_minidrv_transfer_context">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/minidrv_transfer_context.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-wiamindr_lh-_minidrv_transfer_context)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="_minidrv_transfer_context-structure">_MINIDRV_TRANSFER_CONTEXT structure</h1>

<h2 id="description">Description</h2>

<p>The MINIDRV_TRANSFER_CONTEXT structure is used to store image and other information needed for a memory-callback data transfer or a file data transfer.</p>

<h2 id="members">Members</h2>

<h3 id="lsize"><code>lSize</code></h3>

<p>Specifies the size in bytes of this MINIDRV_TRANSFER_CONTEXT structure.</p>

<h3 id="lwidthinpixels"><code>lWidthInPixels</code></h3>

<p>Specifies the width in pixels of the current image. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-pixels-per-line">WIA_IPA_PIXELS_PER_LINE</a> common item property.</p>

<h3 id="llines"><code>lLines</code></h3>

<p>Specifies the total number of lines (the number of horizontal rows of pixels) in the current image. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-number-of-lines">WIA_IPA_NUMBER_OF_LINES</a> common item property.</p>

<h3 id="ldepth"><code>lDepth</code></h3>

<p>Specifies the color depth value of the current image in bits per pixel. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-depth">WIA_IPA_DEPTH</a> common item property.</p>

<h3 id="lxres"><code>lXRes</code></h3>

<p>Specifies the current horizontal resolution of the image in pixels per inch. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ips-xres">WIA_IPS_XRES</a> scanner item property.</p>

<h3 id="lyres"><code>lYRes</code></h3>

<p>Specifies the current vertical resolution of the image in pixels per inch. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ips-yres">WIA_IPS_YRES</a> scanner item property.</p>

<h3 id="lcompression"><code>lCompression</code></h3>

<p>Specifies the type of compression used by the device. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-compression">WIA_IPA_COMPRESSION</a> common item property.</p>

<h3 id="guidformatid"><code>guidFormatID</code></h3>

<p>Specifies a GUID that indicates the data format for the device. The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-format">WIA_IPA_FORMAT</a> common item property.</p>

<h3 id="tymed"><code>tymed</code></h3>

<p>Specifies the type of data transfer. The data transfer specified can be either a memory-callback transfer (TYMED_CALLBACK or TYMED_MULTIPAGE_CALLBACK) or file transfer (TYMED_FILE or TYMED_MULTIPAGE_FILE). The value of this member is derived from the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-tymed">WIA_IPA_TYMED</a> common item property.</p>

<p>This member conveys information related to that in the <strong>bTransferDataCB</strong> member. See <strong>Remarks</strong> for more information.</p>

<h3 id="hfile"><code>hFile</code></h3>

<p>Specifies the handle to the open file used during file transfers. The minidriver should not use this member. See <strong>Remarks</strong> for more information.</p>

<h3 id="cboffset"><code>cbOffset</code></h3>

<p>Specifies the current offset in bytes of the next buffer location used during this transfer.</p>

<h3 id="lbuffersize"><code>lBufferSize</code></h3>

<p>Specifies the total size of the transfer buffer.</p>

<h3 id="lactivebuffer"><code>lActiveBuffer</code></h3>

<p>Specifies which buffer is used for the current transfer. The value of this member must be in the range of 1 through <strong>lNumBuffers</strong>.</p>

<h3 id="lnumbuffers"><code>lNumBuffers</code></h3>

<p>Specifies the number of buffers available for data transfer. This value can currently be either 1 or 2.</p>

<h3 id="pbasebuffer"><code>pBaseBuffer</code></h3>

<p>Points to the start of the base transfer buffer.</p>

<h3 id="ptransferbuffer"><code>pTransferBuffer</code></h3>

<p>Points to the start of the current transfer buffer. For a callback transfer in which double buffering is used, this member alternates between the two buffers, pointing to the beginning of the first buffer, and then to the beginning of the second, and so on.</p>

<h3 id="btransferdatacb"><code>bTransferDataCB</code></h3>

<p>Specifies whether a data transfer is a memory-callback transfer or a file transfer. This member is set to <strong>TRUE</strong> if the transfer is a memory-callback transfer, and <strong>FALSE</strong> if the transfer is a file transfer. For file transfers, the WIA service usually provides a callback routine, which enables the application to receive updates from the minidriver about the status of the file transfer. (The WIA service provides a callback routine if the application provides its own callback routine. See <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/iwiaminidrvcallback-com-interface">IWiaMiniDrvCallback COM Interface</a> for details.) For file transfers, a minidriver should check the value stored in the <strong>pIWiaMiniDrvCallBack</strong> member. If that member is <strong>NULL</strong>, the WIA service does not provide a callback routine, so the driver must not attempt to call it. For memory-callback transfers, the WIA service always provides a callback.</p>

<p>This member conveys information related to that in the <strong>tymed</strong> member. See <strong>Remarks</strong> for more information.</p>

<h3 id="bclassdrvallocbuf"><code>bClassDrvAllocBuf</code></h3>

<p>Specifies whether the WIA service has allocated the transfer buffer. This value is <strong>TRUE</strong> if the WIA service allocated the buffer, and <strong>FALSE</strong> if not. In that case, it is the minidriver's responsibility to allocate the transfer buffer.</p>

<h3 id="lclientaddress"><code>lClientAddress</code></h3>

<p>Specifies the address, in the client's address space, of the transfer. The minidriver must not change this value.</p>

<h3 id="piwiaminidrvcallback"><code>pIWiaMiniDrvCallBack</code></h3>

<p>Points to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamindr_lh/nn-wiamindr_lh-iwiaminidrvcallback">IWiaMiniDrvCallBack Interface</a> used for data or status callback transfer.</p>

<h3 id="limagesize"><code>lImageSize</code></h3>

<p>Specifies the size, in bytes, of uncompressed bits in a single page.</p>

<h3 id="lheadersize"><code>lHeaderSize</code></h3>

<p>Specifies the size, in bytes, of image header data in a single page.</p>

<h3 id="litemsize"><code>lItemSize</code></h3>

<p>Specifies the size, in bytes, of bits and header. This value can be zero if the item size is unknown before acquisition.</p>

<h3 id="cbwidthinbytes"><code>cbWidthInBytes</code></h3>

<p>Specifies the size, in bytes, of an image line.</p>

<h3 id="lpage"><code>lPage</code></h3>

<p>Specifies the page number of the current page when scanning a multipage TIFF image. Page numbering begins with zero.</p>

<h3 id="lcurifdoffset"><code>lCurIfdOffset</code></h3>

<p>Specifies the image file directory (IFD) offset in the current page of a multipage TIFF image.</p>

<h3 id="lprevifdoffset"><code>lPrevIfdOffset</code></h3>

<p>Specifies the image file directory (IFD) offset in the previous page of a multipage TIFF image.</p>

<h2 id="remarks">Remarks</h2>

<p>The WIA service sets most of the members of this structure before it calls the minidriver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamindr_lh/nf-wiamindr_lh-iwiaminidrv-drvacquireitemdata">IWiaMiniDrv::drvAcquireItemData</a> method. If the minidriver calls <a href="wiasgetimageinformation" title="HRESULT wiasGetImageInformation(&#10;  [in]      BYTE                      *pWiasContext,&#10;            LONG                      lFlags,&#10;  [in, out] PMINIDRV_TRANSFER_CONTEXT pmdtc&#10;);">wiasGetImageInformation</a>, then that function fills in the remaining members of the MINIDRV_TRANSFER_CONTEXT passed to it.</p>

<p>Because the WIA service currently uses only the TYMED_FILE and TYMED_CALLBACK constants, the <strong>tymed</strong> and <strong>bTransferDataCB</strong> members store essentially the same information. For file transfers, when <strong>bTransferDataCB</strong> is set to <strong>FALSE</strong>, <strong>tymed</strong> is set to either TYMED_FILE or TYMED_MULTIPAGE_FILE. For memory-callback transfers, when <strong>bTransferDataCB</strong> is set to <strong>TRUE</strong>, <strong>tymed</strong> is set to either TYMED_CALLBACK or TYMED_MULTIPAGE_CALLBACK.</p>

<p>The <strong>hFile</strong> member is reserved for use solely by the WIA service. Rather than using this member for file transfers, the minidriver should instead write the data to a buffer, and then call <a href="wiaswritepagebuftofile" title="HRESULT wiasWritePageBufToFile(&#10;  [in] PMINIDRV_TRANSFER_CONTEXT pmdtc&#10;);">wiasWritePageBufToFile</a> to complete the file transfer.</p>

<p>The minidriver obtains values from specific common or scanner item properties to set the members shown in the following table:</p>

<table>
<thead>
<tr>
  <th>Member</th>
  <th>Set by</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>lWidthInPixels</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-pixels-per-line">WIA_IPA_PIXELS_PER_LINE</a></td>
</tr>
<tr>
  <td><strong>lLines</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-number-of-lines">WIA_IPA_NUMBER_OF_LINES</a></td>
</tr>
<tr>
  <td><strong>lDepth</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-depth">WIA_IPA_DEPTH</a></td>
</tr>
<tr>
  <td><strong>lXRes</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ips-xres">WIA_IPS_XRES</a></td>
</tr>
<tr>
  <td><strong>lYRes</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ips-yres">WIA_IPS_YRES</a></td>
</tr>
<tr>
  <td><strong>lCompression</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-compression">WIA_IPA_COMPRESSION</a></td>
</tr>
<tr>
  <td><strong>guidFormatID</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-format">WIA_IPA_FORMAT</a></td>
</tr>
<tr>
  <td><strong>tymed</strong></td>
  <td><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/image/wia-ipa-tymed">WIA_IPA_TYMED</a></td>
</tr>
</tbody>
</table>

<p>Usually, the minidriver sets the preceding structure members directly from the values of the item properties. An application or the minidriver will have set the item properties earlier. The WIA service fills in its service context, using the property values. The driver can use the values stored in this context for quick reference.</p>

<p>The WIA service sets the following structure members:</p>

<ul>
<li><p><strong>hFile</strong></p></li>
<li><p><strong>bTransferDataCB</strong></p></li>
<li><p><strong>bClassDrvAllocBuf</strong></p></li>
</ul>

<p>Either the minidriver or the <a href="wiasgetimageinformation" title="HRESULT wiasGetImageInformation(&#10;  [in]      BYTE                      *pWiasContext,&#10;            LONG                      lFlags,&#10;  [in, out] PMINIDRV_TRANSFER_CONTEXT pmdtc&#10;);">wiasGetImageInformation</a> service library function sets the following structure members:</p>

<ul>
<li><p><strong>lImageSize</strong></p></li>
<li><p><strong>lHeaderSize</strong></p></li>
<li><p><strong>lItemSize</strong></p></li>
<li><p><strong>cbWidthInBytes</strong></p></li>
</ul>

<p>The following members of this structure are used in data transfer callbacks. The WIA service or the minidriver sets these members. In several cases, the value stored in <strong>bClassDrvAllocBuf</strong> determines whether the WIA service or the minidriver sets the member.</p>

<table>
<thead>
<tr>
  <th>Member</th>
  <th>Set by</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>cbOffset</strong></td>
  <td>Minidriver</td>
</tr>
<tr>
  <td><strong>lBufferSize</strong></td>
  <td>WIA service or minidriver. If <strong>bClassDrvAllocBuf</strong> is <strong>TRUE</strong>, the WIA service sets this member; otherwise, the minidriver sets it.</td>
</tr>
<tr>
  <td><strong>lActiveBuffer</strong></td>
  <td>WIA service. The minidriver must not modify this member.</td>
</tr>
<tr>
  <td><strong>lNumBuffers</strong></td>
  <td>WIA service. The minidriver must not modify this member.</td>
</tr>
<tr>
  <td><strong>pBaseBuffer</strong></td>
  <td>WIA service or minidriver. If <strong>bClassDrvAllocBuf</strong> is <strong>TRUE</strong>, the WIA service sets this member; otherwise, the minidriver sets it.</td>
</tr>
<tr>
  <td><strong>pTransferBuffer</strong></td>
  <td>WIA service or minidriver. If <strong>bClassDrvAllocBuf</strong> is <strong>TRUE</strong>, the WIA service sets this member; otherwise, the minidriver sets it.</td>
</tr>
<tr>
  <td><strong>lClientAddress</strong></td>
  <td>WIA service. The minidriver must not modify this member.</td>
</tr>
<tr>
  <td><strong>pIWiaMiniDrvCallBack</strong></td>
  <td>WIA service</td>
</tr>
</tbody>
</table>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamindr_lh/nf-wiamindr_lh-iwiaminidrv-drvacquireitemdata">IWiaMiniDrv::drvAcquireItemData</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamindr_lh/nf-wiamindr_lh-iwiaminidrvcallback-minidrvcallback">IWiaMiniDrvCallBack::MiniDrvCallback</a></p>

<p><a href="wiasgetimageinformation" title="HRESULT wiasGetImageInformation(&#10;  [in]      BYTE                      *pWiasContext,&#10;            LONG                      lFlags,&#10;  [in, out] PMINIDRV_TRANSFER_CONTEXT pmdtc&#10;);">wiasGetImageInformation</a></p>

<p><a href="wiaswritepagebuftofile" title="HRESULT wiasWritePageBufToFile(&#10;  [in] PMINIDRV_TRANSFER_CONTEXT pmdtc&#10;);">wiasWritePageBufToFile</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wiamindr_lh/ns-wiamindr_lh-_minidrv_transfer_context">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wiamindr_lh/ns-wiamindr_lh-_minidrv_transfer_context.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
