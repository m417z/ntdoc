<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="WDF_QUERY_INTERFACE_CONFIG - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>WDF_QUERY_INTERFACE_CONFIG - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            WDF_QUERY_INTERFACE_CONFIG - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdfqueryinterface.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">typedef struct _WDF_QUERY_INTERFACE_CONFIG {
  <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>                                          Size;
  <a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">PINTERFACE</a>                                     Interface;
  const GUID                                     *InterfaceType;
  BOOLEAN                                        SendQueryToParentStack;
  PFN_WDF_DEVICE_PROCESS_QUERY_INTERFACE_REQUEST EvtDeviceProcessQueryInterfaceRequest;
  BOOLEAN                                        ImportInterface;
} WDF_QUERY_INTERFACE_CONFIG, *PWDF_QUERY_INTERFACE_CONFIG;</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/ns-wdfqueryinterface-_wdf_query_interface_config">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/wdf_query_interface_config.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (ns-wdfqueryinterface-_wdf_query_interface_config)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>_WDF_QUERY_INTERFACE_CONFIG structure</h1>
<h2>Description</h2>
<p>[Applies to KMDF only]</p>
<p>The <strong>WDF_QUERY_INTERFACE_CONFIG</strong> structure describes a driver-defined interface.</p>
<h2>Members</h2>
<h3><code>Size</code></h3>
<p>The size, in bytes, of this structure.</p>
<h3><code>Interface</code></h3>
<p>A pointer to an <a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a> structure that describes the driver-defined interface.</p>
<h3><code>InterfaceType</code></h3>
<p>A pointer to the GUID that identifies the interface.</p>
<blockquote>
  <p>[!NOTE]
  When introducing a new version of an existing interface, create a new GUID instead of revising the <strong>Size</strong> or <strong>Version</strong> fields of the <strong><a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a></strong> structure. For more info, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-driver-defined-interfaces">Using Driver-Defined Interfaces</a>.</p>
</blockquote>
<h3><code>SendQueryToParentStack</code></h3>
<p>If <strong>TRUE</strong>, and if your driver specifies a device object that represents a physical device object (PDO) when it calls <a href="wdfdeviceaddqueryinterface" title="NTSTATUS WdfDeviceAddQueryInterface(&#10;  [in] WDFDEVICE                   Device,&#10;  [in] PWDF_QUERY_INTERFACE_CONFIG InterfaceConfig&#10;);">WdfDeviceAddQueryInterface</a>, the framework sends requests for the interface to the top of the parent device's driver stack. If this member is <strong>FALSE</strong>, or if the device object does not represent a PDO, the framework does not send requests to the parent device's stack. For more information, see the following Remarks section.</p>
<h3><code>EvtDeviceProcessQueryInterfaceRequest</code></h3>
<p>A pointer to your driver's <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/nc-wdfqueryinterface-evt_wdf_device_process_query_interface_request">EvtDeviceProcessQueryInterfaceRequest</a> event callback function, which is called when another driver requests the interface.</p>
<h3><code>ImportInterface</code></h3>
<p>If <strong>TRUE</strong>, the interface supports two-way communication between your driver and drivers that request the interface.</p>
<p>If this member is <strong>FALSE</strong>, the interface supports one-way communication from your driver to drivers that request the interface.</p>
<h2>Remarks</h2>
<p>The <strong>WDF_QUERY_INTERFACE_CONFIG</strong> structure is used as input to the <a href="wdfdeviceaddqueryinterface" title="NTSTATUS WdfDeviceAddQueryInterface(&#10;  [in] WDFDEVICE                   Device,&#10;  [in] PWDF_QUERY_INTERFACE_CONFIG InterfaceConfig&#10;);">WdfDeviceAddQueryInterface</a> method.</p>
<p>For each driver-defined interface that your driver exports, you must allocate a WDF_QUERY_INTERFACE_CONFIG structure that represents the interface. Other drivers can request access to the interface by calling <a href="wdffdoqueryforinterface" title="NTSTATUS WdfFdoQueryForInterface(&#10;  [in]           WDFDEVICE  Fdo,&#10;  [in]           LPCGUID    InterfaceType,&#10;  [out]          PINTERFACE Interface,&#10;  [in]           USHORT     Size,&#10;  [in]           USHORT     Version,&#10;  [in, optional] PVOID      InterfaceSpecificData&#10;);">WdfFdoQueryForInterface</a>.</p>
<p>If you want your interface to support two-way communication between the requesting driver and your driver, set the <strong>ImportInterface</strong> member to <strong>TRUE</strong>. If <strong>ImportInterface</strong> is <strong>TRUE</strong>, the structure that is provided by the requesting driver can contain data that your driver can read. In this case:</p>
<ul>
<li>The <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/nc-wdfqueryinterface-evt_wdf_device_process_query_interface_request">EvtDeviceProcessQueryInterfaceRequest</a> callback function is required, and it must initialize the interface structure that the requesting driver provides.</li>
<li>Because the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/nc-wdfqueryinterface-evt_wdf_device_process_query_interface_request">EvtDeviceProcessQueryInterfaceRequest</a> callback function
provides the interface to the requesting driver, the <strong>Interface</strong> member of <strong>WDF_QUERY_INTERFACE_CONFIG</strong> can be <strong>NULL</strong>.
If you provide a non-<strong>NULL</strong> pointer, the framework verifies that the size and version values that the requesting driver supplies are equal to or greater than the values in your registered
<a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a> structure. If either of these values are smaller, the framework rejects the request.
If you do not provide a value for <strong>Interface</strong>, your <em>EvtDeviceProcessQueryInterfaceRequest</em> callback function must verify those values.</li>
</ul>
<p>If you want your interface to support only one-way communication from your driver to the requesting driver, set <strong>ImportInterface</strong> is <strong>FALSE</strong>. The interface structure that the requesting driver provides can receive only data that your driver provides. In this case:</p>
<ul>
<li>The <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/nc-wdfqueryinterface-evt_wdf_device_process_query_interface_request">EvtDeviceProcessQueryInterfaceRequest</a> callback function is optional.</li>
<li>The <strong>Interface</strong> member cannot be <strong>NULL</strong>. The framework verifies that the GUID, size, and version values that the requesting driver supplies match the ones you supplied, and the framework rejects the request if the values do not match. If the values are valid, the framework initializes the interface structure that the requesting driver provides by using the values you supply for <strong>Interface</strong>.</li>
</ul>
<p>Additionally, the <strong>Interface</strong> member can be <strong>NULL</strong> if the value of the <strong>SendQueryToParentStack</strong> member is <strong>TRUE</strong>.</p>
<p>If the <strong>Interface</strong> member is non-<strong>NULL</strong>, the framework copies the value to internal storage space. Therefore, the driver can allocate the <a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a> structure in local, temporary storage space.</p>
<p>When your driver calls <a href="wdfdeviceaddqueryinterface" title="NTSTATUS WdfDeviceAddQueryInterface(&#10;  [in] WDFDEVICE                   Device,&#10;  [in] PWDF_QUERY_INTERFACE_CONFIG InterfaceConfig&#10;);">WdfDeviceAddQueryInterface</a>, it can associate the interface with a framework device object that represents either a functional device object (FDO) or a physical device object (PDO). If the driver associates the interface with a PDO, it can set the <strong>SendQueryToParentStack</strong> member of the <strong>WDF_QUERY_INTERFACE_CONFIG</strong> structure to <strong>TRUE</strong>. When the framework intercepts a request for the interface, it checks the <strong>SendQueryToParentStack</strong> member and, if it is set to <strong>TRUE</strong>, the framework sends the request to the top of the driver stack of the PDO's parent. As a result, the request travels down two driver stacks: first, the stack that contains the driver that is requesting the interface and, second, the stack of the parent of the interface's device.</p>
<p>The framework provides two reference/dereference methods that you can use with your interfaces by specifying their addresses for the <strong>InterfaceReference</strong> and <strong>InterfaceDereference</strong> members of the <a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a> structure. For more information about these methods, see <a href="wdfdeviceinterfacereferencenoop" title="VOID WdfDeviceInterfaceReferenceNoOp(&#10;  [in] PVOID Context&#10;);">WdfDeviceInterfaceReferenceNoOp</a> and <a href="wdfdeviceinterfacedereferencenoop" title="VOID WdfDeviceInterfaceDereferenceNoOp(&#10;  [in] PVOID Context&#10;);">WdfDeviceInterfaceDereferenceNoOp</a>.</p>
<p>Drivers should initialize this structure by calling <a href="wdf_query_interface_config_init" title="VOID WDF_QUERY_INTERFACE_CONFIG_INIT(&#10;  [out]          PWDF_QUERY_INTERFACE_CONFIG                    InterfaceConfig,&#10;  [in]           PINTERFACE                                     Interface,&#10;  [in]           const GUID                                     *InterfaceType,&#10;  [in, optional] PFN_WDF_DEVICE_PROCESS_QUERY_INTERFACE_REQUEST EvtDeviceProcessQueryInterfaceRequest&#10;);">WDF_QUERY_INTERFACE_CONFIG_INIT</a>.</p>
<p>For more information about driver-defined interfaces, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/wdf/using-driver-defined-interfaces">Using Driver-Defined Interfaces</a>.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/nc-wdfqueryinterface-evt_wdf_device_process_query_interface_request">EvtDeviceProcessQueryInterfaceRequest</a></p>
<p><a href="interface" title="typedef struct _INTERFACE {&#10;  USHORT                 Size;&#10;  USHORT                 Version;&#10;  PVOID                  Context;&#10;  PINTERFACE_REFERENCE   InterfaceReference;&#10;  PINTERFACE_DEREFERENCE InterfaceDereference;&#10;} INTERFACE, *PINTERFACE;">INTERFACE</a></p>
<p><a href="wdf_query_interface_config_init" title="VOID WDF_QUERY_INTERFACE_CONFIG_INIT(&#10;  [out]          PWDF_QUERY_INTERFACE_CONFIG                    InterfaceConfig,&#10;  [in]           PINTERFACE                                     Interface,&#10;  [in]           const GUID                                     *InterfaceType,&#10;  [in, optional] PFN_WDF_DEVICE_PROCESS_QUERY_INTERFACE_REQUEST EvtDeviceProcessQueryInterfaceRequest&#10;);">WDF_QUERY_INTERFACE_CONFIG_INIT</a></p>
<p><a href="wdfdeviceaddqueryinterface" title="NTSTATUS WdfDeviceAddQueryInterface(&#10;  [in] WDFDEVICE                   Device,&#10;  [in] PWDF_QUERY_INTERFACE_CONFIG InterfaceConfig&#10;);">WdfDeviceAddQueryInterface</a></p>
<p><a href="wdfdeviceinterfacedereferencenoop" title="VOID WdfDeviceInterfaceDereferenceNoOp(&#10;  [in] PVOID Context&#10;);">WdfDeviceInterfaceDereferenceNoOp</a></p>
<p><a href="wdfdeviceinterfacereferencenoop" title="VOID WdfDeviceInterfaceReferenceNoOp(&#10;  [in] PVOID Context&#10;);">WdfDeviceInterfaceReferenceNoOp</a></p>
<p><a href="wdffdoqueryforinterface" title="NTSTATUS WdfFdoQueryForInterface(&#10;  [in]           WDFDEVICE  Fdo,&#10;  [in]           LPCGUID    InterfaceType,&#10;  [out]          PINTERFACE Interface,&#10;  [in]           USHORT     Size,&#10;  [in]           USHORT     Version,&#10;  [in, optional] PVOID      InterfaceSpecificData&#10;);">WdfFdoQueryForInterface</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdfqueryinterface/ns-wdfqueryinterface-_wdf_query_interface_config">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdfqueryinterface/ns-wdfqueryinterface-_wdf_query_interface_config.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
