<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="IOCTL_BATTERY_QUERY_INFORMATION - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>IOCTL_BATTERY_QUERY_INFORMATION - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            IOCTL_BATTERY_QUERY_INFORMATION - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// poclass.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">// <a href="ctl_code" title="void CTL_CODE(&#10;  DeviceType,&#10;  Function,&#10;  Method,&#10;  Access&#10;);">CTL_CODE</a>(0x0029, 0x011, METHOD_BUFFERED, FILE_READ_ACCESS)
#define IOCTL_BATTERY_QUERY_INFORMATION 0x00294044</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows/win32/power/ioctl-battery-query-information">View the official Win32 development documentation</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ioctl_battery_query_information.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Win32 development documentation (ioctl-battery-query-information)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="ioctl_battery_query_information-control-code">IOCTL_BATTERY_QUERY_INFORMATION control code</h1>

<p>Retrieves a variety of information for the battery.</p>

<p>To perform this operation, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function with the following parameters.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">BOOL</span><span class="w"> </span><span class="n">DeviceIoControl</span><span class="p">(</span>
<span class="w">  </span><span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="w"> </span><span class="n">hDevice</span><span class="p">,</span><span class="w">                </span><span class="c1">// handle to battery</span>
<span class="w">  </span><span class="n">IOCTL_BATTERY_QUERY_INFORMATION</span><span class="p">,</span><span class="w"> </span><span class="c1">// dwIoControlCode</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPVOID</span><span class="p">)</span><span class="w"> </span><span class="n">lpInBuffer</span><span class="p">,</span><span class="w">             </span><span class="c1">// input buffer</span>
<span class="w">  </span><span class="p">(</span><span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="p">)</span><span class="w"> </span><span class="n">nInBufferSize</span><span class="p">,</span><span class="w">           </span><span class="c1">// size of input buffer</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPVOID</span><span class="p">)</span><span class="w"> </span><span class="n">lpOutBuffer</span><span class="p">,</span><span class="w">            </span><span class="c1">// output buffer</span>
<span class="w">  </span><span class="p">(</span><span class="n"><a href="dword" title="typedef unsigned long DWORD;">DWORD</a></span><span class="p">)</span><span class="w"> </span><span class="n">nOutBufferSize</span><span class="p">,</span><span class="w">          </span><span class="c1">// size of output buffer</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPDWORD</span><span class="p">)</span><span class="w"> </span><span class="n">lpBytesReturned</span><span class="p">,</span><span class="w">       </span><span class="c1">// number of bytes returned</span>
<span class="w">  </span><span class="p">(</span><span class="n">LPOVERLAPPED</span><span class="p">)</span><span class="w"> </span><span class="n">lpOverlapped</span><span class="w">      </span><span class="c1">// OVERLAPPED structure</span>
<span class="p">);</span>
</code></pre>
</div>

<h2 id="parameters">Parameters</h2>

<p><em>hDevice</em></p>

<p>A handle to the battery on which information is to be returned. To retrieve a device handle, call the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/fileapi/nf-fileapi-createfilea"><strong>CreateFile</strong></a> function.</p>

<p><em>dwIoControlCode</em></p>

<p>The control code for the operation. This value identifies the specific operation to be performed and the type of device on which to perform it. Use <strong>IOCTL_BATTERY_QUERY_INFORMATION</strong> for this operation.</p>

<p><em>lpInBuffer</em></p>

<p>A pointer to a <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-query-information-str"><strong>BATTERY_QUERY_INFORMATION</strong></a> structure.</p>

<p><em>nInBufferSize</em></p>

<p>The size of the input buffer, in bytes.</p>

<p><em>lpOutBuffer</em></p>

<p>A pointer to the return buffer. The data type (and, therefore, size) of the return buffer depends on the information requested in the <strong>BATTERY_QUERY_INFORMATION_LEVEL</strong> member of the input <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-query-information-str"><strong>BATTERY_QUERY_INFORMATION</strong></a> structure.</p>

<p>The following table shows the data returned by a given information level.</p>

<table>
<thead>
<tr>
  <th>Information level</th>
  <th>Data returned</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>BatteryDeviceName</strong></td>
  <td><strong>Null</strong>-terminated Unicode string that specifies the battery's name.</td>
</tr>
<tr>
  <td><strong>BatteryEstimatedTime</strong></td>
  <td>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> that specifies estimated battery run time, in seconds. If the rate of drain provided in the <strong>AtRate</strong> member of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-query-information-str"><strong>BATTERY_QUERY_INFORMATION</strong></a> structure is zero, this calculation is based on the present rate of drain. If <strong>AtRate</strong> is nonzero, the time returned is the expected run time for the given rate. If the estimated time is unknown (for example, the battery is not discharging and <strong>AtRate</strong> is zero), <strong>BATTERY_UNKNOWN_TIME</strong> is returned. Note that this value is not very accurate on some battery systems. The value may vary widely depending on present power usage, which could be affected by disk activity and other factors. There is no notification mechanism for changes in this value.</td>
</tr>
<tr>
  <td><strong>BatteryGranularityInformation</strong></td>
  <td>A variable-length array of <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/WinNT/ns-winnt-battery_reporting_scale"><strong>BATTERY_REPORTING_SCALE</strong></a> structures that contains the reporting granularity for the battery capacity that is returned from <strong><a href="ioctl_battery_query_status" title="// CTL_CODE(0x0029, 0x013, METHOD_BUFFERED, FILE_READ_ACCESS)&#10;#define IOCTL_BATTERY_QUERY_STATUS 0x0029404C">IOCTL_BATTERY_QUERY_STATUS</a></strong>. Multiple entries are returned when the granularity depends on the present capacity of the battery. See <strong><a href="battery_reporting_scale" title="typedef struct {&#10;  ULONG Granularity;&#10;  ULONG Capacity;&#10;} BATTERY_REPORTING_SCALE, *PBATTERY_REPORTING_SCALE;">BATTERY_REPORTING_SCALE</a></strong> for the interpretation of the array of entries. The number of entries is indicated by the size of the buffer returned, and can be calculated as (<em>lpBytesReturned</em> / sizeof (<strong><a href="battery_reporting_scale" title="typedef struct {&#10;  ULONG Granularity;&#10;  ULONG Capacity;&#10;} BATTERY_REPORTING_SCALE, *PBATTERY_REPORTING_SCALE;">BATTERY_REPORTING_SCALE</a></strong>)). The maximum number of entries that will be returned is four.</td>
</tr>
<tr>
  <td><strong>BatteryInformation</strong></td>
  <td>A <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-information-str"><strong>BATTERY_INFORMATION</strong></a> structure.</td>
</tr>
<tr>
  <td><strong>BatteryManufactureDate</strong></td>
  <td>A <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-manufacture-date-str"><strong>BATTERY_MANUFACTURE_DATE</strong></a> structure.</td>
</tr>
<tr>
  <td><strong>BatteryManufactureName</strong></td>
  <td><strong>Null</strong>-terminated Unicode string that contains the name of the manufacturer of the battery.</td>
</tr>
<tr>
  <td><strong>BatterySerialNumber</strong></td>
  <td><strong>Null</strong>-terminated Unicode string that contains the battery's serial number.</td>
</tr>
<tr>
  <td><strong>BatteryTemperature</strong></td>
  <td>A <strong><a href="ulong" title="typedef unsigned long ULONG;">ULONG</a></strong> that contains the battery's current temperature, in 10ths of a degree Kelvin.</td>
</tr>
<tr>
  <td><strong>BatteryUniqueID</strong></td>
  <td><strong>Null</strong>-terminated Unicode string that uniquely identifies the battery. This value can be used to track a specific battery. In the case of smart batteries, this ID will be the concatenation of the manufacturer's name, device name, date of manufacture, and a printable representation of the serial number. This value is not intended to be displayed to the user.<br></td>
</tr>
</tbody>
</table>

<p><em>nOutBufferSize</em></p>

<p>The size of the output buffer, in bytes. Depending on the information level of data requested, this may be a variably sized buffer.</p>

<p><em>lpBytesReturned</em></p>

<p>A pointer to a variable that receives the size of the data returned in the <em>lpOutBuffer</em> buffer, in bytes.</p>

<p>If the output buffer is too small to return any data then the call fails, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a> returns the error code <strong>ERROR_INSUFFICIENT_BUFFER</strong>, and the returned byte count is zero.</p>

<p>If <em>lpOverlapped</em> is <strong>NULL</strong> (nonoverlapped I/O), <em>lpBytesReturned</em> cannot be <strong>NULL</strong>.</p>

<p>If <em>lpOverlapped</em> is not <strong>NULL</strong> (overlapped I/O), <em>lpBytesReturned</em> can be <strong>NULL</strong>. If this is an overlapped operation, you can retrieve the number of bytes returned by calling the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult"><strong>GetOverlappedResult</strong></a> function. If <em>hDevice</em> is associated with an I/O completion port, you can get the number of bytes returned by calling the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus"><strong>GetQueuedCompletionStatus</strong></a> function.</p>

<p><em>lpOverlapped</em></p>

<p>A pointer to an <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/minwinbase/ns-minwinbase-overlapped"><strong>OVERLAPPED</strong></a> structure.</p>

<p>If <em>hDevice</em> was opened with the <strong>FILE_FLAG_OVERLAPPED</strong> flag, <em>lpOverlapped</em> must point to a valid <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/minwinbase/ns-minwinbase-overlapped"><strong>OVERLAPPED</strong></a> structure. In this case, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> is performed as an overlapped (asynchronous) operation. If the device was opened with the <strong>FILE_FLAG_OVERLAPPED</strong> flag and <em>lpOverlapped</em> is <strong>NULL</strong>, the function fails in unpredictable ways.</p>

<p>If <em>hDevice</em> was opened without specifying the <strong>FILE_FLAG_OVERLAPPED</strong> flag, <em>lpOverlapped</em> is ignored and the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> function does not return until the operation has been completed, or until an error occurs.</p>

<h2 id="return-value">Return value</h2>

<p>If the operation completes successfully, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> returns a nonzero value.</p>

<p>If the operation fails or is pending, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> returns zero. To get extended error information, call <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror"><strong>GetLastError</strong></a>.</p>

<p>Some information about batteries is optional or may be meaningless for some batteries. If the particular type of data requested is not available for the current battery, then <strong>ERROR_INVALID_FUNCTION</strong> is returned.</p>

<p>All requests for battery information will complete with the status of ERROR_NO_SUCH_DEVICE (or ERROR_FILE_NOT_FOUND in <strong>Windows 10 version 1809 and earlier</strong>) whenever the BatteryTag element of the request does not match that of the current battery tag. This ensures that the returned battery information matches that of the requested battery (see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-information">Battery Tags</a> for more information).</p>

<h2 id="remarks">Remarks</h2>

<p>This battery IOCTL retrieves a variety of information for the battery. The input parameter structure, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-query-information-str"><strong>BATTERY_QUERY_INFORMATION</strong></a>, indicates the type of information to be returned and when the battery information should be returned. The data type and contents of the output buffer vary based on the data requested.</p>

<p>For the implications of overlapped I/O on this operation, see the Remarks section of the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a> topic.</p>

<h2 id="examples">Examples</h2>

<p>For an example, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/enumerating-battery-devices">Enumerating Battery Devices</a>.</p>

<h2 id="requirements">Requirements</h2>

<table>
<thead>
<tr>
  <th>Requirement</th>
  <th>Value</th>
</tr>
</thead>
<tbody>
<tr>
  <td>Minimum supported client<br></td>
  <td>Windows XP [desktop apps only]<br></td>
</tr>
<tr>
  <td>Minimum supported server<br></td>
  <td>Windows Server 2003 [desktop apps only]<br></td>
</tr>
<tr>
  <td>Header<br></td>
  <td>Poclass.h; <br>BatClass.h on Windows Server 2008 R2, Windows 7, Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP</td>
</tr>
</tbody>
</table>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-information">Battery Information</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/power-management-control-codes">Power Management Control Codes</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol"><strong>DeviceIoControl</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/win32/power/battery-query-information-str"><strong>BATTERY_QUERY_INFORMATION</strong></a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows/desktop/api/WinNT/ns-winnt-battery_reporting_scale"><strong>BATTERY_REPORTING_SCALE</strong></a></p>

<p><strong><a href="ioctl_battery_query_status" title="// CTL_CODE(0x0029, 0x013, METHOD_BUFFERED, FILE_READ_ACCESS)&#10;#define IOCTL_BATTERY_QUERY_STATUS 0x0029404C">IOCTL_BATTERY_QUERY_STATUS</a></strong></p>

<p><strong><a href="ioctl_battery_query_tag" title="// CTL_CODE(0x0029, 0x010, METHOD_BUFFERED, FILE_READ_ACCESS)&#10;#define IOCTL_BATTERY_QUERY_TAG 0x00294040">IOCTL_BATTERY_QUERY_TAG</a></strong></p>

<p><strong><a href="ioctl_battery_set_information" title="// CTL_CODE(0x0029, 0x012, METHOD_BUFFERED, FILE_WRITE_ACCESS)&#10;#define IOCTL_BATTERY_SET_INFORMATION 0x00298048">IOCTL_BATTERY_SET_INFORMATION</a></strong></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows/win32/power/ioctl-battery-query-information">View the official Win32 development documentation</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/win32/blob/docs/desktop-src/Power/ioctl-battery-query-information.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
