<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="EVT_ACX_STREAM_RELEASE_HARDWARE - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EVT_ACX_STREAM_RELEASE_HARDWARE - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            EVT_ACX_STREAM_RELEASE_HARDWARE - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// acxstreams.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">EVT_ACX_STREAM_RELEASE_HARDWARE EvtAcxStreamReleaseHardware;

<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> EvtAcxStreamReleaseHardware(
  ACXSTREAM Stream
)
{...}</span><span class="ntdoc-code-footer">
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/nc-acxstreams-evt_acx_stream_release_hardware">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/evt_acx_stream_release_hardware.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nc-acxstreams-evt_acx_stream_release_hardware)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>EvtAcxStreamReleaseHardware</strong> event tells the driver to release any hardware allocated for the stream and put the stream into the Stop state.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="stream"><code>Stream</code></h3>

<p>An ACXSTREAM object represents an audio stream created by a circuit. The stream is composed of a list of elements created based on the parent circuit's elements. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/audio/acx-summary-of-objects">ACX - Summary of ACX Objects</a>.</p>

<h2 id="return-value">Return value</h2>

<p>Returns <code><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></code> if the call was successful. Otherwise, it returns an appropriate error code. For more information, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-ntstatus-values">Using NTSTATUS Values</a>.</p>

<h2 id="remarks">Remarks</h2>

<p>An AcxStream supports different states. These states indicate when audio is flowing (RUN state), audio is not flowing but audio hardware is prepared (PAUSE state), or audio is not flowing and audio hardware is not prepared (STOP state).</p>

<p>The EvtAcxStreamReleaseHardware event will transition the stream state from the Pause state to the Stop state. The driver should release any hardware resources that were allocated for streaming in this event, such as DMA engines. Once the stream is in the Stop state, the driver may receive the <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/nc-acxstreams-evt_acx_stream_prepare_hardware">EvtAcxStreamPrepareHardware</a> event to transition to the Pause state or the ACXSTREAM object may be destroyed.</p>

<p>ACX Events are analogous to KS states as described in this table.</p>

<table>
<thead>
<tr>
  <th>Start State</th>
  <th>End State</th>
  <th>ACX Driver Event Called</th>
  <th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
  <td>STOP</td>
  <td>ACQUIRE</td>
  <td>PrepareHardware</td>
  <td>Driver performs hardware allocations and preparations</td>
</tr>
<tr>
  <td>ACQUIRE</td>
  <td>PAUSE</td>
  <td>(No Call)</td>
  <td></td>
</tr>
<tr>
  <td>PAUSE</td>
  <td>RUN</td>
  <td>Run</td>
  <td></td>
</tr>
<tr>
  <td>RUN</td>
  <td>PAUSE</td>
  <td>Pause</td>
  <td></td>
</tr>
<tr>
  <td>PAUSE</td>
  <td>ACQUIRE</td>
  <td>(No call)</td>
  <td></td>
</tr>
<tr>
  <td>ACQUIRE</td>
  <td>STOP</td>
  <td>ReleaseHardware</td>
  <td>Driver releases hardware allocations</td>
</tr>
</tbody>
</table>

<p>When work with the stream is complete, <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/nc-acxstreams-evt_acx_stream_free_rtpackets">EvtAcxStreamFreeRtPackets</a> is called after EvtAcxStreamReleaseHardware. This allows the release hardware phase to finish deallocating bandwidth, freeing DMA resources and any other associated cleanup, to occur before the allocated RT buffers are then freed.</p>

<h3 id="memory-cleanup">Memory Cleanup</h3>

<p>The disposal of the stream's resources can be done in the driver's stream context cleanup (not destroy). Never put the disposal of anything that is shared in an object's context destroy callback. This guidance applies to all the ACX objects.</p>

<p>The destroy callback is invoked after the last ref is gone, when it is unknown.</p>

<p>The stream's cleanup callback is called when the handle is closed. One exception to this is when the driver created the stream in its callback. If ACX failed to add this stream to its stream-bridge just before returning from the stream-create operation, the stream is cancelled async, and the current thread returns an error to the create-stream client. The stream should not have any mem allocations allocated at this point.</p>

<h3 id="example">Example</h3>

<p>Example usage is shown below.</p>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="w">    </span><span class="n"><a href="acx_stream_callbacks" title="typedef struct _ACX_STREAM_CALLBACKS {&#10;  ULONG                                Size;&#10;  PFN_ACX_STREAM_PREPARE_HARDWARE      EvtAcxStreamPrepareHardware;&#10;  PFN_ACX_STREAM_RELEASE_HARDWARE      EvtAcxStreamReleaseHardware;&#10;  PFN_ACX_STREAM_RUN                   EvtAcxStreamRun;&#10;  PFN_ACX_STREAM_PAUSE                 EvtAcxStreamPause;&#10;  PFN_ACX_STREAM_ASSIGN_DRM_CONTENT_ID EvtAcxStreamAssignDrmContentId;&#10;} ACX_STREAM_CALLBACKS, *PACX_STREAM_CALLBACKS;">ACX_STREAM_CALLBACKS</a></span><span class="w"> </span><span class="n">streamCallbacks</span><span class="p">;</span>
<span class="w">    </span><span class="n"><a href="acx_stream_callbacks_init" title="VOID ACX_STREAM_CALLBACKS_INIT(&#10;  PACX_STREAM_CALLBACKS Callbacks&#10;);">ACX_STREAM_CALLBACKS_INIT</a></span><span class="p">(</span><span class="o">&amp;</span><span class="n">streamCallbacks</span><span class="p">);</span>
<span class="w">    </span><span class="n">streamCallbacks</span><span class="p">.</span><span class="n">EvtAcxStreamReleaseHardware</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EvtStreamReleaseHardware</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="acxstreaminitassignacxstreamcallbacks" title="NTSTATUS AcxStreamInitAssignAcxStreamCallbacks(&#10;  PACXSTREAM_INIT       StreamInit,&#10;  PACX_STREAM_CALLBACKS StreamCallbacks&#10;);">AcxStreamInitAssignAcxStreamCallbacks</a></span><span class="p">(</span><span class="n">StreamInit</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">streamCallbacks</span><span class="p">);</span>
</code></pre>
</div>

<p><!-- CODE_MARKER --></p>

<div class="codehilite">
<pre><span></span><code><span class="n">PAGED_CODE_SEG</span>
<span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span>
<span class="n">EvtStreamReleaseHardware</span><span class="p">(</span>
<span class="w">    </span><span class="n">_In_</span><span class="w"> </span><span class="n">ACXSTREAM</span><span class="w"> </span><span class="n">Stream</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PSTREAM_CONTEXT</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<span class="w">    </span><span class="n"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a></span><span class="w">        </span><span class="n">status</span><span class="p">;</span>

<span class="w">    </span><span class="n">PAGED_CODE</span><span class="p">();</span>

<span class="w">    </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetStreamContext</span><span class="p">(</span><span class="n">Stream</span><span class="p">);</span>

<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReleaseStreamHardware</span><span class="p">(</span><span class="n">Stream</span><span class="p">);</span>

<span class="w">    </span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">StreamState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AcxStreamStateStop</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="acx-requirements">ACX requirements</h3>

<p><strong>Minimum ACX version:</strong> 1.0</p>

<p>For more information about ACX versions, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/audio/acx-version-overview">ACX version overview</a>.</p>

<h2 id="see-also">See also</h2>

<ul>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/">acxstreams.h header</a></li>
<li><a href="evt_acx_stream_prepare_hardware" title="EVT_ACX_STREAM_PREPARE_HARDWARE EvtAcxStreamPrepareHardware;&#10;&#10;NTSTATUS EvtAcxStreamPrepareHardware(&#10;  ACXSTREAM Stream&#10;)&#10;{...}">EVT_ACX_STREAM_PREPARE_HARDWARE</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/nc-acxstreams-evt_acx_stream_run">EVT_ACX_STREAM_RUN_HARDWARE</a></li>
<li><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/nc-acxstreams-evt_acx_stream_pause">EVT_ACX_STREAM_PAUSE_HARDWARE</a></li>
</ul>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/acxstreams/nc-acxstreams-evt_acx_stream_release_hardware">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/acxstreams/nc-acxstreams-evt_acx_stream_release_hardware.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
