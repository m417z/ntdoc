<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="RxPrepareToReparseSymbolicLink - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RxPrepareToReparseSymbolicLink - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            RxPrepareToReparseSymbolicLink - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// rxprocs.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body"><a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> RxPrepareToReparseSymbolicLink(
  <a href="rx_context" title="typedef struct _RX_CONTEXT {&#10;  NODE_TYPE_CODE         NodeTypeCode;&#10;  NODE_BYTE_SIZE         NodeByteSize;&#10;  __volatile ULONG       ReferenceCount;&#10;  LIST_ENTRY             ContextListEntry;&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  BOOLEAN                PendingReturned;&#10;  BOOLEAN                PostRequest;&#10;  PDEVICE_OBJECT         RealDevice;&#10;  PIRP                   CurrentIrp;&#10;  PIO_STACK_LOCATION     CurrentIrpSp;&#10;  PMRX_FCB               pFcb;&#10;  PMRX_FOBX              pFobx;&#10;  PMRX_SRV_OPEN          pRelevantSrvOpen;&#10;  PNON_PAGED_FCB         NonPagedFcb;&#10;  PRDBSS_DEVICE_OBJECT   RxDeviceObject;&#10;  PETHREAD               OriginalThread;&#10;  PETHREAD               LastExecutionThread;&#10;  __volatile PVOID       LockManagerContext;&#10;...">PRX_CONTEXT</a>     RxContext,
  BOOLEAN         SymbolicLinkEmbeddedInOldPath,
  <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> NewPath,
  BOOLEAN         NewPathIsAbsolute,
  PBOOLEAN        ReparseRequired
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/rxprocs/nf-rxprocs-rxpreparetoreparsesymboliclink">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/rxpreparetoreparsesymboliclink.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-rxprocs-rxpreparetoreparsesymboliclink)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1 id="rxpreparetoreparsesymboliclink-function">RxPrepareToReparseSymbolicLink function</h1>

<h2 id="description">Description</h2>

<p><strong>RxPrepareToReparseSymbolicLink</strong> sets up the file object name to facilitate a reparse. This routine is used by the network mini-redirectors to traverse symbolic links.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="rxcontext"><code>RxContext</code></h3>

<p>A pointer to the <a href="rx_context" title="typedef struct _RX_CONTEXT {&#10;  NODE_TYPE_CODE         NodeTypeCode;&#10;  NODE_BYTE_SIZE         NodeByteSize;&#10;  __volatile ULONG       ReferenceCount;&#10;  LIST_ENTRY             ContextListEntry;&#10;  UCHAR                  MajorFunction;&#10;  UCHAR                  MinorFunction;&#10;  BOOLEAN                PendingReturned;&#10;  BOOLEAN                PostRequest;&#10;  PDEVICE_OBJECT         RealDevice;&#10;  PIRP                   CurrentIrp;&#10;  PIO_STACK_LOCATION     CurrentIrpSp;&#10;  PMRX_FCB               pFcb;&#10;  PMRX_FOBX              pFobx;&#10;  PMRX_SRV_OPEN          pRelevantSrvOpen;&#10;  PNON_PAGED_FCB         NonPagedFcb;&#10;  PRDBSS_DEVICE_OBJECT   RxDeviceObject;&#10;  PETHREAD               OriginalThread;&#10;  PETHREAD               LastExecutionThread;&#10;  __volatile PVOID       LockManagerContext;&#10;...">RX_CONTEXT</a> structure.</p>

<h3 id="symboliclinkembeddedinoldpath"><code>SymbolicLinkEmbeddedInOldPath</code></h3>

<p>A Boolean value that indicates that a symbolic link was encountered. If the value is <strong>TRUE</strong>, a symbolic link was encountered as part of the traversal of the old path.</p>

<h3 id="newpath"><code>NewPath</code></h3>

<p>A pointer to a Unicode string that contains the new path name to be traversed.</p>

<h3 id="newpathisabsolute"><code>NewPathIsAbsolute</code></h3>

<p>A Boolean value that indicates if the new path is absolute. If this value is <strong>FALSE</strong>, \Device\Mup should be prepended to <em>NewPath</em>. If this value is <strong>TRUE</strong>, the <em>NewPath</em> parameter is the full path to reparse. In this case, the buffer that contains <em>NewPath</em> is used directly, rather than allocating a new buffer.</p>

<h3 id="reparserequired"><code>ReparseRequired</code></h3>

<p>A pointer to a Boolean value that indicates whether a reparse is required. If this value is <strong>TRUE</strong>, a reparse is required.</p>

<h2 id="return-value">Return value</h2>

<p><strong>RxPrepareToReparseSymbolicLink</strong> returns <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> on success or one of the following error values on failure:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_ACCESS_DENIED</strong></td>
  <td>A request to delete failed.</td>
</tr>
<tr>
  <td><strong>STATUS_INSUFFICIENT_RESOURCES</strong></td>
  <td>There were insufficient resources available.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_PARAMETER</strong></td>
  <td>An invalid parameter was passed to the routine. This error will be returned if the <strong>MajorFunction</strong> member of <em>RxContext</em> is not <a href="irp_mj_create" title="#define IRP_MJ_CREATE 0x00">IRP_MJ_CREATE</a>.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The <strong>RxPrepareToReparseSymbolicLink</strong> routine would only be used by a network mini-redirector that supports symbolic links and uses reparse points to implement symbolic links. The <strong>RxPrepareToReparseSymbolicLink</strong> routine would normally be called by a network mini-redirector from its <strong>MrxCreate</strong> callback routine.</p>

<p>The <em>SymbolicLinkEmbeddedInOldPath</em> parameter passed to this routine is very important. To preserve the correct semantics, it should be carefully used. For example, consider the old path \A\B\C\D where C happens to be a symbolic link. In this case, the symbolic link is embedded in the path and <em>SymbolicLinkEmbeddedInOldPath</em> should be set to <strong>TRUE</strong>. In contrast, this is very different from the case when D happens to be a symbolic link. In the former case, the reparse constitutes an intermediate step. In the second example, the reparse constitutes the final step of the name resolution and <em>SymbolicLinkEmbeddedInOldPath</em> should be set to <strong>FALSE</strong>.</p>

<p>If DELETE access is specified, the open or create operation is denied for all cases in which the symbolic link is not embedded. It is possible that if DELETE access were the only one specified, then the open attempt must succeed without reparse. This conforms UNIX symbolic link semantics.</p>

<p>As part of this routine, <em>RxContext</em> is also tagged appropriately. This ensures that the return value can be crosschecked with the invocation of this routine. Once <strong>RxPrepareToReparseSymbolicLink</strong> is invoked, the network mini redirector has to return STATUS_REPARSE.</p>

<p>The value of the <em>ReparseRequired</em> parameter assumes significance only if <a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a> is returned from this routine. If <em>ReparseRequired</em> is <strong>FALSE</strong>, this implies that no reparse attempt is required and the symbolic link file itself should be manipulated as opposed to the target of the link. If <em>ReparseRequired</em> is <strong>TRUE</strong>, this implies that a reparse attempt was successfully setup. In such cases, it is imperative that the network mini redirector returns STATUS_REPARSE for the associated <strong><a href="mrxcreate" title="PMRX_CALLDOWN MRxCreate;&#10;&#10;NTSTATUS MRxCreate(&#10;  _Inout_ PRX_CONTEXT RxContext&#10;)&#10;{ ... }">MRxCreate</a></strong> call. RDBSS will initiate a check for this condition.</p>

<h2 id="see-also">See also</h2>

<p><a href="mrxcreate" title="PMRX_CALLDOWN MRxCreate;&#10;&#10;NTSTATUS MRxCreate(&#10;  _Inout_ PRX_CONTEXT RxContext&#10;)&#10;{ ... }">MRxCreate</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/rxprocs/nf-rxprocs-rxpreparetoreparsesymboliclink">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/rxprocs/nf-rxprocs-rxpreparetoreparsesymboliclink.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
