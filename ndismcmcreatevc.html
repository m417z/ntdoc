<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NdisMCmCreateVc - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NdisMCmCreateVc - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github.ntdoc.min.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/highlight.js/styles/github-dark-dimmed.ntdoc.min.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NdisMCmCreateVc - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header language-cpp">// ndis.h

</span><span class="ntdoc-code-intro language-cpp"></span><span class="ntdoc-code-body language-cpp">NDIS_STATUS NdisMCmCreateVc(
  [in]  NDIS_HANDLE  MiniportAdapterHandle,
  [in]  NDIS_HANDLE  NdisAfHandle,
  [in]  NDIS_HANDLE  MiniportVcContext,
  [out] PNDIS_HANDLE NdisVcHandle
);</span><span class="ntdoc-code-footer language-cpp"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismcmcreatevc">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ndismcmcreatevc.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-ndis-ndismcmcreatevc)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h1>NdisMCmCreateVc function</h1>
<h2>Description</h2>
<p><strong>NdisMCmCreateVc</strong> sets up a connection endpoint on which an MCM driver can dispatch an incoming-call
offer to a client.</p>
<h2>Parameters</h2>
<h3><code>MiniportAdapterHandle</code> [in]</h3>
<p>Specifies the NDIS-supplied handle originally input to
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_initialize">MiniportInitializeEx</a>.</p>
<h3><code>NdisAfHandle</code> [in]</h3>
<p>Specifies the handle that identifies the client that is the target of an incoming call. The MCM
driver obtained this handle as an input parameter to its
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_open_af">ProtocolCmOpenAf</a> function.</p>
<h3><code>MiniportVcContext</code> [in]</h3>
<p>Specifies the handle to a caller-supplied resident context area in which the MCM driver maintains
state for this VC. NDIS passes this handle back to the MCM driver in all subsequent calls concerning
this VC if the call to
<strong>NdisMCmCreateVc</strong> succeeds.</p>
<h3><code>NdisVcHandle</code> [out]</h3>
<p>Pointer to a caller-supplied variable that must be initialized to <strong>NULL</strong> before
<strong>NdisMCmCreateVc</strong> is called. On return from a successful call, this variable has been set to an
NDIS-supplied handle for the newly created VC. The caller must save this handle for subsequent calls to
connection-oriented
<strong>Ndis_Xxx_</strong> functions concerning this VC.</p>
<h2>Return value</h2>
<p><strong>NdisMCmCreateVc</strong> can return one of the following:</p>
<table>
<thead>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>NDIS_STATUS_SUCCESS</strong></td>
<td>NDIS created the VC successfully.</td>
</tr>
<tr>
<td><strong>NDIS_STATUS_RESOURCES</strong></td>
<td>NDIS could not allocate sufficient memory to set up the VC.</td>
</tr>
<tr>
<td><strong>NDIS_STATUS_FAILURE</strong></td>
<td>The given <em>NdisAfHandle</em> is invalid.</td>
</tr>
<tr>
<td><strong>NDIS_STATUS__XXX_</strong></td>
<td>The client failed the creation of the VC for some reason, and NDIS has propagated the error status returned by its <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_create_vc">ProtocolCoCreateVc</a> function to the MCM driver.</td>
</tr>
</tbody>
</table>
<h2>Remarks</h2>
<p>An MCM driver creates a VC with
<strong>NdisMCmCreateVc</strong> to represent an incoming offer of a connection from a remote node directed to a SAP
that has already been registered with the MCM driver.</p>
<p>In the process of VC creation, NDIS supplies an
<em>NdisVcHandle</em> to the client and the MCM driver. This handle identifies the virtual connection for
the client and miniport driver to which subsequent requests concerning the given VC are directed. Each
driver must treat this VC handle as an opaque variable, passing it unmodified and uninterpreted in
subsequent calls to certain connection-oriented NDIS library functions.</p>
<p>Usually, callers of
<strong>NdisMCmCreateVc</strong> store the returned
<em>NdisVcHandle</em> in the caller-allocated state area at
<em>MiniportVcContext</em> . NDIS passes an
<em>NdisVcHandle</em> as an input parameter to the
<em>ProtocolCoCreateVc</em> function of the appropriate client whenever an MCM driver creates a VC.</p>
<p>When an MCM driver processes the offer of an incoming call directed to one of its registered SAPs, it
must call
<strong>NdisMCmCreateVc</strong> first. As a synchronous operation, NDIS calls the client's
<em>ProtocolCoCreateVc</em> function before
<strong>NdisMCmCreateVc</strong> returns control. If its call to
<strong>NdisMCmCreateVc</strong> succeeds, the MCM driver can proceed in notifying the appropriate client, passing
the returned value at
<em>NdisVcHandle</em> to
<a href="ndismcmdispatchincomingcall" title="void NdisMCmDispatchIncomingCall(&#10;  _SH_,&#10;  _VH_,&#10;  _CP_&#10;);">NdisMCmDispatchIncomingCall</a>.</p>
<p>The driver writer determines whether an MCM driver has an (internal)
<a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_co_create_vc">MiniportCoCreateVc</a> function that the
driver calls in the context of setting up connections for outgoing and incoming calls.</p>
<p>Only connection-oriented miniport drivers that provide integrated call-management support can call
<strong>NdisMCmCreateVc</strong>. Stand-alone call managers and clients, which register themselves with NDIS as
protocol drivers, call
<strong><a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a></strong> instead.</p>
<h2>See also</h2>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-miniport_co_create_vc">MiniportCoCreateVc</a></p>
<p><a href="ndisallocatefromnpagedlookasidelist" title="void NdisAllocateFromNPagedLookasideList(&#10;  _L&#10;);">NdisAllocateFromNPagedLookasideList</a></p>
<p><a href="ndisclmakecall" title="NDIS_STATUS NdisClMakeCall(&#10;  [in]            NDIS_HANDLE         NdisVcHandle,&#10;  [in, out]       PCO_CALL_PARAMETERS CallParameters,&#10;  [in, optional]  NDIS_HANDLE         ProtocolPartyContext,&#10;  [out, optional] PNDIS_HANDLE        NdisPartyHandle&#10;);">NdisClMakeCall</a></p>
<p><a href="ndiscocreatevc" title="NDIS_STATUS NdisCoCreateVc(&#10;  [in]           NDIS_HANDLE  NdisBindingHandle,&#10;  [in, optional] NDIS_HANDLE  NdisAfHandle,&#10;  [in]           NDIS_HANDLE  ProtocolVcContext,&#10;  [in, out]      PNDIS_HANDLE NdisVcHandle&#10;);">NdisCoCreateVc</a></p>
<p><a href="ndismcmdeletevc" title="NDIS_STATUS NdisMCmDeleteVc(&#10;  [in] NDIS_HANDLE NdisVcHandle&#10;);">NdisMCmDeleteVc</a></p>
<p><a href="ndismcmdispatchincomingcall" title="void NdisMCmDispatchIncomingCall(&#10;  _SH_,&#10;  _VH_,&#10;  _CP_&#10;);">NdisMCmDispatchIncomingCall</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_cm_reg_sap">ProtocolCmRegisterSap</a></p>
<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_co_create_vc">ProtocolCoCreateVc</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/ndis/nf-ndis-ndismcmcreatevc">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/ndis/nf-ndis-ndismcmcreatevc.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script src="modules/highlight.js/highlight.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
