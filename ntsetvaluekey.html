<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="NtSetValueKey - NtDoc, the native NT API online documentation">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NtSetValueKey - NtDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="manifest" href="icons/site.webmanifest">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <noscript id="dark-mode-toggle-stylesheets">
        <link rel="stylesheet" href="modules/water-2.1.1-light.css" media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="modules/water-2.1.1-dark.css" media="(prefers-color-scheme: dark)">
    </noscript>
    <script src="dark-mode-toggle-stylesheets-loader.min.js"></script>
    <link rel="stylesheet" href="modules/virtual-select/virtual-select.css">
    <link rel="stylesheet" href="modules/pygments-css.css">
    <link rel="stylesheet" href="ntdoc.css">
    <noscript>
        <link rel="stylesheet" href="ntdoc-noscript.css">
    </noscript>
</head>
<body>
    <header>
        <a href="."><img class="ntdoc-title-logo" src="logo.png" alt="logo"></a>
        <h1 class="ntdoc-title">
            NtSetValueKey - NtDoc
        </h1>
        <div class="ntdoc-subtitle">
            Native API online documentation, based on the System Informer
            (formerly Process Hacker) <a target="_blank"
            href="https://github.com/winsiderss/systeminformer/tree/master/phnt">phnt
            headers</a>
        </div>
        <div id="ntdoc-search-select"></div>
    </header>
    <div class="ntdoc-code-elements">
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTREGAPI_H

</span><span class="ntdoc-code-intro">/**
 * Sets the value of a registry key.
 *
 * @param[in] KeyHandle A handle to the key to be modified.
 * @param[in] ValueName A pointer to a <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">UNICODE_STRING</a> structure that specifies the name of the value to be set.
 * @param[in, optional] TitleIndex Reserved.
 * @param[in] Type The type of the value.
 * @param[in] Data A pointer to a buffer that contains the value data.
 * @param[in] DataSize The size of the buffer.
 * @return <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> Successful or errant status.
 */
</span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
NtSetValueKey(
    _In_ HANDLE KeyHandle,
    _In_ <a href="pcunicode_string" title="typedef const UNICODE_STRING *PCUNICODE_STRING;">PCUNICODE_STRING</a> ValueName,
    _In_opt_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TitleIndex,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Type,
    _In_reads_bytes_opt_(DataSize) PVOID Data,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> DataSize
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/b281a48adceb1d88b4db663cbaf84ab06cc7074d/phnt/include/ntregapi.h#L934">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">#ifndef _NTZWAPI_H

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSCALLAPI
<a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a>
NTAPI
ZwSetValueKey(
    _In_ HANDLE KeyHandle,
    _In_ <a href="pcunicode_string" title="typedef const UNICODE_STRING *PCUNICODE_STRING;">PCUNICODE_STRING</a> ValueName,
    _In_opt_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> TitleIndex,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> Type,
    _In_reads_bytes_opt_(DataSize) PVOID Data,
    _In_ <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a> DataSize
    );
</span><span class="ntdoc-code-footer">
#endif
</span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://github.com/winsiderss/systeminformer/blob/b281a48adceb1d88b4db663cbaf84ab06cc7074d/phnt/include/ntzwapi.h#L4551">View code on GitHub</a></span></code></pre></div>
<div class="ntdoc-code-element">
<pre class="ntdoc-code-pre"><code class="ntdoc-code"><span class="ntdoc-code-header">// wdm.h

</span><span class="ntdoc-code-intro"></span><span class="ntdoc-code-body">NTSYSAPI <a href="ntstatus" title="typedef _Return_type_success_(return &gt;= 0) long NTSTATUS;">NTSTATUS</a> ZwSetValueKey(
  [in]           HANDLE          KeyHandle,
  [in]           <a href="unicode_string" title="typedef struct _UNICODE_STRING&#10;{&#10;    USHORT Length;&#10;    USHORT MaximumLength;&#10;    _Field_size_bytes_part_opt_(MaximumLength, Length) PWCH Buffer;&#10;} UNICODE_STRING, *PUNICODE_STRING;">PUNICODE_STRING</a> ValueName,
  [in, optional] <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           TitleIndex,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           Type,
  [in, optional] PVOID           Data,
  [in]           <a href="ulong" title="typedef unsigned long ULONG;">ULONG</a>           DataSize
);</span><span class="ntdoc-code-footer"></span><span class="ntdoc-code-links"><hr><a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwsetvaluekey">View the official Windows Driver Kit DDI reference</a></span></code></pre></div>
</div>
<div class="ntdoc-descriptions">
<div class="ntdoc-description-title">
<h1>NtDoc</h1>
</div>
<div class="ntdoc-description">
<div class="ntdoc-description-none">
<p>No description available.</p>
</div>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/ntsetvaluekey.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>Windows Driver Kit DDI reference (nf-wdm-zwsetvaluekey)</h1>
</div>
<div class="ntdoc-description ntdoc-description-selected">
<h2 id="description">Description</h2>

<p>The <strong>ZwSetValueKey</strong> routine creates or replaces a registry key's value entry.</p>

<h2 id="parameters">Parameters</h2>

<h3 id="keyhandle-in"><code>KeyHandle</code> [in]</h3>

<p>Handle to the registry key to write a value entry for. This handle is created by a successful call to <a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a> or <a href="ntopenkey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenKey</a>.</p>

<h3 id="valuename-in"><code>ValueName</code> [in]</h3>

<p>Pointer to the name of the value entry for which the data is to be written. This parameter can be a <strong>NULL</strong> pointer if the value entry has no name. If a name string is specified and the given name is not unique relative to its containing key, the data for an existing value entry is replaced.</p>

<h3 id="titleindex-in-optional"><code>TitleIndex</code> [in, optional]</h3>

<p>This parameter is reserved. Device and intermediate drivers should set this parameter to zero.</p>

<h3 id="type-in"><code>Type</code> [in]</h3>

<p>One of the following system-defined types of data to write:</p>

<table>
<thead>
<tr>
  <th><em>Type</em> value</th>
  <th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
  <td>REG_BINARY</td>
  <td>Binary data in any form.</td>
</tr>
<tr>
  <td>REG_DWORD</td>
  <td>A 4-byte numerical value.</td>
</tr>
<tr>
  <td>REG_DWORD_LITTLE_ENDIAN</td>
  <td>A 4-byte numerical value with the least significant byte at the lowest address. Identical to REG_DWORD.</td>
</tr>
<tr>
  <td>REG_DWORD_BIG_ENDIAN</td>
  <td>A 4-byte numerical value with the least significant byte at the highest address.</td>
</tr>
<tr>
  <td>REG_EXPAND_SZ</td>
  <td>A null-terminated Unicode string that contains unexpanded references to environment variables, such as "%PATH%".</td>
</tr>
<tr>
  <td>REG_LINK</td>
  <td>A Unicode string that names a symbolic link. This type is irrelevant to device and intermediate drivers.</td>
</tr>
<tr>
  <td>REG_MULTI_SZ</td>
  <td>An array of null-terminated strings, terminated by another zero.</td>
</tr>
<tr>
  <td>REG_NONE</td>
  <td>Data with no particular type.</td>
</tr>
<tr>
  <td>REG_SZ</td>
  <td>A null-terminated Unicode string.</td>
</tr>
<tr>
  <td>REG_RESOURCE_LIST</td>
  <td>A device driver's list of hardware resources, used by the driver or one of the physical devices it controls, in the <strong>\ResourceMap</strong> tree</td>
</tr>
<tr>
  <td>REG_RESOURCE_REQUIREMENTS_LIST</td>
  <td>A device driver's list of possible hardware resources it or one of the physical devices it controls can use, from which the system writes a subset into the <strong>\ResourceMap</strong> tree</td>
</tr>
<tr>
  <td>REG_FULL_RESOURCE_DESCRIPTOR</td>
  <td>A list of hardware resources that a physical device is using, detected and written into the <strong>\HardwareDescription</strong> tree by the system</td>
</tr>
</tbody>
</table>

<p>Device drivers should not attempt to call <strong>ZwSetValueKey</strong> to explicitly write value entries in a subkey of the <strong>\Registry...\ResourceMap</strong> key. Only the system can write value entries to the <strong>\Registry...\HardwareDescription</strong> tree.</p>

<h3 id="data-in-optional"><code>Data</code> [in, optional]</h3>

<p>Pointer to a caller-allocated buffer that contains the data for the value entry.</p>

<h3 id="datasize-in"><code>DataSize</code> [in]</h3>

<p>Specifies the size, in bytes, of the <em>Data</em> buffer. If <em>Type</em> is REG_<em>XXX</em>_SZ, this value must include space for any terminating zeros.</p>

<h2 id="return-value">Return value</h2>

<p><strong>ZwSetValueKey</strong> returns <strong><a href="status_success" title="#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)">STATUS_SUCCESS</a></strong> if the operation succeeds. Otherwise, this routine might return one of the following values:</p>

<table>
<thead>
<tr>
  <th>Return code</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><strong>STATUS_ACCESS_DENIED</strong></td>
  <td>The caller does not have appropriate access to the registry value.</td>
</tr>
<tr>
  <td><strong>STATUS_INVALID_HANDLE</strong></td>
  <td>The handle is invalid.</td>
</tr>
</tbody>
</table>

<h2 id="remarks">Remarks</h2>

<p>The <em>KeyHandle</em> passed to <strong>ZwSetValueKey</strong> must have been opened with the KEY_SET_VALUE <em>DesiredAccess</em> flag set for this call to succeed. For a description of possible values for <em>DesiredAccess</em>, see <a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a>.</p>

<p>If the given key has no existing value entry with a name matching the given <em>ValueName</em>, <strong>ZwSetValueKey</strong> creates a new value entry with the given name. If a matching value entry name exists, this routine overwrites the original value entry for the given <em>ValueName</em>. Thus, <strong>ZwSetValueKey</strong> preserves a unique name for each value entry of any particular key. While each value entry name must be unique to its containing key, many different keys in the registry can have value entries with the same names.</p>

<p>For more information about working with registry keys, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-the-registry-in-a-driver">Using the Registry in a Driver</a>.</p>

<p>If the call to this function occurs in user mode, you should use the name "NtSetValueKey" instead of "<strong>ZwSetValueKey</strong>".</p>

<p>For calls from kernel-mode drivers, the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a Windows Native System Services routine can behave differently in the way that they handle and interpret input parameters. For more information about the relationship between the <strong>Nt*Xxx</strong>* and <strong>Zw*Xxx</strong>* versions of a routine, see <a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a>.</p>

<h2 id="see-also">See also</h2>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/previous-versions/windows/hardware/drivers/ff546644(v=vs.85)">HalAssignSlotResources</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/mmcreatemdl">IoAssignResources</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/mmcreatemdl">IoQueryDeviceDescription</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/mmcreatemdl">IoReportResourceUsage</a></p>

<p><a rel="noopener" target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/kernel/using-nt-and-zw-versions-of-the-native-system-services-routines">Using Nt and Zw Versions of the Native System Services Routines</a></p>

<p><a href="ntclose" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtClose(&#10;    _In_ _Post_ptr_invalid_ HANDLE Handle&#10;    );">ZwClose</a></p>

<p><a href="ntcreatekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtCreateKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes,&#10;    _Reserved_ ULONG TitleIndex,&#10;    _In_opt_ PCUNICODE_STRING Class,&#10;    _In_ ULONG CreateOptions,&#10;    _Out_opt_ PULONG Disposition&#10;    );">ZwCreateKey</a></p>

<p><a href="ntflushkey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtFlushKey(&#10;    _In_ HANDLE KeyHandle&#10;    );">ZwFlushKey</a></p>

<p><a href="ntopenkey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes&#10;    );">ZwOpenKey</a></p>
<hr>
<div class="ntdoc-description-links">
<p>
<a target="_blank" href="https://learn.microsoft.com/windows-hardware/drivers/ddi/wdm/nf-wdm-zwsetvaluekey">View the official Windows Driver Kit DDI reference</a>
</p>
<a target="_blank" href="https://github.com/MicrosoftDocs/windows-driver-docs-ddi/blob/staging/wdk-ddi-src/content/wdm/nf-wdm-zwsetvaluekey.md">Edit description on GitHub</a>
</div>
</div>
<div class="ntdoc-description-title">
<h1>NTinternals.net (undocumented.ntinternals.net)</h1>
</div>
<div class="ntdoc-description">
<p>This function is <a rel="noopener" target="_blank" href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwsetvaluekey">documented in Windows Driver Kit</a>.</p>

<hr />

<p>See <code>ZwSetValueKey</code> in <em>NT DDK</em> or <em>2000 DDK</em> for detailed description.</p>

<h1>See also</h1>

<ul>
<li><code><a href="ntenumeratevaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtEnumerateValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ ULONG Index,&#10;    _In_ KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,&#10;    _Out_writes_bytes_to_opt_(Length, *ResultLength) PVOID KeyValueInformation,&#10;    _In_ ULONG Length,&#10;    _Out_ PULONG ResultLength&#10;    );">NtEnumerateValueKey</a></code></li>
<li><code><a href="ntopenkey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtOpenKey(&#10;    _Out_ PHANDLE KeyHandle,&#10;    _In_ ACCESS_MASK DesiredAccess,&#10;    _In_ POBJECT_ATTRIBUTES ObjectAttributes&#10;    );">NtOpenKey</a></code></li>
<li><code><a href="ntqueryvaluekey" title="NTSYSCALLAPI&#10;NTSTATUS&#10;NTAPI&#10;NtQueryValueKey(&#10;    _In_ HANDLE KeyHandle,&#10;    _In_ PCUNICODE_STRING ValueName,&#10;    _In_ KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,&#10;    _Out_writes_bytes_to_opt_(Length, *ResultLength) PVOID KeyValueInformation,&#10;    _In_ ULONG Length,&#10;    _Out_ PULONG ResultLength&#10;    );">NtQueryValueKey</a></code></li>
</ul>
<div class="ntdoc-description-links">
<a target="_blank" href="https://github.com/m417z/ntdoc/blob/main/descriptions/undocumented.ntinternals.net/ntsetvaluekey.md">Edit description on GitHub</a>
</div>
</div>
</div>

    <!-- For sticky footer: https://stackoverflow.com/a/34146411 -->
    <div class="spacer"></div>
    <footer>
        By <a href="https://m417z.com/" target="_blank" rel="noopener">m417z</a> &bull;
        content by <a href="https://github.com/diversenok" target="_blank" rel="noopener">diversenok</a> &bull;
        <a href="https://github.com/m417z/ntdoc" target="_blank" rel="noopener">GitHub repository</a> &bull;
        <dark-mode-toggle permanent></dark-mode-toggle>
    </footer>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWF4NP61SX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YWF4NP61SX');
    </script>
    <script src="modules/jquery-3.7.0.min.js"></script>
    <script src="modules/q-1.5.1.js"></script>
    <script src="modules/virtual-select/virtual-select-jquery.min.js"></script>
    <script src="modules/popper-2.11.8.min.js"></script>
    <script src="modules/tippy-6.3.7.min.js"></script>
    <script src="modules/anchor-5.0.0.min.js"></script>
    <script type="module" src="modules/dark-mode-toggle-0.14.6.min.mjs"></script>
    <script src="ntdoc.js"></script>
</body>
</html>
